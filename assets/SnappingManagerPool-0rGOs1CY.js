const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-CxHNdf5p.js","assets/index-DTNfjJk8.js","assets/angularMeasurementUtils-CKYKRdgY.js","assets/viewUtils-DjifXmeI.js","assets/geodesicLengthMeasurementUtils-Dx0Q6hYp.js","assets/geometryEngine-BfYcmEdT.js","assets/geometryEngineBase-yFIvKOkM.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/hydrated-DHzP4b3c.js","assets/geometry2dUtils-6l12rtra.js","assets/keybindings-Ce91XbQX.js","assets/utils-x-w2kw-v.js","assets/GridSnappingEngine-8l4vUyNW.js","assets/normalizeUtils-DahH0z0O.js","assets/normalizeUtilsCommon-BX2eo9ac.js","assets/FeatureSnappingEngine-RqkjAdUb.js","assets/floorFilterUtils-DZ5C6FQv.js"])))=>i.map(i=>d[i]);
import{r as l,m as h,a as dt,b as ie,V as it,$ as Lt,bg as Re,z as gn,ei as yn,E as Tt,N as se,bK as Nt,qd as En,it as vn,d$ as pt,jT as st,tn as Ae,to as _n,jS as Kt,ac as Sn,ci as mn,tp as wn,nM as bn,cu as $n,ds as A,bH as f,cv as tt,cB as xt,cA as Ot,cy as mt,cz as J,cg as Ln,aU as lt,sS as Tn,e0 as N,dx as T,e1 as w,cO as et,tq as Nn,bM as Y,p2 as wt,cx as xn,dv as qt,tr as Qt,ts as Me,dr as Ce,sU as Oe,dW as qe,dt as zt,cM as Pt,tt as Jt,oD as Pn,db as ze,mX as Rn,nx as An,sT as De,du as Fe,cb as Mn,dH as _,bF as Cn,iA as On,s1 as qn,tu as zn,cN as Dn,iy as Fn,q0 as In,tv as kn,ro as jn,tw as Hn,jR as Ie,tx as Vn,rg as Gn,ty as Zn,tz as Wn,hi as Un,tA as ve,ip as Bn,dz as Xn,kK as Yn,oz as Kn,ns as Qn,dn as Jn,b5 as ti,Q as ei,F as ni,_ as Ht,i as Vt,cU as _e,fo as ii,x as si,ab as ri,tB as ai}from"./index-DTNfjJk8.js";import{c as Se}from"./keybindings-Ce91XbQX.js";import{r as oi}from"./utils-x-w2kw-v.js";import{j as te,q as ke,b as je,i as ci}from"./viewUtils-DjifXmeI.js";import{j as $,d as ui}from"./geometry2dUtils-6l12rtra.js";let U=class extends ie{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new it}};l([h({constructOnly:!0})],U.prototype,"layer",void 0),l([h()],U.prototype,"enabled",void 0),l([h()],U.prototype,"updating",void 0),l([h()],U.prototype,"availability",void 0),l([h()],U.prototype,"sublayerSources",void 0),U=l([dt("esri.views.interactive.snapping.FeatureSnappingLayerSource")],U);const re=U;let q=class extends Re{constructor(){super(...arguments),this.enabled=!0}};l([h({type:Boolean})],q.prototype,"enabled",void 0),q=l([dt("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],q);let E=class extends Re{constructor(t){super(t),this.lineSnapper=new q,this.parallelLineSnapper=new q,this.rightAngleSnapper=new q,this.rightAngleTriangleSnapper=new q,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Lt([255,127,0]),this.orangeTransparent=new Lt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};l([h({type:q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],E.prototype,"lineSnapper",void 0),l([h({type:q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],E.prototype,"parallelLineSnapper",void 0),l([h({type:q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],E.prototype,"rightAngleSnapper",void 0),l([h({type:q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],E.prototype,"rightAngleTriangleSnapper",void 0),l([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],E.prototype,"shortLineThreshold",void 0),l([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],E.prototype,"distance",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],E.prototype,"pointThreshold",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],E.prototype,"intersectionParallelLineThreshold",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],E.prototype,"parallelLineThreshold",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],E.prototype,"verticalLineThresholdMeters",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],E.prototype,"touchSensitivityMultiplier",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],E.prototype,"pointOnLineThreshold",void 0),l([h({type:Lt,nonNullable:!0})],E.prototype,"orange",void 0),l([h({type:Lt,nonNullable:!0})],E.prototype,"orangeTransparent",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],E.prototype,"lineHintWidthReference",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],E.prototype,"lineHintWidthTarget",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],E.prototype,"lineHintFadedExtensions",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],E.prototype,"parallelLineHintWidth",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],E.prototype,"parallelLineHintLength",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],E.prototype,"parallelLineHintOffset",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],E.prototype,"rightAngleHintSize",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],E.prototype,"rightAngleHintOutlineSize",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],E.prototype,"satisfiesConstraintScreenThreshold",void 0),E=l([dt("esri.views.interactive.snapping.Settings.Defaults")],E);const ht=new E;let m=class extends ie{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new it,this.distance=ht.distance,this.touchSensitivityMultiplier=ht.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var a;const e=this.featureSources;e.some(me)&&gn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(hi),n=((a=this._get("_effectiveFeatureSources"))==null?void 0:a.filter(me))??new it;for(const c of t){const u=n.find(d=>d.layer===c.layer.parent);if(u)u.sublayerSources.includes(c)||u.sublayerSources.add(c);else if(c.layer.parent){const d=new re({layer:c.layer.parent});d.sublayerSources.add(c),n.add(d)}}for(const c of n){const u=c.sublayerSources.filter(d=>!t.includes(d));c.sublayerSources.removeMany(u)}n.removeMany(n.filter(c=>c.sublayerSources.length===0));const i=e.filter(li),s=this._get("_effectiveFeatureSources")??new it,{added:r,removed:o}=yn(s.toArray(),[...i,...n]);return s.removeMany(o),s.addMany(r),s}};l([h()],m.prototype,"enabled",void 0),l([h()],m.prototype,"enabledToggled",void 0),l([h()],m.prototype,"forceDisabled",void 0),l([h()],m.prototype,"selfEnabled",void 0),l([h()],m.prototype,"featureEnabled",void 0),l([h()],m.prototype,"gridEnabled",void 0),l([h()],m.prototype,"attributeRulesEnabled",void 0),l([h({type:it.ofType(re)})],m.prototype,"featureSources",void 0),l([h()],m.prototype,"distance",void 0),l([h()],m.prototype,"touchSensitivityMultiplier",void 0),l([h({readOnly:!0})],m.prototype,"effectiveEnabled",null),l([h({readOnly:!0})],m.prototype,"effectiveGridEnabled",null),l([h({readOnly:!0})],m.prototype,"effectiveSelfEnabled",null),l([h({readOnly:!0})],m.prototype,"effectiveFeatureEnabled",null),l([h({readOnly:!0})],m.prototype,"_effectiveFeatureSources",null),m=l([dt("esri.views.interactive.snapping.SnappingOptions")],m);const He=m;function me(e){return e.layer.type==="subtype-group"}function li(e){return e.layer.type!=="subtype-group"}function hi(e){return e.layer.type==="subtype-sublayer"}function di(e,t){const n=new He({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:t==null?void 0:t.distance,touchSensitivityMultiplier:(t==null?void 0:t.touchSensitivityMultiplier)??ht.touchSensitivityMultiplier});return{...Tt(()=>{var i,s;return((s=(i=e.map)==null?void 0:i.allLayers)==null?void 0:s.toArray())??[]},i=>{n.featureSources=new it(i).map(s=>new re({layer:s}))},se),options:n}}var nt;function Ve(e,t,n){return P(e,t,n)}function P(e=0,t=0,n=0){return Nt(e,t,n)}function Ss(e){return e}function ms(e){return e}function K(e,t,n){return Nt(e,t,n)}function rt(e){const[t,n,i]=e;return e.length>3?[t,n,i,e[3]]:[t,n,i]}function Gt(e){return e[3]=((e.length>3?e[3]:void 0)??nt.NONE)|nt.TARGET,e}function ws(e){return!!(((e.length>3?e[3]:void 0)??nt.NONE)&nt.TARGET)}function we(e,t,{coordinateHelper:n,elevationInfo:i},s){return e?ut(n.vectorToDehydratedPoint(e,pi),t,i,s):null}function ut(e,t,n,i=P()){return i[0]=e.x,i[1]=e.y,i[2]=e.z??0,t==null||(t.type==="2d"?i[2]=0:i[2]=En(t,e,n,st)??0),i}function bs(e,t,n){return n?(Ae(n,e[0],e[1],e[2],t),n):pt(e[0],e[1],e[2],t)}function be(e,t,{z:n,m:i},s,r){const{spatialReference:o,elevationInfo:a}=s;let c;n==null&&i==null?c=void 0:t==null||t.type==="2d"?c=n??void 0:c=vn(t,e,o,st,a)??0;const[u,d]=e;return r?Ae(r,u,d,c,o):r=pt(u,d,c,o),i!=null&&(r.m=i,r.hasM=!0),r}function $s(e,t,n,i,s=P()){const[r,o]=e;return s[0]=r,s[1]=o,e.length>3&&(s[3]=e[3]??nt.NONE),(n==null?void 0:n.type)!=="3d"?(s[2]=t.value,s):(s[2]=_n(n,r,o,t.value,i,t.elevationInfo,st)??0,s)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(nt||(nt={}));const pi=pt(0,0,0,null);var b;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(b||(b={}));const Ls=Symbol("grid-placement-graphic");function Ge(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function Ts(e,t){return Math.sqrt(Ge(e,t))}function fi(e,t){t.sort((n,i)=>Kt(n.targetPoint,e)-Kt(i.targetPoint,e))}var M;function Ns({point:e,distance:t,returnEdge:n,vertexMode:i,coordinateHelper:{spatialReference:s},filter:r},o,a){return a=a!=null?a.clone():new Sn({where:"1=1"}),r&&(a.geometry=r.geometry,a.distance=r.distance,a.spatialRelationship=r.spatialRelationship,a.where=mn(a.where,r.where),a.timeExtent=wn(a.timeExtent,r.timeExtent),a.objectIds=gi(a.objectIds,r.objectIds)),{point:pt(e[0],e[1],e[2],s.toJSON()),mode:o,distance:t,returnEdge:n,vertexMode:i,query:a.toJSON()}}function gi(e,t){return e||t?t?e?Array.from(bn(new Set(e),new Set(t))):t:e:null}function xs(e,t,n){return{left:we(e.leftVertex.pos,t,n),right:we(e.rightVertex.pos,t,n)}}function Ps(e){return e.createQuery()}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(M||(M={}));const $e=Symbol("snapping-toggle");function Rs(e,t=()=>{}){const n=Tt(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:i,snappingOptions:s})=>{if(e.removeHandles($e),!i||!s)return;const r=$n.TOOL,o=[i.on("key-down",a=>{a.key!==Se.toggle||a.repeat||(s.enabledToggled=!0,t())},r),i.on("key-up",a=>{a.key===Se.toggle&&(s.enabledToggled=!1,t())},r),i.on("pointer-move",a=>{const c=a.native.ctrlKey;s.enabledToggled!==c&&(s.enabledToggled=c,t())},r)];e.addHandles(o,$e)},se);e.addHandles(n)}function As(e){var t;return oi(e)&&"utilityNetworks"in e&&!!((t=e.utilityNetworks)!=null&&t.length)}function ae({start:e,end:t,type:n},i,s){const r=[],o=tt(ft,t,e),a=tt(Dt,e,i),c=xt(o),u=2*Ot(o,a),d=u*u-4*c*(xt(a)-s*s);if(d===0){const p=-u/(2*c);(n===x.PLANE||p>=0)&&r.push(mt(J(),e,o,p))}else if(d>0){const p=Math.sqrt(d),v=(-u+p)/(2*c);(n===x.PLANE||v>=0)&&r.push(mt(J(),e,o,v));const g=(-u-p)/(2*c);(n===x.PLANE||g>=0)&&r.push(mt(J(),e,o,g))}return r}function Ze(e,t){const n=e.start,i=e.end,s=tt(ft,i,n),r=et(It,-s[1],s[0],0),o=t.start,a=t.end,c=N(ce,a,o),u=T(c,r),d=et(Je,n[0],n[1],0),p=N(tn,d,o),v=T(p,r),g=lt();if(Math.abs(u)<g)return[];const S=w(en,o,c,v/u);if(t.type===$.RAY){const L=N(ee,S,o);if(T(L,c)<-g)return[]}if(e.type===x.HALF_PLANE){const L=Nn(Dt,S,n);if(Ot(L,s)<-g)return[]}return[Y(S)]}function yi(e,t){return vi(Rt(ue,t[2],e),t)}function We(e,t){return Ke(Rt(ue,0,e),Rt(wi,0,t)).map(([i,s])=>wt(i,s))}function Ue(e,t,n){return Xe(e,Rt(ue,e[2],t),n)}function Be(e,t,n,i=f()){const s=tt(ft,e,t),r=xn(s);return mt(i,t,s,r===0?1:n/r),i[2]=e[2],i}function Xe(e,{start:t,end:n,type:i},s=f()){const r=N(Ft,e,t),o=N(It,n,t),a=T(r,o)/T(o,o);return w(s,t,o,i===$.RAY?Math.max(a,0):a)}const Ei=(()=>{const e=f(),t=f(),n=f();return({start:i,end:s},{center:r,radius:o,normal:a,slicePlane:c})=>{const u=qt(r,a,mi);if(y(Qt(u,i),0)&&y(Qt(u,s),0)){Me(a,e,t);const p=(S,L)=>(zt(n,L,r),ze(S,T(n,e),T(n,t)),S),v=ui({start:p(ft,i),end:p(Dt,s),type:$.LINE},Rn,o),g=[];for(const[S,L]of v){const R=Ce(f(),r);w(R,R,e,S),w(R,R,t,L),c&&!X(c,R)||g.push(R)}return g}const d=f();return Oe(u,i,s,d)?!y(qe(d,r),o)||c&&!X(c,d)?[]:[d]:[]}})();function Ye({start:e,end:t,type:n},i,s){const r=[],o=zt(Ft,t,e),a=tt(Dt,e,i),c=xt(o),u=2*Ot(o,a),d=u*u-4*c*(xt(a)-s*s);if(d===0){const p=-u/(2*c);(n===$.LINE||p>=0)&&r.push(w(f(),e,o,p))}else if(d>0){const p=Math.sqrt(d),v=(-u+p)/(2*c);(n===$.LINE||v>=0)&&r.push(w(f(),e,o,v));const g=(-u-p)/(2*c);(n===$.LINE||g>=0)&&r.push(w(f(),e,o,g))}return r}function Ke(e,t){const n=e.start,i=e.end,s=t.start,r=t.end,o=N(Ft,i,n),a=N(It,r,s),c=N(ce,s,n),u=Pt(Je,o,a);if(!y(T(c,u),0))return[];const d=Jt(u);if(y(d,0))return[];const p=Pt(tn,c,a),v=T(p,u)/d,g=w(en,n,o,v);if(e.type===$.RAY){const S=N(ee,g,n);if(T(o,S)<-lt())return[]}if(t.type===$.RAY){const S=N(ee,g,s);if(T(a,S)<-lt())return[]}return[Y(g)]}function vi({start:e,end:t,type:n},i){const s=N(Ft,i,e),r=N(It,t,e),o=Pt(ce,r,s),a=Jt(o)/Jt(r),c=lt();if(a<c)switch(n){case $.LINE:return[Y(i)];case $.RAY:return T(r,s)<-c?[]:[Y(i)]}return[]}function oe(e,t,n,i){const[s,r]=e,[o,a]=n,c=o-s,u=a-r,d=c*c+u*u,p=Math.sqrt(d);if(p>t+i)return[];if(p<Math.abs(t-i))return[];if(y(p,0)&&y(t,i))return[];const v=(t*t-i*i+d)/(2*p),g=Math.sqrt(t*t-v*v),S=g*u/p,L=g*c/p,[R,Q]=Pn(ft,e,n,v/p);return y(S,L)?[wt(R,Q)]:[wt(R+S,Q-L),wt(R-S,Q+L)]}function Rt(e,t,{start:n,end:i,type:s}){return et(e.start,n[0],n[1],t),et(e.end,i[0],i[1],t),e.type=Si[s],e}function Qe(e,t){return y(e[2],t[2])}function y(e,t){return Ln(Math.abs(e-t),0,lt())}function _i(e,t){return t.filter(n=>X(e,n))}function X(e,t){return Tn(e,t)}var x;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})(x||(x={}));const Si={[x.PLANE]:$.LINE,[x.HALF_PLANE]:$.RAY},ft=J(),Dt=J(),Ft=f(),It=f(),ce=f(),Je=f(),tn=f(),en=f(),ee=f(),mi=A(),ue={start:f(),end:f(),type:$.LINE},wi={start:f(),end:f(),type:$.LINE};class C{intersect(t){return H(this,t)}closestPoints(t){return[this.closestTo(t)]}}class at extends C{constructor(t){super(),this.point=t}equals(t){return this===t||O(t)&&_(this.point,t.point)}closestTo(){return rt(this.point)}}class le extends C{constructor(t,n,i){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:i}}equals(t){return this===t||F(t)&&this.lineLike.type===t.lineLike.type&&_(this.start,t.start)&&_(this.end,t.end)}closestTo(t){const n=P();return Xe(t,this.lineLike,n),n}}class he extends le{constructor(t,n){super(t,n,$.LINE)}}class bi extends le{constructor(t,n){super(t,n,$.RAY)}}class nn extends C{constructor(t){super(),this.constraints=t}equals(t){return this===t||ne(t)&&Cn(this.constraints,t.constraints,(n,i)=>n.equals(i))}closestTo(t){let n,i=1/0;for(const s of this.constraints){const r=s.closestTo(t),o=Kt(t,r);o<i&&(i=o,n=r)}return rt(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class sn extends C{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||k(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=P();return Be(t,this.center,this.radius,n),n}}class de extends C{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||G(t)&&_(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=P();return Be(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new pe(rt(this.center),this.radius,K(0,0,1))}}class pe extends C{constructor(t,n,i,s=void 0){super(),this.center=t,this.radius=n,this.normal=i,this.slicePlane=s}equals(t){return this===t||B(t)&&_(this.center,t.center)&&_(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:i}=this;De(this.getPlane($i),t,Zt);const s=N(Zt,Zt,n),r=On(s);if(y(r,0))return rt(t);const o=i/Math.sqrt(r),a=P();w(a,n,s,o);const{slicePlane:c}=this;if(c&&!X(c,a)){const u=ge(c,this);return(u==null?void 0:u.closestTo(t))??rt(t)}return a}getPlane(t=A()){return qt(this.center,this.normal,t)}}const Zt=f(),$i=A();class Li extends C{constructor(t){super(),this.z=t}equals(t){return this===t||V(t)&&this.z===t.z}closestTo(t){return K(t[0],t[1],this.z)}getPlane(t=A()){return et(Le,0,0,this.z),qt(Le,Vn,t)}}const Le=f();class fe extends C{constructor(t,n,i){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:i}}equals(t){return this===t||I(t)&&this.planeLike.type===t.planeLike.type&&_(this.start,t.start)&&_(this.end,t.end)}closestTo(t){const n=P();return Ue(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:i}=this.planeLike;return Math.sign(Ot(tt(Ti,i,n),tt(Ni,t,n)))>0?this.end:this.start}getPlane(t=A()){const n=Ce(Te,this.end);return n[2]+=1,Fn(this.start,this.end,n,t)}getSlicePlane(t=A()){const{start:n,end:i,type:s}=this.planeLike;if(s===x.PLANE)return;const r=et(Te,n[0],n[1],0),o=et(Ne,i[0],i[1],0),a=zt(Ne,o,r);return qt(r,a,t),t}}const Ti=J(),Ni=J(),Te=f(),Ne=f();class Ms extends fe{constructor(t,n){super(t,n,x.HALF_PLANE)}}class rn extends fe{constructor(t,n){super(t,n,x.PLANE)}}class xi extends C{constructor(t,n){super(),this.sphere=Gn(t,n)}equals(t){return this===t||Z(t)&&Zn(this.sphere,t.sphere)}closestTo(t){const n=P();return Wn(this.sphere,t,n),n}get center(){return Un(this.sphere)}get radius(){return this.sphere[3]}}class an extends C{constructor(t,n,i){super(),this.start=t,this.end=n,this.getZ=i,this.planeLike={start:t,end:n,type:x.PLANE}}equals(t){return this===t||At(t)&&_(this.start,t.start)&&_(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Oi(this,t)}addIfOnTheGround(t,n){for(const i of n){const s=this.getZ(i[0],i[1])??0;y(i[2],s)&&(i[2]=s,t.push(i))}}}class Pi extends C{constructor(t,n,i){super(),this._x=t,this._y=n,this._z=i}equals(t){return this===t||Yi(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,i]){return Ve(this._x??t,this._y??n,this._z??i)}}class Ri extends C{constructor(t,n,i,s,r){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=i,this._z=s,this._directionDegrees=r}equals(t){return this===t||Xi(t)&&ve(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,i]){return ze(ct,t,n),ve(ct,this._origin)||this._applyDirectionAndDistance(ct),Ve(ct[0],ct[1],this._z??i)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)te(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Mi(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=ke(Ai,this._origin,t,this._spatialReference);te(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const ct=[0,0],Ai=new je;function Mi(e,t,n,i,s){let{azimuth:r,distance:o}=ke(Ci,t,i,s);r??(r=0);let a=o*Math.cos((r-n)*Bn);a=Math.max(0,a),te(e,t,n,a,s)}const Ci=new je;function Oi(e,t){const n=P();return Ue(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??cn,n}function H(e,t){if(ne(e)){const n=[];for(const i of e.constraints){const s=i.intersect(t);s&&n.push(s)}return ye(n)}if(ne(t))return H(t,e);if(At(e))return xe(e,t);if(At(t))return xe(t,e);if(O(e)){const{point:n}=e;if(O(t))return _(n,t.point)?e:void 0;const i=t.closestTo(n);return In(i,n)?e:void 0}if(F(e)){if(O(t))return H(t,e);if(F(t))return z(Ke(e.lineLike,t.lineLike));if(V(t))return qi(e,t);if(I(t))return z(Ze(t.planeLike,e.lineLike));if(k(t))return z(Ye(e.lineLike,t.center,t.radius));if(B(t))return z(Ei(e.lineLike,t));if(G(t))return zi(e,t);if(Z(t))return Di(e,t)}else if(V(e)){if(O(t)||F(t))return H(t,e);if(V(t))return Fi(e,t);if(I(t))return Ii(e,t);if(k(t))return ki(e,t);if(B(t))return Hi(e,t);if(G(t))return ji(e,t);if(Z(t))return Vi(e,t)}else if(I(e)){if(O(t)||F(t)||V(t))return H(t,e);if(I(t))return Wt(We(e.planeLike,t.planeLike));if(k(t))return Wt(ae(e.planeLike,t.center,t.radius));if(B(t))return Zi(e,t);if(G(t))return Gi(e,t);if(Z(t))return Wi(e,t)}else if(k(e)){if(O(t)||F(t)||V(t)||I(t))return H(t,e);if(k(t))return Wt(oe(e.center,e.radius,t.center,t.radius));if(B(t))return void 0;if(G(t))return Ui(e,t);if(Z(t))return void 0}else if(B(e)){if(O(t)||F(t)||V(t)||I(t)||k(t))return H(t,e);if(B(t))return void 0;if(G(t))return t.asCircle(),void 0;if(Z(t))return void 0}else if(G(e)){if(O(t)||F(t)||V(t)||I(t)||k(t)||B(t))return H(t,e);if(G(t))return Bi(t,e);if(Z(t))return void 0}else if(Z(e)){if(O(t)||F(t)||V(t)||I(t)||k(t)||G(t))return H(t,e);if(Z(t))return void 0}}const qi=(()=>{const e=A();return(t,n)=>{const{start:i,end:s}=t;if(Qe(i,s)&&y(i[2],n.z))return t;const r=P();return Oe(n.getPlane(e),i,s,r)?new at(r):void 0}})();function zi({lineLike:e},{center:t,radius:n}){const i=t[2];return z(Ye(e,t,n).filter(s=>y(s[2],i)))}function Di({lineLike:e},{sphere:t}){return z(kn(t,e.start,e.end))}const ge=(()=>{const e=jn(),t=f(),n=f();return(i,s,r)=>{const{normal:o,center:a,radius:c}=s;Me(o,t,n);const u=Fe(i),d=c*T(u,t),p=c*T(u,n);qn(e,a[0],a[1],a[2],1);const v=zn(i,e),g=Math.hypot(d,p),S=y(g,0);if(y(Qt(i,a),0)){if(S)return s;if(y(c,0))return!r||X(r,a)?new at(rt(a)):void 0;Pt(t,u,o),Dn(t,t);const jt=new Array,vt=Y(a);w(vt,vt,t,c),r&&!X(r,vt)||jt.push(vt);const _t=Y(a);return w(_t,_t,t,-c),r&&!X(r,_t)||jt.push(_t),z(jt)}if(S)return;const L=-v/g;if(Math.abs(L)>1||y(L,1))return;const R=Math.atan(d/p),Q=Hn(L)-R,Ee=Math.PI-Q,gt=new Array,yt=f();w(yt,a,t,c*Math.cos(Q)),w(yt,yt,n,c*Math.sin(Q)),gt.push(yt);const Et=f();return w(Et,a,t,c*Math.cos(Ee)),w(Et,Et,n,c*Math.sin(Ee)),gt.push(Et),z(r?_i(r,gt):gt)}})();function Fi(e,t){return y(e.z,t.z)?e:void 0}function Ii({z:e},{planeLike:t}){const[n,i]=t.start,[s,r]=t.end,o=K(n,i,e),a=K(s,r,e);return t.type===x.PLANE?new he(o,a):new bi(o,a)}function ki(e,t){const[n,i]=t.center;return new de(K(n,i,e.z),t.radius)}function ji(e,t){return y(t.center[2],e.z)?t:void 0}const Hi=(()=>{const e=A();return(t,n)=>ge(t.getPlane(e),n,n.slicePlane)})();function Vi(e,{center:t,radius:n}){const i=Math.abs(t[2]-e.z);if(i>n&&!y(i,n))return;const s=K(t[0],t[1],e.z),r=Math.sqrt(n**2-i**2);return y(r,0)?void 0:new de(s,r)}const Gi=(()=>{const e=A();return(t,{center:n,radius:i})=>{const s=ae(t.planeLike,n,i),r=n[2];t.getSlicePlane(e);const o=new Array;for(const[a,c]of s){const u=[a,c,r];X(e,u)&&o.push(u)}return z(o)}})(),Zi=(()=>{const e=A(),t=A();return(n,i)=>ge(n.getPlane(e),i,n.getSlicePlane(t))})(),Wi=(()=>{const e=A();return(t,{center:n,radius:i})=>{const s=t.getPlane(e),r=An(s,n),o=Math.abs(r);if(o>i&&!y(o,i))return;const a=Math.sqrt(i**2-r**2);if(y(a,0)){const d=P();return De(s,n,d),new at(d)}const c=P(),u=Y(Fe(s));return w(c,n,u,r),new pe(c,a,u,t.getSlicePlane())}})();function Ui(e,t){const n=Ie(e.center,t.center);return y(n,0)&&y(e.radius,t.radius)?t:on(oe(e.center,e.radius,t.center,t.radius),t.center[2])}function Bi(e,t){if(!Qe(e.center,t.center))return;const n=Ie(e.center,t.center);return y(n,0)&&y(e.radius,t.radius)?e:on(oe(e.center,e.radius,t.center,t.radius),e.center[2])}function xe(e,t){const{planeLike:n,getZ:i}=e,s=new Array;if(O(t))e.addIfOnTheGround(s,yi(n,t.point));else if(F(t))e.addIfOnTheGround(s,Ze(n,t.lineLike));else if(k(t))for(const[r,o]of ae(n,t.center,t.radius)){const a=i(r,o);a!=null&&s.push(Nt(r,o,a))}else if(I(t)||At(t))for(const[r,o]of We(n,t.planeLike)){const a=i(r,o)??cn;s.push(Nt(r,o,a))}return z(s)}function Wt(e){return ye(e.map(([t,n])=>{const i=K(t,n,0),s=K(t,n,1);return new he(i,s)}))}function z(e){return ye(e.map(t=>t?new at(t):void 0))}function on(e,t){return z(e.map(([n,i])=>[n,i,t]))}function ye(e){if(e.length!==0)return e.length===1?e[0]??void 0:new nn(e.filter(Mn))}function ne(e){return e instanceof nn}function O(e){return e instanceof at}function F(e){return e instanceof le}function V(e){return e instanceof Li}function I(e){return e instanceof fe}function k(e){return e instanceof sn}function G(e){return e instanceof de}function B(e){return e instanceof pe}function Z(e){return e instanceof xi}function At(e){return e instanceof an}function Xi(e){return e instanceof Ri}function Yi(e){return e instanceof Pi}const cn=0;let ot=class{constructor(t,n,i,s){this.targetPoint=t,this.constraint=n,this.isDraped=i,this.domain=s}},un=class extends ot{constructor({targetPoint:t,objectId:n,constraint:i,isDraped:s}){super(t,i,s,b.FEATURE),this.objectId=n}},kt=class{constructor(t,n){this.isDraped=t,this.domain=n}},j=class ln extends kt{constructor(t,n,i,s,r=b.ALL,o=!0,a=!0){super(s,r),this.type=t,this.lineStart=n,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(t){return t instanceof ln&&this.type===t.type&&_(this.lineStart,t.lineStart)&&_(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return qe(this.lineStart,this.lineEnd)}},Ki=class extends un{constructor(t){super({...t,isDraped:!0,constraint:new an(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new j(M.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Qi=class extends un{constructor(t){super({...t,constraint:new he(t.edgeStart,t.edgeEnd)})}get hints(){return[new j(M.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Ji=class hn extends kt{constructor(t,n,i=b.ALL){super(n,i),this.intersectionPoint=t}equals(t){return t instanceof hn&&_(this.intersectionPoint,t.intersectionPoint)}},bt=class extends ot{constructor(t,n,i,s){super(t,new at(t),s,b.ALL),this.first=n,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Ji(this.targetPoint,this.isDraped,this.domain)]}};class ts extends ot{constructor({lineStart:t,lineEnd:n,targetPoint:i,isDraped:s}){super(i,new rn(t,n),s,b.SELF),this._referenceLineHint=new j(M.REFERENCE_EXTENSION,t,n,s,this.domain)}get hints(){return[this._referenceLineHint,new j(M.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}let es=class dn extends kt{constructor(t,n,i,s=b.ALL){super(i,s),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof dn&&_(this.lineStart,t.lineStart)&&_(this.lineEnd,t.lineEnd)}},ns=class extends ot{constructor({referenceLine:t,lineStart:n,targetPoint:i,isDraped:s}){const r=Y(n),{left:o,right:a}=t;zt(r,Xn(r,r,a),o),super(i,new rn(n,r),s,b.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new j(M.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new es(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new j(M.REFERENCE,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const n={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{_(t.right,i.edge.left)&&(i.fadeLeft=!1,n.fadeRight=!1),_(t.right,i.edge.right)&&(i.fadeRight=!1,n.fadeRight=!1),_(t.left,i.edge.right)&&(i.fadeRight=!1,n.fadeLeft=!1),_(t.left,i.edge.left)&&(i.fadeLeft=!1,n.fadeLeft=!1)}),this._referenceLines.push(n)}},pn=class fn extends kt{constructor(t,n,i,s,r=b.ALL){super(s,r),this.previousVertex=t,this.centerVertex=n,this.nextVertex=i}equals(t){return t instanceof fn&&_(this.previousVertex,t.previousVertex)&&_(this.centerVertex,t.centerVertex)&&_(this.nextVertex,t.nextVertex)}},is=class extends ot{constructor({targetPoint:t,constraint:n,previousVertex:i,otherVertex:s,otherVertexType:r,isDraped:o,selfSnappingType:a,objectId:c,domain:u}){super(t,n,o,u??b.SELF),this.previousVertex=i,this.otherVertex=s,this.otherVertexType=r,this.selfSnappingType=a??Ct.None,this.objectId=c??null}get hints(){const t=this.previousVertex,n=this.otherVertexType===Mt.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===Mt.CENTER?this.targetPoint:this.otherVertex;return[new j(M.TARGET,n,i,this.isDraped,this.domain),new j(M.REFERENCE,t,n,this.isDraped,this.domain),new pn(this.previousVertex,n,i,this.isDraped,this.domain)]}};var Mt,Ct;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(Mt||(Mt={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(Ct||(Ct={}));class ss extends ot{constructor({targetPoint:t,point1:n,point2:i,isDraped:s}){super(t,new sn(Yn(f(),n,i,.5),.5*Kn(n,i)),s,b.SELF),this._p1=n,this._p2=i}get hints(){return[new j(M.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new j(M.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new pn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}function rs(e,t,n,i){return i.type==="2d"?(St.x=e[0],St.y=e[1],St.spatialReference=t,i.toScreen(St)):(ci(e,t,n,i,Pe),i.state.camera.projectToScreen(Pe,Ut),Qn(Ut[0],Ut[1]))}const St=pt(0,0,0,null),Pe=f(),Ut=Jn();let D=class extends ti.EventedMixin(ie){constructor(e){super(e),this.options=new He,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=W.MAIN}initialize(){this.addHandles([Tt(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:i,effectiveGridEnabled:s}=this.options;return{selfEnabled:n,featureEnabled:i,gridEnabled:this.view.type==="2d"&&s,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{var n;t&&(this.doneSnapping(),this.emit("changed")),(n=this._loadTask)==null||n.abort(),this._loadTask=ei(i=>this._updateEngines(e,t,i))},se),Tt(()=>this.options,e=>{for(const t of this._engines)t.options=e},ni)])}destroy(){this._destroyEngines()}get updating(){var e;return this._engines.some(t=>t.updating)||!((e=this._loadTask)!=null&&e.finished)}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();(t==null?void 0:t.viewSpatialReference)!==e.viewSpatialReference&&this._destroyEngines();const{_engineCache:i}=this,s=[];e.featureEnabled&&!i.has("feature")&&s.push(this._setupFeatureSnappingEngine(n)),e.selfEnabled&&!i.has("self")&&s.push(this._setupSelfSnappingEngine(n)),e.gridEnabled&&!i.has("grid")&&this.view.type==="2d"&&s.push(this._setupGridSnappingEngine(n)),await Promise.allSettled(s),n.aborted||(this._engines=Array.from(i.values()))}async _setupSelfSnappingEngine(e){const{SelfSnappingEngine:t}=await Ht(()=>import("./SelfSnappingEngine-CxHNdf5p.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]));Vt(e);const n=new t({view:this.view,options:this.options});this._engineCache.set("self",n)}async _setupGridSnappingEngine(e){const{view:t}=this,{GridSnappingEngine:n}=await Ht(async()=>{const{GridSnappingEngine:i}=await import("./GridSnappingEngine-8l4vUyNW.js");return{GridSnappingEngine:i}},__vite__mapDeps([12,1,13,14,3,10,11,9]));if(Vt(e),t.type==="2d"){const i=new n({view:t,options:this.options});this._engineCache.set("grid",i)}}async _setupFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await Ht(()=>import("./FeatureSnappingEngine-RqkjAdUb.js"),__vite__mapDeps([15,1,16,10,11,3,9]));Vt(e);const{view:n,options:i,_engineCache:s}=this,r=new t({view:n,options:i,spatialReference:n.spatialReference});s.set("feature",r)}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return cs(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const s=this._selectUpdateInput(e);if(s==null)return t;const{spatialReference:r}=n,o=_e(s,r);if(o==null)return t;const{view:a}=this,{elevationInfo:c,visualizer:u}=n,d=[],p=ut(o,a,c),v=i.constraint.closestTo(p);if(!this._arePointsWithinScreenThreshold(p,v,n)||!Xt(i,n.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=Gt(v),d.push(...i.hints);for(const g of this._currentOtherActiveCandidates)Xt(g,n.drawConstraints)&&(g.targetPoint=Gt(v),d.push(...g.hints));return u!=null&&this.addHandles(u.draw(d,{spatialReference:r,elevationInfo:us(n),view:a,selfSnappingZ:n.selfSnappingZ}),Bt),be(v,a,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case W.MAIN:return e;case W.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=W.MAIN}_removeVisualization(){this.removeHandles(Bt)}async _snapSinglePoint({point:e,context:t,signal:n}){const{view:i}=this,{elevationInfo:s}=t,r=ut(e,i,s),o=await this._fetchCandidates(r,b.ALL,t,n);return this._createSnapResult(r,W.MAIN,o,i,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:i}){const{view:s}=this,{coordinateHelper:r,elevationInfo:o,spatialReference:a}=n;await ii(t.spatialReference,a);const c=_e(t,a),u=ut(c,s,o),d=await this._fetchCandidates(u,b.FEATURE,n,i);if(d.length>0){const g=await this._fetchCandidates(u,b.SELF,n,i);return this._createSnapResult(u,W.SCENE,[...d,...g],s,c,n,i)}const p=ut(e,s,o),v=await this._fetchCandidates(p,b.SELF,n,i);return this._createSnapResult(p,W.MAIN,v,s,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0},n,i)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map(s=>s.fetchCandidates(e,t,n,i)))).flat()}_createSnapResult(e,t,n,i,s,r,o){return{get valid(){return!si(o)},apply:()=>{const{spatialReference:a}=r,{snappedPoint:c,hints:u}=this._processCandidates(e,t,n,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(u,{spatialReference:a,elevationInfo:st,view:i,selfSnappingZ:r.selfSnappingZ}),Bt),be(c,i,s,r)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),fi(e,n);const s=this._currentMainCandidate;if(s!=null){const r=os(s,n);if(r>=0){if(!(n[r]instanceof bt))return this._intersectWithOtherCandidates(r,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,s.targetPoint,i))return this._updateSnappingCandidate(s,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_intersectWithOtherCandidates(e,t,n,i,s){const{coordinateHelper:r}=s,o=t[e],a=[];for(let c=0;c<t.length;++c){if(c===e)continue;const u=t[c],d=o.constraint.intersect(u.constraint);if(d)for(const p of d.closestPoints(o.targetPoint))a.push([new bt(Gt(p),o,u,u.isDraped),this._squaredScreenDistance(n,p,r)])}return a.length>0&&(a.sort((c,u)=>c[1]-u[1]),a[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(a[0][0],i,t,s):Xt(o,s.drawConstraints)?this._updateSnappingCandidate(o,i,t,s):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const s=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const o of n){if(e instanceof bt){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const a=o.constraint.closestTo(s);this._squaredScreenDistance(a,s,i.coordinateHelper)<as()&&(o.targetPoint=s,this._currentOtherActiveCandidates.push(o),r.push(...o.hints))}return{snappedPoint:s,hints:r}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return Ge(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return rs(e,t.spatialReference,st,this.view)}get test(){}};var W;l([h({constructOnly:!0})],D.prototype,"view",void 0),l([h()],D.prototype,"options",void 0),l([h({readOnly:!0})],D.prototype,"updating",null),l([h()],D.prototype,"_loadTask",void 0),l([h()],D.prototype,"_engines",void 0),l([h()],D.prototype,"_squaredMouseProximityThreshold",null),l([h()],D.prototype,"_squaredTouchProximityThreshold",null),D=l([dt("esri.views.interactive.snapping.SnappingManager")],D),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(W||(W={}));const Bt="visualization-handle";function as(){return ht.satisfiesConstraintScreenThreshold*ht.satisfiesConstraintScreenThreshold}function Xt(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Ki||e instanceof Qi||e instanceof ts||e instanceof ns||e instanceof ss)&&(!(e instanceof is)||t.direction==null&&e.selfSnappingType===Ct.LastVertex)}function os(e,t){return e instanceof bt?Yt(t,e.first)>=0&&Yt(t,e.second)>=0?0:-1:Yt(t,e)}function Yt(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}function cs(e){return e.scenePoint!=null}function us({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?st:t}const $t=new Map;function js(e){if(!$t.has(e)){const i=di(e,{distance:10}),s=hs(e,i.options);$t.set(e,{referenceCount:0,snappingManager:s,remove:()=>{i.remove(),s.destroy()}})}const t=$t.get(e);t.referenceCount++;const n=ri(()=>ls(e,t));return{snappingManager:t.snappingManager,...n}}function ls(e,t){t.referenceCount--,t.referenceCount>0||ai(()=>{t.referenceCount===0&&(t.remove(),$t.delete(e))})}function hs(e,t){return new D({view:e,options:t})}export{ns as A,Ct as B,ss as C,Ji as D,fi as E,j as F,es as G,pn as H,ws as I,Xe as J,$s as K,M as L,Rs as M,we as N,ut as O,be as P,sn as Q,Ps as R,ye as S,bs as T,Li as U,Ri as V,O as W,Pi as Z,Qi as a,b,ms as c,K as d,is as e,Ms as f,at as g,Ns as h,rs as i,Ts as j,Ve as k,ts as l,Ls as m,un as n,Mt as o,Gt as p,bt as q,Ki as r,kt as s,P as t,Ss as u,As as v,js as w,ht as x,Ge as y,xs as z};
