const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-button-C-acS1g1.js","assets/index-o1YlnJfN.js","assets/index-C7r0H98r.css","assets/form-Dmo1hfiJ.js","assets/dom-BZzhahQO.js","assets/interactive-CFXJMU-A.js","assets/label-CnlL2w0f.js","assets/component-6CIDVndn.js","assets/loadable-BuBczDUZ.js","assets/locale-aIJBfHhH.js","assets/key-D63ExP77.js","assets/observers-DYdZMNHn.js","assets/t9n-AaPRuAtu.js","assets/icon-BVMeTiwl.js","assets/loader-gqzs62k8.js","assets/guid-BxSjQh8J.js","assets/calcite-icon-DWzzk24x.js","assets/calcite-input-C0dWkuR1.js","assets/input2-BiWGMw3U.js","assets/calcite-dropdown-BiVDwnxJ.js","assets/floating-ui-NC37ETUD.js","assets/debounce-BOqmhDXu.js","assets/openCloseComponent-BWirDFtU.js","assets/calcite-dropdown-item-U5WmB6mo.js","assets/resources3-Qm0M2nV8.js","assets/calcite-dropdown-group-BrcJWhGN.js"])))=>i.map(i=>d[i]);
import{r,m as c,a as b,b as q,E as x,b6 as ki,rS as vl,ab as Z,$ as ml,ph as _l,q8 as yl,vg as bl,hM as Ba,jR as ho,db as Zt,is as Ya,cC as vn,oD as Ml,cw as rn,Q as mn,rT as xl,dY as R,q0 as uo,vh as Xa,hI as En,e6 as si,cz as Bo,it as wl,jT as Wa,dn as Re,bH as O,N as ut,d$ as ge,b5 as dt,bm as ws,dF as Oe,dI as Un,dJ as Ss,dK as Sl,cO as fe,dz as Tt,dy as jt,dL as Os,dM as Ol,ba as $l,d7 as El,fe as Tl,vi as Il,ih as Tn,hn as Yo,jv as kl,V as go,h as ai,aY as $s,vj as Rl,vk as Cl,vl as Al,as as It,av as ri,cX as Es,e as Gn,cY as Dl,vm as Qe,v as ln,gC as Pl,nQ as Vl,vn as jl,gN as Ll,gO as Hl,vo as zl,d8 as Ul,bV as Ts,hH as Fn,dx as _n,dt as B,cN as qa,cM as Ie,vp as Gl,vq as Fl,fh as Is,cb as li,au as Nl,at as Ka,vr as Qa,bj as fo,bF as Zl,f6 as Ja,kK as le,vs as Bl,cV as yn,qc as tr,q5 as Yl,cK as Xt,dr as bn,o7 as er,oC as ci,to as ir,iD as Ce,o6 as Xl,gG as pi,on as Ui,op as y,aF as Gi,o9 as Ae,vt as Wt,gH as nr,om as vo,ov as Ri,v5 as wt,uV as Wl,oo as Xo,_ as Pt,np as ks,i as ql,u_ as Kl,iO as Ql,ve as or,vu as Jl,vv as tc,vw as ec,vx as ic,vy as Rs,uU as nc,u as V,P as N,vz as oc,A as Je,F as qt,vA as Cs,ns as Wo,dQ as sc,tx as sr,h_ as qo,bM as Xe,k7 as ac,ct as et,i5 as Nn,cl as rc,hA as Zn,vB as ti,bz as lc,vC as U,vD as Ko,iw as cc,vE as pc,vF as hc,gp as uc,vG as mo,L as dc,vH as ar,d6 as rr,e8 as gc,a8 as fc,gU as As,qd as Qo,pl as vc,dm as lr,vI as Ds,qk as lt,rt as Jo,p2 as mc,aU as _c,vJ as ts,jQ as he,vK as cr,c8 as Mn,ca as yc,vL as pr,cJ as bc,vM as Mc,i7 as hr,vN as ur,vO as xc,vP as es,du as hi,dv as dr,ds as is,nE as gr,vQ as wc,dp as Sc,kJ as Ps,iA as Oc,e1 as pe,qa as Ft,kH as $c,iE as ie,qe as _o,qg as F,bK as Ci,i0 as Ec,dq as ei,pj as Yi,gT as Tc,qb as Vs,bN as Ic,bO as kc,g2 as Pi,j8 as Rc,nz as Cc,nA as We,nB as Ac,i3 as Dc,d_ as Pc,oW as js,qf as Vc,ki as jc,q9 as Lc,oA as Hc,iv as Ls,vR as zc,bT as Uc,jS as Gc,nZ as Hs,vS as zs,vT as Fc,ql as Nc,nv as fr,dl as vr,nu as Vi,vU as Fi,mh as Us,dX as Gs,sV as Fs,nq as qe,dj as vi,cA as Ns,vV as Zc,vW as Bc,cv as Yc,vX as Zs,c2 as Ke,vY as Xc,vZ as Wc,dh as Bs,J as qc,cU as Kc,dW as Qc}from"./index-o1YlnJfN.js";import{i as Jc,j as mr,N as _r,q as tp,b as ep}from"./viewUtils-BbcSFc7e.js";import{e as yo,b as bo,x as ip,k as np,C as op,F as sp,S as ap,U as In,R as yr,j as rp,y as br,c as lp}from"./TextOverlayItem-CTDTQCmf.js";import{u as Me,c as ns,m as de,p as cp,e as ii,f as ji,R as Li,d as Ys}from"./SnappingOperation-Cw4yJxqD.js";import{a as Mo,l as pp,p as hp}from"./interfaces-DLeaxr62.js";import{j as ui,A as Q,t as up,n as dp,c as tt,u as $e,a as gp,b as Mr,o as fp,q as vp,f as Xs,i as Bn,m as Ws,k as qs,I as mi,d as mp,p as Ks,g as Qs,e as Js,l as De,h as ta,r as _p,x as yp,P as Yn,s as bp,v as Mp,w as xp,y as wp,z as Sp}from"./MoveManipulation-DtT2XF-m.js";import{G as os}from"./ExtendedLineVisualElement-C7iLXjTk.js";import{t as Op}from"./EngineVisualElement-BiFgR5JV.js";import{c as xn,S as $p}from"./LaserlinePath.glsl-CPq3K6Fj.js";import{b as ea}from"./line-2xVGcemG.js";import{a as cn,i as Xn}from"./dehydratedFeatureComparison-B1buwPsI.js";import{simplify as Ep,distance as Tp}from"./geometryEngine-DDEPHPB7.js";import{u as Ip}from"./mat2d-BwXx68lC.js";import{e as ia,r as kp}from"./MediaLayerView3D-C3gdZ7BU.js";import{O as ss,t as di,P as Rp,Z as xr,Q as Cp,S as wr,U as Ap,f as Dp,V as Pp,g as Vp,W as jp,M as Lp}from"./SnappingManagerPool-Comfi8yE.js";import{T as Kt,j as ct,M as Hp,R as Sr,U as zp,A as na,w as oa,x as Up}from"./angularMeasurementUtils-BJoLrlld.js";import{N as Gp}from"./MeshTransform-CytCReOQ.js";import{f as Ee,p as Fp}from"./keybindings-C4V5IYGf.js";import{t as xo}from"./memoize-DsJmrG76.js";import{e as Np}from"./geodesicLengthMeasurementUtils-CEhKaQsP.js";import{k as Or,o as Zp,j as Bp}from"./euclideanAreaMeasurementUtils-66TQv17M.js";import{n as Ni,p as kt,D as wo,t as J,e as ue,v as Ze,j as as,S as Yp,z as Xp,f as _i,l as yi,c as H,M as Wn,F as $r,a as Er,U as Wp,w as Tr,o as qp}from"./ShadedColorMaterial.glsl-CB3CJxKc.js";import{s as Kp}from"./ReactiveSet-Cwaxxggd.js";import{P as Qp,E as kn,p as Jp,a as th,b as Rt,z as sa,c as eh,e as Ir,t as ih,d as nh,f as oh,g as sh}from"./EditGeometryOperations-D5Rhwnxn.js";import{o as Te}from"./manipulatorUtils-amjxm4tY.js";import{N as ah,M as aa,P as rh,F as lh,C as rs,G as ch}from"./dragEventPipeline3D-CXR07qnX.js";import{y as ra}from"./utils-0SeVuXts.js";import{O as ph}from"./ColorMaterial.glsl-DreD0D-n.js";import{I as hh,H as uh,S as dh,g as gh,l as fh,_ as vh,v as mh,a as _h,E as kr,i as la,c as yh,k as bh,U as Mh}from"./SlicePlaneMaterial.glsl-Dd2kNH4O.js";import{l as xh}from"./Factory-B4Ws6_yu.js";import{i as wh}from"./drapedUtils-C449g1K9.js";import"./RightAngleQuadVisualElement-Bct8FxiC.js";import"./PointSnappingHint-BPzWCsPS.js";import"./LineVisualElement-CDdb7WR6.js";import"./triangulationUtils-DBLj8VTU.js";import"./earcut-Lltz9D9k.js";import"./deduplicate-CsHIRDra.js";import"./lineStippleUtils-C89mzWlO.js";import"./geometryEngineBase-yFIvKOkM.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-DfUEOQmq.js";import"./MediaElementView-GWQWD6og.js";import"./normalizeUtilsSync-CjSs0TiJ.js";import"./normalizeUtilsCommon-GUsSyN-7.js";import"./LayerView3D-BFjuH-u8.js";import"./ImageMaterial.glsl-BP7HUi_-.js";import"./DefaultLayouts-C1xHqOtq.js";import"./TriangleMaterial-CX-rEO2I.js";import"./LayerView-x-J1AHNo.js";import"./utils-ZkxMPLcR.js";import"./geometry2dUtils-C7_zMeLA.js";import"./sliceToolConfig-BtraHfKX.js";import"./persistable-BrjcBx71.js";import"./resourceExtension--e5tby1A.js";const Sh=3025,Oh={default:15,far:25};let Mt=class extends q{constructor(t){super(t),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messageUnitsTask=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){this.addHandles([x(()=>[this.context!=null&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(t=>ki(()=>{var e;return(e=this.context)==null?void 0:e.editGeometryOperations},t,()=>this._update())),x(()=>this._colors,t=>this._updateStyle(t)),vl(()=>this._refreshMessages()),Z(()=>{var t;return(t=this._messageUnitsTask)==null?void 0:t.abort()})]),this._refreshMessages()}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return this._messagesUnits==null}get test(){}get _messagesUnits(){var t;return(t=this._messageUnitsTask)==null?void 0:t.value}get _edgeDistancePixels(){return Oh[this.edgeDistance]}get _colors(){var e;const t=((e=this.context)==null?void 0:e.view.effectiveTheme.textColor)??ml.fromArray([255,255,255]);return{textColor:t,backgroundColor:_l(yl(t,bl.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const{context:t,stagedVertex:e}=this;if(!t)return this._destroyUnusedLabels();const{editGeometryOperations:n}=t,{components:o,geometry:s,coordinateHelper:a}=n.data;if(!s)return this._destroyUnusedLabels();const l=o.length;for(let p=0;p<l;++p){const h=$h(s,n,e,a,p);if(h.length<2||!Eh(h,t.view,t.elevationInfo,a.spatialReference))continue;const u=l===1&&!Ba(h);let d=Ih,g=kh;this.toScreenPointArray(t,h[0],d);for(let v=1;v<h.length;++v){const f=h[v-1],m=h[v];this.toScreenPointArray(t,m,g),this._addLabel(t,f,d,m,g,u),[d,g]=[g,d]}}this._destroyUnusedLabels()}_updateStyle({textColor:t,backgroundColor:e}){const n=this._nextLabelIndex,o=this._labelInfos;for(let s=0;s<n;++s){const{label:a}=o[s];a.textColor=t,a.backgroundColor=e}}_addLabel(t,e,n,o,s,a){const{label:l}=this._getOrCreateLabel(t);if(!this.visible||ho(n,s)<Sh)return void(l.visible=!1);const{spatialReference:p}=t.editGeometryOperations.data,h=Me(e,o,p),u=this._messagesUnits,d=yo(t.view);l.text=u!=null&&h!=null?bo(u,h,d):"",l.visible=!0;const g=s[0]-n[0],v=s[1]-n[1];a?Zt(St,-v,g):Zt(St,v,-g),Ya(St,St),vn(St,St,this._edgeDistancePixels),Ml(bi,n,s,.5),rn(bi,bi,St),l.position=[bi[0],bi[1]],Math.abs(St[0])>Math.abs(St[1])?l.anchor=St[0]>0?"left":"right":l.anchor=-St[1]<0?"top":"bottom"}_getOrCreateLabel(t){var l;const e=this._labelInfos.length>this._nextLabelIndex,{textColor:n,backgroundColor:o}=this._colors;if(e){const p=this._labelInfos[this._nextLabelIndex++],{label:h}=p;return h.textColor=n,h.backgroundColor=o,p}const s=new ip({anchor:"center",fontSize:8,textColor:n,backgroundColor:o});(l=t.view.overlay)==null||l.items.add(s);const a={label:s};return this._labelInfos.push(a),this._nextLabelIndex=this._labelInfos.length,a}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:t}){var e,n;(n=(e=this.context)==null?void 0:e.view.overlay)==null||n.items.remove(t),t.destroy()}_refreshMessages(){var t;(t=this._messageUnitsTask)==null||t.abort(),this._messageUnitsTask=mn(()=>xl("esri/core/t9n/Units"))}};function $h(i,t,e,n,o){const s=[];if(t.data.components[o].iterateVertices(p=>{s.push(n.toXYZ(p.pos,R.get()))}),o===0&&e!=null&&s.push(n.toXYZ(e,R.get())),s.length<2)return s;const a=s[0],l=s[s.length-1];return i.type==="polygon"&&s.length>2&&!uo(a,l)&&s.push(a),s}function Eh(i,t,e,n){if(t.type==="2d")return!0;const o=Xa(n)??1,s=En(n),a=l=>wl(t,l,n,e,Wa)??0;for(let l=1;l<i.length;++l){const p=i[l-1],h=i[l],u=(h[0]-p[0])*o,d=(h[1]-p[1])*o,g=(a(h)-a(p))*s;if(Math.abs(g)/Math.sqrt(u*u+d*d)>Th)return!1}return!0}r([c()],Mt.prototype,"context",void 0),r([c()],Mt.prototype,"stagedVertex",void 0),r([c()],Mt.prototype,"visible",void 0),r([c()],Mt.prototype,"edgeDistance",void 0),r([c()],Mt.prototype,"updating",null),r([c()],Mt.prototype,"_messageUnitsTask",void 0),r([c()],Mt.prototype,"_messagesUnits",null),r([c()],Mt.prototype,"_edgeDistancePixels",null),r([c()],Mt.prototype,"_colors",null),Mt=r([b("esri.views.interactive.SegmentLabels")],Mt);const Th=si(5),St=Bo(),bi=Bo(),Ih=Re(),kh=Re();let wn=class extends Mt{getCameraOrExtent({view:t}){return t.state.camera}toScreenPointArray({view:t,elevationInfo:e,editGeometryOperations:n},o,s=Re()){const{spatialReference:a}=n.data.coordinateHelper;return Jc(o,a,e,t,ca),t.state.camera.projectToScreen(ca,s),s}};wn=r([b("esri.views.3d.interactive.SegmentLabels3D")],wn);const ca=O();function ls(i){const t=i.graphic;return t?[x(()=>"visible"in i?i.visible:i.displaying,e=>{e&&t.notifyMeshTransformChanged({action:Mo.EnableFastUpdates})},{...ut}),Z(()=>t.notifyMeshTransformChanged({action:Mo.DisableFastUpdates}))]:[]}let ke=class extends Op{constructor(t){super(t),this._attachmentOrigin=ge(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new dt,this._geometry=null,this._width=1,this._color=ws(1,0,1,1),this._innerWidth=0,this._innerColor=ws(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Oe.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=t.view.spatialReference,this._laserline=new xn({view:t.view,isDecoration:t.isDecoration}),this.applyProperties(t),this.attached=t.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(t){return{view:t,createResources:e=>this._createObject3DResources(e),destroyResources:pa,recreateGeometry:(e,n)=>{e.geometries.length=0,this._recreateGeometry(n,e.material,e.geometries)}}}createDrapedResourceFactory(t){return{view:t,createResources:()=>this._createDrapedResources(),destroyResources:pa,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&this._laserlineStyle!=null&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(t){this._laserline.attached=this._laserlineAttached,t&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){Un(t,this._color)||(Ss(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){Un(t,this._innerColor)||(Ss(this._innerColor,t),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const e=t!=null!=(this._stipplePattern!=null);this._stipplePattern=t,e?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){t&&this._stippleOffColor&&Un(t,this._stippleOffColor)||(this._stippleOffColor=t?Sl(t):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(t){this._laserlineStyle=t,this._laserline.attached=this._laserlineAttached,t!=null&&(this._laserline.style=t)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(t){this._laserlineEnabled!==t&&(this._laserlineEnabled=t,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get attachmentOrigin(){var n;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=(n=this.object3dResources.resources)==null?void 0:n.geometries;if(!t||t.length===0)return null;fe(Pe,0,0,0);let e=0;for(const o of t)o.computeAttachmentOrigin(ha)&&(Tt(Pe,Pe,ha),e++);return e===0?null:(jt(Pe,Pe,1/e),this.view.renderCoordsHelper.fromRenderCoords(Pe,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){var t,e;(t=this.object3dResources.resources)==null||t.material.setParameters(this._materialParameters),(e=this.drapedResources.resources)==null||e.material.setParameters(this._materialParameters)}get _isClosed(){return this.geometry!=null&&this.geometry.type==="polygon"}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Oe.OccludeAndTransparentStencil?Oe.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(t,e,n){this._createRenderGeometries(e,n);for(const o of n)t.addGeometry(o);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(t){const e=new Os(this._materialParameters),n=new Array;return this._recreateGeometry(t,e,n),{material:e,geometries:n,forEach:o=>{o(e),n.forEach(o)}}}_createDrapedResources(){const t=new Os(this._materialParameters);return{material:t,geometries:this._createRenderGeometriesDraped(t)}}_createRenderGeometriesDraped(t){const{geometry:e,view:n}=this,o=n.basemapTerrain.spatialReference;return e==null||o==null?[]:pp(e,o).lines.map(({position:s})=>{const a={overlayInfo:{spatialReference:o,renderCoordsHelper:n.renderCoordsHelper},attributeData:{position:s},removeDuplicateStartEnd:this._isClosed};return new Ol(ea(t,a))})}calculateMapBounds(t){if(this.object3dResources.resources==null)return!1;const e=this.view.renderCoordsHelper;for(const n of this.object3dResources.resources.geometries){const o=n.attributes.get($l.POSITION),s=El(o.data.length);Tl(o.data,e.spatialReference,0,s,this.view.spatialReference,0),Il(t,s)}return!0}_createRenderGeometries(t,e){const n=this.geometry;if(n==null)return;const o=hp(n,this.view.elevationProvider,this.view.renderCoordsHelper,Tn.fromElevationInfo(this.elevationInfo??new Yo({mode:kl(n,null)}))),s=new Array;for(const{position:a,mapPositions:l}of o.lines){const p={mapPositions:l,attributeData:{position:a},removeDuplicateStartEnd:this._isClosed};e.push(ea(t,p)),s.push(a)}this._laserline.pathVerticalPlane=s}};function pa(i){i.geometries=[]}const ha=O(),Pe=O();let Nt=class extends dt.EventedAccessor{constructor(t){super(t),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}};r([c({constructOnly:!0})],Nt.prototype,"graphic",void 0),r([c()],Nt.prototype,"tracking",void 0),r([c()],Nt.prototype,"displaying",void 0),r([c()],Nt.prototype,"error",void 0),r([c()],Nt.prototype,"isDraped",void 0),Nt=r([b("esri.views.3d.layers.graphics.GraphicState")],Nt);var _t;(function(i){i[i.NeverApplied=0]="NeverApplied",i[i.Applied=1]="Applied",i[i.Undone=2]="Undone"})(_t||(_t={}));var Vt;(function(i){i.UndoRedoUpdating="UndoRedoUpdating",i.UndoInvalidError="UndoInvalidError",i.RedoInvalidError="RedoInvalidError",i.ApplyInvalidError="ApplyInvalidError"})(Vt||(Vt={}));const Rn={[Vt.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[Vt.UndoInvalidError]:"There are no items to Undo",[Vt.RedoInvalidError]:"There are no items to Redo",[Vt.ApplyInvalidError]:"Cannot apply an item that is already applied"};let Mi=class extends Error{constructor(){super(Rn[Vt.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},So=class extends Error{constructor(){super(Rn[Vt.UndoInvalidError]),this.type="undo-redo-undo-error"}},ua=class extends Error{constructor(){super(Rn[Vt.RedoInvalidError]),this.type="undo-redo-redo-error"}},Rh=class extends Error{constructor(){super(Rn[Vt.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var Yt;(function(i){i[i.Apply=0]="Apply",i[i.Undo=1]="Undo",i[i.Redo=2]="Redo"})(Yt||(Yt={}));let Xi=class extends q{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=_t.NeverApplied}get canUndo(){return this.status===_t.Applied}get canRedo(){return this.status===_t.Undone}async executeUndoRedoOperation(t){switch(t){case Yt.Apply:if(this.status!==_t.NeverApplied)throw new Rh;return await this.apply(),void(this.status=_t.Applied);case Yt.Undo:if(this.status!==_t.Applied)throw new So;return await this.undo(),void(this.status=_t.Undone);case Yt.Redo:if(this.status!==_t.Undone)throw new So;return await this.redo(),void(this.status=_t.Applied)}}};r([c()],Xi.prototype,"name",void 0),r([c()],Xi.prototype,"tag",void 0),Xi=r([b("esri.undoredo.UndoableOperation")],Xi);let Dt=class extends q{constructor(){super(...arguments),this._stack=new go,this._stackPosition=-1,this._updatingHandles=new ai}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new So;if(this.updating)throw new Mi;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(Yt.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new ua;if(this.updating)throw new Mi;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new ua;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(Yt.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new Mi;await this._updatingHandles.addPromise((async()=>{t.status===_t.NeverApplied&&await t.executeUndoRedoOperation(Yt.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new Mi;await this._updatingHandles.addPromise((async()=>{t.status===_t.NeverApplied&&await t.executeUndoRedoOperation(Yt.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await $s(()=>!this.updating);const n=new go;for(let o=0;o<this._stack.length;o++){const s=this._stack.getItemAt(o);s&&(s.tag===t?(s.destroy(),o===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(s))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(t=!1){if(this.updating&&!t)throw new Mi;await $s(()=>!this.updating),this._drainStack()}};r([c()],Dt.prototype,"_stack",void 0),r([c()],Dt.prototype,"_stackPosition",void 0),r([c()],Dt.prototype,"updating",null),r([c({readOnly:!0})],Dt.prototype,"canUndo",null),r([c({readOnly:!0})],Dt.prototype,"hasUndo",null),r([c({readOnly:!0})],Dt.prototype,"canRedo",null),r([c({readOnly:!0})],Dt.prototype,"hasRedo",null),Dt=r([b("esri.UndoRedo")],Dt);function Cn(){return Cl()}function Oo(){return Rl()}function Hi(i,t){const e=[];i=(i=(i=i.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const n=Dh(t);return Al.dmsToGeog(n,1,[i],e)?new It(e[0][0],e[0][1],ri.WGS84):null}function Ch(i){var t,e;return i&&Cn()?Qe(i)??((t=Hi(`0° 0' 0" N | ${i}`))==null?void 0:t.longitude)??((e=Hi(`0 | ${i}`))==null?void 0:e.longitude)??null:null}function Ah(i){var t,e;return i&&Cn()?Qe(i)??((t=Hi(`${i} | 0° 0' 0" E`))==null?void 0:t.latitude)??((e=Hi(`${i} | 0`))==null?void 0:e.latitude)??null:null}function Dh(i){let t=null;if(i||(i=ri.WGS84),i.wkid){if(t=Es.geogcs(i.wkid),!t)throw new Gn("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!i.wkt2&&!i.wkt)throw new Gn("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(t=Es.fromString(Dl.PE_TYPE_GEOGCS,i.wkt2||i.wkt),!t)throw new Gn("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return t}let Ph=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var $o;let ne=$o=class extends ln{constructor(i){super(i),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const i=this.center,t=this.numberOfPoints;if(this.hasZ=(i==null?void 0:i.hasZ)??!1,this.rings.length!==0||!i)return;const e=Pl(this.radius,this.radiusUnit,"meters"),n=i.spatialReference;let o,s="geographic";if(n.isWebMercator?s="webMercator":((n.wkid&&Vl[n.wkid])!=null||(n.wkt2||n.wkt)&&jl(n.wkt2||n.wkt))&&(s="projected"),this.geodesic){let a;switch(s){case"webMercator":a=Ll(i);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":a=i}o=this._createGeodesicCircle(a,e,t),s==="webMercator"&&(o=Hl(o))}else{let a;s==="webMercator"||s==="projected"?a=e/Xa(i.spatialReference):s==="geographic"&&(a=zl(e,"meters",Ul(i.spatialReference).radius)),o=this._createPlanarCircle(i,a,t)}this.spatialReference=o.spatialReference,this.addRing(o.rings[0])}clone(){const{center:i,numberOfPoints:t,radius:e,radiusUnit:n,geodesic:o}=this;return new $o({center:i==null?void 0:i.clone(),numberOfPoints:t,radius:e,radiusUnit:n,geodesic:o})}_createGeodesicCircle(i,t,e){let n=0;const o=[];for(;n<360;){const s=[0,0],a=[i.x,i.y];mr(s,a,n,t,ri.WGS84),this.hasZ&&s.push(i.z),o.push(s),n+=360/e}return o.push(o[0]),new ln({rings:[o]})}_createPlanarCircle(i,t,e){const n=[],o=2*Math.PI/e;for(let s=0;s<e;++s){const a=o*s,l=[i.x+Math.cos(-a)*t,i.y+Math.sin(-a)*t];this.hasZ&&l.push(i.z),n.push(l)}return n.push(n[0]),new ln({spatialReference:i.spatialReference,rings:[n]})}};r([c({type:It})],ne.prototype,"center",void 0),r([c()],ne.prototype,"geodesic",void 0),r([c()],ne.prototype,"numberOfPoints",void 0),r([c()],ne.prototype,"radius",void 0),r([c()],ne.prototype,"radiusUnit",void 0),ne=$o=r([b("esri.geometry.Circle")],ne);const Vh=ne;function Sn(i,t,e=null){return e!=null?[i,t,e]:[i,t]}function P(i,t,e=null){return e!=null?{x:i,y:t,z:e}:{x:i,y:t}}let Rr=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map(e=>this.mapToLocal(e)).filter(li)}get doUnnormalization(){return!1}},jh=class extends Rr{constructor(t,e,n=null){super(e),this._defaultZ=n,this.transform=ia(),this.transformInv=ia(),this.transform=kp(t),Ip(this.transformInv,this.transform)}makeMapPoint(t,e){return Sn(t,e,this._defaultZ)}mapToLocal(t){return P(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return Sn(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},Lh=class extends Rr{constructor(t,e){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=O(),this.tangentFrameUpWS=O(),this.tangentFrameRightWS=O(),this.tangentFrameForwardWS=O(),this.localFrameRightWS=O(),this.localFrameUpWS=O(),this.worldToLocalTransform=Ts(),this.localToWorldTransform=Ts(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=e,this.defaultZ=e.hasZ?e.z:null;const n=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Fn.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Fn.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Fn.Z,this.tangentFrameForwardWS);const o=O();jt(o,this.tangentFrameForwardWS,_n(n,this.tangentFrameForwardWS)),B(this.localFrameRightWS,n,o),qa(this.localFrameRightWS,this.localFrameRightWS),Ie(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Gl(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Fl(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(t,e){return Sn(t,e,this.defaultZ)}mapToLocal(t){const e=O();this.view.renderCoordsHelper.toRenderCoords(new It({x:t[0],y:t[1],spatialReference:this.spatialReference}),e),Is(e,e,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,new It({spatialReference:this.view.spatialReference}));return n!=null?P(n.x/this.scale,n.y/this.scale):null}localToMap(t){const e=O();this.view.renderCoordsHelper.toRenderCoords(new It({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),e),Is(e,e,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,new It({spatialReference:this.view.spatialReference}));return n!=null?Sn(n.x,n.y,this.defaultZ):null}};function Hh(i,t){if(i.type==="2d")return new jh(i.state.transform,i.spatialReference,t.length>2?t[2]:null);if(i.type==="3d"){const e=t.length>2?new It({x:t[0],y:t[1],z:t[2],spatialReference:i.spatialReference}):new It({x:t[0],y:t[1],spatialReference:i.spatialReference});return new Lh(i,e)}return null}function xe(i,t){const e=new It({x:i[0],y:i[1],spatialReference:t});return i.length>2&&(e.z=i[2]),e}function zh(i,t){return new Nl({points:i,spatialReference:t})}function da(i,t,e){const n=new Ka({paths:i,spatialReference:t});return e&&Qa(n),n}function Zi(i,t,e,n=!0){const o=fo(i);o.forEach(a=>{const l=a[0],p=a[a.length-1];Zl(l,p)&&a.length!==1||a.push(a[0])});let s=new ln({rings:o,spatialReference:t});return s.rings.forEach(a=>{Ba(a)||a.reverse()}),e&&Qa(s),n&&s.isSelfIntersecting&&Ja(t)&&(s=Ep(s)),s}function ga(i,t,e){const n=t.mapToLocalMultiple(i),o=[],s={x:n[0].x,y:n[0].y},a={x:n[1].x,y:n[1].y},l=Math.round(a.x-s.x),p=Math.round(a.y-s.y),h=Math.max(Math.abs(l),Math.abs(p));if(e){const u={x:s.x+h,y:s.y+h},d={x:s.x-h,y:s.y-h};o.push(P(u.x,d.y),P(d.x,d.y),P(d.x,u.y),P(u.x,u.y))}else{const u={x:l>0?s.x+h:s.x-h,y:p>0?s.y+h:s.y-h};o.push(P(s.x,s.y),P(u.x,s.y),P(u.x,u.y),P(s.x,u.y))}return Cr(Zi([o.map(u=>t.localToMap(u)).filter(li)],t.spatialReference,t.doUnnormalization,!0),o,t)}function Uh(i,t,e){let n=t.mapToLocalMultiple(i);if(n.length===1){const p=n[0];n=[P(p.x-48,p.y+48),P(p.x+48,p.y-48),P(p.x+48,p.y-48),P(p.x-48,p.y+48)]}const o=[],s={x:n[0].x,y:n[0].y},a={x:n[1].x,y:n[1].y};if(e){const l=Math.round(a.x-s.x),p=Math.round(a.y-s.y);o.push(P(s.x-l,s.y-p),P(a.x,s.y-p),P(a.x,a.y),P(s.x-l,a.y))}else o.push(P(s.x,s.y),P(a.x,s.y),P(a.x,a.y),P(s.x,a.y));return Cr(Zi([o.map(l=>t.localToMap(l)).filter(li)],t.spatialReference,t.doUnnormalization,!0),o,t)}function Cr(i,t,e){const n=Wi(t[3],t[2],e),o=Wi(t[1],t[2],e),s=Wi(t[0],t[1],e),a=Wi(t[0],t[3],e);return{geometry:i,midpoints:n!=null&&o!=null&&s!=null&&a!=null?{top:n,right:o,bottom:s,left:a}:null}}function Wi(i,t,e){Ve[0]=i.x,Ve[1]=i.y,Ve[2]=0,je[0]=t.x,je[1]=t.y,je[2]=0,le(Ve,Ve,je,.5),qi.x=Ve[0],qi.y=je[1],qi.z=je[2];const n=e.localToMap(qi);return n!=null?xe(n,e.spatialReference):null}const qi=P(0,0,0),Ve=O(),je=O();function fa(i,t,e,n){const o=t.mapToLocalMultiple(i);let s=null,a=null;if(e)s=o[0],a=o[1];else{const f=o[0],m=o[1],w=Math.round(m.x-f.x),_=Math.round(m.y-f.y),M=Math.max(Math.abs(w),Math.abs(_));s=P(w>0?f.x+M/2:f.x-M/2,_>0?f.y+M/2:f.y-M/2),a=P(Math.abs(w)>Math.abs(_)?s.x-M/2:s.x,Math.abs(w)>Math.abs(_)?s.y:s.y-M/2)}const l=t.localToMap(s),p=t.localToMap(a);if(l==null||p==null)return null;t.doUnnormalization&&Bl([[l,p]],t.spatialReference);const h=xe(l,t.spatialReference),u=xe(p,t.spatialReference),d=yn(t.spatialReference);let g=0;if(Ja(t.spatialReference))g=d*Tp(h,u,null);else{const f=s.x-a.x,m=s.y-a.y;g=d*Math.sqrt(f*f+m*m)*1}const v=new Vh({center:h,radius:g,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:Zi(v.rings,v.spatialReference,!1),center:h,edge:u}}function Gh(i,t,e){const n=t.mapToLocalMultiple(i),o=n[0],s=n[1],a=Math.round(s.x-o.x),l=Math.round(s.y-o.y),p=P(e?o.x:o.x+a/2,e?o.y:o.y+l/2),h=e?a:a/2,u=e?l:l/2,d=60,g=[],v=2*Math.PI/d;function f(j){const E=Math.cos(j),pt=Math.sin(j);return P(h*E+p.x,u*pt+p.y)}for(let j=0;j<d;j++)g.push(f(j*v));g.push(g[0]);const{spatialReference:m,doUnnormalization:w}=t,_=Zi([g.map(j=>t.localToMap(j)).filter(li)],m,w,!1),M=t.localToMap(f(Math.PI/2)),k=t.localToMap(f(0)),G=t.localToMap(f(-Math.PI/2)),$=t.localToMap(f(Math.PI));return{geometry:_,midpoints:M!=null&&k!=null&&G!=null&&$!=null?{top:xe(M,m),right:xe(k,m),bottom:xe(G,m),left:xe($,m)}:null}}function cs(i,t){switch(i){case"point":case"multipoint":return Fh();case"polyline":return Nh(t);case"polygon":return Zh(t);default:return}}function Fh(i){return"point"}function Nh(i){return(i!=null&&i.type==="polyline"&&i.paths.length?i.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function Zh(i){const t=i!=null&&i.type==="polygon"&&i.rings.length?i.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}function Bh(i,t){const e=i==null?void 0:i.geometry;if(!i||(e==null?void 0:e.type)!=="mesh"||!t)return;const{renderCoordsHelper:n,elevationProvider:o}=t,{camera:s}=t.state,{extent:a}=e,{center:l,spatialReference:p}=a,h=yn(p),u=En(p),d=yn(n.spatialReference),g=a.width*h,v=a.height*u,f=(a.zmax??0)*u,m=f-(a.zmin??0)*u,w=Math.max(g,v,m)/d,{x:_,y:M}=l,k=l.z??0;fe(Ki,_,M,k),n.toRenderCoords(Ki,p,Ki);const G=w/s.computeScreenPixelSizeAt(Ki);if(G>s.width*Xh)return"meshTooClose";if(G<Yh)return"meshTooFar";const $=tr(i),{absoluteZ:j}=Yl(_,M,f,p,t,$);return j<(o.getElevation(_,M,k,p,"ground")??0)*u+m*Wh?"meshUnderground":"mesh"}const Yh=20,Xh=1,Wh=.1,Ki=O();function qh(i,t,e,n,o,s){let a="geodesic",l=_r(e);const p=di();return ss(i,t,n,p),p[2]=0,l&&Xt(p,e,p,l)||(a="euclidean",l=e),{mode:a,view:t,elevationInfo:n,hasZ:o,directionMode:s,spatialReference:i.spatialReference,measurementSR:l,origin:p}}function Kh(i,t,e){if(t==null||i==null)return;const n=Xl(e.measurementSR);if(n==null)return;const o=An(i,e);if(o==null)return;const s=ci(t,n);return new Cp(o,s)}function Qh(i,t,e,n){if(e==null||i==null)return;const o=An(i,n);if(o==null)return;const s=Kt(e),a=10,l=h=>{if(h==null)return;const u=di(),d=pi(h,"degrees","geographic");return Hp(u,o,n.measurementSR,a,d,n.mode)?new Dp(o,u):void 0},p=()=>{if(t!=null&&i!=null)return Kt(Sr(t,i))};switch(n.directionMode){case ct.Absolute:return l(s);case ct.Relative:{const h=p();return h==null?void 0:l(h+s)}case ct.RelativeBilateral:{const h=p();return h==null?void 0:wr([l(h+s),l(h-s)])}}}function Ar(i,t){const e=Dn(i,t);return e!=null?new Ap(e):void 0}function Dr(i,t,e){const{context:n,longitude:o,latitude:s,direction:a,distance:l,elevation:p}=e;if(o!=null||s!=null||l!=null||p!=null||a!=null){if(o!=null||s!=null){const h=Kt(o),u=Kt(s),d=Dn(p,n);return new xr(h,u,d)}return Jh(i,t,e)}}function Jh(i,t,{context:e,direction:n,distance:o,elevation:s}){if(t==null)return Ar(s,e);const{view:a,elevationInfo:l,measurementSR:p}=e,h=ss(t,a,l);if(!p||!Xt(h,t.spatialReference,va,p))return;const[u,d]=va,g=o!=null?ci(o,"meters"):void 0,v=Kt(n),f=Dn(s,e),m=_=>{const M=new Pp([u,d],p,g,f,_);return g==null||_==null||f==null&&e.hasZ?M:new Vp(M.closestTo(h))};if(v==null)return m(void 0);const w=()=>{if(i!=null&&t!=null)return Kt(Sr(i,t))};switch(e.directionMode){case ct.Absolute:return m(v);case ct.Relative:{const _=w();return _==null?void 0:m(_+v)}case ct.RelativeBilateral:{const _=w();return _==null?void 0:wr([m(_+v),m(_-v)])}}}function tu(i){return i.context.mode==="geodesic"?Dr(null,null,i):Pr(i)}function eu(i,t,e){const{context:n,x:o,y:s,distance:a,direction:l,elevation:p}=e;return n.mode==="geodesic"?Dr(t,i,e):o!=null||s!=null?Pr(e):iu([Kh(i,a,n),Qh(i,t,l,n),Ar(p,n)])}function Pr({x:i,y:t,elevation:e,context:n}){Qi.x=(i==null?void 0:i.value)??0,Qi.y=(t==null?void 0:t.value)??0,Qi.spatialReference=n.spatialReference;const o=An(Qi,n,su);return new xr(i!=null&&o!=null?o[0]:void 0,t!=null&&o!=null?o[1]:void 0,Dn(e,n))}function iu(i){let t;for(const e of i)e&&(t=(t==null?void 0:t.intersect(e))??e);return t}function An(i,t,e=di()){const{view:n,elevationInfo:o,measurementSR:s,origin:a,mode:l}=t;if(ss(i,n,o,e),Xt(e,i.spatialReference,e,s))return l!=="geodesic"&&B(e,e,a),e}function nu(i,t,e,n){const{view:o,measurementSR:s,spatialReference:a,origin:l,mode:p}=e;if(p==="geodesic"?bn(xi,i):Tt(xi,i,l),Xt(xi,s,xi,a))return Rp(xi,o,t,e,n)}function Dn(i,t){var e;return((e=ou(i,t))==null?void 0:e.value)??void 0}function ou(i,{view:t,origin:e,elevationInfo:n,hasZ:o,measurementSR:s}){if(i==null||!o)return;const a=er(s);if(a==null)return;const[l,p]=e,h=ci(i,a),u=(t==null?void 0:t.type)==="3d"?ir(t,l,p,h,s,n):h;return u!=null?Ce(u,a):void 0}const va=di(),su=di(),xi=di(),Qi=ge(0,0,0,ri.WGS84),it="esri-tooltip",au=`${it}-content`,ru=`${it}-content--input`,lu=`${it}-content__header`,cu=`${it}-content__header__spacer`,ma=`${it}-content__header__actions`,Vr=`${it}-draw-header-actions`,pu=`${it}-table`,hu=`${it}-help-message`,uu=`${it}-help-message__text`,du=`${it}-help-message__icon`,Ji=`${it}-field`,tn={base:Ji,inputMode:`${Ji}--input`,title:`${Ji}__title`,value:`${Ji}__value`};let Y=class extends Ui{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return y("div",{class:this.classes({[tn.base]:!0,[tn.inputMode]:this.mode==="input"})},y("div",{class:tn.title,key:"title"},this.title),y("div",{class:tn.value,key:"value"},this.value))}};r([c()],Y.prototype,"hidden",void 0),r([c()],Y.prototype,"mode",void 0),r([c()],Y.prototype,"title",void 0),r([c()],Y.prototype,"value",void 0),Y=r([b("esri.views.interactive.tooltip.components.TooltipField")],Y);const gu={base:`${it}-value-by-value`};let Bt=class extends Ui{constructor(){super(...arguments),this.divider="×"}render(){return y("div",{class:gu.base},y("span",null,this.left),y("span",null,this.divider),y("span",null,this.right))}};r([c()],Bt.prototype,"left",void 0),r([c()],Bt.prototype,"divider",void 0),r([c()],Bt.prototype,"right",void 0),Bt=r([b("esri.views.interactive.tooltip.components.ValueByValue")],Bt);const Pn=1,jr=6;function fu(i,t){return{angleRelative:vu,direction:mu,directionRelative:_u,directionRelativeBilateral:yu,latitudeDecimalDegrees:Mu,longitudeDecimalDegrees:bu,area:(e,n)=>np(i,e,n??t.area),length:(e,n,o)=>bo(i,e,n??t.length,o),lengthRelative:(e,n)=>op(i,e,n??t.length),totalLength:(e,n)=>bo(i,e,n??t.length),verticalLength:(e,n)=>sp(i,e,n??t.verticalLength),verticalLengthRelative:(e,n)=>ap(i,e,n??t.verticalLength),percentage:Su,scalar:zr,scale:Ou}}function vu(i){return Gi(i,{signDisplay:"exceptZero",...ps(Pn)})}function mu(i){return In(i,i.rotationType,Pn)}function _u(i){const t=Kt(i);return Gi(t,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:t>0?"never":"exceptZero",...ps(Pn)})}function yu(i){return In(i,i.rotationType,Pn)}function bu(i){return Lr(i,Fr)}function Mu(i){return Lr(i,Nr)}function xu(i){return Hr(i,Fr)}function wu(i){return Hr(i,Nr)}function Lr(i,t){return In(Ae(i,"degrees"),"geographic",jr,t,!1)}function Hr(i,t){const n=t.normalize(Ae(i,"degrees").value,void 0,!1);return zr(Wt(n),jr)}function Su(i){return Gi(i.value,{style:"percent"})}function Ou(i){return Gi(i,{style:"percent",maximumFractionDigits:0})}function zr(i,t){return Gi(i.value,ps(t))}function ps(i){return{minimumFractionDigits:i,maximumFractionDigits:i}}function Qt({createQuantity:i,sanitize:t}){return(e,n)=>{if(e==null)return null;t&&(e=t(e));const o=Qe(e);return o==null?null:i(o,n)}}function Ur(i){return i.replaceAll(/[*^~°º]/g,"")}const $u=i=>{let t=`[-+]?[0-9${i.thousands}]+`;return i.decimal!==""&&(t+=`${i.decimal}[0-9]+`),new RegExp(`^(${t}\\s*)${i.separator}(\\s*${t})$`,"i")},Eu=" ",Gr=[];for(const i of[",","\\|","\\s+"])for(const t of["\\.",",",""])for(const e of["",",","\\.",Eu,"\\s+"])i!==t&&i!==e&&t!==e&&Gr.push({separator:i,decimal:t,thousands:e,pattern:$u({decimal:t,thousands:e,separator:i})});function Tu(i){for(const{decimal:t,thousands:e,pattern:n}of Gr){n.lastIndex=0;const o=i.match(n);if(!o)continue;const s=Qe(_a(o[1],t,e)),a=Qe(_a(o[2],t,e));if(s!=null&&a!=null)return{x:Wt(s),y:Wt(a)}}return null}function _a(i,t,e){let n=i.replaceAll(/[\s+]/g,"");return e!==""&&(n=n.replaceAll(e,"")),t!==""&&(n=n.replaceAll(t,".")),n}function Iu(i){if(!i||Qe(i)!=null||!Cn())return null;const t=Hi(i),e=ni(t==null?void 0:t.latitude),n=ni(t==null?void 0:t.longitude);return n!=null&&e!=null?{latitude:e,longitude:n}:null}function ku(i){return ni(Ch(i))}function Ru(i){return ni(Ah(i))}function ni(i){return i!=null?pi(i,"degrees","geographic"):null}const Fr=new nr(-180,180),Nr=new nr(-90,90),qn=Symbol("dragHandles");let I=class extends Ui{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=xo(fu),this._onHeaderPointerDown=t=>{var n;const e=t.target;e instanceof HTMLElement&&((n=e==null?void 0:e.tagName)==null?void 0:n.toLowerCase())!=="calcite-button"&&(this.removeHandles(qn),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([Ri(e,"pointermove",({clientX:o,clientY:s})=>{this.tooltip.onDrag(o,s)}),Ri(e,["pointerup","pointercancel"],o=>{this.removeHandles(qn),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()}),Ri(e,"touchstart",o=>o.preventDefault())],qn))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),e==="commit-and-exit")return void this.exitInputMode();if(e==="commit-on-blur")return;const n=this._getFocusableElements(),o=n.length,s=n.indexOf(t);if(s===-1)return void this.exitInputMode();const a=((s+(e==="commit-and-next"?1:-1))%o+o)%o;en(n.at(a))},this._onKeyDown=t=>{switch(t.code){case Ee.next:return this._onNextKey(t);case Ee.discard:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=yo(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=p=>({unit:p,abbreviation:Jl(t,p,"abbr")}),{inputUnits:n}=this.info.sketchOptions.values,o=yo(this.tooltip.view),s=n.length??o,a=n.verticalLength??o,l=n.area??o;return{length:e(tc(s)),verticalLength:e(ec(a)),area:e(ic(l)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,n=this._renderedActions,o=this._renderedHelpMessage,s=e.length>0,a=s||!!o,l=this.mode==="input";return y("div",{class:Wl(au,l&&ru),onkeydown:this._onKeyDown,tabIndex:-1},l&&a&&t.header?y("div",{class:lu,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},y("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),n.length>0?y(wt,null,y("div",{class:cu,key:"spacer"}),y("div",{class:ma,key:"actions"},n)):null):null,s?y("div",{class:pu,key:"content"},...e):null,o)}destroy(){var t;this._focusAbortController.abort(),(t=this._transitionInfo)==null||t.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return Xo({button:()=>Pt(()=>import("./calcite-button-C-acS1g1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),icon:()=>Pt(()=>import("./calcite-icon-DWzzk24x.js"),__vite__mapDeps([16,13,1,2,4,11])),input:()=>Pt(()=>import("./calcite-input-C0dWkuR1.js"),__vite__mapDeps([17,18,1,2,4,3,5,10,6,7,8,9,11,12,13]))})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(n){ks(n)}}async exitInputMode({focusOnView:t=!0}={}){var e;try{const{container:n,info:o}=this;o.clearInputValues();const s=t?(e=n==null?void 0:n.closest(".esri-view"))==null?void 0:e.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),s instanceof HTMLElement&&s.focus()}catch(n){ks(n)}}_onNextKey(t){const e=this._getFocusableElements(),n=e.at(0),o=e.at(-1);n&&o&&(t.shiftKey?document.activeElement===n&&(t.preventDefault(),t.stopPropagation(),en(o)):document.activeElement===o&&(t.preventDefault(),t.stopPropagation(),en(n)))}get _renderedContent(){return ya(this._renderContent())}get _renderedActions(){return ya(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const n=t.tooltips.helpMessage??this._defaultHelpMessage;if(!n)return null;const o=t.tooltips.helpMessageIcon??"information";return y("div",{class:hu,key:"help-message"},o?y("calcite-icon",{class:du,icon:o,scale:"s"}):null,y("div",{class:uu},n))}get _defaultHelpMessage(){var o,s,a;const{helpMessage:t,viewType:e}=this.info;if(t==null)return null;const n=e==="3d"?"helpMessages3d":"helpMessages2d";return(a=(s=(o=this._messagesTooltip)==null?void 0:o.sketch)==null?void 0:s[n])==null?void 0:a[t]}async _focusField(t){var s;(s=this._focusAbortController)==null||s.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),ql(e);const n=this._getFocusableInputs(),o=t?n.find(a=>a.getAttribute("data-field-name")===t):n.at(0);await en(o)}async _transitionTo(t,e){var s,a,l;if(this._mode===t&&!this._transitionInfo)return;if(((s=this._transitionInfo)==null?void 0:s.mode)===t)return this._transitionInfo.transition.finished;(a=this._transitionInfo)==null||a.transition.skipTransition();const n=async()=>{this.destroyed||(this._mode=t,await Rs(),this.destroyed||(this.renderNow(),await Rs(),this.destroyed||(e==null||e())))};if(!((l=this.domNode)!=null&&l.firstChild)||!document.startViewTransition||Kl())return void await n();this.autoRenderingEnabled=!1;const o=this._transitionInfo={transition:document.startViewTransition(async()=>{this.destroyed||o!==this._transitionInfo||(this.autoRenderingEnabled=!0,await n())}),mode:t};try{await o.transition.finished}finally{o===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>{var e;return Array.from(((e=this.domNode)==null?void 0:e.querySelectorAll("calcite-input"))??[])};for(;t().length===0;)await Ql(Cu);await or()}_getFocusableInputs(){var t;return Array.from(((t=this.domNode)==null?void 0:t.querySelectorAll("calcite-input:not([read-only]):not([disabled])"))??[])}_getFocusableElements(){var e;const t=(e=this.domNode)==null?void 0:e.querySelector(`.${Vr}`);return[...Array.from((t==null?void 0:t.querySelectorAll(`.${ma} calcite-button:not([disabled])`))??[]),...this._getFocusableInputs()]}};async function en(i){await(i==null?void 0:i.setFocus())}function ya(i){return(Array.isArray(i)?i:[i]).flat(10).filter(t=>!!t)}r([vo("esri/core/t9n/Units"),c()],I.prototype,"_messagesUnits",void 0),r([vo("esri/views/interactive/tooltip/t9n/Tooltip"),c()],I.prototype,"_messagesTooltip",void 0),r([c()],I.prototype,"info",void 0),r([c()],I.prototype,"tooltip",void 0),r([c()],I.prototype,"_mode",void 0),r([c()],I.prototype,"mode",null),r([c()],I.prototype,"_displayUnits",null),r([c()],I.prototype,"_inputUnitInfos",null),r([c()],I.prototype,"_formatters",null),r([c()],I.prototype,"fieldContext",null),r([c()],I.prototype,"_renderedContent",null),r([c()],I.prototype,"_renderedActions",null),r([c()],I.prototype,"_renderedHelpMessage",null),r([c()],I.prototype,"_defaultHelpMessage",null),I=r([b("esri.views.interactive.tooltip.content.TooltipContent")],I);const Cu=20;let Eo=class extends I{_renderContent(){const{area:t,radius:e,xSize:n,ySize:o,visibleElements:s}=this.info,a=this._messagesTooltip.sketch,l=this._formatters;return y(wt,null,s.radius&&e!=null?y(Y,{title:a.radius,value:l.length(e)}):null,s.size&&n!=null&&o!=null?y(Y,{title:a.size,value:y(Bt,{left:l.length(n),right:l.length(o)})}):null,s.area?y(Y,{title:a.area,value:l.area(t)}):null)}};Eo=r([b("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],Eo);const ft=`${it}-editable-field`,ht={base:ft,inputMode:`${ft}--input`,feedbackMode:`${ft}--feedback`,readOnly:`${ft}--read-only`,locked:`${ft}--locked`,title:`${ft}__title`,value:`${ft}__value`,valueContent:`${ft}__value__content`,valueContentReadOnly:`${ft}__value__content--read-only`,lockIcon:`${ft}__lock-icon`,input:`${ft}__input`,inputSuffix:`${ft}__input-suffix`,button:`${ft}__button`},Kn={lock:"lock",unlock:"unlock"};let xt=class extends Ui{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===Ee.discard&&this.mode==="input"&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case Ee.commit:return this.field.onCommit("commit-and-exit",e,this.context);case Ee.next:{t.preventDefault(),t.stopPropagation();const n=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(n,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.target.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{var e;this._input===document.activeElement&&((e=this._input)==null||e.selectText())};t(),or().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{var n;const e=(n=t.clipboardData)==null?void 0:n.getData("text");e&&this.field.parse(e,this.context)!=null&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{(t.inputType==="historyUndo"||t.inputType==="historyRedo")&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles(x(()=>this._rawDisplayValue,()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()}))}loadDependencies(){return Xo({button:()=>Pt(()=>import("./calcite-button-C-acS1g1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),icon:()=>Pt(()=>import("./calcite-icon-DWzzk24x.js"),__vite__mapDeps([16,13,1,2,4,11])),input:()=>Pt(()=>import("./calcite-input-C0dWkuR1.js"),__vite__mapDeps([17,18,1,2,4,3,5,10,6,7,8,9,11,12,13]))})}render(){const{field:t,mode:e}=this,n=e==="input",{locked:o,readOnly:s}=t;return y("div",{class:this.classes({[ht.base]:!0,[ht.feedbackMode]:e==="feedback",[ht.inputMode]:e==="input",[ht.locked]:o,[ht.readOnly]:s})},y("div",{class:ht.title,key:"title"},this._title),y("div",{class:ht.value,key:"value",onkeydown:this._onKeyDown},n?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||ba}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return typeof t=="string"?t:t(this.context)}_renderValueFeedbackMode(){return y(wt,null,y("div",{class:ht.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&this.mode!=="input"?y("calcite-icon",{class:ht.lockIcon,icon:Kn.lock,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return y("div",{class:this.classes(ht.valueContent,ht.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){var l;const{field:t}=this,{name:e,invalid:n,locked:o}=t,s=((l=this.context)==null?void 0:l.messages.sketch)??{},a=o?s.unlockConstraint:s.lockConstraint;return y(wt,null,y("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:ht.input,"data-field-name":e,"data-testid":`tooltip-field-${e}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:n?"invalid":"idle",type:"text",value:this._rawDisplayValue??ba,onCalciteInputInput:this._onInput}),y("div",{class:ht.inputSuffix,key:"suffix"},this._suffix),t.lockable?y("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:ht.button,"data-testid":`tooltip-field-${e}-lock`,iconStart:o?Kn.lock:Kn.unlock,key:"lock",kind:"neutral",label:a,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:a}):y("div",{key:"lock-empty"}))}};r([c()],xt.prototype,"field",void 0),r([c()],xt.prototype,"context",void 0),r([c()],xt.prototype,"mode",void 0),r([c()],xt.prototype,"_input",void 0),r([c()],xt.prototype,"_lock",void 0),r([c()],xt.prototype,"_formattedValue",null),r([c()],xt.prototype,"_rawDisplayValue",null),r([c()],xt.prototype,"_suffix",null),r([c()],xt.prototype,"_title",null),xt=r([b("esri.views.interactive.tooltip.components.TooltipEditableField")],xt);const ba="—";function Jt(i){const t=i.fields.filter(e=>(e==null?void 0:e.visible)===!0);return t.length===0?null:y(wt,null,t.map(e=>y(xt,{context:i.context,field:e,key:e.id,mode:i.mode})))}let To=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:o}=e;return y(Jt,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?e.elevation:void 0,o.orientation?e.orientation:void 0,o.scale?e.scale:void 0],mode:n})}};To=r([b("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],To);let Io=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{elevation:o,visibleElements:s}=e;return y(Jt,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?o:void 0],mode:n})}};Io=r([b("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],Io);const Qn={absolute:"absolute-direction",relative:"relative-direction"};let be=class extends Ui{constructor(t){super(t),this.visibleElements={}}render(){return y("div",{class:Vr},this._isElementVisible("direction")?y(Au,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return Xo({button:()=>Pt(()=>import("./calcite-button-C-acS1g1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),dropdown:()=>Pt(()=>import("./calcite-dropdown-BiVDwnxJ.js"),__vite__mapDeps([19,1,2,4,20,21,15,5,10,8,11,22])),"dropdown-item":()=>Pt(()=>import("./calcite-dropdown-item-U5WmB6mo.js"),__vite__mapDeps([23,1,2,4,8,7,5,24,13,11])),"dropdown-group":()=>Pt(()=>import("./calcite-dropdown-group-BrcJWhGN.js"),__vite__mapDeps([25,1,2,11,24]))})}_isElementVisible(t){var e;return((e=this.visibleElements)==null?void 0:e[t])??this.sketchOptions.tooltips.visibleElements[t]}};function Au(i){var a,l,p,h;const{directionMode:t}=i.sketchOptions.values,e=(a=i.messages)==null?void 0:a.sketch,n=(l=e==null?void 0:e.directionModeSelect)==null?void 0:l.title,o="absolute",s="relative";return y("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:u=>{var g,v;const d=(v=(g=u.target.selectedItems)==null?void 0:g[0])==null?void 0:v.getAttribute("data-mode");i.sketchOptions.values.directionMode=d??"absolute"}},y("calcite-button",{alignment:"end",appearance:"transparent",iconStart:Qn[t],kind:"neutral",label:n,scale:"s",slot:"trigger",title:n}),y("calcite-dropdown-group",{selectionMode:"single"},y("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-relative",iconStart:Qn.relative,key:"relative",selected:t===s},(p=e==null?void 0:e.directionModeSelect)==null?void 0:p.relative),y("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-absolute",iconStart:Qn.absolute,key:"absolute",selected:t===o},(h=e==null?void 0:e.directionModeSelect)==null?void 0:h.absolute)))}r([vo("esri/views/interactive/tooltip/t9n/Tooltip"),c()],be.prototype,"messages",void 0),r([c()],be.prototype,"sketchOptions",void 0),r([c()],be.prototype,"visibleElements",void 0),be=r([b("esri.views.interactive.tooltip.components.DrawHeaderActions")],be);let ko=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:o,visibleElements:s}=e;return y(Jt,{context:t,fields:[...o==="direction-distance"?[s.direction?e.direction:void 0,s.distance?e.distance:void 0]:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0],s.elevation?e.elevation:void 0,s.area?e.area:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return y(be,{sketchOptions:e,visibleElements:{direction:t==="direction-distance"}})}};ko=r([b("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],ko);let Ro=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:o,visibleElements:s}=e;return y(Jt,{context:t,fields:[...o==="direction-distance"?[s.direction?e.direction:void 0,s.distance?e.distance:void 0]:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0],s.elevation?e.elevation:void 0,s.totalLength?e.totalLength:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return y(be,{sketchOptions:e,visibleElements:{direction:t==="direction-distance"}})}};Ro=r([b("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],Ro);let Co=class extends I{_renderContent(){const{area:t,xSize:e,ySize:n,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,a=this._formatters;return y(wt,null,o.size&&e!=null&&n!=null?y(Y,{title:s.size,value:y(Bt,{left:a.length(e),right:a.length(n)})}):null,o.area?y(Y,{title:s.area,value:a.area(t)}):null)}};Co=r([b("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],Co);let Ao=class extends I{_renderContent(){const{angle:t,visibleElements:e}=this.info,n=this._messagesTooltip.sketch;return y(wt,null,e.rotation?y(Y,{title:n.rotation,value:this._formatters.angleRelative(t)}):null)}};Ao=r([b("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],Ao);let Do=class extends I{_renderContent(){const t=this.info,{visibleElements:e}=t,n=this._messagesTooltip.sketch,o=this._formatters;return y(wt,null,e.size?y(Y,{title:n.size,value:y(Bt,{left:o.length(t.xSize),right:o.length(t.ySize)})}):null,e.scale?y(Y,{title:n.scale,value:y(Bt,{left:o.scale(t.xScale),right:o.scale(t.yScale)})}):null)}};Do=r([b("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],Do);let Po=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:o}=e;return y(Jt,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?e.elevation:void 0],mode:n})}};Po=r([b("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],Po);let Vo=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:o}=e;return y(Jt,{context:t,fields:[o.distance?e.distance:void 0,o.area?e.area:void 0,o.totalLength?e.totalLength:void 0],mode:n})}};Vo=r([b("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],Vo);let jo=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:o}=e;return y(Jt,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?e.elevation:void 0,o.area&&e.geometryType==="polygon"?e.area:null,o.totalLength&&e.geometryType==="polyline"?e.totalLength:null],mode:n})}};jo=r([b("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],jo);let Lo=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:o}=e;return y(Jt,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?e.elevation:void 0,o.orientation?e.orientation:void 0,o.scale?e.scale:void 0],mode:n})}};Lo=r([b("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],Lo);let Ho=class extends I{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:o}=e;return y(Jt,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?e.elevation:void 0,o.orientation?e.orientation:void 0,o.size?e.size:void 0],mode:n})}};Ho=r([b("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],Ho);let zo=class extends I{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,o=this._formatters;return y(wt,null,e.distance?y(Y,{title:n.distance,value:o.length(t.distance)}):null)}};zo=r([b("esri.views.interactive.tooltip.content.TooltipContentTranslate")],zo);let Uo=class extends I{_renderContent(){const{distance:t,elevation:e,area:n,totalLength:o,visibleElements:s}=this.info,a=this._messagesTooltip.sketch,l=this._formatters;return y(wt,null,s.distance?y(Y,{title:a.distance,value:l.length(t)}):null,s.elevation&&(e==null?void 0:e.actual)!=null?y(Y,{title:a.elevation,value:l.verticalLength(e.actual)}):null,s.area&&n!=null?y(Y,{title:a.area,value:l.area(n)}):null,s.totalLength&&o!=null?y(Y,{title:a.totalLength,value:l.length(o)}):null)}};Uo=r([b("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],Uo);let Go=class extends I{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,o=this._formatters;return y(wt,null,e.distance?y(Y,{title:n.distance,value:o.length(t.distance)}):null)}};Go=r([b("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],Go);let Fo=class extends I{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch;return y(wt,null,e.distance?y(Y,{title:n.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};Fo=r([b("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],Fo);function Du(i,t){if(t==null)return null;const e=document.createElement("div");switch(t.type){case"draw-point":return new Io({tooltip:i,info:t,container:e});case"draw-polygon":return new ko({tooltip:i,info:t,container:e});case"draw-polyline":return new Ro({tooltip:i,info:t,container:e});case"draw-mesh":return new To({tooltip:i,info:t,container:e});case"draw-rectangle":return new Co({tooltip:i,info:t,container:e});case"draw-circle":return new Eo({tooltip:i,info:t,container:e});case"extent-rotate":return new Ao({tooltip:i,info:t,container:e});case"extent-scale":return new Do({tooltip:i,info:t,container:e});case"move-point":return new Po({tooltip:i,info:t,container:e});case"selected-vertex":return new jo({tooltip:i,info:t,container:e});case"transform-point":return new Ho({tooltip:i,info:t,container:e});case"transform-mesh":return new Lo({tooltip:i,info:t,container:e});case"translate":return new zo({tooltip:i,info:t,container:e});case"translate-vertex":return new Uo({tooltip:i,info:t,container:e});case"translate-z":return new Fo({tooltip:i,info:t,container:e});case"translate-xy":return new Go({tooltip:i,info:t,container:e});case"reshape-edge-offset":return new Vo({tooltip:i,info:t,container:e})}}const Si={base:`${it}`,ltr:`${it}--ltr`,rtl:`${it}--rtl`,debug:`${it}--debug`},Pu=20,Vu=16,ju="bottom-end";let X=class extends dt.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([x(()=>{var e;return(e=this.view.overlay)==null?void 0:e.surface},e=>{t.remove(),e==null||e.appendChild(t),this._rtl=nc(e)},ut),x(()=>this.info,(e,n)=>{if(this.content!=null&&e!=null&&n!=null&&e.type===n.type)this.content.info=e;else{V(this.content);const o=Du(this,e);o?(this.content=o,o.container&&t.appendChild(o.container),this.exitInputMode()):this.content=null}},ut),x(()=>({container:this.outerContainer,style:this._outerContainerStyle}),({container:e,style:n})=>{Object.assign(e.style,n)},N),x(()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug}),({outerContainer:e,placement:n,effectiveOffset:o,rtl:s,debug:a})=>{const{classList:l}=e;l.add(Si.base),l.toggle(Si.rtl,s),l.toggle(Si.ltr,!s),l.toggle(Si.debug,a),this.outerContainer.style.setProperty("--offset",`${o}px`),oc(e),zu(e,n)},N),Je(()=>this.mode==="feedback",()=>{this.position=null,this._clearOverride("effectivePlacement")},qt),Ri(this.outerContainer,"paste",e=>{this.emit("paste",e)}),Ri(this.outerContainer,["focusin","focusout"],()=>{setTimeout(()=>{var e,n;this._focused=((n=(e=this.content)==null?void 0:e.container)==null?void 0:n.contains(document.activeElement))??!1})})])}destroy(){this.info=null,this.content=V(this.content),this.outerContainer.remove()}get mode(){var t;return((t=this.content)==null?void 0:t.mode)??"feedback"}get focused(){return this._focused}get visible(){return this._outerContainerStyle.display!=="none"}get contentContainer(){var t;return(t=this.content)==null?void 0:t.container}get effectivePlacement(){var e;const t=(e=this.options)==null?void 0:e.placement;return t==="auto"?"bottom-end":t??ju}get _screenPoint(){const{inputManager:t}=this.view;return t!=null&&t.multiTouchActive?null:t==null?void 0:t.latestPointerLocation}get _effectiveOffset(){var t;return((t=this.options)==null?void 0:t.offset)??Pu}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=Cs(t),t!=null&&this.content!=null?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){var a;const e=this.position??this._lastPosition??this._screenPoint,n=this.position=Cs(e),{effectivePlacement:o}=this;this._override("effectivePlacement",o);const s=()=>{n&&(this.position=Lu(this.contentContainer,n,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))};await((a=this.content)==null?void 0:a.enterInputMode(t,s))}async exitInputMode(t){var e;await((e=this.content)==null?void 0:e.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const n=t-this._prevXY[0],o=e-this._prevXY[1];this._prevXY=[t,e];const{position:s}=this;if(s){const{view:a}=this,l=t-a.position[0],p=e-a.position[1];if(l<0||l>a.width||p<0||p>a.height-Vu)return;this.position=Wo(s.x+n,s.y+o)}}onDragEnd(){this._prevXY=[0,0]}};function Lu(i,t,e,n){if(!i||!n.container)return t;const o=i.getBoundingClientRect(),{left:s,top:a}=n.container.getBoundingClientRect();let{x:l,y:p}=t;const h=o.left-s-e;h<0&&(l-=h);const u=o.right-s+e-n.width;u>0&&(l-=u);const d=o.top-a-e;d<0&&(p-=d);const g=o.bottom-a+e-n.height;return g>0&&(p-=g),Wo(l,p)}r([c({nonNullable:!0})],X.prototype,"view",void 0),r([c()],X.prototype,"info",void 0),r([c()],X.prototype,"options",void 0),r([c()],X.prototype,"position",void 0),r([c()],X.prototype,"content",void 0),r([c({readOnly:!0})],X.prototype,"mode",null),r([c()],X.prototype,"_focused",void 0),r([c({readOnly:!0})],X.prototype,"focused",null),r([c({readOnly:!0})],X.prototype,"outerContainer",void 0),r([c({readOnly:!0})],X.prototype,"contentContainer",null),r([c({readOnly:!0})],X.prototype,"effectivePlacement",null),r([c()],X.prototype,"debug",void 0),r([c()],X.prototype,"_lastPosition",void 0),r([c()],X.prototype,"_screenPoint",null),r([c()],X.prototype,"_rtl",void 0),r([c()],X.prototype,"_effectiveOffset",null),r([c()],X.prototype,"_outerContainerStyle",null),X=r([b("esri.views.interactive.Tooltip")],X);const Hu=["top","bottom","leading","trailing"].flatMap(i=>[pn(`${i}-start`),pn(i),pn(`${i}-end`)]);function pn(i){return`${Si.base}--${i}`}function zu({classList:i},t){Hu.forEach(e=>i.remove(e)),i.add(pn(t))}const Uu=X;function Bi(i){const t=new Uu(i());return t.addHandles(x(()=>i(),({view:e,options:n,info:o})=>{t.view=e,n!==void 0&&(t.options=n),o!==void 0&&(t.info=o)})),t}function Zr(i,t){const e=qo(t.vertexSpace),{scale:n,orientation:o}=i,{transform:s}=t,a=Zu(s);e&&a!=null?(o.actual=pi(a,"degrees","arithmetic"),o.visible=!0):(o.actual=null,o.visible=!1),e?(n.actual=Wt(Xr(s)),n.visible=!0):(n.actual=null,n.visible=!1)}function No(i,t,e){if(!t||!qo(t.vertexSpace))return;const n=t.transform??(t.transform=new Gp);Gu(i,n,e),Fu(i,n,e)}function Gu(i,t,e){const n=zp(i.orientation.actual),o=Yr(t.rotationAxis);if(n==null||o==null)return;const s=t.rotationAngle,a=n*o,l=(n-s)*o;s!==a&&(e==null||e.onRotateStart(0),t.rotationAngle=a,e==null||e.onRotate(l),e==null||e.onRotateStop(l))}function Fu(i,t,e){var l;const n=(l=i.scale.actual)==null?void 0:l.value,o=Xr(t);if(n==null||n===o)return;const{scale:s}=t;let a;if(o===0)a=Xe(ac);else{const p=n/o;a=jt(O(),s,p)}e==null||e.onScaleStart(s[0],s[1],s[2]),t.scale=a,e==null||e.onScale(a[0],a[1],a[2]),e==null||e.onScaleStop(a[0],a[1],a[2])}function Br(i,t){const{x:e,y:n,z:o}=t,{x:s,y:a,z:l}=Nu(i,t.spatialReference);return{dx:s==null||Nn(s,e)?0:s-e,dy:a==null||Nn(a,n)?0:a-n,dz:l==null||o==null||Nn(l,o)?0:l-o}}function Nu(i,t){var a,l;let e,n;i.geographic?(e=Kt(i.longitude.actual),n=Kt(i.latitude.actual),rc(t)&&(e!=null&&n!=null?[e,n]=Zn(e,n,Jn):e!=null?e=Zn(e,0,Jn)[0]:n!=null&&(n=Zn(0,n,Jn)[1]))):(e=(a=i.x.actual)==null?void 0:a.value,n=(l=i.y.actual)==null?void 0:l.value);const o=i.elevation.actual,s=er(t);return{x:e,y:n,z:s!=null&&o!=null?ci(o,s):void 0}}const Jn=[0,0];function Zu(i){if(!i)return 0;const t=Yr(i.rotationAxis);return t!=null?t*i.rotationAngle:null}function Yr(i){return uo(i,sr)?1:uo(i,Bu)?-1:null}const Bu=sc(O(),sr);function Xr(i){return i?Math.max(...i.scale):1}function zi(i,t){return!(i.type!=="key-down"||i.key!==Ee.enterInputMode||!t||!Yu(t.info))&&(t.enterInputMode(),i.preventDefault(),i.stopPropagation(),!0)}function Yu(i){const t=i==null?void 0:i.sketchOptions;if(!t)return!1;const{inputEnabled:e,visibleElements:n}=t.tooltips;return e&&i.editableFields.some(({name:o})=>o==="x"||o==="y"?n.coordinates:n[o])===!0}function Wr(i,t){let e=null;return et([i.on("paste",async n=>{e==null||e.abort(),e=mn(async()=>{Cn()||await Oo(),qr(n,i.info,t)})}),mn(()=>Oo()),Z(()=>e==null?void 0:e.abort())])}function qr(i,t,e){var s;if(!t||!("geographic"in t))return;const n=(s=i.clipboardData)==null?void 0:s.getData("text");if(!n)return;const o=a=>{i.stopPropagation(),i.preventDefault(),e==null||e.onBeforePaste(),a(),e==null||e.onAfterPaste()};if(t.geographic){const a=Iu(n);a&&o(()=>{t.longitude.applyValue(a.longitude),t.latitude.applyValue(a.latitude)})}else{const a=Tu(n);a&&o(()=>{t.x.applyValue(a.x),t.y.applyValue(a.y)})}}let z=class extends q{constructor(t){super(t),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter(t=>t.visible&&!t.readOnly)}clearInputValues(){this.allFields.forEach(t=>t.clearInputValue())}};r([c()],z.prototype,"sketchOptions",void 0),r([c()],z.prototype,"visibleElements",null),r([c()],z.prototype,"helpMessage",void 0),r([c()],z.prototype,"viewType",void 0),r([c()],z.prototype,"allFields",null),r([c()],z.prototype,"editableFields",null),z=r([b("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],z);let Ht=class extends z{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=ti}get allFields(){return[]}};r([c()],Ht.prototype,"type",void 0),r([c()],Ht.prototype,"radius",void 0),r([c()],Ht.prototype,"xSize",void 0),r([c()],Ht.prototype,"ySize",void 0),r([c()],Ht.prototype,"area",void 0),r([c()],Ht.prototype,"allFields",null),Ht=r([b("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],Ht);let D=class extends q{constructor(t){super(t),this.actual=null,this.lockable=!0,this.id=lc(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(t){this.lockable&&this._set("committed",t)}get dirty(){return this.inputValue!=null}get locked(){return this.lockable&&this.committed!=null}onInput(t){this.inputValue=t}onCommit(t,e,n){this.lockable?this._onCommitLockable(t,n):this._onCommitNonLockable(n),this.invalid&&t==="commit-and-exit"||n.onCommit(e,t)}_onCommitLockable(t,e){const{inputValue:n,locked:o}=this;o&&nn(n)?this.unlock():(t==="commit-and-exit"&&!o||n!=null)&&this._parseInputAndLock(e)}_onCommitNonLockable(t){const{inputValue:e}=this;nn(e)?this.setActual(null):e!=null&&this._parseInputAndSetActual(t)}applyValue(t){this.lockable?this.lock(t):this.setActual(t)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(t){this.actual=t,this.clearInputValue()}lock(t){this.lockable&&(this.committed=t??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(t){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(t))}getSuffix(t){const{suffix:e}=this;return typeof e=="function"?e(t):e}getFormattedValue(t){const{actual:e,committed:n,format:o}=this;return n!=null?o(n,t):e!=null?o(e,t):null}getRawDisplayValue(t){const{actual:e,committed:n,inputValue:o}=this;return o??(this.lockable&&n!=null?this.formatForInputMode(n,t):e!=null?this.formatForInputMode(e,t):null)}_parseInputAndSetActual(t){const{inputValue:e}=this;if(e==null||nn(e))return this.setActual(null);const n=this.parse(e,t);n!=null?this.setActual(n):this.invalid=!0}_parseInputAndLock(t){const{inputValue:e,actual:n}=this;if(nn(e))return this.unlock();if(e==null)return this.lock(n);const o=this.parse(e,t);o!=null?this.lock(o):this.invalid=!0}};function nn(i){return i!=null&&i.trim()===""}r([c()],D.prototype,"actual",void 0),r([c()],D.prototype,"committed",null),r([c()],D.prototype,"dirty",null),r([c()],D.prototype,"format",void 0),r([c()],D.prototype,"formatForInputMode",void 0),r([c()],D.prototype,"lockable",void 0),r([c()],D.prototype,"locked",null),r([c()],D.prototype,"id",void 0),r([c()],D.prototype,"inputValue",void 0),r([c()],D.prototype,"name",void 0),r([c()],D.prototype,"parse",void 0),r([c()],D.prototype,"readOnly",void 0),r([c()],D.prototype,"suffix",void 0),r([c()],D.prototype,"title",void 0),r([c()],D.prototype,"visible",void 0),r([c()],D.prototype,"invalid",void 0),r([c()],D.prototype,"unlockOnVertexPlacement",void 0),D=r([b("esri.views.interactive.tooltip.fields.TooltipField")],D);let hn=class extends D{constructor(t){super(t),this.showAsZ=!1}normalizeCtorArgs(t){const e=n=>n.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:U,parse:Qt({createQuantity:(n,o)=>Ce(n,e(o))}),format:(n,o)=>o.formatters.verticalLength(n),formatForInputMode:(n,o)=>o.formatters.scalar(Ae(n,e(o))),suffix:n=>n.inputUnitInfos.verticalLength.abbreviation,title:n=>n.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...t}}};r([c()],hn.prototype,"showAsZ",void 0),hn=r([b("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],hn);let un=class extends D{constructor(t){super(t),this.precision=1}normalizeCtorArgs(t){const e=n=>n.inputUnitInfos.angle.unit;return{name:"orientation",actual:null,parse:Qt({createQuantity:(n,o)=>pi(n,e(o),"geographic"),sanitize:Ur}),format:n=>{const o=na(n);return In(o,"geographic",this.precision)},formatForInputMode:(n,o)=>{const s=na(n);return o.formatters.scalar(s)},suffix:n=>n.inputUnitInfos.angle.abbreviation,title:n=>n.messages.sketch.orientation,...t}}};r([c()],un.prototype,"precision",void 0),un=r([b("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],un);let dn=class extends D{constructor(t){super(t),this.precision=null}normalizeCtorArgs(t){const e=n=>n.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:Qt({createQuantity:(n,o)=>Ce(n,e(o))}),format:(n,o)=>o.formatters.length(n),formatForInputMode:(n,o)=>o.formatters.scalar(Ae(n,e(o))),suffix:n=>n.inputUnitInfos.length.abbreviation,title:n=>n.messages.sketch.size,...t}}};r([c()],dn.prototype,"precision",void 0),dn=r([b("esri.views.interactive.tooltip.fields.TooltipFieldSize")],dn);function Kr(i){const t=n=>n.inputUnitInfos.angle.unit,e=n=>n.sketchOptions.values.effectiveDirectionMode;return new D({name:"direction",actual:Ko,parse:Qt({createQuantity:(n,o)=>pi(n,t(o),"geographic"),sanitize:Ur}),format:(n,o)=>{const s=e(o),a=oa(n,s);switch(s){case ct.Absolute:return o.formatters.direction(a);case ct.Relative:return o.formatters.directionRelative(a);case ct.RelativeBilateral:return o.formatters.directionRelativeBilateral(a)}},formatForInputMode:(n,o)=>{const s=oa(n,e(o));return o.formatters.scalar(Ae(s,t(o)))},suffix:n=>n.inputUnitInfos.angle.abbreviation,title:n=>{const o=e(n),{absolute:s,relative:a}=n.messages.sketch.direction;switch(o){case ct.Absolute:return s;case ct.Relative:case ct.RelativeBilateral:return a}},...i})}function hs(i){const t=e=>e.inputUnitInfos.length.unit;return new D({name:"distance",actual:U,parse:Qt({createQuantity:(e,n)=>Ce(Math.max(e,0),t(n))}),format:(e,n)=>n.formatters.length(e),formatForInputMode:(e,n)=>n.formatters.scalar(Ae(e,t(n))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.distance,...i})}function us(i){return hs({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0,...i})}function Qr(i){return hs({...i})}function Xu(i){const t=e=>e.inputUnitInfos.length.unit;return hs({...i,parse:Qt({createQuantity:(e,n)=>Ce(e,t(n))}),format:(e,n)=>n.formatters.lengthRelative(e)})}function Wu(i){return new hn(i)}function ds(i){return new un(i)}function qu(i){return new dn(i)}function Jr(i){return fs("scale",{name:"scale",actual:null,parse:Qt({createQuantity:t=>Wt(Math.abs(t))}),...i})}function gs(i){const t=e=>e.inputUnitInfos.area.unit;return new D({name:"area",actual:ti,parse:Qt({createQuantity:(e,n)=>cc(e,t(n))}),format:(e,n)=>n.formatters.area(e),formatForInputMode:(e,n)=>n.formatters.scalar(Ae(e,t(n))),suffix:e=>e.inputUnitInfos.area.abbreviation,title:e=>e.messages.sketch.area,readOnly:!0,...i})}function Ku(i){return new D({name:"x",actual:Ko,parse:ku,format:(t,e)=>e.formatters.longitudeDecimalDegrees(t),formatForInputMode:t=>xu(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.longitude,...i})}function Qu(i){return new D({name:"y",actual:Ko,parse:Ru,format:(t,e)=>e.formatters.latitudeDecimalDegrees(t),formatForInputMode:t=>wu(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.latitude,...i})}function Ju(i){return fs("x",{name:"x",...i})}function td(i){return fs("y",{name:"y",...i})}function fs(i,t){return new D({actual:Wt(0),parse:Qt({createQuantity:e=>Wt(e)}),format:(e,n)=>n.formatters.scalar(e),formatForInputMode:(e,n)=>n.formatters.scalar(e),title:e=>e.messages.sketch[i],...t})}const ve=i=>{let t=class extends i{constructor(){super(...arguments),this.longitude=Ku(),this.latitude=Qu(),this.x=Ju(),this.y=td(),this.elevation=Wu(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(e,n=e==null?void 0:e.spatialReference){if(this.geographic=!!n&&Np(n),e==null)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const o=pc(e,ed);this._setActualLonLat(ni(o==null?void 0:o[0]),ni(o==null?void 0:o[1]))}else this._setActualXY(Wt(e.x),Wt(e.y))}_setActualLonLat(e,n){this.longitude.actual=e,this.latitude.actual=n}_setActualXY(e,n){this.x.actual=e,this.y.actual=n}};return r([c()],t.prototype,"geographic",void 0),r([c()],t.prototype,"effectiveX",null),r([c()],t.prototype,"effectiveY",null),r([c()],t.prototype,"key",null),t=r([b("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],t),t},ed=[0,0];let Oi=class extends ve(z){constructor(t){super(t),this.type="draw-mesh",this.orientation=ds({lockable:!1}),this.scale=Jr({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};r([c()],Oi.prototype,"helpMessage",void 0),r([c()],Oi.prototype,"allFields",null),Oi=r([b("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],Oi);let $i=class extends ve(z){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};r([c()],$i.prototype,"helpMessage",void 0),r([c()],$i.prototype,"allFields",null),$i=r([b("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],$i);let Ue=class extends ve(z){constructor(t){super(t),this.type="draw-polygon",this.direction=Kr(),this.distance=Qr(),this.area=gs(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};r([c()],Ue.prototype,"xyMode",void 0),r([c()],Ue.prototype,"helpMessage",void 0),r([c()],Ue.prototype,"allFields",null),Ue=r([b("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],Ue);let Ge=class extends ve(z){constructor(t){super(t),this.type="draw-polyline",this.direction=Kr(),this.distance=Qr(),this.totalLength=us(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};r([c()],Ge.prototype,"helpMessage",void 0),r([c()],Ge.prototype,"xyMode",void 0),r([c()],Ge.prototype,"allFields",null),Ge=r([b("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Ge);let oe=class extends z{constructor(t){super(t),this.type="draw-rectangle",this.xSize=U,this.ySize=U,this.area=ti}get allFields(){return[]}};r([c()],oe.prototype,"type",void 0),r([c()],oe.prototype,"xSize",void 0),r([c()],oe.prototype,"ySize",void 0),r([c()],oe.prototype,"area",void 0),r([c()],oe.prototype,"allFields",null),oe=r([b("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],oe);function id(i,t,e=Or()){{const n=Zp(i);return n??Bp(i,e)}}function Vn(i,t=Or()){return id(i,"on-the-ground",t)}function nd(i,t){return{point:new $i({sketchOptions:t,viewType:i}),polyline:new Ge({sketchOptions:t,viewType:i}),polygon:new Ue({sketchOptions:t,viewType:i}),mesh:new Oi({sketchOptions:t,viewType:i}),rectangle:new oe({sketchOptions:t}),circle:new Ht({sketchOptions:t})}}function Ma(i){const{directionOptions:t,geometryType:e,sketchOptions:n,tooltipInfos:o}=i,s=l=>{const p=jn(i).mode,h=o[l].elevation;p==="relative-to-ground"||p==="relative-to-scene"||p==="on-the-ground"?h.lock(ms(i)):h.unlock()},a=l=>{if(t){const p=o[l].direction;p.committed=t.angle,p.unlockOnVertexPlacement=!1,n.values.directionMode=t.mode}};switch(e){case"polygon":case"polyline":s(e),a(e);break;case"point":case"mesh":s(e)}}function od(i,t){const{drawOperation:e,view:n}=t,o=vs(t),s=jn(t);if(n.type==="2d"||!i||s.mode!=="absolute-height"||(e==null?void 0:e.numCommittedVertices)!==1||!o||o.type!=="draw-polyline"&&o.type!=="draw-polygon"||o.elevation.locked)return;const[a,l,p]=i,h=vd(a,l,p,s,t);h!=null&&o.elevation.lock(h)}function xa(i){var t;(t=vs(i))==null||t.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function vs({geometryType:i,graphic:t,tooltipInfos:e}){var n;return i==="multipoint"||((n=t==null?void 0:t.geometry)==null?void 0:n.type)!==sd[i]?null:e[i]}const sd={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function ad(i,t){switch(i==null?void 0:i.type){case"draw-point":rd(i,t);break;case"draw-polyline":cd(i,t);break;case"draw-polygon":pd(i,t);break;case"draw-rectangle":ud(i,t);break;case"draw-circle":dd(i,t);break;case"draw-mesh":ld(i,t)}}function rd(i,t){var n;const e=(n=t.graphic)==null?void 0:n.geometry;(e==null?void 0:e.type)==="point"&&(tl(i,e,t),i.helpMessage=cs("point",e))}function ld(i,t){const{graphic:e,view:n}=t,o=e==null?void 0:e.geometry;n.type!=="3d"||o&&o.type!=="mesh"||(tl(i,o==null?void 0:o.origin,t),o&&Zr(i,o),i.helpMessage=Bh(e,n))}function tl(i,t,e){const{drawOperation:n,view:o,sketchOptions:s}=e,{cursorVertex:a}=n;if(i.sketchOptions=s,i.viewType=o.type,i.setLocationFromPoint(t,gi(e)),il(i.elevation,e),!a)return void(n.constraints=void 0);const l=a;n.constraints={context:al(l,e),x:i.x.committed,y:i.y.committed,longitude:i.longitude.committed,latitude:i.latitude.committed,elevation:i.elevation.committed,distance:null,direction:null}}function cd(i,t){const{createOperationGeometry:e,drawOperation:n}=t,o=e!=null?e.full:null;o&&o.type!=="polyline"||(el(i,t),i.totalLength.actual=n.lastVertex?(o?ns(o):null)??U:null,i.helpMessage=cs("polyline",o))}function pd(i,t){const{createOperationGeometry:e,drawOperation:n}=t,o=e!=null?e.full:null;o&&o.type!=="polygon"||(el(i,t),i.area.actual=n.lastVertex?(o?Vn(o):null)??ti:null,i.helpMessage=cs("polygon",o))}function el(i,t){const{drawOperation:e,sketchOptions:n,view:o}=t,{cursorVertex:s,lastVertex:a,secondToLastVertex:l}=e,p=n.values.effectiveDirectionMode;i.sketchOptions=n,i.viewType=o.type;const h=a&&s?de(a,s)??U:null;if(i.distance.actual=h,i.distance.readOnly=a==null,i.direction.actual=null,i.direction.readOnly=!0,a&&s&&(p==="absolute"||l)){const g=Up(l,a,s,p);i.direction.actual=g??hc,i.direction.readOnly=!1}i.setLocationFromPoint(s,gi(t)),il(i.elevation,t);const u=hd(a,t);i.xyMode=u,i.direction.visible=u==="direction-distance",i.distance.visible=u==="direction-distance",i.effectiveX.visible=u==="coordinates",i.effectiveY.visible=u==="coordinates";const d=s??a;e.constraints=d?{context:al(d,t),x:i.x.committed,y:i.y.committed,longitude:i.longitude.committed,latitude:i.latitude.committed,elevation:i.elevation.committed,distance:i.distance.committed,direction:i.direction.committed}:void 0}function hd(i,{sketchOptions:t}){const e=t.tooltips.xyMode;return e==="auto"?i?"direction-distance":"coordinates":e}function ud(i,t){i.sketchOptions=t.sketchOptions,i.xSize=ol(t),i.ySize=sl(t),i.area=nl(t)}function dd(i,t){const{forceUniformSize:e,sketchOptions:n}=t;i.sketchOptions=n,i.radius=e?gd(t):null,i.xSize=e?null:ol(t),i.ySize=e?null:sl(t),i.area=nl(t)}function il(i,t){const{drawOperation:e}=t,n=(e==null?void 0:e.cursorVertex)??(e==null?void 0:e.lastVertex);i.actual=yr(n)??ms(t),i.visible=e.hasZ,i.readOnly=!1,i.showAsZ=!0}function nl(i){var e;const t=(e=i.createOperationGeometry)==null?void 0:e.full;return(t==null?void 0:t.type)!=="polygon"?ti:Vn(t)??ti}function ol(i){var e,n;const t=(n=(e=i.createOperationGeometry)==null?void 0:e.rectangle)==null?void 0:n.midpoints;return(t!=null?de(t.left,t.right):null)??U}function sl(i){var e,n;const t=(n=(e=i.createOperationGeometry)==null?void 0:e.rectangle)==null?void 0:n.midpoints;return(t!=null?de(t.top,t.bottom):null)??U}function gd({createOperationGeometry:i}){var t;return(((t=i==null?void 0:i.circle)==null?void 0:t.center)!=null&&i.circle.edge!=null?de(i.circle.center,i.circle.edge):null)??U}function fd(i){const{geometryType:t,tooltipInfos:e}=i;switch(t){case"point":case"mesh":case"polyline":case"polygon":{const n=e[t].elevation.committed;return n?ci(n,"meters")/En(gi(i)):void 0}default:return}}function vd(i,t,e,n,o){const{view:s,drawOperation:a}=o;if(s.type!=="3d"||!a)return;e??(e=0);const l=gi(o),p=jn(o),h=ir(s,i,t,e,l,p,n);return rp(h,l)??ms(o)}function jn(i){return i.drawOperation.elevationInfo??Wa}function gi(i){return i.drawOperation.coordinateHelper.spatialReference}function ms(i){const t=En(gi(i));return Ce(i.defaultZ*t,"meters")}function al(i,t){return qh(i,t.view,gi(t),jn(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}let gn=class extends q{constructor(t){super(t),this.enabled=!1}};r([c({type:Boolean,nonNullable:!0})],gn.prototype,"enabled",void 0),gn=r([b("esri.views.interactive.sketch.SketchLabelOptions")],gn);const Ln=gn;let Ai=class extends q{constructor(t){super(t),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};r([c({type:String,nonNullable:!0})],Ai.prototype,"mode",void 0),Ai=r([b("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Ai);let ot=class extends q{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};r([c({type:Boolean,nonNullable:!0})],ot.prototype,"area",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"coordinates",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"direction",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"distance",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"elevation",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"header",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"helpMessage",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"orientation",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"radius",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"rotation",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"scale",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"size",void 0),r([c({type:Boolean,nonNullable:!0})],ot.prototype,"totalLength",void 0),ot=r([b("esri.views.interactive.sketch.SketchTooltipVisibleElements")],ot);const rl=ot;let rt=class extends q{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Ai,this.placement="auto",this.offset=null,this.visibleElements=new rl,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};r([c({type:Boolean,nonNullable:!0})],rt.prototype,"enabled",void 0),r([c()],rt.prototype,"forceEnabled",void 0),r([c()],rt.prototype,"effectiveEnabled",null),r([c()],rt.prototype,"helpMessage",void 0),r([c()],rt.prototype,"helpMessageIcon",void 0),r([c({type:Boolean,nonNullable:!0})],rt.prototype,"inputEnabled",void 0),r([c({type:Ai,nonNullable:!0})],rt.prototype,"elevation",void 0),r([c()],rt.prototype,"placement",void 0),r([c()],rt.prototype,"offset",void 0),r([c({type:rl,nonNullable:!0})],rt.prototype,"visibleElements",void 0),r([c()],rt.prototype,"visualVariables",void 0),r([c()],rt.prototype,"xyMode",void 0),rt=r([b("esri.views.interactive.sketch.SketchTooltipOptions")],rt);const ll=rt;let Fe=class extends q{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};r([c()],Fe.prototype,"length",void 0),r([c()],Fe.prototype,"verticalLength",void 0),r([c()],Fe.prototype,"area",void 0),Fe=r([b("esri.views.interactive.sketch.Units")],Fe);const On=Fe;let se=class extends q{constructor(t){super(t),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?ct.RelativeBilateral:ct.Relative;case"absolute":return ct.Absolute}}get displayUnits(){return this._get("displayUnits")??new On}set displayUnits(t){this._set("displayUnits",t)}get inputUnits(){return this._get("inputUnits")??new On}set inputUnits(t){this._set("inputUnits",t)}};r([c({type:String,nonNullable:!0})],se.prototype,"directionMode",void 0),r([c({type:Boolean,nonNullable:!0})],se.prototype,"relativeDirectionIsBilateral",void 0),r([c()],se.prototype,"effectiveDirectionMode",null),r([c({type:On,nonNullable:!0})],se.prototype,"displayUnits",null),r([c({type:On,nonNullable:!0})],se.prototype,"inputUnits",null),se=r([b("esri.views.interactive.sketch.SketchValueOptions")],se);const cl=se;let Ne=class extends q{constructor(t){super(t),this.labels=new Ln,this.tooltips=new ll,this.values=new cl}};r([c({nonNullable:!0,type:Ln})],Ne.prototype,"labels",void 0),r([c({nonNullable:!0,type:ll})],Ne.prototype,"tooltips",void 0),r([c({nonNullable:!0,type:cl})],Ne.prototype,"values",void 0),Ne=r([b("esri.views.interactive.sketch.SketchOptions")],Ne);const Lt=Ne;let C=class extends dt.EventedMixin(Ni){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Lt}initialize(){const{view:t}=this;this.internalGraphicsLayer=new uc({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=nd(t.type,this.sketchOptions);const n=Bi(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=n,Ma(this._tooltipsContext),this._coordinateFormatterLoadTask=mn(()=>Oo()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,n.on("paste",o=>qr(o,this.activeTooltipInfo)),x(()=>this.cursor,o=>{e.cursor=o},ut),mo(()=>{const{activeTooltipInfo:o,sketchOptions:s}=this;ad(o,this._tooltipsContext),n.info=s.tooltips.effectiveEnabled?o:null}),mo(()=>{e.constraintZ=fd(this._tooltipsContext)},qt)]),this.finishToolCreation()}destroy(){this.drawOperation=V(this.drawOperation),this.tooltip=V(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=V(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){var t;return((t=this.drawOperation)==null?void 0:t.updating)??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof Dt?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||zi(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Ma(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(yt.outline),this.removeHandles(yt.regularVertices),this.removeHandles(yt.activeVertex),this.removeHandles(yt.activeEdge),this.removeHandles(to)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new dc({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(Z(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),to),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){var w,_;if(this.drawOperation==null)return;const{coordinateHelper:e,view:n,visualizationCursorVertex:o,lastVertex:s,committedVertices:a,geometryIncludingUncommittedVertices:l,numCommittedVertices:p}=this.drawOperation;if(!(p>0||o!=null))return;const h=t.operationComplete?a:l,u=h.length,d=o!=null?e.pointToArray(o):null,g=this._drawSpatialReference,v=n.type==="3d"&&n.viewingMode==="global",f=new Ph;f.committedVertices=a,f.cursorVertex=d;const{geometryType:m}=this;switch(m){case"point":case"mesh":f.full=e.arrayToPoint(h[0]);break;case"multipoint":f.full=u>0?zh(h,g):null;break;case"polyline":case"polygon":u>0&&(f.full=m==="polygon"?Zi([h],g,v,!0):da([h],g,v),f.cursorEdge=d!=null&&s&&!cn(o,s)?da([[d,e.pointToArray(s)]],g,v):null,f.outline=u>1?f.full:null);break;case"circle":case"rectangle":{if(f.committedVertices=f.cursorVertex=null,!u)break;const M=Hh(n,h[0]),k=h[0],G=M.makeMapPoint(k[0]+_d*n.resolution,k[1]);m==="circle"?u===1&&t.operationComplete?f.circle=fa([k,G],M,!0):u===2&&(this.forceUniformSize?f.circle=fa(h,M,this.centered):f.rectangle=Gh(h,M,this.centered)):u===1&&t.operationComplete?f.rectangle=ga([k,G],M,!0):u===2&&(f.rectangle=this.forceUniformSize?ga(h,M,this.centered):Uh(h,M,this.centered)),f.full=f.circle!=null?f.circle.geometry:(w=f.rectangle)==null?void 0:w.geometry,f.outline=((_=f.full)==null?void 0:_.type)==="polygon"?f.full:null;break}default:return null}return f}initializeGraphic(t){return Z()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const n=this._getCreateOperationGeometry({operationComplete:!0});n!=null&&(e=this._createOrUpdateGraphic(n.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return Z()}onCursorEdgeChanged(t){return Z()}onVertexAdd(t){var e;xa(this._tooltipsContext),this._updateGraphic(),od((e=t.vertices.at(0))==null?void 0:e.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){xa(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),yt.activeEdge):this.removeHandles(yt.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),yt.outline):this.removeHandles(yt.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),yt.regularVertices):this.removeHandles(yt.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),yt.activeVertex):this.removeHandles(yt.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(to)):this._destroyAllVisualizations()}get activeTooltipInfo(){var t;return(t=this._coordinateFormatterLoadTask)!=null&&t.finished?vs(this._tooltipsContext):null}};r([c()],C.prototype,"_coordinateFormatterLoadTask",void 0),r([c()],C.prototype,"_createOperationGeometry",void 0),r([c()],C.prototype,"_tooltipsContext",null),r([c({value:!0})],C.prototype,"centered",null),r([c()],C.prototype,"cursor",null),r([c({nonNullable:!0})],C.prototype,"defaultZ",void 0),r([c({constructOnly:!0})],C.prototype,"directionOptions",void 0),r([c()],C.prototype,"drawOperation",void 0),r([c({value:!0})],C.prototype,"enabled",null),r([c({value:!0})],C.prototype,"forceUniformSize",null),r([c({constructOnly:!0})],C.prototype,"geometryType",void 0),r([c()],C.prototype,"graphic",null),r([c({constructOnly:!0})],C.prototype,"graphicProperties",void 0),r([c()],C.prototype,"graphicSymbol",null),r([c({constructOnly:!0})],C.prototype,"hasZ",void 0),r([c({constructOnly:!0})],C.prototype,"geometryToPlace",void 0),r([c()],C.prototype,"mode",null),r([c()],C.prototype,"snappingManager",void 0),r([c()],C.prototype,"snapToScene",void 0),r([c()],C.prototype,"tooltip",void 0),r([c()],C.prototype,"tooltipInfos",void 0),r([c({constructOnly:!0,type:Lt})],C.prototype,"sketchOptions",void 0),r([c()],C.prototype,"updating",null),r([c({constructOnly:!0,nonNullable:!0})],C.prototype,"view",void 0),r([c({constructOnly:!0})],C.prototype,"undoRedo",null),r([c()],C.prototype,"activeTooltipInfo",null),C=r([b("esri.views.draw.DrawGraphicTool")],C);const to=Symbol("create-operation-graphic"),yt={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function md(i){switch(i){case"point":case"polyline":case"polygon":case"multipoint":return i;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const _d=48,pl="click";class yd{constructor({consumesClicks:t,grabbableForEvent:e}){this.events=new dt,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=e}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}const bd="crosshair",Md="progress",wa=Symbol(),Sa=Symbol();let S=class extends dt.EventedMixin(q){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Kp,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new ai,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=xo(tu),this._getPolylineOrPolygonConstraint=xo(eu),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Ln,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=ar(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,n=e.spatialReference,o="viewingMode"in e.state?e.state.viewingMode:rr.Local,s=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=Qp(this.hasZ,this.hasM,n),this._editGeometryOperations=new kn(new Jp(s,this.coordinateHelper),o),this._snappingOperation=new cp({view:e}),this.addHandles([x(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:p,constraint:h},u)=>{const{snappingOptions:d}=this;if(d&&(d.forceDisabled=h!=null&&jp(h)),u!=null&&p===u.stagedPoint&&h!==u.constraint)return this._onKeyboardBasedChange();this._processCursor(p??this._screenToMap(this._stagedScreenPoint))},{equals:(p,h)=>p.stagedPoint===h.stagedPoint&&gc(p.constraint,h.constraint)}),x(()=>this.view.viewpoint,(p,h)=>{p&&h&&fc(p,h)&&this._onKeyboardBasedChange()})]),this._activeComponent=new th(n,o),this._editGeometryOperations.data.components.push(this._activeComponent);const a=this.segmentLabels;a!=null&&(a.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(x(()=>this.labelOptions.enabled,p=>{a.visible=p},ut))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],p=>{var f,m,w,_;const h=p.vertices.map(M=>({componentIndex:0,vertexIndex:M.index,coordinates:this.coordinateHelper.vectorToArray(M.pos)})),u=h.map(M=>M.coordinates),d=this.coordinateHelper.vectorToDehydratedPoint((f=this._activeComponent.getFirstVertex())==null?void 0:f.pos)??null;cn(d,this.firstVertex)||(this.firstVertex=d);const g=this.coordinateHelper.vectorToDehydratedPoint((m=this._activeComponent.getLastVertex())==null?void 0:m.pos)??null;cn(g,this.lastVertex)||(this.lastVertex=g);const v=this.coordinateHelper.vectorToDehydratedPoint((_=(w=this._activeComponent.edges.at(-1))==null?void 0:w.leftVertex)==null?void 0:_.pos)??null;switch(cn(v,this.secondToLastVertex)||(this.secondToLastVertex=v),this._processCursor(this.cursorVertex),p.type){case"vertex-add":this.emit(p.type,{...p,added:u,vertices:h});break;case"vertex-update":this.emit(p.type,{...p,updated:u,vertices:h});break;case"vertex-remove":this.emit(p.type,{...p,removed:u,vertices:h})}}));const l=this._manipulator=new yd({consumesClicks:!1,grabbableForEvent:p=>this.drawingMode!=="click"||p.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(l),l.grabbable=t!=="point",this.addHandles([l.events.on("immediate-click",p=>this._onImmediateClick(p)),l.events.on("immediate-double-click",p=>this._onImmediateDoubleClick(p)),x(()=>this.drawingMode,()=>{this.removeHandles(wa),this.addHandles(this._createManipulatorDragPipeline(l),wa)},ut),x(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:p})=>{l.cursor=p},ut)]),Lp(this,()=>{const p=this.view.inputManager.latestPointerType??"mouse",h=this._getSnappingContext(p);if(this.snappingManager!=null){const u=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,h);this._updatingHandles.addPromise(As(u))}})}destroy(){V(this.segmentLabels),V(this._snappingOperation),this._editGeometryOperations=V(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:e}=this;return t!=null&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}get _constraint(){const{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??pl)}get effectiveCursor(){return this.loading?Md:this._hideDefaultCursor?null:this.cursor||bd}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:e,firstVertex:n,geometryType:o}=this;return o==="polygon"&&Xn(t,n)||Xn(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:e,coordinateHelper:n}=this,o=t.slice();return e!=null&&o.push(n.pointToArray(e)),o}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){var a;const e=(t==null?void 0:t.aborted)||!1;this._snappingOperation.abort(),(a=this.snappingManager)==null||a.doneSnapping();const{geometryType:n,numCommittedVertices:o}=this,s=n==="multipoint"&&o===0||n==="polyline"&&o<2||n==="polygon"&&o<3;n!=="segment"&&n!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!s,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((l,p)=>({componentIndex:0,vertexIndex:p,coordinates:l})),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){var l,p;const e=fo(this.cursorVertex),n=fo(t),o=n&&(((l=this._updateAndGetEffectiveDrawSurface())==null?void 0:l.constrainZ(n))??n),s=this._snapToClosingVertex(o),a=this._applyConstraints(s);Xn(e,a)||(this._set("cursorVertex",a),(p=this.segmentLabels)==null||p.set("stagedVertex",a!=null?this.coordinateHelper.pointToVector(a):null),a==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(a)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;const e=this._mapToScreen(t);if(!e)return t;const n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return kt(t,(e,n,o,s)=>{const a=s==="touch"&&this._snappingEnabled;if(this.isCompleted||!a)return;const{snappingStep:l,cancelSnapping:p}=ji({predicate:()=>a,snappingManager:this.snappingManager,snappingContext:new ii({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:s,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});o=o.next(h=>(a&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),h)).next(p),n.next(this._screenToMapDragEventStep()).next(h=>(h.action==="start"&&(this._processCursor(h.mapStart),(this.geometryType==="segment"||a&&!this.numCommittedVertices)&&this.commitStagedVertex()),h)).next(wo(this.view,this.elevationInfo)).next(...l).next(h=>(a&&(this._processCursor(h.mapEnd),h.action==="end"&&this.commitStagedVertex()),h)).next(h=>(h.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),h))})}_createManipulatorDragPipelineFreehand(t){return kt(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(o.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this._processCursor(o.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return o})})}_createManipulatorDragPipelineHybrid(t){return kt(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Sa),this._processCursor(o.mapStart),this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this._processCursor(o.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(Sa),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return o})})}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:e,geometryType:n,numCommittedVertices:o}=this;return t?e!=null||n==="segment"&&o>0:(n==="segment"||n==="polygon")&&o>0}_updateAndGetEffectiveDrawSurface(){var h;const{constraintsEnabled:t,coordinateHelper:e,drawSurface:n,elevationDrawSurface:o,snapToSceneEnabled:s}=this;if(o==null)return n;if(!this.hasZ)return o.defaultZ=null,o;const a=(h=this.elevationInfo)==null?void 0:h.mode;let l=this.defaultZ,p=t||a==="absolute-height";return s!=null&&(p=s),a==="on-the-ground"&&(p=!1),this._drawAtFixedElevation&&(l=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),p=!1),p?n:(o.defaultZ=l,o)}_mapToScreen(t){var e;return(e=this._updateAndGetEffectiveDrawSurface())==null?void 0:e.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{const{drawingMode:e,geometryType:n}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const o=this._screenToMap(t.screenPoint);if(o==null||o==null||e==="freehand"&&n!=="point")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(o),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(e==="freehand"||n==="point"||n==="segment"&&this.numCommittedVertices===2||n==="segment"&&e==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=Wo(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){var p;const n=this._snappingOperation,o=this._screenToMap(t),s=this._requiresScenePoint?(p=this.drawSurface)==null?void 0:p.screenToMap(t):null;if(o==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const a=this.snappingManager;if(a==null)return this._processCursor(o),void n.abort();const l=this._getSnappingContext(e);this._updatingHandles.addPromise(As(n.snap({point:o,scenePoint:s},a,l)))}_applyConstraints(t){const{_constraint:e,constraints:n}=this;if(!t||!n||!e)return t;const{context:o}=n,s=An(t,o),a=s?e.closestTo(s):void 0;if(!a)return t;const l=nu(a,t,o),p=this.view.type==="2d"||o.elevationInfo.mode!=="absolute-height";return l!=null&&p&&this.constraintZ!=null&&this.hasZ&&(l.z=this.constraintZ),l}_screenToMap(t){var e;return t?(e=this._updateAndGetEffectiveDrawSurface())==null?void 0:e.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;const n=this._screenToMap(e.screenEnd);return n!=null?{...e,mapStart:t,mapEnd:n}:null}}_vertexWithinPointerDistance(t,e){const o=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return o!=null&&xd(o,e,25)}_getSnappingContext(t){var n;const e=this._drawAtFixedElevation?(n=this.elevationDrawSurface)==null?void 0:n.defaultZ:null;return new ii({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function xd(i,t,e){const n=i.x-t.x,o=i.y-t.y;return n*n+o*o<=e}r([c()],S.prototype,"_hideDefaultCursor",void 0),r([c()],S.prototype,"_stagedPointerId",void 0),r([c()],S.prototype,"_isDragging",null),r([c()],S.prototype,"_snappingOperation",void 0),r([c()],S.prototype,"_snappingEnabled",null),r([c({constructOnly:!0})],S.prototype,"graphic",void 0),r([c()],S.prototype,"constraintsEnabled",void 0),r([c()],S.prototype,"constraints",void 0),r([c()],S.prototype,"_constraint",null),r([c()],S.prototype,"constraintZ",void 0),r([c()],S.prototype,"defaultZ",void 0),r([c()],S.prototype,"isDraped",void 0),r([c({value:pl})],S.prototype,"drawingMode",null),r([c({constructOnly:!0})],S.prototype,"elevationDrawSurface",void 0),r([c({constructOnly:!0})],S.prototype,"elevationInfo",void 0),r([c({constructOnly:!0,type:Ln})],S.prototype,"labelOptions",void 0),r([c({constructOnly:!0})],S.prototype,"geometryType",void 0),r([c({constructOnly:!0})],S.prototype,"hasM",void 0),r([c({constructOnly:!0})],S.prototype,"hasZ",void 0),r([c()],S.prototype,"cursor",void 0),r([c()],S.prototype,"effectiveCursor",null),r([c()],S.prototype,"loading",void 0),r([c({constructOnly:!0})],S.prototype,"manipulators",void 0),r([c({constructOnly:!0})],S.prototype,"drawSurface",void 0),r([c({constructOnly:!0})],S.prototype,"segmentLabels",void 0),r([c({constructOnly:!0})],S.prototype,"snappingManager",void 0),r([c({constructOnly:!0})],S.prototype,"snappingVisualizer",void 0),r([c()],S.prototype,"snapToSceneEnabled",void 0),r([c({readOnly:!0})],S.prototype,"cursorVertex",null),r([c({readOnly:!0})],S.prototype,"visualizationCursorVertex",null),r([c()],S.prototype,"committableVertex",null),r([c()],S.prototype,"firstVertex",void 0),r([c()],S.prototype,"lastVertex",void 0),r([c()],S.prototype,"secondToLastVertex",void 0),r([c()],S.prototype,"updating",null),r([c({constructOnly:!0})],S.prototype,"view",void 0),S=r([b("esri.views.draw.DrawOperation")],S);let wd=class{constructor(t,e,n,o=null){this._elevationInfo=t,this.defaultZ=e,this._view=n,this._excludeGraphics=o}screenToMap(t){const{defaultZ:e,_view:n}=this,o=n.sceneIntersectionHelper.intersectElevationFromScreen(Re(t.x,t.y),this._elevationInfo,e??0,this._excludeGraphics);return e==null&&o!=null&&(o.z=void 0),o}mapToScreen(t){const e=ge(t.x,t.y,Qo(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(e)}constrainZ(t){const{defaultZ:e}=this;return e!=null&&t.z!==e&&((t=vc(t)).z=e),t}},Sd=class{constructor(t,e,n=[]){this.view=t,this.elevationInfo=e,this.exclude=n}screenToMap(t){const e=this.view.toMap(t,{exclude:this.exclude,excludeLabels:!0});return e!=null&&(e.z=lr(e,this.view,this.elevationInfo)),e}mapToScreen(t){let e=t;return this.elevationInfo!=null&&(e=ge(t.x,t.y,Qo(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(e)}constrainZ(t){return t}};new ri;let Le=class extends C{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new ui({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:t,offset:e,unit:n}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Yo({mode:t,offset:e,unit:n})}normalizeCtorArgs(t){if(!t.elevationInfo){const e=t.hasZ??!0;return{...t,elevationInfo:ar(e)}}return t}initializeGraphic(t){const{view:e}=this,n=this._createGraphicState=new Nt({graphic:t});return et([e.maskOccludee(t),e.trackGraphicState(n),x(()=>({element:this._outlineVisualElement,isDraped:n.isDraped}),({element:o,isDraped:s})=>{o&&(o.isDraped=s)},ut),mo(()=>{No(this.tooltipInfos.mesh,this.geometryToPlace)}),this._setupLoadingIndicator(n),...ls(n)])}makeDrawOperation(){const{geometryType:t}=this,e=t!=="circle"&&t!=="rectangle";return new S({view:this.view,manipulators:this.manipulators,geometryType:md(t),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Sd(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new wd(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Li,segmentLabels:e?new wn:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:Ds(this.hasZ,this.elevationInfo)==="on-the-ground",cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){const{view:e}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[t],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(t),Z();const n=this._settings,o=n.manipulators.vertex,s=new Ys({view:e,spatialReference:e.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:o.size,outlineSize:o.outlineSize,renderOccluded:o.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=s;const a=n.visualElements.zVerticalLine,l=new os({view:e,extensionType:a.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Oe.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=l;const p=et([x(()=>n.visualElements.zVerticalLine,h=>h.apply(l),N),x(()=>({selectedColor:lt(n.colors.selected),outlineColor:lt(n.manipulators.vertex.outlineColor)}),({selectedColor:h,outlineColor:u})=>{s.color=h,s.outlineColor=u},N),Z(()=>{this._activeVertexVisualElement=V(this._activeVertexVisualElement),this._verticalLineVisualElement=V(this._verticalLineVisualElement)})]);return s.attached=!0,this._updateVerticalLineVisualElement(t),p}_updateVerticalLineVisualElement(t){const e=this._verticalLineVisualElement;if(!e)return;const{renderCoordsHelper:n,elevationProvider:o}=this.view;fe(He,t[0],t[1],t[2]),Oa.setFromElevationInfo(this.elevationInfo),He[2]=Jo(He,o,Oa,n),n.toRenderCoords(He,this.view.spatialReference,He)?(e.setStartEndFromWorldDownAtLocation(He),e.attached=!0):e.attached=!1}onOutlineChanged(t){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=t,Z();const e=this.internalGraphicsLayer.elevationInfo,{view:n}=this,o=this._settings,s=new ke({view:n,geometry:t,elevationInfo:e,isDraped:this._createGraphicState?this._createGraphicState.isDraped:Ds(this.hasZ,e)==="on-the-ground",attached:!1,isDecoration:!0});this._outlineVisualElement=s;const a=et([x(()=>o.visualElements.lineObjects.outline,l=>l.apply(s),N),x(()=>o.visualElements.lineObjects.shadowStyle,l=>l.apply(s),N),Z(()=>{this._outlineVisualElement=V(this._outlineVisualElement)})]);return s.attached=!0,s.laserlineEnabled=!0,a}onRegularVerticesChanged(t){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=t,Z();const{view:e}=this,n=this._settings,o=n.manipulators.vertex,s=new Ys({view:e,spatialReference:e.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:o.size,outlineSize:o.outlineSize,renderOccluded:o.renderOccluded,attached:!1,isDecoration:!0}),a=et([x(()=>({color:lt(n.manipulators.vertex.color),outlineColor:lt(n.manipulators.vertex.outlineColor)}),({color:l,outlineColor:p})=>{s.color=l,s.outlineColor=p},N),Z(()=>{this._verticesVisualElement=V(this._verticesVisualElement)})]);return s.attached=!0,this._verticesVisualElement=s,a}updateGraphicGeometry(t){if(this.geometryType!=="mesh"||(t==null?void 0:t.type)!=="point")super.updateGraphicGeometry(t);else{const e=this.geometryToPlace;e==null||e.centerAt(t),No(this.tooltipInfos.mesh,e);const n=this._graphic;e&&n.geometry===e||(n.geometry=e)}}_setupLoadingIndicator(t){const{drawOperation:e}=this;if(!this.geometryToPlace)return e.loading=!1,null;e.loading=!0;const n=Z(()=>{e.loading=!1});let o;const s=()=>o&&cancelAnimationFrame(o);return et([Je(()=>t.displaying,()=>{s(),o=requestAnimationFrame(()=>n.remove())},{...ut,once:!0}),Z(s),n])}};r([c({constructOnly:!0})],Le.prototype,"elevationInfo",void 0),r([c({constructOnly:!0})],Le.prototype,"geometryType",void 0),r([c()],Le.prototype,"type",void 0),r([c({constructOnly:!0})],Le.prototype,"view",void 0),Le=r([b("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Le);const Oa=new Tn,He=O();function Od(i){const t=_s(i);return mc(Math.cos(t),Math.sin(t))}function _s(i){if(i==null||i.type!=="polyline"&&i.type!=="polygon")return 0;const t=i.type==="polyline"?i.paths:i.rings,e=_c();for(const n of t)for(let o=0;o<n.length-1;o++){const s=n[o],a=n[o+1],l=s[0]-a[0],p=s[1]-a[1];if(l*l+p*p>e)return Math.atan2(a[1]-s[1],a[0]-s[0])}return 0}var ce;(function(i){i[i.SUPPORTED=0]="SUPPORTED",i[i.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",i[i.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",i[i.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",i[i.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",i[i.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(ce||(ce={}));function hl(i,t,e){function n(){const l=e(),p=l.sketchOptions.tooltips.effectiveEnabled?l.activeTooltipInfo:null;return{...l,activeTooltipInfo:p}}let o=!1;function s(l){o||(o=!0,l(),o=!1)}function a({activeTooltipInfo:l,sketchOptions:p,scaleRotateTransform:h}){s(()=>{l&&(l.sketchOptions=p,ul(l,t),$d(l,h)),i.info=l})}return et([x(n,a,ut),x(()=>{const l=n(),{activeTooltipInfo:p}=l;if(p)return{context:l,activeTooltipInfo:p,key:p.key,geometry:J(t)}},(l,p)=>{l&&p&&p.key!==l.key&&s(()=>$a(t,l.context))},qt),t.on("committed",()=>{queueMicrotask(()=>a(n()))}),Wr(i,{onBeforePaste:()=>{o=!0},onAfterPaste:()=>{$a(t,n()),o=!1}})])}function $a(i,{activeTooltipInfo:t,callbacks:e}){if(!t)return;e.onBeforeUpdate();const n=J(i);switch(n==null?void 0:n.type){case"mesh":$n(t,n.origin,i,e),"orientation"in t&&"scale"in t&&No(t,n,e);break;case"point":$n(t,n,i,e)}}function $n(i,t,e,n){var l;const{dx:o,dy:s,dz:a}=Br(i,t);o===0&&s===0&&a===0||(n.onMoveStart(),(l=e.operations)==null||l.move(o,s,a,Rt.NEW_STEP),n.onMove(o,s,a),n.onMoveStop())}function ul(i,t){const e=J(t),n=e==null?void 0:e.type;if(!i||!e||n!=="mesh"&&n!=="point")return;const o=n==="mesh",s=o?e.origin:e;i.setLocationFromPoint(s),dl(i,s,t),i.type==="transform-mesh"&&o&&Zr(i,e),i.clearInputValues()}function dl(i,t,e){var n;i.elevation.actual=yr(t),i.elevation.visible=!!((n=e.operations)!=null&&n.data.coordinateHelper.hasZ()),i.elevation.readOnly=!1,i.elevation.showAsZ=!0}function $d(i,t){if((i==null?void 0:i.type)!=="transform-point")return;if(!t)return i.orientation.actual=void 0,i.size.actual=void 0,i.orientation.visible=!1,void(i.size.visible=!1);const e=t.mode,{size:n,orientationClockwise:o}=t.adapter,{visualVariables:s}=i.sketchOptions.tooltips,a=s==null?void 0:s.rotation,l=o!=null&&(e==null||e==="rotate"),p=(a==null?void 0:a.rotationType)??"geographic";i.orientation.actual=l?pi(o,"radians",p):void 0,i.orientation.precision=Ea(a==null?void 0:a.valueType),i.orientation.visible=l;const h=s==null?void 0:s.size,u=n!=null&&(e==null||e==="scale");i.size.actual=u?Ce(n,(h==null?void 0:h.unit)??"meters"):void 0,i.size.precision=Ea(h==null?void 0:h.valueType),i.size.visible=u}function Ea(i){switch(i){case"integer":case"long":return 0;default:return null}}var Et;(function(i){i[i.NONE=0]="NONE",i[i.ANY=1]="ANY",i[i.Z=2]="Z",i[i.XY=4]="XY"})(Et||(Et={}));let gl=class{constructor(){this.grabbingState=Et.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=Et.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator((e,n)=>{if(n===Q.TRANSLATE_Z&&(this.zManipulator=e),e instanceof ue&&(e.selected&&(this.numSelected===0&&(this.firstSelected=e),this.numSelected++),this.firstGrabbedXY==null&&e.grabbing&&n===Q.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Et.ANY,n){case Q.TRANSLATE_Z:this.grabbingState|=Et.Z;break;case Q.TRANSLATE_XY:this.grabbingState|=Et.XY}})}};function Ed(i){const{object:t}=i,e=Td(i),n=[e,Id(i,e.visualElement)];return t.maskOccludee&&n.push(t.maskOccludee()),{visualElement:e.visualElement,remove:()=>ts(n)}}function Td(i){const{view:t,object:e}=i,n=J(e),o=new ke({view:t,geometry:Zo(n)?n:null,elevationInfo:e.elevationInfo,attached:!1,isDecoration:!0}),s=new ui({getTheme:()=>t.effectiveTheme}),a=()=>{o.attached=e.visible},l=et([x(()=>s.visualElements.lineObjects.outline,p=>p.apply(o),N),x(()=>s.visualElements.lineObjects.shadowStyle,p=>p.apply(o),N),x(()=>e.visible,a),x(()=>e.isDraped,p=>{o.isDraped=p},N),e.on("committed",()=>{const p=J(e);o.geometry=Zo(p)?p:null}),he(o)]);return a(),{visualElement:o,remove:()=>l.remove()}}function Id(i,t){const{object:e,view:n}=i,o=[],s=e.elevationInfo,a=s.mode==="on-the-ground"||!s.offset&&s.mode!=="absolute-height",l=new gl,p=new ui({getTheme:()=>n.effectiveTheme}),h=p.visualElements,u=new os({view:n,extensionType:h.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Oe.OccludeAndTransparent,isDecoration:!0}),d=si(h.heightPlaneAngleCutoff),g=new xn({view:n,attached:!1,angleCutoff:d,isDecoration:!0}),v=Mn(1);o.push(x(()=>({lineShadowStyle:p.visualElements.lineObjects.shadowStyle,pointShadowStyle:p.visualElements.pointObjects.shadowStyle,alpha:v.value}),({lineShadowStyle:M,pointShadowStyle:k,alpha:G})=>{M.apply(t,G),k.apply(u,G)},N));const f=Mn(1);o.push(x(()=>({heightPlane:p.visualElements.heightPlane,alpha:f.value}),({heightPlane:M,alpha:k})=>M.apply(g,k),N));const m=()=>{l.update(i);const M=J(e);if(!e.visible||a&&(e.isDraped||!Zo(M)||!M.hasZ))return t.laserlineEnabled=!1,u.attached=!1,void(g.attached=!1);t.laserlineEnabled=!0;const k=l.grabbingState&Et.XY?h.laserlineAlphaMultiplier:1;v.value=k;const G=l.grabbingState&Et.Z?h.laserlineAlphaMultiplier:1;f.value=G,kd(u,l),Rd(i,t,g,l)};o.push(x(()=>p.visualElements.zVerticalLine,M=>M.apply(u),N)),o.push(e.on("committed",m),x(()=>e.visible,m),t.events.on("attachment-origin-changed",m),he(u),he(g));const w=[],_=()=>{ts(w),w.length=0,i.forEachManipulator(M=>w.push(M.events.on("grab-changed",m))),i.forEachManipulator(M=>w.push(M.events.on("select-changed",m))),m()};return _(),o.push(i.onManipulatorsChanged(_),cr(()=>et(w))),et(o)}function kd(i,t){const e=t.numSelected===1?t.firstSelected:t.numSelected>1&&t.firstGrabbedXY!=null?t.firstGrabbedXY:null;e!=null?(i.setStartEndFromWorldDownAtLocation(e.renderLocation),i.attached=!0):i.attached=!1}function Rd(i,t,e,n){if(n.numSelected>0){fe(_e,0,0,0);let o=0;i.forEachManipulator((s,a)=>{a===Q.TRANSLATE_XY&&s.selected&&s instanceof ue&&(Tt(_e,_e,s.renderLocation),o++)}),o>0?(e.heightManifoldTarget=jt(_e,_e,1/o),e.attached=!0):e.attached=!1}else{const o=t.attachmentOrigin;o!=null&&i.view.renderCoordsHelper.toRenderCoords(o,_e)?(e.heightManifoldTarget=_e,e.attached=!0):e.attached=!1}}function Zo(i){return i!=null&&(i.type==="polygon"||i.type==="polyline")}const _e=O();function Cd(i){const t=[],e=Dd(i,t);return Ad(i,t,e),{visualElement:e,remove:()=>ts(t)}}function Ad(i,t,e){const{view:n,object:o}=i,s=new ui({getTheme:()=>n.effectiveTheme}),a=new os({view:n,extensionType:s.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Oe.OccludeAndTransparent,isDecoration:!0});t.push(x(()=>s.visualElements.zVerticalLine,_=>_.apply(a),N));const l=new xn({view:n,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),p=si(s.visualElements.heightPlaneAngleCutoff),h=new xn({view:n,attached:!1,angleCutoff:p,isDecoration:!0}),u=o.elevationInfo,d=Tn.fromElevationInfo(u),g=u.mode==="on-the-ground"||!u.offset&&u.mode!=="absolute-height",v=new gl,f=Mn(1);t.push(x(()=>({heightPlane:s.visualElements.heightPlane,alpha:f.value}),({heightPlane:_,alpha:M})=>_.apply(h,M),N));const m=Mn(1);t.push(x(()=>({shadowStyle:s.visualElements.pointObjects.shadowStyle,alpha:m.value}),({shadowStyle:_,alpha:M})=>_.apply(l,M),N));const w=()=>{v.update(i);let _=ys(J(o));const M=g&&(o.isDraped||_==null||!_.hasZ);let k=!0;if(M||_==null)k=!1;else{pr(o.elevationInfo)&&(_=_.clone(),_.z=0);const pt=Jo(_,n.elevationProvider,d,n.renderCoordsHelper);fe($t,_.x,_.y,pt),Xt($t,_.spatialReference,$t,n.renderCoordsHelper.spatialReference),a.setStartEndFromWorldDownAtLocation($t),l.intersectsWorldUpAtLocation=$t}const G=v.grabbingState&Et.Z?s.visualElements.laserlineAlphaMultiplier:1;f.value=G;const $=bc(Ld);!M&&o.visible&&e.calculateMapBounds($)&&Xt(Mc($,$t),n.spatialReference,$t,n.renderCoordsHelper.spatialReference)?(h.heightManifoldTarget=$t,h.attached=!0):h.attached=!1;const j=v.grabbingState&Et.XY?s.visualElements.laserlineAlphaMultiplier:1;m.value=j;const E=k&&o.visible&&!M;l.attached=E,a.attached=E};t.push(x(()=>[o.visible,o.isDraped],w),o.on("committed",w)),i.forEachManipulator(_=>{t.push(_.events.on("grab-changed",w))}),t.push(he(l)),t.push(he(a)),t.push(he(h)),w()}function Dd(i,t){const{view:e,object:n}=i,o=new $p({view:e,geometry:ys(J(n)),elevationInfo:n.elevationInfo,isDecoration:!0});return Pd(i,o,t),t.push(he(o)),o}function ys(i){return i==null?null:i.type==="point"?i:i.type==="mesh"?i.origin.clone():null}function Pd(i,t,e){const{view:n,object:o}=i,s=()=>{t.attached=o.visible},a=new ui({getTheme:()=>n.effectiveTheme});Vd(i,t,e),a.visualElements.pointObjects.outline.apply(t),e.push(x(()=>o.visible,s,N))}function Vd(i,t,e){const{view:n,object:o}=i;let s=null;const a=p=>{s!=null&&(s.remove(),s=null),o.isDraped&&p!=null&&(s=jd(n,p,()=>{t.geometry=p}))},l=()=>{const p=ys(J(o));p!=null&&pr(o.elevationInfo)&&(p.z=0),a(p),t.geometry=p};e.push(o.on("committed",l),cr(()=>s)),l()}function jd(i,t,e){const n=i.elevationProvider.spatialReference;hr(t,$t,n);const o=$t[0],s=$t[1];return i.elevationProvider.on("elevation-change",a=>{ur(a.extent,o,s)&&e()})}const $t=O(),Ld=yc();function Hn(i){var t;switch((t=J(i.object))==null?void 0:t.type){case"point":case"mesh":return Cd(i);case"polygon":case"polyline":return Ed(i);default:return null}}let bs=class extends up{constructor(t){var e,n;super(),this._view=t.view,this._tool=t.tool,this._object=t.object,this._manipulator=(n=(e=this._object).createManipulator)==null?void 0:n.call(e,{selectable:!0,cursor:"move"}),this.forEachManipulator(o=>this._tool.manipulators.add(o))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){this._manipulator&&t(this._manipulator,Q.TRANSLATE_XY)}createManipulatedObjectDragPipeline(t){return dp(this._object,t,e=>this.createDragPipeline(e))}createDragPipeline(t){if(!this._manipulator)return Z();const e=this._view;return kt(this._manipulator,(n,o,s,a,l)=>{var u;const p=(u=this._object.operations)==null?void 0:u.data.spatialReference,h=o.next(d=>p?d:null).next(ah(l,e,this._object,p)).next(Ze()).next(as());t(n,h,s,a,l)})}};function Hd(i){var n,o;if(i.graphic&&((n=i.graphic.layer)==null?void 0:n.type)!=="graphics")return ce.GRAPHICS_LAYER_MISSING;const t=(o=i.operations)==null?void 0:o.data.type;if(!t)return ce.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return ce.GEOMETRY_TYPE_UNSUPPORTED}const e=i.elevationInfo;return xc(e)?ce.ELEVATION_MODE_UNSUPPORTED:ce.SUPPORTED}let Di=class extends ve(z){constructor(t){super(t),this.type="move-point",this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};r([c()],Di.prototype,"allFields",null),Di=r([b("esri.views.interactive.tooltip.infos.MovePointTooltipInfo")],Di);let we=class extends z{constructor(t){super(t),this.type="translate",this.distance=U}clear(){this.distance=U}};r([c()],we.prototype,"type",void 0),r([c()],we.prototype,"distance",void 0),we=r([b("esri.views.interactive.tooltip.infos.TranslateTooltipInfo")],we);let Be=class extends z{constructor(t){super(t),this.type="translate-xy",this.distance=U}};r([c()],Be.prototype,"type",void 0),r([c()],Be.prototype,"distance",void 0),Be=r([b("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],Be);let Se=class extends z{constructor(t){super(t),this.type="translate-z",this.distance=U}clear(){this.distance=U}};r([c()],Se.prototype,"type",void 0),r([c()],Se.prototype,"distance",void 0),Se=r([b("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],Se);let Ta=class{constructor(t){this.objects=t,this.type="move-start"}},Ia=class{constructor(t,e,n){this.dx=t,this.dy=e,this.objects=n,this.type="move"}};class eo{constructor(t){this.objects=t,this.type="move-stop"}}const At=Symbol("manipulators"),ka=Symbol("tooltips");let bt=class extends Ni{constructor(i){super(i),this._infos=new Map,this.events=new dt,this.objects=new go,this.enableZ=!0,this.sketchOptions=new Lt,this.type="move-3d",this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new ai,this._moveManipulation=null}initialize(){const{view:i}=this;this.tooltip=Bi(()=>({view:i,options:this.sketchOptions.tooltips})),this.addHandles([this.objects.on("change",e=>{e.removed.forEach(n=>this.removeHandles(n)),this._updateObjectInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()}),this.objects.on("change",()=>this._connectTooltips())]);const t=this.objects.toArray();this._updateObjectInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=V(this.tooltip),this._moveManipulation=V(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}onInputEvent(i){if(!this.destroyed&&!zi(i,this.tooltip))return super.onInputEvent(i)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){var e;const{objects:i}=this;if(i.length!==1)return!1;const t=(e=J(i.at(0)))==null?void 0:e.type;return t==="point"||t==="mesh"}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:i,removed:t}){for(const e of i){if(Hd(e)!==ce.SUPPORTED)continue;const n=new zd(e);this._infos.set(e,n)}for(const e of t)this._infos.delete(e)}_setupFastTransformUpdates(i){for(const t of i){const e=this._infos.get(t);this.addHandles(ls(e.object),t)}}_refreshManipulators(){if(this.removeHandles(At),this._moveManipulation=V(this._moveManipulation),this.manipulators.removeAll(),this._infos.size===0)return;const i=Array.from(this._infos.values());this._createManipulators(i),this._createVisualElements(i),this._updateMoveManipulation(i)}_createManipulators(i){for(const t of i){const e=t.object;t.manipulationXY=new bs({tool:this,view:this.view,object:e}),t.manipulationXY.forEachManipulator(n=>{this.addHandles([n.events.on("immediate-click",o=>{this.events.emit("immediate-click",{...o,object:e}),o.stopPropagation()}),n.events.on("grab-changed",({action:o})=>{o==="start"?this._showTooltip(tt.XY):this._hideTooltip()})],At)}),this.addHandles(t.manipulationXY.createDragPipeline((n,o,s,a)=>this._buildDragEventPipeline(i,tt.XY,n,o,s,a)),At)}this._createMoveManipulation(i)}_createMoveManipulation(i){var l;const t=new $e({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:i.length===1?$e.radiusForSymbol((l=i[0].object.graphic)==null?void 0:l.symbol):gp});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(p=>{this.addHandles(p.events.on("immediate-click",h=>{const u=this.objects.at(0);!t.zManipulation.hasManipulator(p)&&this.objects.length===1&&u&&this.events.emit("immediate-click",{...h,object:u}),h.stopPropagation()}),At)});const e=p=>h=>{this.addHandles([h.events.on("focus-changed",({action:u})=>{u==="focus"?this._showTooltip(p):this._hideTooltip()}),h.events.on("grab-changed",()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=U)})],At)};this._moveManipulation.xyManipulation.forEachManipulator(e(tt.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(e(tt.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(e(tt.Z));const n=()=>this._updateMoveManipulation(i);for(const p of i)this.addHandles([p.object.on("committed",n),x(()=>p.object.visible,n)],At);const o=i[i.length-1];this.addHandles(o.object.on("committed",()=>this._updateMoveManipulationAngle(o)),At);const{object:s}=o,{operations:a}=s;if(a){const p=s.graphic;this.addHandles(t.createDragPipeline((h,u,d,g,v)=>this._buildDragEventPipeline(i,h,u,d,g,v),s.elevationInfo,a.data.spatialReference,p),At)}this._updateMoveManipulationAngle(o)}_createVisualElements(i){for(const t of i){const e=t.object,n=Hn({view:this.view,object:e,forEachManipulator:o=>{var s,a;(s=t.manipulationXY)==null||s.forEachManipulator(o),(a=this._moveManipulation)==null||a.forEachManipulator(o)},onManipulatorsChanged:()=>Z()});n!=null&&(t.geometryRepresentation=n.visualElement,t.geometryRepresentation instanceof ke&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.object.isDraped||this._updateMoveManipulation(i)}),x(()=>t.object.isDraped,()=>this._updateMoveManipulation(i))],At),this.addHandles(n,At))}}_updateMoveManipulationAngle(i){this._moveManipulation&&(this._moveManipulation.angle=_s(J(i.object)))}_updateMoveManipulation(i){const t=ge(0,0,0,this.view.spatialReference);let e=0,n=!1;const o=this._moveManipulation;if(o){for(const s of i){if(!s.object.visible)continue;this.enableZ&&Te(s.object.operations,s.object.elevationInfo)&&(n=!0);const a=s.geometryRepresentation instanceof ke&&!s.object.isDraped?s.geometryRepresentation.attachmentOrigin:s.object.origin;if(a!=null){const{x:l,y:p,z:h}=a;t.x+=l,t.y+=p,h&&(t.z??(t.z=0),t.z+=h),e++}}e>0?(t.x/=e,t.y/=e,t.z??(t.z=0),t.z/=e,o.location=t,o.xyManipulation.available=!0,o.xyAxisManipulation.available=!0,o.zManipulation.available=n):o.available=!1}}_buildDragEventPipeline(i,t,e,n,o,s){const a=[],l=[];let p=null,h=null;const u=()=>{for(const d of a)d.dragging=!1;a.length=0,l.length=0,p=null,h=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(i.length===1&&t===tt.XY){const d=i[0].object;({steps:n,cancel:o}=this._buildSnappingPipelineSteps(d,d.elevationInfo,n,o,s))}return o=o.next(d=>h==null?void 0:h(d)).next(()=>(l.length&&this.events.emit("move-stop",new eo(l)),this.destroyed||u(),null)),{steps:n=n.next(d=>{var g,v;if(d.action==="start"){a.length=0,l.length=0;for(const f of i)f.dragging||!((g=f.manipulationXY)!=null&&g.hasManipulator(e))&&((v=f.manipulationXY)!=null&&v.grabbing)||(a.push(f),l.push(f.object),f.dragging=!0);if(l.length!==0&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),p=Yp(l),h=Xp(l),this._emitRecordUndo(),this.events.emit("move-start",new Ta(l)),this.destroyed))return null}return l.length!==0?d:null}).next(d=>p==null?void 0:p(d)).next(d=>(this._updateMoveTooltip(t,d),d)).next(d=>{switch(d.action){case"start":case"update":if(d.translationX||d.translationY||d.translationZ){const g=this.view.toScreen(d.mapStart),v=this.view.toScreen(d.mapEnd),f=v.x-g.x,m=v.y-g.y;if(this.events.emit("move",new Ia(f,m,l)),this.destroyed)return null}break;case"end":if(this.events.emit("move-stop",new eo(l)),this.destroyed)return null;u()}return null}),cancel:o}}_connectTooltips(){let i;if(this.removeHandles(ka),this._shouldShowMovePointTooltip){const t=this.objects.at(0),{events:e}=this;this._movePointTooltipInfo??(this._movePointTooltipInfo=new Di({viewType:this.view.type,sketchOptions:this.sketchOptions}));const n={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),e.emit("move-start",new Ta([t]))},onMove:()=>e.emit("move",new Ia(0,0,[t])),onMoveStop:()=>e.emit("move-stop",new eo([t])),onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{},onScaleStart:()=>{},onScale:()=>{},onScaleStop:()=>{}};i=hl(this.tooltip,t,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:n}))}else i=x(()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null,t=>{this.tooltip.info=t},ut);this.addHandles(i,ka)}_showTooltip(i){this._shouldShowMovePointTooltip||this._updateMoveTooltip(i)}_hideTooltip(){var i;this._shouldShowMovePointTooltip||((i=this.tooltip)==null||i.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(i,t){if(this._shouldShowMovePointTooltip)return;const{sketchOptions:e}=this;switch(i){case tt.XY:this._latestTooltipInfo=this._translateTooltipInfo??(this._translateTooltipInfo=new we({sketchOptions:e})),io(this._latestTooltipInfo,t,(n,o)=>de(n,o));break;case tt.XY_AXIS:this._latestTooltipInfo=this._translateXYTooltipInfo??(this._translateXYTooltipInfo=new Be({sketchOptions:e})),io(this._latestTooltipInfo,t,(n,o)=>es(de(n,o),Mr(t)));break;case tt.Z:this._latestTooltipInfo=this._translateZTooltipInfo??(this._translateZTooltipInfo=new Se({sketchOptions:e})),io(this._latestTooltipInfo,t,br)}this._latestTooltipInfo.sketchOptions=e}_emitRecordUndo(){const i=this.objects.toArray().map(t=>{var e;return(e=t.createUndoRecord)==null?void 0:e.call(t)}).filter(li);i.length>0&&this.events.emit("record-undo",{updates:i})}_buildSnappingPipelineSteps(i,t,e,n,o){const s=J(i);if(s==null||s.type!=="point"&&s.type!=="mesh")return{steps:e,cancel:n};const a=(s.type==="point"?s:s.origin).clone(),l=new ii({elevationInfo:t,pointer:o,editGeometryOperations:kn.fromGeometry(a,this.view.state.viewingMode),visualizer:new Li,excludeFeature:i.graphic}),p=this.snappingManager,{snappingStep:h,cancelSnapping:u}=ji({snappingContext:l,snappingManager:p,updatingHandles:this._updatingHandles});return n=n.next(u),{steps:e=e.next(d=>(a.z=Qo(this.view,a,i.elevationInfo,{mode:"absolute-height",offset:0}),{...d,snapOrigin:l.coordinateHelper.pointToVector(a)})).next(...h),cancel:n}}};r([c({constructOnly:!0,nonNullable:!0})],bt.prototype,"view",void 0),r([c()],bt.prototype,"objects",void 0),r([c({constructOnly:!0,nonNullable:!0})],bt.prototype,"enableZ",void 0),r([c({constructOnly:!0,type:Lt})],bt.prototype,"sketchOptions",void 0),r([c({constructOnly:!0})],bt.prototype,"snappingManager",void 0),r([c()],bt.prototype,"type",void 0),r([c()],bt.prototype,"updating",null),r([c()],bt.prototype,"_latestTooltipInfo",void 0),r([c()],bt.prototype,"_shouldShowMovePointTooltip",null),r([c()],bt.prototype,"activeTooltipInfo",null),bt=r([b("esri.views.3d.interactive.editingTools.move.MoveTool3D")],bt);class zd{constructor(t){this.object=t,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}}function io(i,t,e){if(t==null||t.action==="end")return void(i.distance=U);const{mapStart:n,mapEnd:o}=t,s=e(n,o);i.distance=s??U}function no(i,t,e){const n=e.mode==="on-the-ground"?sa.XY:sa.XYZ;return new eh(i,n,t,0)}function Ra(i,t,e){const n=O();if(!i.renderCoordsHelper.toRenderCoords(t,n))return null;const o=Ca(i,t,hi(e.plane)),s=Ca(i,t,e.edgeDirection);if(o==null||s==null)return null;const a=Ie(O(),o,s);return dr(n,a,is())}function Ca(i,t,e){const n=ge(t.x+e[0],t.y+e[1],t.z+e[2],t.spatialReference),o=O(),s=O();return i.renderCoordsHelper.toRenderCoords(t,o)&&i.renderCoordsHelper.toRenderCoords(n,s)?gr(s,o,s):null}function Ud(i,t,e){const n=hi(i),o=gr(O(),t,e),s=Ie(O(),o,n),a=Ie(O(),o,s);return wc(o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],0,0,0,0,1)}function Gd(i,t,e){const n=e.projectToRenderScreen(i,Ps()),o=e.projectToRenderScreen(t,Ps());return n!=null&&o!=null?Oc(B(n,n,o)):0}function Aa(i,t,e,n){const{elevationInfo:o,operations:s}=e;if(!s||!i)return null;const a=n.manipulator.elevationAlignedLocation,l=lr(a,t,o),p=t.sceneIntersectionHelper.intersectElevationFromScreen(Re(i.x,i.y),o,l);return p&&Sc(p,p,s.data.spatialReference)?p:null}function Fd(i,t,e,{data:{coordinateHelper:n,spatialReference:o}}){const s=ci(i,"meters"),a=yn(o),l=Math.sign(s*e.selectedArrow),p=_r(o),h=hi(e.plane),u=n.pointToXYZ(t),d=O();pe(d,u,h,l*(Nd/a));const g=s*e.selectedArrow/a;if(!p||!Xt(u,o,u,p)||!Xt(d,o,d,p))return g;const v=new ep;if(tp(v,u,d,p),mr(d,u,v.azimuth,s,p),!Xt(d,p,d,o))return g;const f=d[0]-t.x,m=d[1]-t.y,w=Math.sqrt(f*f+m*m)*l,[_,M]=h,k=Math.sqrt(_*_+M*M);return k===0?0:w/k}const Nd=10;let ae=class extends z{constructor(t){super(t),this.type="reshape-edge-offset",this.distance=Xu({lockable:!1}),this.area=gs({visible:!1}),this.totalLength=us({visible:!1})}get allFields(){return[this.distance,this.area,this.totalLength]}};r([c()],ae.prototype,"type",void 0),r([c()],ae.prototype,"distance",void 0),r([c()],ae.prototype,"area",void 0),r([c()],ae.prototype,"totalLength",void 0),r([c()],ae.prototype,"allFields",null),ae=r([b("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],ae);let Ei=class extends ve(z){constructor(t){super(t),this.type="selected-vertex",this.area=gs(),this.totalLength=us(),this.geometryType="polyline",this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.geometryType==="polygon"?this.area:this.totalLength]}};r([c()],Ei.prototype,"geometryType",void 0),r([c()],Ei.prototype,"allFields",null),Ei=r([b("esri.views.interactive.tooltip.infos.SelectedVertexTooltipInfo")],Ei);function Zd(i,t){const e=t==null?void 0:t.type;return{edgeOffset:new ae({sketchOptions:i,viewType:e}),movePoint:new Di({sketchOptions:i,viewType:e}),selectedVertex:new Ei({sketchOptions:i,viewType:e}),translate:new we({sketchOptions:i,viewType:e}),translateXY:new Be({sketchOptions:i,viewType:e}),translateZ:new Se({sketchOptions:i,viewType:e})}}function Bd(i,t,e){function n(){const l=e(),p=l.sketchOptions.tooltips.effectiveEnabled?l.activeTooltipInfo:null;return{...l,activeTooltipInfo:p}}let o=!1;function s(l){o||(o=!0,l(),o=!1)}function a(l){s(()=>{Xd(t,l),i.info=l.activeTooltipInfo})}return et([x(n,a,ut),x(()=>{const l=n(),{activeTooltipInfo:p}=l;if(p&&"key"in p)return{context:l,activeTooltipInfo:p,key:p.key,geometry:J(t)}},(l,p)=>{l&&p&&p.key!==l.key&&s(()=>Da(t,l.context))},qt),t.on("committed",()=>a(n())),Wr(i,{onBeforePaste:()=>{o=!0},onAfterPaste:()=>{Da(t,n()),o=!1}})])}function Da(i,{activeTooltipInfo:t,selectedVertexManipulatorInfo:e,callbacks:n}){if(!t)return;n.onBeforeReshape();const o=J(i);switch(o==null?void 0:o.type){case"mesh":t.type==="move-point"&&$n(t,o.origin,i,n);break;case"point":t.type==="move-point"&&$n(t,o,i,n);break;case"polyline":case"polygon":t.type==="selected-vertex"&&Yd(t,e,i,n)}}function Yd(i,t,e,n){var l;if(!t)return;const{dx:o,dy:s,dz:a}=Br(i,t.manipulator.location);o===0&&s===0&&a===0||(n.onReshapeStart(),(l=e.operations)==null||l.moveVertices([t.handle],o,s,a,Rt.NEW_STEP),n.onReshape(),n.onReshapeStop())}function Xd(i,{activeTooltipInfo:t,selectedVertexManipulatorInfo:e,sketchOptions:n}){if(t)switch(t.sketchOptions=n,t==null?void 0:t.type){case"move-point":ul(t,i);break;case"selected-vertex":Wd(t,e,i)}}function Wd(i,t,e){var s;if(!i||i.type!=="selected-vertex")return;const n=t==null?void 0:t.manipulator.location;i.setLocationFromPoint(n),dl(i,n,e);const o=(s=e.operations)==null?void 0:s.data.geometry;switch(o==null?void 0:o.type){case"polygon":i.geometryType="polygon",i.totalLength.visible=!1,i.area.actual=Vn(o);break;case"polyline":i.geometryType="polyline",i.totalLength.actual=ns(o),i.area.visible=!1}}function qd(i,t,{sketchOptions:e,tooltipInfos:n}){let o=null;switch(i){case tt.XY:o=n.translate,oo(o,t,(s,a)=>de(s,a));break;case tt.XY_AXIS:o=n.translateXY,oo(o,t,(s,a)=>es(de(s,a),Mr(t)));break;case tt.Z:o=n.translateZ,oo(o,t,br)}return o.sketchOptions=e,o}function oo(i,t,e){if(t!=null&&t.action!=="end"){const{mapStart:n,mapEnd:o}=t,s=e(n,o);i.distance=s??U}else i.distance=U}function Pa({operations:i},t,{sketchOptions:e,tooltipInfos:n}){const o=n.edgeOffset;if(o.distance.committed=null,t!=null&&t.signedDistance!=null&&t.action!=="end"&&i!=null){const a=i.data.coordinateHelper,{start:l,end:p}=t.operation.clampedStartAndEnd(t.mapEnd),h=Me(l,p,a.spatialReference),u=Math.sign(t.signedDistance*t.operation.selectedArrow);o.distance.actual=h!=null?es(h,u):null}else o.distance.actual=U;const s=i==null?void 0:i.data.geometry;switch(o.area.actual=null,o.area.visible=!1,o.totalLength.actual=null,o.totalLength.visible=!1,s==null?void 0:s.type){case"polygon":o.area.actual=Vn(s),o.area.visible=!0;break;case"polyline":o.totalLength.actual=ns(s),o.totalLength.visible=!0}return o.sketchOptions=e,o}const Va=Symbol();let L=class extends q{get _operations(){return this.object.operations}constructor(i){super(i),this._selectedIndex=0,this._manipulatorHandles=new $c,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=A.NONE,this._pendingEdgeOffsetInfo=null,this._updatingHandles=new ai,this._recreatingManipulators=!1,this._settings=new ui({getTheme:()=>this.view.effectiveTheme}),this.events=new dt,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null,this._tooltipCallbacks={onBeforeReshape:()=>this.tool.endDrag(),onReshapeStart:()=>this._updateEventState(A.RESHAPING),onReshape:()=>this.events.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>this._updateEventState(A.NONE,{forceEnd:!0}),onMoveStart:()=>this._updateEventState(A.MOVING),onMove:()=>this.events.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>this._updateEventState(A.NONE,{forceEnd:!0})}}initialize(){const{view:i}=this,t=this._settings.manipulators,e=t.vertex;this.tooltipInfos=Zd(this._sketchOptions,i),this._vertexManipulatorMaterial=_i(lt(e.color),e.renderOccluded),this._vertexManipulatorOutlineMaterial=yi(lt(e.outlineColor),e.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=yi(lt(e.hoverOutlineColor),e.renderOccluded);const n=t.edge;this._edgeManipulatorMaterial=_i(lt(n.color),n.renderOccluded),this._edgeManipulatorOutlineMaterial=yi(lt(n.outlineColor),n.renderOccluded);const o=t.edgeOffset;this._edgeOffsetManipulatorMaterial=_i(lt(o.color),o.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=_i(lt(o.hoverColor),o.renderOccluded,!1);const s=t.selected;this._selectedManipulatorMaterial=_i(lt(s.color),s.renderOccluded),this._selectedManipulatorOutlineMaterial=yi(lt(s.outlineColor),s.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=yi(lt(s.hoverOutlineColor),s.renderOccluded),this.tooltip=Bi(()=>({view:i,options:this._sketchOptions.tooltips})),this.addHandles([x(()=>{const a=this._settings.manipulators;return{vertexSettings:a.vertex,edgeSettings:a.edge,edgeOffsetSettings:a.edgeOffset,selectedSettings:a.selected}},({vertexSettings:a,edgeSettings:l,edgeOffsetSettings:p,selectedSettings:h})=>{a.applyColor(this._vertexManipulatorMaterial),a.applyOutline(this._vertexManipulatorOutlineMaterial),a.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),l.applyColor(this._edgeManipulatorMaterial),l.applyOutline(this._edgeManipulatorOutlineMaterial),p.applyColor(this._edgeOffsetManipulatorMaterial),p.applyHover(this._edgeOffsetManipulatorHoverMaterial),h.applyColor(this._selectedManipulatorMaterial),h.applyOutline(this._selectedManipulatorOutlineMaterial),h.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)}),x(()=>this.object.visible,a=>{for(const l of this._manipulatorInfos)l.manipulator.available=a,ao(l)&&(l.edgeManipulator.available=a)}),x(()=>this._numGrabbing+this._numDragging===0,a=>this._toggleAutoHideManipulators(a)),x(()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:a,enabled:l,edgeOffsetEnabled:p})=>{a!=null&&(a.visible=l,a.edgeDistance=p?"far":"default")},N),Bd(this.tooltip,this.object,()=>this._tooltipsContext),x(()=>this.tooltip.mode,(a,l)=>{l==="input"&&a!=="input"&&this._resetTooltip()}),ki(()=>this._operations,"vertex-update",a=>this._updateManipulatorPositions(a.vertices),{onListenerAdd:()=>this._recreateManipulators()}),ki(()=>{var a;return(a=this._operations)==null?void 0:a.data},"change",a=>{a.operation!=="undo"&&a.operation!=="redo"||this._recreateManipulators()})])}destroy(){this._removeManipulators(),this._updatingHandles.destroy(),this._segmentLabels=V(this._segmentLabels),this.tooltip=V(this.tooltip)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}enterInputModeIfAvailable(i){var t;return i.type==="key-down"&&i.key===Ee.enterInputMode&&(((t=this.activeTooltipInfo)==null?void 0:t.type)==="reshape-edge-offset"?this._enterInputModeDuringEdgeOffset(i):!!zi(i,this.tooltip)&&(this.tool.endDrag(),!0))}removeSelectedVertices(){const i=this._manipulatorInfos.filter(t=>t.manipulator.selected&&t.type==="vertex");return this._removeVertices(i),i.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=V(this._moveManipulation),this._objectMoveManipulation=V(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(i){if(this._operations==null)return;const t=this.object.elevationInfo;for(const e of this._operations.data.components){const n=i==null?void 0:i.byComponentIndex.get(e.index);for(const o of e.vertices){const s=n==null?void 0:n.has(o.index);this._createVertexOrEdgeManipulator(o,t,s)}for(const o of e.edges)this._createVertexOrEdgeManipulator(o,t)}this._createObjectMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return this._operations!=null&&this._operations.canRedo}get canUndo(){return this._operations!=null&&this._operations.canUndo}redo(){var i;return(i=this._operations)==null?void 0:i.redo()}undo(){var i;return this.events.emit("undo"),(i=this._operations)==null?void 0:i.undo()}_recreateManipulators(){var i,t;if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&((t=(i=this._segmentLabels)==null?void 0:i.context)==null?void 0:t.editGeometryOperations)===this._operations||(this._segmentLabels=V(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){const e=this._sketchOptions.labels;this._segmentLabels=new wn({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:e},visible:e.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(i,t){if(t.action==="end")return t;let e=0;const n=[],o=this._manipulatorInfos.some(a=>a.type==="vertex"&&a.manipulator.selected),s=i===Ye.SELECTED_OR_ALL&&o;for(const a of this._manipulatorInfos)a.type==="vertex"&&(a.manipulator.grabbing||s&&!a.manipulator.selected||n.push(a),e++);if(this._moveVertices(n,t),n.length===e){if(this._updateEventState(A.MOVING),this.destroyed)return t;this.events.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,object:this.object})}else{if(this._updateEventState(A.RESHAPING),this.destroyed)return t;this.events.emit("reshape",{type:"reshape",object:this.object})}return t}_toggleAutoHideManipulators(i){this.autoHideManipulators&&(i?this.removeHandles(Va):this.tool.manipulators.forEach(({manipulator:t})=>{var n;const e=(n=t.disableDisplay)==null?void 0:n.call(t);e&&this.addHandles(e,Va)}))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((i,t)=>t.type==="vertex"&&t.manipulator.selected?i+1:i,0)>1}_perVertexManipulatorDragAction(i){if(this._updateEventState(A.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:e,mapDeltaZ:n}=i;if(!t&&!e&&!n)return;const o=[];for(const s of this._manipulatorInfos)s.type==="vertex"&&(s.manipulator.selected&&!s.manipulator.grabbing||s===i.info)&&o.push(s);this._moveVertices(o,i,Rt.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}_updateEventState(i,t={}){if(i===this._reshapeEventState)return!1;switch(i){case A.NONE:if(!t.forceEnd&&(this._numGrabbing!==0||this._numDragging!==0))return!1;switch(this._reshapeEventState){case A.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case A.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case A.MOVING:switch(this._reshapeEventState){case A.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case A.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case A.RESHAPING:switch(this._reshapeEventState){case A.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case A.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==i;return this._reshapeEventState=i,e}_createObjectMoveManipulation(){const{tool:i,view:t,object:e,_operations:n}=this;if(n){if(this._objectMoveManipulation=new bs({tool:i,view:t,object:e}),this.enableMoveObject){let o=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline((s,a,l)=>{a.next(p=>this._trackNumDragging(p)).next(p=>(p.action==="start"&&(o=n.createUndoGroup()),p)).next(p=>this._perObjectManipulatorDragAction(Ye.ALL,p)).next(p=>(this._updateTranslateObjectTooltip(tt.XY,p),p)).next(p=>{p.action==="end"&&(this._resetTooltip(),o=ie(o))}),l.next(()=>this._onDragCancel(!0,()=>o=ie(o)))})),this._objectMoveManipulation.forEachManipulator(s=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(s,!1)))}else this._objectMoveManipulation.forEachManipulator(o=>{o.grabbable=!1,o.cursor=null});this._objectMoveManipulation.forEachManipulator(o=>this._manipulatorHandles.add(o.events.on("immediate-click",s=>{this._manipulatorInfos.some(a=>a.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",{...s,object:this.object}),s.stopPropagation()})))}}_createMoveManipulation(i){var l;const{object:t,tool:e,view:n,_operations:o}=this;if(!o)return;this._moveManipulation=new $e({tool:e,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Te(t.operations,t.elevationInfo),snapToScene:!1,radius:$e.radiusForSymbol((l=t.graphic)==null?void 0:l.symbol)}),this._moveManipulation.forEachManipulator(p=>this.addHandles([p.events.on("immediate-click",h=>{this._moveManipulation.zManipulation.hasManipulator(p)||this._manipulatorInfos.some(u=>u.manipulator.selected)||this.events.emit("immediate-click",{...h,object:this.object}),h.stopPropagation()}),this._watchAndUpdateGrabState(p,!1)]));const s=p=>h=>{this.addHandles([h.events.on("focus-changed",({action:u})=>{u==="focus"?this._updateTranslateTooltip(p):this._resetTooltip()})])};this._moveManipulation.xyManipulation.forEachManipulator(s(tt.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(s(tt.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(s(tt.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const a=o.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline((p,h,u,d,g)=>{const{snappingStep:v,cancelSnapping:f}=ji({predicate:m=>!!m.info,snappingManager:e.snappingManager,snappingContext:new ii({editGeometryOperations:o,elevationInfo:i,pointer:g,excludeFeature:t.graphic,visualizer:new Li}),updatingHandles:this._updatingHandles,useZ:!1});return d=d.next(m=>(this._onDragCancel(),m)).next(f),{steps:u=u.next(m=>this._trackNumDragging(m)).next(m=>{const w=this._manipulatorInfos.filter(_=>_.type==="vertex"&&_.manipulator.selected);return m.manipulatorType===Q.TRANSLATE_XY&&w.length===1?{...m,info:w[0],snapOrigin:w[0].handle.pos}:m}).next(wo(this.view,i,t.graphic??void 0)).next(...v).next(Ze()).next(m=>this._perObjectManipulatorDragAction(Ye.SELECTED_OR_ALL,m)).next(m=>(this._updateTranslateTooltip(p,m),m)),cancel:d}},i,a,t.graphic),x(()=>t.visible,()=>this._updateMoveManipulationPosition(),N),t.on("committed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),x(()=>t.isDraped,p=>{this._updateMoveManipulationPosition();const h="align-move-manipulation";p?this.addHandles(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),h):this.removeHandles(h)},N)])}_createVisualElements(){const{object:i,view:t}=this,e=Hn({view:t,object:i,forEachManipulator:o=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(o),this._moveManipulation.forEachManipulator(o);for(const s of this._manipulatorInfos)o(s.manipulator,Q.TRANSLATE_XY)}},onManipulatorsChanged:o=>this.events.on("manipulators-changed",o)});e!=null&&(this._outlineVisualElement=e.visualElement instanceof ke?e.visualElement:null);const n=this._outlineVisualElement;if(n!=null){const o=()=>{i.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add(ki(()=>n.events,"attachment-origin-changed",o,{onListenerAdd:o}))}this._manipulatorHandles.add(e)}_createEdgeOffsetManipulator(i,t=this.object.elevationInfo){var G;const e=this.view,n=this._operations;if(i.component.vertices.length<=2||!n)return null;const o=n.data.spatialReference,s=this._settings.manipulators.edgeOffset,a=s.size/2,l=a+s.collisionPadding,p=a/l,h=p/2,u=p*Math.sqrt(3)/2,{height:d,offset:g}=s,v=this._edgeOffsetManipulatorMaterial;if(!this._edgeOffsetManipulatorGeometryInside){const $=_o(v,u,h,h,d,g);this._edgeOffsetManipulatorGeometryInside=$}if(!this._edgeOffsetManipulatorGeometryOutside){const $=_o(v,-u,h,h,d,-g);this._edgeOffsetManipulatorGeometryOutside=$}const f=[new H(this._edgeOffsetManipulatorGeometryInside.instantiate(),F.Unfocused),new H(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),F.Focused),new H(this._edgeOffsetManipulatorGeometryOutside.instantiate(),F.Unfocused),new H(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),F.Focused)],m=new ue({view:e,renderObjects:f,elevationInfo:t.mode!=="on-the-ground"||ra((G=this.object.graphic)==null?void 0:G.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:l,available:this.object.visible,collisionType:{type:"disc",direction:Ci(0,0,1)},collisionPriority:1,metadata:{deleting:!1},location:so(o)}),w=new ue({view:e,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1},location:so(o)}),_={manipulator:m,handle:i,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:w,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(_,s.minSquaredEdgeLength);const M=()=>this._updateEdgeOffsetManipulator(_);M(),_.locationUpdateHandle=et([i.leftVertex,i.rightVertex].map($=>{const j=this._getManipulatorInfoFromHandle($);return j==null?void 0:j.manipulator.events.on("location-update",M)}));const k=$=>{this._manipulatorInfos.some(j=>j.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",{...$,object:this.object}),$.stopPropagation()};return this._manipulatorHandles.add([_.locationUpdateHandle,this._watchAndUpdateGrabState(m,!0),this._watchAndUpdateGrabState(w,!0),kt(m,this._createEdgeOffsetPipeline(_,t,n)),kt(w,this._createEdgePipeline(_,t,n)),w.events.on("immediate-click",k),m.events.on("immediate-click",k),m.events.on("focus-changed",()=>this._resetTooltip()),m.events.on("grab-changed",({screenPoint:$,action:j})=>{_.grabMapPoint=j==="start"?Aa($,this.view,this.object,_):null})],m),this._manipulatorInfos.push(_),this.manipulators.addMany([m,w]),this.events.emit("manipulators-changed"),_}_autoHideEdgeOffsetManipulator(i,t){const e=i.manipulator,n=i.edgeManipulator,o=()=>{i.visibilityHandle=ie(i.visibilityHandle);const s=this._getManipulatorInfoFromHandle(i.handle.leftVertex),a=this._getManipulatorInfoFromHandle(i.handle.rightVertex),l=s!=null&&a!=null&&Gd(s.manipulator.renderLocation,a.manipulator.renderLocation,this.view.state.camera)<t;(!e.focused&&!n.focused||l)&&(e.grabbable=!l,n.grabbable=!l,i.visibilityHandle=et([e.disableDisplay(),Z(()=>{e.grabbable=!0,n.grabbable=this.enableMoveObject})]))};this._manipulatorHandles.add([e.events.on("focus-changed",o),n.events.on("focus-changed",o),Z(()=>{ie(i.visibilityHandle),n.metadata.deleting=!0,this.manipulators.remove(n)})],e),o()}_updateEdgeOffsetManipulator(i){if(!this._operations)return;this._updateManipulatorPosition(i);const{coordinateHelper:t}=this._operations.data,e=Ra(this.view,i.manipulator.elevationAlignedLocation,no(t,i.handle,i.manipulator.elevationInfo)),n=this._getManipulatorInfoFromHandle(i.handle.leftVertex),o=this._getManipulatorInfoFromHandle(i.handle.rightVertex);if(n==null||o==null)return;const s=n.manipulator.renderLocation,a=o.manipulator.renderLocation,l=e!=null?Ud(e,s,a):Ec;i.manipulator.modelTransform=l,i.edgeManipulator.elevationAlignedLocation=i.manipulator.elevationAlignedLocation,i.edgeManipulator.modelTransform=l;const p=ei(B(on,s,a))/2;i.edgeManipulator.collisionType={type:"line",paths:[[[-p,0,0],[p,0,0]]]}}_createEdgePipeline(i,t,e){return(n,o,s,a)=>{if(a==="touch")this._createEdgeOffsetPipeline(i,t,e)(n,o,s);else if(this.enableMoveObject){const l=this.object.graphic,p=e.data.spatialReference,{elevationAlignedLocation:h}=n;o.next(u=>this._trackNumDragging(u)).next(Wn(this.view,h)).next(aa(this.view,h,t,p,l)).next(as()).next(Ze()).next(u=>this._perObjectManipulatorDragAction(Ye.ALL,u)).next(u=>(this._updateTranslateObjectTooltip(tt.XY,u),u)).next(u=>{u.action==="end"&&this._resetTooltip()}),s.next(()=>this._onDragCancel(!n.metadata.deleting))}}}_createEdgeOffsetPipeline(i,t,e){return(n,o,s)=>{const a=this._pendingEdgeOffsetInfo;if((a==null?void 0:a.manipulatorInfo)===i&&a.mode!=="drag")return void s.execute({action:"cancel"});this._clearSelection();const{initializeStep:l,cleanup:p}=this._initializeEdgeOffset(i,t,e,s),h=this._applyEdgeOffsetStep(i);o.next(u=>this._trackNumDragging(u)).next(Wn(this.view,n.elevationAlignedLocation)).next(l).next(rh(this.view)).next(lh(this.view,e.data.spatialReference)).next(Ze()).next(Kd()).next(u=>this._pendingEdgeOffsetInfo?u:h(u)).next(u=>{u.action!=="end"||this._pendingEdgeOffsetInfo||p()}),s.next(()=>{this._exitEdgeOffsetInputMode(),n.metadata.deleting||(p(),this._onDragCancel())})}}_initializeEdgeOffset(i,t,e,n){const{view:o,object:s}=this,a=no(e.data.coordinateHelper,i.handle,t),l=e.createUndoGroup(),p=Ra(o,i.manipulator.elevationAlignedLocation,a);let h;this._splitEdgesBeforeEdgeOffset(i,a),this._selectEdgeOffsetArrow(i,a);const u=()=>{this._cleanEdgeOffsetCollapsedEdges(i,e),h=ie(h)},d=this.events.on("undo",u);return h=et([this._initializeEdgeOffsetVisualElement(i,s,t,e),l,d,this._connectEdgeOffsetTooltip(i,a,e,()=>{n.execute({action:"cancel"})})]),{initializeStep:g=>a==null||p==null?(u(),null):{...g,operation:a,plane:p},cleanup:u}}_initializeEdgeOffsetVisualElement(i,t,e,n){const o=()=>new Ka({paths:[[i.handle.leftVertex.pos,i.handle.rightVertex.pos]],spatialReference:n.data.spatialReference}),s=new ke({view:this.view,isDraped:t.isDraped,geometry:o(),elevationInfo:e,width:this._settings.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),a=et([x(()=>({color:this._accentColor,draped:t.isDraped}),({color:l,draped:p})=>{s.color=lt(l),s.isDraped=p},ut),t.on("committed",()=>{s.geometry=o()}),he(s)]);return s.attached=!0,a}_applyEdgeOffsetStep(i){return t=>(this.destroyed||t.operation==null||!this._operations||(this._updateEventState(A.RESHAPING),t.signedDistance==null?this._resetTooltip():((t.mapDeltaX||t.mapDeltaY||t.mapDeltaZ)&&(this._offsetEdge(i,t.operation,t.signedDistance),this.events.emit("reshape",{type:"reshape",object:this.object})),this._updateEdgeOffsetTooltip(t))),t)}_cleanEdgeOffsetCollapsedEdges(i,t){var h,u;const e=(h=i.handle.leftVertex.leftEdge)==null?void 0:h.leftVertex,n=i.handle.leftVertex,o=(u=i.handle.rightVertex.rightEdge)==null?void 0:u.rightVertex,s=i.handle.rightVertex,a=t.data.coordinateHelper,l=this.view.pixelSizeAt(a.vectorToDehydratedPoint(n.pos),a.spatialReference),p=[];if(e&&a.distance(e.pos,n.pos)<Ha){const d=this._getManipulatorInfoFromHandle(n);d!=null&&p.push(d)}if(a.distance(n.pos,s.pos)<l||o&&a.distance(o.pos,s.pos)<Ha){const d=this._getManipulatorInfoFromHandle(s);d!=null&&p.push(d)}p.length&&this._removeVertices(p)}_enterInputModeDuringEdgeOffset(i){const t=this._findActiveEdgeOffsetManipulatorInfo();return!!t&&!!zi(i,this.tooltip)&&(t.manipulator.dragging?(this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:"drag"},!0):(this._clearSelection(),this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:"hover"},this._connectEdgeOffsetTooltipOnHover(t),!0))}_exitEdgeOffsetInputMode(){this.tooltip&&(this._pendingEdgeOffsetInfo=null,this._resetTooltip(),this.tooltip.exitInputMode())}_findActiveEdgeOffsetManipulatorInfo(){return this._manipulatorInfos.filter(ao).find(({manipulator:i})=>i.hovering||i.grabbing||i.dragging)}_connectEdgeOffsetTooltipOnHover(i){const{_operations:t,object:e}=this;if(!t)return;const{elevationInfo:n}=e,o=no(t.data.coordinateHelper,i.handle,n);this._selectEdgeOffsetArrow(i,o),this.addHandles([this._initializeEdgeOffsetVisualElement(i,e,n,t),this._connectEdgeOffsetTooltip(i,o,t,()=>{this.removeHandles(o),this._exitEdgeOffsetInputMode()})],o)}_splitEdgesBeforeEdgeOffset(i,t){if(t.requiresSplitEdgeLeft){const e=this._getManipulatorInfoFromHandle(i.handle.leftVertex.leftEdge);e!=null&&this._splitEdgeManipulator(e,1)}if(t.requiresSplitEdgeRight){const e=this._getManipulatorInfoFromHandle(i.handle.rightVertex.rightEdge);e!=null&&this._splitEdgeManipulator(e,0)}}_selectEdgeOffsetArrow(i,t){var n;const e=i.grabMapPoint??Aa((n=this.view.inputManager)==null?void 0:n.latestPointerLocation,this.view,this.object,i);e&&t.selectArrowFromStartPoint(e)}_connectEdgeOffsetTooltip(i,t,e,n){const o=()=>this.tooltipInfos.edgeOffset.distance.actual,s=l=>{n(),queueMicrotask(()=>{var h,u,d,g,v,f;this.view.focus();const p=e.createUndoGroup();(u=(h=this._tooltipCallbacks).onReshapeStart)==null||u.call(h),this._splitEdgesBeforeEdgeOffset(i,t),this._offsetEdge(i,t,Fd(l,i.manipulator.location,t,e)),(g=(d=this._tooltipCallbacks).onReshape)==null||g.call(d),(f=(v=this._tooltipCallbacks).onReshapeStop)==null||f.call(v),this._cleanEdgeOffsetCollapsedEdges(i,e),p.remove()})},a=()=>{const l=o();l!=null?s(l):n()};return et([Je(()=>this.tooltip&&!this.tooltip.focused,()=>a(),qt),this.tooltip.on("discard",n),this.tooltip.on("commit",l=>{l.type==="commit-and-exit"&&a()})])}_createVertexOrEdgeManipulator(i,t=this.object.elevationInfo,e=!1){const n=this.view,o=this._operations,s=this._settings;if(!o)return null;const a=o.data.type,l=o.data.spatialReference;if(i.type==="edge"){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(i,t);if(!this.enableMidpoints)return null}if(this._vertexManipulatorGeometry==null||this._vertexManipulatorOutlineGeometry==null){const{size:g,outlineSize:v}=ja(s.manipulators.vertex);this._vertexManipulatorGeometry=Yi(this._vertexManipulatorMaterial,g,16,16),this._vertexManipulatorOutlineGeometry=Yi(this._vertexManipulatorOutlineMaterial,v,16,16)}if(this._edgeManipulatorGeometry==null||this._edgeManipulatorOutlineGeometry==null){const{size:g,outlineSize:v}=ja(s.manipulators.edge);this._edgeManipulatorGeometry=Yi(this._edgeManipulatorMaterial,g,16,16),this._edgeManipulatorOutlineGeometry=Yi(this._edgeManipulatorOutlineMaterial,v,16,16)}const p=a==="point"||a==="mesh"?[]:[new H(this._vertexManipulatorGeometry.instantiate(),Ot.Vertex|F.Unselected),new H(this._vertexManipulatorOutlineGeometry.instantiate(),Ot.Vertex|F.Unfocused|F.Unselected),new H(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Ot.Vertex|F.Focused|F.Unselected),new H(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),F.Selected),new H(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),F.Selected|F.Unfocused),new H(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),F.Selected|F.Focused)];this.enableMidpoints&&p.push(new H(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),Ot.Edge|F.Focused|F.Unselected),new H(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Ot.Edge|F.Focused|F.Unselected),new H(this._edgeManipulatorGeometry.instantiate(),Ot.Edge|F.Unfocused|F.Unselected),new H(this._edgeManipulatorOutlineGeometry.instantiate(),Ot.Edge|F.Unfocused|F.Unselected));const h=new ue({view:n,renderObjects:p,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1},location:so(l)});h.selected=e,this._setTypeSpecificManipulatorSettings(h,i,t);const u=i.type==="edge"?{manipulator:h,handle:i,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:h,handle:i,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(u),this.manipulators.add(h),this._updateManipulatorPosition(u),u.type==="edge"){const g=[];for(const v of[u.handle.leftVertex,u.handle.rightVertex]){const f=this._getManipulatorInfoFromHandle(v);f!=null&&g.push(f.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(u)))}u.locationUpdateHandle=et(g),this._manipulatorHandles.add(u.locationUpdateHandle,h)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(h,!0),h);const d=kt(h,(g,v,f,m)=>{let w=null;const{snappingStep:_,cancelSnapping:M}=ji({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new ii({editGeometryOperations:o,elevationInfo:t,pointer:m,excludeFeature:this.object.graphic,visualizer:new Li}),updatingHandles:this._updatingHandles,useZ:!1});f=f.next($=>(this._onDragCancel(!g.metadata.deleting,()=>w=ie(w)),$)).next(M);const{elevationAlignedLocation:k}=g,G=this.object.graphic??void 0;v.next($=>this._trackNumDragging($)).next($=>{if($.action==="start"&&o&&(w=o.createUndoGroup()),u.type==="edge"){const j=this._splitEdgeManipulator(u);return{...$,info:j,snapOrigin:j.handle.pos}}return{...$,info:u,snapOrigin:u.handle.pos}}).next(Wn(n,k)).next(aa(n,k,t,l,G)).next(wo(n,t,G)).next(..._).next(Ze()).next($=>{this._perVertexManipulatorDragAction($),$.action==="end"&&(w=ie(w)),this._resetTooltip()})});return this._manipulatorHandles.add([d,h.events.on("immediate-click",g=>this._manipulatorClickCallback(g,u)),h.events.on("select-changed",()=>{u.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()}),h.events.on("focus-changed",()=>{this._resetTooltip()})],h),this.events.emit("manipulators-changed"),u}_trackNumDragging(i){switch(i.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return i}_onDragCancel(i=!0,t){var e;switch(this._numDragging--,i&&this.undo(),(e=this.tool.snappingManager)==null||e.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case A.NONE:break;case A.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case A.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}t==null||t(),this.destroyed||this._updateEventState(A.NONE)}_setTypeSpecificManipulatorSettings(i,t,e){var o,s;const n=this._settings;switch(t.type){case"vertex":{i.state=Ot.Vertex,i.selectable=!0,i.cursor="move",i.collisionPriority=2;const{size:a,collisionPadding:l}=n.manipulators.vertex;i.radius=a/2+l,i.elevationInfo=e;const p=(o=this._operations)==null?void 0:o.data.type;i.interactive=p!=null&&p!=="point"&&p!=="mesh";break}case"edge":{i.state=Ot.Edge,i.selectable=!1,i.cursor="copy",i.collisionPriority=-1;const{size:a,collisionPadding:l}=n.manipulators.edge;i.radius=a/2+l,i.elevationInfo=e.mode!=="on-the-ground"||ra((s=this.object.graphic)==null?void 0:s.symbol)?{mode:"absolute-height",offset:0}:e;break}}}_watchAndUpdateGrabState(i,t){return i.events.on("grab-changed",e=>{this._onGrabStateChanged(i,t,e.action,e.pointerType)})}_onGrabStateChanged(i,t,e,n="mouse"){if(!this._recreatingManipulators){if(e==="start")t&&this._updateSelection(i),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(A.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(n!=="touch"||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(o=>{var l;const{manipulator:s}=o,a=(l=this._operations)==null?void 0:l.data.type;s.interactive=s.grabbing||!this._numGrabbing&&a!=null&&a!=="point"&&a!=="mesh",ao(o)&&(o.edgeManipulator.interactive=o.edgeManipulator.grabbing||!this._numGrabbing)}),this._objectMoveManipulation.forEachManipulator(o=>{o.interactive=o.grabbing||!this._numGrabbing}))}}_clearSelection(){for(const i of this._manipulatorInfos)i.manipulator.grabbing||(i.manipulator.selected=!1);this._pendingEdgeOffsetInfo=null}_updateSelection(i){i.grabbing&&!i.selected&&i.selectable&&(this._clearSelection(),i.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(i){i!=null&&(i.manipulator.metadata.deleting=!0,this.manipulators.remove(i.manipulator),this._manipulatorHandles.remove(i.manipulator),Tc(this._manipulatorInfos,i),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(i){if(i){for(const t of this._manipulatorInfos)if(i===t.handle)return t}return null}_updateManipulatorPositions(i){for(const t of i)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t))}_updateManipulatorPosition(i){var e;const t=this._operations;if(i!=null&&t){if(i.type==="vertex")i.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(i.handle.pos,wi),i.manipulator.grabbing&&this._vertexLaserLineVisualElement!=null&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=i.manipulator.renderLocation);else if(i.type==="edge"){const n=this._getManipulatorInfoFromHandle(i.handle.leftVertex),o=this._getManipulatorInfoFromHandle(i.handle.rightVertex);if(n==null||o==null)return;const s=n.manipulator,a=o.manipulator;if(((e=i.manipulator.elevationInfo)==null?void 0:e.mode)==="on-the-ground"){const l=s.location,p=a.location,h=.5,u=l.x+h*(p.x-l.x),d=l.y+h*(p.y-l.y),g=l.hasZ&&p.hasZ?0:void 0;i.manipulator.location=ge(u,d,g,t.data.spatialReference)}else le(on,s.renderLocation,a.renderLocation,.5),i.manipulator.renderLocation=on}}}_splitEdgeManipulator(i,t=.5){const e=this._operations,n=e.splitEdge(i.handle,t).createdVertex;i.locationUpdateHandle=ie(i.locationUpdateHandle);const o=this.object.elevationInfo;let s;this.enableEdgeOffset?(this._removeManipulator(i),s=this._createVertexOrEdgeManipulator(n)):(s=i,s.handle=n,s.type="vertex",this._setTypeSpecificManipulatorSettings(i.manipulator,i.handle,o)),n.leftEdge&&this._createVertexOrEdgeManipulator(n.leftEdge),n.rightEdge&&this._createVertexOrEdgeManipulator(n.rightEdge),this._updateManipulatorPosition(s),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(i.manipulator);const a=this._updateEventState(A.RESHAPING),l=e.data.coordinateHelper.vectorToArray(s.handle.pos),p=e.data.components.indexOf(n.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:l,componentIndex:p,vertexIndex:n.index}],added:l}),a&&this._updateEventState(A.NONE),s}_updateMoveManipulationPosition(){var l,p,h,u;const i=fe(on,0,0,0);let t=0,e=!1,n=null,o=null;for(const d of this._manipulatorInfos)d.type==="vertex"&&(d.manipulator.selected?(t++,Tt(i,i,d.manipulator.renderLocation),n==null||d.selectedIndex>n.selectedIndex?(o=n,n=d):(o==null||d.selectedIndex>o.selectedIndex)&&(o=d)):e=!0);const s=this.object,a=(l=this._operations)==null?void 0:l.data.geometry;if(t===0){const d=s.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=d,this._moveManipulation.xyAxisManipulation.available=d,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=d,this._moveManipulation.zManipulation.available=d&&this.enableZShape&&Te(this._operations,s.elevationInfo),this._moveManipulation.angle=_s(a),this._moveManipulation.radius=$e.radiusForSymbol((p=s.graphic)==null?void 0:p.symbol)}else{const d=s.visible;this._moveManipulation.xyManipulation.available=d,this._moveManipulation.xyAxisManipulation.available=d,this._moveManipulation.zManipulation.available=d&&this.enableZVertex&&Te(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=d&&t!==1;let g=0;if(n!=null){const v=n.handle.pos,f=o!=null?o.handle.pos:(h=n.handle.leftEdge)!=null&&h.leftVertex?n.handle.leftEdge.leftVertex.pos:null,m=o==null&&((u=n.handle.rightEdge)!=null&&u.rightVertex)?n.handle.rightEdge.rightVertex.pos:null;f&&m?this._moveManipulation.xyAxisManipulation.available=!1:f?g=La(f,v):m&&(g=La(v,m))}this._moveManipulation.angle=g,this._moveManipulation.radius=fp}t!==0&&e?(jt(i,i,1/t),wi.spatialReference=this._operations.data.spatialReference,wi.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(i,wi),this._moveManipulation.elevationAlignedLocation=wi):this._outlineVisualElement==null||this.object.isDraped||this._outlineVisualElement.attachmentOrigin==null?$r(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(i){var n;const t=new Array,e=this._operations;if(e){for(const o of i){const s=o.handle.component;if(o.type==="vertex"&&e.canRemoveVertex(s)){t.push(o.handle),this._removeManipulator(o),this._removeManipulator(this._getManipulatorInfoFromHandle(o.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(o.handle.rightEdge));const a=e.removeVertices([o.handle]),l=(n=a.removedVertices)==null?void 0:n[0].createdEdge;l?this._createVertexOrEdgeManipulator(l):this.enableEdgeOffset&&s.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(s.edges[0]))}}if(t.length>0){const o=t.map(a=>{const l=e.data.components.indexOf(a.component);return{coordinates:e.data.coordinateHelper.vectorToArray(a.pos),componentIndex:l,vertexIndex:a.index}}),s=this._updateEventState(A.RESHAPING);if(this.destroyed||(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:o.map(a=>a.coordinates),vertices:o}),this.destroyed)||s&&(this._updateEventState(A.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(i,t,e=t.action==="start"?Rt.NEW_STEP:Rt.ACCUMULATE_STEPS){const n=this._operations;if(n){i.length>0&&n.moveVertices(i.map(o=>o.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,e);for(const o of i)this._updateManipulatorPosition(o)}}_offsetEdge(i,t,e){if(!this._operations)return;const n=t.clone();n.distance=e,this._operations.updateVertices([i.handle.leftVertex,i.handle.rightVertex],n),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i.handle.rightVertex))}_manipulatorClickCallback(i,t){i.shiftKey||this._clearSelection(),t.type==="vertex"&&(t.manipulator.selected=!t.manipulator.selected,this.enableDeleteVertices&&i.button===Vs.Right&&this._removeVertices([t])),t.type==="edge"&&i.button===Vs.Left&&this._splitEdgeManipulator(t),i.stopPropagation()}_updateTranslateTooltip(i,t){this._defaultTooltipInfo!=null?this._resetTooltip():this._updateTranslateObjectTooltip(i,t)}_updateTranslateObjectTooltip(i,t){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=qd(i,t,this._tooltipsContext))}_updateEdgeOffsetTooltip(i){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=Pa(this.object,i,this._tooltipsContext))}_resetTooltip(){const i=this.activeTooltipInfo;if(this._pendingEdgeOffsetInfo&&(i==null?void 0:i.type)==="reshape-edge-offset")return;let t=null;t=this._pendingEdgeOffsetInfo||this._findActiveEdgeOffsetManipulatorInfo()!=null?Pa(this.object,null,this._tooltipsContext):this._defaultTooltipInfo,t!==i&&(i!=null&&t!=null&&this.tooltip.mode==="input"||(this.activeTooltipInfo=t))}get _defaultTooltipInfo(){var t;switch((t=this._operations)==null?void 0:t.data.type){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){const i=this._manipulatorInfos.filter(t=>t.type==="vertex"&&t.manipulator.selected);return i.length===1?i[0]:null}get _tooltipsContext(){return{sketchOptions:this._sketchOptions,tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:this._tooltipCallbacks}}get test(){}};function Kd(){return i=>{const{operation:t,mapEnd:e}=i;return t==null||e==null?i:{...i,signedDistance:t.signedDistanceToPoint(e)}}}function ja(i){const t=i.size/2,e=t+i.collisionPadding;return{size:t/e,outlineSize:(t+i.outlineSize)/e}}function La(i,t){return Math.atan2(t[1]-i[1],t[0]-i[0])+Math.PI/2}function so(i){return new It({x:0,y:0,z:0,spatialReference:i})}function ao(i){return i.type==="edge"&&"edgeManipulator"in i}r([c()],L.prototype,"_numGrabbing",void 0),r([c()],L.prototype,"_numDragging",void 0),r([c()],L.prototype,"_pendingEdgeOffsetInfo",void 0),r([c()],L.prototype,"_operations",null),r([c()],L.prototype,"_segmentLabels",void 0),r([c({constructOnly:!0})],L.prototype,"tool",void 0),r([c()],L.prototype,"tooltip",void 0),r([c()],L.prototype,"activeTooltipInfo",void 0),r([c({readOnly:!0})],L.prototype,"updating",null),r([c()],L.prototype,"manipulators",null),r([c()],L.prototype,"view",null),r([c()],L.prototype,"object",null),r([c()],L.prototype,"enableZShape",null),r([c()],L.prototype,"enableDeleteVertices",null),r([c()],L.prototype,"enableZVertex",null),r([c()],L.prototype,"autoHideManipulators",null),r([c()],L.prototype,"enableMoveObject",null),r([c()],L.prototype,"enableMidpoints",null),r([c()],L.prototype,"enableEdgeOffset",null),r([c()],L.prototype,"_sketchOptions",null),r([c()],L.prototype,"_accentColor",null),r([c()],L.prototype,"_tooltipsContext",null),L=r([b("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],L);const wi=ge(0,0,void 0,ri.WGS84),on=O(),Ha=1e-6;var Ot,A,Ye;(function(i){i.Vertex=Ft.Custom1,i.Edge=Ft.Custom2})(Ot||(Ot={})),function(i){i[i.NONE=0]="NONE",i[i.MOVING=1]="MOVING",i[i.RESHAPING=2]="RESHAPING"}(A||(A={})),function(i){i[i.ALL=0]="ALL",i[i.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Ye||(Ye={}));let K=class extends Ni{constructor(t){super(t),this._reshapeOperation=null,this.events=new dt,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new Lt,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const t=this._reshapeOperation=new L({tool:this});this.addHandles([t.events.on("reshape",e=>this.events.emit("reshape",e)),t.events.on("move",e=>this.events.emit("move",e)),t.events.on("vertex-add",e=>this.events.emit("vertex-add",e)),t.events.on("vertex-remove",e=>this.events.emit("vertex-remove",e)),t.events.on("immediate-click",e=>this.events.emit("immediate-click",{...e,object:this.object})),this.view.on("pointer-down",["Shift"],e=>e.stopPropagation())]),this.finishToolCreation()}destroy(){this._reshapeOperation=V(this._reshapeOperation)}get updating(){var t;return((this.object.updating??!1)||((t=this._reshapeOperation)==null?void 0:t.updating))??!1}get activeTooltipInfo(){var t;return((t=this._reshapeOperation)==null?void 0:t.activeTooltipInfo)??null}get tooltip(){var t;return((t=this._reshapeOperation)==null?void 0:t.tooltip)??null}onManipulatorSelectionChanged(){var t;(t=this._reshapeOperation)==null||t.onManipulatorSelectionChanged()}get canUndo(){var t;return((t=this._reshapeOperation)==null?void 0:t.canUndo)??!1}undo(){var t,e;(t=this.snappingManager)==null||t.doneSnapping(),(e=this._reshapeOperation)==null||e.undo()}get canRedo(){var t;return((t=this._reshapeOperation)==null?void 0:t.canRedo)??!1}redo(){var t,e;(t=this.snappingManager)==null||t.doneSnapping(),(e=this._reshapeOperation)==null||e.redo()}onInputEvent(t){const e=this._reshapeOperation;e&&!e.enterInputModeIfAvailable(t)&&this.enableDeleteVertices&&t.type==="key-down"&&Fp.delete.includes(t.key)&&e.removeSelectedVertices()>0&&t.stopPropagation()}reset(){}};r([c()],K.prototype,"_reshapeOperation",void 0),r([c()],K.prototype,"view",void 0),r([c({constructOnly:!0})],K.prototype,"object",void 0),r([c()],K.prototype,"enableZShape",void 0),r([c()],K.prototype,"enableZVertex",void 0),r([c()],K.prototype,"enableMoveObject",void 0),r([c()],K.prototype,"enableDeleteVertices",void 0),r([c()],K.prototype,"autoHideManipulators",void 0),r([c()],K.prototype,"enableMidpoints",void 0),r([c()],K.prototype,"enableEdgeOffset",void 0),r([c()],K.prototype,"type",void 0),r([c({type:Lt})],K.prototype,"sketchOptions",void 0),r([c()],K.prototype,"snappingManager",void 0),r([c()],K.prototype,"updating",null),r([c()],K.prototype,"activeTooltipInfo",null),r([c()],K.prototype,"tooltip",null),r([c()],K.prototype,"automaticManipulatorSelection",void 0),K=r([b("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],K);let mt=class extends q{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([Je(()=>{const t=this._interactionState;return t&&t.angle!==t.previousAngle?{interactionState:t,angle:t.state.angle}:null},({interactionState:t})=>{this._updateMeshRotation(t)},qt),Je(()=>{const t=this._interactionState;return t&&t.scale!==t.previousScale?{interactionState:t,scale:t.state.scale}:null},({interactionState:t})=>{this._updateMeshSize(t)},qt)])}get initialAngle(){var t;return((t=this._interactionState)==null?void 0:t.initialAngle)??0}get angle(){var n;const t=this.geometry.transform;if(t==null)return((n=this._interactionState)==null?void 0:n.angle)??0;const e=Ic(t.rotation)[2];return Math.abs(e)>.999999?si(kc(t.rotation))*Math.sign(e):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var t;return((t=this._interactionState)==null?void 0:t.scale)??1}startInteraction(){const t=new zt({angle:this.angle});this._interactionState=t;const e=()=>{this._interactionState=null};return{state:t,done:e,cancel:()=>{t.cancel(),e()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(t){const{angle:e,previousAngle:n}=t;t.previousAngle=e;const o=Pi(e-n);this.geometry.rotate(0,0,o)}_updateMeshSize(t){const{scale:e,previousScale:n}=t;t.previousScale=e;const o=e/n;this.geometry.scale(o)}};r([c({constructOnly:!0})],mt.prototype,"object",void 0),r([c({constructOnly:!0})],mt.prototype,"geometry",void 0),r([c({constructOnly:!0})],mt.prototype,"viewingMode",void 0),r([c()],mt.prototype,"initialAngle",null),r([c()],mt.prototype,"angle",null),r([c()],mt.prototype,"angleClockwise",null),r([c()],mt.prototype,"relativeAngle",null),r([c()],mt.prototype,"relativeAngleClockwise",null),r([c()],mt.prototype,"scale",null),r([c()],mt.prototype,"_interactionState",void 0),mt=r([b("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],mt);let zt=class extends q{get state(){const{angle:i,scale:t}=this;return{angle:i,scale:t}}constructor(i){super(i),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=i.angle,this.previousAngle=i.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};r([c()],zt.prototype,"angle",void 0),r([c()],zt.prototype,"initialAngle",void 0),r([c()],zt.prototype,"previousAngle",void 0),r([c()],zt.prototype,"previousScale",void 0),r([c()],zt.prototype,"scale",void 0),r([c()],zt.prototype,"state",null),zt=r([b("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],zt);let W=class extends q{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(Je(()=>this._interactionState!=null?this._interactionState.state:null,t=>{this._updateSymbol(t)},qt))}get initialAngle(){var t;return((t=this._interactionState)==null?void 0:t.initialAngle)??0}get angle(){return this._interactionState!=null?this._interactionState.angle:this._orientationReferenceSymbolLayer!=null?Qd(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var t;return((t=this._interactionState)==null?void 0:t.scale)??1}get size(){const t=this._sizeReferenceSymbolLayer;if(t==null)return null;const e=this.findLayerView(),n=this._graphicSymbol;if(e==null||n==null||n.type!=="point-3d")return null;const o=e.getSymbolLayerSize(n,t);if("size"in o&&o.size!=null)return o.size;const s=this.sizeAxis;return!("width"in o)||o.width==null||s!=null&&s!=="width"&&s!=="all"&&s!=="width-and-depth"?!("depth"in o)||t.depth==null||s!=null&&s!=="depth"&&s!=="all"&&s!=="width-and-depth"?!("height"in o)||t.height==null||s!=null&&s!=="height"&&s!=="all"?null:o.height:o.depth:o.width}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return t==null||t.symbolLayers.length===0?null:t.symbolLayers.find(e=>e.type==="object")}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return t==null||t.symbolLayers.length===0?null:t.symbolLayers.find(e=>e.type==="object"&&e.heading!=null)}get _graphicSymbol(){var t;return((t=this.graphic)==null?void 0:t.symbol)!=null&&this.graphic.symbol.type==="point-3d"?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if(this._interactionState!=null||t==null||e==null)return Jd;const n=t.symbolLayers.map(p=>p.type==="object"?e.getSymbolLayerSize(t,p):null).toArray(),o=t.clone(),s=this.angle,a=new Ut({originalSymbol:o,angle:s,initialSizes:n});this._interactionState=a;const l=()=>{this._interactionState=null};return{state:a,done:l,cancel:()=>{this._graphicSymbol=o,l()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:n=>{e=n.symbol,n.symbol=t},redo:n=>{t=n.symbol,n.symbol=e}}}_updateSymbol({scale:t,angle:e,originalSymbol:n,initialSizes:o}){const s=this._graphicSymbol;if(s==null||s.type!=="point-3d")return;const a=s.clone(),l=-Pi(e-this.initialAngle);let p=!1;this._forEachObjectSymbolLayerPair(n,a,(h,u,d)=>{const g=(h.heading??0)+l;u.heading!==g&&(u.heading=g,p=!0);const v=o[d];if(v!=null&&"width"in v){v.width=this.sizeFilter(v.width),v.height=this.sizeFilter(v.height),v.depth=this.sizeFilter(v.depth);const f=v.width*t;u.width!==f&&(u.width=f,p=!0);const m=v.depth*t;u.depth!==m&&(u.depth=m,p=!0);const w=v.height*t;u.height!==w&&(u.height=w,p=!0)}}),p&&(this._graphicSymbol=a)}_forEachObjectSymbolLayerPair(t,e,n){t.symbolLayers.forEach((o,s)=>{const a=e.symbolLayers.at(s);o.type==="object"&&a.type==="object"&&n(o,a,s)})}};function Qd(i){return-si(i)}r([c()],W.prototype,"initialAngle",null),r([c()],W.prototype,"angle",null),r([c()],W.prototype,"angleClockwise",null),r([c()],W.prototype,"orientation",null),r([c()],W.prototype,"orientationClockwise",null),r([c()],W.prototype,"relativeAngle",null),r([c()],W.prototype,"relativeAngleClockwise",null),r([c()],W.prototype,"scale",null),r([c()],W.prototype,"size",null),r([c()],W.prototype,"sizeAxis",void 0),r([c({constructOnly:!0})],W.prototype,"graphic",void 0),r([c()],W.prototype,"_interactionState",void 0),r([c({constructOnly:!0})],W.prototype,"findLayerView",void 0),r([c({constructOnly:!0})],W.prototype,"sizeFilter",void 0),r([c()],W.prototype,"_sizeReferenceSymbolLayer",null),r([c()],W.prototype,"_orientationReferenceSymbolLayer",null),r([c()],W.prototype,"_graphicSymbol",null),W=r([b("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],W);const Jd={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Ut=class extends q{get state(){const{originalSymbol:i,angle:t,initialAngle:e,scale:n,initialSizes:o}=this;return{originalSymbol:i,angle:t,initialAngle:e,scale:n,initialSizes:o}}constructor(i){super(i),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=i.angle}};r([c()],Ut.prototype,"originalSymbol",void 0),r([c()],Ut.prototype,"angle",void 0),r([c()],Ut.prototype,"initialAngle",void 0),r([c()],Ut.prototype,"initialSizes",void 0),r([c()],Ut.prototype,"scale",void 0),r([c()],Ut.prototype,"state",null),Ut=r([b("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],Ut);var T;(function(i){i.ScaleIn=Ft.Custom2,i.ScaleOut=Ft.Custom3,i.RotateLeft=Ft.Custom4,i.RotateRight=Ft.Custom5,i.Unlocked=Ft.Custom7,i.DelayedFocused=Ft.Custom8,i.TouchInput=Ft.Custom12})(T||(T={}));let Gt=class extends q{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(i){this._ringManipulator.location=i}set elevationAlignedLocation(i){this._ringManipulator.elevationAlignedLocation=i}get grabbing(){return this._ringManipulator.grabbing}set interactive(i){this._ringManipulator.interactive=i}get updating(){return!!this._activeAnimation}constructor(i){super(i),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=vp,this.events=new dt,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>{var t;return((t=this._scaleRotateDragData)==null?void 0:t.mode)==="scale"?this.adapter.scale:1}}initialize(){this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([x(()=>{const{adapter:i}=this;return[i.angle,i.scale]},()=>this._updateManipulatorTransform())])}destroy(){var i;(i=this._activeAnimation)==null||i.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null}startAnimation(i){this.cancelActiveAnimation(),i.start();const t=Rc({update:({deltaTime:e})=>{i.update(e)&&this.cancelActiveAnimation()}});this._activeAnimation={...i,frameTask:t}}cancelActiveAnimation(){var i;(i=this._activeAnimation)==null||i.frameTask.remove(),this._activeAnimation=V(this._activeAnimation)}forEachManipulator(i){i(this._ringManipulator,Q.SCALE_ROTATE)}_createManipulator(){const i=this._createRingManipulator();this._ringManipulator=i,this.tool.manipulators.add(i);const t=this.tool.object,e=kt(i,(n,o,s)=>{this._scaleRotateDragData=null;const a=this.adapter.startInteraction(),l={mode:"none",origin:Xe(n.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=l,this._updateDragState();const p=R.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(n.renderLocation,p),o.next(rs(this.tool.view,dr(n.renderLocation,p,is()))).next(h=>{const u=hi(h.plane),d=Er(h.renderStart,h.renderEnd,l.origin,u),g=Hc.shortestSignedDiff(l.angle,d);l.angleDir=Ls(l.angleDir+g,-Ws,Ws),l.angle=d;const v=tg(l,h),f=v-this.adapter.scale;if(l.scaleDir=Ls(l.scaleDir+f,-qs,qs),this._onScaleChanged(),l.mode==="none"){const m=this.mode||eg(h,h.plane,l.origin,this.tool.view.state.camera);if(m!=null){switch(m){case"rotate":this.tool.events.emit("rotate-start",{object:t,angle:0}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]});break;case"scale":this.tool.events.emit("scale-start",{object:t,xScale:1,yScale:1}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]})}l.mode=m}}switch(l.mode){case"rotate":a.state.angle=l.initialAngle+d;break;case"scale":a.state.scale=v,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),h.action){case"start":case"update":switch(l.mode){case"rotate":this.tool.events.emit("rotate",{object:t,angle:Pi(l.angle)});break;case"scale":this.tool.events.emit("scale",{object:t,xScale:v,yScale:v})}break;case"end":switch(l.mode){case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:Pi(l.angle)});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:v,yScale:v})}}return h.action==="end"&&(this.startAnimation(za(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),a.done()),h}),s.next(()=>{if(a.cancel(),this._scaleRotateDragData!=null){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:0});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:1,yScale:1})}this.startAnimation(za(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}})});this.addHandles([e,i.events.on("focus-changed",n=>{n.action==="focus"?this.startAnimation(ig(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),i.events.on("immediate-click",n=>{n.stopPropagation()}),x(()=>this.tool.object.visible,n=>this._ringManipulator.available=n,N)])}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(T.DelayedFocused,this.getFocused())}_updateDragState(){var i;if(this._ringManipulator.updateStateEnabled(T.Unlocked,!(this._scaleRotateDragData!=null&&((i=this._scaleRotateDragData)==null?void 0:i.mode)!=="none")),this._scaleRotateDragData!=null)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(T.ScaleIn|T.ScaleOut,!1),this._ringManipulator.updateStateEnabled(T.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(T.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(T.RotateLeft|T.RotateRight,!1),this._ringManipulator.updateStateEnabled(T.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(T.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(T.ScaleIn|T.ScaleOut|T.RotateLeft|T.RotateRight,!1)}_updateManipulatorTransform(){const i=Cc(We.get(),this.adapter.angle,Ci(0,0,1));if(i==null)return;const t=this.getScale(),e=Ac(We.get(),fe(R.get(),t,t,t));this._ringManipulator.modelTransform=Dc(We.get(),e,i)}_createRingManipulator(){const i=(E,pt,Ct)=>{const te=[],ee=Math.ceil(_p*(pt-E)/(2*Math.PI));for(let nt=0;nt<ee+1;nt++){const fi=E+nt*(pt-E)/ee;te.push(Ci(Ct*Math.cos(fi),Ct*Math.sin(fi),0))}return te},t=E=>i(0,2*Math.PI,E),e=E=>[[-E/2,0],[E/2,0],[E/2,Yn/2],[-E/2,Yn/2]],n=this._createMaterial(1),o=(E,pt,Ct=n)=>zc(Ct,e(pt),E,[],[],!1),s=t(mi),a=o(s,Bn),l={left:new Array,right:new Array},p=[];for(let E=0;E<2;E++){const pt=E*Math.PI-Math.PI/4,Ct=Math.PI/2-yp,te=pt+Ct,ee=pt+Math.PI/2-Ct,nt=i(te,ee,mp),fi=o(nt,De);p.push(nt),p.push(i(te,ee,Ks-Bn/2)),l.left.push(fi),l.right.push(fi.instantiate());for(let zn=0;zn<2;zn++){const Ms=zn===0,gt=Uc();if(Ms){Pc(gt,gt,[1,-1,1]),js(gt,gt,-te,[0,0,1]);const me=Math.round(Xs*(nt.length-1));gt[12]=nt[me][0],gt[13]=nt[me][1],gt[14]=nt[me][2]}else{js(gt,gt,ee,[0,0,1]);const me=Math.round((1-Xs)*(nt.length-1));gt[12]=nt[me][0],gt[13]=nt[me][1],gt[14]=nt[me][2]}const xs=_o(n,Mp,0,bp,Yn);Vc(xs,gt),(Ms?l.left:l.right).push(xs)}}const h=[];for(let E=0;E<2;E++){const pt=E*Math.PI-Math.PI/4,Ct=Math.PI/2-wp,te=pt+Ct,ee=pt+Math.PI/2-Ct,nt=i(te,ee,Ks);h.push(o(nt,De))}const u=this._createMaterial(.66),d=this._createMaterial(.5),g=this._createMaterial(.33),v=t(mi+Qs),f=t(mi+Js),m=o(v,De,u),w=o(f,De,g),_=t(mi-Qs),M=t(mi-Js),k=o(_,De,u),G=o(M,De,g);let $=[new H(a,T.DelayedFocused),new H(a.instantiate({material:d}),F.None)];this.mode&&this.mode!=="scale"||($=$.concat([...h.map(E=>new H(E,T.DelayedFocused|T.Unlocked)),new H(m,T.DelayedFocused|T.ScaleIn),new H(w,T.DelayedFocused|T.ScaleIn),new H(k,T.DelayedFocused|T.ScaleOut),new H(G,T.DelayedFocused|T.ScaleOut)])),this.mode&&this.mode!=="rotate"||($=$.concat([...l.right.map(E=>new H(E.instantiate(),T.DelayedFocused|T.Unlocked)),...l.left.map(E=>new H(E,T.DelayedFocused|T.RotateLeft)),...l.right.map(E=>new H(E,T.DelayedFocused|T.RotateRight))]));const j=[s,...p];return new ue({view:this.tool.view,renderObjects:$,autoScaleRenderObjects:!1,worldOriented:!0,radius:Bn,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:j,direction:Ci(0,0,1)}})}_createMaterial(i){const t=new ph({cullFace:jc.Back,renderOccluded:Oe.Transparent,isDecoration:!0});return this.addHandles(x(()=>Lc(this.tool.view.effectiveTheme.accentColor,i),e=>t.setParameters({color:e}),N)),t}get test(){}};function tg(i,t){const e=B(R.get(),t.renderStart,i.origin),n=B(R.get(),t.renderEnd,i.origin),o=ei(e),s=ei(n);return o===0?0:s/o}function eg(i,t,e,n){const{renderStart:o,renderEnd:s}=i,a=sn(o,n,R.get()),l=sn(s,n,R.get());if(Gc(a,l)<ta*ta)return null;const p=B(R.get(),o,e),h=Ie(R.get(),p,hi(t)),u=o,d=Tt(R.get(),u,h),g=sn(e,n,R.get()),v=a,f=sn(d,n,R.get()),m=B(R.get(),f,v),w=B(R.get(),a,g),_=Hs(v,m),M=Hs(g,w);return zs(_,l)<zs(M,l)?"rotate":"scale"}function sn(i,t,e){return t.projectToScreen(i,ro),fe(e,ro[0],ro[1],0)}var oi;function za(i,t){let e=null,n=1;const o=()=>n;return{start:()=>{n=i.getScale(),e=i.getScale,i.getScale=o,t()},update:s=>(n+=((n+1)/2-n)*Math.min(s*xp,1),t(),Math.abs(n-1)<.01?oi.STOP:oi.CONTINUE),destroy:()=>{e&&(i.getScale=e),t()}}}function ig(i,t,e){let n=0,o=null;const s=()=>!1;return{start:()=>{o=i.getFocused,i.getFocused=s,n=0,t()},update:a=>(n+=a,!(o!=null&&o())||n>=e.delayMs?oi.STOP:oi.CONTINUE),destroy:()=>{o&&(i.getFocused=o),t()}}}r([c({constructOnly:!0})],Gt.prototype,"tool",void 0),r([c({constructOnly:!0})],Gt.prototype,"adapter",void 0),r([c({constructOnly:!0})],Gt.prototype,"sketchOptions",void 0),r([c()],Gt.prototype,"mode",void 0),r([c()],Gt.prototype,"_activeAnimation",void 0),r([c()],Gt.prototype,"updating",null),Gt=r([b("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],Gt),function(i){i[i.CONTINUE=0]="CONTINUE",i[i.STOP=1]="STOP"}(oi||(oi={}));const ro=Re();let Ti=class extends ve(z){constructor(t){super(t),this.type="transform-mesh",this.orientation=ds(),this.scale=Jr(),this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};r([c()],Ti.prototype,"key",null),r([c()],Ti.prototype,"allFields",null),Ti=r([b("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],Ti);let fn=class extends ve(z){constructor(t){super(t),this.type="transform-point",this.orientation=ds({readOnly:!0}),this.size=qu({readOnly:!0}),this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.size]}};r([c()],fn.prototype,"allFields",null),fn=r([b("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],fn);let vt=class extends Ni{constructor(i){super(i),this.events=new dt,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new Lt,this.type="transform-3d",this._updatingHandles=new ai,this._scaleRotate=null}initialize(){var p;const{events:i,object:t,view:e}=this;this.tooltip=Bi(()=>({view:e,options:this.sketchOptions.tooltips})),this._moveManipulation=new $e({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Te(t.operations,t.elevationInfo),radius:$e.radiusForSymbol((p=t.graphic)==null?void 0:p.symbol)}),this._moveManipulation.forEachManipulator(h=>this.addHandles(h.events.on("immediate-click",u=>{i.emit("immediate-click",{...u,object:this.object}),u.stopPropagation()})));const n=t.elevationInfo;if(this._moveManipulation.elevationInfo=n,this.addHandles(ls(t)),this._moveManipulation.createManipulatedObjectDragPipeline((h,u,d,g,v)=>{var f;if(h===tt.XY){const{snappingStep:m,cancelSnapping:w}=ji({snappingContext:new ii({elevationInfo:n,pointer:v,editGeometryOperations:kn.fromGeometry(new It({spatialReference:(f=t.operations)==null?void 0:f.data.spatialReference}),e.state.viewingMode),visualizer:new Li,excludeFeature:t.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});g=g.next(w),d=d.next(Wp(this.view,n)).next(...m)}return{steps:d,cancel:g}},t,h=>{const{action:u,object:d,dxScreen:g,dyScreen:v}=h,f={object:d,dxScreen:g,dyScreen:v};switch(u){case"start":this._emitRecordUndo(),i.emit("translate-start",f);break;case"update":i.emit("translate",f);break;case"end":i.emit("translate-stop",f)}}),this._moveManipulation.angle=this._scaleRotate!=null?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles(x(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){const h=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Gt({tool:this,mode:h,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions}),this.addHandles(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))}this.addHandles([Hn({view:this.view,object:t,forEachManipulator:h=>this._forEachManipulator(h),onManipulatorsChanged:()=>Z()}),t.on("committed",()=>this._onGeometryChanged()),this._hideManipulatorsForObjectState(),x(()=>e.scale,()=>this._updateMoveAngle())].filter(li)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(h=>{h instanceof ue&&this.addHandles(h.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))});const o=e==null?void 0:e.type,{sketchOptions:s}=this;this._meshTooltipInfo=new Ti({viewType:o,sketchOptions:s}),this._pointTooltipInfo=new fn({viewType:o,sketchOptions:s});const a={object:t,dxScreen:0,dyScreen:0},l={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),i.emit("translate-start",{...a})},onMove:()=>i.emit("translate",{...a}),onMoveStop:()=>i.emit("translate-stop",{...a}),onRotateStart:h=>{this._emitRecordUndo(),i.emit("rotate-start",{object:t,angle:h})},onRotate:h=>i.emit("rotate",{object:t,angle:h}),onRotateStop:h=>i.emit("rotate-stop",{object:t,angle:h}),onScaleStart:(h,u)=>{this._emitRecordUndo(),i.emit("scale-start",{object:t,xScale:h,yScale:u})},onScale:(h,u)=>i.emit("scale",{object:t,xScale:h,yScale:u}),onScaleStop:(h,u)=>i.emit("scale-stop",{object:t,xScale:h,yScale:u})};this.addHandles(hl(this.tooltip,this.object,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:l,scaleRotateTransform:this._scaleRotate}))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=V(this._scaleRotate),this._scaleRotateAdapter=V(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}onInputEvent(i){if(!this.destroyed&&!zi(i,this.tooltip))return super.onInputEvent(i)}_updateManipulatorsInteractive(){this._scaleRotate!=null&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){var t,e,n,o;const i=J(this.object);return(i==null?void 0:i.type)==="mesh"?new mt({object:this.object,geometry:i,viewingMode:this.view.state.viewingMode}):new W({graphic:this.object.graphic,sizeFilter:s=>this._enforceNonZeroSize(s),findLayerView:()=>this.view.allLayerViews.find(s=>{var a;return s.layer===((a=this.object.graphic)==null?void 0:a.layer)}),sizeAxis:((o=(n=(e=(t=this.sketchOptions)==null?void 0:t.tooltips)==null?void 0:e.visualVariables)==null?void 0:n.size)==null?void 0:o.axis)??null})}_forEachManipulator(i){var t,e;(t=this._moveManipulation)==null||t.forEachManipulator(i),(e=this._scaleRotate)==null||e.forEachManipulator(i)}_hideManipulatorsForObjectState(){return x(()=>this.object.visible,i=>{this._forEachManipulator(t=>t.available=i),this._moveManipulation.zManipulation.available=i&&this.enableZ&&Te(this.object.operations,this.object.elevationInfo)})}_emitRecordUndo(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}set snapToScene(i){this._moveManipulation&&(this._moveManipulation.snapToScene=i),this._set("snapToScene",i)}get updating(){var i;return this._updatingHandles.updating||!!((i=this._scaleRotate)!=null&&i.updating)}get activeTooltipInfo(){var i;return((i=J(this.object))==null?void 0:i.type)==="mesh"?this._meshTooltipInfo:this._pointTooltipInfo}set location(i){this._moveManipulation.location=i,this._scaleRotate&&(this._scaleRotate.location=i)}set elevationAlignedLocation(i){this._moveManipulation.elevationAlignedLocation=i,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=i)}reset(){}onHide(){var i;(i=this._scaleRotate)==null||i.cancelActiveAnimation()}_onScaleChanged(){this._scaleRotate!=null&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){const{view:i}=this,t=i.state.viewingMode===rr.Local||i.scale<Sp;this._moveManipulation.angle=t?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){$r(this,this.object)}_enforceNonZeroSize(i){return i||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};r([c({constructOnly:!0,nonNullable:!0})],vt.prototype,"view",void 0),r([c({constructOnly:!0,nonNullable:!0})],vt.prototype,"object",void 0),r([c({constructOnly:!0,nonNullable:!0})],vt.prototype,"enableZ",void 0),r([c()],vt.prototype,"enableRotation",void 0),r([c()],vt.prototype,"enableScaling",void 0),r([c({constructOnly:!0,type:Lt})],vt.prototype,"sketchOptions",void 0),r([c({value:!1})],vt.prototype,"snapToScene",null),r([c({constructOnly:!0})],vt.prototype,"snappingManager",void 0),r([c({readOnly:!0})],vt.prototype,"type",void 0),r([c({readOnly:!0})],vt.prototype,"updating",null),r([c()],vt.prototype,"activeTooltipInfo",null),vt=r([b("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],vt);class ng{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(t,e){this._tool=t,this._bounds=e,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const n=this._tool,o=n.view;this.moveXYObjectManipulation=new bs({view:o,tool:n,object:this._object}),n.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new hh(o,uh.CENTER_ON_CALLOUT),this.moveZManipulator.state|=dh,n.manipulators.add(this.moveZManipulator),n.addHandles([this._createMoveZDragPipeline()]),n.addHandles([n.events.on("translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null})])}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(t){this.moveXYObjectManipulation.forEachManipulator(t),t(this.moveZManipulator,Q.TRANSLATE_Z)}updateManipulators(t,e){const n=this.moveZManipulator,o=Fc(We.get(),t,Math.PI);o[12]=0,o[13]=0,o[14]=0,n.modelTransform=o,n.renderLocation=B(R.get(),e.origin,e.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const t=this._tool,e=this._moveXYTooltipInfo??(this._moveXYTooltipInfo=new we({sketchOptions:t.sketchOptions}));if(this.moveXYObjectManipulation.dragging){const n=this._bounds,o=n.mapBoundsStart.origin,s=n.mapBounds.origin,{renderSpatialReference:a}=t.view;if(!a)return null;const l=Me(o,s,a);if(l==null)return null;e.distance=l}else e.distance=U;return e}_computeMoveZTooltipInfo(){const t=this._tool,e=this._moveZTooltipInfo??(this._moveZTooltipInfo=new Se({sketchOptions:t.sketchOptions}));if(this.moveZManipulator.dragging){const n=this._bounds,o=n.mapBoundsStart.origin,s=n.mapBounds.origin,{renderSpatialReference:a}=t.view;if(!a)return null;const l=lp(o,s,a);if(l==null)return null;e.distance=l}else e.distance=U;return e}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline((t,e,n)=>this._applyObjectMoveSteps(e,n))}_createMoveZDragPipeline(){if(!this._operations)return Z();const t=this._operations.data.spatialReference;return kt(this.moveZManipulator,(e,n,o)=>{const s=Xe(e.renderLocation),a=n.next(ch(this._tool.view,s,t)).next(as());this._applyObjectMoveSteps(a,o)})}_applyObjectMoveSteps(t,e){const{_tool:n,_object:o}=this,s=t.next(a=>(a.action==="start"&&(n.inputState={type:"move"},this._bounds.backupMapBounds(),n.events.emit("translate-start",{object:o,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY})),a)).next(Ze()).next(this._moveDragUpdateGeometry()).next(a=>{const l={object:o,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY};switch(a.action){case"start":case"update":(a.mapEnd.x-a.mapStart.x||a.mapEnd.y-a.mapStart.y||(a.mapEnd.z??0)-(a.mapStart.z??0))&&n.events.emit("translate",l);break;case"end":n.inputState=null,n.events.emit("translate-stop",l)}return a});return e.next(()=>{n.inputState!=null&&n.events.emit("translate-stop",{object:o,dxScreen:0,dyScreen:0}),n.cancel()}),s}_moveDragUpdateGeometry(){const t=this._tool;return e=>{if(t.inputState==null||t.inputState.type!=="move")return e;const n=e.action==="start"?Rt.NEW_STEP:Rt.ACCUMULATE_STEPS;if(this._operations){const o=this._operations.move(e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,n);this._bounds.updateMapBoundsFromOperation(o)}return e}}}let Ii=class extends z{constructor(t){super(t),this.type="extent-rotate",this.angle=0}};r([c()],Ii.prototype,"type",void 0),r([c()],Ii.prototype,"angle",void 0),Ii=r([b("esri.views.interactive.tooltip.infos.ExtentRotateTooltipInfo")],Ii);let og=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(t,e,n){var l;this._tool=t,this._bounds=e,this._snapRotation=n,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const o=this._tool,s=o.view,a=!((l=s._stage)!=null&&l.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this.rotateManipulator=new gh(s,(p,h)=>xh(s.textures,{accentColor:p,contrastColor:h,preMultiplyAlpha:a})),o.addHandles([this.rotateManipulator.events.on("grab-changed",p=>this._onRotateGrab(p)),this._createRotateDragPipeline(this.rotateManipulator)]),o.manipulators.add(this.rotateManipulator),o.addHandles([o.events.on("rotate-start",p=>this._startAngle=p.angle),o.events.on("rotate",p=>this._endAngle=p.angle),o.events.on("rotate-stop",()=>{this._startAngle=0,this._endAngle=0})])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(t){t(this.rotateManipulator,Q.ROTATE)}updateManipulators(t,e){const n=this._bounds.mapBounds.plane[2]<0?Math.PI:0,o=Nc(We.get(),t,n);o[12]=0,o[13]=0,o[14]=0,this.rotateManipulator.modelTransform=o,this.rotateManipulator.renderLocation=Tt(R.get(),e.origin,e.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){const t=this._rotateTooltipInfo??(this._rotateTooltipInfo=new Ii({sketchOptions:this._tool.sketchOptions}));return t.angle=this._startAngle-this._endAngle,t}_onRotateGrab({action:t,screenPoint:e}){const n=this._tool,o=this._bounds;if(t!=="start"||!e)return;const s=fh(o.displayBounds,n.view.renderCoordsHelper,vh.HEADING,is()),a=fr(n.view.state.camera,e);vr(s,a,R.get())&&(o.backupMapBounds(),n.inputState={type:"rotate",rotatePlane:s})}_createRotateDragPipeline(t){const{_tool:e,_object:n}=this;return kt(t,(o,s,a)=>{const l=e.inputState;l!=null&&(s.next(p=>(p.action==="start"&&e.events.emit("rotate-start",{object:n,angle:0}),p)).next(rs(e.view,l.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(l)).next(...this._snapRotation()).next(this._rotateDragUpdateGeometry()).next(p=>{const h={object:n,angle:Pi(p.rotateAngle)};switch(p.action){case"start":case"update":e.events.emit("rotate",h);break;case"end":e.inputState=null,e.events.emit("rotate-stop",h)}return p}),a.next(()=>{e.inputState!=null&&e.events.emit("rotate-stop",{object:n,angle:0}),e.cancel()}))})}_rotateDragRenderPlaneToRotate(t){return e=>{const n=hi(t.rotatePlane),o=Er(e.renderStart,e.renderEnd,this._bounds.displayBounds.origin,n);return{...e,rotateAxis:n,rotateAngle:o}}}_rotateDragUpdateGeometry(){const t=this._bounds;return e=>{const n=bn(O(),t.mapBoundsStart.origin),o=e.action==="start"?Rt.NEW_STEP:Rt.ACCUMULATE_STEPS;if(this._operations){const s=this._operations.rotate(n,e.rotateAngle,o,Ir.REPLACE);Vi(t.mapBoundsStart,t.mapBounds),t.updateMapBoundsFromOperation(s)}return e}}};function sg(i,t){return fl(i,t,!1)}function ag(i,t){return fl(i,t,!0)}function fl(i,t,e){if(i instanceof ih){if(i.operation instanceof nh)return rg(i.operation,t,e),!0;if(i.operation instanceof oh)return lg(i.operation,t,e),!0;if(i.operation instanceof sh)return cg(i.operation,t,e),!0}return!1}function rg(i,t,e=!1){const n=e?-1:1,o=Ci(n*i.dx,n*i.dy,n*i.dz);Tt(t.origin,t.origin,o),Fi(t)}function lg(i,t,e=!1){const n=e?-i.angle:i.angle;Us(t.basis1,t.basis1,Gs,n),Us(t.basis2,t.basis2,Gs,n),Fi(t)}function cg(i,t,e=!1){const n=e?1/i.factor1:i.factor1,o=e?1/i.factor2:i.factor2;jt(t.basis1,t.basis1,n),jt(t.basis2,t.basis2,o),Fs(t.origin,t.origin,i.origin,i.axis1,n),Fs(t.origin,t.origin,i.origin,i.axis2,o),Fi(t)}function pg(i,t,e,n){n||(n=qe());const o=Zt(vi.get(),i[1],-i[0]),s=Zt(vi.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=Zt(vi.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=vi.get();t.components.forEach(u=>u.vertices.forEach(({pos:d})=>{Zt(l,Ns(i,d),Ns(o,d)),Zc(s,s,l),Bc(a,a,l)}));const p=1e-6,h=Zt(vi.get(),a[0]-s[0]<p?e/2:0,a[1]-s[1]<p?e/2:0);return Yc(s,s,h),rn(a,a,h),vn(n.basis1,i,(a[0]-s[0])/2),vn(n.basis2,o,(a[1]-s[1])/2),Zt(n.origin,s[0]*i[0]+s[1]*o[0],s[0]*i[1]+s[1]*o[1]),rn(n.origin,n.origin,n.basis1),rn(n.origin,n.origin,n.basis2),Fi(n),n}function hg({topLeft:i,topRight:t,bottomRight:e,bottomLeft:n,spatialReference:o}){const s=Zs(Me(n,e,o),Me(i,t,o));if(s==null)return null;const a=Zs(Me(e,t,o),Me(n,i,o));return a==null?null:{xSize:s,ySize:a}}let ug=class{constructor(t,e){this._tool=t,this.mapBounds=qe(),this.mapBoundsStart=qe(),this.displayBounds=qe(),t.addHandles(ki(()=>t.object,"modified-externally",()=>this._resetMapBounds(),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=e}get displayBoundsMargin(){var s,a;const{view:t,object:e}=this._tool,n=J(e),o=((s=t.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent.location)??((a=n==null?void 0:n.extent)==null?void 0:a.center);return o?dg*t.pixelSizeAt(o):0}backupMapBounds(){Vi(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){var t;this._calculateDisplayBounds(),(t=this._onDisplayBoundsChanged)==null||t.call(this)}updateMapBoundsFromOperation(t){sg(t,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(t){ag(t,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){var p;const{view:t,attachmentOrigin:e,object:n}=this._tool,o=(p=n.operations)==null?void 0:p.data;if(!o)return;const s=o.geometry;this.spatialReference=s.spatialReference;const a=Od(s);vn(a,a,-1);const l=e?t.pixelSizeAt(e,s.spatialReference):0;pg(a,o,gg*l,this.mapBounds)}_calculateDisplayBounds(){const{view:t,attachmentOrigin:e}=this._tool,n=(e==null?void 0:e.z)??Jo(this.mapBounds.origin,t.elevationProvider,Tn.fromElevationInfo(this._tool.object.elevationInfo),t.renderCoordsHelper),o=Vi(this.mapBounds);o.origin[2]=n??0,fg(o,t.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}};const dg=10,gg=80;function fg(i,t,e,n=0,o){o||(o=qe()),t.toRenderCoords(i.origin,e,o.origin);const s=R.get();Tt(s,i.origin,i.basis1),Tt(s,s,i.basis2),t.toRenderCoords(s,e,s);const a=R.get();Tt(a,i.origin,i.basis1),B(a,a,i.basis2),t.toRenderCoords(a,e,a);const l=R.get();B(l,i.origin,i.basis1),B(l,l,i.basis2),t.toRenderCoords(l,e,l);const p=R.get();B(p,i.origin,i.basis1),Tt(p,p,i.basis2),t.toRenderCoords(p,e,p);const h=le(R.get(),s,a,.5);B(h,h,o.origin);const u=le(R.get(),l,p,.5);B(u,o.origin,u),le(o.basis1,h,u,.5);const d=le(R.get(),p,s,.5);B(d,d,o.origin);const g=le(R.get(),a,l,.5);B(g,o.origin,g),le(o.basis2,d,g,.5);const v=Ie(R.get(),o.basis1,o.basis2),f=Ie(v,v,o.basis1);return qa(f,f),jt(o.basis2,f,_n(o.basis2,f)),jt(o.basis1,o.basis1,1+n/ei(o.basis1)),jt(o.basis2,o.basis2,1+n/ei(o.basis2)),Fi(o),o}function vg(i,t,e){return B(ze,B(ze,i.origin,i.basis1),i.basis2),pe(an,ze,i.basis1,2),pe(co,an,i.basis2,2),pe(lo,ze,i.basis2,2),ze[2]=an[2]=co[2]=lo[2]=t,hg({topLeft:lo,topRight:co,bottomRight:an,bottomLeft:ze,spatialReference:e})}const lo=O(),co=O(),an=O(),ze=O();let re=class extends z{constructor(t){super(t),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=U,this.ySize=U}};r([c()],re.prototype,"type",void 0),r([c()],re.prototype,"xScale",void 0),r([c()],re.prototype,"yScale",void 0),r([c()],re.prototype,"xSize",void 0),r([c()],re.prototype,"ySize",void 0),re=r([b("esri.views.interactive.tooltip.infos.ExtentScaleTooltipInfo")],re);class mg{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;const t=this._operations.data;if(t.geometry.hasZ){const e=t.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const n of t.components)for(const o of n.vertices){const s=e.getZ(o.pos)??0;this._zMax=Math.max(s,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(t,e,n){this._tool=t,this._bounds=e,this._preserveAspectRatioStep=n,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._displayBoundsStart=qe(),this._displayBoundsMarginStart=0,this._zMax=0,this._zMaxDirty=!0;const o=this._tool,s=o.view;this.resizeManipulators=this._resizeHandles.map(a=>{const l=new mh(s,a);return o.addHandles([l.events.on("grab-changed",p=>this._onResizeGrab(p)),this._createResizeDragPipeline(l,a)]),l}),o.manipulators.addMany(this.resizeManipulators),this._operations&&o.addHandles(this._operations.data.on("change",()=>{var a;((a=o.inputState)==null?void 0:a.type)!=="resize"&&(this._zMaxDirty=!0)}))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()})}forEachManipulator(t){this.resizeManipulators.forEach(e=>t(e,Q.SCALE))}updateManipulators(t,e){this.resizeManipulators.forEach((n,o)=>{_h(n,this._resizeHandles[o],t,e)})}getUpdatedTooltipInfo(){if(!this.resizeManipulators.some(n=>n.focused))return null;const t=this._tooltipInfo??(this._tooltipInfo=new re({sketchOptions:this._tool.sketchOptions})),e=vg(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference);return e&&(t.xSize=e.xSize,t.ySize=e.ySize),this.resizeManipulators.some(n=>n.dragging)||(t.xScale=1,t.yScale=1),t}_onResizeGrab({action:t,screenPoint:e}){const n=this._tool,o=this._bounds;if(t!=="start"||!e)return;const s=fr(n.view.state.camera,e);vr(o.displayBounds.plane,s,R.get())&&(o.backupMapBounds(),Vi(o.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=o.displayBoundsMargin,n.inputState={type:"resize"})}_createResizeDragPipeline(t,e){const{_tool:n,_object:o}=this;return kt(t,(s,a,l)=>{n.inputState!=null&&(a.next(p=>(p.action==="start"&&n.events.emit("scale-start",{object:o,xScale:1,yScale:1}),p)).next(rs(n.view,this._displayBoundsStart.plane)).next(p=>({...p,handle:e})).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next(p=>{const h=this._tooltipInfo;h&&(h.xScale=p.factor1,h.yScale=p.factor2);const u={object:o,xScale:p.factor1,yScale:p.factor2};switch(p.action){case"start":case"update":n.events.emit("scale",u);break;case"end":n.inputState=null,n.events.emit("scale-stop",u)}return p}),l.next(()=>{n.inputState!=null&&n.events.emit("scale-stop",{object:o,xScale:1,yScale:1}),n.cancel()}))})}_resizeDragRenderPlaneToFactors(){const t=this._bounds;return e=>{const n=this._displayBoundsStart,o=e.handle.direction,s=t.displayBoundsMargin,a=this._displayBoundsMarginStart,l=bn(R.get(),n.origin);pe(l,l,n.basis1,-o[0]),pe(l,l,n.basis2,-o[1]);const p=B(R.get(),e.renderEnd,l),h=B(R.get(),e.renderStart,l),u=kr(e.handle),d=la(n),g=la(t.displayBounds)/d,v=(f,m)=>{if(f===0)return 1;let w=ei(m),_=.5*f*_n(m,p)/w;const M=_<0?-1:1;u&&(_+=(w-.5*f*_n(m,h)/w)*M*g);const k=w<1.5*a?1:Ua;return w=Math.max(w-a,Ua),M>0&&(_-=s),M*Math.max(M*(_/w),k)};return{...e,factor1:v(o[0],n.basis1),factor2:v(o[1],n.basis2)}}}_resizeDragUpdateGeometry(){const t=this._bounds;return e=>{const n=bn(O(),t.mapBoundsStart.origin);pe(n,n,t.mapBoundsStart.basis1,-e.handle.direction[0]),pe(n,n,t.mapBoundsStart.basis2,-e.handle.direction[1]);const o=Zt(Bo(),t.mapBoundsStart.basis1[0],t.mapBoundsStart.basis1[1]);Ya(o,o);const s=e.action==="start"?Rt.NEW_STEP:Rt.ACCUMULATE_STEPS;if(this._operations){const a=this._operations.scale(n,o,e.factor1,e.factor2,s,Ir.REPLACE);Vi(t.mapBoundsStart,t.mapBounds),t.updateMapBoundsFromOperation(a)}return e}}}const Ua=1e-6;class _g{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null&&this._next!=null){const e={...this._lastDragEvent,action:"update"};t&&Ga(e),this._next.execute(e)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;const t=new Tr;return this._next=t,[e=>(this._lastDragEvent=e.action!=="end"?{...e}:null,this._enabled&&Ga(e),e),t]}get test(){}}function Ga(i){const t=kr(i.handle)?Math.max(Math.abs(i.factor1),Math.abs(i.factor2)):i.handle.direction[0]===0?Math.abs(i.factor2):Math.abs(i.factor1);i.factor1=i.factor1<0?-t:t,i.factor2=i.factor2<0?-t:t}let yg=class{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=si(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null&&this._next!=null){const e={...this._lastDragEvent,action:"update"};t&&this._adjustRotation(e),this._next.execute(e)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;const t=new Tr;return this._next=t,[e=>(this._lastDragEvent=e.action!=="end"?{...e}:null,this._enabled&&this._adjustRotation(e),e),t]}_adjustRotation(t){t.rotateAngle=Math.round(t.rotateAngle/this.incrementRadians)*this.incrementRadians}},at=class extends Ni{get updating(){return!!this.object.updating}constructor(t){super(t),this.events=new dt,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new Lt,this._preserveAspectRatio=new _g,this._snapRotation=new yg,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:t,object:e}=this,n=this._bounds=new ug(this,()=>this._updateManipulators());this._extentMove=new ng(this,n),this._extentScale=new mg(this,n,()=>this._preserveAspectRatio.createDragEventPipelineStep()),this._extentRotate=new og(this,n,()=>this._snapRotation.createDragEventPipelineStep()),this.addHandles([x(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,Q.TRANSLATE_Z)),x(()=>this.enableScaling,()=>this._extentScale.forEachManipulator(l=>this._updateManipulatorAvailability(l,Q.SCALE))),x(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,Q.ROTATE))]),this._updateManipulators(),this._updateAllManipulatorAvailability();const o=Hn({view:t,object:e,forEachManipulator:l=>this._forEachManipulator(l),onManipulatorsChanged:()=>Z()});if(o!=null){const{visualElement:l}=o;l instanceof ke&&(this._outlineVisualElement=l,this.addHandles(l.events.on("attachment-origin-changed",()=>this._bounds.updateDisplayBounds()))),this.addHandles(o)}this.addHandles([e.on("committed",()=>this._onGeometryChanged()),x(()=>this.object.visible,()=>this._updateAllManipulatorAvailability()),x(()=>this.object.isDraped,()=>this._graphicDrapedChanged(),N),x(()=>{var l;return(l=t.pointsOfInterest)==null?void 0:l.centerOnSurfaceFrequent.location},()=>n.updateDisplayBounds())]);const s=l=>{this.addHandles(l.events.on("grab-changed",()=>{this.grabbing=l.grabbing,this._updateAllManipulatorAvailability()}))};this._forEachManipulator(s);const a=(l,p)=>{this.addHandles(l.events.on("immediate-click",h=>{p===Q.TRANSLATE_XY&&this.events.emit("immediate-click",{...h,object:e}),h.stopPropagation()}))};this._forEachManipulator(a),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}_initializeTooltip(){const{view:t}=this;this.tooltip=Bi(()=>({view:t,options:this.sketchOptions.tooltips}));const e=()=>{this.tooltip.info=this._getUpdatedTooltipInfo()};this.addHandles([x(()=>this.sketchOptions.tooltips.effectiveEnabled,e),x(()=>this.preserveAspectRatio,e)]),this._forEachManipulator(n=>{this.addHandles([n.events.on(["focus-changed","grab-changed"],e),n.events.on("drag",o=>{o.action==="cancel"?this.tooltip.clear():e()})])})}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(Fa),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",t=>{this._attachmentOrigin!=null&&ur(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()}),Fa)}_updateManipulators(){if(!this.visible)return;const t=this._bounds.displayBounds,e=yh(t,We.get());this._extentMove.updateManipulators(e,t),this._extentScale.updateManipulators(e,t),this._extentRotate.updateManipulators(e,t)}_updateAllManipulatorAvailability(){this._forEachManipulator((t,e)=>this._updateManipulatorAvailability(t,e))}_updateManipulatorAvailability(t,e){const n=this.grabbing&&!t.grabbing;if(t.interactive=!n,t instanceof ue){const o=this.object.visible,s=this.enableZ&&Te(this.object.operations,this.object.elevationInfo);switch(e){case Q.ROTATE:t.available=o&&this.enableRotation;break;case Q.SCALE:t.available=o&&(this.enableScaling||this.enableRotation||s),t.interactive=!n&&this.enableScaling,t.state=this.enableScaling?bh:Mh;break;case Q.TRANSLATE_Z:t.available=o&&s;break;default:t.available=o}}}_forEachManipulator(t){this._extentMove.forEachManipulator(t),this._extentScale.forEachManipulator(t),this._extentRotate.forEachManipulator(t)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(t){this._snapRotation.enabled=t,this._set("snapRotation",t)}get attachmentOrigin(){var e,n,o;const t=this.object.isDraped?null:(e=this._outlineVisualElement)==null?void 0:e.attachmentOrigin;return this._attachmentOrigin=t??this.object.origin??((o=(n=J(this.object))==null?void 0:n.extent)==null?void 0:o.center),this._attachmentOrigin}reset(){}cancel(){var t;if(this.canUndo){const e=(t=this.object.operations)==null?void 0:t.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}this.inputState=null}get canUndo(){var t;return!!((t=this.object.operations)!=null&&t.canUndo)}undo(){var t;if(this.inputState!=null)this.view.activeTool=null;else if(this.canUndo){const e=(t=this.object.operations)==null?void 0:t.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}}get canRedo(){var t;return!!((t=this.object.operations)!=null&&t.canRedo)}redo(){var t;if(this.canRedo){const e=(t=this.object.operations)==null?void 0:t.redo();e&&this._bounds.updateMapBoundsFromOperation(e)}}get test(){}};r([c()],at.prototype,"updating",null),r([c({constructOnly:!0,nonNullable:!0})],at.prototype,"view",void 0),r([c({constructOnly:!0,nonNullable:!0})],at.prototype,"object",void 0),r([c()],at.prototype,"enableZ",void 0),r([c()],at.prototype,"enableScaling",void 0),r([c()],at.prototype,"enableRotation",void 0),r([c({constructOnly:!0,type:Lt})],at.prototype,"sketchOptions",void 0),r([c()],at.prototype,"preserveAspectRatio",null),r([c()],at.prototype,"snapRotation",null),r([c()],at.prototype,"grabbing",void 0),r([c()],at.prototype,"inputState",void 0),r([c({readOnly:!0})],at.prototype,"type",void 0),r([c()],at.prototype,"tooltip",void 0),at=r([b("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],at);const Fa="draped-elevation-changes";function bg(i){return i!=null&&i.type==="mesh"?Mg(i):xg(i)}function Mg(i){return qo(i.vertexSpace)?wg(i,i.transform,i.vertexSpace):Sg(i)}function xg(i){let t=i,e=null;return{undo(n){e=n.geometry,n.geometry=t},redo(n){t=n.geometry,n.geometry=e}}}function wg(i,t,e){let n=t==null?void 0:t.clone(),o=Xe(e.origin),s=null,a=null;return{undo:()=>{var l;s=(l=i.transform)==null?void 0:l.clone(),a=Xe(e.origin),i.transform=n,i.vertexSpace.origin=o},redo:()=>{var l;n=(l=i.transform)==null?void 0:l.clone(),o=Xe(e.origin),i.transform=s,i.vertexSpace.origin=a}}}function Sg(i){let t,e=i.vertexAttributes.clonePositional();return{undo:()=>{t=i.vertexAttributes.clonePositional(),i.vertexAttributes=e},redo:()=>{e=i.vertexAttributes.clonePositional(),i.vertexAttributes=t}}}function Og(i){let t=0,e=0,n=0;return i?(i.type==="cim"&&i.data.symbol&&"symbolLayers"in i.data.symbol&&i.data.symbol.symbolLayers&&i.data.symbol.symbolLayers.map(o=>{o.type==="CIMVectorMarker"&&o.anchorPoint&&(Math.abs(o.anchorPoint.x)>t&&(t=o.anchorPoint.x),Math.abs(o.anchorPoint.y)>e&&(e=o.anchorPoint.y),o.size!=null&&o.size>n&&(n=o.size))}),t=Ke(t),e=Ke(e),n=Ke(n),{offsetX:t,offsetY:e,size:n}):{offsetX:t,offsetY:e,size:n}}let st=class extends q{set graphic(i){this._circleCollisionCache=null,this._originalSymbol=i.symbol,this._set("graphic",i),this.attachSymbolChanged()}get elevationInfo(){const{layer:i}=this.graphic,t=i&&"elevationInfo"in i?i.elevationInfo:null,e=Xc(this.graphic),n=t?t.offset:0;return new Yo({mode:e,offset:n})}set focusedSymbol(i){i!==this._get("focusedSymbol")&&(this._set("focusedSymbol",i),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(i){i!==this._get("grabbing")&&(this._set("grabbing",i),this._updateGraphicSymbol())}set hovering(i){i!==this._get("hovering")&&(this._set("hovering",i),this._updateGraphicSymbol())}set selected(i){i!==this._get("selected")&&(this._set("selected",i),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:i?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(i){super(i),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new dt.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(i){const t=this.graphic;if(t.visible===!1)return null;const e=t.geometry;if(e==null)return null;const n=this._get("focusedSymbol"),o=n??t.symbol;return this.view.type==="2d"?this._intersectDistance2D(this.view,i,e,o):this._intersectDistance3D(this.view,i,t)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=x(()=>{var i;return(i=this.graphic)==null?void 0:i.symbol},i=>{i!=null&&i!==this.focusedSymbol&&i!==this._originalSymbol&&(this._originalSymbol=i,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},qt)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(i,t,e,n){var a,l;if((n=n||Wc(e))==null)return null;const o=1;let s=this._circleCollisionCache;if(e.type==="point"&&n.type==="cim"&&((a=n.data.symbol)==null?void 0:a.type)==="CIMPointSymbol"&&n.data.symbol.symbolLayers){const{offsetX:p,offsetY:h,size:u}=Og(n),d=Bs(t,Za),g=u/2,v=i.toScreen(e),f=v.x+p,m=v.y+h;return ho(d,[f,m])<g*g?o:null}if(e.type!=="point"||n.type!=="simple-marker")return wh(t,e,i)?o:null;if(s==null||!s.originalPoint.equals(e)){const p=e,h=i.spatialReference;if(qc(p.spatialReference,h)){const u=Kc(p,h);s={originalPoint:p.clone(),mapPoint:u,radiusPx:Ke(n.size)},this._circleCollisionCache=s}}if(s!=null){const p=Bs(t,Za),h=(l=i.toScreen)==null?void 0:l.call(i,s.mapPoint);if(!h)return null;const u=s.radiusPx,d=h.x+Ke(n.xoffset),g=h.y-Ke(n.yoffset);return ho(p,[d,g])<u*u?o:null}return null}_intersectDistance3D(i,t,e){const n=i.toMap(t,{include:[e]});return n&&hr(n,Na,i.renderSpatialReference)?Qc(Na,i.state.camera.eye):null}};r([c({constructOnly:!0,nonNullable:!0})],st.prototype,"graphic",null),r([c()],st.prototype,"elevationInfo",null),r([c({constructOnly:!0,nonNullable:!0})],st.prototype,"view",void 0),r([c({value:null})],st.prototype,"focusedSymbol",null),r([c({constructOnly:!0})],st.prototype,"layer",void 0),r([c()],st.prototype,"interactive",void 0),r([c()],st.prototype,"selectable",void 0),r([c()],st.prototype,"grabbable",void 0),r([c({value:!1})],st.prototype,"grabbing",null),r([c()],st.prototype,"dragging",void 0),r([c()],st.prototype,"hovering",null),r([c({value:!1})],st.prototype,"selected",null),r([c()],st.prototype,"cursor",void 0),st=r([b("esri.views.interactive.GraphicManipulator")],st);const Na=O(),Za=Re(),po=Symbol();let ye=class extends dt.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return tr(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return qp(this.view,this.graphic)}constructor(i){super(i),this._updatingHandles=new ai}destroy(){this._operations=V(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new Nt({graphic:this.graphic}),this._graphicState.on("changed",()=>this.emit("committed")),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add(()=>this.graphic.geometry,i=>{var e,n;const t=(e=this._operations)==null?void 0:e.data.geometry;if(i!==t){if(!i||(i==null?void 0:i.type)==="multipoint"||(i==null?void 0:i.type)==="extent")return V(this._operations),this.removeHandles(po),void(this._operations=null);if((n=this._operations)!=null&&n.trySetGeometry(i))this.emit("modified-externally");else{V(this._operations),this.removeHandles(po);const o=kn.fromGeometry(i,this.view.state.viewingMode);this._operations=o,this.addHandles(o.data.on("change",()=>this.graphic.geometry=o.data.geometry),po)}}},ut))}createManipulator(i){return new st({view:this.view,graphic:this.graphic,...i})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){const i=this.graphic.geometry;(i==null?void 0:i.type)==="mesh"&&this.graphic.notifyMeshTransformChanged({action:Mo.UpdateFastLocalOrigin})}toMap(i){return this.view.toMap(i,{include:[this.graphic]})}createUndoRecord(){const{graphic:{geometry:i}}=this;return bg(i)}};r([c({constructOnly:!0})],ye.prototype,"view",void 0),r([c({constructOnly:!0})],ye.prototype,"graphic",void 0),r([c()],ye.prototype,"_operations",void 0),r([c()],ye.prototype,"operations",null),r([c()],ye.prototype,"updating",null),ye=r([b("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],ye);export{Le as DrawGraphicTool3D,at as ExtentTransformTool,ye as ManipulatedObject3DGraphic,bt as MoveTool3D,K as ReshapeTool3D,vt as TransformTool3D};
