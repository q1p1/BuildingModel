const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IdentityManager-CZGp12B0.js","assets/substitute-BD55y11a.js","assets/pe-wasm-ihfvgCko.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/ElevationLayer-A75y1o-8.js","assets/ArcGISCachedService-Cgu6zh_X.js","assets/TileInfoTilemapCache-B8t3yNSe.js","assets/TilemapCache-BVkZfn0U.js","assets/LercDecoder-DreMQ7gD.js","assets/WorkerHandle-D8mZ9F5p.js","assets/layersCreator-DeJ1MgNa.js","assets/portalLayers-B5Wt0mct.js","assets/associatedFeatureServiceUtils-HnahoBvA.js","assets/fetchService-6kjOADtV.js","assets/arcgisLayers-DfMfKCRU.js","assets/geometryEngineBase-yFIvKOkM.js","assets/statsWorker-D6hKRK3F.js","assets/utils-C3hEDXHW.js","assets/utils-DQCnl7Nv.js","assets/utils-QGQ7bpdl.js","assets/ClassBreaksDefinition-Bj_0Fa9T.js","assets/geometryEngineWorker-BiqU-FdE.js","assets/geometryEngineJSON-BwrklJA_.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-CUf0BNhY.js","assets/date-DLgTylpo.js","assets/FeatureStore-BdKBIjsk.js","assets/BoundsStore-Dqp_WcS_.js","assets/PooledRBush-B6XEaCnu.js","assets/quickselect-QQC62dOK.js","assets/QueryEngine-DnNzvYHo.js","assets/normalizeUtils-CrChzggu.js","assets/normalizeUtilsCommon-D07sMgqX.js","assets/WhereClause-CR5MzVSq.js","assets/TimeOnly-C4MYK9n6.js","assets/queryUtils-aCnwpY8_.js","assets/QueryEngineCapabilities-DjYb9CEb.js","assets/SnappingCandidate-O5eRSE6e.js","assets/optimizedFeatureQueryEngineAdapter-BKOpAdfc.js","assets/centroid-DdLmOD72.js","assets/number-CLowTciT.js","assets/clientSideDefaults-BT3v41hV.js","assets/capabilities-Y9lFlGVh.js","assets/EdgeProcessingWorker-DAlngX68.js","assets/workerHelper-BsprC1em.js","assets/bufferLayouts-ZAlmXeKt.js","assets/edgeProcessing-CNsgJECP.js","assets/deduplicate-BZK9Vq_L.js","assets/ElevationSamplerWorker-CLvOQ9p5.js","assets/vertexSpaceConversion-DJs6HzN7.js","assets/vec4-BKarzEKv.js","assets/FeatureServiceSnappingSourceWorker-JlW1dDGN.js","assets/symbologySnappingCandidates-BH1TAAt_.js","assets/pbfQueryUtils-DD4lAes6.js","assets/pbf-B7YXq3Lg.js","assets/query-z-swoEHW.js","assets/GeoJSONSourceWorker-DzymMPOe.js","assets/geojson-2i-4VgnO.js","assets/sourceUtils-CjhcBivT.js","assets/MemorySourceWorker-xsaUczO9.js","assets/objectIdUtils-4dd1rf9p.js","assets/PBFDecoderWorker-D4qql28G.js","assets/FeaturePipelineWorker-DCm0Y782.js","assets/definitions-JMX6GcYm.js","assets/CIMSymbolHelper-DVpHZXiO.js","assets/BidiEngine-DNnuvc1i.js","assets/mat2d-CzWdFHtM.js","assets/mat2df32-orApM5a3.js","assets/TurboLine-BP7uPEDQ.js","assets/earcut-Lltz9D9k.js","assets/constants-BeT4uJCJ.js","assets/Rect-BAnET0xx.js","assets/ogcFeatureUtils-C8Z1Qk5z.js","assets/StreamFeatureManager-CKsuhUG4.js","assets/createConnection-BZxaL643.js","assets/PointCloudWorker-C2jYn8ig.js","assets/PointCloudWorkerUtil-mMaho89A.js","assets/PointCloudUniqueValueRenderer-KJ6aJmMO.js","assets/I3SBinaryReader-IxHd7JZX.js","assets/RasterWorker-D6-zBh2l.js","assets/dataUtils-Dsrxv9gb.js","assets/PolynomialTransform-s1y-jtbx.js","assets/rasterProjectionHelper-BHOlktKj.js","assets/SceneLayerSnappingSourceWorker-B-cIn5SV.js","assets/SceneLayerWorker-BG9YJKNE.js","assets/I3SNode-zBfHyDkh.js","assets/I3SUtil-CBci7HRM.js","assets/WFSSourceWorker-DPBtuAHx.js","assets/wfsUtils-BGhYaUM-.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-Bv_3y1xM.js","assets/StyleRepository-BTuBdSYs.js","assets/Lyr3DWorker-DkTXfClf.js","assets/ILyr3DWasmPerSceneView-KC8PJi3s.js","assets/Lyr3DModule-Cp2Wrjmo.js","assets/Feature3DPipelineWorker-DOxphKnl.js","assets/Popup-C0qv6WTK.js","assets/AttachmentInfo-Bz6qiw39.js","assets/utils-wcbXcowK.js","assets/executeQueryJSON--ZjVsgb2.js","assets/shared-Xo_BbvAT.js","assets/ReactiveSet-B0SR4kz_.js","assets/arcadeUtils-eOSMY2XH.js","assets/languageUtils-DVsSK0qk.js","assets/ImmutableArray-BPVd6ESQ.js","assets/hash-CcEbRgUF.js","assets/webStyleSymbolUtils-CCH7KzLJ.js","assets/devEnvironmentUtils-CnNDiFMM.js","assets/TileLayerView3D-ByDE9Nwf.js","assets/LayerView3D-DLd_hfK8.js","assets/TiledLayerView3D-B_jn3wWU.js","assets/fetchTile-C_dM8CdJ.js","assets/LayerView-BXwS5Ow4.js","assets/RefreshableLayerView-DJRqVawS.js","assets/MapServiceLayerViewHelper-CIl8JIkl.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/drapedUtils-BS-GBclR.js","assets/sublayerUtils-CsbtWJKL.js","assets/highlightUtils-ByQ9x7MO.js","assets/popupUtils-BotR4H_w.js","assets/ElevationLayerView3D-DIiKMxlH.js","assets/BaseDynamicLayerView3D-7S68WDyQ.js","assets/DynamicLayerView3D-C3gshH6-.js","assets/projectExtentUtils-DhFp1GcY.js","assets/geometryServiceUtils-CXxwqLu3.js","assets/ImageMaterial.glsl-IR1iGpRd.js","assets/DefaultLayouts-DbuAGaIe.js","assets/TriangleMaterial-DRLHcGLs.js","assets/BuildingSceneLayerView3D-z2oBXdvH.js","assets/BuildingGroupSublayer-uAaX7up9.js","assets/BuildingComponentSublayer-BP-cUw90.js","assets/I3SIndexInfo-CVBlAwES.js","assets/I3SLayerDefinitions-j8qfiBO_.js","assets/I3SMeshView3D-D2gy24ui.js","assets/Transform-DaXxRy_c.js","assets/RenderTexture-CHxT3_zw.js","assets/I3SOverrides-BxXOndmH.js","assets/resourceUtils-DBiNid2J.js","assets/meshFeatureSet-CbYYX55N.js","assets/Mesh-CXOhoPwZ.js","assets/MeshComponent-DIcLRyB5.js","assets/meshProperties-C4iW0Ukm.js","assets/MeshTransform-B0qgihS4.js","assets/MeshVertexAttributes-CQAXXSmn.js","assets/triangulationUtils-dyq2MVrW.js","assets/External-DVIQkh_m.js","assets/infoFor3D-CxdEiWhp.js","assets/meshFeatureAttributes-gT4QE9Gx.js","assets/SceneModification-RX4uGJIj.js","assets/persistable-fPqSE1SD.js","assets/resourceExtension-CFSs6muc.js","assets/ExtentSet-D1lsbjGf.js","assets/attributeUtils-Dc8--CBJ.js","assets/makeScheduleFunction-CggzEh3c.js","assets/I3SQueryFeatureStore-DUJtlw8o.js","assets/TemporalSceneLayerView-EfFWelgx.js","assets/timeSupport-DBccflb0.js","assets/utils-CYvrblzZ.js","assets/CatalogLayerView3D-C019XNs-.js","assets/CatalogDynamicGroupLayerView3D-uYnODT6o.js","assets/CatalogFootprintLayerView3D-ChZrcSVZ.js","assets/FeatureLayerViewBase3D-wZaMWolA.js","assets/HeatmapDensity.glsl-IvL3DilB.js","assets/dehydratedFeatureComparison-DrQZqocl.js","assets/queryForSymbologySnapping-CstoJGhK.js","assets/Graphics3DFeatureProcessor-aZJdGwFO.js","assets/renderingInfoUtils-BoSEaC60.js","assets/Graphics3DObjectStates-DKJYKi5U.js","assets/EventedSet-DLVzynON.js","assets/CSVLayerView3D-CXQUejUg.js","assets/DimensionLayerView3D-D3KpGcI3.js","assets/FeatureLayerView3D-C0DGkb6P.js","assets/FocusAreaLayerView3D-DNh7noTI.js","assets/Graphics3DExtrudeSymbolLayer-Vn9eruwa.js","assets/GeoJSONLayerView3D-DJ1cST_H.js","assets/GraphicsLayerView3D-H_GgPc5m.js","assets/GraphicsProcessor-Ddq22LQz.js","assets/GroupLayerView-j1VX5KjM.js","assets/ImageryLayerView3D-l7Yu5xBC.js","assets/IntegratedMeshLayerView3D-rSfR1Xuq.js","assets/IntegratedMesh3DTilesLayerView3D-Cta-hCiF.js","assets/LineOfSightLayerView3D-Bdc1zho0.js","assets/MapImageLayerView3D-MOh8vl5P.js","assets/ExportImageParameters-6sYF3vNq.js","assets/MediaLayerView3D-CpcAZ15Z.js","assets/MediaElementView-BmaKc1Cc.js","assets/normalizeUtilsSync-DU0q81hH.js","assets/keybindings-BfnoYxzG.js","assets/SnappingManagerPool-B5AAZauf.js","assets/viewUtils-CcPgoAOe.js","assets/geometry2dUtils-EVtqnYwM.js","assets/OGCFeatureLayerView3D-C4foLqcJ.js","assets/PointCloudLayerView3D-BMj4klCC.js","assets/PopupSceneLayerView-BCUPkXsG.js","assets/ViewshedLayerView3D-kCQJK5bd.js","assets/VoxelLayerView3D-C-fwc2JO.js","assets/VoxelGraphic-BpG0B_Al.js","assets/RouteLayerView3D-D573MJnI.js","assets/Stop-DT2Toi28.js","assets/SceneLayerView3D-C8HkDPJ8.js","assets/SceneLayerView-kQBm-zdw.js","assets/SceneLayerGraphicsView3D-RZu0xcve.js","assets/StreamLayerView3D-Dg10qYB2.js","assets/ImageryTileLayerView3D-Bmu2e-2N.js","assets/VectorTileLayerView3D-C1RacXeL.js","assets/WFSLayerView3D-elY_5kOc.js","assets/WMSLayerView3D-DbyfgVo9.js","assets/ExportWMSImageParameters-C6gwN_I6.js","assets/WMTSLayerView3D-uLtitmMB.js","assets/AreaMeasurementAnalysisView3D-LYL3nTBi.js","assets/interfaces-C1EVplpJ.js","assets/TextOverlayItem-CCIULHUM.js","assets/AnalysisView3D-Cb2Ux6ER.js","assets/euclideanAreaMeasurementUtils-prUChI75.js","assets/geometryEngine-CiQy_th0.js","assets/hydrated-DyMAxGe_.js","assets/geodesicLengthMeasurementUtils-v5qyVx-m.js","assets/LineVisualElement-CAVxxs2e.js","assets/line-BoUQGD2S.js","assets/EditGeometryOperations-BfDUfWrC.js","assets/Segment-CEfYsrgS.js","assets/lineStippleUtils-C89mzWlO.js","assets/DimensionAnalysisView3D-B8-oTfGU.js","assets/LengthDimension-BK7xSlFF.js","assets/SnappingOperation-D0v6TMYE.js","assets/ExtendedLineVisualElement-DFQu8s9g.js","assets/EngineVisualElement-JGCqx50S.js","assets/LaserlinePath.glsl-B5jEcELF.js","assets/RightAngleQuadVisualElement-D3iPRUVI.js","assets/ColorMaterial.glsl-BB0sfsUN.js","assets/PointSnappingHint-BR_cvNhx.js","assets/ShadedColorMaterial.glsl-BFV_PNND.js","assets/dragEventPipeline3D-D5oaBsmP.js","assets/memoize-DsJmrG76.js","assets/Factory-wICuDViu.js","assets/analysisViewUtils-CS24MQot.js","assets/ToolIntersector-V9ho1tTm.js","assets/LineMarker.glsl-hynYkBww.js","assets/DirectLineMeasurementAnalysisView3D-piMUzX-0.js","assets/LineOfSightAnalysisView3D-C2PWmpBg.js","assets/featureReferenceUtils-CPQ5jOh9.js","assets/LineOfSightAnalysisTarget-B9sO0R66.js","assets/manipulatorUtils-BOsabsOO.js","assets/SliceAnalysisView3D-BSUo5L2q.js","assets/SlicePlaneMaterial.glsl-s78vBGRi.js","assets/sliceToolConfig-DdM8qW72.js","assets/ViewshedAnalysisView3D-RZKTX820.js","assets/Viewshed-DR5JrRrH.js","assets/MoveManipulation-DJCjtkQe.js","assets/VoxelWasmPerSceneView-s4fw6RxJ.js","assets/Graphics3DSymbolLayerFactory-9oBgVetI.js","assets/interfaces-BiuGsKfl.js","assets/projectMeshVertexPositions-B8TXVuAp.js","assets/objectResourceUtils-B0yGxnpo.js","assets/DefaultMaterial_COLOR_GAMMA-F756lLa8.js","assets/loader-9esXmYfu.js","assets/TerrainTileTree3DDebugger-BHlGMl3I.js","assets/TileTreeDebugger-BBg65Kh0.js","assets/EdgeView-CwC2TzLD.js","assets/EdgeWorkerHandle-3q7G2LWX.js","assets/apng-MOUh02eg.js","assets/Lyr3DWasmPerSceneView-SFMQybRk.js","assets/calcite-button-RIv1aLq6.js","assets/form-DeZZU5Xa.js","assets/dom-BZzhahQO.js","assets/interactive-DnnEKUBP.js","assets/label-CnlL2w0f.js","assets/component-6CIDVndn.js","assets/loadable-CPaeFaBQ.js","assets/locale-10k49b9y.js","assets/key-D63ExP77.js","assets/observers-Au_XUc3S.js","assets/t9n-BuIVoMTy.js","assets/icon-C3aaj3bt.js","assets/loader-CRIuQD78.js","assets/guid-BxSjQh8J.js","assets/calcite-icon-Baad3yhW.js","assets/FeatureTileTree3DDebugger-BnOtFewT.js","assets/GraphicsView3D-kleLrX2W.js","assets/editingSupport-BjgC9h82.js","assets/layersLoader-CToFwvA1.js","assets/featureLayerUtils-bkRiyVSd.js","assets/utils-tA7WTrwT.js","assets/FeatureLayerSource-UQ-co5lh.js","assets/QueryTask-DeJHhhGn.js","assets/executeForIds-CU3QU38y.js","assets/BinsQuery-9UL6YvvQ.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var u6={exports:{}},ZM={},h6={exports:{}},cr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xse;function yNe(){if(xse)return cr;xse=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;function g(G){return G===null||typeof G!="object"?null:(G=p&&G[p]||G["@@iterator"],typeof G=="function"?G:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,b={};function x(G,K,Se){this.props=G,this.context=K,this.refs=b,this.updater=Se||y}x.prototype.isReactComponent={},x.prototype.setState=function(G,K){if(typeof G!="object"&&typeof G!="function"&&G!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,G,K,"setState")},x.prototype.forceUpdate=function(G){this.updater.enqueueForceUpdate(this,G,"forceUpdate")};function T(){}T.prototype=x.prototype;function M(G,K,Se){this.props=G,this.context=K,this.refs=b,this.updater=Se||y}var $=M.prototype=new T;$.constructor=M,w($,x.prototype),$.isPureReactComponent=!0;var R=Array.isArray,I=Object.prototype.hasOwnProperty,P={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function V(G,K,Se){var Ee,Ce={},Le=null,Ke=null;if(K!=null)for(Ee in K.ref!==void 0&&(Ke=K.ref),K.key!==void 0&&(Le=""+K.key),K)I.call(K,Ee)&&!N.hasOwnProperty(Ee)&&(Ce[Ee]=K[Ee]);var Re=arguments.length-2;if(Re===1)Ce.children=Se;else if(1<Re){for(var ze=Array(Re),vt=0;vt<Re;vt++)ze[vt]=arguments[vt+2];Ce.children=ze}if(G&&G.defaultProps)for(Ee in Re=G.defaultProps,Re)Ce[Ee]===void 0&&(Ce[Ee]=Re[Ee]);return{$$typeof:t,type:G,key:Le,ref:Ke,props:Ce,_owner:P.current}}function U(G,K){return{$$typeof:t,type:G.type,key:K,ref:G.ref,props:G.props,_owner:G._owner}}function B(G){return typeof G=="object"&&G!==null&&G.$$typeof===t}function W(G){var K={"=":"=0",":":"=2"};return"$"+G.replace(/[=:]/g,function(Se){return K[Se]})}var j=/\/+/g;function Q(G,K){return typeof G=="object"&&G!==null&&G.key!=null?W(""+G.key):K.toString(36)}function Z(G,K,Se,Ee,Ce){var Le=typeof G;(Le==="undefined"||Le==="boolean")&&(G=null);var Ke=!1;if(G===null)Ke=!0;else switch(Le){case"string":case"number":Ke=!0;break;case"object":switch(G.$$typeof){case t:case e:Ke=!0}}if(Ke)return Ke=G,Ce=Ce(Ke),G=Ee===""?"."+Q(Ke,0):Ee,R(Ce)?(Se="",G!=null&&(Se=G.replace(j,"$&/")+"/"),Z(Ce,K,Se,"",function(vt){return vt})):Ce!=null&&(B(Ce)&&(Ce=U(Ce,Se+(!Ce.key||Ke&&Ke.key===Ce.key?"":(""+Ce.key).replace(j,"$&/")+"/")+G)),K.push(Ce)),1;if(Ke=0,Ee=Ee===""?".":Ee+":",R(G))for(var Re=0;Re<G.length;Re++){Le=G[Re];var ze=Ee+Q(Le,Re);Ke+=Z(Le,K,Se,ze,Ce)}else if(ze=g(G),typeof ze=="function")for(G=ze.call(G),Re=0;!(Le=G.next()).done;)Le=Le.value,ze=Ee+Q(Le,Re++),Ke+=Z(Le,K,Se,ze,Ce);else if(Le==="object")throw K=String(G),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(G).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.");return Ke}function X(G,K,Se){if(G==null)return G;var Ee=[],Ce=0;return Z(G,Ee,"","",function(Le){return K.call(Se,Le,Ce++)}),Ee}function ge(G){if(G._status===-1){var K=G._result;K=K(),K.then(function(Se){(G._status===0||G._status===-1)&&(G._status=1,G._result=Se)},function(Se){(G._status===0||G._status===-1)&&(G._status=2,G._result=Se)}),G._status===-1&&(G._status=0,G._result=K)}if(G._status===1)return G._result.default;throw G._result}var ae={current:null},z={transition:null},he={ReactCurrentDispatcher:ae,ReactCurrentBatchConfig:z,ReactCurrentOwner:P};function ce(){throw Error("act(...) is not supported in production builds of React.")}return cr.Children={map:X,forEach:function(G,K,Se){X(G,function(){K.apply(this,arguments)},Se)},count:function(G){var K=0;return X(G,function(){K++}),K},toArray:function(G){return X(G,function(K){return K})||[]},only:function(G){if(!B(G))throw Error("React.Children.only expected to receive a single React element child.");return G}},cr.Component=x,cr.Fragment=i,cr.Profiler=n,cr.PureComponent=M,cr.StrictMode=r,cr.Suspense=l,cr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=he,cr.act=ce,cr.cloneElement=function(G,K,Se){if(G==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+G+".");var Ee=w({},G.props),Ce=G.key,Le=G.ref,Ke=G._owner;if(K!=null){if(K.ref!==void 0&&(Le=K.ref,Ke=P.current),K.key!==void 0&&(Ce=""+K.key),G.type&&G.type.defaultProps)var Re=G.type.defaultProps;for(ze in K)I.call(K,ze)&&!N.hasOwnProperty(ze)&&(Ee[ze]=K[ze]===void 0&&Re!==void 0?Re[ze]:K[ze])}var ze=arguments.length-2;if(ze===1)Ee.children=Se;else if(1<ze){Re=Array(ze);for(var vt=0;vt<ze;vt++)Re[vt]=arguments[vt+2];Ee.children=Re}return{$$typeof:t,type:G.type,key:Ce,ref:Le,props:Ee,_owner:Ke}},cr.createContext=function(G){return G={$$typeof:o,_currentValue:G,_currentValue2:G,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},G.Provider={$$typeof:s,_context:G},G.Consumer=G},cr.createElement=V,cr.createFactory=function(G){var K=V.bind(null,G);return K.type=G,K},cr.createRef=function(){return{current:null}},cr.forwardRef=function(G){return{$$typeof:a,render:G}},cr.isValidElement=B,cr.lazy=function(G){return{$$typeof:h,_payload:{_status:-1,_result:G},_init:ge}},cr.memo=function(G,K){return{$$typeof:c,type:G,compare:K===void 0?null:K}},cr.startTransition=function(G){var K=z.transition;z.transition={};try{G()}finally{z.transition=K}},cr.unstable_act=ce,cr.useCallback=function(G,K){return ae.current.useCallback(G,K)},cr.useContext=function(G){return ae.current.useContext(G)},cr.useDebugValue=function(){},cr.useDeferredValue=function(G){return ae.current.useDeferredValue(G)},cr.useEffect=function(G,K){return ae.current.useEffect(G,K)},cr.useId=function(){return ae.current.useId()},cr.useImperativeHandle=function(G,K,Se){return ae.current.useImperativeHandle(G,K,Se)},cr.useInsertionEffect=function(G,K){return ae.current.useInsertionEffect(G,K)},cr.useLayoutEffect=function(G,K){return ae.current.useLayoutEffect(G,K)},cr.useMemo=function(G,K){return ae.current.useMemo(G,K)},cr.useReducer=function(G,K,Se){return ae.current.useReducer(G,K,Se)},cr.useRef=function(G){return ae.current.useRef(G)},cr.useState=function(G){return ae.current.useState(G)},cr.useSyncExternalStore=function(G,K,Se){return ae.current.useSyncExternalStore(G,K,Se)},cr.useTransition=function(){return ae.current.useTransition()},cr.version="18.3.1",cr}var Sse;function oJ(){return Sse||(Sse=1,h6.exports=yNe()),h6.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tse;function _Ne(){if(Tse)return ZM;Tse=1;var t=oJ(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,c){var h,p={},g=null,y=null;c!==void 0&&(g=""+c),l.key!==void 0&&(g=""+l.key),l.ref!==void 0&&(y=l.ref);for(h in l)r.call(l,h)&&!s.hasOwnProperty(h)&&(p[h]=l[h]);if(a&&a.defaultProps)for(h in l=a.defaultProps,l)p[h]===void 0&&(p[h]=l[h]);return{$$typeof:e,type:a,key:g,ref:y,props:p,_owner:n.current}}return ZM.Fragment=i,ZM.jsx=o,ZM.jsxs=o,ZM}var Ese;function vNe(){return Ese||(Ese=1,u6.exports=_Ne()),u6.exports}var hn=vNe(),Z0=oJ(),AP={},d6={exports:{}},cc={},p6={exports:{}},f6={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cse;function wNe(){return Cse||(Cse=1,function(t){function e(z,he){var ce=z.length;z.push(he);e:for(;0<ce;){var G=ce-1>>>1,K=z[G];if(0<n(K,he))z[G]=he,z[ce]=K,ce=G;else break e}}function i(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var he=z[0],ce=z.pop();if(ce!==he){z[0]=ce;e:for(var G=0,K=z.length,Se=K>>>1;G<Se;){var Ee=2*(G+1)-1,Ce=z[Ee],Le=Ee+1,Ke=z[Le];if(0>n(Ce,ce))Le<K&&0>n(Ke,Ce)?(z[G]=Ke,z[Le]=ce,G=Le):(z[G]=Ce,z[Ee]=ce,G=Ee);else if(Le<K&&0>n(Ke,ce))z[G]=Ke,z[Le]=ce,G=Le;else break e}}return he}function n(z,he){var ce=z.sortIndex-he.sortIndex;return ce!==0?ce:z.id-he.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],h=1,p=null,g=3,y=!1,w=!1,b=!1,x=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $(z){for(var he=i(c);he!==null;){if(he.callback===null)r(c);else if(he.startTime<=z)r(c),he.sortIndex=he.expirationTime,e(l,he);else break;he=i(c)}}function R(z){if(b=!1,$(z),!w)if(i(l)!==null)w=!0,ge(I);else{var he=i(c);he!==null&&ae(R,he.startTime-z)}}function I(z,he){w=!1,b&&(b=!1,T(V),V=-1),y=!0;var ce=g;try{for($(he),p=i(l);p!==null&&(!(p.expirationTime>he)||z&&!W());){var G=p.callback;if(typeof G=="function"){p.callback=null,g=p.priorityLevel;var K=G(p.expirationTime<=he);he=t.unstable_now(),typeof K=="function"?p.callback=K:p===i(l)&&r(l),$(he)}else r(l);p=i(l)}if(p!==null)var Se=!0;else{var Ee=i(c);Ee!==null&&ae(R,Ee.startTime-he),Se=!1}return Se}finally{p=null,g=ce,y=!1}}var P=!1,N=null,V=-1,U=5,B=-1;function W(){return!(t.unstable_now()-B<U)}function j(){if(N!==null){var z=t.unstable_now();B=z;var he=!0;try{he=N(!0,z)}finally{he?Q():(P=!1,N=null)}}else P=!1}var Q;if(typeof M=="function")Q=function(){M(j)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,X=Z.port2;Z.port1.onmessage=j,Q=function(){X.postMessage(null)}}else Q=function(){x(j,0)};function ge(z){N=z,P||(P=!0,Q())}function ae(z,he){V=x(function(){z(t.unstable_now())},he)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_continueExecution=function(){w||y||(w=!0,ge(I))},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(z){switch(g){case 1:case 2:case 3:var he=3;break;default:he=g}var ce=g;g=he;try{return z()}finally{g=ce}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(z,he){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var ce=g;g=z;try{return he()}finally{g=ce}},t.unstable_scheduleCallback=function(z,he,ce){var G=t.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?G+ce:G):ce=G,z){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=ce+K,z={id:h++,callback:he,priorityLevel:z,startTime:ce,expirationTime:K,sortIndex:-1},ce>G?(z.sortIndex=ce,e(c,z),i(l)===null&&z===i(c)&&(b?(T(V),V=-1):b=!0,ae(R,ce-G))):(z.sortIndex=K,e(l,z),w||y||(w=!0,ge(I))),z},t.unstable_shouldYield=W,t.unstable_wrapCallback=function(z){var he=g;return function(){var ce=g;g=he;try{return z.apply(this,arguments)}finally{g=ce}}}}(f6)),f6}var Mse;function bNe(){return Mse||(Mse=1,p6.exports=wNe()),p6.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $se;function xNe(){if($se)return cc;$se=1;var t=oJ(),e=bNe();function i(d){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+d,v=1;v<arguments.length;v++)m+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+d+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,n={};function s(d,m){o(d,m),o(d+"Capture",m)}function o(d,m){for(n[d]=m,d=0;d<m.length;d++)r.add(m[d])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function g(d){return l.call(p,d)?!0:l.call(h,d)?!1:c.test(d)?p[d]=!0:(h[d]=!0,!1)}function y(d,m,v,S){if(v!==null&&v.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return S?!1:v!==null?!v.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function w(d,m,v,S){if(m===null||typeof m>"u"||y(d,m,v,S))return!0;if(S)return!1;if(v!==null)switch(v.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function b(d,m,v,S,E,O,F){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=S,this.attributeNamespace=E,this.mustUseProperty=v,this.propertyName=d,this.type=m,this.sanitizeURL=O,this.removeEmptyString=F}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){x[d]=new b(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var m=d[0];x[m]=new b(m,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){x[d]=new b(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){x[d]=new b(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){x[d]=new b(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){x[d]=new b(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){x[d]=new b(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){x[d]=new b(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){x[d]=new b(d,5,!1,d.toLowerCase(),null,!1,!1)});var T=/[\-:]([a-z])/g;function M(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var m=d.replace(T,M);x[m]=new b(m,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var m=d.replace(T,M);x[m]=new b(m,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var m=d.replace(T,M);x[m]=new b(m,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){x[d]=new b(d,1,!1,d.toLowerCase(),null,!1,!1)}),x.xlinkHref=new b("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){x[d]=new b(d,1,!1,d.toLowerCase(),null,!0,!0)});function $(d,m,v,S){var E=x.hasOwnProperty(m)?x[m]:null;(E!==null?E.type!==0:S||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(w(m,v,E,S)&&(v=null),S||E===null?g(m)&&(v===null?d.removeAttribute(m):d.setAttribute(m,""+v)):E.mustUseProperty?d[E.propertyName]=v===null?E.type===3?!1:"":v:(m=E.attributeName,S=E.attributeNamespace,v===null?d.removeAttribute(m):(E=E.type,v=E===3||E===4&&v===!0?"":""+v,S?d.setAttributeNS(S,m,v):d.setAttribute(m,v))))}var R=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,I=Symbol.for("react.element"),P=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),V=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),W=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),Z=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),ge=Symbol.for("react.lazy"),ae=Symbol.for("react.offscreen"),z=Symbol.iterator;function he(d){return d===null||typeof d!="object"?null:(d=z&&d[z]||d["@@iterator"],typeof d=="function"?d:null)}var ce=Object.assign,G;function K(d){if(G===void 0)try{throw Error()}catch(v){var m=v.stack.trim().match(/\n( *(at )?)/);G=m&&m[1]||""}return`
`+G+d}var Se=!1;function Ee(d,m){if(!d||Se)return"";Se=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(be){var S=be}Reflect.construct(d,[],m)}else{try{m.call()}catch(be){S=be}d.call(m.prototype)}else{try{throw Error()}catch(be){S=be}d()}}catch(be){if(be&&S&&typeof be.stack=="string"){for(var E=be.stack.split(`
`),O=S.stack.split(`
`),F=E.length-1,q=O.length-1;1<=F&&0<=q&&E[F]!==O[q];)q--;for(;1<=F&&0<=q;F--,q--)if(E[F]!==O[q]){if(F!==1||q!==1)do if(F--,q--,0>q||E[F]!==O[q]){var ee=`
`+E[F].replace(" at new "," at ");return d.displayName&&ee.includes("<anonymous>")&&(ee=ee.replace("<anonymous>",d.displayName)),ee}while(1<=F&&0<=q);break}}}finally{Se=!1,Error.prepareStackTrace=v}return(d=d?d.displayName||d.name:"")?K(d):""}function Ce(d){switch(d.tag){case 5:return K(d.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 2:case 15:return d=Ee(d.type,!1),d;case 11:return d=Ee(d.type.render,!1),d;case 1:return d=Ee(d.type,!0),d;default:return""}}function Le(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case N:return"Fragment";case P:return"Portal";case U:return"Profiler";case V:return"StrictMode";case Q:return"Suspense";case Z:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case W:return(d.displayName||"Context")+".Consumer";case B:return(d._context.displayName||"Context")+".Provider";case j:var m=d.render;return d=d.displayName,d||(d=m.displayName||m.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case X:return m=d.displayName||null,m!==null?m:Le(d.type)||"Memo";case ge:m=d._payload,d=d._init;try{return Le(d(m))}catch{}}return null}function Ke(d){var m=d.type;switch(d.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=m.render,d=d.displayName||d.name||"",m.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Le(m);case 8:return m===V?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function Re(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function ze(d){var m=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function vt(d){var m=ze(d)?"checked":"value",v=Object.getOwnPropertyDescriptor(d.constructor.prototype,m),S=""+d[m];if(!d.hasOwnProperty(m)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var E=v.get,O=v.set;return Object.defineProperty(d,m,{configurable:!0,get:function(){return E.call(this)},set:function(F){S=""+F,O.call(this,F)}}),Object.defineProperty(d,m,{enumerable:v.enumerable}),{getValue:function(){return S},setValue:function(F){S=""+F},stopTracking:function(){d._valueTracker=null,delete d[m]}}}}function Xt(d){d._valueTracker||(d._valueTracker=vt(d))}function li(d){if(!d)return!1;var m=d._valueTracker;if(!m)return!0;var v=m.getValue(),S="";return d&&(S=ze(d)?d.checked?"true":"false":d.value),d=S,d!==v?(m.setValue(d),!0):!1}function ti(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function zi(d,m){var v=m.checked;return ce({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??d._wrapperState.initialChecked})}function He(d,m){var v=m.defaultValue==null?"":m.defaultValue,S=m.checked!=null?m.checked:m.defaultChecked;v=Re(m.value!=null?m.value:v),d._wrapperState={initialChecked:S,initialValue:v,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Oi(d,m){m=m.checked,m!=null&&$(d,"checked",m,!1)}function Be(d,m){Oi(d,m);var v=Re(m.value),S=m.type;if(v!=null)S==="number"?(v===0&&d.value===""||d.value!=v)&&(d.value=""+v):d.value!==""+v&&(d.value=""+v);else if(S==="submit"||S==="reset"){d.removeAttribute("value");return}m.hasOwnProperty("value")?dt(d,m.type,v):m.hasOwnProperty("defaultValue")&&dt(d,m.type,Re(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(d.defaultChecked=!!m.defaultChecked)}function tt(d,m,v){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var S=m.type;if(!(S!=="submit"&&S!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+d._wrapperState.initialValue,v||m===d.value||(d.value=m),d.defaultValue=m}v=d.name,v!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,v!==""&&(d.name=v)}function dt(d,m,v){(m!=="number"||ti(d.ownerDocument)!==d)&&(v==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+v&&(d.defaultValue=""+v))}var Rt=Array.isArray;function Je(d,m,v,S){if(d=d.options,m){m={};for(var E=0;E<v.length;E++)m["$"+v[E]]=!0;for(v=0;v<d.length;v++)E=m.hasOwnProperty("$"+d[v].value),d[v].selected!==E&&(d[v].selected=E),E&&S&&(d[v].defaultSelected=!0)}else{for(v=""+Re(v),m=null,E=0;E<d.length;E++){if(d[E].value===v){d[E].selected=!0,S&&(d[E].defaultSelected=!0);return}m!==null||d[E].disabled||(m=d[E])}m!==null&&(m.selected=!0)}}function Et(d,m){if(m.dangerouslySetInnerHTML!=null)throw Error(i(91));return ce({},m,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function De(d,m){var v=m.value;if(v==null){if(v=m.children,m=m.defaultValue,v!=null){if(m!=null)throw Error(i(92));if(Rt(v)){if(1<v.length)throw Error(i(93));v=v[0]}m=v}m==null&&(m=""),v=m}d._wrapperState={initialValue:Re(v)}}function at(d,m){var v=Re(m.value),S=Re(m.defaultValue);v!=null&&(v=""+v,v!==d.value&&(d.value=v),m.defaultValue==null&&d.defaultValue!==v&&(d.defaultValue=v)),S!=null&&(d.defaultValue=""+S)}function It(d){var m=d.textContent;m===d._wrapperState.initialValue&&m!==""&&m!==null&&(d.value=m)}function Ki(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yi(d,m){return d==null||d==="http://www.w3.org/1999/xhtml"?Ki(m):d==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var er,Li=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,v,S,E){MSApp.execUnsafeLocalFunction(function(){return d(m,v,S,E)})}:d}(function(d,m){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=m;else{for(er=er||document.createElement("div"),er.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=er.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;m.firstChild;)d.appendChild(m.firstChild)}});function Ai(d,m){if(m){var v=d.firstChild;if(v&&v===d.lastChild&&v.nodeType===3){v.nodeValue=m;return}}d.textContent=m}var ci={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vi=["Webkit","ms","Moz","O"];Object.keys(ci).forEach(function(d){Vi.forEach(function(m){m=m+d.charAt(0).toUpperCase()+d.substring(1),ci[m]=ci[d]})});function Ei(d,m,v){return m==null||typeof m=="boolean"||m===""?"":v||typeof m!="number"||m===0||ci.hasOwnProperty(d)&&ci[d]?(""+m).trim():m+"px"}function tr(d,m){d=d.style;for(var v in m)if(m.hasOwnProperty(v)){var S=v.indexOf("--")===0,E=Ei(v,m[v],S);v==="float"&&(v="cssFloat"),S?d.setProperty(v,E):d[v]=E}}var Lt=ce({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ui(d,m){if(m){if(Lt[d]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(i(137,d));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(i(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(i(61))}if(m.style!=null&&typeof m.style!="object")throw Error(i(62))}}function _i(d,m){if(d.indexOf("-")===-1)return typeof m.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rr=null;function bn(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var di=null,lr=null,Fr=null;function Ts(d){if(d=PM(d)){if(typeof di!="function")throw Error(i(280));var m=d.stateNode;m&&(m=HI(m),di(d.stateNode,d.type,m))}}function wo(d){lr?Fr?Fr.push(d):Fr=[d]:lr=d}function bo(){if(lr){var d=lr,m=Fr;if(Fr=lr=null,Ts(d),m)for(d=0;d<m.length;d++)Ts(m[d])}}function Es(d,m){return d(m)}function Ln(){}var cn=!1;function se(d,m,v){if(cn)return d(m,v);cn=!0;try{return Es(d,m,v)}finally{cn=!1,(lr!==null||Fr!==null)&&(Ln(),bo())}}function jt(d,m){var v=d.stateNode;if(v===null)return null;var S=HI(v);if(S===null)return null;v=S[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(d=d.type,S=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!S;break e;default:d=!1}if(d)return null;if(v&&typeof v!="function")throw Error(i(231,m,typeof v));return v}var Kr=!1;if(a)try{var yr={};Object.defineProperty(yr,"passive",{get:function(){Kr=!0}}),window.addEventListener("test",yr,yr),window.removeEventListener("test",yr,yr)}catch{Kr=!1}function mn(d,m,v,S,E,O,F,q,ee){var be=Array.prototype.slice.call(arguments,3);try{m.apply(v,be)}catch(Ve){this.onError(Ve)}}var st=!1,Xa=null,kr=!1,Sa=null,Yc={onError:function(d){st=!0,Xa=d}};function js(d,m,v,S,E,O,F,q,ee){st=!1,Xa=null,mn.apply(Yc,arguments)}function Ux(d,m,v,S,E,O,F,q,ee){if(js.apply(this,arguments),st){if(st){var be=Xa;st=!1,Xa=null}else throw Error(i(198));kr||(kr=!0,Sa=be)}}function Xu(d){var m=d,v=d;if(d.alternate)for(;m.return;)m=m.return;else{d=m;do m=d,m.flags&4098&&(v=m.return),d=m.return;while(d)}return m.tag===3?v:null}function Kt(d){if(d.tag===13){var m=d.memoizedState;if(m===null&&(d=d.alternate,d!==null&&(m=d.memoizedState)),m!==null)return m.dehydrated}return null}function af(d){if(Xu(d)!==d)throw Error(i(188))}function Cd(d){var m=d.alternate;if(!m){if(m=Xu(d),m===null)throw Error(i(188));return m!==d?null:d}for(var v=d,S=m;;){var E=v.return;if(E===null)break;var O=E.alternate;if(O===null){if(S=E.return,S!==null){v=S;continue}break}if(E.child===O.child){for(O=E.child;O;){if(O===v)return af(E),d;if(O===S)return af(E),m;O=O.sibling}throw Error(i(188))}if(v.return!==S.return)v=E,S=O;else{for(var F=!1,q=E.child;q;){if(q===v){F=!0,v=E,S=O;break}if(q===S){F=!0,S=E,v=O;break}q=q.sibling}if(!F){for(q=O.child;q;){if(q===v){F=!0,v=O,S=E;break}if(q===S){F=!0,S=O,v=E;break}q=q.sibling}if(!F)throw Error(i(189))}}if(v.alternate!==S)throw Error(i(190))}if(v.tag!==3)throw Error(i(188));return v.stateNode.current===v?d:m}function Um(d){return d=Cd(d),d!==null?n1(d):null}function n1(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var m=n1(d);if(m!==null)return m;d=d.sibling}return null}var Xc=e.unstable_scheduleCallback,Md=e.unstable_cancelCallback,Ju=e.unstable_shouldYield,Er=e.unstable_requestPaint,Rr=e.unstable_now,Jc=e.unstable_getCurrentPriorityLevel,Cs=e.unstable_ImmediatePriority,Qc=e.unstable_UserBlockingPriority,Kc=e.unstable_NormalPriority,Xy=e.unstable_LowPriority,lf=e.unstable_IdlePriority,Ms=null,Wo=null;function cf(d){if(Wo&&typeof Wo.onCommitFiberRoot=="function")try{Wo.onCommitFiberRoot(Ms,d,void 0,(d.current.flags&128)===128)}catch{}}var H=Math.clz32?Math.clz32:Jt,$e=Math.log,je=Math.LN2;function Jt(d){return d>>>=0,d===0?32:31-($e(d)/je|0)|0}var _r=64,Cr=4194304;function en(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function $s(d,m){var v=d.pendingLanes;if(v===0)return 0;var S=0,E=d.suspendedLanes,O=d.pingedLanes,F=v&268435455;if(F!==0){var q=F&~E;q!==0?S=en(q):(O&=F,O!==0&&(S=en(O)))}else F=v&~E,F!==0?S=en(F):O!==0&&(S=en(O));if(S===0)return 0;if(m!==0&&m!==S&&!(m&E)&&(E=S&-S,O=m&-m,E>=O||E===16&&(O&4194240)!==0))return m;if(S&4&&(S|=v&16),m=d.entangledLanes,m!==0)for(d=d.entanglements,m&=S;0<m;)v=31-H(m),E=1<<v,S|=d[v],m&=~E;return S}function $I(d,m){switch(d){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OI(d,m){for(var v=d.suspendedLanes,S=d.pingedLanes,E=d.expirationTimes,O=d.pendingLanes;0<O;){var F=31-H(O),q=1<<F,ee=E[F];ee===-1?(!(q&v)||q&S)&&(E[F]=$I(q,m)):ee<=m&&(d.expiredLanes|=q),O&=~q}}function s1(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function mM(){var d=_r;return _r<<=1,!(_r&4194240)&&(_r=64),d}function zx(d){for(var m=[],v=0;31>v;v++)m.push(d);return m}function Jy(d,m,v){d.pendingLanes|=m,m!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,m=31-H(m),d[m]=v}function gM(d,m){var v=d.pendingLanes&~m;d.pendingLanes=m,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=m,d.mutableReadLanes&=m,d.entangledLanes&=m,m=d.entanglements;var S=d.eventTimes;for(d=d.expirationTimes;0<v;){var E=31-H(v),O=1<<E;m[E]=0,S[E]=-1,d[E]=-1,v&=~O}}function PV(d,m){var v=d.entangledLanes|=m;for(d=d.entanglements;v;){var S=31-H(v),E=1<<S;E&m|d[S]&m&&(d[S]|=m),v&=~E}}var gn=0;function ere(d){return d&=-d,1<d?4<d?d&268435455?16:536870912:4:1}var tre,LV,ire,rre,nre,DV=!1,AI=[],Qy=null,Ky=null,e0=null,yM=new Map,_M=new Map,t0=[],ULe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sre(d,m){switch(d){case"focusin":case"focusout":Qy=null;break;case"dragenter":case"dragleave":Ky=null;break;case"mouseover":case"mouseout":e0=null;break;case"pointerover":case"pointerout":yM.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":_M.delete(m.pointerId)}}function vM(d,m,v,S,E,O){return d===null||d.nativeEvent!==O?(d={blockedOn:m,domEventName:v,eventSystemFlags:S,nativeEvent:O,targetContainers:[E]},m!==null&&(m=PM(m),m!==null&&LV(m)),d):(d.eventSystemFlags|=S,m=d.targetContainers,E!==null&&m.indexOf(E)===-1&&m.push(E),d)}function zLe(d,m,v,S,E){switch(m){case"focusin":return Qy=vM(Qy,d,m,v,S,E),!0;case"dragenter":return Ky=vM(Ky,d,m,v,S,E),!0;case"mouseover":return e0=vM(e0,d,m,v,S,E),!0;case"pointerover":var O=E.pointerId;return yM.set(O,vM(yM.get(O)||null,d,m,v,S,E)),!0;case"gotpointercapture":return O=E.pointerId,_M.set(O,vM(_M.get(O)||null,d,m,v,S,E)),!0}return!1}function ore(d){var m=o1(d.target);if(m!==null){var v=Xu(m);if(v!==null){if(m=v.tag,m===13){if(m=Kt(v),m!==null){d.blockedOn=m,nre(d.priority,function(){ire(v)});return}}else if(m===3&&v.stateNode.current.memoizedState.isDehydrated){d.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}d.blockedOn=null}function RI(d){if(d.blockedOn!==null)return!1;for(var m=d.targetContainers;0<m.length;){var v=FV(d.domEventName,d.eventSystemFlags,m[0],d.nativeEvent);if(v===null){v=d.nativeEvent;var S=new v.constructor(v.type,v);rr=S,v.target.dispatchEvent(S),rr=null}else return m=PM(v),m!==null&&LV(m),d.blockedOn=v,!1;m.shift()}return!0}function are(d,m,v){RI(d)&&v.delete(m)}function VLe(){DV=!1,Qy!==null&&RI(Qy)&&(Qy=null),Ky!==null&&RI(Ky)&&(Ky=null),e0!==null&&RI(e0)&&(e0=null),yM.forEach(are),_M.forEach(are)}function wM(d,m){d.blockedOn===m&&(d.blockedOn=null,DV||(DV=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,VLe)))}function bM(d){function m(E){return wM(E,d)}if(0<AI.length){wM(AI[0],d);for(var v=1;v<AI.length;v++){var S=AI[v];S.blockedOn===d&&(S.blockedOn=null)}}for(Qy!==null&&wM(Qy,d),Ky!==null&&wM(Ky,d),e0!==null&&wM(e0,d),yM.forEach(m),_M.forEach(m),v=0;v<t0.length;v++)S=t0[v],S.blockedOn===d&&(S.blockedOn=null);for(;0<t0.length&&(v=t0[0],v.blockedOn===null);)ore(v),v.blockedOn===null&&t0.shift()}var Vx=R.ReactCurrentBatchConfig,II=!0;function BLe(d,m,v,S){var E=gn,O=Vx.transition;Vx.transition=null;try{gn=1,NV(d,m,v,S)}finally{gn=E,Vx.transition=O}}function jLe(d,m,v,S){var E=gn,O=Vx.transition;Vx.transition=null;try{gn=4,NV(d,m,v,S)}finally{gn=E,Vx.transition=O}}function NV(d,m,v,S){if(II){var E=FV(d,m,v,S);if(E===null)eB(d,m,S,PI,v),sre(d,S);else if(zLe(E,d,m,v,S))S.stopPropagation();else if(sre(d,S),m&4&&-1<ULe.indexOf(d)){for(;E!==null;){var O=PM(E);if(O!==null&&tre(O),O=FV(d,m,v,S),O===null&&eB(d,m,S,PI,v),O===E)break;E=O}E!==null&&S.stopPropagation()}else eB(d,m,S,null,v)}}var PI=null;function FV(d,m,v,S){if(PI=null,d=bn(S),d=o1(d),d!==null)if(m=Xu(d),m===null)d=null;else if(v=m.tag,v===13){if(d=Kt(m),d!==null)return d;d=null}else if(v===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;d=null}else m!==d&&(d=null);return PI=d,null}function lre(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Jc()){case Cs:return 1;case Qc:return 4;case Kc:case Xy:return 16;case lf:return 536870912;default:return 16}default:return 16}}var i0=null,kV=null,LI=null;function cre(){if(LI)return LI;var d,m=kV,v=m.length,S,E="value"in i0?i0.value:i0.textContent,O=E.length;for(d=0;d<v&&m[d]===E[d];d++);var F=v-d;for(S=1;S<=F&&m[v-S]===E[O-S];S++);return LI=E.slice(d,1<S?1-S:void 0)}function DI(d){var m=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&m===13&&(d=13)):d=m,d===10&&(d=13),32<=d||d===13?d:0}function NI(){return!0}function ure(){return!1}function eu(d){function m(v,S,E,O,F){this._reactName=v,this._targetInst=E,this.type=S,this.nativeEvent=O,this.target=F,this.currentTarget=null;for(var q in d)d.hasOwnProperty(q)&&(v=d[q],this[q]=v?v(O):O[q]);return this.isDefaultPrevented=(O.defaultPrevented!=null?O.defaultPrevented:O.returnValue===!1)?NI:ure,this.isPropagationStopped=ure,this}return ce(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=NI)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=NI)},persist:function(){},isPersistent:NI}),m}var Bx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},UV=eu(Bx),xM=ce({},Bx,{view:0,detail:0}),GLe=eu(xM),zV,VV,SM,FI=ce({},xM,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jV,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==SM&&(SM&&d.type==="mousemove"?(zV=d.screenX-SM.screenX,VV=d.screenY-SM.screenY):VV=zV=0,SM=d),zV)},movementY:function(d){return"movementY"in d?d.movementY:VV}}),hre=eu(FI),HLe=ce({},FI,{dataTransfer:0}),qLe=eu(HLe),WLe=ce({},xM,{relatedTarget:0}),BV=eu(WLe),ZLe=ce({},Bx,{animationName:0,elapsedTime:0,pseudoElement:0}),YLe=eu(ZLe),XLe=ce({},Bx,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),JLe=eu(XLe),QLe=ce({},Bx,{data:0}),dre=eu(QLe),KLe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eDe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tDe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iDe(d){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(d):(d=tDe[d])?!!m[d]:!1}function jV(){return iDe}var rDe=ce({},xM,{key:function(d){if(d.key){var m=KLe[d.key]||d.key;if(m!=="Unidentified")return m}return d.type==="keypress"?(d=DI(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?eDe[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jV,charCode:function(d){return d.type==="keypress"?DI(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?DI(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),nDe=eu(rDe),sDe=ce({},FI,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pre=eu(sDe),oDe=ce({},xM,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jV}),aDe=eu(oDe),lDe=ce({},Bx,{propertyName:0,elapsedTime:0,pseudoElement:0}),cDe=eu(lDe),uDe=ce({},FI,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),hDe=eu(uDe),dDe=[9,13,27,32],GV=a&&"CompositionEvent"in window,TM=null;a&&"documentMode"in document&&(TM=document.documentMode);var pDe=a&&"TextEvent"in window&&!TM,fre=a&&(!GV||TM&&8<TM&&11>=TM),mre=" ",gre=!1;function yre(d,m){switch(d){case"keyup":return dDe.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _re(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var jx=!1;function fDe(d,m){switch(d){case"compositionend":return _re(m);case"keypress":return m.which!==32?null:(gre=!0,mre);case"textInput":return d=m.data,d===mre&&gre?null:d;default:return null}}function mDe(d,m){if(jx)return d==="compositionend"||!GV&&yre(d,m)?(d=cre(),LI=kV=i0=null,jx=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return fre&&m.locale!=="ko"?null:m.data;default:return null}}var gDe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vre(d){var m=d&&d.nodeName&&d.nodeName.toLowerCase();return m==="input"?!!gDe[d.type]:m==="textarea"}function wre(d,m,v,S){wo(S),m=BI(m,"onChange"),0<m.length&&(v=new UV("onChange","change",null,v,S),d.push({event:v,listeners:m}))}var EM=null,CM=null;function yDe(d){kre(d,0)}function kI(d){var m=Zx(d);if(li(m))return d}function _De(d,m){if(d==="change")return m}var bre=!1;if(a){var HV;if(a){var qV="oninput"in document;if(!qV){var xre=document.createElement("div");xre.setAttribute("oninput","return;"),qV=typeof xre.oninput=="function"}HV=qV}else HV=!1;bre=HV&&(!document.documentMode||9<document.documentMode)}function Sre(){EM&&(EM.detachEvent("onpropertychange",Tre),CM=EM=null)}function Tre(d){if(d.propertyName==="value"&&kI(CM)){var m=[];wre(m,CM,d,bn(d)),se(yDe,m)}}function vDe(d,m,v){d==="focusin"?(Sre(),EM=m,CM=v,EM.attachEvent("onpropertychange",Tre)):d==="focusout"&&Sre()}function wDe(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return kI(CM)}function bDe(d,m){if(d==="click")return kI(m)}function xDe(d,m){if(d==="input"||d==="change")return kI(m)}function SDe(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}var $d=typeof Object.is=="function"?Object.is:SDe;function MM(d,m){if($d(d,m))return!0;if(typeof d!="object"||d===null||typeof m!="object"||m===null)return!1;var v=Object.keys(d),S=Object.keys(m);if(v.length!==S.length)return!1;for(S=0;S<v.length;S++){var E=v[S];if(!l.call(m,E)||!$d(d[E],m[E]))return!1}return!0}function Ere(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Cre(d,m){var v=Ere(d);d=0;for(var S;v;){if(v.nodeType===3){if(S=d+v.textContent.length,d<=m&&S>=m)return{node:v,offset:m-d};d=S}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Ere(v)}}function Mre(d,m){return d&&m?d===m?!0:d&&d.nodeType===3?!1:m&&m.nodeType===3?Mre(d,m.parentNode):"contains"in d?d.contains(m):d.compareDocumentPosition?!!(d.compareDocumentPosition(m)&16):!1:!1}function $re(){for(var d=window,m=ti();m instanceof d.HTMLIFrameElement;){try{var v=typeof m.contentWindow.location.href=="string"}catch{v=!1}if(v)d=m.contentWindow;else break;m=ti(d.document)}return m}function WV(d){var m=d&&d.nodeName&&d.nodeName.toLowerCase();return m&&(m==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||m==="textarea"||d.contentEditable==="true")}function TDe(d){var m=$re(),v=d.focusedElem,S=d.selectionRange;if(m!==v&&v&&v.ownerDocument&&Mre(v.ownerDocument.documentElement,v)){if(S!==null&&WV(v)){if(m=S.start,d=S.end,d===void 0&&(d=m),"selectionStart"in v)v.selectionStart=m,v.selectionEnd=Math.min(d,v.value.length);else if(d=(m=v.ownerDocument||document)&&m.defaultView||window,d.getSelection){d=d.getSelection();var E=v.textContent.length,O=Math.min(S.start,E);S=S.end===void 0?O:Math.min(S.end,E),!d.extend&&O>S&&(E=S,S=O,O=E),E=Cre(v,O);var F=Cre(v,S);E&&F&&(d.rangeCount!==1||d.anchorNode!==E.node||d.anchorOffset!==E.offset||d.focusNode!==F.node||d.focusOffset!==F.offset)&&(m=m.createRange(),m.setStart(E.node,E.offset),d.removeAllRanges(),O>S?(d.addRange(m),d.extend(F.node,F.offset)):(m.setEnd(F.node,F.offset),d.addRange(m)))}}for(m=[],d=v;d=d.parentNode;)d.nodeType===1&&m.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<m.length;v++)d=m[v],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var EDe=a&&"documentMode"in document&&11>=document.documentMode,Gx=null,ZV=null,$M=null,YV=!1;function Ore(d,m,v){var S=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;YV||Gx==null||Gx!==ti(S)||(S=Gx,"selectionStart"in S&&WV(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),$M&&MM($M,S)||($M=S,S=BI(ZV,"onSelect"),0<S.length&&(m=new UV("onSelect","select",null,m,v),d.push({event:m,listeners:S}),m.target=Gx)))}function UI(d,m){var v={};return v[d.toLowerCase()]=m.toLowerCase(),v["Webkit"+d]="webkit"+m,v["Moz"+d]="moz"+m,v}var Hx={animationend:UI("Animation","AnimationEnd"),animationiteration:UI("Animation","AnimationIteration"),animationstart:UI("Animation","AnimationStart"),transitionend:UI("Transition","TransitionEnd")},XV={},Are={};a&&(Are=document.createElement("div").style,"AnimationEvent"in window||(delete Hx.animationend.animation,delete Hx.animationiteration.animation,delete Hx.animationstart.animation),"TransitionEvent"in window||delete Hx.transitionend.transition);function zI(d){if(XV[d])return XV[d];if(!Hx[d])return d;var m=Hx[d],v;for(v in m)if(m.hasOwnProperty(v)&&v in Are)return XV[d]=m[v];return d}var Rre=zI("animationend"),Ire=zI("animationiteration"),Pre=zI("animationstart"),Lre=zI("transitionend"),Dre=new Map,Nre="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function r0(d,m){Dre.set(d,m),s(m,[d])}for(var JV=0;JV<Nre.length;JV++){var QV=Nre[JV],CDe=QV.toLowerCase(),MDe=QV[0].toUpperCase()+QV.slice(1);r0(CDe,"on"+MDe)}r0(Rre,"onAnimationEnd"),r0(Ire,"onAnimationIteration"),r0(Pre,"onAnimationStart"),r0("dblclick","onDoubleClick"),r0("focusin","onFocus"),r0("focusout","onBlur"),r0(Lre,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var OM="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$De=new Set("cancel close invalid load scroll toggle".split(" ").concat(OM));function Fre(d,m,v){var S=d.type||"unknown-event";d.currentTarget=v,Ux(S,m,void 0,d),d.currentTarget=null}function kre(d,m){m=(m&4)!==0;for(var v=0;v<d.length;v++){var S=d[v],E=S.event;S=S.listeners;e:{var O=void 0;if(m)for(var F=S.length-1;0<=F;F--){var q=S[F],ee=q.instance,be=q.currentTarget;if(q=q.listener,ee!==O&&E.isPropagationStopped())break e;Fre(E,q,be),O=ee}else for(F=0;F<S.length;F++){if(q=S[F],ee=q.instance,be=q.currentTarget,q=q.listener,ee!==O&&E.isPropagationStopped())break e;Fre(E,q,be),O=ee}}}if(kr)throw d=Sa,kr=!1,Sa=null,d}function jn(d,m){var v=m[oB];v===void 0&&(v=m[oB]=new Set);var S=d+"__bubble";v.has(S)||(Ure(m,d,2,!1),v.add(S))}function KV(d,m,v){var S=0;m&&(S|=4),Ure(v,d,S,m)}var VI="_reactListening"+Math.random().toString(36).slice(2);function AM(d){if(!d[VI]){d[VI]=!0,r.forEach(function(v){v!=="selectionchange"&&($De.has(v)||KV(v,!1,d),KV(v,!0,d))});var m=d.nodeType===9?d:d.ownerDocument;m===null||m[VI]||(m[VI]=!0,KV("selectionchange",!1,m))}}function Ure(d,m,v,S){switch(lre(m)){case 1:var E=BLe;break;case 4:E=jLe;break;default:E=NV}v=E.bind(null,m,v,d),E=void 0,!Kr||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(E=!0),S?E!==void 0?d.addEventListener(m,v,{capture:!0,passive:E}):d.addEventListener(m,v,!0):E!==void 0?d.addEventListener(m,v,{passive:E}):d.addEventListener(m,v,!1)}function eB(d,m,v,S,E){var O=S;if(!(m&1)&&!(m&2)&&S!==null)e:for(;;){if(S===null)return;var F=S.tag;if(F===3||F===4){var q=S.stateNode.containerInfo;if(q===E||q.nodeType===8&&q.parentNode===E)break;if(F===4)for(F=S.return;F!==null;){var ee=F.tag;if((ee===3||ee===4)&&(ee=F.stateNode.containerInfo,ee===E||ee.nodeType===8&&ee.parentNode===E))return;F=F.return}for(;q!==null;){if(F=o1(q),F===null)return;if(ee=F.tag,ee===5||ee===6){S=O=F;continue e}q=q.parentNode}}S=S.return}se(function(){var be=O,Ve=bn(v),We=[];e:{var Ue=Dre.get(d);if(Ue!==void 0){var bt=UV,Dt=d;switch(d){case"keypress":if(DI(v)===0)break e;case"keydown":case"keyup":bt=nDe;break;case"focusin":Dt="focus",bt=BV;break;case"focusout":Dt="blur",bt=BV;break;case"beforeblur":case"afterblur":bt=BV;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":bt=hre;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":bt=qLe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":bt=aDe;break;case Rre:case Ire:case Pre:bt=YLe;break;case Lre:bt=cDe;break;case"scroll":bt=GLe;break;case"wheel":bt=hDe;break;case"copy":case"cut":case"paste":bt=JLe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":bt=pre}var Ft=(m&4)!==0,Gs=!Ft&&d==="scroll",me=Ft?Ue!==null?Ue+"Capture":null:Ue;Ft=[];for(var re=be,_e;re!==null;){_e=re;var it=_e.stateNode;if(_e.tag===5&&it!==null&&(_e=it,me!==null&&(it=jt(re,me),it!=null&&Ft.push(RM(re,it,_e)))),Gs)break;re=re.return}0<Ft.length&&(Ue=new bt(Ue,Dt,null,v,Ve),We.push({event:Ue,listeners:Ft}))}}if(!(m&7)){e:{if(Ue=d==="mouseover"||d==="pointerover",bt=d==="mouseout"||d==="pointerout",Ue&&v!==rr&&(Dt=v.relatedTarget||v.fromElement)&&(o1(Dt)||Dt[zm]))break e;if((bt||Ue)&&(Ue=Ve.window===Ve?Ve:(Ue=Ve.ownerDocument)?Ue.defaultView||Ue.parentWindow:window,bt?(Dt=v.relatedTarget||v.toElement,bt=be,Dt=Dt?o1(Dt):null,Dt!==null&&(Gs=Xu(Dt),Dt!==Gs||Dt.tag!==5&&Dt.tag!==6)&&(Dt=null)):(bt=null,Dt=be),bt!==Dt)){if(Ft=hre,it="onMouseLeave",me="onMouseEnter",re="mouse",(d==="pointerout"||d==="pointerover")&&(Ft=pre,it="onPointerLeave",me="onPointerEnter",re="pointer"),Gs=bt==null?Ue:Zx(bt),_e=Dt==null?Ue:Zx(Dt),Ue=new Ft(it,re+"leave",bt,v,Ve),Ue.target=Gs,Ue.relatedTarget=_e,it=null,o1(Ve)===be&&(Ft=new Ft(me,re+"enter",Dt,v,Ve),Ft.target=_e,Ft.relatedTarget=Gs,it=Ft),Gs=it,bt&&Dt)t:{for(Ft=bt,me=Dt,re=0,_e=Ft;_e;_e=qx(_e))re++;for(_e=0,it=me;it;it=qx(it))_e++;for(;0<re-_e;)Ft=qx(Ft),re--;for(;0<_e-re;)me=qx(me),_e--;for(;re--;){if(Ft===me||me!==null&&Ft===me.alternate)break t;Ft=qx(Ft),me=qx(me)}Ft=null}else Ft=null;bt!==null&&zre(We,Ue,bt,Ft,!1),Dt!==null&&Gs!==null&&zre(We,Gs,Dt,Ft,!0)}}e:{if(Ue=be?Zx(be):window,bt=Ue.nodeName&&Ue.nodeName.toLowerCase(),bt==="select"||bt==="input"&&Ue.type==="file")var Vt=_De;else if(vre(Ue))if(bre)Vt=xDe;else{Vt=wDe;var ri=vDe}else(bt=Ue.nodeName)&&bt.toLowerCase()==="input"&&(Ue.type==="checkbox"||Ue.type==="radio")&&(Vt=bDe);if(Vt&&(Vt=Vt(d,be))){wre(We,Vt,v,Ve);break e}ri&&ri(d,Ue,be),d==="focusout"&&(ri=Ue._wrapperState)&&ri.controlled&&Ue.type==="number"&&dt(Ue,"number",Ue.value)}switch(ri=be?Zx(be):window,d){case"focusin":(vre(ri)||ri.contentEditable==="true")&&(Gx=ri,ZV=be,$M=null);break;case"focusout":$M=ZV=Gx=null;break;case"mousedown":YV=!0;break;case"contextmenu":case"mouseup":case"dragend":YV=!1,Ore(We,v,Ve);break;case"selectionchange":if(EDe)break;case"keydown":case"keyup":Ore(We,v,Ve)}var ni;if(GV)e:{switch(d){case"compositionstart":var vi="onCompositionStart";break e;case"compositionend":vi="onCompositionEnd";break e;case"compositionupdate":vi="onCompositionUpdate";break e}vi=void 0}else jx?yre(d,v)&&(vi="onCompositionEnd"):d==="keydown"&&v.keyCode===229&&(vi="onCompositionStart");vi&&(fre&&v.locale!=="ko"&&(jx||vi!=="onCompositionStart"?vi==="onCompositionEnd"&&jx&&(ni=cre()):(i0=Ve,kV="value"in i0?i0.value:i0.textContent,jx=!0)),ri=BI(be,vi),0<ri.length&&(vi=new dre(vi,d,null,v,Ve),We.push({event:vi,listeners:ri}),ni?vi.data=ni:(ni=_re(v),ni!==null&&(vi.data=ni)))),(ni=pDe?fDe(d,v):mDe(d,v))&&(be=BI(be,"onBeforeInput"),0<be.length&&(Ve=new dre("onBeforeInput","beforeinput",null,v,Ve),We.push({event:Ve,listeners:be}),Ve.data=ni))}kre(We,m)})}function RM(d,m,v){return{instance:d,listener:m,currentTarget:v}}function BI(d,m){for(var v=m+"Capture",S=[];d!==null;){var E=d,O=E.stateNode;E.tag===5&&O!==null&&(E=O,O=jt(d,v),O!=null&&S.unshift(RM(d,O,E)),O=jt(d,m),O!=null&&S.push(RM(d,O,E))),d=d.return}return S}function qx(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function zre(d,m,v,S,E){for(var O=m._reactName,F=[];v!==null&&v!==S;){var q=v,ee=q.alternate,be=q.stateNode;if(ee!==null&&ee===S)break;q.tag===5&&be!==null&&(q=be,E?(ee=jt(v,O),ee!=null&&F.unshift(RM(v,ee,q))):E||(ee=jt(v,O),ee!=null&&F.push(RM(v,ee,q)))),v=v.return}F.length!==0&&d.push({event:m,listeners:F})}var ODe=/\r\n?/g,ADe=/\u0000|\uFFFD/g;function Vre(d){return(typeof d=="string"?d:""+d).replace(ODe,`
`).replace(ADe,"")}function jI(d,m,v){if(m=Vre(m),Vre(d)!==m&&v)throw Error(i(425))}function GI(){}var tB=null,iB=null;function rB(d,m){return d==="textarea"||d==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var nB=typeof setTimeout=="function"?setTimeout:void 0,RDe=typeof clearTimeout=="function"?clearTimeout:void 0,Bre=typeof Promise=="function"?Promise:void 0,IDe=typeof queueMicrotask=="function"?queueMicrotask:typeof Bre<"u"?function(d){return Bre.resolve(null).then(d).catch(PDe)}:nB;function PDe(d){setTimeout(function(){throw d})}function sB(d,m){var v=m,S=0;do{var E=v.nextSibling;if(d.removeChild(v),E&&E.nodeType===8)if(v=E.data,v==="/$"){if(S===0){d.removeChild(E),bM(m);return}S--}else v!=="$"&&v!=="$?"&&v!=="$!"||S++;v=E}while(v);bM(m)}function n0(d){for(;d!=null;d=d.nextSibling){var m=d.nodeType;if(m===1||m===3)break;if(m===8){if(m=d.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return d}function jre(d){d=d.previousSibling;for(var m=0;d;){if(d.nodeType===8){var v=d.data;if(v==="$"||v==="$!"||v==="$?"){if(m===0)return d;m--}else v==="/$"&&m++}d=d.previousSibling}return null}var Wx=Math.random().toString(36).slice(2),uf="__reactFiber$"+Wx,IM="__reactProps$"+Wx,zm="__reactContainer$"+Wx,oB="__reactEvents$"+Wx,LDe="__reactListeners$"+Wx,DDe="__reactHandles$"+Wx;function o1(d){var m=d[uf];if(m)return m;for(var v=d.parentNode;v;){if(m=v[zm]||v[uf]){if(v=m.alternate,m.child!==null||v!==null&&v.child!==null)for(d=jre(d);d!==null;){if(v=d[uf])return v;d=jre(d)}return m}d=v,v=d.parentNode}return null}function PM(d){return d=d[uf]||d[zm],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Zx(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(i(33))}function HI(d){return d[IM]||null}var aB=[],Yx=-1;function s0(d){return{current:d}}function Gn(d){0>Yx||(d.current=aB[Yx],aB[Yx]=null,Yx--)}function Dn(d,m){Yx++,aB[Yx]=d.current,d.current=m}var o0={},Ja=s0(o0),nc=s0(!1),a1=o0;function Xx(d,m){var v=d.type.contextTypes;if(!v)return o0;var S=d.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===m)return S.__reactInternalMemoizedMaskedChildContext;var E={},O;for(O in v)E[O]=m[O];return S&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=m,d.__reactInternalMemoizedMaskedChildContext=E),E}function sc(d){return d=d.childContextTypes,d!=null}function qI(){Gn(nc),Gn(Ja)}function Gre(d,m,v){if(Ja.current!==o0)throw Error(i(168));Dn(Ja,m),Dn(nc,v)}function Hre(d,m,v){var S=d.stateNode;if(m=m.childContextTypes,typeof S.getChildContext!="function")return v;S=S.getChildContext();for(var E in S)if(!(E in m))throw Error(i(108,Ke(d)||"Unknown",E));return ce({},v,S)}function WI(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||o0,a1=Ja.current,Dn(Ja,d),Dn(nc,nc.current),!0}function qre(d,m,v){var S=d.stateNode;if(!S)throw Error(i(169));v?(d=Hre(d,m,a1),S.__reactInternalMemoizedMergedChildContext=d,Gn(nc),Gn(Ja),Dn(Ja,d)):Gn(nc),Dn(nc,v)}var Vm=null,ZI=!1,lB=!1;function Wre(d){Vm===null?Vm=[d]:Vm.push(d)}function NDe(d){ZI=!0,Wre(d)}function a0(){if(!lB&&Vm!==null){lB=!0;var d=0,m=gn;try{var v=Vm;for(gn=1;d<v.length;d++){var S=v[d];do S=S(!0);while(S!==null)}Vm=null,ZI=!1}catch(E){throw Vm!==null&&(Vm=Vm.slice(d+1)),Xc(Cs,a0),E}finally{gn=m,lB=!1}}return null}var Jx=[],Qx=0,YI=null,XI=0,Qu=[],Ku=0,l1=null,Bm=1,jm="";function c1(d,m){Jx[Qx++]=XI,Jx[Qx++]=YI,YI=d,XI=m}function Zre(d,m,v){Qu[Ku++]=Bm,Qu[Ku++]=jm,Qu[Ku++]=l1,l1=d;var S=Bm;d=jm;var E=32-H(S)-1;S&=~(1<<E),v+=1;var O=32-H(m)+E;if(30<O){var F=E-E%5;O=(S&(1<<F)-1).toString(32),S>>=F,E-=F,Bm=1<<32-H(m)+E|v<<E|S,jm=O+d}else Bm=1<<O|v<<E|S,jm=d}function cB(d){d.return!==null&&(c1(d,1),Zre(d,1,0))}function uB(d){for(;d===YI;)YI=Jx[--Qx],Jx[Qx]=null,XI=Jx[--Qx],Jx[Qx]=null;for(;d===l1;)l1=Qu[--Ku],Qu[Ku]=null,jm=Qu[--Ku],Qu[Ku]=null,Bm=Qu[--Ku],Qu[Ku]=null}var tu=null,iu=null,ss=!1,Od=null;function Yre(d,m){var v=rh(5,null,null,0);v.elementType="DELETED",v.stateNode=m,v.return=d,m=d.deletions,m===null?(d.deletions=[v],d.flags|=16):m.push(v)}function Xre(d,m){switch(d.tag){case 5:var v=d.type;return m=m.nodeType!==1||v.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(d.stateNode=m,tu=d,iu=n0(m.firstChild),!0):!1;case 6:return m=d.pendingProps===""||m.nodeType!==3?null:m,m!==null?(d.stateNode=m,tu=d,iu=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(v=l1!==null?{id:Bm,overflow:jm}:null,d.memoizedState={dehydrated:m,treeContext:v,retryLane:1073741824},v=rh(18,null,null,0),v.stateNode=m,v.return=d,d.child=v,tu=d,iu=null,!0):!1;default:return!1}}function hB(d){return(d.mode&1)!==0&&(d.flags&128)===0}function dB(d){if(ss){var m=iu;if(m){var v=m;if(!Xre(d,m)){if(hB(d))throw Error(i(418));m=n0(v.nextSibling);var S=tu;m&&Xre(d,m)?Yre(S,v):(d.flags=d.flags&-4097|2,ss=!1,tu=d)}}else{if(hB(d))throw Error(i(418));d.flags=d.flags&-4097|2,ss=!1,tu=d}}}function Jre(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;tu=d}function JI(d){if(d!==tu)return!1;if(!ss)return Jre(d),ss=!0,!1;var m;if((m=d.tag!==3)&&!(m=d.tag!==5)&&(m=d.type,m=m!=="head"&&m!=="body"&&!rB(d.type,d.memoizedProps)),m&&(m=iu)){if(hB(d))throw Qre(),Error(i(418));for(;m;)Yre(d,m),m=n0(m.nextSibling)}if(Jre(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));e:{for(d=d.nextSibling,m=0;d;){if(d.nodeType===8){var v=d.data;if(v==="/$"){if(m===0){iu=n0(d.nextSibling);break e}m--}else v!=="$"&&v!=="$!"&&v!=="$?"||m++}d=d.nextSibling}iu=null}}else iu=tu?n0(d.stateNode.nextSibling):null;return!0}function Qre(){for(var d=iu;d;)d=n0(d.nextSibling)}function Kx(){iu=tu=null,ss=!1}function pB(d){Od===null?Od=[d]:Od.push(d)}var FDe=R.ReactCurrentBatchConfig;function LM(d,m,v){if(d=v.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(i(309));var S=v.stateNode}if(!S)throw Error(i(147,d));var E=S,O=""+d;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===O?m.ref:(m=function(F){var q=E.refs;F===null?delete q[O]:q[O]=F},m._stringRef=O,m)}if(typeof d!="string")throw Error(i(284));if(!v._owner)throw Error(i(290,d))}return d}function QI(d,m){throw d=Object.prototype.toString.call(m),Error(i(31,d==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":d))}function Kre(d){var m=d._init;return m(d._payload)}function ene(d){function m(me,re){if(d){var _e=me.deletions;_e===null?(me.deletions=[re],me.flags|=16):_e.push(re)}}function v(me,re){if(!d)return null;for(;re!==null;)m(me,re),re=re.sibling;return null}function S(me,re){for(me=new Map;re!==null;)re.key!==null?me.set(re.key,re):me.set(re.index,re),re=re.sibling;return me}function E(me,re){return me=m0(me,re),me.index=0,me.sibling=null,me}function O(me,re,_e){return me.index=_e,d?(_e=me.alternate,_e!==null?(_e=_e.index,_e<re?(me.flags|=2,re):_e):(me.flags|=2,re)):(me.flags|=1048576,re)}function F(me){return d&&me.alternate===null&&(me.flags|=2),me}function q(me,re,_e,it){return re===null||re.tag!==6?(re=n6(_e,me.mode,it),re.return=me,re):(re=E(re,_e),re.return=me,re)}function ee(me,re,_e,it){var Vt=_e.type;return Vt===N?Ve(me,re,_e.props.children,it,_e.key):re!==null&&(re.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===ge&&Kre(Vt)===re.type)?(it=E(re,_e.props),it.ref=LM(me,re,_e),it.return=me,it):(it=xP(_e.type,_e.key,_e.props,null,me.mode,it),it.ref=LM(me,re,_e),it.return=me,it)}function be(me,re,_e,it){return re===null||re.tag!==4||re.stateNode.containerInfo!==_e.containerInfo||re.stateNode.implementation!==_e.implementation?(re=s6(_e,me.mode,it),re.return=me,re):(re=E(re,_e.children||[]),re.return=me,re)}function Ve(me,re,_e,it,Vt){return re===null||re.tag!==7?(re=y1(_e,me.mode,it,Vt),re.return=me,re):(re=E(re,_e),re.return=me,re)}function We(me,re,_e){if(typeof re=="string"&&re!==""||typeof re=="number")return re=n6(""+re,me.mode,_e),re.return=me,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case I:return _e=xP(re.type,re.key,re.props,null,me.mode,_e),_e.ref=LM(me,null,re),_e.return=me,_e;case P:return re=s6(re,me.mode,_e),re.return=me,re;case ge:var it=re._init;return We(me,it(re._payload),_e)}if(Rt(re)||he(re))return re=y1(re,me.mode,_e,null),re.return=me,re;QI(me,re)}return null}function Ue(me,re,_e,it){var Vt=re!==null?re.key:null;if(typeof _e=="string"&&_e!==""||typeof _e=="number")return Vt!==null?null:q(me,re,""+_e,it);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case I:return _e.key===Vt?ee(me,re,_e,it):null;case P:return _e.key===Vt?be(me,re,_e,it):null;case ge:return Vt=_e._init,Ue(me,re,Vt(_e._payload),it)}if(Rt(_e)||he(_e))return Vt!==null?null:Ve(me,re,_e,it,null);QI(me,_e)}return null}function bt(me,re,_e,it,Vt){if(typeof it=="string"&&it!==""||typeof it=="number")return me=me.get(_e)||null,q(re,me,""+it,Vt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case I:return me=me.get(it.key===null?_e:it.key)||null,ee(re,me,it,Vt);case P:return me=me.get(it.key===null?_e:it.key)||null,be(re,me,it,Vt);case ge:var ri=it._init;return bt(me,re,_e,ri(it._payload),Vt)}if(Rt(it)||he(it))return me=me.get(_e)||null,Ve(re,me,it,Vt,null);QI(re,it)}return null}function Dt(me,re,_e,it){for(var Vt=null,ri=null,ni=re,vi=re=0,Xo=null;ni!==null&&vi<_e.length;vi++){ni.index>vi?(Xo=ni,ni=null):Xo=ni.sibling;var Gr=Ue(me,ni,_e[vi],it);if(Gr===null){ni===null&&(ni=Xo);break}d&&ni&&Gr.alternate===null&&m(me,ni),re=O(Gr,re,vi),ri===null?Vt=Gr:ri.sibling=Gr,ri=Gr,ni=Xo}if(vi===_e.length)return v(me,ni),ss&&c1(me,vi),Vt;if(ni===null){for(;vi<_e.length;vi++)ni=We(me,_e[vi],it),ni!==null&&(re=O(ni,re,vi),ri===null?Vt=ni:ri.sibling=ni,ri=ni);return ss&&c1(me,vi),Vt}for(ni=S(me,ni);vi<_e.length;vi++)Xo=bt(ni,me,vi,_e[vi],it),Xo!==null&&(d&&Xo.alternate!==null&&ni.delete(Xo.key===null?vi:Xo.key),re=O(Xo,re,vi),ri===null?Vt=Xo:ri.sibling=Xo,ri=Xo);return d&&ni.forEach(function(g0){return m(me,g0)}),ss&&c1(me,vi),Vt}function Ft(me,re,_e,it){var Vt=he(_e);if(typeof Vt!="function")throw Error(i(150));if(_e=Vt.call(_e),_e==null)throw Error(i(151));for(var ri=Vt=null,ni=re,vi=re=0,Xo=null,Gr=_e.next();ni!==null&&!Gr.done;vi++,Gr=_e.next()){ni.index>vi?(Xo=ni,ni=null):Xo=ni.sibling;var g0=Ue(me,ni,Gr.value,it);if(g0===null){ni===null&&(ni=Xo);break}d&&ni&&g0.alternate===null&&m(me,ni),re=O(g0,re,vi),ri===null?Vt=g0:ri.sibling=g0,ri=g0,ni=Xo}if(Gr.done)return v(me,ni),ss&&c1(me,vi),Vt;if(ni===null){for(;!Gr.done;vi++,Gr=_e.next())Gr=We(me,Gr.value,it),Gr!==null&&(re=O(Gr,re,vi),ri===null?Vt=Gr:ri.sibling=Gr,ri=Gr);return ss&&c1(me,vi),Vt}for(ni=S(me,ni);!Gr.done;vi++,Gr=_e.next())Gr=bt(ni,me,vi,Gr.value,it),Gr!==null&&(d&&Gr.alternate!==null&&ni.delete(Gr.key===null?vi:Gr.key),re=O(Gr,re,vi),ri===null?Vt=Gr:ri.sibling=Gr,ri=Gr);return d&&ni.forEach(function(gNe){return m(me,gNe)}),ss&&c1(me,vi),Vt}function Gs(me,re,_e,it){if(typeof _e=="object"&&_e!==null&&_e.type===N&&_e.key===null&&(_e=_e.props.children),typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case I:e:{for(var Vt=_e.key,ri=re;ri!==null;){if(ri.key===Vt){if(Vt=_e.type,Vt===N){if(ri.tag===7){v(me,ri.sibling),re=E(ri,_e.props.children),re.return=me,me=re;break e}}else if(ri.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===ge&&Kre(Vt)===ri.type){v(me,ri.sibling),re=E(ri,_e.props),re.ref=LM(me,ri,_e),re.return=me,me=re;break e}v(me,ri);break}else m(me,ri);ri=ri.sibling}_e.type===N?(re=y1(_e.props.children,me.mode,it,_e.key),re.return=me,me=re):(it=xP(_e.type,_e.key,_e.props,null,me.mode,it),it.ref=LM(me,re,_e),it.return=me,me=it)}return F(me);case P:e:{for(ri=_e.key;re!==null;){if(re.key===ri)if(re.tag===4&&re.stateNode.containerInfo===_e.containerInfo&&re.stateNode.implementation===_e.implementation){v(me,re.sibling),re=E(re,_e.children||[]),re.return=me,me=re;break e}else{v(me,re);break}else m(me,re);re=re.sibling}re=s6(_e,me.mode,it),re.return=me,me=re}return F(me);case ge:return ri=_e._init,Gs(me,re,ri(_e._payload),it)}if(Rt(_e))return Dt(me,re,_e,it);if(he(_e))return Ft(me,re,_e,it);QI(me,_e)}return typeof _e=="string"&&_e!==""||typeof _e=="number"?(_e=""+_e,re!==null&&re.tag===6?(v(me,re.sibling),re=E(re,_e),re.return=me,me=re):(v(me,re),re=n6(_e,me.mode,it),re.return=me,me=re),F(me)):v(me,re)}return Gs}var eS=ene(!0),tne=ene(!1),KI=s0(null),eP=null,tS=null,fB=null;function mB(){fB=tS=eP=null}function gB(d){var m=KI.current;Gn(KI),d._currentValue=m}function yB(d,m,v){for(;d!==null;){var S=d.alternate;if((d.childLanes&m)!==m?(d.childLanes|=m,S!==null&&(S.childLanes|=m)):S!==null&&(S.childLanes&m)!==m&&(S.childLanes|=m),d===v)break;d=d.return}}function iS(d,m){eP=d,fB=tS=null,d=d.dependencies,d!==null&&d.firstContext!==null&&(d.lanes&m&&(oc=!0),d.firstContext=null)}function eh(d){var m=d._currentValue;if(fB!==d)if(d={context:d,memoizedValue:m,next:null},tS===null){if(eP===null)throw Error(i(308));tS=d,eP.dependencies={lanes:0,firstContext:d}}else tS=tS.next=d;return m}var u1=null;function _B(d){u1===null?u1=[d]:u1.push(d)}function ine(d,m,v,S){var E=m.interleaved;return E===null?(v.next=v,_B(m)):(v.next=E.next,E.next=v),m.interleaved=v,Gm(d,S)}function Gm(d,m){d.lanes|=m;var v=d.alternate;for(v!==null&&(v.lanes|=m),v=d,d=d.return;d!==null;)d.childLanes|=m,v=d.alternate,v!==null&&(v.childLanes|=m),v=d,d=d.return;return v.tag===3?v.stateNode:null}var l0=!1;function vB(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rne(d,m){d=d.updateQueue,m.updateQueue===d&&(m.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Hm(d,m){return{eventTime:d,lane:m,tag:0,payload:null,callback:null,next:null}}function c0(d,m,v){var S=d.updateQueue;if(S===null)return null;if(S=S.shared,Ur&2){var E=S.pending;return E===null?m.next=m:(m.next=E.next,E.next=m),S.pending=m,Gm(d,v)}return E=S.interleaved,E===null?(m.next=m,_B(S)):(m.next=E.next,E.next=m),S.interleaved=m,Gm(d,v)}function tP(d,m,v){if(m=m.updateQueue,m!==null&&(m=m.shared,(v&4194240)!==0)){var S=m.lanes;S&=d.pendingLanes,v|=S,m.lanes=v,PV(d,v)}}function nne(d,m){var v=d.updateQueue,S=d.alternate;if(S!==null&&(S=S.updateQueue,v===S)){var E=null,O=null;if(v=v.firstBaseUpdate,v!==null){do{var F={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};O===null?E=O=F:O=O.next=F,v=v.next}while(v!==null);O===null?E=O=m:O=O.next=m}else E=O=m;v={baseState:S.baseState,firstBaseUpdate:E,lastBaseUpdate:O,shared:S.shared,effects:S.effects},d.updateQueue=v;return}d=v.lastBaseUpdate,d===null?v.firstBaseUpdate=m:d.next=m,v.lastBaseUpdate=m}function iP(d,m,v,S){var E=d.updateQueue;l0=!1;var O=E.firstBaseUpdate,F=E.lastBaseUpdate,q=E.shared.pending;if(q!==null){E.shared.pending=null;var ee=q,be=ee.next;ee.next=null,F===null?O=be:F.next=be,F=ee;var Ve=d.alternate;Ve!==null&&(Ve=Ve.updateQueue,q=Ve.lastBaseUpdate,q!==F&&(q===null?Ve.firstBaseUpdate=be:q.next=be,Ve.lastBaseUpdate=ee))}if(O!==null){var We=E.baseState;F=0,Ve=be=ee=null,q=O;do{var Ue=q.lane,bt=q.eventTime;if((S&Ue)===Ue){Ve!==null&&(Ve=Ve.next={eventTime:bt,lane:0,tag:q.tag,payload:q.payload,callback:q.callback,next:null});e:{var Dt=d,Ft=q;switch(Ue=m,bt=v,Ft.tag){case 1:if(Dt=Ft.payload,typeof Dt=="function"){We=Dt.call(bt,We,Ue);break e}We=Dt;break e;case 3:Dt.flags=Dt.flags&-65537|128;case 0:if(Dt=Ft.payload,Ue=typeof Dt=="function"?Dt.call(bt,We,Ue):Dt,Ue==null)break e;We=ce({},We,Ue);break e;case 2:l0=!0}}q.callback!==null&&q.lane!==0&&(d.flags|=64,Ue=E.effects,Ue===null?E.effects=[q]:Ue.push(q))}else bt={eventTime:bt,lane:Ue,tag:q.tag,payload:q.payload,callback:q.callback,next:null},Ve===null?(be=Ve=bt,ee=We):Ve=Ve.next=bt,F|=Ue;if(q=q.next,q===null){if(q=E.shared.pending,q===null)break;Ue=q,q=Ue.next,Ue.next=null,E.lastBaseUpdate=Ue,E.shared.pending=null}}while(!0);if(Ve===null&&(ee=We),E.baseState=ee,E.firstBaseUpdate=be,E.lastBaseUpdate=Ve,m=E.shared.interleaved,m!==null){E=m;do F|=E.lane,E=E.next;while(E!==m)}else O===null&&(E.shared.lanes=0);p1|=F,d.lanes=F,d.memoizedState=We}}function sne(d,m,v){if(d=m.effects,m.effects=null,d!==null)for(m=0;m<d.length;m++){var S=d[m],E=S.callback;if(E!==null){if(S.callback=null,S=v,typeof E!="function")throw Error(i(191,E));E.call(S)}}}var DM={},hf=s0(DM),NM=s0(DM),FM=s0(DM);function h1(d){if(d===DM)throw Error(i(174));return d}function wB(d,m){switch(Dn(FM,m),Dn(NM,d),Dn(hf,DM),d=m.nodeType,d){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:Yi(null,"");break;default:d=d===8?m.parentNode:m,m=d.namespaceURI||null,d=d.tagName,m=Yi(m,d)}Gn(hf),Dn(hf,m)}function rS(){Gn(hf),Gn(NM),Gn(FM)}function one(d){h1(FM.current);var m=h1(hf.current),v=Yi(m,d.type);m!==v&&(Dn(NM,d),Dn(hf,v))}function bB(d){NM.current===d&&(Gn(hf),Gn(NM))}var ms=s0(0);function rP(d){for(var m=d;m!==null;){if(m.tag===13){var v=m.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if(m.flags&128)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var xB=[];function SB(){for(var d=0;d<xB.length;d++)xB[d]._workInProgressVersionPrimary=null;xB.length=0}var nP=R.ReactCurrentDispatcher,TB=R.ReactCurrentBatchConfig,d1=0,gs=null,xo=null,Zo=null,sP=!1,kM=!1,UM=0,kDe=0;function Qa(){throw Error(i(321))}function EB(d,m){if(m===null)return!1;for(var v=0;v<m.length&&v<d.length;v++)if(!$d(d[v],m[v]))return!1;return!0}function CB(d,m,v,S,E,O){if(d1=O,gs=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,nP.current=d===null||d.memoizedState===null?BDe:jDe,d=v(S,E),kM){O=0;do{if(kM=!1,UM=0,25<=O)throw Error(i(301));O+=1,Zo=xo=null,m.updateQueue=null,nP.current=GDe,d=v(S,E)}while(kM)}if(nP.current=lP,m=xo!==null&&xo.next!==null,d1=0,Zo=xo=gs=null,sP=!1,m)throw Error(i(300));return d}function MB(){var d=UM!==0;return UM=0,d}function df(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zo===null?gs.memoizedState=Zo=d:Zo=Zo.next=d,Zo}function th(){if(xo===null){var d=gs.alternate;d=d!==null?d.memoizedState:null}else d=xo.next;var m=Zo===null?gs.memoizedState:Zo.next;if(m!==null)Zo=m,xo=d;else{if(d===null)throw Error(i(310));xo=d,d={memoizedState:xo.memoizedState,baseState:xo.baseState,baseQueue:xo.baseQueue,queue:xo.queue,next:null},Zo===null?gs.memoizedState=Zo=d:Zo=Zo.next=d}return Zo}function zM(d,m){return typeof m=="function"?m(d):m}function $B(d){var m=th(),v=m.queue;if(v===null)throw Error(i(311));v.lastRenderedReducer=d;var S=xo,E=S.baseQueue,O=v.pending;if(O!==null){if(E!==null){var F=E.next;E.next=O.next,O.next=F}S.baseQueue=E=O,v.pending=null}if(E!==null){O=E.next,S=S.baseState;var q=F=null,ee=null,be=O;do{var Ve=be.lane;if((d1&Ve)===Ve)ee!==null&&(ee=ee.next={lane:0,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null}),S=be.hasEagerState?be.eagerState:d(S,be.action);else{var We={lane:Ve,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null};ee===null?(q=ee=We,F=S):ee=ee.next=We,gs.lanes|=Ve,p1|=Ve}be=be.next}while(be!==null&&be!==O);ee===null?F=S:ee.next=q,$d(S,m.memoizedState)||(oc=!0),m.memoizedState=S,m.baseState=F,m.baseQueue=ee,v.lastRenderedState=S}if(d=v.interleaved,d!==null){E=d;do O=E.lane,gs.lanes|=O,p1|=O,E=E.next;while(E!==d)}else E===null&&(v.lanes=0);return[m.memoizedState,v.dispatch]}function OB(d){var m=th(),v=m.queue;if(v===null)throw Error(i(311));v.lastRenderedReducer=d;var S=v.dispatch,E=v.pending,O=m.memoizedState;if(E!==null){v.pending=null;var F=E=E.next;do O=d(O,F.action),F=F.next;while(F!==E);$d(O,m.memoizedState)||(oc=!0),m.memoizedState=O,m.baseQueue===null&&(m.baseState=O),v.lastRenderedState=O}return[O,S]}function ane(){}function lne(d,m){var v=gs,S=th(),E=m(),O=!$d(S.memoizedState,E);if(O&&(S.memoizedState=E,oc=!0),S=S.queue,AB(hne.bind(null,v,S,d),[d]),S.getSnapshot!==m||O||Zo!==null&&Zo.memoizedState.tag&1){if(v.flags|=2048,VM(9,une.bind(null,v,S,E,m),void 0,null),Yo===null)throw Error(i(349));d1&30||cne(v,m,E)}return E}function cne(d,m,v){d.flags|=16384,d={getSnapshot:m,value:v},m=gs.updateQueue,m===null?(m={lastEffect:null,stores:null},gs.updateQueue=m,m.stores=[d]):(v=m.stores,v===null?m.stores=[d]:v.push(d))}function une(d,m,v,S){m.value=v,m.getSnapshot=S,dne(m)&&pne(d)}function hne(d,m,v){return v(function(){dne(m)&&pne(d)})}function dne(d){var m=d.getSnapshot;d=d.value;try{var v=m();return!$d(d,v)}catch{return!0}}function pne(d){var m=Gm(d,1);m!==null&&Pd(m,d,1,-1)}function fne(d){var m=df();return typeof d=="function"&&(d=d()),m.memoizedState=m.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zM,lastRenderedState:d},m.queue=d,d=d.dispatch=VDe.bind(null,gs,d),[m.memoizedState,d]}function VM(d,m,v,S){return d={tag:d,create:m,destroy:v,deps:S,next:null},m=gs.updateQueue,m===null?(m={lastEffect:null,stores:null},gs.updateQueue=m,m.lastEffect=d.next=d):(v=m.lastEffect,v===null?m.lastEffect=d.next=d:(S=v.next,v.next=d,d.next=S,m.lastEffect=d)),d}function mne(){return th().memoizedState}function oP(d,m,v,S){var E=df();gs.flags|=d,E.memoizedState=VM(1|m,v,void 0,S===void 0?null:S)}function aP(d,m,v,S){var E=th();S=S===void 0?null:S;var O=void 0;if(xo!==null){var F=xo.memoizedState;if(O=F.destroy,S!==null&&EB(S,F.deps)){E.memoizedState=VM(m,v,O,S);return}}gs.flags|=d,E.memoizedState=VM(1|m,v,O,S)}function gne(d,m){return oP(8390656,8,d,m)}function AB(d,m){return aP(2048,8,d,m)}function yne(d,m){return aP(4,2,d,m)}function _ne(d,m){return aP(4,4,d,m)}function vne(d,m){if(typeof m=="function")return d=d(),m(d),function(){m(null)};if(m!=null)return d=d(),m.current=d,function(){m.current=null}}function wne(d,m,v){return v=v!=null?v.concat([d]):null,aP(4,4,vne.bind(null,m,d),v)}function RB(){}function bne(d,m){var v=th();m=m===void 0?null:m;var S=v.memoizedState;return S!==null&&m!==null&&EB(m,S[1])?S[0]:(v.memoizedState=[d,m],d)}function xne(d,m){var v=th();m=m===void 0?null:m;var S=v.memoizedState;return S!==null&&m!==null&&EB(m,S[1])?S[0]:(d=d(),v.memoizedState=[d,m],d)}function Sne(d,m,v){return d1&21?($d(v,m)||(v=mM(),gs.lanes|=v,p1|=v,d.baseState=!0),m):(d.baseState&&(d.baseState=!1,oc=!0),d.memoizedState=v)}function UDe(d,m){var v=gn;gn=v!==0&&4>v?v:4,d(!0);var S=TB.transition;TB.transition={};try{d(!1),m()}finally{gn=v,TB.transition=S}}function Tne(){return th().memoizedState}function zDe(d,m,v){var S=p0(d);if(v={lane:S,action:v,hasEagerState:!1,eagerState:null,next:null},Ene(d))Cne(m,v);else if(v=ine(d,m,v,S),v!==null){var E=El();Pd(v,d,S,E),Mne(v,m,S)}}function VDe(d,m,v){var S=p0(d),E={lane:S,action:v,hasEagerState:!1,eagerState:null,next:null};if(Ene(d))Cne(m,E);else{var O=d.alternate;if(d.lanes===0&&(O===null||O.lanes===0)&&(O=m.lastRenderedReducer,O!==null))try{var F=m.lastRenderedState,q=O(F,v);if(E.hasEagerState=!0,E.eagerState=q,$d(q,F)){var ee=m.interleaved;ee===null?(E.next=E,_B(m)):(E.next=ee.next,ee.next=E),m.interleaved=E;return}}catch{}finally{}v=ine(d,m,E,S),v!==null&&(E=El(),Pd(v,d,S,E),Mne(v,m,S))}}function Ene(d){var m=d.alternate;return d===gs||m!==null&&m===gs}function Cne(d,m){kM=sP=!0;var v=d.pending;v===null?m.next=m:(m.next=v.next,v.next=m),d.pending=m}function Mne(d,m,v){if(v&4194240){var S=m.lanes;S&=d.pendingLanes,v|=S,m.lanes=v,PV(d,v)}}var lP={readContext:eh,useCallback:Qa,useContext:Qa,useEffect:Qa,useImperativeHandle:Qa,useInsertionEffect:Qa,useLayoutEffect:Qa,useMemo:Qa,useReducer:Qa,useRef:Qa,useState:Qa,useDebugValue:Qa,useDeferredValue:Qa,useTransition:Qa,useMutableSource:Qa,useSyncExternalStore:Qa,useId:Qa,unstable_isNewReconciler:!1},BDe={readContext:eh,useCallback:function(d,m){return df().memoizedState=[d,m===void 0?null:m],d},useContext:eh,useEffect:gne,useImperativeHandle:function(d,m,v){return v=v!=null?v.concat([d]):null,oP(4194308,4,vne.bind(null,m,d),v)},useLayoutEffect:function(d,m){return oP(4194308,4,d,m)},useInsertionEffect:function(d,m){return oP(4,2,d,m)},useMemo:function(d,m){var v=df();return m=m===void 0?null:m,d=d(),v.memoizedState=[d,m],d},useReducer:function(d,m,v){var S=df();return m=v!==void 0?v(m):m,S.memoizedState=S.baseState=m,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:m},S.queue=d,d=d.dispatch=zDe.bind(null,gs,d),[S.memoizedState,d]},useRef:function(d){var m=df();return d={current:d},m.memoizedState=d},useState:fne,useDebugValue:RB,useDeferredValue:function(d){return df().memoizedState=d},useTransition:function(){var d=fne(!1),m=d[0];return d=UDe.bind(null,d[1]),df().memoizedState=d,[m,d]},useMutableSource:function(){},useSyncExternalStore:function(d,m,v){var S=gs,E=df();if(ss){if(v===void 0)throw Error(i(407));v=v()}else{if(v=m(),Yo===null)throw Error(i(349));d1&30||cne(S,m,v)}E.memoizedState=v;var O={value:v,getSnapshot:m};return E.queue=O,gne(hne.bind(null,S,O,d),[d]),S.flags|=2048,VM(9,une.bind(null,S,O,v,m),void 0,null),v},useId:function(){var d=df(),m=Yo.identifierPrefix;if(ss){var v=jm,S=Bm;v=(S&~(1<<32-H(S)-1)).toString(32)+v,m=":"+m+"R"+v,v=UM++,0<v&&(m+="H"+v.toString(32)),m+=":"}else v=kDe++,m=":"+m+"r"+v.toString(32)+":";return d.memoizedState=m},unstable_isNewReconciler:!1},jDe={readContext:eh,useCallback:bne,useContext:eh,useEffect:AB,useImperativeHandle:wne,useInsertionEffect:yne,useLayoutEffect:_ne,useMemo:xne,useReducer:$B,useRef:mne,useState:function(){return $B(zM)},useDebugValue:RB,useDeferredValue:function(d){var m=th();return Sne(m,xo.memoizedState,d)},useTransition:function(){var d=$B(zM)[0],m=th().memoizedState;return[d,m]},useMutableSource:ane,useSyncExternalStore:lne,useId:Tne,unstable_isNewReconciler:!1},GDe={readContext:eh,useCallback:bne,useContext:eh,useEffect:AB,useImperativeHandle:wne,useInsertionEffect:yne,useLayoutEffect:_ne,useMemo:xne,useReducer:OB,useRef:mne,useState:function(){return OB(zM)},useDebugValue:RB,useDeferredValue:function(d){var m=th();return xo===null?m.memoizedState=d:Sne(m,xo.memoizedState,d)},useTransition:function(){var d=OB(zM)[0],m=th().memoizedState;return[d,m]},useMutableSource:ane,useSyncExternalStore:lne,useId:Tne,unstable_isNewReconciler:!1};function Ad(d,m){if(d&&d.defaultProps){m=ce({},m),d=d.defaultProps;for(var v in d)m[v]===void 0&&(m[v]=d[v]);return m}return m}function IB(d,m,v,S){m=d.memoizedState,v=v(S,m),v=v==null?m:ce({},m,v),d.memoizedState=v,d.lanes===0&&(d.updateQueue.baseState=v)}var cP={isMounted:function(d){return(d=d._reactInternals)?Xu(d)===d:!1},enqueueSetState:function(d,m,v){d=d._reactInternals;var S=El(),E=p0(d),O=Hm(S,E);O.payload=m,v!=null&&(O.callback=v),m=c0(d,O,E),m!==null&&(Pd(m,d,E,S),tP(m,d,E))},enqueueReplaceState:function(d,m,v){d=d._reactInternals;var S=El(),E=p0(d),O=Hm(S,E);O.tag=1,O.payload=m,v!=null&&(O.callback=v),m=c0(d,O,E),m!==null&&(Pd(m,d,E,S),tP(m,d,E))},enqueueForceUpdate:function(d,m){d=d._reactInternals;var v=El(),S=p0(d),E=Hm(v,S);E.tag=2,m!=null&&(E.callback=m),m=c0(d,E,S),m!==null&&(Pd(m,d,S,v),tP(m,d,S))}};function $ne(d,m,v,S,E,O,F){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(S,O,F):m.prototype&&m.prototype.isPureReactComponent?!MM(v,S)||!MM(E,O):!0}function One(d,m,v){var S=!1,E=o0,O=m.contextType;return typeof O=="object"&&O!==null?O=eh(O):(E=sc(m)?a1:Ja.current,S=m.contextTypes,O=(S=S!=null)?Xx(d,E):o0),m=new m(v,O),d.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=cP,d.stateNode=m,m._reactInternals=d,S&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=E,d.__reactInternalMemoizedMaskedChildContext=O),m}function Ane(d,m,v,S){d=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(v,S),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(v,S),m.state!==d&&cP.enqueueReplaceState(m,m.state,null)}function PB(d,m,v,S){var E=d.stateNode;E.props=v,E.state=d.memoizedState,E.refs={},vB(d);var O=m.contextType;typeof O=="object"&&O!==null?E.context=eh(O):(O=sc(m)?a1:Ja.current,E.context=Xx(d,O)),E.state=d.memoizedState,O=m.getDerivedStateFromProps,typeof O=="function"&&(IB(d,m,O,v),E.state=d.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(m=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),m!==E.state&&cP.enqueueReplaceState(E,E.state,null),iP(d,v,E,S),E.state=d.memoizedState),typeof E.componentDidMount=="function"&&(d.flags|=4194308)}function nS(d,m){try{var v="",S=m;do v+=Ce(S),S=S.return;while(S);var E=v}catch(O){E=`
Error generating stack: `+O.message+`
`+O.stack}return{value:d,source:m,stack:E,digest:null}}function LB(d,m,v){return{value:d,source:null,stack:v??null,digest:m??null}}function DB(d,m){try{console.error(m.value)}catch(v){setTimeout(function(){throw v})}}var HDe=typeof WeakMap=="function"?WeakMap:Map;function Rne(d,m,v){v=Hm(-1,v),v.tag=3,v.payload={element:null};var S=m.value;return v.callback=function(){gP||(gP=!0,XB=S),DB(d,m)},v}function Ine(d,m,v){v=Hm(-1,v),v.tag=3;var S=d.type.getDerivedStateFromError;if(typeof S=="function"){var E=m.value;v.payload=function(){return S(E)},v.callback=function(){DB(d,m)}}var O=d.stateNode;return O!==null&&typeof O.componentDidCatch=="function"&&(v.callback=function(){DB(d,m),typeof S!="function"&&(h0===null?h0=new Set([this]):h0.add(this));var F=m.stack;this.componentDidCatch(m.value,{componentStack:F!==null?F:""})}),v}function Pne(d,m,v){var S=d.pingCache;if(S===null){S=d.pingCache=new HDe;var E=new Set;S.set(m,E)}else E=S.get(m),E===void 0&&(E=new Set,S.set(m,E));E.has(v)||(E.add(v),d=sNe.bind(null,d,m,v),m.then(d,d))}function Lne(d){do{var m;if((m=d.tag===13)&&(m=d.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return d;d=d.return}while(d!==null);return null}function Dne(d,m,v,S,E){return d.mode&1?(d.flags|=65536,d.lanes=E,d):(d===m?d.flags|=65536:(d.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(m=Hm(-1,1),m.tag=2,c0(v,m,1))),v.lanes|=1),d)}var qDe=R.ReactCurrentOwner,oc=!1;function Tl(d,m,v,S){m.child=d===null?tne(m,null,v,S):eS(m,d.child,v,S)}function Nne(d,m,v,S,E){v=v.render;var O=m.ref;return iS(m,E),S=CB(d,m,v,S,O,E),v=MB(),d!==null&&!oc?(m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~E,qm(d,m,E)):(ss&&v&&cB(m),m.flags|=1,Tl(d,m,S,E),m.child)}function Fne(d,m,v,S,E){if(d===null){var O=v.type;return typeof O=="function"&&!r6(O)&&O.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(m.tag=15,m.type=O,kne(d,m,O,S,E)):(d=xP(v.type,null,S,m,m.mode,E),d.ref=m.ref,d.return=m,m.child=d)}if(O=d.child,!(d.lanes&E)){var F=O.memoizedProps;if(v=v.compare,v=v!==null?v:MM,v(F,S)&&d.ref===m.ref)return qm(d,m,E)}return m.flags|=1,d=m0(O,S),d.ref=m.ref,d.return=m,m.child=d}function kne(d,m,v,S,E){if(d!==null){var O=d.memoizedProps;if(MM(O,S)&&d.ref===m.ref)if(oc=!1,m.pendingProps=S=O,(d.lanes&E)!==0)d.flags&131072&&(oc=!0);else return m.lanes=d.lanes,qm(d,m,E)}return NB(d,m,v,S,E)}function Une(d,m,v){var S=m.pendingProps,E=S.children,O=d!==null?d.memoizedState:null;if(S.mode==="hidden")if(!(m.mode&1))m.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dn(oS,ru),ru|=v;else{if(!(v&1073741824))return d=O!==null?O.baseLanes|v:v,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:d,cachePool:null,transitions:null},m.updateQueue=null,Dn(oS,ru),ru|=d,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=O!==null?O.baseLanes:v,Dn(oS,ru),ru|=S}else O!==null?(S=O.baseLanes|v,m.memoizedState=null):S=v,Dn(oS,ru),ru|=S;return Tl(d,m,E,v),m.child}function zne(d,m){var v=m.ref;(d===null&&v!==null||d!==null&&d.ref!==v)&&(m.flags|=512,m.flags|=2097152)}function NB(d,m,v,S,E){var O=sc(v)?a1:Ja.current;return O=Xx(m,O),iS(m,E),v=CB(d,m,v,S,O,E),S=MB(),d!==null&&!oc?(m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~E,qm(d,m,E)):(ss&&S&&cB(m),m.flags|=1,Tl(d,m,v,E),m.child)}function Vne(d,m,v,S,E){if(sc(v)){var O=!0;WI(m)}else O=!1;if(iS(m,E),m.stateNode===null)hP(d,m),One(m,v,S),PB(m,v,S,E),S=!0;else if(d===null){var F=m.stateNode,q=m.memoizedProps;F.props=q;var ee=F.context,be=v.contextType;typeof be=="object"&&be!==null?be=eh(be):(be=sc(v)?a1:Ja.current,be=Xx(m,be));var Ve=v.getDerivedStateFromProps,We=typeof Ve=="function"||typeof F.getSnapshotBeforeUpdate=="function";We||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(q!==S||ee!==be)&&Ane(m,F,S,be),l0=!1;var Ue=m.memoizedState;F.state=Ue,iP(m,S,F,E),ee=m.memoizedState,q!==S||Ue!==ee||nc.current||l0?(typeof Ve=="function"&&(IB(m,v,Ve,S),ee=m.memoizedState),(q=l0||$ne(m,v,q,S,Ue,ee,be))?(We||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount()),typeof F.componentDidMount=="function"&&(m.flags|=4194308)):(typeof F.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=S,m.memoizedState=ee),F.props=S,F.state=ee,F.context=be,S=q):(typeof F.componentDidMount=="function"&&(m.flags|=4194308),S=!1)}else{F=m.stateNode,rne(d,m),q=m.memoizedProps,be=m.type===m.elementType?q:Ad(m.type,q),F.props=be,We=m.pendingProps,Ue=F.context,ee=v.contextType,typeof ee=="object"&&ee!==null?ee=eh(ee):(ee=sc(v)?a1:Ja.current,ee=Xx(m,ee));var bt=v.getDerivedStateFromProps;(Ve=typeof bt=="function"||typeof F.getSnapshotBeforeUpdate=="function")||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(q!==We||Ue!==ee)&&Ane(m,F,S,ee),l0=!1,Ue=m.memoizedState,F.state=Ue,iP(m,S,F,E);var Dt=m.memoizedState;q!==We||Ue!==Dt||nc.current||l0?(typeof bt=="function"&&(IB(m,v,bt,S),Dt=m.memoizedState),(be=l0||$ne(m,v,be,S,Ue,Dt,ee)||!1)?(Ve||typeof F.UNSAFE_componentWillUpdate!="function"&&typeof F.componentWillUpdate!="function"||(typeof F.componentWillUpdate=="function"&&F.componentWillUpdate(S,Dt,ee),typeof F.UNSAFE_componentWillUpdate=="function"&&F.UNSAFE_componentWillUpdate(S,Dt,ee)),typeof F.componentDidUpdate=="function"&&(m.flags|=4),typeof F.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof F.componentDidUpdate!="function"||q===d.memoizedProps&&Ue===d.memoizedState||(m.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||q===d.memoizedProps&&Ue===d.memoizedState||(m.flags|=1024),m.memoizedProps=S,m.memoizedState=Dt),F.props=S,F.state=Dt,F.context=ee,S=be):(typeof F.componentDidUpdate!="function"||q===d.memoizedProps&&Ue===d.memoizedState||(m.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||q===d.memoizedProps&&Ue===d.memoizedState||(m.flags|=1024),S=!1)}return FB(d,m,v,S,O,E)}function FB(d,m,v,S,E,O){zne(d,m);var F=(m.flags&128)!==0;if(!S&&!F)return E&&qre(m,v,!1),qm(d,m,O);S=m.stateNode,qDe.current=m;var q=F&&typeof v.getDerivedStateFromError!="function"?null:S.render();return m.flags|=1,d!==null&&F?(m.child=eS(m,d.child,null,O),m.child=eS(m,null,q,O)):Tl(d,m,q,O),m.memoizedState=S.state,E&&qre(m,v,!0),m.child}function Bne(d){var m=d.stateNode;m.pendingContext?Gre(d,m.pendingContext,m.pendingContext!==m.context):m.context&&Gre(d,m.context,!1),wB(d,m.containerInfo)}function jne(d,m,v,S,E){return Kx(),pB(E),m.flags|=256,Tl(d,m,v,S),m.child}var kB={dehydrated:null,treeContext:null,retryLane:0};function UB(d){return{baseLanes:d,cachePool:null,transitions:null}}function Gne(d,m,v){var S=m.pendingProps,E=ms.current,O=!1,F=(m.flags&128)!==0,q;if((q=F)||(q=d!==null&&d.memoizedState===null?!1:(E&2)!==0),q?(O=!0,m.flags&=-129):(d===null||d.memoizedState!==null)&&(E|=1),Dn(ms,E&1),d===null)return dB(m),d=m.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?(m.mode&1?d.data==="$!"?m.lanes=8:m.lanes=1073741824:m.lanes=1,null):(F=S.children,d=S.fallback,O?(S=m.mode,O=m.child,F={mode:"hidden",children:F},!(S&1)&&O!==null?(O.childLanes=0,O.pendingProps=F):O=SP(F,S,0,null),d=y1(d,S,v,null),O.return=m,d.return=m,O.sibling=d,m.child=O,m.child.memoizedState=UB(v),m.memoizedState=kB,d):zB(m,F));if(E=d.memoizedState,E!==null&&(q=E.dehydrated,q!==null))return WDe(d,m,F,S,q,E,v);if(O){O=S.fallback,F=m.mode,E=d.child,q=E.sibling;var ee={mode:"hidden",children:S.children};return!(F&1)&&m.child!==E?(S=m.child,S.childLanes=0,S.pendingProps=ee,m.deletions=null):(S=m0(E,ee),S.subtreeFlags=E.subtreeFlags&14680064),q!==null?O=m0(q,O):(O=y1(O,F,v,null),O.flags|=2),O.return=m,S.return=m,S.sibling=O,m.child=S,S=O,O=m.child,F=d.child.memoizedState,F=F===null?UB(v):{baseLanes:F.baseLanes|v,cachePool:null,transitions:F.transitions},O.memoizedState=F,O.childLanes=d.childLanes&~v,m.memoizedState=kB,S}return O=d.child,d=O.sibling,S=m0(O,{mode:"visible",children:S.children}),!(m.mode&1)&&(S.lanes=v),S.return=m,S.sibling=null,d!==null&&(v=m.deletions,v===null?(m.deletions=[d],m.flags|=16):v.push(d)),m.child=S,m.memoizedState=null,S}function zB(d,m){return m=SP({mode:"visible",children:m},d.mode,0,null),m.return=d,d.child=m}function uP(d,m,v,S){return S!==null&&pB(S),eS(m,d.child,null,v),d=zB(m,m.pendingProps.children),d.flags|=2,m.memoizedState=null,d}function WDe(d,m,v,S,E,O,F){if(v)return m.flags&256?(m.flags&=-257,S=LB(Error(i(422))),uP(d,m,F,S)):m.memoizedState!==null?(m.child=d.child,m.flags|=128,null):(O=S.fallback,E=m.mode,S=SP({mode:"visible",children:S.children},E,0,null),O=y1(O,E,F,null),O.flags|=2,S.return=m,O.return=m,S.sibling=O,m.child=S,m.mode&1&&eS(m,d.child,null,F),m.child.memoizedState=UB(F),m.memoizedState=kB,O);if(!(m.mode&1))return uP(d,m,F,null);if(E.data==="$!"){if(S=E.nextSibling&&E.nextSibling.dataset,S)var q=S.dgst;return S=q,O=Error(i(419)),S=LB(O,S,void 0),uP(d,m,F,S)}if(q=(F&d.childLanes)!==0,oc||q){if(S=Yo,S!==null){switch(F&-F){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=E&(S.suspendedLanes|F)?0:E,E!==0&&E!==O.retryLane&&(O.retryLane=E,Gm(d,E),Pd(S,d,E,-1))}return i6(),S=LB(Error(i(421))),uP(d,m,F,S)}return E.data==="$?"?(m.flags|=128,m.child=d.child,m=oNe.bind(null,d),E._reactRetry=m,null):(d=O.treeContext,iu=n0(E.nextSibling),tu=m,ss=!0,Od=null,d!==null&&(Qu[Ku++]=Bm,Qu[Ku++]=jm,Qu[Ku++]=l1,Bm=d.id,jm=d.overflow,l1=m),m=zB(m,S.children),m.flags|=4096,m)}function Hne(d,m,v){d.lanes|=m;var S=d.alternate;S!==null&&(S.lanes|=m),yB(d.return,m,v)}function VB(d,m,v,S,E){var O=d.memoizedState;O===null?d.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:S,tail:v,tailMode:E}:(O.isBackwards=m,O.rendering=null,O.renderingStartTime=0,O.last=S,O.tail=v,O.tailMode=E)}function qne(d,m,v){var S=m.pendingProps,E=S.revealOrder,O=S.tail;if(Tl(d,m,S.children,v),S=ms.current,S&2)S=S&1|2,m.flags|=128;else{if(d!==null&&d.flags&128)e:for(d=m.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Hne(d,v,m);else if(d.tag===19)Hne(d,v,m);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===m)break e;for(;d.sibling===null;){if(d.return===null||d.return===m)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}S&=1}if(Dn(ms,S),!(m.mode&1))m.memoizedState=null;else switch(E){case"forwards":for(v=m.child,E=null;v!==null;)d=v.alternate,d!==null&&rP(d)===null&&(E=v),v=v.sibling;v=E,v===null?(E=m.child,m.child=null):(E=v.sibling,v.sibling=null),VB(m,!1,E,v,O);break;case"backwards":for(v=null,E=m.child,m.child=null;E!==null;){if(d=E.alternate,d!==null&&rP(d)===null){m.child=E;break}d=E.sibling,E.sibling=v,v=E,E=d}VB(m,!0,v,null,O);break;case"together":VB(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function hP(d,m){!(m.mode&1)&&d!==null&&(d.alternate=null,m.alternate=null,m.flags|=2)}function qm(d,m,v){if(d!==null&&(m.dependencies=d.dependencies),p1|=m.lanes,!(v&m.childLanes))return null;if(d!==null&&m.child!==d.child)throw Error(i(153));if(m.child!==null){for(d=m.child,v=m0(d,d.pendingProps),m.child=v,v.return=m;d.sibling!==null;)d=d.sibling,v=v.sibling=m0(d,d.pendingProps),v.return=m;v.sibling=null}return m.child}function ZDe(d,m,v){switch(m.tag){case 3:Bne(m),Kx();break;case 5:one(m);break;case 1:sc(m.type)&&WI(m);break;case 4:wB(m,m.stateNode.containerInfo);break;case 10:var S=m.type._context,E=m.memoizedProps.value;Dn(KI,S._currentValue),S._currentValue=E;break;case 13:if(S=m.memoizedState,S!==null)return S.dehydrated!==null?(Dn(ms,ms.current&1),m.flags|=128,null):v&m.child.childLanes?Gne(d,m,v):(Dn(ms,ms.current&1),d=qm(d,m,v),d!==null?d.sibling:null);Dn(ms,ms.current&1);break;case 19:if(S=(v&m.childLanes)!==0,d.flags&128){if(S)return qne(d,m,v);m.flags|=128}if(E=m.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Dn(ms,ms.current),S)break;return null;case 22:case 23:return m.lanes=0,Une(d,m,v)}return qm(d,m,v)}var Wne,BB,Zne,Yne;Wne=function(d,m){for(var v=m.child;v!==null;){if(v.tag===5||v.tag===6)d.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===m)break;for(;v.sibling===null;){if(v.return===null||v.return===m)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},BB=function(){},Zne=function(d,m,v,S){var E=d.memoizedProps;if(E!==S){d=m.stateNode,h1(hf.current);var O=null;switch(v){case"input":E=zi(d,E),S=zi(d,S),O=[];break;case"select":E=ce({},E,{value:void 0}),S=ce({},S,{value:void 0}),O=[];break;case"textarea":E=Et(d,E),S=Et(d,S),O=[];break;default:typeof E.onClick!="function"&&typeof S.onClick=="function"&&(d.onclick=GI)}ui(v,S);var F;v=null;for(be in E)if(!S.hasOwnProperty(be)&&E.hasOwnProperty(be)&&E[be]!=null)if(be==="style"){var q=E[be];for(F in q)q.hasOwnProperty(F)&&(v||(v={}),v[F]="")}else be!=="dangerouslySetInnerHTML"&&be!=="children"&&be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&be!=="autoFocus"&&(n.hasOwnProperty(be)?O||(O=[]):(O=O||[]).push(be,null));for(be in S){var ee=S[be];if(q=E!=null?E[be]:void 0,S.hasOwnProperty(be)&&ee!==q&&(ee!=null||q!=null))if(be==="style")if(q){for(F in q)!q.hasOwnProperty(F)||ee&&ee.hasOwnProperty(F)||(v||(v={}),v[F]="");for(F in ee)ee.hasOwnProperty(F)&&q[F]!==ee[F]&&(v||(v={}),v[F]=ee[F])}else v||(O||(O=[]),O.push(be,v)),v=ee;else be==="dangerouslySetInnerHTML"?(ee=ee?ee.__html:void 0,q=q?q.__html:void 0,ee!=null&&q!==ee&&(O=O||[]).push(be,ee)):be==="children"?typeof ee!="string"&&typeof ee!="number"||(O=O||[]).push(be,""+ee):be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&(n.hasOwnProperty(be)?(ee!=null&&be==="onScroll"&&jn("scroll",d),O||q===ee||(O=[])):(O=O||[]).push(be,ee))}v&&(O=O||[]).push("style",v);var be=O;(m.updateQueue=be)&&(m.flags|=4)}},Yne=function(d,m,v,S){v!==S&&(m.flags|=4)};function BM(d,m){if(!ss)switch(d.tailMode){case"hidden":m=d.tail;for(var v=null;m!==null;)m.alternate!==null&&(v=m),m=m.sibling;v===null?d.tail=null:v.sibling=null;break;case"collapsed":v=d.tail;for(var S=null;v!==null;)v.alternate!==null&&(S=v),v=v.sibling;S===null?m||d.tail===null?d.tail=null:d.tail.sibling=null:S.sibling=null}}function Ka(d){var m=d.alternate!==null&&d.alternate.child===d.child,v=0,S=0;if(m)for(var E=d.child;E!==null;)v|=E.lanes|E.childLanes,S|=E.subtreeFlags&14680064,S|=E.flags&14680064,E.return=d,E=E.sibling;else for(E=d.child;E!==null;)v|=E.lanes|E.childLanes,S|=E.subtreeFlags,S|=E.flags,E.return=d,E=E.sibling;return d.subtreeFlags|=S,d.childLanes=v,m}function YDe(d,m,v){var S=m.pendingProps;switch(uB(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ka(m),null;case 1:return sc(m.type)&&qI(),Ka(m),null;case 3:return S=m.stateNode,rS(),Gn(nc),Gn(Ja),SB(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(d===null||d.child===null)&&(JI(m)?m.flags|=4:d===null||d.memoizedState.isDehydrated&&!(m.flags&256)||(m.flags|=1024,Od!==null&&(KB(Od),Od=null))),BB(d,m),Ka(m),null;case 5:bB(m);var E=h1(FM.current);if(v=m.type,d!==null&&m.stateNode!=null)Zne(d,m,v,S,E),d.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!S){if(m.stateNode===null)throw Error(i(166));return Ka(m),null}if(d=h1(hf.current),JI(m)){S=m.stateNode,v=m.type;var O=m.memoizedProps;switch(S[uf]=m,S[IM]=O,d=(m.mode&1)!==0,v){case"dialog":jn("cancel",S),jn("close",S);break;case"iframe":case"object":case"embed":jn("load",S);break;case"video":case"audio":for(E=0;E<OM.length;E++)jn(OM[E],S);break;case"source":jn("error",S);break;case"img":case"image":case"link":jn("error",S),jn("load",S);break;case"details":jn("toggle",S);break;case"input":He(S,O),jn("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!O.multiple},jn("invalid",S);break;case"textarea":De(S,O),jn("invalid",S)}ui(v,O),E=null;for(var F in O)if(O.hasOwnProperty(F)){var q=O[F];F==="children"?typeof q=="string"?S.textContent!==q&&(O.suppressHydrationWarning!==!0&&jI(S.textContent,q,d),E=["children",q]):typeof q=="number"&&S.textContent!==""+q&&(O.suppressHydrationWarning!==!0&&jI(S.textContent,q,d),E=["children",""+q]):n.hasOwnProperty(F)&&q!=null&&F==="onScroll"&&jn("scroll",S)}switch(v){case"input":Xt(S),tt(S,O,!0);break;case"textarea":Xt(S),It(S);break;case"select":case"option":break;default:typeof O.onClick=="function"&&(S.onclick=GI)}S=E,m.updateQueue=S,S!==null&&(m.flags|=4)}else{F=E.nodeType===9?E:E.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Ki(v)),d==="http://www.w3.org/1999/xhtml"?v==="script"?(d=F.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof S.is=="string"?d=F.createElement(v,{is:S.is}):(d=F.createElement(v),v==="select"&&(F=d,S.multiple?F.multiple=!0:S.size&&(F.size=S.size))):d=F.createElementNS(d,v),d[uf]=m,d[IM]=S,Wne(d,m,!1,!1),m.stateNode=d;e:{switch(F=_i(v,S),v){case"dialog":jn("cancel",d),jn("close",d),E=S;break;case"iframe":case"object":case"embed":jn("load",d),E=S;break;case"video":case"audio":for(E=0;E<OM.length;E++)jn(OM[E],d);E=S;break;case"source":jn("error",d),E=S;break;case"img":case"image":case"link":jn("error",d),jn("load",d),E=S;break;case"details":jn("toggle",d),E=S;break;case"input":He(d,S),E=zi(d,S),jn("invalid",d);break;case"option":E=S;break;case"select":d._wrapperState={wasMultiple:!!S.multiple},E=ce({},S,{value:void 0}),jn("invalid",d);break;case"textarea":De(d,S),E=Et(d,S),jn("invalid",d);break;default:E=S}ui(v,E),q=E;for(O in q)if(q.hasOwnProperty(O)){var ee=q[O];O==="style"?tr(d,ee):O==="dangerouslySetInnerHTML"?(ee=ee?ee.__html:void 0,ee!=null&&Li(d,ee)):O==="children"?typeof ee=="string"?(v!=="textarea"||ee!=="")&&Ai(d,ee):typeof ee=="number"&&Ai(d,""+ee):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(n.hasOwnProperty(O)?ee!=null&&O==="onScroll"&&jn("scroll",d):ee!=null&&$(d,O,ee,F))}switch(v){case"input":Xt(d),tt(d,S,!1);break;case"textarea":Xt(d),It(d);break;case"option":S.value!=null&&d.setAttribute("value",""+Re(S.value));break;case"select":d.multiple=!!S.multiple,O=S.value,O!=null?Je(d,!!S.multiple,O,!1):S.defaultValue!=null&&Je(d,!!S.multiple,S.defaultValue,!0);break;default:typeof E.onClick=="function"&&(d.onclick=GI)}switch(v){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return Ka(m),null;case 6:if(d&&m.stateNode!=null)Yne(d,m,d.memoizedProps,S);else{if(typeof S!="string"&&m.stateNode===null)throw Error(i(166));if(v=h1(FM.current),h1(hf.current),JI(m)){if(S=m.stateNode,v=m.memoizedProps,S[uf]=m,(O=S.nodeValue!==v)&&(d=tu,d!==null))switch(d.tag){case 3:jI(S.nodeValue,v,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&jI(S.nodeValue,v,(d.mode&1)!==0)}O&&(m.flags|=4)}else S=(v.nodeType===9?v:v.ownerDocument).createTextNode(S),S[uf]=m,m.stateNode=S}return Ka(m),null;case 13:if(Gn(ms),S=m.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(ss&&iu!==null&&m.mode&1&&!(m.flags&128))Qre(),Kx(),m.flags|=98560,O=!1;else if(O=JI(m),S!==null&&S.dehydrated!==null){if(d===null){if(!O)throw Error(i(318));if(O=m.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(i(317));O[uf]=m}else Kx(),!(m.flags&128)&&(m.memoizedState=null),m.flags|=4;Ka(m),O=!1}else Od!==null&&(KB(Od),Od=null),O=!0;if(!O)return m.flags&65536?m:null}return m.flags&128?(m.lanes=v,m):(S=S!==null,S!==(d!==null&&d.memoizedState!==null)&&S&&(m.child.flags|=8192,m.mode&1&&(d===null||ms.current&1?So===0&&(So=3):i6())),m.updateQueue!==null&&(m.flags|=4),Ka(m),null);case 4:return rS(),BB(d,m),d===null&&AM(m.stateNode.containerInfo),Ka(m),null;case 10:return gB(m.type._context),Ka(m),null;case 17:return sc(m.type)&&qI(),Ka(m),null;case 19:if(Gn(ms),O=m.memoizedState,O===null)return Ka(m),null;if(S=(m.flags&128)!==0,F=O.rendering,F===null)if(S)BM(O,!1);else{if(So!==0||d!==null&&d.flags&128)for(d=m.child;d!==null;){if(F=rP(d),F!==null){for(m.flags|=128,BM(O,!1),S=F.updateQueue,S!==null&&(m.updateQueue=S,m.flags|=4),m.subtreeFlags=0,S=v,v=m.child;v!==null;)O=v,d=S,O.flags&=14680066,F=O.alternate,F===null?(O.childLanes=0,O.lanes=d,O.child=null,O.subtreeFlags=0,O.memoizedProps=null,O.memoizedState=null,O.updateQueue=null,O.dependencies=null,O.stateNode=null):(O.childLanes=F.childLanes,O.lanes=F.lanes,O.child=F.child,O.subtreeFlags=0,O.deletions=null,O.memoizedProps=F.memoizedProps,O.memoizedState=F.memoizedState,O.updateQueue=F.updateQueue,O.type=F.type,d=F.dependencies,O.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),v=v.sibling;return Dn(ms,ms.current&1|2),m.child}d=d.sibling}O.tail!==null&&Rr()>aS&&(m.flags|=128,S=!0,BM(O,!1),m.lanes=4194304)}else{if(!S)if(d=rP(F),d!==null){if(m.flags|=128,S=!0,v=d.updateQueue,v!==null&&(m.updateQueue=v,m.flags|=4),BM(O,!0),O.tail===null&&O.tailMode==="hidden"&&!F.alternate&&!ss)return Ka(m),null}else 2*Rr()-O.renderingStartTime>aS&&v!==1073741824&&(m.flags|=128,S=!0,BM(O,!1),m.lanes=4194304);O.isBackwards?(F.sibling=m.child,m.child=F):(v=O.last,v!==null?v.sibling=F:m.child=F,O.last=F)}return O.tail!==null?(m=O.tail,O.rendering=m,O.tail=m.sibling,O.renderingStartTime=Rr(),m.sibling=null,v=ms.current,Dn(ms,S?v&1|2:v&1),m):(Ka(m),null);case 22:case 23:return t6(),S=m.memoizedState!==null,d!==null&&d.memoizedState!==null!==S&&(m.flags|=8192),S&&m.mode&1?ru&1073741824&&(Ka(m),m.subtreeFlags&6&&(m.flags|=8192)):Ka(m),null;case 24:return null;case 25:return null}throw Error(i(156,m.tag))}function XDe(d,m){switch(uB(m),m.tag){case 1:return sc(m.type)&&qI(),d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 3:return rS(),Gn(nc),Gn(Ja),SB(),d=m.flags,d&65536&&!(d&128)?(m.flags=d&-65537|128,m):null;case 5:return bB(m),null;case 13:if(Gn(ms),d=m.memoizedState,d!==null&&d.dehydrated!==null){if(m.alternate===null)throw Error(i(340));Kx()}return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 19:return Gn(ms),null;case 4:return rS(),null;case 10:return gB(m.type._context),null;case 22:case 23:return t6(),null;case 24:return null;default:return null}}var dP=!1,el=!1,JDe=typeof WeakSet=="function"?WeakSet:Set,At=null;function sS(d,m){var v=d.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(S){Os(d,m,S)}else v.current=null}function jB(d,m,v){try{v()}catch(S){Os(d,m,S)}}var Xne=!1;function QDe(d,m){if(tB=II,d=$re(),WV(d)){if("selectionStart"in d)var v={start:d.selectionStart,end:d.selectionEnd};else e:{v=(v=d.ownerDocument)&&v.defaultView||window;var S=v.getSelection&&v.getSelection();if(S&&S.rangeCount!==0){v=S.anchorNode;var E=S.anchorOffset,O=S.focusNode;S=S.focusOffset;try{v.nodeType,O.nodeType}catch{v=null;break e}var F=0,q=-1,ee=-1,be=0,Ve=0,We=d,Ue=null;t:for(;;){for(var bt;We!==v||E!==0&&We.nodeType!==3||(q=F+E),We!==O||S!==0&&We.nodeType!==3||(ee=F+S),We.nodeType===3&&(F+=We.nodeValue.length),(bt=We.firstChild)!==null;)Ue=We,We=bt;for(;;){if(We===d)break t;if(Ue===v&&++be===E&&(q=F),Ue===O&&++Ve===S&&(ee=F),(bt=We.nextSibling)!==null)break;We=Ue,Ue=We.parentNode}We=bt}v=q===-1||ee===-1?null:{start:q,end:ee}}else v=null}v=v||{start:0,end:0}}else v=null;for(iB={focusedElem:d,selectionRange:v},II=!1,At=m;At!==null;)if(m=At,d=m.child,(m.subtreeFlags&1028)!==0&&d!==null)d.return=m,At=d;else for(;At!==null;){m=At;try{var Dt=m.alternate;if(m.flags&1024)switch(m.tag){case 0:case 11:case 15:break;case 1:if(Dt!==null){var Ft=Dt.memoizedProps,Gs=Dt.memoizedState,me=m.stateNode,re=me.getSnapshotBeforeUpdate(m.elementType===m.type?Ft:Ad(m.type,Ft),Gs);me.__reactInternalSnapshotBeforeUpdate=re}break;case 3:var _e=m.stateNode.containerInfo;_e.nodeType===1?_e.textContent="":_e.nodeType===9&&_e.documentElement&&_e.removeChild(_e.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(it){Os(m,m.return,it)}if(d=m.sibling,d!==null){d.return=m.return,At=d;break}At=m.return}return Dt=Xne,Xne=!1,Dt}function jM(d,m,v){var S=m.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var E=S=S.next;do{if((E.tag&d)===d){var O=E.destroy;E.destroy=void 0,O!==void 0&&jB(m,v,O)}E=E.next}while(E!==S)}}function pP(d,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&d)===d){var S=v.create;v.destroy=S()}v=v.next}while(v!==m)}}function GB(d){var m=d.ref;if(m!==null){var v=d.stateNode;switch(d.tag){case 5:d=v;break;default:d=v}typeof m=="function"?m(d):m.current=d}}function Jne(d){var m=d.alternate;m!==null&&(d.alternate=null,Jne(m)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(m=d.stateNode,m!==null&&(delete m[uf],delete m[IM],delete m[oB],delete m[LDe],delete m[DDe])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function Qne(d){return d.tag===5||d.tag===3||d.tag===4}function Kne(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||Qne(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function HB(d,m,v){var S=d.tag;if(S===5||S===6)d=d.stateNode,m?v.nodeType===8?v.parentNode.insertBefore(d,m):v.insertBefore(d,m):(v.nodeType===8?(m=v.parentNode,m.insertBefore(d,v)):(m=v,m.appendChild(d)),v=v._reactRootContainer,v!=null||m.onclick!==null||(m.onclick=GI));else if(S!==4&&(d=d.child,d!==null))for(HB(d,m,v),d=d.sibling;d!==null;)HB(d,m,v),d=d.sibling}function qB(d,m,v){var S=d.tag;if(S===5||S===6)d=d.stateNode,m?v.insertBefore(d,m):v.appendChild(d);else if(S!==4&&(d=d.child,d!==null))for(qB(d,m,v),d=d.sibling;d!==null;)qB(d,m,v),d=d.sibling}var Ta=null,Rd=!1;function u0(d,m,v){for(v=v.child;v!==null;)ese(d,m,v),v=v.sibling}function ese(d,m,v){if(Wo&&typeof Wo.onCommitFiberUnmount=="function")try{Wo.onCommitFiberUnmount(Ms,v)}catch{}switch(v.tag){case 5:el||sS(v,m);case 6:var S=Ta,E=Rd;Ta=null,u0(d,m,v),Ta=S,Rd=E,Ta!==null&&(Rd?(d=Ta,v=v.stateNode,d.nodeType===8?d.parentNode.removeChild(v):d.removeChild(v)):Ta.removeChild(v.stateNode));break;case 18:Ta!==null&&(Rd?(d=Ta,v=v.stateNode,d.nodeType===8?sB(d.parentNode,v):d.nodeType===1&&sB(d,v),bM(d)):sB(Ta,v.stateNode));break;case 4:S=Ta,E=Rd,Ta=v.stateNode.containerInfo,Rd=!0,u0(d,m,v),Ta=S,Rd=E;break;case 0:case 11:case 14:case 15:if(!el&&(S=v.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){E=S=S.next;do{var O=E,F=O.destroy;O=O.tag,F!==void 0&&(O&2||O&4)&&jB(v,m,F),E=E.next}while(E!==S)}u0(d,m,v);break;case 1:if(!el&&(sS(v,m),S=v.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=v.memoizedProps,S.state=v.memoizedState,S.componentWillUnmount()}catch(q){Os(v,m,q)}u0(d,m,v);break;case 21:u0(d,m,v);break;case 22:v.mode&1?(el=(S=el)||v.memoizedState!==null,u0(d,m,v),el=S):u0(d,m,v);break;default:u0(d,m,v)}}function tse(d){var m=d.updateQueue;if(m!==null){d.updateQueue=null;var v=d.stateNode;v===null&&(v=d.stateNode=new JDe),m.forEach(function(S){var E=aNe.bind(null,d,S);v.has(S)||(v.add(S),S.then(E,E))})}}function Id(d,m){var v=m.deletions;if(v!==null)for(var S=0;S<v.length;S++){var E=v[S];try{var O=d,F=m,q=F;e:for(;q!==null;){switch(q.tag){case 5:Ta=q.stateNode,Rd=!1;break e;case 3:Ta=q.stateNode.containerInfo,Rd=!0;break e;case 4:Ta=q.stateNode.containerInfo,Rd=!0;break e}q=q.return}if(Ta===null)throw Error(i(160));ese(O,F,E),Ta=null,Rd=!1;var ee=E.alternate;ee!==null&&(ee.return=null),E.return=null}catch(be){Os(E,m,be)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)ise(m,d),m=m.sibling}function ise(d,m){var v=d.alternate,S=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Id(m,d),pf(d),S&4){try{jM(3,d,d.return),pP(3,d)}catch(Ft){Os(d,d.return,Ft)}try{jM(5,d,d.return)}catch(Ft){Os(d,d.return,Ft)}}break;case 1:Id(m,d),pf(d),S&512&&v!==null&&sS(v,v.return);break;case 5:if(Id(m,d),pf(d),S&512&&v!==null&&sS(v,v.return),d.flags&32){var E=d.stateNode;try{Ai(E,"")}catch(Ft){Os(d,d.return,Ft)}}if(S&4&&(E=d.stateNode,E!=null)){var O=d.memoizedProps,F=v!==null?v.memoizedProps:O,q=d.type,ee=d.updateQueue;if(d.updateQueue=null,ee!==null)try{q==="input"&&O.type==="radio"&&O.name!=null&&Oi(E,O),_i(q,F);var be=_i(q,O);for(F=0;F<ee.length;F+=2){var Ve=ee[F],We=ee[F+1];Ve==="style"?tr(E,We):Ve==="dangerouslySetInnerHTML"?Li(E,We):Ve==="children"?Ai(E,We):$(E,Ve,We,be)}switch(q){case"input":Be(E,O);break;case"textarea":at(E,O);break;case"select":var Ue=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!O.multiple;var bt=O.value;bt!=null?Je(E,!!O.multiple,bt,!1):Ue!==!!O.multiple&&(O.defaultValue!=null?Je(E,!!O.multiple,O.defaultValue,!0):Je(E,!!O.multiple,O.multiple?[]:"",!1))}E[IM]=O}catch(Ft){Os(d,d.return,Ft)}}break;case 6:if(Id(m,d),pf(d),S&4){if(d.stateNode===null)throw Error(i(162));E=d.stateNode,O=d.memoizedProps;try{E.nodeValue=O}catch(Ft){Os(d,d.return,Ft)}}break;case 3:if(Id(m,d),pf(d),S&4&&v!==null&&v.memoizedState.isDehydrated)try{bM(m.containerInfo)}catch(Ft){Os(d,d.return,Ft)}break;case 4:Id(m,d),pf(d);break;case 13:Id(m,d),pf(d),E=d.child,E.flags&8192&&(O=E.memoizedState!==null,E.stateNode.isHidden=O,!O||E.alternate!==null&&E.alternate.memoizedState!==null||(YB=Rr())),S&4&&tse(d);break;case 22:if(Ve=v!==null&&v.memoizedState!==null,d.mode&1?(el=(be=el)||Ve,Id(m,d),el=be):Id(m,d),pf(d),S&8192){if(be=d.memoizedState!==null,(d.stateNode.isHidden=be)&&!Ve&&d.mode&1)for(At=d,Ve=d.child;Ve!==null;){for(We=At=Ve;At!==null;){switch(Ue=At,bt=Ue.child,Ue.tag){case 0:case 11:case 14:case 15:jM(4,Ue,Ue.return);break;case 1:sS(Ue,Ue.return);var Dt=Ue.stateNode;if(typeof Dt.componentWillUnmount=="function"){S=Ue,v=Ue.return;try{m=S,Dt.props=m.memoizedProps,Dt.state=m.memoizedState,Dt.componentWillUnmount()}catch(Ft){Os(S,v,Ft)}}break;case 5:sS(Ue,Ue.return);break;case 22:if(Ue.memoizedState!==null){sse(We);continue}}bt!==null?(bt.return=Ue,At=bt):sse(We)}Ve=Ve.sibling}e:for(Ve=null,We=d;;){if(We.tag===5){if(Ve===null){Ve=We;try{E=We.stateNode,be?(O=E.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none"):(q=We.stateNode,ee=We.memoizedProps.style,F=ee!=null&&ee.hasOwnProperty("display")?ee.display:null,q.style.display=Ei("display",F))}catch(Ft){Os(d,d.return,Ft)}}}else if(We.tag===6){if(Ve===null)try{We.stateNode.nodeValue=be?"":We.memoizedProps}catch(Ft){Os(d,d.return,Ft)}}else if((We.tag!==22&&We.tag!==23||We.memoizedState===null||We===d)&&We.child!==null){We.child.return=We,We=We.child;continue}if(We===d)break e;for(;We.sibling===null;){if(We.return===null||We.return===d)break e;Ve===We&&(Ve=null),We=We.return}Ve===We&&(Ve=null),We.sibling.return=We.return,We=We.sibling}}break;case 19:Id(m,d),pf(d),S&4&&tse(d);break;case 21:break;default:Id(m,d),pf(d)}}function pf(d){var m=d.flags;if(m&2){try{e:{for(var v=d.return;v!==null;){if(Qne(v)){var S=v;break e}v=v.return}throw Error(i(160))}switch(S.tag){case 5:var E=S.stateNode;S.flags&32&&(Ai(E,""),S.flags&=-33);var O=Kne(d);qB(d,O,E);break;case 3:case 4:var F=S.stateNode.containerInfo,q=Kne(d);HB(d,q,F);break;default:throw Error(i(161))}}catch(ee){Os(d,d.return,ee)}d.flags&=-3}m&4096&&(d.flags&=-4097)}function KDe(d,m,v){At=d,rse(d)}function rse(d,m,v){for(var S=(d.mode&1)!==0;At!==null;){var E=At,O=E.child;if(E.tag===22&&S){var F=E.memoizedState!==null||dP;if(!F){var q=E.alternate,ee=q!==null&&q.memoizedState!==null||el;q=dP;var be=el;if(dP=F,(el=ee)&&!be)for(At=E;At!==null;)F=At,ee=F.child,F.tag===22&&F.memoizedState!==null?ose(E):ee!==null?(ee.return=F,At=ee):ose(E);for(;O!==null;)At=O,rse(O),O=O.sibling;At=E,dP=q,el=be}nse(d)}else E.subtreeFlags&8772&&O!==null?(O.return=E,At=O):nse(d)}}function nse(d){for(;At!==null;){var m=At;if(m.flags&8772){var v=m.alternate;try{if(m.flags&8772)switch(m.tag){case 0:case 11:case 15:el||pP(5,m);break;case 1:var S=m.stateNode;if(m.flags&4&&!el)if(v===null)S.componentDidMount();else{var E=m.elementType===m.type?v.memoizedProps:Ad(m.type,v.memoizedProps);S.componentDidUpdate(E,v.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var O=m.updateQueue;O!==null&&sne(m,O,S);break;case 3:var F=m.updateQueue;if(F!==null){if(v=null,m.child!==null)switch(m.child.tag){case 5:v=m.child.stateNode;break;case 1:v=m.child.stateNode}sne(m,F,v)}break;case 5:var q=m.stateNode;if(v===null&&m.flags&4){v=q;var ee=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":ee.autoFocus&&v.focus();break;case"img":ee.src&&(v.src=ee.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var be=m.alternate;if(be!==null){var Ve=be.memoizedState;if(Ve!==null){var We=Ve.dehydrated;We!==null&&bM(We)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}el||m.flags&512&&GB(m)}catch(Ue){Os(m,m.return,Ue)}}if(m===d){At=null;break}if(v=m.sibling,v!==null){v.return=m.return,At=v;break}At=m.return}}function sse(d){for(;At!==null;){var m=At;if(m===d){At=null;break}var v=m.sibling;if(v!==null){v.return=m.return,At=v;break}At=m.return}}function ose(d){for(;At!==null;){var m=At;try{switch(m.tag){case 0:case 11:case 15:var v=m.return;try{pP(4,m)}catch(ee){Os(m,v,ee)}break;case 1:var S=m.stateNode;if(typeof S.componentDidMount=="function"){var E=m.return;try{S.componentDidMount()}catch(ee){Os(m,E,ee)}}var O=m.return;try{GB(m)}catch(ee){Os(m,O,ee)}break;case 5:var F=m.return;try{GB(m)}catch(ee){Os(m,F,ee)}}}catch(ee){Os(m,m.return,ee)}if(m===d){At=null;break}var q=m.sibling;if(q!==null){q.return=m.return,At=q;break}At=m.return}}var eNe=Math.ceil,fP=R.ReactCurrentDispatcher,WB=R.ReactCurrentOwner,ih=R.ReactCurrentBatchConfig,Ur=0,Yo=null,ro=null,Ea=0,ru=0,oS=s0(0),So=0,GM=null,p1=0,mP=0,ZB=0,HM=null,ac=null,YB=0,aS=1/0,Wm=null,gP=!1,XB=null,h0=null,yP=!1,d0=null,_P=0,qM=0,JB=null,vP=-1,wP=0;function El(){return Ur&6?Rr():vP!==-1?vP:vP=Rr()}function p0(d){return d.mode&1?Ur&2&&Ea!==0?Ea&-Ea:FDe.transition!==null?(wP===0&&(wP=mM()),wP):(d=gn,d!==0||(d=window.event,d=d===void 0?16:lre(d.type)),d):1}function Pd(d,m,v,S){if(50<qM)throw qM=0,JB=null,Error(i(185));Jy(d,v,S),(!(Ur&2)||d!==Yo)&&(d===Yo&&(!(Ur&2)&&(mP|=v),So===4&&f0(d,Ea)),lc(d,S),v===1&&Ur===0&&!(m.mode&1)&&(aS=Rr()+500,ZI&&a0()))}function lc(d,m){var v=d.callbackNode;OI(d,m);var S=$s(d,d===Yo?Ea:0);if(S===0)v!==null&&Md(v),d.callbackNode=null,d.callbackPriority=0;else if(m=S&-S,d.callbackPriority!==m){if(v!=null&&Md(v),m===1)d.tag===0?NDe(lse.bind(null,d)):Wre(lse.bind(null,d)),IDe(function(){!(Ur&6)&&a0()}),v=null;else{switch(ere(S)){case 1:v=Cs;break;case 4:v=Qc;break;case 16:v=Kc;break;case 536870912:v=lf;break;default:v=Kc}v=gse(v,ase.bind(null,d))}d.callbackPriority=m,d.callbackNode=v}}function ase(d,m){if(vP=-1,wP=0,Ur&6)throw Error(i(327));var v=d.callbackNode;if(lS()&&d.callbackNode!==v)return null;var S=$s(d,d===Yo?Ea:0);if(S===0)return null;if(S&30||S&d.expiredLanes||m)m=bP(d,S);else{m=S;var E=Ur;Ur|=2;var O=use();(Yo!==d||Ea!==m)&&(Wm=null,aS=Rr()+500,m1(d,m));do try{rNe();break}catch(q){cse(d,q)}while(!0);mB(),fP.current=O,Ur=E,ro!==null?m=0:(Yo=null,Ea=0,m=So)}if(m!==0){if(m===2&&(E=s1(d),E!==0&&(S=E,m=QB(d,E))),m===1)throw v=GM,m1(d,0),f0(d,S),lc(d,Rr()),v;if(m===6)f0(d,S);else{if(E=d.current.alternate,!(S&30)&&!tNe(E)&&(m=bP(d,S),m===2&&(O=s1(d),O!==0&&(S=O,m=QB(d,O))),m===1))throw v=GM,m1(d,0),f0(d,S),lc(d,Rr()),v;switch(d.finishedWork=E,d.finishedLanes=S,m){case 0:case 1:throw Error(i(345));case 2:g1(d,ac,Wm);break;case 3:if(f0(d,S),(S&130023424)===S&&(m=YB+500-Rr(),10<m)){if($s(d,0)!==0)break;if(E=d.suspendedLanes,(E&S)!==S){El(),d.pingedLanes|=d.suspendedLanes&E;break}d.timeoutHandle=nB(g1.bind(null,d,ac,Wm),m);break}g1(d,ac,Wm);break;case 4:if(f0(d,S),(S&4194240)===S)break;for(m=d.eventTimes,E=-1;0<S;){var F=31-H(S);O=1<<F,F=m[F],F>E&&(E=F),S&=~O}if(S=E,S=Rr()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*eNe(S/1960))-S,10<S){d.timeoutHandle=nB(g1.bind(null,d,ac,Wm),S);break}g1(d,ac,Wm);break;case 5:g1(d,ac,Wm);break;default:throw Error(i(329))}}}return lc(d,Rr()),d.callbackNode===v?ase.bind(null,d):null}function QB(d,m){var v=HM;return d.current.memoizedState.isDehydrated&&(m1(d,m).flags|=256),d=bP(d,m),d!==2&&(m=ac,ac=v,m!==null&&KB(m)),d}function KB(d){ac===null?ac=d:ac.push.apply(ac,d)}function tNe(d){for(var m=d;;){if(m.flags&16384){var v=m.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var S=0;S<v.length;S++){var E=v[S],O=E.getSnapshot;E=E.value;try{if(!$d(O(),E))return!1}catch{return!1}}}if(v=m.child,m.subtreeFlags&16384&&v!==null)v.return=m,m=v;else{if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function f0(d,m){for(m&=~ZB,m&=~mP,d.suspendedLanes|=m,d.pingedLanes&=~m,d=d.expirationTimes;0<m;){var v=31-H(m),S=1<<v;d[v]=-1,m&=~S}}function lse(d){if(Ur&6)throw Error(i(327));lS();var m=$s(d,0);if(!(m&1))return lc(d,Rr()),null;var v=bP(d,m);if(d.tag!==0&&v===2){var S=s1(d);S!==0&&(m=S,v=QB(d,S))}if(v===1)throw v=GM,m1(d,0),f0(d,m),lc(d,Rr()),v;if(v===6)throw Error(i(345));return d.finishedWork=d.current.alternate,d.finishedLanes=m,g1(d,ac,Wm),lc(d,Rr()),null}function e6(d,m){var v=Ur;Ur|=1;try{return d(m)}finally{Ur=v,Ur===0&&(aS=Rr()+500,ZI&&a0())}}function f1(d){d0!==null&&d0.tag===0&&!(Ur&6)&&lS();var m=Ur;Ur|=1;var v=ih.transition,S=gn;try{if(ih.transition=null,gn=1,d)return d()}finally{gn=S,ih.transition=v,Ur=m,!(Ur&6)&&a0()}}function t6(){ru=oS.current,Gn(oS)}function m1(d,m){d.finishedWork=null,d.finishedLanes=0;var v=d.timeoutHandle;if(v!==-1&&(d.timeoutHandle=-1,RDe(v)),ro!==null)for(v=ro.return;v!==null;){var S=v;switch(uB(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&qI();break;case 3:rS(),Gn(nc),Gn(Ja),SB();break;case 5:bB(S);break;case 4:rS();break;case 13:Gn(ms);break;case 19:Gn(ms);break;case 10:gB(S.type._context);break;case 22:case 23:t6()}v=v.return}if(Yo=d,ro=d=m0(d.current,null),Ea=ru=m,So=0,GM=null,ZB=mP=p1=0,ac=HM=null,u1!==null){for(m=0;m<u1.length;m++)if(v=u1[m],S=v.interleaved,S!==null){v.interleaved=null;var E=S.next,O=v.pending;if(O!==null){var F=O.next;O.next=E,S.next=F}v.pending=S}u1=null}return d}function cse(d,m){do{var v=ro;try{if(mB(),nP.current=lP,sP){for(var S=gs.memoizedState;S!==null;){var E=S.queue;E!==null&&(E.pending=null),S=S.next}sP=!1}if(d1=0,Zo=xo=gs=null,kM=!1,UM=0,WB.current=null,v===null||v.return===null){So=1,GM=m,ro=null;break}e:{var O=d,F=v.return,q=v,ee=m;if(m=Ea,q.flags|=32768,ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var be=ee,Ve=q,We=Ve.tag;if(!(Ve.mode&1)&&(We===0||We===11||We===15)){var Ue=Ve.alternate;Ue?(Ve.updateQueue=Ue.updateQueue,Ve.memoizedState=Ue.memoizedState,Ve.lanes=Ue.lanes):(Ve.updateQueue=null,Ve.memoizedState=null)}var bt=Lne(F);if(bt!==null){bt.flags&=-257,Dne(bt,F,q,O,m),bt.mode&1&&Pne(O,be,m),m=bt,ee=be;var Dt=m.updateQueue;if(Dt===null){var Ft=new Set;Ft.add(ee),m.updateQueue=Ft}else Dt.add(ee);break e}else{if(!(m&1)){Pne(O,be,m),i6();break e}ee=Error(i(426))}}else if(ss&&q.mode&1){var Gs=Lne(F);if(Gs!==null){!(Gs.flags&65536)&&(Gs.flags|=256),Dne(Gs,F,q,O,m),pB(nS(ee,q));break e}}O=ee=nS(ee,q),So!==4&&(So=2),HM===null?HM=[O]:HM.push(O),O=F;do{switch(O.tag){case 3:O.flags|=65536,m&=-m,O.lanes|=m;var me=Rne(O,ee,m);nne(O,me);break e;case 1:q=ee;var re=O.type,_e=O.stateNode;if(!(O.flags&128)&&(typeof re.getDerivedStateFromError=="function"||_e!==null&&typeof _e.componentDidCatch=="function"&&(h0===null||!h0.has(_e)))){O.flags|=65536,m&=-m,O.lanes|=m;var it=Ine(O,q,m);nne(O,it);break e}}O=O.return}while(O!==null)}dse(v)}catch(Vt){m=Vt,ro===v&&v!==null&&(ro=v=v.return);continue}break}while(!0)}function use(){var d=fP.current;return fP.current=lP,d===null?lP:d}function i6(){(So===0||So===3||So===2)&&(So=4),Yo===null||!(p1&268435455)&&!(mP&268435455)||f0(Yo,Ea)}function bP(d,m){var v=Ur;Ur|=2;var S=use();(Yo!==d||Ea!==m)&&(Wm=null,m1(d,m));do try{iNe();break}catch(E){cse(d,E)}while(!0);if(mB(),Ur=v,fP.current=S,ro!==null)throw Error(i(261));return Yo=null,Ea=0,So}function iNe(){for(;ro!==null;)hse(ro)}function rNe(){for(;ro!==null&&!Ju();)hse(ro)}function hse(d){var m=mse(d.alternate,d,ru);d.memoizedProps=d.pendingProps,m===null?dse(d):ro=m,WB.current=null}function dse(d){var m=d;do{var v=m.alternate;if(d=m.return,m.flags&32768){if(v=XDe(v,m),v!==null){v.flags&=32767,ro=v;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{So=6,ro=null;return}}else if(v=YDe(v,m,ru),v!==null){ro=v;return}if(m=m.sibling,m!==null){ro=m;return}ro=m=d}while(m!==null);So===0&&(So=5)}function g1(d,m,v){var S=gn,E=ih.transition;try{ih.transition=null,gn=1,nNe(d,m,v,S)}finally{ih.transition=E,gn=S}return null}function nNe(d,m,v,S){do lS();while(d0!==null);if(Ur&6)throw Error(i(327));v=d.finishedWork;var E=d.finishedLanes;if(v===null)return null;if(d.finishedWork=null,d.finishedLanes=0,v===d.current)throw Error(i(177));d.callbackNode=null,d.callbackPriority=0;var O=v.lanes|v.childLanes;if(gM(d,O),d===Yo&&(ro=Yo=null,Ea=0),!(v.subtreeFlags&2064)&&!(v.flags&2064)||yP||(yP=!0,gse(Kc,function(){return lS(),null})),O=(v.flags&15990)!==0,v.subtreeFlags&15990||O){O=ih.transition,ih.transition=null;var F=gn;gn=1;var q=Ur;Ur|=4,WB.current=null,QDe(d,v),ise(v,d),TDe(iB),II=!!tB,iB=tB=null,d.current=v,KDe(v),Er(),Ur=q,gn=F,ih.transition=O}else d.current=v;if(yP&&(yP=!1,d0=d,_P=E),O=d.pendingLanes,O===0&&(h0=null),cf(v.stateNode),lc(d,Rr()),m!==null)for(S=d.onRecoverableError,v=0;v<m.length;v++)E=m[v],S(E.value,{componentStack:E.stack,digest:E.digest});if(gP)throw gP=!1,d=XB,XB=null,d;return _P&1&&d.tag!==0&&lS(),O=d.pendingLanes,O&1?d===JB?qM++:(qM=0,JB=d):qM=0,a0(),null}function lS(){if(d0!==null){var d=ere(_P),m=ih.transition,v=gn;try{if(ih.transition=null,gn=16>d?16:d,d0===null)var S=!1;else{if(d=d0,d0=null,_P=0,Ur&6)throw Error(i(331));var E=Ur;for(Ur|=4,At=d.current;At!==null;){var O=At,F=O.child;if(At.flags&16){var q=O.deletions;if(q!==null){for(var ee=0;ee<q.length;ee++){var be=q[ee];for(At=be;At!==null;){var Ve=At;switch(Ve.tag){case 0:case 11:case 15:jM(8,Ve,O)}var We=Ve.child;if(We!==null)We.return=Ve,At=We;else for(;At!==null;){Ve=At;var Ue=Ve.sibling,bt=Ve.return;if(Jne(Ve),Ve===be){At=null;break}if(Ue!==null){Ue.return=bt,At=Ue;break}At=bt}}}var Dt=O.alternate;if(Dt!==null){var Ft=Dt.child;if(Ft!==null){Dt.child=null;do{var Gs=Ft.sibling;Ft.sibling=null,Ft=Gs}while(Ft!==null)}}At=O}}if(O.subtreeFlags&2064&&F!==null)F.return=O,At=F;else e:for(;At!==null;){if(O=At,O.flags&2048)switch(O.tag){case 0:case 11:case 15:jM(9,O,O.return)}var me=O.sibling;if(me!==null){me.return=O.return,At=me;break e}At=O.return}}var re=d.current;for(At=re;At!==null;){F=At;var _e=F.child;if(F.subtreeFlags&2064&&_e!==null)_e.return=F,At=_e;else e:for(F=re;At!==null;){if(q=At,q.flags&2048)try{switch(q.tag){case 0:case 11:case 15:pP(9,q)}}catch(Vt){Os(q,q.return,Vt)}if(q===F){At=null;break e}var it=q.sibling;if(it!==null){it.return=q.return,At=it;break e}At=q.return}}if(Ur=E,a0(),Wo&&typeof Wo.onPostCommitFiberRoot=="function")try{Wo.onPostCommitFiberRoot(Ms,d)}catch{}S=!0}return S}finally{gn=v,ih.transition=m}}return!1}function pse(d,m,v){m=nS(v,m),m=Rne(d,m,1),d=c0(d,m,1),m=El(),d!==null&&(Jy(d,1,m),lc(d,m))}function Os(d,m,v){if(d.tag===3)pse(d,d,v);else for(;m!==null;){if(m.tag===3){pse(m,d,v);break}else if(m.tag===1){var S=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(h0===null||!h0.has(S))){d=nS(v,d),d=Ine(m,d,1),m=c0(m,d,1),d=El(),m!==null&&(Jy(m,1,d),lc(m,d));break}}m=m.return}}function sNe(d,m,v){var S=d.pingCache;S!==null&&S.delete(m),m=El(),d.pingedLanes|=d.suspendedLanes&v,Yo===d&&(Ea&v)===v&&(So===4||So===3&&(Ea&130023424)===Ea&&500>Rr()-YB?m1(d,0):ZB|=v),lc(d,m)}function fse(d,m){m===0&&(d.mode&1?(m=Cr,Cr<<=1,!(Cr&130023424)&&(Cr=4194304)):m=1);var v=El();d=Gm(d,m),d!==null&&(Jy(d,m,v),lc(d,v))}function oNe(d){var m=d.memoizedState,v=0;m!==null&&(v=m.retryLane),fse(d,v)}function aNe(d,m){var v=0;switch(d.tag){case 13:var S=d.stateNode,E=d.memoizedState;E!==null&&(v=E.retryLane);break;case 19:S=d.stateNode;break;default:throw Error(i(314))}S!==null&&S.delete(m),fse(d,v)}var mse;mse=function(d,m,v){if(d!==null)if(d.memoizedProps!==m.pendingProps||nc.current)oc=!0;else{if(!(d.lanes&v)&&!(m.flags&128))return oc=!1,ZDe(d,m,v);oc=!!(d.flags&131072)}else oc=!1,ss&&m.flags&1048576&&Zre(m,XI,m.index);switch(m.lanes=0,m.tag){case 2:var S=m.type;hP(d,m),d=m.pendingProps;var E=Xx(m,Ja.current);iS(m,v),E=CB(null,m,S,d,E,v);var O=MB();return m.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,sc(S)?(O=!0,WI(m)):O=!1,m.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,vB(m),E.updater=cP,m.stateNode=E,E._reactInternals=m,PB(m,S,d,v),m=FB(null,m,S,!0,O,v)):(m.tag=0,ss&&O&&cB(m),Tl(null,m,E,v),m=m.child),m;case 16:S=m.elementType;e:{switch(hP(d,m),d=m.pendingProps,E=S._init,S=E(S._payload),m.type=S,E=m.tag=cNe(S),d=Ad(S,d),E){case 0:m=NB(null,m,S,d,v);break e;case 1:m=Vne(null,m,S,d,v);break e;case 11:m=Nne(null,m,S,d,v);break e;case 14:m=Fne(null,m,S,Ad(S.type,d),v);break e}throw Error(i(306,S,""))}return m;case 0:return S=m.type,E=m.pendingProps,E=m.elementType===S?E:Ad(S,E),NB(d,m,S,E,v);case 1:return S=m.type,E=m.pendingProps,E=m.elementType===S?E:Ad(S,E),Vne(d,m,S,E,v);case 3:e:{if(Bne(m),d===null)throw Error(i(387));S=m.pendingProps,O=m.memoizedState,E=O.element,rne(d,m),iP(m,S,null,v);var F=m.memoizedState;if(S=F.element,O.isDehydrated)if(O={element:S,isDehydrated:!1,cache:F.cache,pendingSuspenseBoundaries:F.pendingSuspenseBoundaries,transitions:F.transitions},m.updateQueue.baseState=O,m.memoizedState=O,m.flags&256){E=nS(Error(i(423)),m),m=jne(d,m,S,v,E);break e}else if(S!==E){E=nS(Error(i(424)),m),m=jne(d,m,S,v,E);break e}else for(iu=n0(m.stateNode.containerInfo.firstChild),tu=m,ss=!0,Od=null,v=tne(m,null,S,v),m.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Kx(),S===E){m=qm(d,m,v);break e}Tl(d,m,S,v)}m=m.child}return m;case 5:return one(m),d===null&&dB(m),S=m.type,E=m.pendingProps,O=d!==null?d.memoizedProps:null,F=E.children,rB(S,E)?F=null:O!==null&&rB(S,O)&&(m.flags|=32),zne(d,m),Tl(d,m,F,v),m.child;case 6:return d===null&&dB(m),null;case 13:return Gne(d,m,v);case 4:return wB(m,m.stateNode.containerInfo),S=m.pendingProps,d===null?m.child=eS(m,null,S,v):Tl(d,m,S,v),m.child;case 11:return S=m.type,E=m.pendingProps,E=m.elementType===S?E:Ad(S,E),Nne(d,m,S,E,v);case 7:return Tl(d,m,m.pendingProps,v),m.child;case 8:return Tl(d,m,m.pendingProps.children,v),m.child;case 12:return Tl(d,m,m.pendingProps.children,v),m.child;case 10:e:{if(S=m.type._context,E=m.pendingProps,O=m.memoizedProps,F=E.value,Dn(KI,S._currentValue),S._currentValue=F,O!==null)if($d(O.value,F)){if(O.children===E.children&&!nc.current){m=qm(d,m,v);break e}}else for(O=m.child,O!==null&&(O.return=m);O!==null;){var q=O.dependencies;if(q!==null){F=O.child;for(var ee=q.firstContext;ee!==null;){if(ee.context===S){if(O.tag===1){ee=Hm(-1,v&-v),ee.tag=2;var be=O.updateQueue;if(be!==null){be=be.shared;var Ve=be.pending;Ve===null?ee.next=ee:(ee.next=Ve.next,Ve.next=ee),be.pending=ee}}O.lanes|=v,ee=O.alternate,ee!==null&&(ee.lanes|=v),yB(O.return,v,m),q.lanes|=v;break}ee=ee.next}}else if(O.tag===10)F=O.type===m.type?null:O.child;else if(O.tag===18){if(F=O.return,F===null)throw Error(i(341));F.lanes|=v,q=F.alternate,q!==null&&(q.lanes|=v),yB(F,v,m),F=O.sibling}else F=O.child;if(F!==null)F.return=O;else for(F=O;F!==null;){if(F===m){F=null;break}if(O=F.sibling,O!==null){O.return=F.return,F=O;break}F=F.return}O=F}Tl(d,m,E.children,v),m=m.child}return m;case 9:return E=m.type,S=m.pendingProps.children,iS(m,v),E=eh(E),S=S(E),m.flags|=1,Tl(d,m,S,v),m.child;case 14:return S=m.type,E=Ad(S,m.pendingProps),E=Ad(S.type,E),Fne(d,m,S,E,v);case 15:return kne(d,m,m.type,m.pendingProps,v);case 17:return S=m.type,E=m.pendingProps,E=m.elementType===S?E:Ad(S,E),hP(d,m),m.tag=1,sc(S)?(d=!0,WI(m)):d=!1,iS(m,v),One(m,S,E),PB(m,S,E,v),FB(null,m,S,!0,d,v);case 19:return qne(d,m,v);case 22:return Une(d,m,v)}throw Error(i(156,m.tag))};function gse(d,m){return Xc(d,m)}function lNe(d,m,v,S){this.tag=d,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rh(d,m,v,S){return new lNe(d,m,v,S)}function r6(d){return d=d.prototype,!(!d||!d.isReactComponent)}function cNe(d){if(typeof d=="function")return r6(d)?1:0;if(d!=null){if(d=d.$$typeof,d===j)return 11;if(d===X)return 14}return 2}function m0(d,m){var v=d.alternate;return v===null?(v=rh(d.tag,m,d.key,d.mode),v.elementType=d.elementType,v.type=d.type,v.stateNode=d.stateNode,v.alternate=d,d.alternate=v):(v.pendingProps=m,v.type=d.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=d.flags&14680064,v.childLanes=d.childLanes,v.lanes=d.lanes,v.child=d.child,v.memoizedProps=d.memoizedProps,v.memoizedState=d.memoizedState,v.updateQueue=d.updateQueue,m=d.dependencies,v.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},v.sibling=d.sibling,v.index=d.index,v.ref=d.ref,v}function xP(d,m,v,S,E,O){var F=2;if(S=d,typeof d=="function")r6(d)&&(F=1);else if(typeof d=="string")F=5;else e:switch(d){case N:return y1(v.children,E,O,m);case V:F=8,E|=8;break;case U:return d=rh(12,v,m,E|2),d.elementType=U,d.lanes=O,d;case Q:return d=rh(13,v,m,E),d.elementType=Q,d.lanes=O,d;case Z:return d=rh(19,v,m,E),d.elementType=Z,d.lanes=O,d;case ae:return SP(v,E,O,m);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case B:F=10;break e;case W:F=9;break e;case j:F=11;break e;case X:F=14;break e;case ge:F=16,S=null;break e}throw Error(i(130,d==null?d:typeof d,""))}return m=rh(F,v,m,E),m.elementType=d,m.type=S,m.lanes=O,m}function y1(d,m,v,S){return d=rh(7,d,S,m),d.lanes=v,d}function SP(d,m,v,S){return d=rh(22,d,S,m),d.elementType=ae,d.lanes=v,d.stateNode={isHidden:!1},d}function n6(d,m,v){return d=rh(6,d,null,m),d.lanes=v,d}function s6(d,m,v){return m=rh(4,d.children!==null?d.children:[],d.key,m),m.lanes=v,m.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},m}function uNe(d,m,v,S,E){this.tag=m,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zx(0),this.expirationTimes=zx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zx(0),this.identifierPrefix=S,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function o6(d,m,v,S,E,O,F,q,ee){return d=new uNe(d,m,v,q,ee),m===1?(m=1,O===!0&&(m|=8)):m=0,O=rh(3,null,null,m),d.current=O,O.stateNode=d,O.memoizedState={element:S,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},vB(O),d}function hNe(d,m,v){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:S==null?null:""+S,children:d,containerInfo:m,implementation:v}}function yse(d){if(!d)return o0;d=d._reactInternals;e:{if(Xu(d)!==d||d.tag!==1)throw Error(i(170));var m=d;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(sc(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(i(171))}if(d.tag===1){var v=d.type;if(sc(v))return Hre(d,v,m)}return m}function _se(d,m,v,S,E,O,F,q,ee){return d=o6(v,S,!0,d,E,O,F,q,ee),d.context=yse(null),v=d.current,S=El(),E=p0(v),O=Hm(S,E),O.callback=m??null,c0(v,O,E),d.current.lanes=E,Jy(d,E,S),lc(d,S),d}function TP(d,m,v,S){var E=m.current,O=El(),F=p0(E);return v=yse(v),m.context===null?m.context=v:m.pendingContext=v,m=Hm(O,F),m.payload={element:d},S=S===void 0?null:S,S!==null&&(m.callback=S),d=c0(E,m,F),d!==null&&(Pd(d,E,F,O),tP(d,E,F)),F}function EP(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function vse(d,m){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var v=d.retryLane;d.retryLane=v!==0&&v<m?v:m}}function a6(d,m){vse(d,m),(d=d.alternate)&&vse(d,m)}function dNe(){return null}var wse=typeof reportError=="function"?reportError:function(d){console.error(d)};function l6(d){this._internalRoot=d}CP.prototype.render=l6.prototype.render=function(d){var m=this._internalRoot;if(m===null)throw Error(i(409));TP(d,m,null,null)},CP.prototype.unmount=l6.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var m=d.containerInfo;f1(function(){TP(null,d,null,null)}),m[zm]=null}};function CP(d){this._internalRoot=d}CP.prototype.unstable_scheduleHydration=function(d){if(d){var m=rre();d={blockedOn:null,target:d,priority:m};for(var v=0;v<t0.length&&m!==0&&m<t0[v].priority;v++);t0.splice(v,0,d),v===0&&ore(d)}};function c6(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function MP(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function bse(){}function pNe(d,m,v,S,E){if(E){if(typeof S=="function"){var O=S;S=function(){var be=EP(F);O.call(be)}}var F=_se(m,S,d,0,null,!1,!1,"",bse);return d._reactRootContainer=F,d[zm]=F.current,AM(d.nodeType===8?d.parentNode:d),f1(),F}for(;E=d.lastChild;)d.removeChild(E);if(typeof S=="function"){var q=S;S=function(){var be=EP(ee);q.call(be)}}var ee=o6(d,0,!1,null,null,!1,!1,"",bse);return d._reactRootContainer=ee,d[zm]=ee.current,AM(d.nodeType===8?d.parentNode:d),f1(function(){TP(m,ee,v,S)}),ee}function $P(d,m,v,S,E){var O=v._reactRootContainer;if(O){var F=O;if(typeof E=="function"){var q=E;E=function(){var ee=EP(F);q.call(ee)}}TP(m,F,d,E)}else F=pNe(v,m,d,E,S);return EP(F)}tre=function(d){switch(d.tag){case 3:var m=d.stateNode;if(m.current.memoizedState.isDehydrated){var v=en(m.pendingLanes);v!==0&&(PV(m,v|1),lc(m,Rr()),!(Ur&6)&&(aS=Rr()+500,a0()))}break;case 13:f1(function(){var S=Gm(d,1);if(S!==null){var E=El();Pd(S,d,1,E)}}),a6(d,1)}},LV=function(d){if(d.tag===13){var m=Gm(d,134217728);if(m!==null){var v=El();Pd(m,d,134217728,v)}a6(d,134217728)}},ire=function(d){if(d.tag===13){var m=p0(d),v=Gm(d,m);if(v!==null){var S=El();Pd(v,d,m,S)}a6(d,m)}},rre=function(){return gn},nre=function(d,m){var v=gn;try{return gn=d,m()}finally{gn=v}},di=function(d,m,v){switch(m){case"input":if(Be(d,v),m=v.name,v.type==="radio"&&m!=null){for(v=d;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<v.length;m++){var S=v[m];if(S!==d&&S.form===d.form){var E=HI(S);if(!E)throw Error(i(90));li(S),Be(S,E)}}}break;case"textarea":at(d,v);break;case"select":m=v.value,m!=null&&Je(d,!!v.multiple,m,!1)}},Es=e6,Ln=f1;var fNe={usingClientEntryPoint:!1,Events:[PM,Zx,HI,wo,bo,e6]},WM={findFiberByHostInstance:o1,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mNe={bundleType:WM.bundleType,version:WM.version,rendererPackageName:WM.rendererPackageName,rendererConfig:WM.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:R.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=Um(d),d===null?null:d.stateNode},findFiberByHostInstance:WM.findFiberByHostInstance||dNe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var OP=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!OP.isDisabled&&OP.supportsFiber)try{Ms=OP.inject(mNe),Wo=OP}catch{}}return cc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fNe,cc.createPortal=function(d,m){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c6(m))throw Error(i(200));return hNe(d,m,null,v)},cc.createRoot=function(d,m){if(!c6(d))throw Error(i(299));var v=!1,S="",E=wse;return m!=null&&(m.unstable_strictMode===!0&&(v=!0),m.identifierPrefix!==void 0&&(S=m.identifierPrefix),m.onRecoverableError!==void 0&&(E=m.onRecoverableError)),m=o6(d,1,!1,null,null,v,!1,S,E),d[zm]=m.current,AM(d.nodeType===8?d.parentNode:d),new l6(m)},cc.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var m=d._reactInternals;if(m===void 0)throw typeof d.render=="function"?Error(i(188)):(d=Object.keys(d).join(","),Error(i(268,d)));return d=Um(m),d=d===null?null:d.stateNode,d},cc.flushSync=function(d){return f1(d)},cc.hydrate=function(d,m,v){if(!MP(m))throw Error(i(200));return $P(null,d,m,!0,v)},cc.hydrateRoot=function(d,m,v){if(!c6(d))throw Error(i(405));var S=v!=null&&v.hydratedSources||null,E=!1,O="",F=wse;if(v!=null&&(v.unstable_strictMode===!0&&(E=!0),v.identifierPrefix!==void 0&&(O=v.identifierPrefix),v.onRecoverableError!==void 0&&(F=v.onRecoverableError)),m=_se(m,null,d,1,v??null,E,!1,O,F),d[zm]=m.current,AM(d),S)for(d=0;d<S.length;d++)v=S[d],E=v._getVersion,E=E(v._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[v,E]:m.mutableSourceEagerHydrationData.push(v,E);return new CP(m)},cc.render=function(d,m,v){if(!MP(m))throw Error(i(200));return $P(null,d,m,!1,v)},cc.unmountComponentAtNode=function(d){if(!MP(d))throw Error(i(40));return d._reactRootContainer?(f1(function(){$P(null,null,d,!1,function(){d._reactRootContainer=null,d[zm]=null})}),!0):!1},cc.unstable_batchedUpdates=e6,cc.unstable_renderSubtreeIntoContainer=function(d,m,v,S){if(!MP(v))throw Error(i(200));if(d==null||d._reactInternals===void 0)throw Error(i(38));return $P(d,m,v,!1,S)},cc.version="18.3.1-next-f1338f8080-20240426",cc}var Ose;function SNe(){if(Ose)return d6.exports;Ose=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),d6.exports=xNe(),d6.exports}var Ase;function TNe(){if(Ase)return AP;Ase=1;var t=SNe();return AP.createRoot=t.createRoot,AP.hydrateRoot=t.hydrateRoot,AP}var ENe=TNe();const CNe="modulepreload",MNe=function(t){return"/BuildingModel/"+t},Rse={},fe=function(e,i,r){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(i.map(l=>{if(l=MNe(l),l in Rse)return;Rse[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const p=document.createElement("link");if(p.rel=c?"stylesheet":CNe,c||(p.as="script"),p.crossOrigin="",p.href=l,a&&p.setAttribute("nonce",a),document.head.appendChild(p),c)return new Promise((g,y)=>{p.addEventListener("load",g),p.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};function u(t,e,i,r){var n,s=arguments.length,o=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o}function DAt(t,e){return function(i,r){e(i,r,t)}}function NAt(t,e,i,r){function n(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function a(h){try{c(r.next(h))}catch(p){o(p)}}function l(h){try{c(r.throw(h))}catch(p){o(p)}}function c(h){h.done?s(h.value):n(h.value).then(a,l)}c((r=r.apply(t,[])).next())})}let H_;function pe(t){return typeof H_[t]=="function"?H_[t]=H_[t](globalThis):H_[t]}var H0e,q0e,W0e,Z0e;H_=(H0e=globalThis.dojoConfig)!=null&&H0e.has||(q0e=globalThis.esriConfig)!=null&&q0e.has?{...(W0e=globalThis.dojoConfig)==null?void 0:W0e.has,...(Z0e=globalThis.esriConfig)==null?void 0:Z0e.has}:{},pe.add=(t,e,i,r)=>{(r||H_[t]===void 0)&&(H_[t]=e),i&&pe(t)},pe.cache=H_,pe.add("big-integer-warning-enabled",!0),pe.add("esri-deprecation-warnings",!0),pe.add("esri-tests-disable-screenshots",!1),pe.add("esri-tests-use-full-window",!1),pe.add("esri-tests-post-to-influx",!0),pe.add("esri-cim-animations-enable-status","enabled"),pe.add("esri-cim-animations-spotlight",!1),pe.add("esri-cim-animations-freeze-time",!1),pe.add("enable-feature:multiple-highlights",!1),(()=>{var e;pe.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(pe.add("host-browser",t),pe.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),pe.add("dom",t),pe("host-browser")){const i=navigator,r=i.userAgent,n=i.appVersion,s=parseFloat(n);if(pe.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),pe.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),pe.add("khtml",n.includes("Konqueror")?s:void 0),pe.add("edge",parseFloat(r.split("Edge/")[1])||void 0),pe.add("opr",parseFloat(r.split("OPR/")[1])||void 0),pe.add("webkit",!pe("wp")&&!pe("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),pe.add("chrome",!pe("edge")&&!pe("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),pe.add("android",!pe("wp")&&parseFloat(r.split("Android ")[1])||void 0),pe.add("safari",!n.includes("Safari")||pe("wp")||pe("chrome")||pe("android")||pe("edge")||pe("opr")?void 0:parseFloat(n.split("Version/")[1])),pe.add("mac",n.includes("Macintosh")),!pe("wp")&&/(iPhone|iPod|iPad)/.test(r)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));pe.add(o,l),pe.add("ios",l)}pe("webkit")||(!r.includes("Gecko")||pe("wp")||pe("khtml")||pe("edge")||pe.add("mozilla",s),pe("mozilla")&&pe.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&pe.add("esri-mobile",e),i&&pe.add("esri-iPhone",i),pe.add("esri-geolocation",!!navigator.geolocation)}pe.add("esri-wasm","WebAssembly"in globalThis),pe.add("esri-performance-mode-frames-between-render",20),pe.add("esri-force-performance-mode",!1),pe.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),pe.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),pe.add("esri-atomics","Atomics"in globalThis),pe.add("esri-workers","Worker"in globalThis),pe.add("web-feat:cache","caches"in globalThis),pe.add("esri-workers-arraybuffer-transfer",!pe("safari")||Number(pe("safari"))>=12),pe.add("workers-pool-size",8),pe.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),pe.add("featurelayer-simplify-payload-size-factors",[1,1,4]),pe.add("featurelayer-fast-triangulation-enabled",!0),pe.add("featurelayer-animation-enabled",!0),pe.add("featurelayer-snapshot-enabled",!0),pe.add("featurelayer-snapshot-point-min-threshold",8e4),pe.add("featurelayer-snapshot-point-max-threshold",4e5),pe.add("featurelayer-snapshot-point-coverage",.1),pe.add("featurelayer-query-max-depth",4),pe.add("featurelayer-query-pausing-enabled",!1),pe.add("featurelayer-advanced-symbols",!1),pe.add("featurelayer-pbf",!0),pe.add("featurelayer-pbf-statistics",!1),pe.add("feature-layers-workers",!0),pe.add("feature-polyline-generalization-factor",1),pe.add("mapview-transitions-duration",200),pe.add("mapview-essential-goto-duration",200),pe.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),pe.add("mapserver-pbf-version-support",10.81),pe.add("mapservice-popup-identify-max-tolerance",20),pe("host-webworker")||pe("host-browser")&&(pe.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),pe.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{pe.add("esri-image-decode",!0,!0,!0)}).catch(()=>{pe.add("esri-image-decode",!1,!0,!0)})}return!1}),pe.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let cN=class H1{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*H1._m}getInt(){return this._seed=(H1._a*this._seed+H1._c)%H1._m,this._seed}getFloat(){return this.getInt()/(H1._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/H1._m*r}};cN._m=2147483647,cN._a=48271,cN._c=0;const Qk=1.5,$Ne=1/Qk,ONe=.5;function Kk(t,e){return e?t.filter((i,r,n)=>n.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function ym(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function ANe(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function bH(t,e,i){let r,n;return i?(r=e.filter(s=>!t.some(o=>i(o,s))),n=t.filter(s=>!e.some(o=>i(o,s)))):(r=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:r,removed:n}}function RNe(t){return t&&typeof t.length=="number"}function FAt(t,e){const i=t.length;if(i===0)return[];const r=[];for(let n=0;n<i;n+=e)r.push(t.slice(n,n+e));return r}function kAt(t,e,i){const r=t.length;let n=0,s=r-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return i?e>=t[r-1]?-1:o===e?n:n-1:o===e?n:-1}let e_e=class{constructor(){this.last=0}};const t_e=new e_e;function xH(t,e,i,r){r=r||t_e;const n=Math.max(0,r.last-10);for(let o=n;o<i;++o)if(t[o]===e)return r.last=o,o;const s=Math.min(n,i);for(let o=0;o<s;++o)if(t[o]===e)return r.last=o,o;return-1}function wR(t,e,i,r){const n=t.length,s=xH(t,e,n,r);if(s!==-1)return t[s]=t[n-1],t.pop(),e}const Ld=new Set;function INe(t,e,i=t.length,r=e.length,n,s){if(r===0||i===0)return i;Ld.clear();for(let a=0;a<r;++a)Ld.add(e[a]);n=n||t_e;const o=Math.max(0,n.last-10);for(let a=o;a<i;++a)if(Ld.has(t[a])&&(s==null||s.push(t[a]),Ld.delete(t[a]),t[a]=t[i-1],--i,--a,Ld.size===0||i===0))return Ld.clear(),i;for(let a=0;a<o;++a)if(Ld.has(t[a])&&(s==null||s.push(t[a]),Ld.delete(t[a]),t[a]=t[i-1],--i,--a,Ld.size===0||i===0))return Ld.clear(),i;return Ld.clear(),i}function PNe(t,e){let i=0;for(let r=0;r<t.length;++r){const n=t[r];e(n,r)&&(t[i]=n,i++)}t.length=i}function i_e(t){return t?(Ise.seed=t,()=>Ise.getFloat()):Math.random}function r_e(t,e){const i=i_e(e);for(let r=t.length-1;r>0;r--){const n=Math.floor(i()*(r+1)),s=t[r];t[r]=t[n],t[n]=s}return t}const Ise=new cN;function eU(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function Bv(t,e){return t!=null}const LNe=[];function n_e(t){return 32+t.length}function aJ(){return 16}function s_e(t){if(!t)return 0;let e=l_e;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=n_e(r);break;case"number":e+=aJ();break;case"boolean":e+=4}}return e}function o_e(t){if(!t)return 0;if(Array.isArray(t))return DNe(t);let e=l_e;for(const i in t)t.hasOwnProperty(i)&&(e+=a_e(t[i]));return e}function DNe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=c_e;for(let r=0;r<e;r++)i+=a_e(t[r]);return i}function a_e(t){switch(typeof t){case"object":return o_e(t);case"string":return n_e(t);case"number":return aJ();case"boolean":return 4;default:return 8}}function NNe(t,e){return c_e+t.length*e}const l_e=32,c_e=16;function K$(t){return t instanceof ArrayBuffer}function lJ(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function q_(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function u_e(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function cJ(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function tU(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function uJ(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function hJ(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function E3(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function C3(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function yy(t){return!("buffer"in t)}function FNe(...t){return t.reduce((e,i)=>e+(i?yy(i)?NNe(i,aJ()):i.byteLength+h_e:0),0)}const h_e=145,Vu=1024;function zAt(t){return C3(t)||E3(t)||uJ(t)||cJ(t)||lJ(t)}function VAt(t){return C3(t)||E3(t)}function BAt(t){return C3(t)?179769e303:E3(t)?3402823e32:hJ(t)?4294967295:tU(t)?65535:q_(t)||u_e(t)?255:uJ(t)?2147483647:cJ(t)?32767:lJ(t)?127:256}function kNe(t,e){let i;for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function te(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=f_e(t);if(e!=null)return e;if(L4(t))return t.clone();if(d_e(t))return t.map(te);if(p_e(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=te(t[r]);return i}function SH(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=f_e(t);if(e!=null)return e;if(d_e(t)){let i=!0;const r=t.map(n=>{const s=SH(n);return n!=null&&s==null&&(i=!1),s});return i?r:null}if(L4(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!p_e(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const n=t[r],s=SH(n);if(n!=null&&s==null)return null;i[r]=s}return i}return null}function L4(t){return typeof t.clone=="function"}function d_e(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function p_e(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Pse(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function f_e(t){if(lJ(t)||q_(t)||u_e(t)||cJ(t)||tU(t)||uJ(t)||hJ(t)||E3(t)||C3(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,te(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(te(i));return e}return null}function dJ(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function m_e(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&ym(t,e):t instanceof Set?e instanceof Set&&zNe(t,e):t instanceof Map?e instanceof Map&&VNe(t,e):!!Pse(t)&&Pse(e)&&UNe(t,e))}function UNe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function zNe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function VNe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const n=e.get(i);if(n!==r||n===void 0&&!e.has(i))return!1}return!0}function pJ(t,e,i=!1){return y_e(t,e,i)}function iU(t,e){if(e!=null)return e[t]||g_e(t.split("."),!1,e)}function Uo(t,e,i){const r=t.split("."),n=r.pop(),s=g_e(r,!0,i);s&&n&&(s[n]=e)}function Lse(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(Lse(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(Lse(t[i],e[i]))return!0;return!1}return t!==e}function g_e(t,e,i){let r=i;for(const n of t){if(r==null)return;if(!(n in r)){if(!e)return;r[n]={}}r=r[n]}return r}function y_e(t,e,i){return e?Object.keys(e).reduce((r,n)=>{let s=r[n],o=e[n];return s===o?r:s===void 0?(r[n]=te(o),r):(Array.isArray(o)||Array.isArray(r)?(s=s?Array.isArray(s)?r[n]=s.slice():r[n]=[s]:r[n]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{s.includes(a)||s.push(a)}):r[n]=o.slice())):o&&typeof o=="object"?r[n]=y_e(s,o,i):r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[n]=o),r)},t||{}):t}var Y0e;const Qr={apiKey:void 0,applicationName:"",applicationUrl:(Y0e=globalThis.location)==null?void 0:Y0e.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:62e3,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(pJ(Qr,globalThis.esriConfig,!0),delete Qr.has),!Qr.assetsPath){{const t="4.31";Qr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Qr.defaultAssetsPath=Qr.assetsPath}const BNe=/\{([^}]+)\}/g;function Dse(t){return t??""}function rU(t,e){return e?t.replaceAll(BNe,typeof e=="object"?(i,r)=>Dse(iU(r,e)):(i,r)=>Dse(e(r))):t}function jAt(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e!=null&&e.includes(i)?i:`\\${i}`)}function __e(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let Nse;function GAt(t){return Nse??(Nse=new DOMParser),Nse.parseFromString(t||"","text/html").body.innerText||""}function HAt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function jNe(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const Fse={info:0,warn:1,error:2,none:3};let de=class du{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,du._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=du.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,du._loggers.get(e)||new du({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!du._throttlingDisabled){const n=HNe(r),s=this._loggedMessages[e].get(n);if(i==="once"&&s!=null||i==="oncePerTick"&&s&&s>=du._tickCounter)return;this._loggedMessages[e].set(n,du._tickCounter),du._scheduleTickCounterIncrement()}for(const n of Qr.log.interceptors)if(n(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const n=r[e];if(n!=null)return n;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",GNe)}_matchLevel(e){const i=Qr.log.level||"warn";return Fse[this._parentWithMember("level",i)]<=Fse[e]}static _scheduleTickCounterIncrement(){du._tickCounterScheduled||(du._tickCounterScheduled=!0,Promise.resolve().then(()=>{du._tickCounter++,du._tickCounterScheduled=!1}))}};function GNe(t,e,...i){console[t](`[${e}]`,...i)}function HNe(...t){return __e(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}de._loggers=new Map,de._tickCounter=0,de._tickCounterScheduled=!1,de._throttlingDisabled=!1;function qNe(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(iU(r,e)??"").toString())}let v_e=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&qNe(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},Y=class w_e extends v_e{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return te(i)}catch{return"[object]"}}))}}catch(e){throw de.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new w_e(e.name,e.message,e.details)}};Y.prototype.type="error";const kse=new WeakMap;function WNe(t,e,i=!1){const r=` DEPRECATED - ${e}`;if(!i)return void t.warn(r);let n=kse.get(t);n||(n=new Set,kse.set(t,n)),n.has(e)||(n.add(e),t.warn(r))}function b_e(t,e,i={}){if(pe("esri-deprecation-warnings")){const{moduleName:r}=i;ME(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function WAt(t,e,i={}){if(pe("esri-deprecation-warnings")){const{moduleName:r}=i;ME(t,`Property: ${(r?r+"::":"")+e}`,i)}}function ZNe(t,e,i={}){pe("esri-deprecation-warnings")&&ME(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function ME(t,e,i={}){if(pe("esri-deprecation-warnings")){const{replacement:r,version:n,see:s,warnOnce:o}=i;let a=e;r&&(a+=`
	 Replacement: ${r}`),n&&(a+=`
	 Version: ${n}`),s&&(a+=`
	 See ${s} for more details.`),WNe(t,a,o)}}function ZAt(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function YNe(t,e){for(const i of t)if(i!=null&&e(i))return i}function TH(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Dy=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(TH(e)){const r=this._getOrCreateGroup(i);for(const n of e)zse(n)&&r.push(n)}else zse(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(RP(e))}remove(e){if(typeof e!="string"&&TH(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(Use(this._getGroup(e)),this._groups.delete(RP(e)),this):this}removeAll(){return this._groups.forEach(Use),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(RP(e),i),i}_getGroup(e){return this._groups.get(RP(e))}};function RP(t){return t||"_default_"}function Use(t){for(const e of t)e instanceof Dy?e.removeAll():e.remove()}function zse(t){return t!=null&&(!!t.remove||t instanceof Dy)}function nU(t,e){if(t==null)throw new Error(e??"value is None")}function Ye(t){return t==null||t.destroy(),null}function Ht(t){return t==null||t.dispose(),null}function Sr(t){return t==null||t.remove(),null}function jc(t){return t==null||t.abort(),null}function Lr(t){return t==null||t.release(),null}function XNe(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function Vse(t,e){return t==null?void 0:t[e]}function JNe(t,e){let i;return t.some((r,n)=>(i=e(r,n),i!=null)),i??void 0}const x_e=Symbol("Accessor-beforeDestroy"),QNe={remove:()=>{}};function Ui(t){return t?{remove(){t&&(t(),t=void 0)}}:QNe}function KNe(t){t.forEach(e=>e==null?void 0:e.remove())}function Fb(t){return Ui(()=>KNe(t))}function XAt(t){return Ui(()=>{var e;return(e=t())==null?void 0:e.remove()})}function S_e(t){return Ui(t!=null?()=>t.destroy():void 0)}function bl(t){return t.__accessor__??null}function eFe(t,e){var i;return((i=t==null?void 0:t.metadata)==null?void 0:i[e])!=null}function uN(t,e,i){return i?D4(t,e,{policy:i,path:""}):D4(t,e,null)}function D4(t,e,i){return e?Object.keys(e).reduce((r,n)=>{const s=n;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${n}`:n,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[s]))return r[s]=e[s],r;if(r[s]===void 0)return r[s]=te(e[s]),r;let l=r[s],c=e[s];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[s]=l.slice():r[s]=[l]:r[s]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(i){const h=i.path;i.path=o,r[s]=D4(l,c,i),i.path=h}else r[s]=D4(l,c,null);else r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[s]=c);return r},t||{}):t}function T_e(t){return Array.isArray(t)?t:t.split(".")}function Bse(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function tFe(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...Bse(i));return e}return Bse(t)}function E_e(t,e,i,r){const n=tFe(e);if(n.length!==1){const s=n.map(o=>r(t,o,i));return Fb(s)}return r(t,n[0],i)}function C_e(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const r=bl(e);return eFe(r,i)?r.get(i):e[i]}function M_e(t,e,i){if(t==null)return t;const r=C_e(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:M_e(r,e,i+1)}function M3(t,e,i=0){return typeof e!="string"||e.includes(".")?M_e(t,T_e(e),i):C_e(e,t)}function Vp(t,e){return M3(t,e)}function jse(t,e){return M3(e,t)!==void 0}var Rc;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(Rc||(Rc={}));function $3(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=te(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function sU(t,e){const i=$3(t);let r=i[e];return r||(r=i[e]={}),r}function iFe(t,e){return uN(t,e,nFe)}const rFe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function nFe(t){return rFe.test(t)?"replace":"merge"}function sFe(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function oFe(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let xl=class EH{constructor(e,i,r,n=1,s=0){this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s;for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let i;if(EH.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let n=0;n<r;n++)this._pool[n]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):oFe(i)&&i.acquire(...e),i}release(e){e&&!EH.test.disabled&&(this._releaseFunction?this._releaseFunction(e):sFe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};xl.test={disabled:!1};let aFe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){eU(this._observers,this._observer)}},$_e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return lFe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,n=!1;const s=i.length;for(let o=0;o<s;++o){const a=i[o];if(a.destroyed)n=!0;else if(a===e){r=!0;break}}return r||(i.push(e),n&&this._removeDestroyedObservers()),new aFe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let n=0;n<i;++n){for(;n+r<i&&e[n+r].destroyed;)++r;if(r>0){if(!(n+r<i))break;e[n]=e[n+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const lFe=Ui();var Ni;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Ni||(Ni={}));const CH=Ni.USER+1;function W_(t){switch(t){case"defaults":return Ni.DEFAULTS;case"service":return Ni.SERVICE;case"portal-item":return Ni.PORTAL_ITEM;case"web-scene":return Ni.WEB_SCENE;case"web-map":return Ni.WEB_MAP;case"link-chart":return Ni.LINK_CHART;case"user":return Ni.USER;default:return null}}function N4(t){switch(t){case Ni.DEFAULTS:return"defaults";case Ni.SERVICE:return"service";case Ni.PORTAL_ITEM:return"portal-item";case Ni.WEB_SCENE:return"web-scene";case Ni.WEB_MAP:return"web-map";case Ni.LINK_CHART:return"link-chart";case Ni.USER:return"user"}}function cFe(t){return N4(t)}var nn;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(nn||(nn={}));let oU=class{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){var e;(e=this.accessed)==null||e.clear(),this.clear()}onAccessed(e){this._observer!=null&&e!==this._observer&&(this.accessed==null&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){this._observer!=null&&(this.clear(),this.accessed!=null&&(this._handles==null&&(this._handles=[]),this.accessed.forEach(e=>{this._handles.push(e.observe(this._observer))}),this.accessed.clear()))}clear(){if(this._handles!=null){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}};const F4=new oU,eO=[];let IA=F4;function qt(t){IA.onAccessed(t)}let hN=!1,dN=!1;function _y(t,e,i){if(hN)return fJ(t,e,i);let r=null;return O_e(t),r=e.call(i),A_e(),r}function uFe(t,e){return _y(F4,t,e)}function fJ(t,e,i){const r=hN;hN=!0,O_e(t);let n=null;try{n=e.call(i)}catch(s){dN&&de.getLogger("esri.core.accessorSupport.tracking").error(s)}return A_e(),hN=r,n}function O_e(t){IA=t,eO.push(t)}function A_e(){const t=eO.length;if(t>1){const e=eO.pop();IA=eO[t-2],e.onTrackingEnd()}else if(t===1){const e=eO.pop();IA=F4,e.onTrackingEnd()}else IA=F4}function R_e(t,e){if(e.flags&nn.DepTrackingInitialized)return;e.flags|=nn.DepTrackingInitialized;const i=dN;dN=!1,e.flags&nn.AutoTracked?fJ(e.trackingTarget,e.metadata.get,t):I_e(t,e),dN=i}const hFe=[];function I_e(t,e){e.flags&nn.ExplicitlyTracking||(e.flags|=nn.ExplicitlyTracking,fJ(e.trackingTarget,()=>{const i=e.metadata.dependsOn||hFe;for(const r of i)if(typeof r!="string"||r.includes(".")){const n=T_e(r);for(let s=0,o=t;s<n.length&&o!=null&&typeof o=="object";++s)o=Gse(o,n[s],s!==n.length-1)}else Gse(t,r,!1)}),e.flags&=~nn.ExplicitlyTracking)}function Gse(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=bl(t);if(n){const s=n.propertiesByName.get(r);s&&(qt(s),R_e(t,s))}return i?t[r]:void 0}let Hse=class extends $_e{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this.trackingTarget=new oU(this),this.flags=0,this.flags=nn.Dirty|(i.nonNullable?nn.NonNullable:0)|(i.hasOwnProperty("value")?nn.HasDefaultValue:0)|(i.get===void 0?nn.DepTrackingInitialized:0)|(i.dependsOn===void 0?nn.AutoTracked:0)}destroy(){this.flags&nn.Dirty&&this.onCommitted(),super.destroy(),this.trackingTarget.destroy()}getComputed(e){e.mutable&&qt(this);const i=e.store,r=this.propertyName,n=this.flags,s=i.get(r);if(n&nn.Computing||~n&nn.Dirty&&i.has(r))return s;this.flags|=nn.Computing;const o=e.host;let a;n&nn.AutoTracked?a=_y(this.trackingTarget,this.metadata.get,o):(I_e(o,this),a=this.metadata.get.call(o)),this.flags|=nn.DepTrackingInitialized,i.set(r,a,Ni.COMPUTED);const l=i.get(r);return l===s?this.flags&=~nn.Dirty:uFe(this.commit,this),this.flags&=~nn.Computing,l}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~nn.Dirty,this.onCommitted()}onInvalidated(){~this.flags&nn.Overridden&&(this.flags|=nn.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},dFe=class P_e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new P_e;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,te(r))}),i}get(e){return this._values.get(e)}originOf(){return Ni.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function IP(t,e,i){return t!==void 0}function qse(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&nn.NonNullable)||(r.lifecycle,Rc.INITIALIZING,!1))}let pFe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=Rc.INITIALIZING,this.store=new dFe,this.mutable=!0,this._origin=Ni.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const n=new Hse(r,i[r]);this.propertiesByName.set(r,n)}this.metadata=i}initialize(){this.lifecycle=Rc.CONSTRUCTING}constructed(){this.lifecycle=Rc.CONSTRUCTED}destroy(){this.lifecycle=Rc.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==Rc.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);this.mutable&&qt(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&nn.HasDefaultValue)return"defaults"}return N4(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(IP(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);IP(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const n=this.propertiesByName.get(i);if(!IP(n))return"";const s=new oU,o=_y(s,()=>{var c;return(c=n.metadata.get)==null?void 0:c.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;const l=s.accessed??new Set;if(l.size===0)return a;r+="  ";for(const c of l)c instanceof Hse&&(a+=`${r}${c.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const n=this.propertiesByName.get(e);if(IP(n))return this._setAtOrigin(n,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&nn.Overridden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&nn.Overridden&&(i.flags&=~nn.Overridden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!qse(r,e,i,this))return;const n=r.metadata.cast;if(n){const s=this._cast(n,i),{valid:o,value:a}=s;if(m6.release(s),!o)return;i=a}r.flags|=nn.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!qse(r,e,i,this))return;const n=r.metadata.cast;if(n){const o=this._cast(n,i),{valid:a,value:l}=o;if(m6.release(o),!a)return;i=l}const s=r.metadata.set;s?s.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=W_(e)}getDefaultOrigin(){return N4(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==Rc.INITIALIZING?this._origin:Ni.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const n=this.store,s=e.propertyName;n.has(s,r)&&dJ(i,n.get(s))&&~e.flags&nn.Overridden&&r===n.originOf(s)||(e.invalidate(),n.set(s,i,r),e.commit(),R_e(this.host,e))}_cast(e,i){const r=m6.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},fFe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const m6=new xl(fFe);function k4(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))k4(t,r,e[r]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(-1,1)[0];return void k4(Vp(t,n),s,i)}const r=t.__accessor__;r!=null&&mFe(e,r),t[e]=i}}function mFe(t,e){if(pe("esri-unknown-property-errors")&&!gFe(t,e))throw new Y("set:unknown-property",yFe(t,e))}function gFe(t,e){return e.metadata[t]!=null}function yFe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let _Fe;function vFe(){return _Fe}var Wse;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(Wse||(Wse={}));function wFe(t){t.length=0}let Ic=class{constructor(e=50,i=50){this._pool=new xl(Array,void 0,wFe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return g6.acquire()}static release(e){return g6.release(e)}static prune(){g6.prune()}};const g6=new Ic(100);let L_e=class extends xl{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const PP=[];function $E(t){PP.push(t),PP.length===1&&queueMicrotask(()=>{const e=PP.slice();PP.length=0;for(const i of e)i()})}let ry=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}push(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}set(e){e!=null&&(this._samples[this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var MH;(function(t){const e=(s,o,a,l)=>{let c=o,h=o;const p=a>>>1,g=s[c-1];for(;h<=p;){h=c<<1,h<a&&l(s[h-1],s[h])<0&&++h;const y=s[h-1];if(l(y,g)<=0)break;s[c-1]=y,c=h}s[c-1]=g},i=(s,o)=>s<o?-1:s>o?1:0;function r(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(s,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=s[o];s[o]=s[h],s[h]=p,e(s,c,h,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(s,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=s[o];s[o]=s[h],s[h]=p,e(s,c,h,l),yield}}t.sort=r,t.iterableSort=n})(MH||(MH={}));const Zse=MH,bFe=1.5,xFe=1.1;let mi=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new e_e,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Yse(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const n=this.data[r];e(n)&&i.push(n)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Yse(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=xH(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(xH(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=INe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){Zse.sort(this.data,0,this.length,e)}iterableSort(e){return Zse.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){const{data:r,length:n}=this;for(let s=0;s<n;++s)if(e.call(i,r[s]))return r[s]}filterInPlace(e,i){let r=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(i,s,n,this.data)&&(this.data[n]=this.data[r],this.data[r]=s,r++)}if(this._deallocator)for(let n=r;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:n}=this;for(let s=0;s<n;++s)e.call(i,r[s],s,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let n=0;n<this.length;++n)r[n]=e.call(i,this.data[n],n,this.data);return r}reduce(e,i){let r=i;for(let n=0;n<this.length;++n)r=e(r,this.data[n],n,this.data);return r}has(e){const i=this.length,r=this.data;for(let n=0;n<i;++n)if(r[n]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function Yse(t){t.data.length>bFe*t.length&&(t.data.length=Math.floor(t.length*xFe))}function SFe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Ui(()=>t.clearTimeout(r))}}}const O3=SFe(globalThis);function aU(t){return TFe(t)||D_e(t)}function TFe(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function D_e(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function OC(t,e,i){if(!aU(t))throw new TypeError("target is not a Evented or EventTarget object");return D_e(t)?EFe(t,e,i):t.on(e,i)}function EFe(t,e,i,r){if(Array.isArray(e)){const n=e.slice();for(const s of n)t.addEventListener(s,i,r);return Ui(()=>{for(const s of n)t.removeEventListener(s,i,r)})}return t.addEventListener(e,i,r),Ui(()=>t.removeEventListener(e,i,r))}function N_e(t,e,i){if(!aU(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=OC(t,e,n=>{r.remove(),i.call(t,n)});return r}function ki(t="Aborted"){return new Y("AbortError",t)}function zt(t,e="Aborted"){if(zo(t))throw ki(e)}function A3(t){return t instanceof AbortSignal?t:(t==null?void 0:t.signal)??void 0}function zo(t){const e=A3(t);return e!=null&&e.aborted}function Pc(t){if(Bn(t))throw t}function Xse(t){if(!Bn(t))throw t}function _a(t,e){const i=A3(t);if(i!=null){if(!i.aborted)return N_e(i,"abort",()=>e());e()}}function R3(t,e){const i=A3(t);if(i!=null)return zt(i),N_e(i,"abort",()=>e(ki()))}function F_e(t,e){return A3(e)==null?t:new Promise((i,r)=>{let n=_a(e,()=>r(ki()));const s=()=>{n=Sr(n)};t.then(s,s),t.then(i,r)})}function Bn(t){return(t==null?void 0:t.name)==="AbortError"}async function bR(t){try{return await t}catch(e){if(!Bn(e))throw e;return}}async function aRt(t,e=de.getLogger("esri")){try{return await t}catch(i){Bn(i)||e.error(i)}}async function lU(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),n=await lU(r),s={};return i.map((o,a)=>s[o]=n[a]),s}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,n)=>{const s=i[n];return s.status==="fulfilled"?{promise:r,value:s.value}:{promise:r,error:s.reason}}))}async function CFe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function MFe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function mJ(t,e=void 0,i){const r=new AbortController;return _a(i,()=>r.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);_a(r,()=>{o&&(clearTimeout(o),s(ki()))})})}function $Fe(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return _a(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function qu(t){return t&&typeof t.then=="function"}function $H(t){return qu(t)?t:Promise.resolve(t)}function cU(t,e=-1){let i,r,n,s,o=null;const a=(...l)=>{if(i){r=l,s&&s.reject(ki()),s=Ho();const g=s.promise;if(o){const y=o;o=null,y.abort()}return g}if(n=s||Ho(),s=null,e>0){const g=new AbortController;i=$H(t(...l,g.signal));const y=i;mJ(e).then(()=>{i===y&&(s?g.abort():o=g)})}else i=1,i=$H(t(...l));const c=()=>{const g=r;r=n=i=o=null,g!=null&&a(...g)},h=i,p=n;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function Ho(){let t,e;const i=new Promise((n,s)=>{t=n,e=s}),r=n=>{t(n)};return r.resolve=n=>t(n),r.reject=n=>e(n),r.timeout=(n,s)=>O3.setTimeout(()=>r.reject(s),n),r.promise=i,r}function lRt(t,e){return t.then(e,e)}async function Jse(t){await Promise.resolve(),zt(t)}function cRt(t){return t}function k_e(t){return 1e3*t}function uRt(t){return t}function U_e(t){return .001*t}let OFe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},AFe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},OH=0,AH=0;const YM={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},RH=["prepare","preRender","render","postRender","update","finish"],IH=[],kb=new mi;let RFe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function IFe(){gb!=null&&(cancelAnimationFrame(gb),gb=requestAnimationFrame(gJ))}const U4={frameTasks:kb,willDispatch:!1,clearFrameTasks:PFe,dispatch:V_e,executeFrameTasks:DFe,reschedule:IFe};function AC(t){const e=new AFe(t);return IH.push(e),U4.willDispatch||(U4.willDispatch=!0,$E(V_e)),e}function Ub(t){const e=new OFe(t);return kb.push(e),gb==null&&(OH=performance.now(),gb=requestAnimationFrame(gJ)),new RFe(e)}let gb=null;function PFe(t=!1){kb.forAll(e=>{e.removed=!0}),t&&z_e()}function LFe(t){AH=Math.max(0,t)}function gJ(){const t=performance.now();gb=null,gb=kb.length>0?requestAnimationFrame(gJ):null,U4.executeFrameTasks(t)}function DFe(t){const e=t-OH;OH=t;const i=AH>0?AH:1e3/60,r=Math.max(0,e-i);YM.time=t,YM.frameDuration=i-r;for(let n=0;n<RH.length;n++){const s=performance.now(),o=RH[n];kb.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(YM.elapsedFrameTime=performance.now()-t,YM.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,YM)))}),UFe[n].push(performance.now()-s)}z_e(),zFe.push(performance.now()-t)}const LP=new mi;function z_e(){kb.forAll(t=>{t.removed&&LP.push(t)}),kb.removeUnorderedMany(LP.data,LP.length),LP.clear()}function V_e(){for(;IH.length;){const t=IH.shift();t.isActive&&t.callback()}U4.willDispatch=!1}function NFe(t=1,e){const i=Ho(),r=()=>{zo(e)?i.reject(ki()):t===0?i():(--t,$E(()=>r()))};return r(),i.promise}function FFe(t){return NFe(1,t)}async function kFe(t){await FFe(t),await new Promise(e=>requestAnimationFrame(()=>{t!=null&&t.aborted||e()}))}const UFe=RH.map(t=>new ry(t)),zFe=new ry("total");function PA(t,e){for(const i of t.values())if(e(i))return!0;return!1}function xR(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function Qse(t,e){return e!=null&&t.add(e),t}function B_e(t,e){const i=new Set;return xR(i,t),xR(i,e),i}function VFe(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function fRt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function mRt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function BFe(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function jFe(t,e){return BFe(B_e(t,e),VFe(t,e))}let GFe=0;const HFe=0;function rd(){return++GFe}let uU=class extends oU{constructor(e){super(new qFe(e)),this._observer&&Kse.register(this,new WeakRef(this._observer),this)}destroy(){var e,i;this._observer&&Kse.unregister(this._observer),(e=this.accessed)==null||e.clear(),this.clear(),(i=this._observer)==null||i.destroy()}},qFe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=WFe}};const Kse=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function WFe(){}let Z2=!1;const z4=[];function j_e(t,e){let i=new uU(s),r=null,n=!1;function s(){if(!i||n)return;if(Z2)return void q_e(s);const a=r;i.clear(),Z2=!0,n=!0,r=_y(i,t),n=!1,Z2=!1,e(r,a),W_e()}function o(){i&&(i.destroy(),i=null,r=null)}return n=!0,r=_y(i,t),n=!1,Ui(o)}function G_e(t,e){let i=new uU(n),r=null;function n(){e(r,o)}function s(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=_y(i,t),r):null}return o(),Ui(s)}function H_e(t,e){let i=!1,r=!1;const n=!!(e!=null&&e.sync);let s=new uU(()=>{i||r||(r=!0,n?o():queueMicrotask(o))});function o(){r=!1,s&&!i&&(Z2?q_e(o):(s.clear(),Z2=!0,i=!0,_y(s,t),i=!1,Z2=!1,W_e()))}function a(){s&&(s.destroy(),s=null)}return i=!0,_y(s,t),i=!1,Ui(a)}function q_e(t){z4.includes(t)||z4.unshift(t)}function W_e(){for(;z4.length;)z4.pop()()}var LA;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(LA||(LA={}));let SR=class{constructor(){this.uid=rd(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,n,s){return this.pool.acquire(LA.Untracked,e,i,r,n,s,dJ)}static acquireTracked(e,i,r,n){return this.pool.acquire(LA.Tracked,e,i,r,null,null,n)}notify(e,i){this.type===LA.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,n,s,o,a){this.uid=rd(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=rd(),this.removed=!0}};SR.pool=new L_e(SR);const pN=new Ic,ly=new Set;let V4;function B4(t){ly.delete(t),ly.add(t),V4||(V4=AC(XFe))}function ZFe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function YFe(t){for(const e of ly.values())e.target===t&&(e.removed=!0)}function XFe(){let t=10;for(;V4&&t--;){V4=null;const e=JFe(),i=pN.acquire();for(const r of e){const n=r.uid;ZFe(r),n===r.uid&&r.removed&&i.push(r)}for(const r of ly)r.removed&&(i.push(r),ly.delete(r));for(const r of i)SR.pool.release(r);pN.release(i),pN.release(e),PH.forEach(r=>r())}}function JFe(){const t=pN.acquire();t.length=ly.size;let e=0;for(const i of ly)t[e]=i,++e;return ly.clear(),t}const PH=new Set;function Z_e(t){return PH.add(t),Ui(()=>PH.delete(t))}function QFe(t,e,i){let r=E_e(t,e,i,(n,s,o)=>{let a,l,c=G_e(()=>M3(n,s),(h,p)=>{var g;((g=n.__accessor__)==null?void 0:g.lifecycle)===Rc.DESTROYED||a&&a.uid!==l?r.remove():(a||(a=SR.acquireUntracked(h,o,p,n,s),l=a.uid),B4(a))});return Ui(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,B4(a)),a=null),r=c=null})});return r}function KFe(t,e,i){const r=E_e(t,e,i,(n,s,o)=>{let a=!1;return j_e(()=>M3(n,s),(l,c)=>{n.__accessor__.lifecycle!==Rc.DESTROYED?a||(a=!0,dJ(c,l)||o.call(n,l,c,s,n),a=!1):r.remove()})});return r}function e4e(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==Rc.DESTROYED?r?KFe(t,e,i):QFe(t,e,i):Ui()}function t4e(t,e,i){let r,n,s=G_e(t,(o,a)=>{r&&r.uid!==n?s.remove():(r||(r=SR.acquireTracked(o,e,a,i),n=r.uid),B4(r))});return Ui(()=>{s.remove(),r&&(r.uid!==n||r.removed||(r.removed=!0,B4(r)),r=null),s=null})}function i4e(t,e,i){let r=!1;return j_e(t,(n,s)=>{r||(r=!0,i(s,n)||e(n,s),r=!1)})}function r4e(t,e,i=!1,r=m_e){return i?i4e(t,e,r):t4e(t,e,r)}function eoe(t){return PA(ly,e=>e.oldValue===t)}function ny(t,e){for(const i of t.values())if(e(i))return!0;return!1}function vRt(t,e){for(const i of t.values())if(e(i))return i;return null}function hU(t,e,i){const r=t.get(e);if(r!==void 0)return r;const n=i();return t.set(e,n),n}function wRt(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const Y2=()=>de.getLogger("esri.core.accessorSupport.ensureTypes");function n4e(t){return t==null?t:new Date(t)}function s4e(t){return t==null?t:!!t}function I3(t){return t==null?t:t.toString()}function Hl(t,e=0){return t==null?t:(t=parseFloat(t),isNaN(t)?e:t)}function yJ(t){return t==null?t:Math.round(parseFloat(t))}function o4e(t){return null}function a4e(t,e){return i=>{let r=t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function Y_e(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function j4(t,e){return e!=null&&t&&!(e instanceof t)}function X_e(t){return t&&"isCollection"in t}function toe(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function l4e(t,e){if(!(e!=null&&e.constructor)||!X_e(e.constructor))return LH(t,e)?e:new t(e);const i=toe(t.prototype.itemType),r=toe(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(LH(t,e),e):new t(e):e}function LH(t,e){return!!Y_e(e)&&(Y2().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+pU(t)+"'"),!0)}function dU(t,e){return e==null?e:X_e(t)?l4e(t,e):j4(t,e)?LH(t,e)?e:new t(e):e}function pU(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const c4e=new WeakMap;function u4e(t){switch(t){case Number:return e=>Hl(e);case Wi:return yJ;case Boolean:return s4e;case String:return I3;case Date:return n4e;case RC:return o4e;default:return hU(c4e,t,()=>dU.bind(null,t))}}function is(t,e){const i=u4e(t);return arguments.length===1?i:i(e)}function TR(t,e,i){return arguments.length===1?TR.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function h4e(t,e){return arguments.length===1?TR(i=>is(t,i)):TR(i=>is(t,i),e)}function J_e(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>J_e(t,e-1,r)):t(i)}function G4(t,e,i){if(arguments.length===2)return s=>G4(t,e,s);if(!i)return i;i=J_e(t,e,i);let r=e,n=i;for(;r>0&&Array.isArray(n);)r--,n=n[0];if(n!==void 0)for(let s=0;s<r;s++)i=[i];return i}function d4e(t,e,i){return arguments.length===2?G4(r=>is(t,r),e):G4(r=>is(t,r),e,i)}function Q_e(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function DH(t,e){if(arguments.length===2)return DH(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||n.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&n.some(p=>!j4(a,p))?a:(h&&r.length?(s||(s=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),Y2().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(p=>pU(p)).join(", ")),Y2().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):Y2().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Bu(t,e){if(arguments.length===2)return Bu(t).call(null,e);const i={},r=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=is(c),r.push(pU(c)),n.push(l)}const s=()=>`'${r.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!j4(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=i[c];if(!h)return Y2().error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!j4(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Y_e(l)){const p={};for(const g in l)g!==t.key&&(p[g]=l[g]);return h(p)}return h(l)}}let Wi=class{},RC=class{};const SRt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function p4e(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function K_e(t){switch(t.type){case"native":return is(t.value);case"array":return TR(K_e(t.value));case"one-of":return f4e(t);default:return null}}function f4e(t){let e=null;return(i,r)=>FH(i,t)?i:(e==null&&(e=NH(t)),Y2().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function NH(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Wi:return"integer";case Date:return"date";case RC:return"null";default:return pU(t.value)}case"array":return`array of ${NH(t.value)}`;case"one-of":{const e=t.values.map(i=>NH(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function FH(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Wi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case RC:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!FH(i,e.value));case"one-of":return e.values.some(i=>FH(t,i))}}function f(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),n=sU(e,i);r&&(r.get||r.set?(n.get=r.get||n.get,n.set=r.set||n.set):"value"in r&&("value"in t&&de.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=r.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let h;n.dependsOn=[l],n.get=function(){let p=Vp(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const g=Vp(this,h);g&&(p=p.bind(g))}return p},n.readOnly||(n.set=c?function(p){this._override(i,p)}:function(p){k4(this,l,p)})}const o=t.type,a=t.types;if(!n.cast){let l;o?l=m4e(o):a&&(l=Array.isArray(a)?TR(Bu(a[0])):Bu(a)),t.cast=g4e(t.cast,l)}iFe(n,t),t.range&&(n.cast=a4e(n.cast,t.range))}}function eve(t,e,i){const r=sU(t,i);r.json||(r.json={});let n=r.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function m4e(t){let e=0,i=t;if(p4e(t))return K_e(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(Q_e(r))return e===0?DH(r):G4(DH(r),e);if(e===1)return h4e(r);if(e>1)return d4e(r,e);const n=t;return n.from?n.from:is(n)}function g4e(t,e){if(t||e)return t?e?(i,r)=>e(t(i,r),r):t:e}function y4e(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const n=e[r];i[r].forEach(s=>{e[s]=n}),delete e[r]}}}let Yp=class extends v_e{constructor(e,i,r){super(e,i,r)}};Yp.prototype.type="warning";function tve(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const kH=()=>de.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function ioe(t,e,i){var r,n;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((n=e.read)==null?void 0:n.enabled)===!1||w4e(t)&&Uo("read.reader",IC(t),e))}function IC(t){var i,r;const e=t.ndimArray??0;if(e>1)return v4e(t);if(e===1)return roe(t);if("type"in t&&rve(t.type)){const n=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,s=roe(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return _J(t)}function _J(t){return"type"in t?_4e(t.type):b4e(t.types)}function _4e(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void kH().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,r),s}:t.fromJSON}function ive(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(n=>ive(t,n,i,r-1)):t(e,void 0,i)}function v4e(t){const e=_J(t),i=ive.bind(null,e),r=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=i(n,o,r);let a=r,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function roe(t){const e=_J(t);return(i,r,n)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(i,void 0,n);return s!==void 0?[s]:void 0}}function rve(t){if(!tve(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?vJ(e.Type):nve(e.Type))}function w4e(t){return"types"in t?nve(t.types):vJ(t.type)}function vJ(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||rve(t))}function nve(t){for(const e in t.typeMap)if(!vJ(t.typeMap[e]))return!1;return!0}function b4e(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(n,s,o)=>{if(n==null)return n;const a=typeof n;if(a!=="object")return void kH().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=x4e(t));const l=t.key;if(typeof l!="string")return;const c=n[l],h=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!h){const g=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&n&&o.messages.push(new Yp(`${i}:unsupported`,g,{definition:n,context:o})),void kH().error(g)}const p=new h;return p.read(n,o),r?r(p):p}}function x4e(t){var i,r;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=$3(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;if((i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"){e[a.json.type[0]]=s;continue}const l=(r=a.json)==null?void 0:r.write;if(!(l!=null&&l.writer)){e[n]=s;continue}const c=l.target,h=typeof c=="string"?c:t.key,p={};l.writer(n,p,h),p[h]&&(e[p[h]]=s)}return e}function S4e(t){if(t.json||(t.json={}),soe(t.json),ooe(t.json),noe(t.json),t.json.origins)for(const e in t.json.origins)soe(t.json.origins[e]),ooe(t.json.origins[e]),noe(t.json.origins[e]);return!0}function noe(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function soe(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function ooe(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function aoe(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&tve(t.type))?e.write.writer=C4e:i>1?e.write.writer=M4e(i):e.types?Array.isArray(e.types)?e.write.writer=E4e(e.types[0]):e.write.writer=T4e(e.types):e.write.writer=ER}function T4e(t){return(e,i,r,n)=>e?sve(e,t,n)?ER(e,i,r,n):void 0:ER(e,i,r,n)}function sve(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new Y(`${r}:unsupported`,n,{definition:t,context:i})),de.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function E4e(t){return(e,i,r,n)=>!e||!Array.isArray(e)?ER(e,i,r,n):ER(e.filter(s=>sve(s,t,n)),i,r,n)}function ER(t,e,i,r){Uo(i,H4(t,r),e)}function H4(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?q4(t):t}function q4(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function C4e(t,e,i,r){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>H4(s,r)),typeof n.toArray=="function"&&(n=n.toArray())):n=[H4(t,r)],Uo(i,n,e)}function ove(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>ove(r,e,i-1)):H4(t,e)}function M4e(t){return(e,i,r,n)=>{let s;if(e===null)s=null;else{s=ove(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}Uo(r,s,i)}}function $4e(t,e){return wJ(t,"any",e==null?void 0:e.origin)}function UH(t,e){return wJ(t,"read",e==null?void 0:e.origin)}function ave(t,e){return wJ(t,"write",e==null?void 0:e.origin)}function wJ(t,e,i){let r=t==null?void 0:t.json;if(r!=null&&r.origins&&i){let n;n=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],n&&(e==="any"||e in n)&&(r=n)}return r}function O4e(t){var i;const e=A4e(t);if(t.json.origins)for(const r in t.json.origins){const n=t.json.origins[r],s=n.types?R4e(n):e;ioe(s,n,!1),n.types&&!n.write&&((i=t.json.write)!=null&&i.enabled)&&(n.write={...t.json.write}),aoe(s,n)}ioe(e,t.json,!0),aoe(e,t.json)}function A4e(t){return t.json.types?zH(t.json):t.type?lve(t):zH(t)}function R4e(t){return t.type?lve(t):zH(t)}function lve(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!Q_e(i);)i=i[0],e++;return{type:i,ndimArray:e}}function zH(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function I4e(t){S4e(t)&&(y4e(t),O4e(t))}const y6=new Set,_6=new Set;function L(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,L4e(e);const i=[],r=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!y6.has(n.initialize)&&(y6.add(n.initialize),i.push(n.initialize)),n.hasOwnProperty("destroy")&&!_6.has(n.destroy)&&(_6.add(n.destroy),r.push(n.destroy)),n=Object.getPrototypeOf(n);y6.clear(),_6.clear();const s=class extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[x_e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};s.__accessorMetadata__=$3(e.prototype),s.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(s,"name",{value:o,configurable:!0}),s}}function P4e(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;i.mutable&&qt(r);const n=i.store;return n.has(t)?n.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function L4e(t){const e=t.prototype,i=$3(e),r={};for(const n of Object.getOwnPropertyNames(i)){const s=i[n];I4e(s),r[n]={enumerable:!0,configurable:!0,get:P4e(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(a.mutable)return a.initialized&&s.readOnly?loe("read-only",n):a.lifecycle===Rc.CONSTRUCTED&&s.constructOnly?loe("construct-only",n):void a.set(n,o)}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}const loe=(t,e)=>{de.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)};var cve,uve;function D4e(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Of=Symbol("Accessor-Handles"),VH=Symbol("Accessor-Initialized");let Ne=class fN{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}$3(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...g){if(s.prototype[a])return s.prototype[a].apply(this,g)};try{p=l.apply(this,c)}catch(g){throw this.inherited=h,g}return this.inherited=h,p}:e[a]}for(const a in i){const l=D4e(i[a]);f(l)(o.prototype,a)}return L(r)(o)}static freeze(e){return e instanceof fN?e.__accessor__.mutable=!1:Object.freeze(e),e}static isFrozen(e){return e instanceof fN?!e.__accessor__.mutable:Object.isFrozen(e)}constructor(...e){var r;if(this[cve]=null,this[uve]=!1,this.constructor===fN)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new pFe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=((r=this.normalizeCtorArgs)==null?void 0:r.apply(this,e))??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[VH]=!0}initialize(){}[x_e](){this[Of]=Ye(this[Of])}destroy(){var e;this.destroyed||(YFe(this),this.__accessor__.destroy(),(e=vFe())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[VH]}get destroyed(){var e;return((e=this.__accessor__)==null?void 0:e.lifecycle)===Rc.DESTROYED||!1}commitProperty(e){Vp(this,e)}get(e){return b_e(de.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Vp(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return k4(this,e,i),this}watch(e,i,r){return e4e(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const n of r)n.remove();return}(this[Of]??(this[Of]=new Dy)).add(e,i)}removeHandles(e){var i;(i=this[Of])==null||i.remove(e)}removeAllHandles(){var e;(e=this[Of])==null||e.removeAll()}removeHandlesReference(e){var i;(i=this[Of])==null||i.removeReference(e)}hasHandles(e){var i;return((i=this[Of])==null?void 0:i.has(e))===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};cve=Of,uve=VH;let N4e=class hve{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new hve;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,te(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??Ni.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var n;return((n=this._values.get(r))==null?void 0:n.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===Ni.DEFAULTS){const n=this._values.get(e);if((n==null?void 0:n.origin)!=null&&n.origin>r)return}this._values.set(e,new F4e(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Ni.DEFAULTS?e:Ni.USER}},F4e=class{constructor(e,i){this.value=e,this.origin=i}};function dve(t,e,i){e.keys().forEach(n=>{i.set(n,e.get(n),Ni.DEFAULTS)});const r=t.metadata;Object.keys(r).forEach(n=>{t.internalGet(n)&&i.set(n,t.internalGet(n),Ni.DEFAULTS)})}function k4e(t,e,i){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&jse(r,i))return!0}else for(const n of r)if(n===e||n.includes(".")&&n.indexOf(e)===0&&jse(n,i))return!0;return!1}function U4e(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function z4e(t,e,i,r,n){let s=UH(e[i],n);U4e(s)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))s=UH(e[o],n),k4e(s,i,r)&&(t[o]=!0)}function V4e(t,e,i,r){const n=i.metadata,s=$4e(n[e],r),o=s==null?void 0:s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const pve={origin:"service"};function fve(t,e,i=pve){if(!e||typeof e!="object")return;const r=bl(t),n=r.metadata,s={};for(const o of Object.getOwnPropertyNames(e))z4e(s,n,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(s)){const a=UH(n[o],i).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?M3(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||V4e(t,o,r,i)}r.setDefaultOrigin("user")}function mve(t,e,i,r=pve){var s;const n={...r,messages:[]};i(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?r!=null&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function B4e(t,e,i,r,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,s,i,n),s}function gve(t,e,i,r,n,s){if(!(r!=null&&r.write))return!1;const o=Vp(t,i);if(!n&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,s??void 0);a!==void 0&&(n=a)}if(n||(n=r.write),!n||n.enabled===!1||n.layerContainerTypes&&(s!=null&&s.layerContainerType)&&!n.layerContainerTypes.includes(s.layerContainerType))return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new Y("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&(s!=null&&s.messages)?s.messages.push(a):a&&!s&&de.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Ni.DEFAULTS)&&j4e(t,i,s,r,o)||!n.ignoreOrigin&&(s!=null&&s.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(i)<W_(s.origin))}function j4e(t,e,i,r,n){const s=r.default;if(s===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,i??void 0);return ym(o,n)}return!1}return s===n}function G4e(t,e,i,r){const n=bl(t),s=n.metadata,o=ave(s[e],r);return!!o&&gve(t,n,e,o,i,r)}function yve(t,e,i){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return uN(e,t.toJSON(i));const r=bl(t),n=r.metadata;for(const a in n){const l=ave(n[a],i);if(!gve(t,r,a,l,void 0,i))continue;const c=Vp(t,a),h=B4e(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(e=uN(e,h),(o=(s=i==null?void 0:i.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>uN(e,h,()=>"replace-arrays"))),i!=null&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:cFe(r.store.originOf(a)),newOrigin:i.origin}))}return e}const P3=t=>{let e=class extends t{constructor(...i){super(...i);const r=bl(this),n=r.store,s=new N4e;r.store=s,dve(r,n,s)}read(i,r){fve(this,i,r)}write(i,r){return yve(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return H4e.call(this,i,r)}};return e=u([L("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function H4e(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function W4(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let we=class extends P3(Ne){};we=u([L("esri.core.JSONSupport")],we);const q4e=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,W4e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function coe(t){const e=t==null?void 0:t.match(q4e);if(!e)return null;const[,i,r,n]=e;if(!i)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:h}=W4e;if(r)if(s=i,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function Z4e(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function _ve(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}function vve(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function Y4e(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const X4e=()=>de.getLogger("esri.core.urlUtils"),PC=Qr.request,uoe="esri/config: esriConfig.request.proxyUrl is not set.",wve=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,bve=/^\s*http:/i,J4e=/^\s*https:/i,Q4e=/^\s*file:/i,K4e=/:\d+$/,e5e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,t5e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),i5e=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let yb=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(t5e);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(i5e),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const DP={},r5e=new yb(Qr.applicationUrl);let _l=r5e;const n5e=s5e();let bJ=n5e;const xJ=()=>_l,$Rt=()=>bJ;function s5e(){const t=_l.path,e=t.slice(0,t.lastIndexOf("/")+1);return`${`${_l.scheme}://${_l.host}${_l.port!=null?`:${_l.port}`:""}`}${e}`}function _o(t){if(!t)return null;const e={path:null,query:null},i=new yb(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.slice(0,r),e.query=SJ(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.slice(0,e.path.length-(i.fragment.length+1)))),e}function SJ(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const n=r.indexOf("=");let s,o;n<0?(s=decodeURIComponent(r),o=""):(s=decodeURIComponent(r.slice(0,n)),o=decodeURIComponent(r.slice(n+1)));let a=i[s];typeof a=="string"&&(a=i[s]=[a]),Array.isArray(a)?a.push(o):i[s]=o}return i}function CR(t,e){return t?Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const n=encodeURIComponent(i)+"=",s=e==null?void 0:e[i];return s?n+encodeURIComponent(s(r)):Array.isArray(r)?r.map(o=>W4(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):W4(r)?n+encodeURIComponent(JSON.stringify(r)):n+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function xve(t=!1){let e,i=PC.proxyUrl;if(typeof t=="string"){e=$ve(t);const r=fU(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw X4e().warn(uoe),new Y("urlUtils:proxy-not-set",uoe);return e&&jH()&&(i=$J(i)),_o(i)}function ORt(t,e=!1){const i=fU(t);let r,n;if(i){const s=TJ(i.proxyUrl);r=s.path,n=s.query?SJ(s.query):null}else if(e){const s=xve(t);r=s.path,n=s.query}if(r){const s=_o(t);t=r+"?"+s.path;const o=CR({...n,...s.query});o&&(t=`${t}?${o}`)}return t}const XM={path:"",query:""};function TJ(t){const e=t.indexOf("?");return e!==-1?(XM.path=t.slice(0,e),XM.query=t.slice(e+1)):(XM.path=t,XM.query=null),XM}function Sve(t){return t=(t=Y4(t=f5e(t=TJ(t).path),!0)).toLowerCase()}function o5e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Sve(t.urlPrefix)},i=PC.proxyRules,r=e.urlPrefix;let n=i.length;for(let s=0;s<i.length;s++){const o=i[s].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;n=s;break}o.indexOf(r)===0&&(n=s+1)}return i.splice(n,0,e),n}function fU(t){const e=PC.proxyRules,i=Sve(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function Tve(t,e){if(!t||!e)return!1;t=Z4(t),e=Z4(e);const i=coe(t),r=coe(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&OE(t,e,!0)}function Eve(t,e){return t=Z4(t),e=Z4(e),Y4(t)===Y4(e)}function Z4(t){const e=(t=nd(t)).indexOf("/sharing");return e>0?t.slice(0,e):t.replace(/\/+$/,"")}function BH(t,e=PC.interceptors){const i=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r);if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function OE(t,e,i=!1){if(!t||!e)return!1;const r=HH(t),n=HH(e);return!(!i&&r.scheme!==n.scheme)&&r.host!=null&&n.host!=null&&r.host.toLowerCase()===n.host.toLowerCase()&&r.port===n.port}function EJ(t){if(typeof t=="string"){if(!Fu(t))return!0;t=HH(t)}if(OE(t,_l))return!0;const e=PC.trustedServers||[];for(let i=0;i<e.length;i++){const r=a5e(e[i]);for(let n=0;n<r.length;n++)if(OE(t,r[n]))return!0}return!1}function a5e(t){return DP[t]||(MJ(t)||_m(t)?DP[t]=[new yb(Iu(t))]:DP[t]=[new yb(`http://${t}`),new yb(`https://${t}`)]),DP[t]}function Iu(t,e=bJ,i){return _m(t)?i!=null&&i.preserveProtocolRelative?t:_l.scheme==="http"&&_l.authority===sd(t).slice(2)?`http:${t}`:`https:${t}`:MJ(t)?t:ld(t[0]==="/"?d5e(e):e,t)}function CJ(t,e=bJ,i){if(t==null||!Fu(t))return t;const r=nd(t),n=r.toLowerCase(),s=nd(e).toLowerCase().replace(/\/+$/,""),o=i?nd(i).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(p,g,y)=>(y=p.indexOf(g,y))===-1?p.length:y;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const h=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)t=`../${t}`;else t=`./${t}`;return t}function nd(t){return t=y5e(t=g5e(t=m5e(t=Iu(t=t.trim()))))}function ld(...t){const e=t.filter(Bv);if(!(e!=null&&e.length))return;const i=[];if(Fu(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(i.push(n.slice(0,s+1)),u5e(e[0])&&(i[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<r.length;n++){const s=r[n];s===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!s&&n===r.length-1||s&&(s!=="."||i.length===0))&&i.push(s)}return i.join("/")}function sd(t,e=!1){if(t==null||AE(t)||Rm(t))return null;let i=t.indexOf("://");if(i===-1&&_m(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=Y4(t,!0)),t}function Fu(t){return _m(t)||MJ(t)}function AE(t){return t!=null&&t.slice(0,5)==="blob:"}function Rm(t){return t!=null&&t.slice(0,5)==="data:"}function Cve(t){const e=RE(t);return e!=null&&e.isBase64?vve(e.data):null}function ARt(t){return Y4e(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const l5e=/^data:(.*?)(;base64)?,(.*)$/;function RE(t){const e=t.match(l5e);if(!e)return null;const[,i,r,n]=e;return{mediaType:i,isBase64:!!r,data:n}}function Mve(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function RRt(t){return(await fetch(t)).blob()}function IRt(t){const e=Cve(t);if(!e)return null;const i=RE(t);return new Blob([e],{type:i.mediaType})}function _m(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function MJ(t){return t!=null&&wve.test(t)}function $ve(t){return t!=null&&J4e.test(t)||_l.scheme==="https"&&_m(t)}function c5e(t){return t!=null&&bve.test(t)||_l.scheme==="http"&&_m(t)}function u5e(t){return t!=null&&Q4e.test(t)}function $J(t){return _m(t)?`https:${t}`:t.replace(bve,"https:")}function h5e(){return _l.scheme==="http"}function jH(){return _l.scheme==="https"}function Y4(t,e=!1){return _m(t)?t.slice(2):(t=t.replace(wve,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function d5e(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function p5e(t){let e=0;if(Fu(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function PRt(t,e){if(!t)return"";const i=_o(t).path.replace(/\/+$/,""),r=i.slice(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const n=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(n,"")}function f5e(t){return t.endsWith("/")?t:`${t}/`}function Ove(t){return t.replace(/\/+$/,"")}function m5e(t){if(/^https?:\/\//i.test(t)){const e=TJ(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function g5e(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function y5e(t){const e=PC.httpsDomains;if(!c5e(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),K4e.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return h5e()&&r===_l.authority&&!e5e.test(t)||(jH()&&r===_l.authority||e&&e.some(n=>r===n||r.endsWith(`.${n}`))||jH()&&!fU(t))&&(t=$J(t)),t}function GH(t,e,i){if(!(e&&i&&t&&Fu(t)))return t;const r=t.indexOf("//"),n=t.indexOf("/",r+2),s=t.indexOf(":",r+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function HH(t){return typeof t=="string"?new yb(Iu(t)):(t.scheme||(t.scheme=_l.scheme),t)}function Ave(t){return v5e.test(t)}function Rve(t,e){const i=_o(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function Ive(t,e,i){const r=_o(t),n=r.query||{};return n[e]=String(i),`${r.path}?${CR(n)}`}function v6(t,e){if(!e)return t;const i=_o(t),r=i.query||{};for(const[s,o]of Object.entries(e))o!=null&&(r[s]=o);const n=CR(r);return n?`${i.path}?${n}`:i.path}function _5e(t){if(t==null)return null;const e=t.match(Pve);return e?e[2]:null}function hoe(t){if(t==null)return null;const e=t.match(Pve);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function LRt(t){return typeof t=="string"?RE(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(RE(r.result)),r.onerror=n=>i(n)})}const Pve=/([^.]*)\.([^/]*)$/,v5e=/(^data:image\/svg|\.svg$)/i,Lve="20241122",Dve="f6f7099a0e79cf518abdcf87c5aa8b6f24ecdcd8";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const Nve="4.31";let Gi,OJ=Nve;OJ="4.31.6";function DRt(t){Gi=t}function NRt(t){const e=Gi==null?void 0:Gi.findCredential(t);return e!=null&&e.token?Ive(t,"token",e.token):t}pe("host-webworker")||globalThis.$arcgis||Object.defineProperty(globalThis,"$arcgis",{configurable:!1,enumerable:!0,writable:!1,value:{}}),pe("host-webworker");const w5e=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function b5e(t){const e=sd(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!w5e.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function Fve(t,e){return!(!Qr.apiKey||!b5e(t))}function kve(t,e,i=!1,r){return new Promise((n,s)=>{if(zo(r))return void s(doe());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),n(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",s(doe())};const c=()=>{pe("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r!=null&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r!=null&&r.addEventListener("abort",l),pe("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function doe(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Uve="Timeout exceeded";function x5e(){return new Error(Uve)}function FRt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Uve}function S5e(t){Qr.request.crossOriginNoCorsDomains||(Qr.request.crossOriginNoCorsDomains={});const e=Qr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[sd(i)??""]=0:(e[sd("http://"+i)??""]=0,e[sd("https://"+i)??""]=0)}function T5e(t){const e=Qr.request.crossOriginNoCorsDomains;if(e){let i=sd(t);if(i)return i=i.toLowerCase(),!OE(i,xJ())&&e[i]<Date.now()-36e5}return!1}async function E5e(t){var n;const e=_o(t);t=e.path,((n=e.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}const i=Qr.request.crossOriginNoCorsDomains,r=sd(t);i&&r&&(i[r.toLowerCase()]=Date.now())}async function Br(t,e){var g;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=SJ(e.query.toString().replaceAll("+"," ")));const i=Rm(t),r=AE(t);r||i||(t=nd(t));const n={url:t,requestOptions:{...e}},s=y=>({data:y,getAllHeaders:IE,getHeader:IE,httpStatus:200,requestOptions:n.requestOptions,url:n.url}),o=BH(t,Fh.internalInterceptors);if(o){const y=await foe(o,n);if(y!=null)return s(y)}let a=BH(t);if(a){const y=await foe(a,n);if(y!=null)return s(y);a.after||a.error||(a=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(pe("host-webworker")||pe("host-node")))throw dm("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw dm("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(i||r)throw dm("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await A5e(),X4)return X4.execute(t,e);const l=new AbortController,c=_a(e,()=>l.abort()),h={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:n,redoRequest:!1,useIdentity:Fh.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},p=await L5e(h).finally(()=>c==null?void 0:c.remove());return(g=a==null?void 0:a.after)==null||g.call(a,p),p}let X4;const Fh=Qr.request,zve="FormData"in globalThis,C5e=new Set([499,498,403,401]),M5e=new Set(["COM_0056","COM_0057","SB_0008"]),$5e=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],IE=()=>null,J4=Symbol();function O5e(t){const e=sd(t);e&&!Br._corsServers.includes(e)&&Br._corsServers.push(e)}function poe(t){const e=sd(t);return!e||e.endsWith(".arcgis.com")||Br._corsServers.includes(e)||EJ(e)}function dm(t,e,i,r){let n="Error";const s={url:i.url,requestOptions:i.requestOptions,getAllHeaders:IE,getHeader:IE,ssl:!1};if(e instanceof Y)return e.details?(e.details=te(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=s,e;if(e){const o=r&&(()=>Array.from(r.headers)),a=r&&(h=>r.headers.get(h)),l=r==null?void 0:r.status,c=e.message;c&&(n=c),o&&a&&(s.getAllHeaders=o,s.getHeader=a),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=J4 in e?e[J4]:e}return Bn(e)?ki():new Y(t,n,s)}async function A5e(){pe("host-webworker")&&!X4&&(X4=await fe(()=>import("./request-D5-8EmwA.js"),[]))}async function qH(){Gi||await fe(()=>import("./IdentityManager-CZGp12B0.js"),__vite__mapDeps([0,1]))}async function R5e(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,n=i.body;let s=null,o=null;if(zve&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Fh.priority,redirect:"follow",signal:r},(s||o)&&(t.fetchOptions.body=s||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&Fve(e)&&(i.query||(i.query={}),i.query.token=Qr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!Vve(e)&&!zo(r)){let l;i.authMode==="immediate"?(await qH(),l=await Gi.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await qH(),l=await Gi.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):Gi&&(l=Gi.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function Vve(t){return $5e.some(e=>e.test(t))}async function I5e(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},n=AE(e)||Rm(e),s=i.responseType||"json",o=n?0:i.timeout!=null?i.timeout:Fh.timeout;let a=!1;if(!n){t.useSSL&&(e=$J(e));let g={...i.query};t.credentialToken&&(g.token=t.credentialToken);let y=CR(g);pe("esri-url-encodes-apostrophe")&&(y=y.replaceAll("'","%27"));const w=e.length+1+y.length;let b;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||w>Fh.maxUrlLength;const x=i.useProxy||!!fU(e);if(x){const T=xve(e);b=T.path,!a&&b.length+1+w>Fh.maxUrlLength&&(a=!0),T.query&&(g={...T.query,...g})}if(r.method==="HEAD"&&(a||x)){if(a)throw w>Fh.maxUrlLength?dm("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):dm("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(x)throw dm("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=v6(e,g):(r.body=CR(g),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=v6(e,g),x&&(t.useProxy=!0,e=`${b}?${e}`),g.token&&zve&&r.body instanceof FormData&&!Z4e(e)&&r.body.set("token",g.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!OE(e,xJ())){if(EJ(e))t.withCredentials=!0;else if(Gi){const T=Gi.findServerInfo(e);T!=null&&T.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",T5e(e)&&await E5e(a?v6(e,g):e))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e,i.signal?c.signal=i.signal:delete c.signal;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||P5e(i.headers)||!n&&!t.useProxy&&Fh.proxyUrl&&!poe(e)){if(Br._beforeFetch&&await Br._beforeFetch(e,r),l=await fetch(e,r),Br._afterFetch&&await Br._afterFetch(l),t.useProxy||O5e(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=moe(c,"application/xml");break;case"document":c=moe(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const g=l.headers.get("Content-Type");if(g&&/application\/json|text\/plain/i.test(g)&&c[s==="blob"?"size":"byteLength"]<=750)try{const y=await new Response(c).json();y.error&&(c=y)}catch{}}s==="image"&&c instanceof Blob&&(c=await goe(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await goe(e,t)}catch(g){if(g.name==="AbortError")throw p?x5e():ki("Request canceled");if(!(!l&&g instanceof TypeError&&Fh.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||poe(e))throw g;t.redoRequest=!0,o5e({proxyUrl:Fh.proxyUrl,urlPrefix:sd(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function foe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(n){i=dm("request:interceptor",n,e)}if((r instanceof Error||r instanceof Y)&&(i=dm("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function P5e(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function moe(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function L5e(t){var s,o;let e,i;await R5e(t);try{do[e,i]=await I5e(t);while(!await D5e(t,e,i))}catch(a){const l=dm("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(s=t.interceptor)!=null&&s.error&&t.interceptor.error(l),l}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((o=i.user)!=null&&o.username)&&!EJ(r)){const a=sd(r,!0);a&&Fh.trustedServers.push(a)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&S5e(i.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&Gi){const a=Gi.findServerInfo(n.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Gi.findCredential(l,n.userId);c&&Gi._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):IE,getHeader:e?a=>e.headers.get(a):IE,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function D5e(t,e,i){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let n,s;if(i&&(i.error&&typeof i.error=="object"?n=i.error:i.status==="error"&&Array.isArray(i.messages)&&(n={...i},n[J4]=i,n.details=i.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[J4]=i,n;let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o==null?void 0:o.toUpperCase());const l=r.authMode;if(s===403&&(a===4||(c=n.message)!=null&&c.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&C5e.has(s)&&!Vve(t.params.url)&&(s!==403||(!o||!M5e.has(o))&&(a==null||a===2&&t.credentialToken))){await qH();try{const h=await Gi.getCredential(t.params.url,{error:dm("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=h,t.credentialToken=h.token,t.useSSL=t.useSSL||h.ssl,!1}catch(h){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=h}}if(n)throw n;return!0}function goe(t,e,i=!1){const r=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=Fh.priority,n.src=t,kve(n,t,i,r)}Br._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Br._beforeFetch=void 0,Br._afterFetch=void 0;let mN=class Bve{constructor(){this._emitter=new Bve.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){var n;(n=this._listenersMap)==null||n.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){var c;let o=(c=this._listenersMap)==null?void 0:c.get(n);if(!o)return!1;const a=this._target||this;let l=!1;for(const h of o.slice()){const p="deref"in h?h.deref():h;p?p==null||p.call(a,s):l=!0}return l&&(o=o.filter(h=>!("deref"in h)||h.deref()!=null),this._listenersMap.set(n,o)),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return Fb(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),Ui(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(n),l=(a==null?void 0:a.indexOf(s))??-1;l>=0&&a.splice(l,1)})}once(n,s){const o=this.on(n,a=>{o.remove();const l="deref"in s?s.deref():s;l==null||l.call(null,a)});return o}hasEventListener(n){var o;const s=(o=this._listenersMap)==null?void 0:o.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let n=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=u([L("esri.core.Evented")],n),n};let i=class extends Ne{constructor(){super(...arguments),this._emitter=new mN.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,n){return this._emitter.emit(r,n)}on(r,n){return this._emitter.on(r,n)}once(r,n){return this._emitter.once(r,n)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([L("esri.core.Evented.EventedAccessor")],i),t.EventedAccessor=i})(mN||(mN={}));const ns=mN;var Pr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Pr||(Pr={}));function AJ(t){return(e,i)=>{e[i]=t}}let L3=class extends $_e{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Zg;let N5e=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},F5e=class{constructor(e,i,r,n,s){this.target=e,this.added=i,this.removed=r,this.start=n,this.deleteCount=s}};const nh=new xl(N5e,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function yoe(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function w6(t){return t?t instanceof Vg?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function b6(t){if(t!=null&&t.length)return t[0]}function k5e(t,e,i,r){const n=Math.min(t.length-i,e.length-r);let s=0;for(;s<n&&t[i+s]===e[r+s];)s++;return s}function jve(t,e,i,r){e&&e.forEach((n,s,o)=>{t.push(n),jve(t,i.call(r,n,s,o),i,r)})}const y0=new Set,_0=new Set,v0=new Set,x6=new Map;let U5e=0,Vg=Zg=class extends ns.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Zg}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new L3,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:U5e++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Zg?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return qt(this._observable),this._items}set items(t){this._emitBeforeChanges(Pr.ADD)||(this._splice(0,this.length,w6(t)),this._emitAfterChanges(Pr.ADD))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t))}on(t,e){if(this.destroyed)return Ui();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Ui(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,n=>{var s;(s=i())==null||s.call(null,n),r.remove()});return r}add(t,e){if(qt(this._observable),this._emitBeforeChanges(Pr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Pr.ADD),this}addMany(t,e=this._items.length){if(qt(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(Pr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,w6(t)),this._emitAfterChanges(Pr.ADD),this}at(t){if(qt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(qt(this._observable),!this.length||this._emitBeforeChanges(Pr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Pr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return qt(this._observable),this._createNewInstance({items:this._items.map(te)})}concat(...t){qt(this._observable);const e=t.map(w6);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(qt(this._observable),!this.length||this._emitBeforeChanges(Pr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let n=0;n<r;n++)t.call(e,i[n],n,i);this._emitAfterChanges(Pr.REMOVE)}destroyAll(){this.drain(yoe)}destroyMany(t){const e=this.removeMany(t);return e.forEach(yoe),e}every(t,e){return qt(this._observable),this._items.every(t,e)}filter(t,e){let i;return qt(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return qt(this._observable),this._items.find(t,e)}findIndex(t,e){return qt(this._observable),this._items.findIndex(t,e)}flatten(t,e){qt(this._observable);const i=[];return jve(i,this,t,e),new Zg(i)}forEach(t,e){return qt(this._observable),this._items.forEach(t,e)}getItemAt(t){return qt(this._observable),this._items[t]}getNextIndex(t){qt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return qt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return qt(this._observable),this._items.indexOf(t,e)}join(t=","){return qt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return qt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){qt(this._observable);const i=this._items.map(t,e);return new Zg({items:i})}reorder(t,e=this.length-1){qt(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Pr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Pr.MOVE)}return t}}pop(){if(qt(this._observable),!this.length||this._emitBeforeChanges(Pr.REMOVE))return;const t=b6(this._splice(this.length-1,1));return this._emitAfterChanges(Pr.REMOVE),t}push(...t){return qt(this._observable),this._emitBeforeChanges(Pr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Pr.ADD)),this.length}reduce(t,e){qt(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){qt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return qt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(qt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Pr.REMOVE))return;const e=b6(this._splice(t,1));return this._emitAfterChanges(Pr.REMOVE),e}removeMany(t){if(qt(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(Pr.REMOVE))return[];const e=t instanceof Zg?t.toArray():t,i=this._items,r=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=i.indexOf(o);if(a>-1){const l=1+k5e(e,i,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),s+=l-1}}return this._emitAfterChanges(Pr.REMOVE),r}reverse(){if(qt(this._observable),this._emitBeforeChanges(Pr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Pr.MOVE),this}shift(){if(qt(this._observable),!this.length||this._emitBeforeChanges(Pr.REMOVE))return;const t=b6(this._splice(0,1));return this._emitAfterChanges(Pr.REMOVE),t}slice(t=0,e=this.length){return qt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return qt(this._observable),this._items.some(t,e)}sort(t){if(qt(this._observable),!this.length||this._emitBeforeChanges(Pr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Pr.MOVE),this}splice(t,e,...i){qt(this._observable);const r=(e?Pr.REMOVE:0)|(i.length?Pr.ADD:0);if(this._emitBeforeChanges(r))return[];const n=this._splice(t,e,i)||[];return this._emitAfterChanges(r),n}toArray(){return qt(this._observable),this._items.slice()}toJSON(){return qt(this._observable),this.toArray()}toLocaleString(){return qt(this._observable),this._items.toLocaleString()}toString(){return qt(this._observable),this._items.toString()}unshift(...t){return qt(this._observable),!t.length||this._emitBeforeChanges(Pr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Pr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=AC(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=nh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,s),t+=1,l-=1,c-=1);nh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=nh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);nh.release(a)}}if(i!=null&&i.length){if(n){const h=[];for(const p of i){const g=n.ensureType(p);g==null&&p!=null||h.push(g)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=nh.acquire();h.target=this,h.cancellable=!0;const p=nh.acquire();p.target=this,p.cancellable=!1;for(const g of i)a?(h.reset(g),this.emit("before-add",h),h.defaultPrevented||(c?r.push(g):r.splice(t++,0,g),this._set("length",r.length),l&&(p.reset(g),this.emit("after-add",p)))):(c?r.push(g):r.splice(t++,0,g),this._set("length",r.length),p.reset(g),this.emit("after-add",p));nh.release(p),nh.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(t,0,...i);this._set("length",r.length)}}if((i!=null&&i.length||o!=null&&o.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new F5e(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=nh.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,nh.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=nh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),nh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;y0.clear(),_0.clear(),v0.clear();for(const{added:l,removed:c}of i){if(l)if(v0.size===0&&_0.size===0)for(const h of l)y0.add(h);else for(const h of l)_0.has(h)?(v0.add(h),_0.delete(h)):v0.has(h)||y0.add(h);if(c)if(v0.size===0&&y0.size===0)for(const h of c)_0.add(h);else for(const h of c)y0.has(h)?y0.delete(h):(v0.delete(h),_0.add(h))}const r=Ic.acquire();y0.forEach(l=>{r.push(l)});const n=Ic.acquire();_0.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=Ic.acquire();if(v0.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||n.length||a.length)){const l={target:this,added:r,removed:n,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const p=e.listeners[h];p.removed||p.callback.call(this,l)}}Ic.release(r),Ic.release(n),Ic.release(a)}y0.clear(),_0.clear(),v0.clear()}};Vg.ofType=t=>{if(!t)return Zg;if(x6.has(t))return x6.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const n=t.typeMap[r].prototype.declaredClass;e?e+=` | ${n}`:e=n}let i=class extends Zg{};return u([AJ({Type:t,ensureType:typeof t=="function"?is(t):Bu(t)})],i.prototype,"itemType",void 0),i=u([L(`esri.core.Collection<${e}>`)],i),x6.set(t,i),i},u([f()],Vg.prototype,"_updating",void 0),u([f()],Vg.prototype,"length",void 0),u([f()],Vg.prototype,"items",null),u([f({readOnly:!0})],Vg.prototype,"updating",null),Vg=Zg=u([L("esri.core.Collection")],Vg);const ot=Vg;function vm(t,e,i=ot){return e||(e=new i),e===t||(e.removeAll(),z5e(t)?e.addMany(t):t&&e.add(t)),e}function RJ(t){return t}function z5e(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var $_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})($_||($_={}));let V5e=class{constructor(){this._resolver=Ho(),this._status=$_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=$_.RESOLVED,this._cleanUp()},()=>{this._status=$_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===$_.RESOLVED}isRejected(){return this._status===$_.REJECTED}isFulfilled(){return this._status!==$_.PENDING}abort(){this._resolver.reject(ki())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Ho(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==r||Bn(n)||this._resolver.reject(n)}),e.resolve()}};const D3=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new V5e,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=u([L("esri.core.Promise")],e),e};let Q4=class extends D3(Ne){};Q4=u([L("esri.core.Promise")],Q4);const B5e="not-loaded",j5e="loading",G5e="failed",_oe="loaded",Gve=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=R3(s,l);this.destroyed&&l(new Y("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===B5e){this._set("loadStatus",j5e);const a=this._loadController=new AbortController;n({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",_oe),this._loadController=null},r=>{this._set("loadStatus",G5e),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=jc(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===_oe}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new Y("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort(),this._promiseProps.abort()),this}};return u([f({readOnly:!0})],e.prototype,"loaded",null),u([f({readOnly:!0})],e.prototype,"loadError",void 0),u([f({clonable:!1})],e.prototype,"loadStatus",void 0),u([f({type:[Yp],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([L("esri.core.Loadable")],e),e};let tO=class extends Gve(Q4){};tO=u([L("esri.core.Loadable")],tO),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=Gve,t.isLoadable=e}(tO||(tO={}));const wm=tO;function IJ(t,e,i){return lU(t.map((r,n)=>e.apply(i,[r,n])))}async function H5e(t,e,i){return(await lU(t.map((r,n)=>e.apply(i,[r,n])))).map(r=>r.value)}function PJ(t){return{ok:!0,value:t}}function LJ(t){return{ok:!1,error:t}}function q5e(t){return t!=null&&t.ok===!0?t.value:null}function W5e(t){return t!=null&&t.ok===!1?t.error:null}async function Xp(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return PJ(await t)}catch(e){return LJ(e)}}async function Z5e(t){try{return PJ(await t)}catch(e){return Pc(e),LJ(e)}}function GRt(t){if(t.ok===!0)return t.value;throw t.error}function Ny(t,e){return new Y0(t,e)}let Y0=class extends Ne{get value(){return q5e(this._result)}get error(){return W5e(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=jc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(n=>{this._result=PJ(n),this._cleanup()},n=>{this._result=LJ(n),this._cleanup()}),this._abortHandle=_a(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Sr(this._abortHandle),this._abortController=null}};u([f()],Y0.prototype,"value",null),u([f()],Y0.prototype,"error",null),u([f()],Y0.prototype,"finished",null),u([f()],Y0.prototype,"promise",void 0),u([f()],Y0.prototype,"_result",void 0),Y0=u([L("esri.core.asyncUtils.ReactiveTask")],Y0);async function DJ(t,e){return await t.load(),Y5e(t,e)}async function Y5e(t,e){const i=[],r=(...s)=>{for(const o of s)o!=null&&(Array.isArray(o)?r(...o):ot.isCollection(o)?o.forEach(a=>r(a)):wm.isLoadable(o)&&i.push(o))};e(r);let n=null;if(await H5e(i,async s=>{const o=await Xp(X5e(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function X5e(t){return"loadAll"in t&&typeof t.loadAll=="function"}function ke(t,e,i){let r,n;return e===void 0?(n=t,r=[void 0]):typeof e!="string"?(n=t,r=[void 0],i=e):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of r){const c=eve(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let sr=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=J5e(e),this.apiValues=voe(this._apiToJSON),this.jsonValues=voe(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,n,s)=>{const o=this.toJSON(r);o!==void 0&&Uo(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function J5e(t){const e={};for(const i in t)e[t[i]]=i;return e}function voe(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function Za(){return function(t,e){return new sr(t,{ignoreUnknown:!0,...e})}}let NJ=class{constructor(e,i,r,n,s,o){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r,this.atmosphereHeight=n,this.scaleHeight=s;const a=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*a,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=o||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Ii=new NJ(6378137,1/298.257223563,3e5,1e5,.085,.006694379990137799),Bp=new NJ(3396190,1/169.8944472236118,23e4,6e4,.111),vy=new NJ(1737400,0,0,0,0);function Q5e(t,e){return Br(vr(t),e)}function vr(t){if(!Qr.assetsPath)throw de.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new Y("assets:path-not-set","config.assetsPath is not set");return ld(Qr.assetsPath,t)}let S6,ie=null;function Hve(){return!!ie}function K5e(){return!!pe("esri-wasm")}function qve(){return S6||(S6=fe(()=>import("./pe-wasm-ihfvgCko.js"),__vite__mapDeps([2,3])).then(t=>t.p).then(({default:t})=>t({locateFile:e=>vr(`esri/geometry/support/${e}`)})).then(t=>{Yve(t)}),S6)}var WH,Qn;(function(t){function e(s,o,a){ie.ensureCache.prepare();const l=Ww(a),c=a===l,h=ie.ensureFloat64(l),p=ie._pe_geog_to_proj(ie.getPointer(s),o,h);return p&&F_(a,o,h,c),p}function i(s,o,a,l){switch(l){case Qn.PE_TRANSFORM_P_TO_G:return r(s,o,a);case Qn.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function r(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){ie.ensureCache.prepare();const c=Ww(a),h=a===c,p=ie.ensureFloat64(c),g=ie._pe_proj_to_geog_center(ie.getPointer(s),o,p,l);return g&&F_(a,o,p,h),g}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=n})(WH||(WH={})),function(t){function e(){t.PE_BUFFER_MAX=ie.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ie.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ie.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ie.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ie.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ie.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ie.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ie.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ie.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ie.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ie.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ie.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ie.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ie.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ie.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ie.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ie.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ie.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ie.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ie.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=ie.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=ie.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=ie.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ie.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ie.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ie.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ie.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ie.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ie.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ie.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ie.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ie.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Qn||(Qn={}));let Wve=null;var ZH;(function(t){const e={},i={},r=y=>{const w=y.getType();switch(w){case Qn.PE_TYPE_GEOGCS:y=ie.castObject(y,ie.PeGeogcs);break;case Qn.PE_TYPE_PROJCS:y=ie.castObject(y,ie.PeProjcs);break;case Qn.PE_TYPE_GEOGTRAN:y=ie.castObject(y,ie.PeGeogtran);break;default:w&Qn.PE_TYPE_UNIT&&(y=ie.castObject(y,ie.PeUnit))}return y};function n(){ie.PeFactory.prototype.initialize(null)}function s(y){return o(Qn.PE_TYPE_COORDSYS,y)}function o(y,w){let b=null,x=e[y];if(x||(x={},e[y]=x),x.hasOwnProperty(String(w))&&(b=x[w],ie.compare(b,ie.NULL)&&(b=null)),!b){const T=ie.PeFactory.prototype.factoryByType(y,w);ie.compare(T,ie.NULL)||(b=r(T),x[w]=b)}return b}function a(y,w){let b=null,x=i[y];if(x||(x={},i[y]=x),x.hasOwnProperty(w)&&(b=x[w],ie.compare(b,ie.NULL)&&(b=null)),!b){const T=ie.PeFactory.prototype.fromString(y,w);ie.compare(T,ie.NULL)||(b=r(T),x[w]=b)}return b}function l(y){return o(Qn.PE_TYPE_GEOGCS,y)}function c(y){return o(Qn.PE_TYPE_GEOGTRAN,y)}function h(y){return ie.PeFactory.prototype.getCode(y)}function p(y){return o(Qn.PE_TYPE_PROJCS,y)}function g(y){return o(Qn.PE_TYPE_UNIT,y)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=p,t.unit=g})(ZH||(ZH={}));let Zve=null;var K4,YH,XH,JH,QH,KH,e5,e9,t5,i5,t9;function Yve(t){function e(s,o,a){s[o]=a(s[o])}ie=t,Qn.init(),K4.init(),e5.init(),t5.init(),i5.init(),Wve=class extends ie.PeDouble{constructor(s=NaN){super(s)}destroy(){ie.destroy(this)}[Symbol.dispose](){this.destroy()}},Zve=class extends ie.PeGCSExtent{destroy(){ie.destroy(this)}[Symbol.dispose](){this.destroy()}};const i=[ie.PeAngunit,ie.PeDatum,ie.PeGeogcs,ie.PeGeogtran,ie.PeObject,ie.PeParameter,ie.PePrimem,ie.PeProjcs,ie.PeSpheroid,ie.PeUnit];for(const s of i)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(Qn.PE_NAME_MAX))});for(const s of[ie.PeGeogtran,ie.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(Qn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ie.getValue(l,"*");a[c]=h?ie.wrapPointer(h,ie.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ie.PeHorizon.prototype,"getCoord",s=>function(o=!1){const a=this.getSize();if(!a)return null;const l=[];return F_(l,a,s.call(this),o),l}),e(ie.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=ie._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!ie.compare(l,ie.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ie.getPointer(l);for(let p=1;p<c;p++)a.push(ie.wrapPointer(h+o*p,ie.PeGTlistExtendedGTs))}}return a}});const r=ie._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!ie.compare(l,ie.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ie.getPointer(l);for(let p=1;p<c;p++)a.push(ie.wrapPointer(h+r*p,ie.PeHorizon))}}return o.set(s,a),a};e(ie.PeProjcs.prototype,"horizonGcsGenerate",n),e(ie.PeProjcs.prototype,"horizonPcsGenerate",n),ie.PeObject.prototype.toString=function(s=Qn.PE_STR_OPTS_NONE){ie.ensureCache.prepare();const o=ie.getPointer(this),a=ie.ensureInt8(new Array(Qn.PE_BUFFER_MAX));return ie.UTF8ToString(ie._pe_object_to_string_ext(o,s,a))},ie.PeGeogcs.prototype.destroy=function(){this.Delete(),dp(this),this.ptr=0},ie.PeGeogcs.prototype[Symbol.dispose]=function(){this.destroy()},ie.PeProjcs.prototype.destroy=function(){this.Delete(),dp(this),this.ptr=0},ie.PeProjcs.prototype[Symbol.dispose]=function(){this.destroy()}}function dp(t){if(!t)return;const e=ie.getClass(t);if(!e)return;const i=ie.getCache(e);if(!i)return;const r=ie.getPointer(t);r&&delete i[r]}function NP(t,e){const i=[],r=new Array(e);for(let n=0;n<t;n++)i.push(ie.ensureInt8(r));return i}function Ww(t){return ArrayBuffer.isView(t)?t:Array.isArray(t[0])?t.flat():t}function F_(t,e,i,r=!1){if(r)for(let n=0;n<2*e;n++)t[n]=ie.getValue(i+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=ie.getValue(i,"double"),t[s][1]=ie.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=ie.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ie._pe_getPeGTlistExtendedEntrySize()}function r(n,s,o,a,l,c){let h=null;const p=new ie.PeInteger(c);try{const g=ie.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,p);if((c=p.val)&&(h=[g],c>1)){const y=ie.getPointer(g);for(let w=1;w<c;w++)h.push(ie.wrapPointer(y+e*w,ie.PeGTlistExtendedEntry))}}finally{ie.destroy(p)}return h}t.init=i,t.getGTlist=r})(K4||(K4={})),function(t){function e(i){if(i!=null&&i.length){for(const r of i)dp(r),r.getEntries().forEach(n=>{dp(n);const s=n.getGeogtran();dp(s),s.getParameters().forEach(dp),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{dp(o);const a=o.getDatum();dp(a),dp(a.getSpheroid()),dp(o.getPrimem()),dp(o.getUnit())})});ie.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(YH||(YH={})),function(t){function e(i,r,n,s,o){ie.ensureCache.prepare();const a=Ww(n),l=n===a,c=ie.ensureFloat64(a);let h=0;s&&(h=ie.ensureFloat64(s));const p=ie._pe_geog_to_geog(ie.getPointer(i),r,c,h,o);return p&&F_(n,r,c,l),p}t.geogToGeog=e}(XH||(XH={})),function(t){function e(s,o,a,l,c,h,p,g){ie.PeLineType.prototype.geodesic_coordinate(s,o,a,l,c,h,p,g)}function i(s,o,a,l,c,h,p,g,y){ie.PeLineType.prototype.geodetic_coordinate(s,o,a,l,c,h,p,g,y)}function r(s,o,a,l,c,h,p,g,y,w){ie.PeLineType.prototype.geodetic_distance(s,o,a,l,c,h,p,g,y,w)}function n(s,o,a,l,c,h,p,g,y){ie.PeLineType.prototype.great_elliptic_distance(s,o,a,l,c,h,p,g,y)}t.geodesicCoordinate=e,t.geodeticCoordinate=i,t.geodeticDistance=r,t.greatEllipticDistance=n}(JH||(JH={})),function(t){function e(o,a){return ie.PeMath.prototype.phi_to_eta(o,a)}function i(o,a){return ie.PeMath.prototype.eta_to_phi(o,a)}function r(o,a){return ie.PeMath.prototype.phi_to_phig(o,a)}function n(o,a,l){return ie.PeMath.prototype.q(o,a,l)}function s(o,a){return ie.PeMath.prototype.q90(o,a)}t.phiToEta=e,t.etaToPhi=i,t.phiToPhig=r,t.q=n,t.q90=s}(QH||(QH={})),function(t){const e=(c,h,p,g,y,w)=>{let b,x;switch(ie.ensureCache.prepare(),c){case"dd":b=ie._pe_geog_to_dd,x=Qn.PE_DD_MAX;break;case"ddm":b=ie._pe_geog_to_ddm,x=Qn.PE_DDM_MAX;break;case"dms":b=ie._pe_geog_to_dms,x=Qn.PE_DMS_MAX}let T=0;h&&(T=ie.getPointer(h));const M=Ww(g),$=ie.ensureFloat64(M),R=NP(p,x),I=b(T,p,$,y,ie.ensureInt32(R));if(I)for(let P=0;P<p;P++)w[P]=ie.UTF8ToString(R[P]);return I},i=(c,h,p,g,y)=>{let w;switch(ie.ensureCache.prepare(),c){case"dd":w=ie._pe_dd_to_geog;break;case"ddm":w=ie._pe_ddm_to_geog;break;case"dms":w=ie._pe_dms_to_geog}let b=0;h&&(b=ie.getPointer(h));const x=g.map(R=>ie.ensureString(R)),T=ie.ensureInt32(x),M=ie.ensureFloat64(new Array(2*p)),$=w(b,p,T,M);return $&&F_(y,p,M),$};function r(c,h,p,g,y){return e("dms",c,h,p,g,y)}function n(c,h,p,g){return i("dms",c,h,p,g)}function s(c,h,p,g,y){return e("ddm",c,h,p,g,y)}function o(c,h,p,g){return i("ddm",c,h,p,g)}function a(c,h,p,g,y){return e("dd",c,h,p,g,y)}function l(c,h,p,g){return i("dd",c,h,p,g)}t.geogToDms=r,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(KH||(KH={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ie.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ie.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ie.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ie.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ie.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(n,s,o,a,l,c,h){ie.ensureCache.prepare();let p=0;n&&(p=ie.getPointer(n));const g=Ww(o),y=ie.ensureFloat64(g),w=NP(s,Qn.PE_MGRS_MAX),b=ie.ensureInt32(w),x=ie._pe_geog_to_mgrs_extended(p,s,y,a,l,c,b);if(x)for(let T=0;T<s;T++)h[T]=ie.UTF8ToString(w[T]);return x}function r(n,s,o,a,l){ie.ensureCache.prepare();let c=0;n&&(c=ie.getPointer(n));const h=o.map(w=>ie.ensureString(w)),p=ie.ensureInt32(h),g=ie.ensureFloat64(new Array(2*s)),y=ie._pe_mgrs_to_geog_extended(c,s,p,a,g);return y&&F_(l,s,g),y}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(e5||(e5={})),function(t){function e(r,n,s,o,a,l,c){ie.ensureCache.prepare();let h=0;r&&(h=ie.getPointer(r));const p=Ww(s),g=ie.ensureFloat64(p),y=NP(n,Qn.PE_MGRS_MAX),w=ie.ensureInt32(y),b=ie._pe_geog_to_usng(h,n,g,o,a,l,w);if(b)for(let x=0;x<n;x++)c[x]=ie.UTF8ToString(y[x]);return b}function i(r,n,s,o){ie.ensureCache.prepare();let a=0;r&&(a=ie.getPointer(r));const l=s.map(g=>ie.ensureString(g)),c=ie.ensureInt32(l),h=ie.ensureFloat64(new Array(2*n)),p=ie._pe_usng_to_geog(a,n,c,h);return p&&F_(o,n,h),p}t.geogToUsng=e,t.usngToGeog=i}(e9||(e9={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ie.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ie.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ie.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(n,s,o,a,l){ie.ensureCache.prepare();let c=0;n&&(c=ie.getPointer(n));const h=Ww(o),p=ie.ensureFloat64(h),g=NP(s,Qn.PE_UTM_MAX),y=ie.ensureInt32(g),w=ie._pe_geog_to_utm(c,s,p,a,y);if(w)for(let b=0;b<s;b++)l[b]=ie.UTF8ToString(g[b]);return w}function r(n,s,o,a,l){ie.ensureCache.prepare();let c=0;n&&(c=ie.getPointer(n));const h=o.map(w=>ie.ensureString(w)),p=ie.ensureInt32(h),g=ie.ensureFloat64(new Array(2*s)),y=ie._pe_utm_to_geog(c,s,p,a,g);return y&&F_(l,s,g),y}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(t5||(t5={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=ie.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ie.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ie.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ie.PePCSInfo.prototype.PE_POLE_POINT}function r(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=ie.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=i,t.generate=r}(i5||(i5={})),function(t){function e(){return ie.PeVersion.prototype.version_string()}t.versionString=e}(t9||(t9={}));const eke=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return WH},get PeDefs(){return Qn},get PeDouble(){return Wve},get PeFactory(){return ZH},get PeGCSExtent(){return Zve},get PeGTTransformations(){return XH},get PeGTlistExtended(){return K4},get PeGTlistExtendedEntry(){return YH},get PeLineType(){return JH},get PeMath(){return QH},get PeNotationDms(){return KH},get PeNotationMgrs(){return e5},get PeNotationUsng(){return e9},get PeNotationUtm(){return t5},get PePCSInfo(){return i5},get PeVersion(){return t9},_init:Yve,get _pe(){return ie},isLoaded:Hve,isSupported:K5e,load:qve},Symbol.toStringTag,{value:"Module"}));var Fc;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Fc||(Fc={}));let _;const D={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(_=2e3;_<=2045;_++)D[_]=0;for(_=2056;_<=2065;_++)D[_]=0;for(_=2067;_<=2135;_++)D[_]=0;for(_=2137;_<=2154;_++)D[_]=0;for(_=2161;_<=2170;_++)D[_]=0;for(_=2172;_<=2193;_++)D[_]=0;for(_=2195;_<=2198;_++)D[_]=0;for(_=2200;_<=2203;_++)D[_]=0;for(_=2205;_<=2217;_++)D[_]=0;for(_=2222;_<=2224;_++)D[_]=1;for(_=2225;_<=2250;_++)D[_]=2;for(_=2251;_<=2253;_++)D[_]=1;for(_=2257;_<=2264;_++)D[_]=2;for(_=2274;_<=2279;_++)D[_]=2;for(_=2280;_<=2282;_++)D[_]=1;for(_=2283;_<=2289;_++)D[_]=2;for(_=2290;_<=2292;_++)D[_]=0;for(_=2308;_<=2313;_++)D[_]=0;for(_=2315;_<=2491;_++)D[_]=0;for(_=2494;_<=2866;_++)D[_]=0;for(_=2867;_<=2869;_++)D[_]=1;for(_=2870;_<=2888;_++)D[_]=2;for(_=2891;_<=2895;_++)D[_]=2;for(_=2896;_<=2898;_++)D[_]=1;for(_=2902;_<=2908;_++)D[_]=2;for(_=2915;_<=2920;_++)D[_]=2;for(_=2921;_<=2923;_++)D[_]=1;for(_=2924;_<=2930;_++)D[_]=2;for(_=2931;_<=2962;_++)D[_]=0;for(_=2964;_<=2968;_++)D[_]=2;for(_=2969;_<=2973;_++)D[_]=0;for(_=2975;_<=2991;_++)D[_]=0;for(_=2995;_<=3051;_++)D[_]=0;for(_=3054;_<=3079;_++)D[_]=0;for(_=3081;_<=3088;_++)D[_]=0;for(_=3092;_<=3101;_++)D[_]=0;for(_=3106;_<=3138;_++)D[_]=0;for(_=3146;_<=3151;_++)D[_]=0;for(_=3153;_<=3166;_++)D[_]=0;for(_=3168;_<=3172;_++)D[_]=0;for(_=3174;_<=3203;_++)D[_]=0;for(_=3294;_<=3358;_++)D[_]=0;for(_=3367;_<=3403;_++)D[_]=0;for(_=3408;_<=3416;_++)D[_]=0;for(_=3417;_<=3438;_++)D[_]=2;for(_=3441;_<=3446;_++)D[_]=2;for(_=3447;_<=3450;_++)D[_]=0;for(_=3451;_<=3459;_++)D[_]=2;for(_=3460;_<=3478;_++)D[_]=0;for(_=3554;_<=3559;_++)D[_]=0;for(_=3560;_<=3570;_++)D[_]=2;for(_=3571;_<=3581;_++)D[_]=0;for(_=3594;_<=3597;_++)D[_]=0;for(_=3601;_<=3604;_++)D[_]=0;for(_=3637;_<=3639;_++)D[_]=0;for(_=3665;_<=3667;_++)D[_]=0;for(_=3693;_<=3695;_++)D[_]=0;for(_=3701;_<=3727;_++)D[_]=0;for(_=3728;_<=3739;_++)D[_]=2;for(_=3740;_<=3751;_++)D[_]=0;for(_=3753;_<=3760;_++)D[_]=2;for(_=3761;_<=3773;_++)D[_]=0;for(_=3775;_<=3777;_++)D[_]=0;for(_=3779;_<=3781;_++)D[_]=0;for(_=3783;_<=3785;_++)D[_]=0;for(_=3788;_<=3791;_++)D[_]=0;for(_=3797;_<=3802;_++)D[_]=0;for(_=3814;_<=3816;_++)D[_]=0;for(_=3825;_<=3829;_++)D[_]=0;for(_=3832;_<=3841;_++)D[_]=0;for(_=3844;_<=3852;_++)D[_]=0;for(_=3873;_<=3885;_++)D[_]=0;for(_=3890;_<=3893;_++)D[_]=0;for(_=3907;_<=3912;_++)D[_]=0;for(_=3942;_<=3950;_++)D[_]=0;for(_=3968;_<=3970;_++)D[_]=0;for(_=3973;_<=3976;_++)D[_]=0;for(_=3986;_<=3989;_++)D[_]=0;for(_=3994;_<=3997;_++)D[_]=0;for(_=4048;_<=4051;_++)D[_]=0;for(_=4056;_<=4063;_++)D[_]=0;for(_=4093;_<=4096;_++)D[_]=0;for(_=4390;_<=4398;_++)D[_]=0;for(_=4399;_<=4413;_++)D[_]=2;for(_=4418;_<=4433;_++)D[_]=2;for(_=4455;_<=4457;_++)D[_]=2;for(_=4484;_<=4489;_++)D[_]=0;for(_=4491;_<=4554;_++)D[_]=0;for(_=4568;_<=4589;_++)D[_]=0;for(_=4652;_<=4656;_++)D[_]=0;for(_=4766;_<=4800;_++)D[_]=0;for(_=5014;_<=5016;_++)D[_]=0;for(_=5069;_<=5072;_++)D[_]=0;for(_=5105;_<=5130;_++)D[_]=0;for(_=5167;_<=5188;_++)D[_]=0;for(_=5253;_<=5259;_++)D[_]=0;for(_=5269;_<=5275;_++)D[_]=0;for(_=5292;_<=5311;_++)D[_]=0;for(_=5329;_<=5331;_++)D[_]=0;for(_=5343;_<=5349;_++)D[_]=0;for(_=5355;_<=5357;_++)D[_]=0;for(_=5387;_<=5389;_++)D[_]=0;for(_=5459;_<=5463;_++)D[_]=0;for(_=5479;_<=5482;_++)D[_]=0;for(_=5518;_<=5520;_++)D[_]=0;for(_=5530;_<=5539;_++)D[_]=0;for(_=5550;_<=5552;_++)D[_]=0;for(_=5562;_<=5583;_++)D[_]=0;for(_=5623;_<=5625;_++)D[_]=2;for(_=5631;_<=5639;_++)D[_]=0;for(_=5649;_<=5653;_++)D[_]=0;for(_=5663;_<=5680;_++)D[_]=0;for(_=5682;_<=5685;_++)D[_]=0;for(_=5875;_<=5877;_++)D[_]=0;for(_=5896;_<=5899;_++)D[_]=0;for(_=5921;_<=5940;_++)D[_]=0;for(_=6050;_<=6125;_++)D[_]=0;for(_=6244;_<=6275;_++)D[_]=0;for(_=6328;_<=6348;_++)D[_]=0;for(_=6350;_<=6356;_++)D[_]=0;for(_=6366;_<=6372;_++)D[_]=0;for(_=6381;_<=6387;_++)D[_]=0;for(_=6393;_<=6404;_++)D[_]=0;for(_=6480;_<=6483;_++)D[_]=0;for(_=6511;_<=6514;_++)D[_]=0;for(_=6579;_<=6581;_++)D[_]=0;for(_=6619;_<=6624;_++)D[_]=0;for(_=6625;_<=6627;_++)D[_]=2;for(_=6628;_<=6632;_++)D[_]=0;for(_=6634;_<=6637;_++)D[_]=0;for(_=6669;_<=6692;_++)D[_]=0;for(_=6707;_<=6709;_++)D[_]=0;for(_=6720;_<=6723;_++)D[_]=0;for(_=6732;_<=6738;_++)D[_]=0;for(_=6931;_<=6933;_++)D[_]=0;for(_=6956;_<=6959;_++)D[_]=0;for(_=7005;_<=7007;_++)D[_]=0;for(_=7057;_<=7070;_++)D[_]=2;for(_=7074;_<=7082;_++)D[_]=0;for(_=7109;_<=7118;_++)D[_]=0;for(_=7119;_<=7127;_++)D[_]=1;for(_=7374;_<=7376;_++)D[_]=0;for(_=7528;_<=7586;_++)D[_]=0;for(_=7587;_<=7645;_++)D[_]=2;for(_=7692;_<=7696;_++)D[_]=0;for(_=7755;_<=7787;_++)D[_]=0;for(_=7791;_<=7795;_++)D[_]=0;for(_=7799;_<=7801;_++)D[_]=0;for(_=7803;_<=7805;_++)D[_]=0;for(_=7825;_<=7831;_++)D[_]=0;for(_=7845;_<=7859;_++)D[_]=0;for(_=8013;_<=8032;_++)D[_]=0;for(_=8065;_<=8068;_++)D[_]=1;for(_=8518;_<=8529;_++)D[_]=2;for(_=8533;_<=8536;_++)D[_]=2;for(_=8538;_<=8540;_++)D[_]=2;for(_=8677;_<=8679;_++)D[_]=0;for(_=8836;_<=8840;_++)D[_]=0;for(_=8857;_<=8859;_++)D[_]=0;for(_=8908;_<=8910;_++)D[_]=0;for(_=9154;_<=9159;_++)D[_]=0;for(_=9205;_<=9218;_++)D[_]=0;for(_=9271;_<=9273;_++)D[_]=0;for(_=9295;_<=9297;_++)D[_]=0;for(_=9356;_<=9360;_++)D[_]=0;for(_=9404;_<=9407;_++)D[_]=0;for(_=9476;_<=9482;_++)D[_]=0;for(_=9487;_<=9494;_++)D[_]=0;for(_=9697;_<=9699;_++)D[_]=0;for(_=9821;_<=9865;_++)D[_]=0;for(_=10285;_<=10291;_++)D[_]=0;for(_=10314;_<=10317;_++)D[_]=0;for(_=10448;_<=10465;_++)D[_]=0;for(_=10731;_<=10733;_++)D[_]=0;for(_=11114;_<=11118;_++)D[_]=0;for(_=20004;_<=20032;_++)D[_]=0;for(_=20047;_<=20049;_++)D[_]=0;for(_=20062;_<=20092;_++)D[_]=0;for(_=20135;_<=20138;_++)D[_]=0;for(_=20248;_<=20258;_++)D[_]=0;for(_=20348;_<=20358;_++)D[_]=0;for(_=20436;_<=20440;_++)D[_]=0;for(_=20822;_<=20824;_++)D[_]=0;for(_=20904;_<=20932;_++)D[_]=0;for(_=20934;_<=20936;_++)D[_]=0;for(_=21004;_<=21032;_++)D[_]=0;for(_=21035;_<=21037;_++)D[_]=0;for(_=21095;_<=21097;_++)D[_]=0;for(_=21148;_<=21150;_++)D[_]=0;for(_=21207;_<=21264;_++)D[_]=0;for(_=21307;_<=21364;_++)D[_]=0;for(_=21413;_<=21423;_++)D[_]=0;for(_=21453;_<=21463;_++)D[_]=0;for(_=21473;_<=21483;_++)D[_]=0;for(_=21780;_<=21782;_++)D[_]=0;for(_=21891;_<=21894;_++)D[_]=0;for(_=21896;_<=21899;_++)D[_]=0;for(_=22171;_<=22177;_++)D[_]=0;for(_=22181;_<=22187;_++)D[_]=0;for(_=22191;_<=22197;_++)D[_]=0;for(_=22207;_<=22222;_++)D[_]=0;for(_=22229;_<=22232;_++)D[_]=0;for(_=22234;_<=22236;_++)D[_]=0;for(_=22243;_<=22250;_++)D[_]=0;for(_=22262;_<=22265;_++)D[_]=0;for(_=22307;_<=22322;_++)D[_]=0;for(_=22348;_<=22357;_++)D[_]=0;for(_=22407;_<=22422;_++)D[_]=0;for(_=22462;_<=22465;_++)D[_]=0;for(_=22521;_<=22525;_++)D[_]=0;for(_=22607;_<=22622;_++)D[_]=0;for(_=22641;_<=22646;_++)D[_]=0;for(_=22648;_<=22657;_++)D[_]=0;for(_=22707;_<=22722;_++)D[_]=0;for(_=22762;_<=22765;_++)D[_]=0;for(_=22807;_<=22822;_++)D[_]=0;for(_=22991;_<=22994;_++)D[_]=0;for(_=23028;_<=23038;_++)D[_]=0;for(_=23301;_<=23333;_++)D[_]=2;for(_=23830;_<=23853;_++)D[_]=0;for(_=23866;_<=23872;_++)D[_]=0;for(_=23877;_<=23884;_++)D[_]=0;for(_=23886;_<=23894;_++)D[_]=0;for(_=23946;_<=23948;_++)D[_]=0;for(_=24311;_<=24313;_++)D[_]=0;for(_=24342;_<=24347;_++)D[_]=0;for(_=24370;_<=24374;_++)D[_]=10;for(_=24375;_<=24381;_++)D[_]=0;for(_=24718;_<=24721;_++)D[_]=0;for(_=24817;_<=24821;_++)D[_]=0;for(_=24877;_<=24882;_++)D[_]=0;for(_=24891;_<=24893;_++)D[_]=0;for(_=25391;_<=25395;_++)D[_]=0;for(_=25828;_<=25838;_++)D[_]=0;for(_=26191;_<=26195;_++)D[_]=0;for(_=26391;_<=26393;_++)D[_]=0;for(_=26701;_<=26722;_++)D[_]=0;for(_=26729;_<=26799;_++)D[_]=2;for(_=26801;_<=26803;_++)D[_]=2;for(_=26811;_<=26813;_++)D[_]=2;for(_=26847;_<=26870;_++)D[_]=2;for(_=26891;_<=26899;_++)D[_]=0;for(_=26901;_<=26923;_++)D[_]=0;for(_=26929;_<=26946;_++)D[_]=0;for(_=26948;_<=26998;_++)D[_]=0;for(_=27037;_<=27040;_++)D[_]=0;for(_=27205;_<=27232;_++)D[_]=0;for(_=27258;_<=27260;_++)D[_]=0;for(_=27391;_<=27398;_++)D[_]=0;for(_=27561;_<=27564;_++)D[_]=0;for(_=27571;_<=27574;_++)D[_]=0;for(_=27581;_<=27584;_++)D[_]=0;for(_=27591;_<=27594;_++)D[_]=0;for(_=27700;_<=27707;_++)D[_]=0;for(_=28191;_<=28193;_++)D[_]=0;for(_=28348;_<=28358;_++)D[_]=0;for(_=28402;_<=28432;_++)D[_]=0;for(_=28462;_<=28492;_++)D[_]=0;for(_=29118;_<=29122;_++)D[_]=0;for(_=29168;_<=29172;_++)D[_]=0;for(_=29177;_<=29185;_++)D[_]=0;for(_=29187;_<=29195;_++)D[_]=0;for(_=29900;_<=29903;_++)D[_]=0;for(_=30161;_<=30179;_++)D[_]=0;for(_=30491;_<=30494;_++)D[_]=0;for(_=30729;_<=30732;_++)D[_]=0;for(_=31251;_<=31259;_++)D[_]=0;for(_=31265;_<=31268;_++)D[_]=0;for(_=31275;_<=31279;_++)D[_]=0;for(_=31281;_<=31297;_++)D[_]=0;for(_=31461;_<=31469;_++)D[_]=0;for(_=31491;_<=31495;_++)D[_]=0;for(_=31917;_<=31922;_++)D[_]=0;for(_=31965;_<=32e3;_++)D[_]=0;for(_=32001;_<=32003;_++)D[_]=2;for(_=32005;_<=32031;_++)D[_]=2;for(_=32033;_<=32060;_++)D[_]=2;for(_=32064;_<=32067;_++)D[_]=2;for(_=32074;_<=32077;_++)D[_]=2;for(_=32081;_<=32086;_++)D[_]=0;for(_=32107;_<=32130;_++)D[_]=0;for(_=32133;_<=32159;_++)D[_]=0;for(_=32164;_<=32167;_++)D[_]=2;for(_=32180;_<=32199;_++)D[_]=0;for(_=32201;_<=32260;_++)D[_]=0;for(_=32301;_<=32360;_++)D[_]=0;for(_=32401;_<=32460;_++)D[_]=0;for(_=32501;_<=32560;_++)D[_]=0;for(_=32601;_<=32662;_++)D[_]=0;for(_=32664;_<=32667;_++)D[_]=2;for(_=32701;_<=32761;_++)D[_]=0;for(_=53001;_<=53004;_++)D[_]=0;for(_=53008;_<=53019;_++)D[_]=0;for(_=53021;_<=53032;_++)D[_]=0;for(_=53034;_<=53037;_++)D[_]=0;for(_=53042;_<=53046;_++)D[_]=0;for(_=53074;_<=53080;_++)D[_]=0;for(_=54001;_<=54004;_++)D[_]=0;for(_=54008;_<=54019;_++)D[_]=0;for(_=54021;_<=54032;_++)D[_]=0;for(_=54034;_<=54037;_++)D[_]=0;for(_=54042;_<=54046;_++)D[_]=0;for(_=54048;_<=54053;_++)D[_]=0;for(_=54074;_<=54080;_++)D[_]=0;for(_=54098;_<=54101;_++)D[_]=0;for(_=102001;_<=102040;_++)D[_]=0;for(_=102042;_<=102063;_++)D[_]=0;for(_=102065;_<=102067;_++)D[_]=0;for(_=102070;_<=102117;_++)D[_]=0;for(_=102122;_<=102216;_++)D[_]=0;for(_=102221;_<=102377;_++)D[_]=0;for(_=102382;_<=102388;_++)D[_]=0;for(_=102389;_<=102398;_++)D[_]=2;for(_=102399;_<=102444;_++)D[_]=0;for(_=102445;_<=102447;_++)D[_]=2;for(_=102448;_<=102458;_++)D[_]=0;for(_=102459;_<=102468;_++)D[_]=2;for(_=102469;_<=102499;_++)D[_]=0;for(_=102500;_<=102519;_++)D[_]=1;for(_=102520;_<=102524;_++)D[_]=0;for(_=102525;_<=102529;_++)D[_]=2;for(_=102530;_<=102588;_++)D[_]=0;for(_=102590;_<=102598;_++)D[_]=0;for(_=102601;_<=102603;_++)D[_]=0;for(_=102605;_<=102628;_++)D[_]=0;for(_=102629;_<=102646;_++)D[_]=2;for(_=102648;_<=102700;_++)D[_]=2;for(_=102701;_<=102703;_++)D[_]=0;for(_=102707;_<=102730;_++)D[_]=2;for(_=102733;_<=102758;_++)D[_]=2;for(_=102767;_<=102900;_++)D[_]=0;for(_=102901;_<=102933;_++)D[_]=2;for(_=102934;_<=102950;_++)D[_]=13;for(_=102951;_<=102963;_++)D[_]=0;for(_=102965;_<=102969;_++)D[_]=0;for(_=102971;_<=102973;_++)D[_]=0;for(_=102975;_<=102989;_++)D[_]=0;for(_=102990;_<=102992;_++)D[_]=1;for(_=102997;_<=103002;_++)D[_]=0;for(_=103003;_<=103008;_++)D[_]=2;for(_=103009;_<=103011;_++)D[_]=0;for(_=103012;_<=103014;_++)D[_]=2;for(_=103019;_<=103021;_++)D[_]=0;for(_=103022;_<=103024;_++)D[_]=2;for(_=103029;_<=103031;_++)D[_]=0;for(_=103032;_<=103034;_++)D[_]=2;for(_=103065;_<=103068;_++)D[_]=0;for(_=103074;_<=103076;_++)D[_]=0;for(_=103077;_<=103079;_++)D[_]=1;for(_=103080;_<=103082;_++)D[_]=0;for(_=103083;_<=103085;_++)D[_]=2;for(_=103090;_<=103093;_++)D[_]=0;for(_=103097;_<=103099;_++)D[_]=0;for(_=103100;_<=103102;_++)D[_]=2;for(_=103107;_<=103109;_++)D[_]=0;for(_=103110;_<=103112;_++)D[_]=2;for(_=103113;_<=103116;_++)D[_]=0;for(_=103117;_<=103120;_++)D[_]=2;for(_=103153;_<=103157;_++)D[_]=0;for(_=103158;_<=103162;_++)D[_]=2;for(_=103163;_<=103165;_++)D[_]=0;for(_=103166;_<=103168;_++)D[_]=1;for(_=103169;_<=103171;_++)D[_]=2;for(_=103186;_<=103188;_++)D[_]=0;for(_=103189;_<=103191;_++)D[_]=2;for(_=103192;_<=103195;_++)D[_]=0;for(_=103196;_<=103199;_++)D[_]=2;for(_=103200;_<=103224;_++)D[_]=0;for(_=103225;_<=103227;_++)D[_]=1;for(_=103232;_<=103237;_++)D[_]=0;for(_=103238;_<=103243;_++)D[_]=2;for(_=103244;_<=103246;_++)D[_]=0;for(_=103247;_<=103249;_++)D[_]=2;for(_=103254;_<=103256;_++)D[_]=0;for(_=103257;_<=103259;_++)D[_]=2;for(_=103264;_<=103266;_++)D[_]=0;for(_=103267;_<=103269;_++)D[_]=2;for(_=103300;_<=103375;_++)D[_]=0;for(_=103381;_<=103383;_++)D[_]=0;for(_=103384;_<=103386;_++)D[_]=1;for(_=103387;_<=103389;_++)D[_]=0;for(_=103390;_<=103392;_++)D[_]=2;for(_=103397;_<=103399;_++)D[_]=0;for(_=103400;_<=103471;_++)D[_]=2;for(_=103476;_<=103478;_++)D[_]=0;for(_=103479;_<=103481;_++)D[_]=2;for(_=103486;_<=103488;_++)D[_]=0;for(_=103489;_<=103491;_++)D[_]=2;for(_=103492;_<=103495;_++)D[_]=0;for(_=103496;_<=103499;_++)D[_]=2;for(_=103528;_<=103543;_++)D[_]=0;for(_=103544;_<=103548;_++)D[_]=2;for(_=103549;_<=103551;_++)D[_]=0;for(_=103552;_<=103554;_++)D[_]=1;for(_=103555;_<=103557;_++)D[_]=2;for(_=103558;_<=103560;_++)D[_]=0;for(_=103571;_<=103573;_++)D[_]=0;for(_=103574;_<=103576;_++)D[_]=2;for(_=103577;_<=103580;_++)D[_]=0;for(_=103581;_<=103583;_++)D[_]=2;for(_=103595;_<=103694;_++)D[_]=0;for(_=103696;_<=103699;_++)D[_]=0;for(_=103700;_<=103793;_++)D[_]=2;for(_=103794;_<=103890;_++)D[_]=0;for(_=103891;_<=103896;_++)D[_]=2;for(_=103900;_<=103971;_++)D[_]=2;for(_=103972;_<=103977;_++)D[_]=0;for(_=112e3;_<=112101;_++)D[_]=0;const Xve=[102100,102113,3857,3785,900913],tke=[104905,104971],ike=[4326,...Xve,...tke],MR=[-20037508342788905e-9,20037508342788905e-9],i9=[-20037508342787e-6,20037508342787e-6],T6={wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:MR,origin:i9,dx:1e-5},Jve={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:MR,origin:i9,dx:1e-5},102100:T6,3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:MR,origin:i9,dx:1e-5},3857:T6,4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},900913:T6};function xs(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||bm(t)&&bm(e))return!0;const o=t.latestWkid;if(o!=null&&r===o)return!0;const a=e.latestWkid;return a!=null&&i===a}let n,s;return t.wkt2&&e.wkt2?(n=t.wkt2,s=e.wkt2):t.wkt&&e.wkt&&(n=t.wkt,s=e.wkt),!(!n||!s)&&n.toUpperCase()===s.toUpperCase()}function cy(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&Jve[e]||null}function woe(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function N3(t){if(!Rp(t))return!1;const{wkid:e}=t;if(e)return D[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function mU(t){return!(LC(t)||DC(t))}function wv(t){return(t==null?void 0:t.wkid)===4326}function ZRt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function r5(t){return(t==null?void 0:t.wkid)===Fc.CGCS2000}function bm(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&Xve.includes(e)}function $R(t){return(t==null?void 0:t.wkid)===32662}function PE(t){return t===Fc.GCSMARS2000||t===Fc.GCSMARS2000_SPHERE}function LC(t){return PE(t==null?void 0:t.wkid)}function LE(t){return t===Fc.GCSMOON2000}function DC(t){return LE(t==null?void 0:t.wkid)}function rke(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&ike.includes(e)}function Rp(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const Qve={wkid:4326,wkt:rU(Jve[4326].wkTemplate,{Central_Meridian:"0.0"})},Kve={wkid:102100,latestWkid:3857},nke={wkid:32662};function FJ(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const e1e=FJ(Ii),gU=FJ(Bp),yU=FJ(vy),t1e={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Ii.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},ske=gU.wkt.toUpperCase(),oke=yU.wkt.toUpperCase();function xr(t){if(t!=null&&Rp(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(PE(e))return Bp;const r=i==null?void 0:i.toUpperCase();if(i&&r===ske)return Bp;if(LE(e)||r&&r===oke)return vy}return Ii}function YRt(t){return PE(t)?Bp:LE(t)?vy:Ii}function n5(t){return xs(t,e1e)}function bv(t){return n5(t)||xs(t,gU)||xs(t,yU)}const kJ=39.37,ake=Ii.radius*Math.PI/200,i1e=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,_b=D,r1e=/UNIT\[([^\]]+)]/i,lke=new Set([4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104025,104026,104139,104140]),cke=Za()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain:"chains",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),ff=t=>t*t,w0=t=>t*t*t,OR={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937},"clarke-feet":{inBaseUnits:.3047972654},"clarke-yards":{inBaseUnits:.9143917962},"clarke-links":{inBaseUnits:.201166195164},"sears-yards":{inBaseUnits:.9143984146160287},"sears-feet":{inBaseUnits:.3047994715386762},"sears-chains":{inBaseUnits:20.11676512155263},"benoit-1895-b-chains":{inBaseUnits:20.11678249437587},"indian-yards":{inBaseUnits:.9143985307444408},"indian-1937-yards":{inBaseUnits:.91439523},"gold-coast-feet":{inBaseUnits:.3047997101815088},chains:{inBaseUnits:20.1168},"sears-1922-truncated-chains":{inBaseUnits:20.116756},"50-kilometers":{inBaseUnits:5e4},"150-kilometers":{inBaseUnits:15e4}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:ff(.001)},"square-centimeters":{inBaseUnits:ff(.01)},"square-decimeters":{inBaseUnits:ff(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:ff(1e3)},"square-inches":{inBaseUnits:ff(.0254)},"square-feet":{inBaseUnits:ff(.3048)},"square-yards":{inBaseUnits:ff(.9144)},"square-miles":{inBaseUnits:ff(1609.344)},"square-us-feet":{inBaseUnits:ff(1200/3937)},acres:{inBaseUnits:.0015625*ff(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*w0(.001)},"cubic-centimeters":{inBaseUnits:1e3*w0(.01)},"cubic-decimeters":{inBaseUnits:1e3*w0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*w0(1e3)},"cubic-inches":{inBaseUnits:1e3*w0(.0254)},"cubic-feet":{inBaseUnits:1e3*w0(.3048)},"cubic-yards":{inBaseUnits:1e3*w0(.9144)},"cubic-miles":{inBaseUnits:1e3*w0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},uke=(()=>{const t={};for(const e in OR)for(const i in OR[e].units)t[i]=e;return t})();function hke(t,e,i){return t*OR[i].units[e].inBaseUnits}function dke(t,e,i){return t/OR[i].units[e].inBaseUnits}const n1e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],pke=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function zb(t){const e=uke[t];if(!e)throw new Error("unknown type");return e}function boe(t,e=null){return e=e||zb(t),OR[e].baseUnit===t}function Zr(t,e,i){if(e===i)return t;const r=zb(e);if(r!==zb(i))throw new Error("incompatible units");const n=boe(e,r)?t:hke(t,e,r);return boe(i,r)?n:dke(n,i,r)}function fke(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function XRt(t){return fke(t)}function JRt(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function QRt(t,e,i){switch(i){case"metric":return UJ(t,e);case"imperial":return VJ(t,e);default:return i}}function KRt(t,e,i){switch(i){case"metric":return zJ(t,e);case"imperial":return BJ(t,e);default:return i}}function UJ(t,e){const i=Zr(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function zJ(t,e){const i=Zr(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function VJ(t,e){const i=Zr(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function BJ(t,e){const i=Zr(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function mke(t,e){const i=Zr(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function gke(t,e){const i=Zr(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function yke(t,e,i){return Zr(t,e,"meters")/(i*Math.PI/180)}function s1e(t){return cke.fromJSON(t.toLowerCase())||null}function AR(t){if(t!=null&&!mU(t))return 1;const e=Ql(t);return e>1e5?1:e}function o1e(t){return Ql(t)>=xr(t).metersPerDegree?"meters":F3(t)}function Ql(t,e=Ii.metersPerDegree){return _ke(t,!0)??e}function _ke(t,e=!1){const i=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let n=null;if(i){if(PE(i))return Bp.metersPerDegree;if(LE(i))return vy.metersPerDegree;n=_b.values[_b[i]],!n&&e&&lke.has(i)&&(n=ake)}else r&&(c1e(r)?n=Soe(i1e.exec(r),n):l1e(r)&&(n=Soe(r1e.exec(r),n)));return n}function xoe(t){return N3(t)?1:Ql(t)}function Soe(t,e){return t!=null&&t[1]?a1e(t[1]):e}function a1e(t){return parseFloat(t.split(",")[1])}function F3(t){const e=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let r=null;if(e)r=_b.units[_b[e]];else if(i){const n=c1e(i)?i1e:l1e(i)?r1e:null;if(n){const s=n.exec(i);s!=null&&s[1]&&(r=bke(s[1]))}}return r!=null?s1e(r):null}function e3t(t){const e=F3(t);return e!=null&&n1e.includes(e)?e:null}function vke(t){const e=o1e(t);return e!=null&&n1e.includes(e)?e:null}function t3t(t){const e=F3(t);return e==null?null:pke.get(e)}function l1e(t){return/^GEOCCS/i.test(t)}function c1e(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const wke=1e-7;function bke(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let i=e==null?void 0:e[1];if(!i||!_b.units.includes(i)){const r=a1e(t);i=null;const n=_b.values;for(let s=0;s<n.length;++s)if(Math.abs(r-n[s])<wke){i=_b.units[s];break}}return i}function i3t(t){const e=F3(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"chains":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const xke={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Ske={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},Tke={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},Eke=Za()(xke),Cke=Za()(Ske),r3t=Za()(Tke);var Af;let un=Af=class extends we{static fromJSON(t){if(!t)return null;if((t==null?void 0:t.wkid)===102100)return Af.WebMercator;if((t==null?void 0:t.wkid)===4326)return Af.WGS84;const e=new Af;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return wv(this)}get isWebMercator(){return bm(this)}get isGeographic(){return N3(this)}get isWrappable(){return rke(this)}get metersPerUnit(){return Ql(this)}get unit(){return F3(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Af.WGS84)return new Af(Qve);if(this===Af.WebMercator)return new Af(Kve);const t=new Af;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=te(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||r?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):i?n.id===e&&n.referenceServiceName===i:n.id===e}return xs(this,t)}toJSON(t){return this.write(void 0,t)}};un.GCS_NAD_1927=null,un.WGS84=null,un.WebMercator=null,un.PlateCarree=null,u([f({readOnly:!0})],un.prototype,"isWGS84",null),u([f({readOnly:!0})],un.prototype,"isWebMercator",null),u([f({readOnly:!0})],un.prototype,"isGeographic",null),u([f({readOnly:!0})],un.prototype,"isWrappable",null),u([f({type:Wi,json:{write:!0}})],un.prototype,"latestWkid",void 0),u([f({readOnly:!0})],un.prototype,"metersPerUnit",null),u([f({readOnly:!0})],un.prototype,"unit",null),u([f({type:Wi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],un.prototype,"wkid",void 0),u([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],un.prototype,"wkt",void 0),u([ke("wkt"),ke("web-scene","wkt")],un.prototype,"writeWkt",null),u([f({type:String,json:{write:!1}})],un.prototype,"wkt2",void 0),u([f({type:Wi,json:{write:!0}})],un.prototype,"vcsWkid",void 0),u([f({type:Wi,json:{write:!0}})],un.prototype,"latestVcsWkid",void 0),u([f()],un.prototype,"imageCoordinateSystem",void 0),un=Af=u([L("esri.geometry.SpatialReference")],un),un.prototype.toJSON.isDefaultToJSON=!0,un.GCS_NAD_1927=Ne.freeze(new un({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'})),un.WGS84=Ne.freeze(new un(Qve)),un.WebMercator=Ne.freeze(new un(Kve)),un.PlateCarree=Ne.freeze(new un(nke));const nt=un;function Pe(t,e,i){let r,n;return e===void 0||Array.isArray(e)?(n=t,i=e,r=[void 0]):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;r.forEach(l=>{const c=eve(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let Rf=class extends we{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=nt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof nt)return e;if(e!=null){const r=new nt;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};u([f()],Rf.prototype,"type",void 0),u([f({readOnly:!0})],Rf.prototype,"cache",null),u([f({readOnly:!0})],Rf.prototype,"extent",null),u([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Rf.prototype,"hasM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Rf.prototype,"hasZ",void 0),u([f({type:nt,json:{write:!0},value:nt.WGS84})],Rf.prototype,"spatialReference",void 0),u([Pe("spatialReference")],Rf.prototype,"readSpatialReference",null),Rf=u([L("esri.geometry.Geometry")],Rf);const jv=Rf,Mke=Object.prototype.toString;function $ke(t){const e="__accessorMetadata__"in t?is(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return Oke.apply(this,i)}}function Oke(t,e,i,r){sU(t,e).cast=r}function Ake(t){return(e,i)=>{sU(e,t).cast=e[i]}}function $i(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&Mke.call(t[0])==="[object Function]"?$ke(t[0]):t.length===1&&typeof t[0]=="string"?Ake(t[0]):void 0}const Rke=57.29577951308232,Ike=.017453292519943;function Toe(t){return t*Rke}function Eoe(t){return t*Ike}function Coe(t){return t/Ii.radius}function r9(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Ii.radius))}function n9(t){return t.wkid!=null||t.wkt!=null}const E6=[0,0];function s5(t,e,i,r,n){const s=t,o=n;if(o.spatialReference=i,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,E6,r);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,E6,r),[o.xmax,o.ymax]=e(s.xmax,s.ymax,E6,r);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let g=0;g<p.length;g++)c.push(e(p[g][0],p[g][1],[0,0],r)),p[g].length>2&&c[g].push(p[g][2]),p[g].length>3&&c[g].push(p[g][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function gN(t,e){const i=t&&(n9(t)?t:t.spatialReference),r=e&&(n9(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!xs(r,i)||bm(r)&&wv(i)||bm(i)&&wv(r))}function k3(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(n9(e)?e:e.spatialReference);return gN(i,r)?xs(i,r)?te(t):bm(r)?s5(t,m2,nt.WebMercator,!1,te(t)):wv(r)?s5(t,_U,nt.WGS84,!1,te(t)):null:null}function m2(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=Eoe(e);return i[0]=Eoe(t)*Ii.radius,i[1]=Ii.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function _U(t,e,i=[0,0],r=!1){if(t===MR[0])i[0]=-180;else if(t===MR[1])i[0]=180;else{const n=Toe(t/Ii.radius);i[0]=r?n:n-360*Math.floor((n+180)/360)}return i[1]=Toe(Math.PI/2-2*Math.atan(Math.exp(-e/Ii.radius))),i}function DA(t,e=!1,i=te(t)){return s5(t,m2,nt.WebMercator,e,i)}function iO(t,e=!1,i=te(t)){return s5(t,_U,nt.WGS84,e,i)}function Pke(t,e){const i=t.x-e.x,r=t.y-e.y,n=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+n*n)}function Lke(t){var e;return((e=u1e(t,h1e))==null?void 0:e[0])??null}function Dke(t){var e;return((e=u1e(t,h1e))==null?void 0:e[1])??null}function u1e({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(bm(i))return _U(t,e,r);if(N3(i))return r[0]=t,r[1]=e,r}return null}const h1e=[0,0];var yN;const C6=[0,0];function Moe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Il=yN=class extends jv{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Ne.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],i=s[2],r=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,i=s.z,r=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new nt(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)de.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)de.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&(n!=null&&n.isWebMercator)){const a=m2(s.longitude,s.latitude,C6);t=a[0],e=a[1]}}}else Moe(i)?(n=i,i=null):Moe(r)&&(n=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?de.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&de.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return Dke(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",m2(i,t,C6)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return Lke(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",m2(t,e,C6)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new yN;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return yN.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!s.equals(h))if(s.isWebMercator&&h.isWGS84)[l,c]=m2(l,c),h=s;else{if(!s.isWGS84||!h.isWebMercator)return!1;[l,c]=_U(l,c),h=s}return e===l&&i===c&&r===o&&n===a&&s.wkid===h.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=cy(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,n=2*r;let s;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n),this._set("x",e),this}distance(t){return Pke(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([f({readOnly:!0})],Il.prototype,"cache",null),u([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Il.prototype,"hasM",null),u([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Il.prototype,"hasZ",null),u([f({type:Number})],Il.prototype,"latitude",null),u([f({type:Number})],Il.prototype,"longitude",null),u([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),$i(t=>isNaN(t)?t:Hl(t))],Il.prototype,"x",void 0),u([ke("x")],Il.prototype,"writeX",null),u([Pe("x")],Il.prototype,"readX",null),u([f({type:Number,json:{write:!0}})],Il.prototype,"y",void 0),u([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Il.prototype,"z",void 0),u([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Il.prototype,"m",void 0),Il=yN=u([L("esri.geometry.Point")],Il),Il.prototype.toJSON.isDefaultToJSON=!0;const wt=Il,M6=[0,0];function jJ(t,e){return e!=null&&dl(t,e.x,e.y,e.z)}function s3t(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!DE(t,i))return!1;return!0}function Nke(t,e){const{xmin:i,ymin:r,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?dl(t,i,r,n)&&dl(t,i,o,n)&&dl(t,s,o,n)&&dl(t,s,r,n)&&dl(t,i,r,a)&&dl(t,i,o,a)&&dl(t,s,o,a)&&dl(t,s,r,a):dl(t,i,r)&&dl(t,i,o)&&dl(t,s,o)&&dl(t,s,r)}function DE(t,e){return dl(t,e[0],e[1])}function Fke(t,e){return dl(t,e[0],e[1],e[2])}function dl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function kke(t,e){return M6[1]=e.y,M6[0]=e.x,Uke(t,M6)}function Uke(t,e){return d1e(t.rings,e)}function d1e(t,e){if(!t)return!1;if(zke(t))return $oe(!1,t,e);let i=!1;for(let r=0,n=t.length;r<n;r++)i=$oe(i,t[r],e);return i}function zke(t){return!Array.isArray(t[0][0])}function $oe(t,e,i){const[r,n]=i;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[p,g]=e[o];(h<n&&g>=n||g<n&&h>=n)&&c+(n-h)/(g-h)*(p-c)<r&&(s=!s)}return s}function Vke(t,e){return jJ(t,e)}function Bke(t,e){const i=t.hasZ&&e.hasZ;let r,n,s;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function jke(t,e){const{points:i,hasZ:r}=e,n=r?Fke:DE;for(const s of i)if(n(t,s))return!0;return!1}const Vb=[0,0],Bb=[0,0],jb=[0,0],Gb=[0,0],Gke=[Vb,Bb,jb,Gb],p1e=[[jb,Vb],[Vb,Bb],[Bb,Gb],[Gb,jb]];function Hke(t,e){return qke(t,e.rings)}function qke(t,e){Vb[0]=t.xmin,Vb[1]=t.ymax,Bb[0]=t.xmax,Bb[1]=t.ymax,jb[0]=t.xmin,jb[1]=t.ymin,Gb[0]=t.xmax,Gb[1]=t.ymin;for(const i of Gke)if(d1e(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(DE(t,r))return!0;for(let n=1;n<i.length;n++){const s=i[n];if(DE(t,s)||f1e(r,s,p1e))return!0;r=s}}return!1}function Wke(t,e){Vb[0]=t.xmin,Vb[1]=t.ymax,Bb[0]=t.xmax,Bb[1]=t.ymax,jb[0]=t.xmin,jb[1]=t.ymin,Gb[0]=t.xmax,Gb[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let n=r[0];if(DE(t,n))return!0;for(let s=1;s<r.length;s++){const o=r[s];if(DE(t,o)||f1e(n,o,p1e))return!0;n=o}}return!1}const Jo=[0,0];function Zke(t){for(let e=0;e<t.length;e++){const i=t[e];for(let n=0;n<i.length-1;n++){const s=i[n],o=i[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(s9(s,o,c,h,Jo)&&!(Jo[0]===s[0]&&Jo[1]===s[1]||Jo[0]===c[0]&&Jo[1]===c[1]||Jo[0]===o[0]&&Jo[1]===o[1]||Jo[0]===h[0]&&Jo[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let n=0;n<r-3;n++){let s=r-1;n===0&&(s=r-2);const o=i[n],a=i[n+1];for(let l=n+2;l<s;l++){const c=i[l],h=i[l+1];if(s9(o,a,c,h,Jo)&&!(Jo[0]===o[0]&&Jo[1]===o[1]||Jo[0]===c[0]&&Jo[1]===c[1]||Jo[0]===a[0]&&Jo[1]===a[1]||Jo[0]===h[0]&&Jo[1]===h[1]))return!0}}}return!1}function f1e(t,e,i){for(let r=0;r<i.length;r++)if(s9(t,e,i[r][0],i[r][1]))return!0;return!1}function s9(t,e,i,r,n){const[s,o]=t,[a,l]=e,[c,h]=i,[p,g]=r,y=p-c,w=s-c,b=a-s,x=g-h,T=o-h,M=l-o,$=x*b-y*M;if($===0)return!1;const R=(y*T-x*w)/$,I=(b*T-M*w)/$;return R>=0&&R<=1&&I>=0&&I<=1&&(n&&(n[0]=s+R*(a-s),n[1]=o+R*(l-o)),!0)}function Yke(t){switch(t){case"esriGeometryEnvelope":case"extent":return Bke;case"esriGeometryMultipoint":case"multipoint":return jke;case"esriGeometryPoint":case"point":return Vke;case"esriGeometryMultiPatch":case"multipatch":case"esriGeometryPolygon":case"polygon":return Hke;case"esriGeometryPolyline":case"polyline":return Wke}}var ph;function Xke(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function b0(t,e,i){return e==null?i:i==null?e:t(e,i)}let Co=ph=class extends jv{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,n){return Xke(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?nt.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:n??nt.WGS84}}static fromBounds(t,e){return new ph({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new ph({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new wt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new ph;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&gN(e,i)&&(t=e.isWebMercator?DA(t):iO(t,!0)),t.type==="point"?jJ(this,t):t.type==="extent"&&Nke(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&gN(e,i)&&(t=e.isWebMercator?DA(t):iO(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!xs(e,i)&&gN(e,i)&&(t=e.isWebMercator?DA(t):iO(t,!0)),Yke(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=b0(Math.min,this.zmin,t.zmin),this.zmax=b0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=b0(Math.min,this.mmin,t.mmin),this.mmax=b0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=b0(Math.max,this.zmin,t.zmin),this.zmax=b0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=b0(Math.max,this.mmin,t.mmin),this.mmax=b0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=cy(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?iO(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=$6(r.x,t).x),this.spatialReference=new nt(rU((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,n=this.xmin,s=this.xmax;return n>=i&&n<=r&&s>=i&&s<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const n=i??cy(r);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||cy(o);const[p,g]=t.valid;h=$6(this.xmin,t);const y=h.x,w=h.frameId;h=$6(this.xmax,t);const b=h.x,x=h.frameId,T=y===b&&a>0;if(a>2*g){const M=new ph(l<c?y:b,n,g,s,o),$=new ph(p,n,l<c?b:y,s,o),R=new ph(0,n,g,s,o),I=new ph(p,n,0,s,o),P=[],N=[];M.contains(R)&&P.push(w),M.contains(I)&&N.push(w),$.contains(R)&&P.push(x),$.contains(I)&&N.push(x);for(let V=w+1;V<x;V++)P.push(V),N.push(V);e.push({extent:M,frameIds:[w]},{extent:$,frameIds:[x]},{extent:R,frameIds:P},{extent:I,frameIds:N})}else y>b||T?e.push({extent:new ph(y,n,g,s,o),frameIds:[w]},{extent:new ph(p,n,b,s,o),frameIds:[x]}):e.push({extent:new ph(y,n,b,s,o),frameIds:[w]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const n={};i&&(n.zmin=this.zmin,n.zmax=this.zmax),r&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}};function $6(t,e){const[i,r]=e.valid,n=2*r;let s,o=0;return t>r?(s=Math.ceil(Math.abs(t-r)/n),t-=s*n,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/n),t+=s*n,o=-s),{x:t,frameId:o}}u([f({readOnly:!0})],Co.prototype,"cache",null),u([f({readOnly:!0})],Co.prototype,"center",null),u([f({readOnly:!0})],Co.prototype,"extent",null),u([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Co.prototype,"hasM",null),u([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Co.prototype,"hasZ",null),u([f({readOnly:!0})],Co.prototype,"height",null),u([f({readOnly:!0})],Co.prototype,"width",null),u([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Co.prototype,"xmin",void 0),u([f({type:Number,json:{write:!0}})],Co.prototype,"ymin",void 0),u([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Co.prototype,"mmin",void 0),u([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Co.prototype,"zmin",void 0),u([f({type:Number,json:{write:!0}})],Co.prototype,"xmax",void 0),u([f({type:Number,json:{write:!0}})],Co.prototype,"ymax",void 0),u([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Co.prototype,"mmax",void 0),u([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Co.prototype,"zmax",void 0),Co=ph=u([L("esri.geometry.Extent")],Co),Co.prototype.toJSON.isDefaultToJSON=!0;const pr=Co;let NA;var X0e,J0e;const Jke=((X0e=globalThis.esriConfig)==null?void 0:X0e.locale)??((J0e=globalThis.dojoConfig)==null?void 0:J0e.locale);var Q0e;const FA=(Q0e=globalThis.document)==null?void 0:Q0e.documentElement;function m1e(){var i;const t=FA==null?void 0:FA.getAttribute("lang"),e=(i=globalThis.navigator)==null?void 0:i.language;return Jke??t??e??"en"}function Vc(){return NA===void 0&&(NA=m1e()),NA}function Qke(t=Vc()){const e=/^([a-zA-Z]{2,3})(?:[_-][a-zA-Z0-9]+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const _N=[];function g1e(t){return _N.push(t),Ui(()=>_N.splice(_N.indexOf(t),1))}const vN=[];function GJ(t){return vN.push(t),Ui(()=>vN.splice(vN.indexOf(t),1))}function Ooe(){const t=m1e();NA!==t&&([...vN].forEach(e=>e(t)),NA=t,[..._N].forEach(e=>e(t)))}var K0e;(K0e=globalThis.addEventListener)==null||K0e.call(globalThis,"languagechange",Ooe),FA&&new MutationObserver(()=>{Ooe()}).observe(FA,{attributeFilter:["lang"]});let FP;function Kke(t){return FP&&!FP.destroyed||(FP=t()),FP}var o9;const eUe=new sr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let fh=o9=class extends Ne{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new o9({categories:this.categories?te(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=k3(this.extent,nt.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:i,bbox:r,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>eUe.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};u([f()],fh.prototype,"categories",void 0),u([f()],fh.prototype,"disableExtraQuery",void 0),u([f({type:pr})],fh.prototype,"extent",void 0),u([f()],fh.prototype,"filter",void 0),u([f()],fh.prototype,"num",void 0),u([f()],fh.prototype,"query",void 0),u([f()],fh.prototype,"sortField",void 0),u([f()],fh.prototype,"sortOrder",null),u([f()],fh.prototype,"start",void 0),fh=o9=u([L("esri.portal.PortalQueryParams")],fh);const Cp=fh;var a9;let no=a9=class extends we{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new Y("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new a9({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=is(Cp,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Cp,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Cp,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const n=r.contentCategorySetsGroupQuery;if(n){const s=new Cp({disableExtraQuery:!0,num:1,query:n});return i.queryGroups(s,e)}throw new Y("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const n=r.results[0],s=new Cp({num:1,query:`typekeywords:"${t}"`});return n.queryItems(s,e)}throw new Y("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(n=>{const s=n==null?void 0:n.categorySchema;return s!=null&&s.length?s:[]}):[])}};u([f()],no.prototype,"access",void 0),u([f({type:Date})],no.prototype,"created",void 0),u([f()],no.prototype,"description",void 0),u([f()],no.prototype,"id",void 0),u([f()],no.prototype,"isInvitationOnly",void 0),u([f({type:Date})],no.prototype,"modified",void 0),u([f()],no.prototype,"owner",void 0),u([f()],no.prototype,"portal",void 0),u([f()],no.prototype,"snippet",void 0),u([f()],no.prototype,"sortField",void 0),u([f()],no.prototype,"sortOrder",void 0),u([f()],no.prototype,"sourceJSON",void 0),u([f()],no.prototype,"tags",void 0),u([f()],no.prototype,"thumbnail",void 0),u([f({readOnly:!0})],no.prototype,"thumbnailUrl",null),u([f()],no.prototype,"title",void 0),u([f({readOnly:!0})],no.prototype,"url",null),no=a9=u([L("esri.portal.PortalGroup")],no);const l9=no;let q1=class extends Ne{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([f()],q1.prototype,"nextQueryParams",void 0),u([f()],q1.prototype,"queryParams",void 0),u([f()],q1.prototype,"results",void 0),u([f()],q1.prototype,"total",void 0),q1=u([L("esri.portal.PortalQueryResult")],q1);const tUe=q1;let hg=class extends we{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var i;const e=(i=this.portal)==null?void 0:i.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new Y("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([f({type:Date})],hg.prototype,"created",void 0),u([f()],hg.prototype,"id",void 0),u([f()],hg.prototype,"portal",void 0),u([f()],hg.prototype,"title",void 0),u([f({readOnly:!0})],hg.prototype,"url",null),u([f()],hg.prototype,"username",void 0),hg=u([L("esri.portal.PortalFolder")],hg);const iUe=hg;var c9;let $n=c9=class extends we{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t==null?void 0:t.data,r=t==null?void 0:t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),i!=null&&(typeof i=="string"?n.query.text=i:typeof i=="object"&&(n.query.text=JSON.stringify(i))));let s=this.userContentUrl;return r&&(s+="/"+(typeof r=="string"?r:r.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.slice();const i=this.userContentUrl+"/deleteItems",r=[],n=t.map(s=>s.id);if(n.length){const s={method:"post",query:{items:n.join(","),permanentDelete:e}},o=await this.portal.request(i,s);for(const a of o.results){const l=t.find(p=>a.itemId===p.id),c=a.success;let h=null;c?(l.id=null,l.portal=null):a.error&&(h=new Y("portal:delete-item-failed",a.error.message,a.error)),r.push({item:l,success:c,error:h})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const n=iUe.fromJSON(r);return n.portal=this.portal,n}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=l9.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??(t={});let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await fe(()=>Promise.resolve().then(()=>v1e),void 0),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},n=await this.portal.request(e,{query:r});let s;return n!=null&&n.items?(s=n.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),await Promise.all(s.map(o=>o.load())),{items:s,nextStart:n.nextStart,total:n.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new l9({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new Y("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new Y("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new c9({sourceJSON:t});return e.read(t),e}};u([f()],$n.prototype,"access",void 0),u([f({type:Date})],$n.prototype,"created",void 0),u([f()],$n.prototype,"culture",void 0),u([f()],$n.prototype,"description",void 0),u([f()],$n.prototype,"email",void 0),u([f()],$n.prototype,"favGroupId",void 0),u([f()],$n.prototype,"fullName",void 0),u([f({type:Date})],$n.prototype,"modified",void 0),u([f()],$n.prototype,"orgId",void 0),u([f()],$n.prototype,"portal",void 0),u([f()],$n.prototype,"preferredView",void 0),u([f()],$n.prototype,"privileges",void 0),u([f()],$n.prototype,"region",void 0),u([f()],$n.prototype,"role",void 0),u([f()],$n.prototype,"roleId",void 0),u([f()],$n.prototype,"sourceJSON",void 0),u([f()],$n.prototype,"thumbnail",void 0),u([f({readOnly:!0})],$n.prototype,"thumbnailUrl",null),u([f()],$n.prototype,"units",void 0),u([f({readOnly:!0})],$n.prototype,"userContentUrl",null),u([f({readOnly:!0})],$n.prototype,"url",null),u([f()],$n.prototype,"username",void 0),u([f()],$n.prototype,"userLicenseTypeId",void 0),u([f()],$n.prototype,"userType",void 0),$n=c9=u([L("esri.portal.PortalUser")],$n);const HJ=$n;var pu;let JM;const Aoe={PortalGroup:()=>Promise.resolve({default:l9}),PortalItem:()=>fe(()=>Promise.resolve().then(()=>v1e),void 0),PortalUser:()=>Promise.resolve({default:HJ})};let Ze=pu=class extends P3(wm){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Qr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Roe.unregister(this),this.defaultBasemap=Ye(this.defaultBasemap),this.defaultDevBasemap=Ye(this.defaultDevBasemap),this.defaultVectorBasemap=Ye(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Sr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Qr.request.trustedServers.includes(e)||Qr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var i;const t=(i=this.user)==null?void 0:i.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get hasAPIKey(){return Fve(this.url)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.slice(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=HJ.fromJSON(t),e.portal=this),e}load(t){const e=fe(()=>Promise.resolve().then(()=>LUe),void 0).then(({default:i})=>{zt(t),JM=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{var r;if(!this.hasAPIKey&&Gi){const n=Gi;this.credential=n.findCredential(this.restUrl),this.credential||this.authMode!==pu.AUTH_MODE_AUTO&&this.authMode!==pu.AUTH_MODE_NO_PROMPT||((r=this._esriIdCredentialCreateHandle)==null||r.remove(),this._esriIdCredentialCreateHandle=n.on("credential-create",rUe(new WeakRef(this))),Roe.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await fe(async()=>{const{default:i}=await import("./ElevationLayer-A75y1o-8.js");return{default:i}},__vite__mapDeps([4,5,6,7,8,9]))).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}async fetchDefault3DBasemap(t){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||this.default3DBasemapQuery==="none")return null;const e=new Cp;e.query=this.default3DBasemapQuery,e.disableExtraQuery=!0;const i=(await this.queryItems(e,t)).results.find(r=>r.type==="Web Scene");return i?new JM({portalItem:i}):null}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):zo(t)?Promise.reject(ki()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new Cp({num:100,sortField:"title"});if(e!=null&&e.length){const r=[];for(const n of e)r.push(`(title:"${n.title}" AND owner:${n.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(n=>n.results)}return zo(t)?Promise.reject(ki()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||Vc();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||Vc();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return Kke(()=>new pu)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",n={authMode:t,query:{culture:Vc().toLowerCase()},withCredentials:!0,...i};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(r,n)}queryPortal(t,e,i,r){const n=is(Cp,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...r}).then(a=>{const l=n.clone();return l.start=a.nextStart,new tUe({nextQueryParams:l,queryParams:n,total:a.total,results:pu._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Pc(l),a)));return i&&Aoe[i]?Aoe[i]().then(({default:o})=>(zt(r),s(o))):s()}signIn(){if(this.hasAPIKey)return this.load().then(()=>{if(!this.user)throw new Y("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")});if(this.authMode===pu.AUTH_MODE_ANONYMOUS||this.authMode===pu.AUTH_MODE_NO_PROMPT&&!Gi)return Promise.reject(new Y("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Gi?Gi.getCredential(this.restUrl,{prompt:this.authMode!==pu.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var i;const e=(i=this.credential)==null?void 0:i.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const n=pu._resultsToTypedArray(i,{portal:this},r);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():r)).then(()=>n,()=>n)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===pu.AUTH_MODE_ANONYMOUS||this.authMode===pu.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:n,cacheBust:s,method:o,query:i,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),Br(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new Y("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new pu({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new Y("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new Cp;i.query=t||(this.hasAPIKey?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const n=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(i,e);return s.total?s.results.filter(o=>o.type==="Web Map").map(o=>new JM({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new Cp({query:i,disableExtraQuery:!0}),n=await this.queryGroups(r,e);if(!n.total)return[];const s=n.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new JM({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=JM.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let n;if(i){const s=r!=null?r.signal:null;n=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};Ze.AUTH_MODE_ANONYMOUS="anonymous",Ze.AUTH_MODE_AUTO="auto",Ze.AUTH_MODE_IMMEDIATE="immediate",Ze.AUTH_MODE_NO_PROMPT="no-prompt",u([f()],Ze.prototype,"access",void 0),u([f()],Ze.prototype,"allSSL",void 0),u([f()],Ze.prototype,"authMode",void 0),u([f()],Ze.prototype,"authorizedCrossOriginDomains",void 0),u([Pe("authorizedCrossOriginDomains")],Ze.prototype,"readAuthorizedCrossOriginDomains",null),u([f()],Ze.prototype,"basemapGalleryGroupQuery",void 0),u([f({json:{name:"3DBasemapGalleryGroupQuery"}})],Ze.prototype,"basemapGalleryGroupQuery3D",void 0),u([f()],Ze.prototype,"bingKey",void 0),u([f()],Ze.prototype,"canListApps",void 0),u([f()],Ze.prototype,"canListData",void 0),u([f()],Ze.prototype,"canListPreProvisionedItems",void 0),u([f()],Ze.prototype,"canProvisionDirectPurchase",void 0),u([f()],Ze.prototype,"canSearchPublic",void 0),u([f()],Ze.prototype,"canShareBingPublic",void 0),u([f()],Ze.prototype,"canSharePublic",void 0),u([f()],Ze.prototype,"canSignInArcGIS",void 0),u([f()],Ze.prototype,"canSignInIDP",void 0),u([f()],Ze.prototype,"colorSetsGroupQuery",void 0),u([f()],Ze.prototype,"commentsEnabled",void 0),u([f({type:Date})],Ze.prototype,"created",void 0),u([f()],Ze.prototype,"credential",void 0),u([f()],Ze.prototype,"culture",void 0),u([f()],Ze.prototype,"currentVersion",void 0),u([f()],Ze.prototype,"customBaseUrl",void 0),u([f()],Ze.prototype,"default3DBasemapQuery",void 0),u([f()],Ze.prototype,"defaultBasemap",void 0),u([Pe("defaultBasemap")],Ze.prototype,"readDefaultBasemap",null),u([f()],Ze.prototype,"defaultDevBasemap",void 0),u([Pe("defaultDevBasemap")],Ze.prototype,"readDefaultDevBasemap",null),u([f({type:pr})],Ze.prototype,"defaultExtent",void 0),u([f()],Ze.prototype,"defaultVectorBasemap",void 0),u([Pe("defaultVectorBasemap")],Ze.prototype,"readDefaultVectorBasemap",null),u([f()],Ze.prototype,"description",void 0),u([f()],Ze.prototype,"devBasemapGalleryGroupQuery",void 0),u([f()],Ze.prototype,"eueiEnabled",void 0),u([f({readOnly:!0})],Ze.prototype,"extraQuery",null),u([f()],Ze.prototype,"featuredGroups",void 0),u([f()],Ze.prototype,"featuredItemsGroupQuery",void 0),u([f()],Ze.prototype,"galleryTemplatesGroupQuery",void 0),u([f()],Ze.prototype,"layoutGroupQuery",void 0),u([f()],Ze.prototype,"livingAtlasGroupQuery",void 0),u([f({readOnly:!0})],Ze.prototype,"hasAPIKey",null),u([f()],Ze.prototype,"hasCategorySchema",void 0),u([f()],Ze.prototype,"hasClassificationSchema",void 0),u([f()],Ze.prototype,"helpBase",void 0),u([f()],Ze.prototype,"helperServices",void 0),u([f()],Ze.prototype,"helpMap",void 0),u([f()],Ze.prototype,"homePageFeaturedContent",void 0),u([f()],Ze.prototype,"homePageFeaturedContentCount",void 0),u([f()],Ze.prototype,"httpPort",void 0),u([f()],Ze.prototype,"httpsPort",void 0),u([f()],Ze.prototype,"id",void 0),u([f()],Ze.prototype,"ipCntryCode",void 0),u([f({readOnly:!0})],Ze.prototype,"isOrganization",null),u([f()],Ze.prototype,"isPortal",void 0),u([f()],Ze.prototype,"isReadOnly",void 0),u([f({readOnly:!0})],Ze.prototype,"itemPageUrl",null),u([f()],Ze.prototype,"layerTemplatesGroupQuery",void 0),u([f()],Ze.prototype,"maxTokenExpirationMinutes",void 0),u([f({type:Date})],Ze.prototype,"modified",void 0),u([f()],Ze.prototype,"name",void 0),u([f()],Ze.prototype,"portalHostname",void 0),u([f()],Ze.prototype,"portalMode",void 0),u([f()],Ze.prototype,"portalProperties",void 0),u([f()],Ze.prototype,"region",void 0),u([f()],Ze.prototype,"recycleBinEnabled",void 0),u([f({readOnly:!0})],Ze.prototype,"restUrl",null),u([f()],Ze.prototype,"rotatorPanels",void 0),u([f()],Ze.prototype,"showHomePageDescription",void 0),u([f()],Ze.prototype,"sourceJSON",void 0),u([f()],Ze.prototype,"staticImagesUrl",void 0),u([f({json:{name:"2DStylesGroupQuery"}})],Ze.prototype,"stylesGroupQuery2d",void 0),u([f({json:{name:"stylesGroupQuery"}})],Ze.prototype,"stylesGroupQuery3d",void 0),u([f()],Ze.prototype,"supportsHostedServices",void 0),u([f()],Ze.prototype,"symbolSetsGroupQuery",void 0),u([f()],Ze.prototype,"templatesGroupQuery",void 0),u([f()],Ze.prototype,"thumbnail",void 0),u([f({readOnly:!0})],Ze.prototype,"thumbnailUrl",null),u([f()],Ze.prototype,"units",void 0),u([f()],Ze.prototype,"url",void 0),u([f()],Ze.prototype,"urlKey",void 0),u([Pe("urlKey")],Ze.prototype,"readUrlKey",null),u([f()],Ze.prototype,"user",void 0),u([Pe("user")],Ze.prototype,"readUser",null),u([f()],Ze.prototype,"use3dBasemaps",void 0),u([f()],Ze.prototype,"useDefault3dBasemap",void 0),u([f()],Ze.prototype,"useStandardizedQuery",void 0),u([f()],Ze.prototype,"useVectorBasemaps",void 0),u([f()],Ze.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ze=pu=u([L("esri.portal.Portal")],Ze);const va=Ze,Roe=new FinalizationRegistry(t=>{t.remove()});function rUe(t){const e=Gi;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let dg=class extends Ne{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:Ioe(e.path,e.portalItem)}:e}set path(e){e!=null&&Fu(e)?de.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return Ioe(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new Y("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:i!=null&&i.cacheBust?Date.now():null},signal:i==null?void 0:i.signal})}async update(e,i){const{addOrUpdateResources:r}=await fe(()=>Promise.resolve().then(()=>y2),void 0);return await r(this.portalItem,[{resource:this,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"update",i),this}hasPath(){return this.path!=null}};function Ioe(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&Fu(t)&&(t=CJ(t,e.itemUrl)),t==null?void 0:t.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}u([f()],dg.prototype,"portalItem",void 0),u([f({type:String,value:null})],dg.prototype,"path",null),u([$i("path")],dg.prototype,"_castPath",null),u([f({type:String,readOnly:!0})],dg.prototype,"url",null),u([f({type:String,readOnly:!0})],dg.prototype,"cdnUrl",null),u([f({type:String,readOnly:!0})],dg.prototype,"itemRelativeUrl",null),dg=u([L("esri.portal.PortalItemResource")],dg);const nUe=dg;let rO=class extends Ne{constructor(e){super(e),this.created=null,this.rating=null}};u([f()],rO.prototype,"created",void 0),u([f()],rO.prototype,"rating",void 0),rO=u([L("esri.portal.PortalRating")],rO);const O6=rO;function NC(t,e){var r;const i=(r=e==null?void 0:e.url)==null?void 0:r.path;if(t&&i&&(t=Iu(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const n=CJ(t,e.portalItem.itemUrl);n!=null&&sUe.test(n)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(n).path)}return(t=u9(t,e==null?void 0:e.portal))&&vU.test(t)?WJ(t):t}function U3(t,e,i=RR.YES){var n,s;if((t=t&&vU.test(t)?_1e(t):t)==null)return t;!Fu(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let r=Iu(t);if(e){const o=((n=e.verifyItemRelativeUrls)==null?void 0:n.rootPath)||((s=e.url)==null?void 0:s.path);if(o){const a=u9(o,e.portal),l=u9(r,e.portal);r=CJ(l,a,a),r!=null&&r!==l&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=y1e(r,e==null?void 0:e.portal),Fu(r)&&(r=nd(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Fu(r)&&!Rm(r)&&i===RR.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function qJ(t,e,i){return NC(t,i)}function Hb(t,e,i,r){const n=U3(t,r);n!==void 0&&(e[i]=n)}const vU=/\/items\/([^/]+)\/resources\/(.*)/,sUe=/^\.\/resources\//;function oUe(t){const e=(t==null?void 0:t.match(vU))??null;return(e==null?void 0:e[1])??null}function aUe(t){const e=(t==null?void 0:t.match(vU))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=hoe(i);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=hoe(i.slice(r+1));return{prefix:i.slice(0,r),filename:n,extension:s}}function y1e(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?GH(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function u9(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=xJ();return OE(r,`${r.scheme}://${i}`)?GH(t,e.portalHostname,i):GH(t,i,e.portalHostname)}function WJ(t){if(!t)return t||null;let e=t;return e&&Gi&&!Gi.findCredential(e)&&(e=_ve(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function _1e(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&Gi&&!Gi.findCredential(e)&&(e=_ve(e)),e}var RR;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(RR||(RR={}));const u3t=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return RR},ensureMainOnlineDomain:y1e,fromCDNUrl:_1e,fromJSON:NC,itemIdFromResourceUrl:oUe,prefixAndFilenameFromResourceUrl:aUe,read:qJ,toCDNUrl:WJ,toJSON:U3,write:Hb},Symbol.toStringTag,{value:"Module"}));var W1;const lUe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),cUe=new Set(["KML","GeoJson","CSV"]);let bi=W1=class extends P3(wm){static from(t){return dU(W1,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t!=null&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new pr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var y;const t=((y=this.type)==null?void 0:y.toLowerCase())||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,h=!1,p=!1,g=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":h?"utilitynetwork":s?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),p=e.includes("Relational"),n=c||p?"mapimages":s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):n=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?n="maps":t==="web scene"?n=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?n="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?n="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?n="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?n="datafiles":t==="360 vr experience"?n="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?n="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?n="addindesktop":t==="pdf"?n="pdf":t==="microsoft word"?n="word":t==="microsoft excel"?n="excel":t==="microsoft powerpoint"?n="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?n="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?n="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?n="layersgray":t==="analysis model"?n="analysismodel":t==="scene package"?n="scenepackage":t==="3dtiles package"?n="3dtileslayerpackage":t==="3dtiles service"?n="3dtileslayer":t==="mobile scene package"?n="mobilescenepackage":t==="tile package"||t==="compact tile package"?n="tilepackage":t==="task file"?n="taskfile":t==="report template"?n="report-template":t==="statistical data collection"?n="statisticaldatacollection":t==="insights workbook"?n="workbook":t==="insights model"?n="insightsmodel":t==="insights page"?n="insightspage":t==="insights theme"?n="insightstheme":t==="hub initiative"?n="hubinitiative":t==="hub page"?n="hubpage":t==="hub site application"?n="hubsite":t==="hub event"?n="hubevent":t==="hub project"?n="hubproject":t==="relational database connection"?n="relationaldatabaseconnection":t==="big data file share"?n="datastorecollection":t==="image collection"?n="imagecollection":t==="desktop style"?n="desktopstyle":t==="style"?n=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?n="dashboard":t==="raster function template"?n="rasterprocessingtemplate":t==="vector tile package"?n="vectortilepackage":t==="ortho mapping project"?n="orthomappingproject":t==="ortho mapping template"?n="orthomappingtemplate":t==="solution"?n="solutions":t==="geopackage"?n="geopackage":t==="deep learning package"?n="deeplearningpackage":t==="real time analytic"?n="realtimeanalytics":t==="reality mapping project"?n="realitymappingproject":t==="big data analytic"?n="bigdataanalytics":t==="feed"?n="feed":t==="excalibur imagery project"?n="excaliburimageryproject":t==="notebook"?n="notebook":t==="storymap"?n="storymap":t==="survey123 add in"?n="survey123addin":t==="mission"?n="mission":t==="mission report"?n="missionreport":t==="mission template"?n="missiontemplate":t==="quickcapture project"?n="quickcaptureproject":t==="pro report"?n="proreport":t==="pro report template"?n="proreporttemplate":t==="urban model"?n="urbanmodel":t==="urban project"?n="urbanproject":t==="web experience"?n="experiencebuilder":t==="web experience template"?n="webexperiencetemplate":t==="experience builder widget"?n="experiencebuilderwidget":t==="experience builder widget package"?n="experiencebuilderwidgetpackage":t==="workflow"?n="workflow":t==="kernel gateway connection"?n="kernelgatewayconnection":t==="insights script"?n="insightsscript":t==="hub initiative template"?n="hubinitiativetemplate":t==="storymap theme"?n="storymaptheme":t==="knowledge graph"?n="knowledgegraph":t==="knowledge graph layer"?n="knowledgegraphlayer":t==="knowledge studio project"?n="knowledgestudio":t==="native application"?n="nativeapp":t==="native application installer"?n="nativeappinstaller":t==="web link chart"?n="linkchart":t==="knowledge graph web investigation"?n="investigation":t==="ogcfeatureserver"?n="features":t==="pro presentation"?n="propresentation":t==="pro project"?n="proproject":t==="insights workbook package"?n="insightsworkbookpackage":t==="apache parquet"?n="apacheparquet":t==="notebook code snippet library"?n="notebookcodesnippets":t==="suitability model"?n="suitabilitymodel":t==="esri classifier definition"?n="classifierdefinition":t==="esri classification schema"?n="classificationschema":t==="insights data engineering workbook"?n="dataengineeringworkbook":t==="insights data engineering model"?n="dataengineeringmodel":t==="deep learning studio project"?n="deeplearningproject":t==="discussion"?n="discussion":t==="allsource project"?n="allsourceproject":t==="api key"?n="apikey":t==="data pipeline"?n="datapipelines":t==="group layer"?(g=e.includes("Map"),n=g?"layergroup2d":"layergroup"):n=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",n?vr(i+n+r+".png"):null}get isLayer(){return this.type!=null&&lUe.has(this.type)}get itemCdnUrl(){return WJ(this.itemUrl)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var i,r,n;const t=(i=this.portal)==null?void 0:i.restUrl;if(!t)return null;const e=this.owner||((n=(r=this.portal)==null?void 0:r.user)==null?void 0:n.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=va.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof O6&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new O6({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:te(this.applicationProxies),avgRating:this.avgRating,categories:te(this.categories),classification:te(this.classification),created:te(this.created),culture:this.culture,description:this.description,extent:te(this.extent),groupCategories:te(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:te(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:te(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:te(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new W1({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var e;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(e=t[i])==null?void 0:e.join(", ");for(const i of["extent","classification"]){const r=t[i];r&&(t[i]=JSON.stringify(r))}return t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new O6(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},W1)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.applicationProxies&&!Object.hasOwn(t,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new Y("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new Y("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!r,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new W1({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")Rm(e)?r.query={data:e}:r.query={url:Iu(e)},i!=null&&(r.query.filename=i);else{const n=new FormData;i!=null?n.append("file",e,i):n.append("file",e),r.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new Y("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await fe(()=>Promise.resolve().then(()=>y2),void 0);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await fe(()=>Promise.resolve().then(()=>y2),void 0);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await fe(()=>Promise.resolve().then(()=>y2),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new Y("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await fe(()=>Promise.resolve().then(()=>y2),void 0);return e(this,t)}resourceFromPath(t){return new nUe({portalItem:this,path:t})}toJSON(){var i,r;const t=this.extent,e={accessInformation:this.accessInformation,categories:te(this.categories),classification:te(this.classification),created:(i=this.created)==null?void 0:i.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(r=this.modified)==null?void 0:r.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:te(this.typeKeywords),url:this.url};return kNe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new W1({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([f({type:["private","shared","org","public"]})],bi.prototype,"access",void 0),u([f()],bi.prototype,"accessInformation",void 0),u([f({type:String})],bi.prototype,"apiKey",void 0),u([f({json:{read:{source:"appProxies"}}})],bi.prototype,"applicationProxies",void 0),u([f()],bi.prototype,"avgRating",void 0),u([f()],bi.prototype,"categories",void 0),u([f()],bi.prototype,"classification",void 0),u([f({type:Date})],bi.prototype,"created",void 0),u([f()],bi.prototype,"culture",void 0),u([f()],bi.prototype,"description",void 0),u([f({readOnly:!0})],bi.prototype,"displayName",null),u([f({type:pr})],bi.prototype,"extent",void 0),u([Pe("extent")],bi.prototype,"readExtent",null),u([f()],bi.prototype,"groupCategories",void 0),u([f({readOnly:!0})],bi.prototype,"iconUrl",null),u([f()],bi.prototype,"id",void 0),u([f({readOnly:!0})],bi.prototype,"isLayer",null),u([f({type:Boolean,readOnly:!0})],bi.prototype,"isOrgItem",void 0),u([f()],bi.prototype,"itemControl",void 0),u([f({readOnly:!0})],bi.prototype,"itemPageUrl",null),u([f({readOnly:!0})],bi.prototype,"itemUrl",null),u([f()],bi.prototype,"licenseInfo",void 0),u([f({type:Date})],bi.prototype,"modified",void 0),u([f()],bi.prototype,"name",void 0),u([f()],bi.prototype,"numComments",void 0),u([f()],bi.prototype,"numRatings",void 0),u([f()],bi.prototype,"numViews",void 0),u([f()],bi.prototype,"owner",void 0),u([f()],bi.prototype,"ownerFolder",void 0),u([f({type:va})],bi.prototype,"portal",void 0),u([f()],bi.prototype,"screenshots",void 0),u([f()],bi.prototype,"size",void 0),u([f()],bi.prototype,"snippet",void 0),u([f()],bi.prototype,"sourceJSON",void 0),u([f({type:String})],bi.prototype,"sourceUrl",void 0),u([f({type:String})],bi.prototype,"spatialReference",void 0),u([f()],bi.prototype,"tags",void 0),u([f()],bi.prototype,"thumbnail",void 0),u([f({readOnly:!0})],bi.prototype,"thumbnailUrl",null),u([f()],bi.prototype,"title",void 0),u([f()],bi.prototype,"type",void 0),u([f()],bi.prototype,"typeKeywords",void 0),u([f({type:String,json:{read(t,e){var i;if(cUe.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],bi.prototype,"url",void 0),u([f({readOnly:!0})],bi.prototype,"userItemUrl",null),bi=W1=u([L("esri.portal.PortalItem")],bi);const vb=bi,v1e=Object.freeze(Object.defineProperty({__proto__:null,default:vb},Symbol.toStringTag,{value:"Module"})),Poe=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,uUe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Loe(t){return t in uUe}const nO=[],X2=new Map;function Doe(t){for(const e of X2.keys())b1e(t.pattern,e)&&X2.delete(e)}function hUe(t){return nO.includes(t)||(Doe(t),nO.unshift(t)),Ui(()=>{const e=nO.indexOf(t);e>-1&&(nO.splice(e,1),Doe(t))})}async function w1e(t){const e=Vc();X2.has(t)||X2.set(t,pUe(t,e));const i=X2.get(t);return i&&await fUe.add(i),i}function dUe(t){if(!Poe.test(t))return null;const e=Poe.exec(t);if(e===null)return null;const[,i,r]=e,n=i+(r?"-"+r.toUpperCase():"");return Loe(n)?n:Loe(i)?i:null}async function pUe(t,e){const i=[];for(const r of nO)if(b1e(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(n){i.push(n)}throw i.length?new Y("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new Y("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function b1e(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}GJ(()=>{X2.clear()});const fUe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Ho())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function mUe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await w1e("esri/t9n/basemaps");return i[t]||i[e]}const h9={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return vr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return vr("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return vr("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return vr("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return vr("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return vr("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return vr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return vr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return vr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return vr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return vr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return vr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return vr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return vr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return vr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return vr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},gUe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let pg=class extends Ne{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=Vc().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=Qke(e);return i==="pt"?"pt-BR":i&&gUe.has(i)?i:"global"}};u([f()],pg.prototype,"apiKey",void 0),u([f()],pg.prototype,"id",void 0),u([f()],pg.prototype,"language",void 0),u([f()],pg.prototype,"places",void 0),u([f()],pg.prototype,"serviceUrl",void 0),u([f()],pg.prototype,"worldview",void 0),pg=u([L("esri.support.BasemapStyle")],pg);const yUe=pg;function d3t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function _Ue(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function Z1(t){return(t==null?void 0:t.type)==="subtype-sublayer"}function kA(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function NE(t){return t!=null&&"type"in t&&t.type==="group"}const p3t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function d9(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function vUe(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function IR(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function Noe(t){return(t==null?void 0:t.type)==="voxel"}function Foe(t){return(t==null?void 0:t.type)==="imagery-tile"}function wN(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function wU(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function f3t(t){var i;const e=t==null?void 0:t.type;return(e==="feature"||e==="subtype-group"||e==="oriented-imagery")&&((i=t.source)==null?void 0:i.type)==="feature-layer"}function wUe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function x1e(t,e){const i=Gi==null?void 0:Gi.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const n=`${t.slice(0,r)}/rest/info`,s=e!=null?e.signal:null,{data:o}=await Br(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function bUe(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function xUe(t){return bUe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function SUe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function TUe(t){return!!SUe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const EUe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),CUe=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function MUe(t){return t.layerContainerType==="basemap"?EUe:t.layerContainerType==="operational-layers"?CUe:null}function $Ue(t,e){if(e.restrictedWebMapWriting){const i=MUe(e);return i==null||i.has(t.type)&&!wU(t)}return!0}function OUe(t,e){var i;if(e)if(wU(t)){const r=iU("featureCollection.layers",e),n=(i=r==null?void 0:r[0])==null?void 0:i.layerDefinition;n&&koe(t,n)}else t.type!=="group"&&koe(t,e)}function koe(t,e){"maxScale"in t&&(e.maxScale=q4(t.maxScale)??void 0),"minScale"in t&&(e.minScale=q4(t.minScale)??void 0)}function AUe(t,e){if(OUe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=q4(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(wU(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Uoe(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i!=null&&i.messages&&i.messages.push(new Y("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(wU(t)&&!t.isTable)e=t.resourceInfo;else if($Ue(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&AUe(t,e=te(e)),e}var sO;let RUe=0,fu=sO=class extends P3(wm){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+RUe++,this.baseLayers=new ot,this.referenceLayers=new ot;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&de.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{de.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Ye(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",vm(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=Uoe(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&r.push(s)}),this.referenceLayers.forEach(n=>{const s=Uoe(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&(n.type!=="scene"&&(s.isReference=!0),r.push(s))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",vm(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return DJ(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>L4(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>L4(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new sO({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var i;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((i=this.resourceInfo)!=null&&i.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const n=te(r);return n.url&&_m(n.url)&&(n.url=`https:${n.url}`),n.templateUrl&&_m(n.templateUrl)&&(n.templateUrl=`https:${n.templateUrl}`),n})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;zt(t);const n=[];if(e){const s=e.context?e.context.url:null;if(n.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const o=e.data.id;n.push(mUe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?n.push(this._loadFromItem(i,t)):r&&n.push(this._loadFromStylesService(r,t));await Promise.all(n)}async _loadLayersFromJSON(t,e,i){var l,c;const r=(l=this.resourceInfo)==null?void 0:l.context,n=((c=this.portalItem)==null?void 0:c.portal)||(r==null?void 0:r.portal)||null,s=PUe[(r==null?void 0:r.origin)||""]??"web-map",{populateOperationalLayers:o}=await fe(async()=>{const{populateOperationalLayers:h}=await import("./layersCreator-DeJ1MgNa.js");return{populateOperationalLayers:h}},__vite__mapDeps([10,11,12,13])),a=[];if(zt(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const h={context:{...r,origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},p=w=>s==="web-scene"&&w.layerType==="ArcGISSceneServiceLayer"||w.isReference,g=o(this.baseLayers,t.baseMapLayers.filter(w=>!p(w)),h);a.push(g);const y=o(this.referenceLayers,t.baseMapLayers.filter(p),h);a.push(y)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),n=_o(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:IUe[t.type||""]??"web-map",portal:t.portal||va.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||va.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await Br(i,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview,token:t.apiKey},signal:e==null?void 0:e.signal})).data,n=_o(i);if(this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,n,e),t.apiKey)for(const s of[...this.baseLayers,...this.referenceLayers])"apiKey"in s&&(s.apiKey=t.apiKey)}static fromId(t){const e=h9[t];return e?e.itemId?new sO({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):sO.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};u([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ot}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],fu.prototype,"baseLayers",null),u([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],fu.prototype,"id",void 0),u([f({type:vb})],fu.prototype,"portalItem",void 0),u([f()],fu.prototype,"referenceLayers",null),u([f({readOnly:!0})],fu.prototype,"resourceInfo",void 0),u([f({type:nt})],fu.prototype,"spatialReference",void 0),u([f({type:yUe})],fu.prototype,"style",void 0),u([f()],fu.prototype,"thumbnailUrl",void 0),u([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],fu.prototype,"title",void 0),u([ke("title")],fu.prototype,"writeTitle",null),fu=sO=u([L("esri.Basemap")],fu);const IUe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},PUe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},J2=fu,LUe=Object.freeze(Object.defineProperty({__proto__:null,default:J2},Symbol.toStringTag,{value:"Module"})),o5={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function S1e(t){return!!o5[t]||!!o5[t.toLowerCase()]}function ZJ(t){return o5[t]??o5[t.toLowerCase()]}function DUe(t){return[...ZJ(t)]}function A6(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function T1e(t,e,i,r=1){const n=(t%360+360)%360/360,s=i<=.5?i*(e+1):i+e-i*e,o=2*i-s;return[Math.round(255*A6(o,s,n+1/3)),Math.round(255*A6(o,s,n)),Math.round(255*A6(o,s,n-1/3)),r]}function NUe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.slice(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&r,o>>=i,a[3]=n*l/255),l=o&r,o>>=i,a[2]=n*l,l=o&r,o>>=i,a[1]=n*l,l=o&r,o>>=i,a[0]=n*l,a}const zoe=new Float32Array(1);function FUe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Oe(t,e,i){return Math.min(Math.max(t,e),i)}function PR(t){return!(t&t-1)}function m3t(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function g3t(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Bt(t,e,i){return t+(e-t)*i}function y3t(t,e,i,r,n){return Bt(r,n,(t-e)/(i-e))}function Wt(t){return t*Math.PI/180}function vo(t){return 180*t/Math.PI}function _3t(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Ga(t){return Math.acos(Oe(t,-1,1))}function cd(t){return Math.asin(Oe(t,-1,1))}function lv(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const a5=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function p9(t){return a5.setFloat64(0,t),a5.getBigInt64(0)}function kUe(t){return a5.setBigInt64(0,t),a5.getFloat64(0)}const bN=BigInt("1000000"),UUe=E1e(1);function E1e(t){const e=p9(t=Math.abs(t)),i=kUe(e<=bN?bN:e-bN);return Math.abs(t-i)}function v3t(t,e,i=UUe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&E1e(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=p9(t),n=p9(e);return r<0!=n<0?!1:!((r<n?n-r:r-n)>bN)}function zUe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(r>.01*i)return!1}else if(r/(n+s)>i)return!1;return!0}function VUe(t){return C1e(Math.max(-f9,Math.min(t,f9)))}function C1e(t){return zoe[0]=t,zoe[0]}function LR(t,e,i){const r=Oe((i-t)/(e-t),0,1);return r*r*(3-2*r)}function w3t(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(lv(e,1)&&lv(i,1)&&lv(r,1))}function BUe(t,e){return(t%e+e)%e}const f9=C1e(34028234663852886e22);function b3t(t,e,i){if(i===void 0||+i==0)return Math[t](e);if(e=+e,i=+i,isNaN(e)||typeof i!="number"||i%1!=0)return NaN;let r=e.toString().split("e");return r=(e=Math[t](+(r[0]+"e"+(r[1]?+r[1]-i:-i)))).toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+i:i))}function kP(t){return Oe(yJ(t),0,255)}function UP(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function zP(t,e){const i=t.toString(16).padStart(2,"0");return e?i.slice(0,1):i}let xN=class Mo{static blendColors(e,i,r,n=new Mo){return n.r=Math.round(e.r+(i.r-e.r)*r),n.g=Math.round(e.g+(i.g-e.g)*r),n.b=Math.round(e.b+(i.b-e.b)*r),n.a=e.a+(i.a-e.a)*r,n._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const n=r[2].split(/\s*,\s*/),s=r[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),Mo.fromArray(a,i)}return Mo.fromArray(n.map(a=>parseFloat(a)),i)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return Mo.fromArray(T1e(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),i)}return null}static fromHex(e,i=new Mo){if(e[0]!=="#"||isNaN(+`0x${e.slice(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.slice(1,2),16),n=parseInt(e.slice(2,3),16),s=parseInt(e.slice(3,4),16),o=e.length===5?15:parseInt(e.slice(4),16);return Mo.fromArray([r+16*r,n+16*n,s+16*s,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),s=parseInt(e.slice(5,7),16),o=e.length===7?255:parseInt(e.slice(7),16);return Mo.fromArray([r,n,s,o/255],i)}default:return null}}static fromArray(e,i=new Mo){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=S1e(e)?ZJ(e):null;return r&&Mo.fromArray(r,i)||Mo.fromRgb(e,i)||Mo.fromHex(e,i)}static fromJSON(e){return e!=null?new Mo([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Mo.fromString(e,this):Array.isArray(e)?Mo.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Mo||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=(e==null?void 0:e.capitalize)??!1,r=(e==null?void 0:e.digits)??6,n=r===3||r===4,s=r===4||r===8,o=`#${zP(this.r,n)}${zP(this.g,n)}${zP(this.b,n)}${s?zP(Math.round(255*this.a),n):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Mo.AlphaMode.ALWAYS){const i=kP(this.r),r=kP(this.g),n=kP(this.b);return e===Mo.AlphaMode.ALWAYS||this.a!==1?[i,r,n,kP(255*this.a)]:[i,r,n]}clone(){return new Mo(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(UP(this.r,0,255)),this.g=Math.round(UP(this.g,0,255)),this.b=Math.round(UP(this.b,0,255)),this.a=UP(this.a,0,1),this}_set(e,i,r,n){this.r=e,this.g=i,this.b=r,this.a=n}};xN.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(xN||(xN={}));const mt=xN;function x3t(t){}function jUe(t){return()=>t}function _t(t,e={}){const i=t instanceof sr?t:new sr(t,e),{alwaysWriteDefaults:r,default:n,ignoreUnknown:s=!0,name:o,nonNullable:a,readOnly:l=!1}=e;return f({type:s?i.apiValues:String,json:{type:i.jsonValues,default:n,name:o,read:!l&&{reader:i.read},write:{writer:i.write,alwaysWriteDefaults:r}},nonNullable:a,readOnly:l})}var m9;let SN=m9=class extends we{constructor(t){super(t),this.type="none"}clone(){return new m9({type:this.type})}};u([_t({none:"none",stayAbove:"stay-above"})],SN.prototype,"type",void 0),SN=m9=u([L("esri.ground.NavigationConstraint")],SN);function z3(t){const e=yJ(100*(1-t));return Math.max(0,Math.min(e,100))}function FE(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var g9;let fg=g9=class extends P3(wm){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ot;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&de.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{Bn(t)||de.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Ye(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",vm(t,this._get("layers")))}writeLayers(t,e,i,r){const n=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};jUe(s)().write(o,r)&&n.push(o)}else r!=null&&r.messages&&r.messages.push(new Y("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return DJ(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await fe(()=>import("./ElevationQuery-om-N8Csq.js"),[]);zt(e);const r=new i,n=this.layers.filter(Voe).toArray();return r.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await fe(()=>import("./ElevationQuery-om-N8Csq.js"),[]);zt(e);const r=new i,n=this.layers.filter(Voe).toArray();return r.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:te(this.surfaceColor),navigationConstraint:te(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new g9({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=(e==null?void 0:e.origin)||"web-scene",n=(e==null?void 0:e.portal)||null,s=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await fe(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-DeJ1MgNa.js");return{populateOperationalLayers:l}},__vite__mapDeps([10,11,12,13]));zt(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function GUe(t){return t&&"createElevationSampler"in t}function Voe(t){return t.type==="elevation"||GUe(t)}u([f({json:{read:!1}})],fg.prototype,"layers",null),u([ke("layers")],fg.prototype,"writeLayers",null),u([f({readOnly:!0})],fg.prototype,"resourceInfo",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Wi,read:{reader:FE,source:"transparency"},write:{writer:(t,e)=>{e.transparency=z3(t)},target:"transparency"}}})],fg.prototype,"opacity",void 0),u([f({type:mt,json:{type:[Wi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],fg.prototype,"surfaceColor",void 0),u([f({type:SN,json:{write:!0}})],fg.prototype,"navigationConstraint",void 0),fg=g9=u([L("esri.Ground")],fg);const DR=fg;function oe(t,e,i={}){return YJ(t,e,i,M1e)}function Kl(t,e,i={}){return YJ(t,e,i,$1e)}function YJ(t,e,i={},r){let n=null;const s=i.once?(o,a)=>{r(o)&&(Sr(n),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(n=r4e(t,s,i.sync,i.equals),i.initial){const o=t();s(o,o)}return n}function Vo(t,e,i,r={}){let n=null,s=null,o=null;function a(){var h;n&&s&&(s.remove(),(h=r.onListenerRemove)==null||h.call(r,n),n=null,s=null)}function l(h){r.once&&r.once&&Sr(o),i(h)}const c=oe(t,(h,p)=>{var g;a(),aU(h)&&(n=h,s=OC(h,e,l),(g=r.onListenerAdd)==null||g.call(r,h))},{sync:r.sync,initial:!0});return o=Ui(()=>{c.remove(),a()}),o}function kE(t,e){return HUe(t,$1e,e)}function HUe(t,e,i){if(zo(i))return Promise.reject(ki());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let n=null;function s(){n=Sr(n)}return new Promise((o,a)=>{n=Fb([_a(i,()=>{s(),a(ki())}),YJ(t,l=>{s(),o(l)},{sync:!1,once:!0},e??M1e)])})}function M1e(t){return!0}function $1e(t){return!!t}function qUe(t,e){const i=new ot,r=Vo(t,"after-splice",({added:n,start:s,deleteCount:o})=>{const a=i.splice(s,o);for(const l of a)l.remove();if(n!=null&&n.length){const l=n.map(e);i.addMany(l,s)}},{sync:!0,onListenerRemove:()=>i.drain(n=>n.remove()),onListenerAdd:n=>i.addMany(n.items.map(e))});return i.addHandles(r),i}function S3t(t,e){const i=new ot,r=qUe(t,a=>Ny(async l=>{const c=await e(a,l);if(zo(l))throw c.remove(),ki();return c})),n=()=>null,s=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(n));for(const a of r)bR(s(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const h=i.splice(l,c);for(const p of h)p==null||p.remove();if(a!=null&&a.length){i.addMany(a.map(n),l);for(const p of a)bR(s(p))}});return i.addHandles([S_e(r),o]),i}const xi={sync:!0},Si={initial:!0},hi={sync:!0,initial:!0};let lT=class extends ot{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(H_e(()=>this._refresh(),xi))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new ot(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(n=>!!n);for(const n of i)if(n){if(r(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};u([f()],lT.prototype,"getCollections",void 0),u([f()],lT.prototype,"getChildrenFunction",void 0),u([f()],lT.prototype,"itemFilterFunction",void 0),lT=u([L("esri.core.CollectionFlattener")],lT);const NR=lT,VP=new WeakMap;function O1e(t){return!t.destroyed&&(VP.has(t)||t.addHandles([oe(()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||O1e(e))},e=>VP.set(t,e),hi),Ui(()=>VP.delete(t))]),VP.get(t))}function WUe(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function ZUe(t){var e,i;return!(!WUe(t)||!((i=(e=xUe(t))==null?void 0:e.operations)!=null&&i.supportsEditing)||"editingEnabled"in t&&!TUe(t)||O1e(t))}const YUe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,XUe="screenUtils.toPt: input not recognized!",A1e=96;function qb(t){return t?t/72*A1e:0}function ud(t){return t?72*t/A1e:0}function mr(t){if(typeof t=="string"){const e=t.match(YUe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=r==="px"?ud(i):i;return n?-s:s}return console.warn(XUe),null}return t}function ju(t=0,e=0){return{x:t,y:e}}function E3t(t){return t?ju(t.x,t.y):null}function ds(t=0,e=0){return[t,e]}function R1e(t=0,e=0){return[t,e]}function Ip(t=0,e=0,i=0){return[t,e,i]}function C3t(t){return t}function M3t(t){return t}function $3t(t){return t}function Mp(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function bU(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function JUe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function QUe(t,e,i,r,n,s,o,a,l,c,h,p,g,y,w,b){const x=new Float32Array(16);return x[0]=t,x[1]=e,x[2]=i,x[3]=r,x[4]=n,x[5]=s,x[6]=o,x[7]=a,x[8]=l,x[9]=c,x[10]=h,x[11]=p,x[12]=g,x[13]=y,x[14]=w,x[15]=b,x}function KUe(t,e){return new Float32Array(t,e,16)}const eze=bU();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:eze,clone:JUe,create:bU,createView:KUe,fromValues:QUe},Symbol.toStringTag,{value:"Module"}));function A(){return[0,0,0]}function En(t){return[t[0],t[1],t[2]]}function Qe(t,e,i){return[t,e,i]}function xm(t,e,i){return[t,e,i]}function FR(t,e=A()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function tze(t,e){return new Float64Array(t,e,3)}function FC(){return A()}function XJ(){return Qe(1,1,1)}function I1e(){return Qe(1,0,0)}function P1e(){return Qe(0,1,0)}function JJ(){return Qe(0,0,1)}const ws=FC(),kR=XJ(),QJ=I1e(),KJ=P1e(),UE=JJ();Object.freeze(Object.defineProperty({__proto__:null,ONES:kR,UNIT_X:QJ,UNIT_Y:KJ,UNIT_Z:UE,ZEROS:ws,clone:En,create:A,createView:tze,freeze:xm,fromArray:FR,fromValues:Qe,ones:XJ,unitX:I1e,unitY:P1e,unitZ:JJ,zeros:FC},Symbol.toStringTag,{value:"Module"}));let eQ=1e-6;function Bo(){return eQ}function ize(t){eQ=t}const V3=Math.random,rze=Math.PI/180,nze=180/Math.PI;function tQ(t){return t*rze}function sze(t){return t*nze}function oze(t,e){return Math.abs(t-e)<=eQ*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:V3,equals:oze,getEpsilon:Bo,setEpsilon:ize,toDegree:sze,toRadian:tQ},Symbol.toStringTag,{value:"Module"}));function ps(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Im(t,e,i,r,n,s,o,a,l,c,h,p,g,y,w,b,x){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=g,t[12]=y,t[13]=w,t[14]=b,t[15]=x,t}function Jp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Gc(t,e){if(t===e){const i=e[1],r=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function iQ(t,e){return Yl(t,e)||Jp(t),t}function Yl(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],g=e[10],y=e[11],w=e[12],b=e[13],x=e[14],T=e[15],M=i*a-r*o,$=i*l-n*o,R=i*c-s*o,I=r*l-n*a,P=r*c-s*a,N=n*c-s*l,V=h*b-p*w,U=h*x-g*w,B=h*T-y*w,W=p*x-g*b,j=p*T-y*b,Q=g*T-y*x;let Z=M*Q-$*j+R*W+I*B-P*U+N*V;return Z?(Z=1/Z,t[0]=(a*Q-l*j+c*W)*Z,t[1]=(n*j-r*Q-s*W)*Z,t[2]=(b*N-x*P+T*I)*Z,t[3]=(g*P-p*N-y*I)*Z,t[4]=(l*B-o*Q-c*U)*Z,t[5]=(i*Q-n*B+s*U)*Z,t[6]=(x*R-w*N-T*$)*Z,t[7]=(h*N-g*R+y*$)*Z,t[8]=(o*j-a*B+c*V)*Z,t[9]=(r*B-i*j-s*V)*Z,t[10]=(w*P-b*R+T*M)*Z,t[11]=(p*R-h*P-y*M)*Z,t[12]=(a*U-o*W-l*V)*Z,t[13]=(i*W-r*U+n*V)*Z,t[14]=(b*$-w*I-x*M)*Z,t[15]=(h*I-p*$+g*M)*Z,t):null}function aze(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],g=e[10],y=e[11],w=e[12],b=e[13],x=e[14],T=e[15];return t[0]=a*(g*T-y*x)-p*(l*T-c*x)+b*(l*y-c*g),t[1]=-(r*(g*T-y*x)-p*(n*T-s*x)+b*(n*y-s*g)),t[2]=r*(l*T-c*x)-a*(n*T-s*x)+b*(n*c-s*l),t[3]=-(r*(l*y-c*g)-a*(n*y-s*g)+p*(n*c-s*l)),t[4]=-(o*(g*T-y*x)-h*(l*T-c*x)+w*(l*y-c*g)),t[5]=i*(g*T-y*x)-h*(n*T-s*x)+w*(n*y-s*g),t[6]=-(i*(l*T-c*x)-o*(n*T-s*x)+w*(n*c-s*l)),t[7]=i*(l*y-c*g)-o*(n*y-s*g)+h*(n*c-s*l),t[8]=o*(p*T-y*b)-h*(a*T-c*b)+w*(a*y-c*p),t[9]=-(i*(p*T-y*b)-h*(r*T-s*b)+w*(r*y-s*p)),t[10]=i*(a*T-c*b)-o*(r*T-s*b)+w*(r*c-s*a),t[11]=-(i*(a*y-c*p)-o*(r*y-s*p)+h*(r*c-s*a)),t[12]=-(o*(p*x-g*b)-h*(a*x-l*b)+w*(a*g-l*p)),t[13]=i*(p*x-g*b)-h*(r*x-n*b)+w*(r*g-n*p),t[14]=-(i*(a*x-l*b)-o*(r*x-n*b)+w*(r*l-n*a)),t[15]=i*(a*g-l*p)-o*(r*g-n*p)+h*(r*l-n*a),t}function lze(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],g=t[11],y=t[12],w=t[13],b=t[14],x=t[15];return(e*o-i*s)*(p*x-g*b)-(e*a-r*s)*(h*x-g*w)+(e*l-n*s)*(h*b-p*w)+(i*a-r*o)*(c*x-g*y)-(i*l-n*o)*(c*b-p*y)+(r*l-n*a)*(c*w-h*y)}function fs(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],g=e[9],y=e[10],w=e[11],b=e[12],x=e[13],T=e[14],M=e[15];let $=i[0],R=i[1],I=i[2],P=i[3];return t[0]=$*r+R*a+I*p+P*b,t[1]=$*n+R*l+I*g+P*x,t[2]=$*s+R*c+I*y+P*T,t[3]=$*o+R*h+I*w+P*M,$=i[4],R=i[5],I=i[6],P=i[7],t[4]=$*r+R*a+I*p+P*b,t[5]=$*n+R*l+I*g+P*x,t[6]=$*s+R*c+I*y+P*T,t[7]=$*o+R*h+I*w+P*M,$=i[8],R=i[9],I=i[10],P=i[11],t[8]=$*r+R*a+I*p+P*b,t[9]=$*n+R*l+I*g+P*x,t[10]=$*s+R*c+I*y+P*T,t[11]=$*o+R*h+I*w+P*M,$=i[12],R=i[13],I=i[14],P=i[15],t[12]=$*r+R*a+I*p+P*b,t[13]=$*n+R*l+I*g+P*x,t[14]=$*s+R*c+I*y+P*T,t[15]=$*o+R*h+I*w+P*M,t}function hd(t,e,i){const r=i[0],n=i[1],s=i[2];if(e===t)t[12]=e[0]*r+e[4]*n+e[8]*s+e[12],t[13]=e[1]*r+e[5]*n+e[9]*s+e[13],t[14]=e[2]*r+e[6]*n+e[10]*s+e[14],t[15]=e[3]*r+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],p=e[5],g=e[6],y=e[7],w=e[8],b=e[9],x=e[10],T=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=p,t[6]=g,t[7]=y,t[8]=w,t[9]=b,t[10]=x,t[11]=T,t[12]=o*r+h*n+w*s+e[12],t[13]=a*r+p*n+b*s+e[13],t[14]=l*r+g*n+x*s+e[14],t[15]=c*r+y*n+T*s+e[15]}return t}function L1e(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Lu(t,e,i,r){let n=r[0],s=r[1],o=r[2],a=Math.sqrt(n*n+s*s+o*o);if(a<=Bo())return void ps(t,e);a=1/a,n*=a,s*=a,o*=a;const l=Math.sin(i),c=Math.cos(i),h=1-c,p=e[0],g=e[1],y=e[2],w=e[3],b=e[4],x=e[5],T=e[6],M=e[7],$=e[8],R=e[9],I=e[10],P=e[11],N=n*n*h+c,V=s*n*h+o*l,U=o*n*h-s*l,B=n*s*h-o*l,W=s*s*h+c,j=o*s*h+n*l,Q=n*o*h+s*l,Z=s*o*h-n*l,X=o*o*h+c;t[0]=p*N+b*V+$*U,t[1]=g*N+x*V+R*U,t[2]=y*N+T*V+I*U,t[3]=w*N+M*V+P*U,t[4]=p*B+b*W+$*j,t[5]=g*B+x*W+R*j,t[6]=y*B+T*W+I*j,t[7]=w*B+M*W+P*j,t[8]=p*Q+b*Z+$*X,t[9]=g*Q+x*Z+R*X,t[10]=y*Q+T*Z+I*X,t[11]=w*Q+M*Z+P*X,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15])}function zE(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*r,t[5]=o*n+h*r,t[6]=a*n+p*r,t[7]=l*n+g*r,t[8]=c*n-s*r,t[9]=h*n-o*r,t[10]=p*n-a*r,t[11]=g*n-l*r,t}function xU(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],p=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*r,t[1]=o*n-h*r,t[2]=a*n-p*r,t[3]=l*n-g*r,t[8]=s*r+c*n,t[9]=o*r+h*n,t[10]=a*r+p*n,t[11]=l*r+g*n,t}function VE(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],p=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*r,t[1]=o*n+h*r,t[2]=a*n+p*r,t[3]=l*n+g*r,t[4]=c*n-s*r,t[5]=h*n-o*r,t[6]=p*n-a*r,t[7]=g*n-l*r,t}function rQ(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function cze(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dd(t,e,i){if(e===0)return Jp(t);let r=i[0],n=i[1],s=i[2],o=Math.sqrt(r*r+n*n+s*s);if(o<=Bo())return null;o=1/o,r*=o,n*=o,s*=o;const a=Math.sin(e),l=Math.cos(e),c=1-l;return t[0]=r*r*c+l,t[1]=n*r*c+s*a,t[2]=s*r*c-n*a,t[3]=0,t[4]=r*n*c-s*a,t[5]=n*n*c+l,t[6]=s*n*c+r*a,t[7]=0,t[8]=r*s*c+n*a,t[9]=n*s*c-r*a,t[10]=s*s*c+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uze(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hze(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D1e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function N1e(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=r+r,l=n+n,c=s+s,h=r*a,p=r*l,g=r*c,y=n*l,w=n*c,b=s*c,x=o*a,T=o*l,M=o*c;return t[0]=1-(y+b),t[1]=p+M,t[2]=g-T,t[3]=0,t[4]=p-M,t[5]=1-(h+b),t[6]=w+x,t[7]=0,t[8]=g+T,t[9]=w-x,t[10]=1-(h+y),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function dze(t,e){const i=pze,r=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=r*r+n*n+s*s+o*o;return p>0?(i[0]=2*(a*o+h*r+l*s-c*n)/p,i[1]=2*(l*o+h*n+c*r-a*s)/p,i[2]=2*(c*o+h*s+a*n-l*r)/p):(i[0]=2*(a*o+h*r+l*s-c*n),i[1]=2*(l*o+h*n+c*r-a*s),i[2]=2*(c*o+h*s+a*n-l*r)),N1e(t,e,i),t}const pze=A();function fze(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function F1e(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(i*i+r*r+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function k1e(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function mze(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,h=o+o,p=n*l,g=n*c,y=n*h,w=s*c,b=s*h,x=o*h,T=a*l,M=a*c,$=a*h,R=r[0],I=r[1],P=r[2];return t[0]=(1-(w+x))*R,t[1]=(g+$)*R,t[2]=(y-M)*R,t[3]=0,t[4]=(g-$)*I,t[5]=(1-(p+x))*I,t[6]=(b+T)*I,t[7]=0,t[8]=(y+M)*P,t[9]=(b-T)*P,t[10]=(1-(p+w))*P,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function gze(t,e,i,r,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,h=o+o,p=a+a,g=s*c,y=s*h,w=s*p,b=o*h,x=o*p,T=a*p,M=l*c,$=l*h,R=l*p,I=r[0],P=r[1],N=r[2],V=n[0],U=n[1],B=n[2],W=(1-(b+T))*I,j=(y+R)*I,Q=(w-$)*I,Z=(y-R)*P,X=(1-(g+T))*P,ge=(x+M)*P,ae=(w+$)*N,z=(x-M)*N,he=(1-(g+b))*N;return t[0]=W,t[1]=j,t[2]=Q,t[3]=0,t[4]=Z,t[5]=X,t[6]=ge,t[7]=0,t[8]=ae,t[9]=z,t[10]=he,t[11]=0,t[12]=i[0]+V-(W*V+Z*U+ae*B),t[13]=i[1]+U-(j*V+X*U+z*B),t[14]=i[2]+B-(Q*V+ge*U+he*B),t[15]=1,t}function yze(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,h=r*o,p=r*a,g=n*o,y=n*a,w=n*l,b=s*o,x=s*a,T=s*l;return t[0]=1-p-w,t[1]=h+T,t[2]=g-x,t[3]=0,t[4]=h-T,t[5]=1-c-w,t[6]=y+b,t[7]=0,t[8]=g+x,t[9]=y-b,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function U1e(t,e,i,r,n,s,o){const a=1/(i-e),l=1/(n-r),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function _ze(t,e,i,r,n){const s=1/Math.tan(e/2);let o;return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(r-n),t[10]=(n+r)*o,t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t}function vze(t,e,i,r){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function z1e(t,e,i,r,n,s,o){const a=1/(e-i),l=1/(r-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(o+s)*c,t[15]=1,t}function SU(t,e,i,r){const n=e[0],s=e[1],o=e[2];let a=n-i[0],l=s-i[1],c=o-i[2];const h=Bo();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void Jp(t);let p=1/Math.sqrt(a*a+l*l+c*c);a*=p,l*=p,c*=p;const g=r[0],y=r[1],w=r[2];let b=y*c-w*l,x=w*a-g*c,T=g*l-y*a;p=Math.sqrt(b*b+x*x+T*T),p?(p=1/p,b*=p,x*=p,T*=p):(b=0,x=0,T=0);let M=l*T-c*x,$=c*b-a*T,R=a*x-l*b;p=Math.sqrt(M*M+$*$+R*R),p?(p=1/p,M*=p,$*=p,R*=p):(M=0,$=0,R=0),t[0]=b,t[1]=M,t[2]=a,t[3]=0,t[4]=x,t[5]=$,t[6]=l,t[7]=0,t[8]=T,t[9]=R,t[10]=c,t[11]=0,t[12]=-(b*n+x*s+T*o),t[13]=-(M*n+$*s+R*o),t[14]=-(a*n+l*s+c*o),t[15]=1}function V1e(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let h=n-i[0],p=s-i[1],g=o-i[2],y=h*h+p*p+g*g;y>0&&(y=1/Math.sqrt(y),h*=y,p*=y,g*=y);let w=l*g-c*p,b=c*h-a*g,x=a*p-l*h;return y=w*w+b*b+x*x,y>0&&(y=1/Math.sqrt(y),w*=y,b*=y,x*=y),t[0]=w,t[1]=b,t[2]=x,t[3]=0,t[4]=p*x-g*b,t[5]=g*w-h*x,t[6]=h*b-p*w,t[7]=0,t[8]=h,t[9]=p,t[10]=g,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function wze(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function bze(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function xze(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function B1e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function Sze(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function Tze(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function j1e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function nQ(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],g=t[10],y=t[11],w=t[12],b=t[13],x=t[14],T=t[15],M=e[0],$=e[1],R=e[2],I=e[3],P=e[4],N=e[5],V=e[6],U=e[7],B=e[8],W=e[9],j=e[10],Q=e[11],Z=e[12],X=e[13],ge=e[14],ae=e[15],z=Bo();return Math.abs(i-M)<=z*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(r-$)<=z*Math.max(1,Math.abs(r),Math.abs($))&&Math.abs(n-R)<=z*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(s-I)<=z*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(o-P)<=z*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(a-N)<=z*Math.max(1,Math.abs(a),Math.abs(N))&&Math.abs(l-V)<=z*Math.max(1,Math.abs(l),Math.abs(V))&&Math.abs(c-U)<=z*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(h-B)<=z*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(p-W)<=z*Math.max(1,Math.abs(p),Math.abs(W))&&Math.abs(g-j)<=z*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(y-Q)<=z*Math.max(1,Math.abs(y),Math.abs(Q))&&Math.abs(w-Z)<=z*Math.max(1,Math.abs(w),Math.abs(Z))&&Math.abs(b-X)<=z*Math.max(1,Math.abs(b),Math.abs(X))&&Math.abs(x-ge)<=z*Math.max(1,Math.abs(x),Math.abs(ge))&&Math.abs(T-ae)<=z*Math.max(1,Math.abs(T),Math.abs(ae))}function sQ(t){const e=Bo(),i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+h*h))<=e}function TU(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const Eze=fs,Cze=B1e;Object.freeze(Object.defineProperty({__proto__:null,add:xze,adjoint:aze,copy:ps,determinant:lze,equals:nQ,exactEquals:j1e,frob:bze,fromQuat:yze,fromQuat2:dze,fromRotation:dd,fromRotationTranslation:N1e,fromRotationTranslationScale:mze,fromRotationTranslationScaleOrigin:gze,fromScaling:cze,fromTranslation:rQ,fromXRotation:uze,fromYRotation:hze,fromZRotation:D1e,frustum:U1e,getRotation:k1e,getScaling:F1e,getTranslation:fze,hasIdentityRotation:TU,identity:Jp,invert:Yl,invertOrIdentity:iQ,isOrthoNormal:sQ,lookAt:SU,mul:Eze,multiply:fs,multiplyScalar:Sze,multiplyScalarAndAdd:Tze,ortho:z1e,perspective:_ze,perspectiveFromFieldOfView:vze,rotate:Lu,rotateX:zE,rotateY:xU,rotateZ:VE,scale:L1e,set:Im,str:wze,sub:Cze,subtract:B1e,targetTo:V1e,translate:hd,transpose:Gc},Symbol.toStringTag,{value:"Module"}));const Mze=(t,e)=>{const i=Im(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Gc(i,i)},$ze=(t,e)=>{const i=Im(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Gc(i,i)},Oze=(t,e)=>{const i=1-e,r=Im(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Gc(r,r)},Aze=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),n=Im(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Gc(n,n)},Rze=(t,e)=>{const i=1-2*e,r=Im(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Gc(r,r)},Ize=(t,e)=>{const i=Im(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Gc(i,i)},Pze=(t,e)=>{const i=1-e,r=Im(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Gc(r,r)};let G1e=class H1e{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Oc(e.strength,i.strength,r),this.radius=Oc(e.radius,i.radius,r),this.threshold=Oc(e.threshold,i.threshold,r)}clone(){return new H1e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:UA(this.radius),strength:this.strength,threshold:this.threshold}}},q1e=class W1e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Oc(e.radius,i.radius,r))}clone(){return new W1e(this.radius)}toJSON(){return{type:"blur",radius:UA(this.radius)}}},y9=class Z1e{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Oc(e.amount,i.amount,r),this._updateMatrix()}clone(){return new Z1e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||bU();switch(this.type){case"brightness":this._colorMatrix=Mze(e,this.amount);break;case"contrast":this._colorMatrix=$ze(e,this.amount);break;case"grayscale":this._colorMatrix=Oze(e,this.amount);break;case"invert":this._colorMatrix=Rze(e,this.amount);break;case"saturate":this._colorMatrix=Ize(e,this.amount);break;case"sepia":this._colorMatrix=Pze(e,this.amount)}}},Y1e=class X1e{constructor(e,i,r,n){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Oc(e.offsetX,i.offsetX,r),this.offsetY=Oc(e.offsetY,i.offsetY,r),this.blurRadius=Oc(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Oc(e.color[0],i.color[0],r)),this.color[1]=Math.round(Oc(e.color[1],i.color[1],r)),this.color[2]=Math.round(Oc(e.color[2],i.color[2],r)),this.color[3]=Oc(e.color[3],i.color[3],r)}clone(){return new X1e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:UA(this.offsetX),yoffset:UA(this.offsetY),blurRadius:UA(this.blurRadius),color:e}}},J1e=class Q1e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Oc(e.angle,i.angle,r),this._updateMatrix()}clone(){return new Q1e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||bU();this._colorMatrix=Aze(e,this.angle)}},K1e=class ewe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Oc(e.amount,i.amount,r)}clone(){return new ewe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Oc(t,e,i){return t+(e-t)*i}function UA(t){return Math.round(1e3*ud(t))/1e3}function Lze(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new y9(t.type,0);case"saturate":case"brightness":case"contrast":return new y9(t.type,1);case"opacity":return new K1e(1);case"hue-rotate":return new J1e(0);case"blur":return new q1e(0);case"drop-shadow":return new Y1e(0,0,0,[...ZJ("transparent")]);case"bloom":return new G1e(0,0,1)}}function Dze(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,n)=>r.type===i[n].type)}function Nze(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let n=r.length;n<i.length;n++)r.push(Lze(i[n]))}function Fze(t){const e=t[0];return!!e&&"type"in e}function kze(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}const R6=()=>de.getLogger("esri.support.basemapUtils");function Uze(){return{}}function zze(t){for(const e in t){const i=t[e];Ye(i),delete t[e]}}function oQ(t,e){let i;if(typeof t=="string"){const r=t in h9,n=!r&&t.includes("/");if(!r&&!n){if(Qr.apiKey)R6().warn(`Unable to find basemap definition for: ${t}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const s=Object.entries(h9).filter(([o,a])=>a.classic||a.is3d).map(([o])=>`"${o}"`).sort().join(", ");R6().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${s}`)}return null}e&&(i=e[t]),i||(i=r?J2.fromId(t):new J2({style:{id:t}}),e&&(e[t]=i))}else i=is(J2,t);return i!=null&&i.destroyed&&(R6().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function O3t(t,e){var i,r,n,s;return((r=(i=t.basemap)==null?void 0:i.referenceLayers)==null?void 0:r.some(o=>o.uid===e))||((s=(n=t.basemap)==null?void 0:n.baseLayers)==null?void 0:s.some(o=>o.uid===e))}function Vze(t,e=null){const i=oQ(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=Boe(r.baseLayers,e.baseLayers),r.referenceLayers=Boe(r.referenceLayers,e.referenceLayers)),r}function Boe(t,e){const i=new ot;return t.forEach(r=>{const n=e.find(s=>s.type!=="scene"&&Gze(Hoe(r),Hoe(s)))||r;i.includes(n)?i.push(r):i.push(n)}),i}function joe(t){return!!(t!=null&&t.baseLayers.concat(t.referenceLayers).some(Bze))}function Bze(t){if(Goe(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(Goe(i==null?void 0:i.sourceUrl))return!0}return!1}const jze=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function Goe(t){if(!t)return!1;const e=new yb(Iu(t));return!!e.authority&&jze.test(e.authority)}function Hoe(t){var e,i;return{type:t.type,effect:"effect"in t?t.effect:void 0,url:Hze("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null||(e=t.sublayers)==null?void 0:e.map(r=>({id:r.id,visible:r.visible})),activeLayerId:t.type==="wmts"?(i=t.activeLayer)==null?void 0:i.id:void 0}}function Gze(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!kze(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),n=e.sublayers.at(i);if((r==null?void 0:r.id)!==(n==null?void 0:n.id)||(r==null?void 0:r.visible)!==(n==null?void 0:n.visible))return!1}}return!0}function Hze(t){return t?nd(t).replace(/^\s*https?:/i,"").toLowerCase():""}function qze(t){return new NR({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function I6(t){for(const e of t.values())e==null||e.destroy();t.clear()}const qoe={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Wze(t){let e=null;if(typeof t=="string")if(t in qoe){const i=qoe[t];e=new DR({resourceInfo:{data:{layers:[i]}}})}else de.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=is(DR,t);return e}function BE(t,e,i=!1){let{hasM:r,hasZ:n}=t;Array.isArray(e)?e.length!==4||r||n?e.length===3&&i&&!r?(n=!0,r=!1):e.length===3&&r&&n&&(r=!1,n=!1):(r=!0,n=!0):(n=!n&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=r}var _9;function Woe(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function Zze(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let X0=_9=class extends jv{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var n;if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):Zze(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=(n=i.points)==null?void 0:n[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new pr,i=this.hasZ,r=this.hasM,n=i?3:2,s=t[0],o=Woe(Math.min),a=Woe(Math.max);let l,c,h,p,[g,y]=s,[w,b]=s;for(let x=0,T=t.length;x<T;x++){const M=t[x],[$,R]=M;if(g=o(g,$),y=o(y,R),w=a(w,$),b=a(b,R),i&&M.length>2){const I=M[2];l=o(l,I),h=a(h,I)}if(r&&M.length>n){const I=M[n];c=o(c,I),p=a(p,I)}}return e.xmin=g,e.ymin=y,e.xmax=w,e.ymax=b,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=te(this.points)}addPoint(t){return BE(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:te(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new _9(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new wt(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new wt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(BE(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([f({readOnly:!0})],X0.prototype,"cache",null),u([f()],X0.prototype,"extent",null),u([f({type:[[Number]],json:{write:{isRequired:!0}}})],X0.prototype,"points",void 0),u([ke("points")],X0.prototype,"writePoints",null),X0=_9=u([L("esri.geometry.Multipoint")],X0),X0.prototype.toJSON.isDefaultToJSON=!0;const kC=X0;function A3t(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function Yze(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var wl;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(wl||(wl={}));function EU(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}return Math.sqrt(i*i+r*r)}function twe(t,e,i){const r=t[0]+i*(e[0]-t[0]),n=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,n,t[2]+i*(e[2]-t[2])]:[r,n]}function R3t(t,e,i,r){const[n,s]=e,[o,a]=i,[l,c]=r,h=l-o,p=c-a,g=h*h+p*p,y=(n-o)*h+(s-a)*p,w=Math.min(1,Math.max(0,y/g));return t[0]=o+h*w,t[1]=a+p*w,t}function Xze(t,e,i,r,n,s){let o=i,a=r,l=n-o,c=s-a;if(l!==0||c!==0){const h=((t-o)*l+(e-a)*c)/(l*l+c*c);h>1?(o=n,a=s):h>0&&(o+=l*h,a+=c*h)}return l=t-o,c=e-a,l*l+c*c}function iwe(t,e){return twe(t,e,.5)}function rwe(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=EU(t[r],t[r+1]);return i}function nwe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let n=0;n<i-1;++n){const s=EU(t[n],t[n+1]);if(e-r<s){const o=(e-r)/s;return twe(t[n],t[n+1],o)}r+=s}return t[i-1]}function aQ(t,e=wl.X,i=wl.Y){let r=0;const n=t.length;let s=t[0];for(let o=1;o<n;o++){const a=t[o];r+=(a[e]-s[e])*(a[i]+s[i]),s=a}if(!swe(t)){const o=t[0];r+=(o[e]-s[e])*(o[i]+s[i])}return r>=0}function swe(t){const e=t.length;return e<3||ym(t[0],t[e-1])}function Jze(t){if(!("rings"in t))return!1;let e=!1;for(const i of t.rings)swe(i)||(i.push(i[0].slice()),e=!0);return e}function I3t(t){return t.type!=="polygon"&&t.type!=="polyline"||Qze(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function Qze(t,e){const i=cy(e);if(!i)return;const r=i.valid[0],n=i.valid[1],s=n-r;for(const o of t){let a=1/0,l=-1/0;for(const h of o){const p=Kze(h[0],r,n);a=Math.min(a,p),l=Math.max(l,p),h[0]=p}const c=l-a;s-c<c&&o.forEach(h=>{h[0]<0&&(h[0]+=s)})}}function Kze(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function P3t(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((n,s)=>n.length===r[s].length)}function L3t(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function eVe(t){return t?owe(t.rings,t.hasZ??!1):null}function owe(t,e){if(!(t!=null&&t.length))return null;const i=[],r=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=awe(t[s],e,n);a&&r.push(a)}if(r.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){const s=t[0]&&t[0].length?tVe(t[0],e):null;if(!s)return null;i[0]=s[0],i[1]=s[1],e&&s.length>2&&(i[2]=s[2])}return i}function awe(t,e,i){let r=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let g=0;g<t.length;g++){const y=t[g],w=t[(g+1)%t.length],[b,x,T]=y,M=b-l,$=x-c,[R,I,P]=w,N=R-l,V=I-c,U=M*V-N*$;if(o+=U,r+=(M+N)*U,n+=($+V)*U,e&&y.length>2&&w.length>2){const B=T-h,W=P-h,j=M*W-N*B;s+=(B+W)*j,a+=j}b<i[0]&&(i[0]=b),b>i[1]&&(i[1]=b),x<i[2]&&(i[2]=x),x>i[3]&&(i[3]=x),e&&(T<i[4]&&(i[4]=T),T>i[5]&&(i[5]=T))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,n/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=s/(6*a)+h,p[4]=a)),p}function D3t(t,e){let i=0,r=0,n=0;t.nextPoint();const s=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[h,p]=l,g=h-s,y=p-o,[w,b]=c,x=w-s,T=b-o,M=g*T-x*y;n+=M,i+=(g+x)*M,r+=(y+T)*M,h<e[0]&&(e[0]=h),h>e[1]&&(e[1]=h),p<e[2]&&(e[2]=p),p>e[3]&&(e[3]=p)}return n>0&&(n*=-1),n?(n*=.5,[i/(6*n)+s,r/(6*n)+o,n]):null}function tVe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],p=t[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],e&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const g=EU(i,r);if(g){n+=g;const y=iwe(h,p);s+=g*y[0],o+=g*y[1],e&&y.length>2&&(a+=g*y[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}function iVe(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=awe(Yze(t),t.hasZ,s);o&&n.push(o)}if(n.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),n.length&&(r[0]=n[0][0],r[1]=n[0][1],e&&(r[2]=n[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?rVe(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function rVe(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const p=t.x,g=t.y,y=t.z;i[0]=l,i[1]=c,r[0]=p,r[1]=g,e&&(i[2]=h,r[2]=y);const w=EU(i,r);if(w){n+=w;const b=iwe(i,r);s+=w*b[0],o+=w*b[1],e&&b.length>2&&(a+=w*b[2])}l=p,c=g,h=y}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const nVe=1e-6;function N3t(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<nVe){const n=iVe(t);return n?[n[0],n[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)oVe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const sVe=1/3;function oVe(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,n=i.y;i.nextPoint();let s,o=i.x-r,a=i.y-n,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-n,s=.5*sVe*(l*a-c*o),t[0]+=s*(o+l),t[1]+=s*(a+c),o=l,a=c;const h=i.getCurrentRingArea(),p=[r,n];return p[0]-=e[0],p[1]-=e[1],p[0]*=h,p[1]*=h,t[0]+=p[0],t[1]+=p[1],t}function Zi(t=hVe){return[t[0],t[1],t[2],t[3]]}function F3t(t){return[t[0],t[1],t[2],t[3]]}function xv(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function lQ(t,e,i,r,n=Zi()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function lwe(t,e=Zi()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function CU(t,e){return new pr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function aVe(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Q2(t,e,i){if(e!=null)if("length"in e)b9(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else xv(i,t)}function P6(t,e,i=t){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=n,i[1]=s,i[2]=o,i[3]=a,i}function v9(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Va(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Uc(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function k3t(t){return Va(t)*Uc(t)}function l5(t){return Va(t)>0&&Uc(t)>0}function cwe(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function uwe(t,e){return MU(t,e[0],e[1])}function Zoe(t,e){const i=e[3],r=.5*(t[0]+t[2]),n=Math.abs(e[0]-r),s=.5*(t[2]-t[0]);if(n>i+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(n<s||l<a)return!0;const c=n-s,h=l-a;return c*c+h*h<=i*i}function U3t(t,e,i){const r=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=i,p=(x,T)=>(h-l)*x+(a-c)*T+(c*l-a*h)<0,g=p(r,o),y=p(s,o),w=p(s,n),b=p(r,n);return!(g===y&&y===w&&w===b&&b===g||a<r&&c<r||a>s&&c>s||l>o&&h>o||l<n&&h<n)}function z3t(t,e){return MU(t,e.x,e.y)}function MU(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function lVe(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function $U(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Yoe(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function w9(t,e,i){if(e==null)return xv(i,t);const r=e[0],n=e[1],s=e[2],o=e[3];return i[0]=Oe(t[0],r,s),i[1]=Oe(t[1],n,o),i[2]=Oe(t[2],r,s),i[3]=Oe(t[3],n,o),i}function cVe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-i)-Va(t)/2,0),s=Math.max(Math.abs(e[1]-r)-Uc(t)/2,0);return Math.sqrt(n*n+s*s)}function c5(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function wy(t){return t?xv(t,x9):Zi(x9)}function b9(t){return t!=null&&t.length===4}function uVe(t){return!(Va(t)!==0&&isFinite(t[0])||Uc(t)!==0&&isFinite(t[1]))}function wb(t,e){return b9(t)&&b9(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const V3t=[-1/0,-1/0,1/0,1/0],x9=[1/0,1/0,-1/0,-1/0],hVe=[0,0,0,0];function hwe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function dwe(t){return t.points!==void 0}function pwe(t){return t.x!==void 0&&t.y!==void 0}function fwe(t){return t.paths!==void 0}function mwe(t){return t.rings!==void 0}function gwe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const Z_=gwe(Math.min),Y_=gwe(Math.max);function B3t(t,e){return fwe(e)?jE(t,e.paths,!1,!1):mwe(e)?jE(t,e.rings,!1,!1):dwe(e)?cQ(t,e.points,!1,!1,!1,!1):hwe(e)?ywe(t,e):(pwe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function j3t(t){let e,i,r,n;for(t.reset(),e=r=1/0,i=n=-1/0;t.nextPath();){const s=dVe(t);e=Math.min(s[0],e),r=Math.min(s[1],r),i=Math.max(s[2],i),n=Math.max(s[3],n)}return Zi([e,r,i,n])}function dVe(t){let e,i,r,n;for(e=r=1/0,i=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),n=Math.max(t.y,n);return Zi([e,r,i,n])}function G3t(t,e){return fwe(e)?jE(t,e.paths,!0,!1):mwe(e)?jE(t,e.rings,!0,!1):dwe(e)?cQ(t,e.points,!0,!1,!0,!1):hwe(e)?ywe(t,e,!0,!1,!0,!1):(pwe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function jE(t,e,i,r){const n=i?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,h]=e[0][0],[p,g]=e[0][0];for(let y=0;y<e.length;y++){const w=e[y];for(let b=0;b<w.length;b++){const x=w[b],[T,M]=x;if(c=Z_(c,T),h=Z_(h,M),p=Y_(p,T),g=Y_(g,M),i&&x.length>2){const $=x[2];s=Z_(s,$),o=Y_(o,$)}if(r&&x.length>n){const $=x[n];a=Z_(s,$),l=Y_(o,$)}}}return i?r?(t[0]=c,t[1]=h,t[2]=s,t[3]=a,t[4]=p,t[5]=g,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=s,t[3]=p,t[4]=g,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=h,t[2]=a,t[3]=p,t[4]=g,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=p,t[3]=g,t.length=4,t)}function ywe(t,e,i,r,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,p=e.zmax,g=e.mmin,y=e.mmax;return n?(h=h||0,p=p||0,s?(g=g||0,y=y||0,t[0]=o,t[1]=l,t[2]=h,t[3]=g,t[4]=a,t[5]=c,t[6]=p,t[7]=y,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=p,t)):s?(g=g||0,y=y||0,t[0]=o,t[1]=l,t[2]=g,t[3]=a,t[4]=c,t[5]=y,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function cQ(t,e,i,r,n,s){const o=i?3:2,a=r&&s,l=i&&n;if(!e.length||!e[0].length)return null;let c,h,p,g,[y,w]=e[0],[b,x]=e[0];for(let T=0;T<e.length;T++){const M=e[T],[$,R]=M;if(y=Z_(y,$),w=Z_(w,R),b=Y_(b,$),x=Y_(x,R),l&&M.length>2){const I=M[2];c=Z_(c,I),h=Y_(h,I)}if(a&&M.length>o){const I=M[o];p=Z_(c,I),g=Y_(h,I)}}return n?(c=c||0,h=h||0,s?(p=p||0,g=g||0,t[0]=y,t[1]=w,t[2]=c,t[3]=p,t[4]=b,t[5]=x,t[6]=h,t[7]=g,t):(t[0]=y,t[1]=w,t[2]=c,t[3]=b,t[4]=x,t[5]=h,t)):s?(p=p||0,g=g||0,t[0]=y,t[1]=w,t[2]=p,t[3]=b,t[4]=x,t[5]=g,t):(t[0]=y,t[1]=w,t[2]=b,t[3]=x,t)}function pVe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function fVe(t){return t.points!==void 0}function mVe(t){return t.x!==void 0&&t.y!==void 0}function gVe(t){return t.paths!==void 0}function yVe(t){return t.rings!==void 0}const uQ=[];function _we(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function vwe(t,e,i,r,n,s){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:n,zmax:s}}function wwe(t,e,i,r,n,s){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:n,mmax:s}}function bwe(t,e,i,r,n,s,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:n,ymax:s,zmax:o,mmax:a}}function hQ(t,e=!1,i=!1){return e?i?bwe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):vwe(t[0],t[1],t[2],t[3],t[4],t[5]):i?wwe(t[0],t[1],t[2],t[3],t[4],t[5]):_we(t[0],t[1],t[2],t[3])}function H3t(t){return t?pVe(t)?t:mVe(t)?vVe(t):yVe(t)?xwe(t):gVe(t)?Swe(t):fVe(t)?_Ve(t):null:null}function _Ve(t){const{hasZ:e,hasM:i,points:r}=t;return hQ(cQ(uQ,r,e??!1,i??!1),e,i)}function vVe(t){const{x:e,y:i,z:r,m:n}=t,s=n!=null;return r!=null?s?bwe(e,i,r,n,e,i,r,n):vwe(e,i,r,e,i,r):s?wwe(e,i,n,e,i,n):_we(e,i,e,i)}function xwe(t){const{hasZ:e,hasM:i,rings:r}=t,n=jE(uQ,r,e??!1,i??!1);return n?hQ(n,e,i):null}function Swe(t){const{hasZ:e,hasM:i,paths:r}=t,n=jE(uQ,r,e??!1,i??!1);return n?hQ(n,e,i):null}var TN;function Xoe(t){return!Array.isArray(t[0])}function wVe(t){var e;return typeof((e=t[0])==null?void 0:e[0])=="number"}function bVe(t){var s,o;if(!t)return;let{rings:e,hasM:i,hasZ:r,spatialReference:n}=t;switch(e??(e=[]),wVe(e)&&(e=[e]),(o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length){case 4:r??(r=!0),i??(i=!0);break;case 3:r??(r=i!==!0),i??(i=!r);break;default:r??(r=!1),i??(i=!1)}return n??(n=nt.WGS84),{...t,hasM:i,hasZ:r,rings:e,spatialReference:n}}let Yf=TN=class extends jv{static fromExtent(t){const e=t.clone().normalize(),{spatialReference:i}=t;let r=!1,n=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(s.hasZ=!0),n&&(s.hasM=!0),new TN(s)}constructor(t){super(bVe(t)),this.rings=[],this.type="polygon"}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=eVe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new wt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=xwe(this);if(!e)return null;const i=new pr(e);return i.spatialReference=t,i}get isSelfIntersecting(){return Zke(this.rings)}writeRings(t,e){e.rings=te(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(Xoe(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("rings"),this}clone(){const t=new TN;return t.spatialReference=this.spatialReference,t.rings=te(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([n,s,o,a],[l,c,h,p])=>n===l&&s===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!ym(s,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=k3(t,this.spatialReference);return kke(this,e??t)}isClockwise(t){const e=Xoe(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return aQ(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new wt(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new wt(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new wt(i[0],i[1],i[2],i[3],this.spatialReference):new wt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(BE(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new wt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new wt(n,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(BE(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([f({readOnly:!0})],Yf.prototype,"cache",null),u([f({readOnly:!0})],Yf.prototype,"centroid",null),u([f({readOnly:!0})],Yf.prototype,"extent",null),u([f({readOnly:!0})],Yf.prototype,"isSelfIntersecting",null),u([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],Yf.prototype,"rings",void 0),u([ke("rings")],Yf.prototype,"writeRings",null),Yf=TN=u([L("esri.geometry.Polygon")],Yf);const Qp=Yf;Yf.prototype.toJSON.isDefaultToJSON=!0;var S9;function xVe(t){return!Array.isArray(t[0])}function SVe(t){var e;return typeof((e=t[0])==null?void 0:e[0])=="number"}function TVe(t){var s,o;if(!t)return;let{paths:e,hasM:i,hasZ:r,spatialReference:n}=t;switch(e??(e=[]),SVe(e)&&(e=[e]),(o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length){case 4:r??(r=!0),i??(i=!0);break;case 3:r??(r=i!==!0),i??(i=!r);break;default:r??(r=!1),i??(i=!1)}return n??(n=nt.WGS84),{...t,hasM:i,hasZ:r,paths:e,spatialReference:n}}let O_=S9=class extends jv{constructor(t){super(TVe(t)),this.paths=[],this.type="polyline"}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=Swe(this);if(!e)return null;const i=new pr(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=te(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(xVe(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("paths"),this}clone(){const t=new S9;return t.spatialReference=this.spatialReference,t.paths=te(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new wt(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new wt(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new wt(i[0],i[1],i[2],i[3],this.spatialReference):new wt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(BE(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new wt(n,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new wt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(BE(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([f({readOnly:!0})],O_.prototype,"cache",null),u([f({readOnly:!0})],O_.prototype,"extent",null),u([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],O_.prototype,"paths",void 0),u([ke("paths")],O_.prototype,"writePaths",null),O_=S9=u([L("esri.geometry.Polyline")],O_);const OU=O_;O_.prototype.toJSON.isDefaultToJSON=!0;const Twe=Za()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Joe=Za()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Ewe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function dQ(t){return t.points!==void 0}function pQ(t){return t.x!==void 0&&t.y!==void 0}function AU(t){return t.paths!==void 0}function bb(t){return t.rings!==void 0}function Sv(t){return t==null?null:t instanceof jv?t:pQ(t)?wt.fromJSON(t):AU(t)?OU.fromJSON(t):bb(t)?Qp.fromJSON(t):dQ(t)?kC.fromJSON(t):Ewe(t)?pr.fromJSON(t):null}function fQ(t){return t?pQ(t)?"esriGeometryPoint":AU(t)?"esriGeometryPolyline":bb(t)?"esriGeometryPolygon":Ewe(t)?"esriGeometryEnvelope":dQ(t)?"esriGeometryMultipoint":null:null}const EVe={esriGeometryPoint:wt,esriGeometryPolyline:OU,esriGeometryPolygon:Qp,esriGeometryEnvelope:pr,esriGeometryMultipoint:kC,esriGeometryMultiPatch:Qp};function CVe(t){return t&&EVe[t]||null}const UC={base:jv,key:"type",typeMap:{extent:pr,multipoint:kC,point:wt,polyline:OU,polygon:Qp}};Bu(UC);let Cwe=0;const mQ=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Cwe++})}};return e=u([L("esri.core.Identifiable")],e),e},q3t=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Cwe++})}};return e=u([L("esri.core.Identifiable.NumericIdentifiable")],e),e};let Qoe=class extends mQ(class{}){};Qoe=u([L("esri.core.Identifiable")],Qoe);async function MVe(t){var r;const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await fe(async()=>{const{fromItem:n}=await import("./portalLayers-B5Wt0mct.js").then(s=>s.p);return{fromItem:n}},__vite__mapDeps([11,12,13]));try{return await i(e)}catch(n){const s=e==null?void 0:e.portalItem,o=(s==null?void 0:s.id)||"unset",a=((r=s==null?void 0:s.portal)==null?void 0:r.url)||Qr.portalUrl;throw de.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+o+"')",n),n}}const Koe=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class yx extends Error{}class $Ve extends yx{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class OVe extends yx{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class AVe extends yx{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class g2 extends yx{}class Mwe extends yx{constructor(e){super(`Invalid unit ${e}`)}}class fl extends yx{}class x0 extends yx{constructor(){super("Zone is an abstract class")}}const pt="numeric",Kp="short",ku="long",u5={year:pt,month:pt,day:pt},$we={year:pt,month:Kp,day:pt},RVe={year:pt,month:Kp,day:pt,weekday:Kp},Owe={year:pt,month:ku,day:pt},Awe={year:pt,month:ku,day:pt,weekday:ku},Rwe={hour:pt,minute:pt},Iwe={hour:pt,minute:pt,second:pt},Pwe={hour:pt,minute:pt,second:pt,timeZoneName:Kp},Lwe={hour:pt,minute:pt,second:pt,timeZoneName:ku},Dwe={hour:pt,minute:pt,hourCycle:"h23"},Nwe={hour:pt,minute:pt,second:pt,hourCycle:"h23"},Fwe={hour:pt,minute:pt,second:pt,hourCycle:"h23",timeZoneName:Kp},kwe={hour:pt,minute:pt,second:pt,hourCycle:"h23",timeZoneName:ku},Uwe={year:pt,month:pt,day:pt,hour:pt,minute:pt},zwe={year:pt,month:pt,day:pt,hour:pt,minute:pt,second:pt},Vwe={year:pt,month:Kp,day:pt,hour:pt,minute:pt},Bwe={year:pt,month:Kp,day:pt,hour:pt,minute:pt,second:pt},IVe={year:pt,month:Kp,day:pt,weekday:Kp,hour:pt,minute:pt},jwe={year:pt,month:ku,day:pt,hour:pt,minute:pt,timeZoneName:Kp},Gwe={year:pt,month:ku,day:pt,hour:pt,minute:pt,second:pt,timeZoneName:Kp},Hwe={year:pt,month:ku,day:pt,weekday:ku,hour:pt,minute:pt,timeZoneName:ku},qwe={year:pt,month:ku,day:pt,weekday:ku,hour:pt,minute:pt,second:pt,timeZoneName:ku};class zC{get type(){throw new x0}get name(){throw new x0}get ianaName(){return this.name}get isUniversal(){throw new x0}offsetName(e,i){throw new x0}formatOffset(e,i){throw new x0}offset(e){throw new x0}equals(e){throw new x0}get isValid(){throw new x0}}let L6=null;class RU extends zC{static get instance(){return L6===null&&(L6=new RU),L6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return tbe(e,i,r)}formatOffset(e,i){return zA(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let EN={};function PVe(t){return EN[t]||(EN[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),EN[t]}const LVe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function DVe(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,n,s,o,a,l,c,h]=r;return[o,n,s,a,l,c,h]}function NVe(t,e){const i=t.formatToParts(e),r=[];for(let n=0;n<i.length;n++){const{type:s,value:o}=i[n],a=LVe[s];s==="era"?r[a]=o:Ci(a)||(r[a]=parseInt(o,10))}return r}let BP={};class Gu extends zC{static create(e){return BP[e]||(BP[e]=new Gu(e)),BP[e]}static resetCache(){BP={},EN={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Gu.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return tbe(e,i,r,this.name)}formatOffset(e,i){return zA(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=PVe(this.name);let[n,s,o,a,l,c,h]=r.formatToParts?NVe(r,i):DVe(r,i);a==="BC"&&(n=-Math.abs(n)+1);const g=PU({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let y=+i;const w=y%1e3;return y-=w>=0?w:1e3+w,(g-y)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let eae={};function FVe(t,e={}){const i=JSON.stringify([t,e]);let r=eae[i];return r||(r=new Intl.ListFormat(t,e),eae[i]=r),r}let T9={};function E9(t,e={}){const i=JSON.stringify([t,e]);let r=T9[i];return r||(r=new Intl.DateTimeFormat(t,e),T9[i]=r),r}let C9={};function kVe(t,e={}){const i=JSON.stringify([t,e]);let r=C9[i];return r||(r=new Intl.NumberFormat(t,e),C9[i]=r),r}let M9={};function UVe(t,e={}){const{base:i,...r}=e,n=JSON.stringify([t,r]);let s=M9[n];return s||(s=new Intl.RelativeTimeFormat(t,e),M9[n]=s),s}let oO=null;function zVe(){return oO||(oO=new Intl.DateTimeFormat().resolvedOptions().locale,oO)}let tae={};function VVe(t){let e=tae[t];if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,tae[t]=e}return e}function BVe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,n;try{r=E9(t).resolvedOptions(),n=t}catch{const l=t.substring(0,i);r=E9(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=r;return[n,s,o]}}function jVe(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function GVe(t){const e=[];for(let i=1;i<=12;i++){const r=ai.utc(2009,i,1);e.push(t(r))}return e}function HVe(t){const e=[];for(let i=1;i<=7;i++){const r=ai.utc(2016,11,13+i);e.push(t(r))}return e}function jP(t,e,i,r){const n=t.listingMode();return n==="error"?null:n==="en"?i(e):r(e)}function qVe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class WVe{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:n,floor:s,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=kVe(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):wQ(e,3);return fo(i,this.padTo)}}}class ZVe{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Gu.create(a).valid?(n=a,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=E9(i,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class YVe{constructor(e,i,r){this.opts={style:"long",...r},!i&&Kwe()&&(this.rtf=UVe(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):_Be(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const XVe={firstDay:1,minimalDays:4,weekend:[6,7]};class pn{static fromOpts(e){return pn.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,n,s=!1){const o=e||Fs.defaultLocale,a=o||(s?"en-US":zVe()),l=i||Fs.defaultNumberingSystem,c=r||Fs.defaultOutputCalendar,h=$9(n)||Fs.defaultWeekSettings;return new pn(a,l,c,h,o)}static resetCache(){oO=null,T9={},C9={},M9={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:n}={}){return pn.create(e,i,r,n)}constructor(e,i,r,n,s){const[o,a,l]=BVe(e);this.locale=o,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.weekSettings=n,this.intl=jVe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=qVe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:pn.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,$9(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return jP(this,e,nbe,()=>{const r=i?{month:e,day:"numeric"}:{month:e},n=i?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=GVe(s=>this.extract(s,r,"month"))),this.monthsCache[n][e]})}weekdays(e,i=!1){return jP(this,e,abe,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=i?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=HVe(s=>this.extract(s,r,"weekday"))),this.weekdaysCache[n][e]})}meridiems(){return jP(this,void 0,()=>lbe,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ai.utc(2016,11,13,9),ai.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return jP(this,e,cbe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[ai.utc(-40,1,1),ai.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const n=this.dtFormatter(e,i),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new WVe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new ZVe(e,this.intl,i)}relFormatter(e={}){return new YVe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return FVe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:ebe()?VVe(this.locale):XVe}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let D6=null;class Ba extends zC{static get utcInstance(){return D6===null&&(D6=new Ba(0)),D6}static instance(e){return e===0?Ba.utcInstance:new Ba(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Ba(LU(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${zA(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${zA(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return zA(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class JVe extends zC{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function k_(t,e){if(Ci(t)||t===null)return e;if(t instanceof zC)return t;if(rBe(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?RU.instance:i==="utc"||i==="gmt"?Ba.utcInstance:Ba.parseSpecifier(i)||Gu.create(t)}else return cv(t)?Ba.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new JVe(t)}const gQ={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},iae={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},QVe=gQ.hanidec.replace(/[\[|\]]/g,"").split("");function KVe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(gQ.hanidec)!==-1)e+=QVe.indexOf(t[i]);else for(const n in iae){const[s,o]=iae[n];r>=s&&r<=o&&(e+=r-s)}}return parseInt(e,10)}else return e}let cT={};function eBe(){cT={}}function Dd({numberingSystem:t},e=""){const i=t||"latn";return cT[i]||(cT[i]={}),cT[i][e]||(cT[i][e]=new RegExp(`${gQ[i]}${e}`)),cT[i][e]}let rae=()=>Date.now(),nae="system",sae=null,oae=null,aae=null,lae=60,cae,uae=null;class Fs{static get now(){return rae}static set now(e){rae=e}static set defaultZone(e){nae=e}static get defaultZone(){return k_(nae,RU.instance)}static get defaultLocale(){return sae}static set defaultLocale(e){sae=e}static get defaultNumberingSystem(){return oae}static set defaultNumberingSystem(e){oae=e}static get defaultOutputCalendar(){return aae}static set defaultOutputCalendar(e){aae=e}static get defaultWeekSettings(){return uae}static set defaultWeekSettings(e){uae=$9(e)}static get twoDigitCutoffYear(){return lae}static set twoDigitCutoffYear(e){lae=e%100}static get throwOnInvalid(){return cae}static set throwOnInvalid(e){cae=e}static resetCaches(){pn.resetCache(),Gu.resetCache(),ai.resetCache(),eBe()}}class Pp{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Wwe=[0,31,59,90,120,151,181,212,243,273,304,334],Zwe=[0,31,60,91,121,152,182,213,244,274,305,335];function Qh(t,e){return new Pp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function yQ(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const n=r.getUTCDay();return n===0?7:n}function Ywe(t,e,i){return i+(B3(t)?Zwe:Wwe)[e-1]}function Xwe(t,e){const i=B3(t)?Zwe:Wwe,r=i.findIndex(s=>s<e),n=e-i[r];return{month:r+1,day:n}}function _Q(t,e){return(t-e+7)%7+1}function h5(t,e=4,i=1){const{year:r,month:n,day:s}=t,o=Ywe(r,n,s),a=_Q(yQ(r,n,s),i);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=r-1,l=UR(c,e,i)):l>UR(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:a,...DU(t)}}function hae(t,e=4,i=1){const{weekYear:r,weekNumber:n,weekday:s}=t,o=_Q(yQ(r,1,e),i),a=K2(r);let l=n*7+s-o-7+e,c;l<1?(c=r-1,l+=K2(c)):l>a?(c=r+1,l-=K2(r)):c=r;const{month:h,day:p}=Xwe(c,l);return{year:c,month:h,day:p,...DU(t)}}function N6(t){const{year:e,month:i,day:r}=t,n=Ywe(e,i,r);return{year:e,ordinal:n,...DU(t)}}function dae(t){const{year:e,ordinal:i}=t,{month:r,day:n}=Xwe(e,i);return{year:e,month:r,day:n,...DU(t)}}function pae(t,e){if(!Ci(t.localWeekday)||!Ci(t.localWeekNumber)||!Ci(t.localWeekYear)){if(!Ci(t.weekday)||!Ci(t.weekNumber)||!Ci(t.weekYear))throw new g2("Cannot mix locale-based week fields with ISO-based week fields");return Ci(t.localWeekday)||(t.weekday=t.localWeekday),Ci(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),Ci(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function tBe(t,e=4,i=1){const r=IU(t.weekYear),n=Kh(t.weekNumber,1,UR(t.weekYear,e,i)),s=Kh(t.weekday,1,7);return r?n?s?!1:Qh("weekday",t.weekday):Qh("week",t.weekNumber):Qh("weekYear",t.weekYear)}function iBe(t){const e=IU(t.year),i=Kh(t.ordinal,1,K2(t.year));return e?i?!1:Qh("ordinal",t.ordinal):Qh("year",t.year)}function Jwe(t){const e=IU(t.year),i=Kh(t.month,1,12),r=Kh(t.day,1,d5(t.year,t.month));return e?i?r?!1:Qh("day",t.day):Qh("month",t.month):Qh("year",t.year)}function Qwe(t){const{hour:e,minute:i,second:r,millisecond:n}=t,s=Kh(e,0,23)||e===24&&i===0&&r===0&&n===0,o=Kh(i,0,59),a=Kh(r,0,59),l=Kh(n,0,999);return s?o?a?l?!1:Qh("millisecond",n):Qh("second",r):Qh("minute",i):Qh("hour",e)}function Ci(t){return typeof t>"u"}function cv(t){return typeof t=="number"}function IU(t){return typeof t=="number"&&t%1===0}function rBe(t){return typeof t=="string"}function nBe(t){return Object.prototype.toString.call(t)==="[object Date]"}function Kwe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function ebe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function sBe(t){return Array.isArray(t)?t:[t]}function fae(t,e,i){if(t.length!==0)return t.reduce((r,n)=>{const s=[e(n),n];return r&&i(r[0],s[0])===r[0]?r:s},null)[1]}function oBe(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function GE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function $9(t){if(t==null)return null;if(typeof t!="object")throw new fl("Week settings must be an object");if(!Kh(t.firstDay,1,7)||!Kh(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!Kh(e,1,7)))throw new fl("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function Kh(t,e,i){return IU(t)&&t>=e&&t<=i}function aBe(t,e){return t-e*Math.floor(t/e)}function fo(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function A_(t){if(!(Ci(t)||t===null||t===""))return parseInt(t,10)}function _1(t){if(!(Ci(t)||t===null||t===""))return parseFloat(t)}function vQ(t){if(!(Ci(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function wQ(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function B3(t){return t%4===0&&(t%100!==0||t%400===0)}function K2(t){return B3(t)?366:365}function d5(t,e){const i=aBe(e-1,12)+1,r=t+(e-i)/12;return i===2?B3(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function PU(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function mae(t,e,i){return-_Q(yQ(t,1,e),i)+e-1}function UR(t,e=4,i=1){const r=mae(t,e,i),n=mae(t+1,e,i);return(K2(t)-r+n)/7}function O9(t){return t>99?t:t>Fs.twoDigitCutoffYear?1900+t:2e3+t}function tbe(t,e,i,r=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(i,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function LU(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,n=i<0||Object.is(i,-0)?-r:r;return i*60+n}function ibe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new fl(`Invalid unit value ${t}`);return e}function p5(t,e){const i={};for(const r in t)if(GE(t,r)){const n=t[r];if(n==null)continue;i[e(r)]=ibe(n)}return i}function zA(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${fo(i,2)}:${fo(r,2)}`;case"narrow":return`${n}${i}${r>0?`:${r}`:""}`;case"techie":return`${n}${fo(i,2)}${fo(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function DU(t){return oBe(t,["hour","minute","second","millisecond"])}const lBe=["January","February","March","April","May","June","July","August","September","October","November","December"],rbe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],cBe=["J","F","M","A","M","J","J","A","S","O","N","D"];function nbe(t){switch(t){case"narrow":return[...cBe];case"short":return[...rbe];case"long":return[...lBe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const sbe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],obe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],uBe=["M","T","W","T","F","S","S"];function abe(t){switch(t){case"narrow":return[...uBe];case"short":return[...obe];case"long":return[...sbe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const lbe=["AM","PM"],hBe=["Before Christ","Anno Domini"],dBe=["BC","AD"],pBe=["B","A"];function cbe(t){switch(t){case"narrow":return[...pBe];case"short":return[...dBe];case"long":return[...hBe];default:return null}}function fBe(t){return lbe[t.hour<12?0:1]}function mBe(t,e){return abe(e)[t.weekday-1]}function gBe(t,e){return nbe(e)[t.month-1]}function yBe(t,e){return cbe(e)[t.year<0?0:1]}function _Be(t,e,i="always",r=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&s){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${n[t][0]}`;case-1:return p?"yesterday":`last ${n[t][0]}`;case 0:return p?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],h=r?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function gae(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const vBe={D:u5,DD:$we,DDD:Owe,DDDD:Awe,t:Rwe,tt:Iwe,ttt:Pwe,tttt:Lwe,T:Dwe,TT:Nwe,TTT:Fwe,TTTT:kwe,f:Uwe,ff:Vwe,fff:jwe,ffff:Hwe,F:zwe,FF:Bwe,FFF:Gwe,FFFF:qwe};class vl{static create(e,i={}){return new vl(e,i)}static parseFormat(e){let i=null,r="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),i=null,r="",n=!n):n||a===i?r+=a:(r.length>0&&s.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),s}static macroTokenToFormatOpts(e){return vBe[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return fo(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(y,w)=>this.loc.extract(e,y,w),o=y=>e.isOffsetFixed&&e.offset===0&&y.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,y.format):"",a=()=>r?fBe(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(y,w)=>r?gBe(e,y):s(w?{month:y}:{month:y,day:"numeric"},"month"),c=(y,w)=>r?mBe(e,y):s(w?{weekday:y}:{weekday:y,month:"long",day:"numeric"},"weekday"),h=y=>{const w=vl.macroTokenToFormatOpts(y);return w?this.formatWithSystemDefault(e,w):y},p=y=>r?yBe(e,y):s({era:y},"era"),g=y=>{switch(y){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(y)}};return gae(vl.parseFormat(i),g)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},s=vl.parseFormat(i),o=s.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return gae(s,n(a))}}const ube=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function VC(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function BC(...t){return e=>t.reduce(([i,r,n],s)=>{const[o,a,l]=s(e,n);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function jC(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const n=i.exec(t);if(n)return r(n)}return[null,null]}function hbe(...t){return(e,i)=>{const r={};let n;for(n=0;n<t.length;n++)r[t[n]]=A_(e[i+n]);return[r,null,i+n]}}const dbe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,wBe=`(?:${dbe.source}?(?:\\[(${ube.source})\\])?)?`,bQ=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,pbe=RegExp(`${bQ.source}${wBe}`),xQ=RegExp(`(?:T${pbe.source})?`),bBe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,xBe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,SBe=/(\d{4})-?(\d{3})/,TBe=hbe("weekYear","weekNumber","weekDay"),EBe=hbe("year","ordinal"),CBe=/(\d{4})-(\d\d)-(\d\d)/,fbe=RegExp(`${bQ.source} ?(?:${dbe.source}|(${ube.source}))?`),MBe=RegExp(`(?: ${fbe.source})?`);function eE(t,e,i){const r=t[e];return Ci(r)?i:A_(r)}function $Be(t,e){return[{year:eE(t,e),month:eE(t,e+1,1),day:eE(t,e+2,1)},null,e+3]}function GC(t,e){return[{hours:eE(t,e,0),minutes:eE(t,e+1,0),seconds:eE(t,e+2,0),milliseconds:vQ(t[e+3])},null,e+4]}function j3(t,e){const i=!t[e]&&!t[e+1],r=LU(t[e+1],t[e+2]),n=i?null:Ba.instance(r);return[{},n,e+3]}function G3(t,e){const i=t[e]?Gu.create(t[e]):null;return[{},i,e+1]}const OBe=RegExp(`^T?${bQ.source}$`),ABe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function RBe(t){const[e,i,r,n,s,o,a,l,c]=t,h=e[0]==="-",p=l&&l[0]==="-",g=(y,w=!1)=>y!==void 0&&(w||y&&h)?-y:y;return[{years:g(_1(i)),months:g(_1(r)),weeks:g(_1(n)),days:g(_1(s)),hours:g(_1(o)),minutes:g(_1(a)),seconds:g(_1(l),l==="-0"),milliseconds:g(vQ(c),p)}]}const IBe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function SQ(t,e,i,r,n,s,o){const a={year:e.length===2?O9(A_(e)):A_(e),month:rbe.indexOf(i)+1,day:A_(r),hour:A_(n),minute:A_(s)};return o&&(a.second=A_(o)),t&&(a.weekday=t.length>3?sbe.indexOf(t)+1:obe.indexOf(t)+1),a}const PBe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function LBe(t){const[,e,i,r,n,s,o,a,l,c,h,p]=t,g=SQ(e,n,r,i,s,o,a);let y;return l?y=IBe[l]:c?y=0:y=LU(h,p),[g,new Ba(y)]}function DBe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const NBe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,FBe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,kBe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function yae(t){const[,e,i,r,n,s,o,a]=t;return[SQ(e,n,r,i,s,o,a),Ba.utcInstance]}function UBe(t){const[,e,i,r,n,s,o,a]=t;return[SQ(e,a,i,r,n,s,o),Ba.utcInstance]}const zBe=VC(bBe,xQ),VBe=VC(xBe,xQ),BBe=VC(SBe,xQ),jBe=VC(pbe),mbe=BC($Be,GC,j3,G3),GBe=BC(TBe,GC,j3,G3),HBe=BC(EBe,GC,j3,G3),qBe=BC(GC,j3,G3);function WBe(t){return jC(t,[zBe,mbe],[VBe,GBe],[BBe,HBe],[jBe,qBe])}function ZBe(t){return jC(DBe(t),[PBe,LBe])}function YBe(t){return jC(t,[NBe,yae],[FBe,yae],[kBe,UBe])}function XBe(t){return jC(t,[ABe,RBe])}const JBe=BC(GC);function QBe(t){return jC(t,[OBe,JBe])}const KBe=VC(CBe,MBe),e6e=VC(fbe),t6e=BC(GC,j3,G3);function i6e(t){return jC(t,[KBe,mbe],[e6e,t6e])}const _ae="Invalid Duration",gbe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},r6e={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...gbe},sh=146097/400,cS=146097/4800,n6e={years:{quarters:4,months:12,weeks:sh/7,days:sh,hours:sh*24,minutes:sh*24*60,seconds:sh*24*60*60,milliseconds:sh*24*60*60*1e3},quarters:{months:3,weeks:sh/28,days:sh/4,hours:sh*24/4,minutes:sh*24*60/4,seconds:sh*24*60*60/4,milliseconds:sh*24*60*60*1e3/4},months:{weeks:cS/7,days:cS,hours:cS*24,minutes:cS*24*60,seconds:cS*24*60*60,milliseconds:cS*24*60*60*1e3},...gbe},sb=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],s6e=sb.slice(0).reverse();function S0(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new zr(r)}function ybe(t,e){let i=e.milliseconds??0;for(const r of s6e.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function vae(t,e){const i=ybe(t,e)<0?-1:1;sb.reduceRight((r,n)=>{if(Ci(e[n]))return r;if(r){const s=e[r]*i,o=t[n][r],a=Math.floor(s/o);e[n]+=a*i,e[r]-=a*o*i}return n},null),sb.reduce((r,n)=>{if(Ci(e[n]))return r;if(r){const s=e[r]%1;e[r]-=s,e[n]+=s*t[r][n]}return n},null)}function o6e(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class zr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?n6e:r6e;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||pn.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return zr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new fl(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new zr({values:p5(e,zr.normalizeUnit),loc:pn.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(cv(e))return zr.fromMillis(e);if(zr.isDuration(e))return e;if(typeof e=="object")return zr.fromObject(e);throw new fl(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=XBe(e);return r?zr.fromObject(r,i):zr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=QBe(e);return r?zr.fromObject(r,i):zr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new fl("need to specify a reason the Duration is invalid");const r=e instanceof Pp?e:new Pp(e,i);if(Fs.throwOnInvalid)throw new AVe(r);return new zr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new Mwe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?vl.create(this.loc,r).formatDurationFromString(this,e):_ae}toHuman(e={}){if(!this.isValid)return _ae;const i=sb.map(r=>{const n=this.values[r];return Ci(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(n)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=wQ(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},ai.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?ybe(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=zr.fromDurationLike(e),r={};for(const n of sb)(GE(i.values,n)||GE(this.values,n))&&(r[n]=i.get(n)+this.get(n));return S0(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=zr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=ibe(e(this.values[r],r));return S0(this,{values:i},!0)}get(e){return this[zr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...p5(e,zr.normalizeUnit)};return S0(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:n,conversionAccuracy:r};return S0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return vae(this.matrix,e),S0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=o6e(this.normalize().shiftToAll().toObject());return S0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>zr.normalizeUnit(o));const i={},r={},n=this.toObject();let s;for(const o of sb)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;cv(n[o])&&(a+=n[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else cv(n[o])&&(r[o]=n[o]);for(const o in r)r[o]!==0&&(i[s]+=o===s?r[o]:r[o]/this.matrix[s][o]);return vae(this.matrix,i),S0(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return S0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,n){return r===void 0||r===0?n===void 0||n===0:r===n}for(const r of sb)if(!i(this.values[r],e.values[r]))return!1;return!0}}const uS="Invalid Interval";function a6e(t,e){return!t||!t.isValid?Ls.invalid("missing or invalid start"):!e||!e.isValid?Ls.invalid("missing or invalid end"):e<t?Ls.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Ls{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new fl("need to specify a reason the Interval is invalid");const r=e instanceof Pp?e:new Pp(e,i);if(Fs.throwOnInvalid)throw new OVe(r);return new Ls({invalid:r})}static fromDateTimes(e,i){const r=QM(e),n=QM(i),s=a6e(r,n);return s??new Ls({start:r,end:n})}static after(e,i){const r=zr.fromDurationLike(i),n=QM(e);return Ls.fromDateTimes(n,n.plus(r))}static before(e,i){const r=zr.fromDurationLike(i),n=QM(e);return Ls.fromDateTimes(n.minus(r),n)}static fromISO(e,i){const[r,n]=(e||"").split("/",2);if(r&&n){let s,o;try{s=ai.fromISO(r,i),o=s.isValid}catch{o=!1}let a,l;try{a=ai.fromISO(n,i),l=a.isValid}catch{l=!1}if(o&&l)return Ls.fromDateTimes(s,a);if(o){const c=zr.fromISO(n,i);if(c.isValid)return Ls.after(s,c)}else if(l){const c=zr.fromISO(r,i);if(c.isValid)return Ls.before(a,c)}}return Ls.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let n;return i!=null&&i.useLocaleWeeks?n=this.end.reconfigure({locale:r.locale}):n=this.end,n=n.startOf(e,i),Math.floor(n.diff(r,e).get(e))+(n.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?Ls.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(QM).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),r=[];let{s:n}=this,s=0;for(;n<this.e;){const o=i[s]||this.e,a=+o>+this.e?this.e:o;r.push(Ls.fromDateTimes(n,a)),n=a,s+=1}return r}splitBy(e){const i=zr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,n=1,s;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(Ls.fromDateTimes(r,s)),r=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:Ls.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Ls.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&n.push(Ls.fromDateTimes(i,l.time)),i=null);return Ls.merge(n)}difference(...e){return Ls.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:uS}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=u5,i={}){return this.isValid?vl.create(this.s.loc.clone(i),e).formatInterval(this):uS}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:uS}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:uS}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:uS}toFormat(e,{separator:i="  "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:uS}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):zr.invalid(this.invalidReason)}mapEndpoints(e){return Ls.fromDateTimes(e(this.s),e(this.e))}}class GP{static hasDST(e=Fs.defaultZone){const i=ai.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Gu.isValidZone(e)}static normalizeZone(e){return k_(e,Fs.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||pn.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||pn.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||pn.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||pn.create(i,r,s)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||pn.create(i,r,s)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||pn.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||pn.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return pn.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return pn.create(i,null,"gregory").eras(e)}static features(){return{relative:Kwe(),localeWeek:ebe()}}}function wae(t,e){const i=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(zr.fromMillis(r).as("days"))}function l6e(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=wae(l,c);return(h-h%7)/7}],["days",wae]],n={},s=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n),t>e&&(a=t,n[l]--,t=s.plus(n))):t=a);return[t,n,a,o]}function c6e(t,e,i,r){let[n,s,o,a]=l6e(t,e,i);const l=e-n,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const h=zr.fromObject(s,r);return c.length>0?zr.fromMillis(l,r).shiftTo(...c).plus(h):h}const u6e="missing Intl.DateTimeFormat.formatToParts support";function tn(t,e=i=>i){return{regex:t,deser:([i])=>e(KVe(i))}}const h6e="",_be=`[ ${h6e}]`,vbe=new RegExp(_be,"g");function d6e(t){return t.replace(/\./g,"\\.?").replace(vbe,_be)}function bae(t){return t.replace(/\./g,"").replace(vbe," ").toLowerCase()}function Nd(t,e){return t===null?null:{regex:RegExp(t.map(d6e).join("|")),deser:([i])=>t.findIndex(r=>bae(i)===bae(r))+e}}function xae(t,e){return{regex:t,deser:([,i,r])=>LU(i,r),groups:e}}function HP(t){return{regex:t,deser:([e])=>e}}function p6e(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function f6e(t,e){const i=Dd(e),r=Dd(e,"{2}"),n=Dd(e,"{3}"),s=Dd(e,"{4}"),o=Dd(e,"{6}"),a=Dd(e,"{1,2}"),l=Dd(e,"{1,3}"),c=Dd(e,"{1,6}"),h=Dd(e,"{1,9}"),p=Dd(e,"{2,4}"),g=Dd(e,"{4,6}"),y=x=>({regex:RegExp(p6e(x.val)),deser:([T])=>T,literal:!0}),b=(x=>{if(t.literal)return y(x);switch(x.val){case"G":return Nd(e.eras("short"),0);case"GG":return Nd(e.eras("long"),0);case"y":return tn(c);case"yy":return tn(p,O9);case"yyyy":return tn(s);case"yyyyy":return tn(g);case"yyyyyy":return tn(o);case"M":return tn(a);case"MM":return tn(r);case"MMM":return Nd(e.months("short",!0),1);case"MMMM":return Nd(e.months("long",!0),1);case"L":return tn(a);case"LL":return tn(r);case"LLL":return Nd(e.months("short",!1),1);case"LLLL":return Nd(e.months("long",!1),1);case"d":return tn(a);case"dd":return tn(r);case"o":return tn(l);case"ooo":return tn(n);case"HH":return tn(r);case"H":return tn(a);case"hh":return tn(r);case"h":return tn(a);case"mm":return tn(r);case"m":return tn(a);case"q":return tn(a);case"qq":return tn(r);case"s":return tn(a);case"ss":return tn(r);case"S":return tn(l);case"SSS":return tn(n);case"u":return HP(h);case"uu":return HP(a);case"uuu":return tn(i);case"a":return Nd(e.meridiems(),0);case"kkkk":return tn(s);case"kk":return tn(p,O9);case"W":return tn(a);case"WW":return tn(r);case"E":case"c":return tn(i);case"EEE":return Nd(e.weekdays("short",!1),1);case"EEEE":return Nd(e.weekdays("long",!1),1);case"ccc":return Nd(e.weekdays("short",!0),1);case"cccc":return Nd(e.weekdays("long",!0),1);case"Z":case"ZZ":return xae(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return xae(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return HP(/[a-z_+-/]{1,256}?/i);case" ":return HP(/[^\S\n\r]/);default:return y(x)}})(t)||{invalidReason:u6e};return b.token=t,b}const m6e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function g6e(t,e,i){const{type:r,value:n}=t;if(r==="literal"){const l=/^\s+$/.test(n);return{literal:!l,val:l?" ":n}}const s=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=m6e[o];if(typeof a=="object"&&(a=a[s]),a)return{literal:!1,val:a}}function y6e(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function _6e(t,e,i){const r=t.match(e);if(r){const n={};let s=1;for(const o in i)if(GE(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(r.slice(s,s+l))),s+=l}return[r,n]}else return[r,{}]}function v6e(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Ci(t.z)||(i=Gu.create(t.z)),Ci(t.Z)||(i||(i=new Ba(t.Z)),r=t.Z),Ci(t.q)||(t.M=(t.q-1)*3+1),Ci(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Ci(t.u)||(t.S=vQ(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),i,r]}let F6=null;function w6e(){return F6||(F6=ai.fromMillis(1555555555555)),F6}function b6e(t,e){if(t.literal)return t;const i=vl.macroTokenToFormatOpts(t.val),r=Sbe(i,e);return r==null||r.includes(void 0)?t:r}function wbe(t,e){return Array.prototype.concat(...t.map(i=>b6e(i,e)))}class bbe{constructor(e,i){if(this.locale=e,this.format=i,this.tokens=wbe(vl.parseFormat(i),e),this.units=this.tokens.map(r=>f6e(r,e)),this.disqualifyingUnit=this.units.find(r=>r.invalidReason),!this.disqualifyingUnit){const[r,n]=y6e(this.units);this.regex=RegExp(r,"i"),this.handlers=n}}explainFromTokens(e){if(this.isValid){const[i,r]=_6e(e,this.regex,this.handlers),[n,s,o]=r?v6e(r):[null,null,void 0];if(GE(r,"a")&&GE(r,"H"))throw new g2("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:i,matches:r,result:n,zone:s,specificOffset:o}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function xbe(t,e,i){return new bbe(t,i).explainFromTokens(e)}function x6e(t,e,i){const{result:r,zone:n,specificOffset:s,invalidReason:o}=xbe(t,e,i);return[r,n,s,o]}function Sbe(t,e){if(!t)return null;const r=vl.create(e,t).dtFormatter(w6e()),n=r.formatToParts(),s=r.resolvedOptions();return n.map(o=>g6e(o,t,s))}const k6="Invalid DateTime",Sae=864e13;function aO(t){return new Pp("unsupported zone",`the zone "${t.name}" is not supported`)}function U6(t){return t.weekData===null&&(t.weekData=h5(t.c)),t.weekData}function z6(t){return t.localWeekData===null&&(t.localWeekData=h5(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function v1(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new ai({...i,...e,old:i})}function Tbe(t,e,i){let r=t-e*60*1e3;const n=i.offset(r);if(e===n)return[r,e];r-=(n-e)*60*1e3;const s=i.offset(r);return n===s?[r,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function qP(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function CN(t,e,i){return Tbe(PU(t),e,i)}function Tae(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:r,month:n,day:Math.min(t.c.day,d5(r,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=zr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=PU(s);let[l,c]=Tbe(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function hS(t,e,i,r,n,s){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=ai.fromObject(t,{...i,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return ai.invalid(new Pp("unparsable",`the input "${n}" can't be parsed as ${r}`))}function WP(t,e,i=!0){return t.isValid?vl.create(pn.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function V6(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=fo(t.c.year,i?6:4),e?(r+="-",r+=fo(t.c.month),r+="-",r+=fo(t.c.day)):(r+=fo(t.c.month),r+=fo(t.c.day)),r}function Eae(t,e,i,r,n,s){let o=fo(t.c.hour);return e?(o+=":",o+=fo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=fo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=fo(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=fo(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=fo(Math.trunc(-t.o/60)),o+=":",o+=fo(Math.trunc(-t.o%60))):(o+="+",o+=fo(Math.trunc(t.o/60)),o+=":",o+=fo(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const Ebe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},S6e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},T6e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Cbe=["year","month","day","hour","minute","second","millisecond"],E6e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],C6e=["year","ordinal","hour","minute","second","millisecond"];function M6e(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new Mwe(t);return e}function Cae(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return M6e(t)}}function $6e(t){return $N[t]||(MN===void 0&&(MN=Fs.now()),$N[t]=t.offset(MN)),$N[t]}function Mae(t,e){const i=k_(e.zone,Fs.defaultZone);if(!i.isValid)return ai.invalid(aO(i));const r=pn.fromObject(e);let n,s;if(Ci(t.year))n=Fs.now();else{for(const l of Cbe)Ci(t[l])&&(t[l]=Ebe[l]);const o=Jwe(t)||Qwe(t);if(o)return ai.invalid(o);const a=$6e(i);[n,s]=CN(t,a,i)}return new ai({ts:n,zone:i,loc:r,o:s})}function $ae(t,e,i){const r=Ci(i.round)?!0:i.round,n=(o,a)=>(o=wQ(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),s=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return n(s(i.unit),i.unit);for(const o of i.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,i.units[i.units.length-1])}function Oae(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}let MN,$N={};class ai{constructor(e){const i=e.zone||Fs.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Pp("invalid input"):null)||(i.isValid?null:aO(i));this.ts=Ci(e.ts)?Fs.now():e.ts;let n=null,s=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[n,s]=[e.old.c,e.old.o];else{const a=cv(e.o)&&!e.old?e.o:i.offset(this.ts);n=qP(this.ts,a),r=Number.isNaN(n.year)?new Pp("invalid input"):null,n=r?null:n,s=r?null:a}this._zone=i,this.loc=e.loc||pn.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new ai({})}static local(){const[e,i]=Oae(arguments),[r,n,s,o,a,l,c]=i;return Mae({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=Oae(arguments),[r,n,s,o,a,l,c]=i;return e.zone=Ba.utcInstance,Mae({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=nBe(e)?e.valueOf():NaN;if(Number.isNaN(r))return ai.invalid("invalid input");const n=k_(i.zone,Fs.defaultZone);return n.isValid?new ai({ts:r,zone:n,loc:pn.fromObject(i)}):ai.invalid(aO(n))}static fromMillis(e,i={}){if(cv(e))return e<-Sae||e>Sae?ai.invalid("Timestamp out of range"):new ai({ts:e,zone:k_(i.zone,Fs.defaultZone),loc:pn.fromObject(i)});throw new fl(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(cv(e))return new ai({ts:e*1e3,zone:k_(i.zone,Fs.defaultZone),loc:pn.fromObject(i)});throw new fl("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=k_(i.zone,Fs.defaultZone);if(!r.isValid)return ai.invalid(aO(r));const n=pn.fromObject(i),s=p5(e,Cae),{minDaysInFirstWeek:o,startOfWeek:a}=pae(s,n),l=Fs.now(),c=Ci(i.specificOffset)?r.offset(l):i.specificOffset,h=!Ci(s.ordinal),p=!Ci(s.year),g=!Ci(s.month)||!Ci(s.day),y=p||g,w=s.weekYear||s.weekNumber;if((y||h)&&w)throw new g2("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(g&&h)throw new g2("Can't mix ordinal dates with month/day");const b=w||s.weekday&&!y;let x,T,M=qP(l,c);b?(x=E6e,T=S6e,M=h5(M,o,a)):h?(x=C6e,T=T6e,M=N6(M)):(x=Cbe,T=Ebe);let $=!1;for(const B of x){const W=s[B];Ci(W)?$?s[B]=T[B]:s[B]=M[B]:$=!0}const R=b?tBe(s,o,a):h?iBe(s):Jwe(s),I=R||Qwe(s);if(I)return ai.invalid(I);const P=b?hae(s,o,a):h?dae(s):s,[N,V]=CN(P,c,r),U=new ai({ts:N,zone:r,o:V,loc:n});return s.weekday&&y&&e.weekday!==U.weekday?ai.invalid("mismatched weekday",`you can't specify both a weekday of ${s.weekday} and a date of ${U.toISO()}`):U.isValid?U:ai.invalid(U.invalid)}static fromISO(e,i={}){const[r,n]=WBe(e);return hS(r,n,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,n]=ZBe(e);return hS(r,n,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,n]=YBe(e);return hS(r,n,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Ci(e)||Ci(i))throw new fl("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=r,o=pn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,h]=x6e(o,e,i);return h?ai.invalid(h):hS(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return ai.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,n]=i6e(e);return hS(r,n,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new fl("need to specify a reason the DateTime is invalid");const r=e instanceof Pp?e:new Pp(e,i);if(Fs.throwOnInvalid)throw new $Ve(r);return new ai({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=Sbe(e,pn.fromObject(i));return r?r.map(n=>n?n.val:null).join(""):null}static expandFormat(e,i={}){return wbe(vl.parseFormat(e),pn.fromObject(i)).map(n=>n.val).join("")}static resetCache(){MN=void 0,$N={}}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?U6(this).weekYear:NaN}get weekNumber(){return this.isValid?U6(this).weekNumber:NaN}get weekday(){return this.isValid?U6(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?z6(this).weekday:NaN}get localWeekNumber(){return this.isValid?z6(this).weekNumber:NaN}get localWeekYear(){return this.isValid?z6(this).weekYear:NaN}get ordinal(){return this.isValid?N6(this.c).ordinal:NaN}get monthShort(){return this.isValid?GP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?GP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?GP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?GP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=PU(this.c),n=this.zone.offset(r-e),s=this.zone.offset(r+e),o=this.zone.offset(r-n*i),a=this.zone.offset(r-s*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,h=qP(l,o),p=qP(c,a);return h.hour===p.hour&&h.minute===p.minute&&h.second===p.second&&h.millisecond===p.millisecond?[v1(this,{ts:l}),v1(this,{ts:c})]:[this]}get isInLeapYear(){return B3(this.year)}get daysInMonth(){return d5(this.year,this.month)}get daysInYear(){return this.isValid?K2(this.year):NaN}get weeksInWeekYear(){return this.isValid?UR(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?UR(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:n}=vl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:n}}toUTC(e=0,i={}){return this.setZone(Ba.instance(e),i)}toLocal(){return this.setZone(Fs.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=k_(e,Fs.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(i||r){const s=e.offset(this.ts),o=this.toObject();[n]=CN(o,s,e)}return v1(this,{ts:n,zone:e})}else return ai.invalid(aO(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const n=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return v1(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=p5(e,Cae),{minDaysInFirstWeek:r,startOfWeek:n}=pae(i,this.loc),s=!Ci(i.weekYear)||!Ci(i.weekNumber)||!Ci(i.weekday),o=!Ci(i.ordinal),a=!Ci(i.year),l=!Ci(i.month)||!Ci(i.day),c=a||l,h=i.weekYear||i.weekNumber;if((c||o)&&h)throw new g2("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new g2("Can't mix ordinal dates with month/day");let p;s?p=hae({...h5(this.c,r,n),...i},r,n):Ci(i.ordinal)?(p={...this.toObject(),...i},Ci(i.day)&&(p.day=Math.min(d5(p.year,p.month),p.day))):p=dae({...N6(this.c),...i});const[g,y]=CN(p,this.o,this.zone);return v1(this,{ts:g,o:y})}plus(e){if(!this.isValid)return this;const i=zr.fromDurationLike(e);return v1(this,Tae(this,i))}minus(e){if(!this.isValid)return this;const i=zr.fromDurationLike(e).negate();return v1(this,Tae(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},n=zr.normalizeUnit(e);switch(n){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(n==="weeks")if(i){const s=this.loc.getStartOfWeek(),{weekday:o}=this;o<s&&(r.weekNumber=this.weekNumber-1),r.weekday=s}else r.weekday=1;if(n==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?vl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):k6}toLocaleString(e=u5,i={}){return this.isValid?vl.create(this.loc.clone(i),e).formatDateTime(this):k6}toLocaleParts(e={}){return this.isValid?vl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=V6(this,o);return a+="T",a+=Eae(this,o,i,r,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?V6(this,e==="extended"):null}toISOWeekDate(){return WP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+Eae(this,o==="extended",i,e,r,s):null}toRFC2822(){return WP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return WP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?V6(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let n="HH:mm:ss.SSS";return(i||e)&&(r&&(n+=" "),i?n+="z":e&&(n+="ZZ")),WP(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():k6}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return zr.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...r},s=sBe(i).map(zr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=c6e(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(ai.now(),e,i)}until(e){return this.isValid?Ls.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const n=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(i,r)<=n&&n<=s.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||ai.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),$ae(i,this.plus(r),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?$ae(e.base||ai.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(ai.isDateTime))throw new fl("min requires all arguments be DateTimes");return fae(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(ai.isDateTime))throw new fl("max requires all arguments be DateTimes");return fae(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:n=null,numberingSystem:s=null}=r,o=pn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return xbe(o,e,i)}static fromStringExplain(e,i,r={}){return ai.fromFormatExplain(e,i,r)}static buildFormatParser(e,i={}){const{locale:r=null,numberingSystem:n=null}=i,s=pn.fromOpts({locale:r,numberingSystem:n,defaultToEN:!0});return new bbe(s,e)}static fromFormatParser(e,i,r={}){if(Ci(e)||Ci(i))throw new fl("fromFormatParser requires an input string and a format parser");const{locale:n=null,numberingSystem:s=null}=r,o=pn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});if(!o.equals(i.locale))throw new fl(`fromFormatParser called with a locale of ${o}, but the format parser was created for ${i.locale}`);const{result:a,zone:l,specificOffset:c,invalidReason:h}=i.explainFromTokens(e);return h?ai.invalid(h):hS(a,l,r,`format ${i.format}`,e,c)}static get DATE_SHORT(){return u5}static get DATE_MED(){return $we}static get DATE_MED_WITH_WEEKDAY(){return RVe}static get DATE_FULL(){return Owe}static get DATE_HUGE(){return Awe}static get TIME_SIMPLE(){return Rwe}static get TIME_WITH_SECONDS(){return Iwe}static get TIME_WITH_SHORT_OFFSET(){return Pwe}static get TIME_WITH_LONG_OFFSET(){return Lwe}static get TIME_24_SIMPLE(){return Dwe}static get TIME_24_WITH_SECONDS(){return Nwe}static get TIME_24_WITH_SHORT_OFFSET(){return Fwe}static get TIME_24_WITH_LONG_OFFSET(){return kwe}static get DATETIME_SHORT(){return Uwe}static get DATETIME_SHORT_WITH_SECONDS(){return zwe}static get DATETIME_MED(){return Vwe}static get DATETIME_MED_WITH_SECONDS(){return Bwe}static get DATETIME_MED_WITH_WEEKDAY(){return IVe}static get DATETIME_FULL(){return jwe}static get DATETIME_FULL_WITH_SECONDS(){return Gwe}static get DATETIME_HUGE(){return Hwe}static get DATETIME_HUGE_WITH_SECONDS(){return qwe}}function QM(t){if(ai.isDateTime(t))return t;if(t&&t.valueOf&&cv(t.valueOf()))return ai.fromJSDate(t);if(t&&typeof t=="object")return ai.fromObject(t);throw new fl(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const Sm="system",Wb="unknown",Tv="UTC",O6e=Intl.DateTimeFormat().resolvedOptions().timeZone,A6e="shortOffset";function R6e(t){return"timeZoneIANA"in t}function I6e(t){return t.startsWith("UTC")}function f5(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?ON(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?P6e(i):null}}}}}function ON(t,e=Sm){return t?R6e(t)?t.timeZoneIANA:L6e(t,e):e}function P6e(t){return{timeZoneIANA:t}}function L6e(t,e=Sm){if(!t||!Koe.has(t.timeZone))return e;const i=Koe.get(t.timeZone);return I6e(t.timeZone)||t.respectsDaylightSaving?i:D6e(i)}function D6e(t){const e=ai.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${Ba.instance(-i).formatOffset(0,"narrow")}`}function Z3t(t,e,i,r,n){if(e&&n==="date")return{timeZone:Tv,timeZoneName:void 0};const s=r.timeStyle||r.hour,o=i===Wb;return{timeZone:o?n==="timestamp-offset"?void 0:t??Tv:i,timeZoneName:o&&s?A6e:void 0}}function N6e(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));return t===Sm||t===Wb||e.has(t.toLowerCase())||i.has(t.toLowerCase())}const F6e={year:void 0,month:void 0,day:void 0,weekday:void 0},k6e={hour:void 0,minute:void 0,second:void 0},Mbe={timeZone:Tv},mf={year:"numeric",month:"numeric",day:"numeric"},KM={year:"numeric",month:"long",day:"numeric"},e$={year:"numeric",month:"short",day:"numeric"},t$={year:"numeric",month:"long",weekday:"long",day:"numeric"},R_={hour:"numeric",minute:"numeric"},Y1={...R_,second:"numeric"},$be={hourCycle:"h23"},i$={...R_,...$be},r$={...Y1,...$be},Obe={"short-date":mf,"short-date-short-time":{...mf,...R_},"short-date-short-time-24":{...mf,...i$},"short-date-long-time":{...mf,...Y1},"short-date-long-time-24":{...mf,...r$},"short-date-le":mf,"short-date-le-short-time":{...mf,...R_},"short-date-le-short-time-24":{...mf,...i$},"short-date-le-long-time":{...mf,...Y1},"short-date-le-long-time-24":{...mf,...r$},"long-month-day-year":KM,"long-month-day-year-short-time":{...KM,...R_},"long-month-day-year-short-time-24":{...KM,...i$},"long-month-day-year-long-time":{...KM,...Y1},"long-month-day-year-long-time-24":{...KM,...r$},"day-short-month-year":e$,"day-short-month-year-short-time":{...e$,...R_},"day-short-month-year-short-time-24":{...e$,...i$},"day-short-month-year-long-time":{...e$,...Y1},"day-short-month-year-long-time-24":{...e$,...r$},"long-date":t$,"long-date-short-time":{...t$,...R_},"long-date-short-time-24":{...t$,...i$},"long-date-long-time":{...t$,...Y1},"long-date-long-time-24":{...t$,...r$},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":R_,"long-time":Y1},U6e=Za()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Abe={ar:"ar-u-nu-latn-ca-gregory"};let A9=new WeakMap;const NU=Obe["short-date-short-time"];function z6e(t){let e=A9.get(t);if(!e){const i=Vc(),r=Abe[i]||i,n=TQ(t.timeZone??Sm),s={...t,timeZone:n};e=new Intl.DateTimeFormat(r,s),A9.set(t,e)}return e}function V6e(t){return Obe[t]}function FU(t,e=NU){return z6e(e).format(t)}function Y3t(t,e=NU){return FU(new Date(t),{...e,...Mbe,...k6e})}function X3t(t,e=NU){return FU(new Date(`1970-01-01T${t}Z`),{...e,...Mbe,...F6e})}function J3t(t,e=NU){if(e.timeZone)return FU(new Date(t),e);const i=ai.fromISO(t,{setZone:!0}),r=Vc(),n=Abe[r]??r,s=i.offset===0?Tv:e.timeZone,o={...e,timeZone:s};return i.toLocaleString(o,{locale:n})}function TQ(t){switch(t){case Sm:return O6e;case Wb:return Tv;default:return t}}GJ(()=>{A9=new WeakMap});const Aae={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function B6(t,e,i,r=Sm){const n=new Gu(TQ(r)),s=ai.fromJSDate(t,{zone:n}),o=i==="decades"||i==="centuries"?"year":Ibe(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),s.plus({[o]:e}).toJSDate()}function Q3t(t,e,i="milliseconds"){const r=t.getTime(),n=Rbe(e,i,"milliseconds");return new Date(r+n)}function Rae(t,e,i=Sm){const r=new Gu(TQ(i)),n=ai.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=n.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const s=Ibe(e);return n.startOf(s).toJSDate()}function Rbe(t,e,i){return t===0?0:t*Aae[e]/Aae[i]}function K3t(t,e){return t&&e?t.intersection(e):t||e}function Ibe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var mh;let xu=mh=class extends we{static get allTime(){return Iae}static get empty(){return B6e}static fromArray(t){return new mh({start:t[0]!=null?new Date(t[0]):t[0],end:t[1]!=null?new Date(t[1]):t[1]})}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(mh.allTime)}get isEmpty(){return this.equals(mh.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new mh({end:this.end,start:this.start})}equals(t){var s,o,a,l;if(!t)return!1;const e=((s=this.start)==null?void 0:s.getTime())??this.start,i=((o=this.end)==null?void 0:o.getTime())??this.end,r=((a=t.start)==null?void 0:a.getTime())??t.start,n=((l=t.end)==null?void 0:l.getTime())??t.end;return e===r&&i===n}expandTo(t,e=Sm){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=Rae(i,t,e));let r=this.end;if(r){const n=Rae(r,t,e);r=r.getTime()===n.getTime()?n:B6(n,1,t,e)}return new mh({start:i,end:r})}intersection(t){var a,l,c,h;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return mh.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,i=((l=this.end)==null?void 0:l.getTime())??1/0,r=((c=t.start)==null?void 0:c.getTime())??-1/0,n=((h=t.end)==null?void 0:h.getTime())??1/0;let s,o;return r>=e&&r<=i?s=r:e>=r&&e<=n&&(s=e),i>=r&&i<=n?o=i:n>=e&&n<=i&&(o=n),s==null||o==null||isNaN(s)||isNaN(o)?mh.empty:new mh({start:s===-1/0?null:new Date(s),end:o===1/0?null:new Date(o)})}offset(t,e,i=Sm){if(this.isEmpty||this.isAllTime)return this.clone();const r=new mh,{start:n,end:s}=this;return n!=null&&(r.start=B6(n,t,e,i)),s!=null&&(r.end=B6(s,t,e,i)),r}toArray(){var t,e;return this.isEmpty?[void 0,void 0]:[((t=this.start)==null?void 0:t.getTime())??null,((e=this.end)==null?void 0:e.getTime())??null]}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Iae.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new mh({start:e,end:i})}};u([f({type:Date,json:{write:{allowNull:!0}}})],xu.prototype,"end",void 0),u([Pe("end")],xu.prototype,"readEnd",null),u([ke("end")],xu.prototype,"writeEnd",null),u([f({readOnly:!0,json:{read:!1}})],xu.prototype,"isAllTime",null),u([f({readOnly:!0,json:{read:!1}})],xu.prototype,"isEmpty",null),u([f({type:Date,json:{write:{allowNull:!0}}})],xu.prototype,"start",void 0),u([Pe("start")],xu.prototype,"readStart",null),u([ke("start")],xu.prototype,"writeStart",null),xu=mh=u([L("esri.time.TimeExtent")],xu);const ja=xu,Iae=new xu,B6e=new xu({start:void 0,end:void 0});let j6e=0,As=class extends ns.EventedMixin(mQ(wm)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new pr(-180,-90,180,90,nt.WGS84),this.id=Date.now().toString(16)+"-layer-"+j6e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=nt.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await fe(async()=>{const{fromUrl:r}=await import("./arcgisLayers-DfMfKCRU.js");return{fromUrl:r}},__vite__mapDeps([14,12,13]))).fromUrl(i)}static fromPortalItem(e){return MVe(e)}initialize(){this.when().catch(e=>{Bn(e)||de.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get effectiveVisible(){let e=this.visible;const i=this.parent;return e&&i&&"effectiveVisible"in i&&e&&(e=i.effectiveVisible),e}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return _o(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Br(e,{query:{f:"json"},responseType:"json"})).data;throw new Y("layer:no-attribution-data","Layer does not have attribution data")}};u([f({type:String})],As.prototype,"attributionDataUrl",void 0),u([f({readOnly:!0})],As.prototype,"effectiveVisible",null),u([f({type:pr})],As.prototype,"fullExtent",void 0),u([f({readOnly:!0})],As.prototype,"hasAttributionData",null),u([f({type:String,clonable:!1})],As.prototype,"id",void 0),u([f({type:Boolean,nonNullable:!0})],As.prototype,"legendEnabled",void 0),u([f({type:["show","hide","hide-children"]})],As.prototype,"listMode",void 0),u([f({type:Number,range:{min:0,max:1},nonNullable:!0})],As.prototype,"opacity",void 0),u([f({clonable:!1})],As.prototype,"parent",void 0),u([f({readOnly:!0})],As.prototype,"parsedUrl",null),u([f({type:Boolean,readOnly:!0})],As.prototype,"persistenceEnabled",void 0),u([f({type:Boolean})],As.prototype,"popupEnabled",void 0),u([f({type:Boolean})],As.prototype,"attributionVisible",void 0),u([f({type:nt})],As.prototype,"spatialReference",void 0),u([f({type:String})],As.prototype,"title",void 0),u([f({readOnly:!0,json:{read:!1}})],As.prototype,"type",void 0),u([f()],As.prototype,"url",void 0),u([f({type:ja})],As.prototype,"visibilityTimeExtent",void 0),u([f({type:Boolean,nonNullable:!0})],As.prototype,"visible",void 0),As=u([L("esri.layers.Layer")],As);const kU=As;function R9(t,e,i){let r,n;if(t)for(let s=0,o=t.length;s<o;s++){if(r=t.at(s),(r==null?void 0:r[e])===i)return r;if((r==null?void 0:r.type)==="group"&&(n=R9(r.layers,e,i),n))return n}}const G6e=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new ot;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||de.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void de.getLogger(this).error("#add()","Cannot add layer to itself.");r(o.item)}),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",vm(i,this._get("layers")))}add(i,r){const n=this.layers;if(r=n.getNextIndex(r),i instanceof kU){const s=i;s.parent===this?this.reorder(s,r):n.add(s,r)}else qu(i)?i.then(s=>{this.destroyed||this.add(s,r)}):de.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const n=this.layers;let s=n.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(i){return R9(this.layers,"id",i)}findLayerByUid(i){return R9(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([f()],e.prototype,"layers",null),e=u([L("esri.support.LayersMixin")],e),e};function I9(t,e,i){if(t)for(let r=0,n=t.length;r<n;r++){const s=t.at(r);if(s[e]===i)return s;if((s==null?void 0:s.type)==="group"){const o=I9(s.tables,e,i);if(o)return o}}}const H6e=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new ot,this.addHandles([this.tables.on("after-add",r=>{const n=r.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&de.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",vm(i,this._get("tables")))}findTableById(i){return I9(this.tables,"id",i)}findTableByUid(i){return I9(this.tables,"uid",i)}};return u([f()],e.prototype,"tables",null),e=u([L("esri.support.TablesMixin")],e),e};let Zd=class extends H6e(G6e(ns.EventedMixin(Ne))){constructor(e){super(e),this.allLayers=new NR({getCollections:()=>{var i,r,n;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=qze(this),this.basemap=null,this.editableLayers=new NR({getCollections:()=>[this.allLayers],itemFilterFunction:ZUe}),this.ground=new DR,this._basemapCache=Uze()}destroy(){zze(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Ye(this.basemap),Ye(this.ground),this._set("ground",null)}castBasemap(e){return oQ(e,this._basemapCache)}castGround(e){return Wze(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};u([f({readOnly:!0,dependsOn:[]})],Zd.prototype,"allLayers",void 0),u([f({readOnly:!0})],Zd.prototype,"allTables",void 0),u([f({type:J2,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Zd.prototype,"basemap",void 0),u([$i("basemap")],Zd.prototype,"castBasemap",null),u([f({readOnly:!0})],Zd.prototype,"editableLayers",void 0),u([f({type:DR,nonNullable:!0})],Zd.prototype,"ground",void 0),u([$i("ground")],Zd.prototype,"castGround",null),u([f()],Zd.prototype,"undoRedo",void 0),Zd=u([L("esri.Map")],Zd);const Pbe=Zd,Or=t=>{let e=class extends t{clone(){var l;const i=bl(this);nU(i,"unable to clone instance of non-accessor class");const r=i.metadata,n=i.store,s={},o=new Map;for(const c in r){const h=r[c],p=n==null?void 0:n.originOf(c),g=h.clonable;if(h.readOnly||g===!1||p!==Ni.USER&&p!==Ni.DEFAULTS&&p!==Ni.WEB_MAP&&p!==Ni.WEB_SCENE)continue;const y=this[c];let w=null;w=typeof g=="function"?g(y):g==="reference"?y:SH(y),y!=null&&w==null||(p===Ni.DEFAULTS?o.set(c,w):s[c]=w)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=bl(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Ni.DEFAULTS)}return a}};return e=u([L("esri.core.Clonable")],e),e};let Zb=class extends Or(Ne){};Zb=u([L("esri.core.Clonable")],Zb);let X1=class extends Zb{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};u([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],X1.prototype,"row",void 0),u([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],X1.prototype,"column",void 0),u([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],X1.prototype,"rows",void 0),u([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],X1.prototype,"columns",void 0),X1=u([L("esri.CameraLayout")],X1);const Lbe=X1;let Ev=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return Pae(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return Oe(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+P9(this.range,e-i,r)}minimalMonotonic(e,i,r){return Pae(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,n=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(n)?r:n}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function Pae(t,e,i,r,n=0,s=!1){return(r-=n)<e?r+=P9(t,e-r):r>i&&(r-=P9(t,r-i)),s&&r===i&&(r=e),r+n}function P9(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const q6e=new Ev(0,2*Math.PI),Cv=new Ev(-Math.PI,Math.PI),UU=new Ev(0,360);let If=class extends Or(we){constructor(...e){super(...e),this.position=new wt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new Lbe}normalizeCtorArgs(e,i,r,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return i!=null&&(s.heading=i),r!=null&&(s.tilt=r),n!=null&&(s.fov=n),s}return e}writePosition(e,i,r,n){const s=e.clone();s.x=Hl(e.x||0),s.y=Hl(e.y||0),s.z=e.hasZ?Hl(e.z||0):e.z,i[r]=s.write({},n)}readPosition(e,i){const r=new wt;return r.read(e,i),r.x=Hl(r.x||0),r.y=Hl(r.y||0),r.z=r.hasZ?Hl(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};u([f({type:wt,json:{write:{isRequired:!0}}})],If.prototype,"position",void 0),u([ke("position")],If.prototype,"writePosition",null),u([Pe("position")],If.prototype,"readPosition",null),u([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),$i(t=>UU.normalize(Hl(t)))],If.prototype,"heading",void 0),u([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),$i(t=>Oe(Hl(t),-180,180))],If.prototype,"tilt",void 0),u([f({type:Number,nonNullable:!0,json:{default:55,write:!0}}),$i(t=>Oe(Hl(t,55),1,170))],If.prototype,"fov",void 0),u([f({type:Lbe,nonNullable:!0,json:{read:!1,write:!1}})],If.prototype,"layout",void 0),If=u([L("esri.Camera")],If);const Hc=If;var L9;let J0=L9=class extends we{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new L9({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};u([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:j6}}}}})],J0.prototype,"rotation",void 0),u([$i("rotation")],J0.prototype,"castRotation",null),u([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:j6}}}}})],J0.prototype,"scale",void 0),u([f({types:UC,json:{read:Sv,write:!0,origins:{"web-scene":{read:Sv,write:{overridePolicy:j6}}}}})],J0.prototype,"targetGeometry",void 0),u([f({type:Hc,json:{write:!0}})],J0.prototype,"camera",void 0),J0=L9=u([L("esri.Viewpoint")],J0);const ef=J0;function j6(){return{enabled:!this.camera}}let W6e=class Dbe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(CH),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new Dbe,r=this._originStores[Ni.DEFAULTS];r&&r.forEach((n,s)=>{i.set(s,te(n),Ni.DEFAULTS)});for(let n=Ni.SERVICE;n<CH;n++){const s=this._originStores[n];s&&s.forEach((o,a)=>{e&&e.has(a)||i.set(a,te(o),n)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Ni.USER){let n=this._originStores[r];if(n||(n=new Map,this._originStores[r]=n),n.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const s=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),s!==i}return!1}delete(e,i=Ni.USER){const r=this._originStores[i];if(!r)return;const n=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let s=i-1;s>=0;s--){const o=this._originStores[s];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],n=r==null?void 0:r.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,i),s!==n}originOf(e){return this._propertyOriginMap.get(e)||Ni.DEFAULTS}forEach(e){this._values.forEach(e)}};const Nbe=t=>{let e=class extends t{constructor(...i){super(...i);const r=bl(this),n=r.store,s=new W6e;r.store=s,dve(r,n,s)}read(i,r){fve(this,i,r)}getAtOrigin(i,r){const n=G6(this),s=W_(r);if(typeof i=="string")return n.get(i,s);const o={};return i.forEach(a=>{o[a]=n.get(a,s)}),o}originOf(i){return N4(this.originIdOf(i))}originIdOf(i){return G6(this).originOf(i)}revert(i,r){const n=G6(this),s=W_(r),o=bl(this);let a;a=typeof i=="string"?i==="*"?n.keys(s):[i]:i,a.forEach(l=>{o.invalidate(l),n.revert(l,s),o.commit(l)})}};return e=u([L("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function G6(t){return bl(t).store}let Lae=class extends Nbe(Ne){};Lae=u([L("esri.core.ReadOnlyMultiOriginJSONSupport")],Lae);const Z6e=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return H6(this).delete(i,W_(r))}write(i,r){return yve(this,i=i||{},r),i}setAtOrigin(i,r,n){bl(this).setAtOrigin(i,r,W_(n))}removeOrigin(i){const r=H6(this),n=W_(i),s=r.keys(n);for(const o of s)r.originOf(o)===n&&r.set(o,r.get(o,n),Ni.USER)}updateOrigin(i,r){const n=H6(this),s=W_(r),o=Vp(this,i);for(let a=s+1;a<CH;++a)n.delete(i,a);n.set(i,o,s)}toJSON(i){return this.write({},i)}};return e=u([L("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function H6(t){return bl(t).store}const EQ=t=>{let e=class extends Z6e(Nbe(t)){constructor(...i){super(...i)}};return e=u([L("esri.core.MultiOriginJSONSupport")],e),e};let D9=class extends EQ(Ne){};D9=u([L("esri.core.MultiOriginJSONSupport")],D9);function Y6e(t){return t&&"getAtOrigin"in t&&"originOf"in t}function Dae(t){t!=null&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{Y6e(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}var lO;const m5=Za()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Fbe=m5.jsonValues.slice();wR(Fbe,"orthometric");const VA=Za()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Yd=lO=class extends we{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return m5.write(t,e,i)}readHeightModel(t,e,i){return m5.read(t)||(i!=null&&i.messages&&i.messages.push(X6e(t,{context:i})),null)}readHeightUnit(t,e,i){return VA.read(t)||(i!=null&&i.messages&&i.messages.push(Nae(t,{context:i})),null)}readHeightUnitService(t,e,i){return s1e(t)||VA.read(t)||(i!=null&&i.messages&&i.messages.push(Nae(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new lO({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=o1e(e);return new lO({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new lO;return e.read(t,{origin:"web-scene"}),e}};function Nae(t,e){return new Yp("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function X6e(t,e){return new Yp("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([f({type:m5.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Fbe,default:"ellipsoidal"}}}})],Yd.prototype,"heightModel",void 0),u([ke("web-scene","heightModel")],Yd.prototype,"writeHeightModel",null),u([Pe(["web-scene","service"],"heightModel")],Yd.prototype,"readHeightModel",null),u([f({type:VA.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:VA.jsonValues,write:VA.write}}}})],Yd.prototype,"heightUnit",void 0),u([Pe("web-scene","heightUnit")],Yd.prototype,"readHeightUnit",null),u([Pe("service","heightUnit")],Yd.prototype,"readHeightUnitService",null),u([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Yd.prototype,"vertCRS",void 0),u([Pe("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Yd.prototype,"readVertCRS",null),Yd=lO=u([L("esri.geometry.HeightModelInfo")],Yd);const Gv=Yd,lIt=Math.PI/180,cIt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,T0=Ii.radius,Fd=Ii.eccentricitySquared,J6e={a1:T0*Fd,a2:T0*Fd*T0*Fd,a3:T0*Fd*Fd/2,a4:T0*Fd*T0*Fd*2.5,a5:T0*Fd+T0*Fd*Fd/2,a6:1-Fd},uIt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Ii.radius,f:Ii.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:vy.radius,f:vy.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Bp.radius,f:Bp.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Bp.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var ne;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=7]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=9]="GCSMOON2000",t[t.LON_LAT=10]="LON_LAT",t[t.PLATE_CARREE=11]="PLATE_CARREE"})(ne||(ne={}));const cO={[ne.WGS84]:{[ne.CGCS2000]:An,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:An,[ne.SPHERICAL_ECEF]:rE,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:xb,[ne.PLATE_CARREE]:Sb,[ne.WGS84]:An,[ne.WGS84_ECEF]:Eb},[ne.CGCS2000]:{[ne.CGCS2000]:An,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:An,[ne.SPHERICAL_ECEF]:rE,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:xb,[ne.PLATE_CARREE]:Sb,[ne.WGS84]:An,[ne.WGS84_ECEF]:Eb},[ne.GCSMARS2000]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:An,[ne.GCSMOON2000]:null,[ne.LON_LAT]:An,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:F9,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.GCSMOON2000]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:An,[ne.LON_LAT]:An,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:N9,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.WEB_MERCATOR]:{[ne.CGCS2000]:tE,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:tE,[ne.SPHERICAL_ECEF]:kbe,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:An,[ne.PLATE_CARREE]:zbe,[ne.WGS84]:tE,[ne.WGS84_ECEF]:Ube},[ne.WGS84_ECEF]:{[ne.CGCS2000]:Cb,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Cb,[ne.SPHERICAL_ECEF]:jbe,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:Gbe,[ne.PLATE_CARREE]:K6e,[ne.WGS84]:Cb,[ne.WGS84_ECEF]:An},[ne.SPHERICAL_ECEF]:{[ne.CGCS2000]:Tb,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Tb,[ne.SPHERICAL_ECEF]:An,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:Vbe,[ne.PLATE_CARREE]:eje,[ne.WGS84]:Tb,[ne.WGS84_ECEF]:Bbe},[ne.SPHERICAL_MARS_PCPF]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:U9,[ne.GCSMOON2000]:null,[ne.LON_LAT]:U9,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:An,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.SPHERICAL_MOON_PCPF]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:k9,[ne.LON_LAT]:k9,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:An,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.UNKNOWN]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:An,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.LON_LAT]:{[ne.CGCS2000]:An,[ne.GCSMARS2000]:An,[ne.GCSMOON2000]:An,[ne.LON_LAT]:An,[ne.SPHERICAL_ECEF]:rE,[ne.SPHERICAL_MARS_PCPF]:F9,[ne.SPHERICAL_MOON_PCPF]:N9,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:xb,[ne.PLATE_CARREE]:Sb,[ne.WGS84]:An,[ne.WGS84_ECEF]:Eb},[ne.PLATE_CARREE]:{[ne.CGCS2000]:iE,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:iE,[ne.SPHERICAL_ECEF]:tje,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:ije,[ne.PLATE_CARREE]:An,[ne.WGS84]:iE,[ne.WGS84_ECEF]:rje}};function Mv(t,e,i=$Q()){return t==null||e==null?null:sje(t,e,i).projector}function hIt(t,e){switch(Mv(t,e,zU)){case An:return"copy3";case rE:return"wgs84ToSphericalECEF";case xb:return"wgs84ToWebMercator";case Sb:return"wgs84ToPlateCarree";case Eb:return"wgs84ToWGS84ECEF";case tE:return"webMercatorToWGS84";case kbe:return"webMercatorToSphericalECEF";case Ube:return"webMercatorToWGS84ECEF";case zbe:return"webMercatorToPlateCarree";case Cb:return"wgs84ECEFToWGS84";case jbe:return"wgs84ECEFToSphericalECEF";case Gbe:return"wgs84ECEFToWebMercator";case Tb:return"sphericalECEFToWGS84";case Vbe:return"sphericalECEFToWebMercator";case U9:return"sphericalMarsPCPFToMars2000";case k9:return"sphericalMoonPCPFToMoon2000";case Bbe:return"sphericalECEFToWGS84ECEF";case F9:return"mars2000ToSphericalPCPF";case N9:return"moon2000ToSphericalPCPF";default:return null}}function g5(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Ql(t,1)),n5(t)?e.spatialReferenceId=ne.SPHERICAL_ECEF:wv(t)?e.spatialReferenceId=ne.WGS84:bm(t)?e.spatialReferenceId=ne.WEB_MERCATOR:$R(t)?e.spatialReferenceId=ne.PLATE_CARREE:t.wkt===t1e.wkt?e.spatialReferenceId=ne.WGS84_ECEF:t.wkid===Fc.CGCS2000?e.spatialReferenceId=ne.CGCS2000:t.wkt===gU.wkt?e.spatialReferenceId=ne.SPHERICAL_MARS_PCPF:t.wkt===yU.wkt?e.spatialReferenceId=ne.SPHERICAL_MOON_PCPF:LC(t)?e.spatialReferenceId=ne.GCSMARS2000:DC(t)?e.spatialReferenceId=ne.GCSMOON2000:e.spatialReferenceId=ne.UNKNOWN):ne.UNKNOWN}function An(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function tE(t,e,i,r){i[r]=qE*(t[e]/Mb),i[r+1]=qE*(Hbe-2*Math.atan(Math.exp(-t[e+1]/Mb))),i[r+2]=t[e+2]}function kbe(t,e,i,r){const n=t[e]/Mb,s=Hbe-2*Math.atan(Math.exp(-t[e+1]/Mb)),o=Mb+t[e+2],a=Math.cos(s)*o;i[r]=Math.cos(n)*a,i[r+1]=Math.sin(n)*a,i[r+2]=Math.sin(s)*o}function Ube(t,e,i,r){tE(t,e,i,r),Eb(i,r,i,r)}function Q6e(t,e,i,r,n){const s=.4999999*VU,o=Oe(HE*t[e+1],-s,s),a=Math.sin(o);i[r++]=HE*t[e]*n.radius,i[r++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function xb(t,e,i,r){Q6e(t,e,i,r,Ii)}function Sb(t,e,i,r){i[r]=t[e]*Fae,i[r+1]=t[e+1]*Fae,i[r+2]=t[e+2]}function iE(t,e,i,r){i[r]=t[e]*kae,i[r+1]=t[e+1]*kae,i[r+2]=t[e+2]}function zbe(t,e,i,r){tE(t,e,i,r),Sb(i,r,i,r)}function K6e(t,e,i,r){Cb(t,e,i,r),Sb(i,r,i,r)}function eje(t,e,i,r){Tb(t,e,i,r),Sb(i,r,i,r)}function tje(t,e,i,r){iE(t,e,i,r),rE(i,r,i,r)}function ije(t,e,i,r){iE(t,e,i,r),xb(i,r,i,r)}function rje(t,e,i,r){iE(t,e,i,r),Eb(i,r,i,r)}function CQ(t,e,i,r,n){const s=n+t[e+2],o=HE*t[e+1],a=HE*t[e],l=Math.cos(o)*s;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*s}function N9(t,e,i,r){CQ(t,e,i,r,vy.radius)}function F9(t,e,i,r){CQ(t,e,i,r,Bp.radius)}function rE(t,e,i,r){CQ(t,e,i,r,Ii.radius)}function MQ(t,e,i,r,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=cd(a/(l===0?1:l)),h=Math.atan2(o,s);i[r++]=qE*h,i[r++]=qE*c,i[r]=l-n}function k9(t,e,i,r){MQ(t,e,i,r,vy.radius)}function U9(t,e,i,r){MQ(t,e,i,r,Bp.radius)}function Tb(t,e,i,r){MQ(t,e,i,r,Ii.radius)}function Vbe(t,e,i,r){Tb(t,e,i,r),xb(i,r,i,r)}function Bbe(t,e,i,r){Tb(t,e,i,r),Eb(i,r,i,r)}function nje(t,e,i,r,n){const s=HE*t[e],o=HE*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(s),i[r++]=(h+a)*c*Math.sin(s),i[r++]=(h*(1-n.eccentricitySquared)+a)*l}function Eb(t,e,i,r){nje(t,e,i,r,Ii)}function Cb(t,e,i,r){const n=J6e,s=t[e],o=t[e+1],a=t[e+2];let l,c,h,p,g,y,w,b,x,T,M,$,R,I,P,N,V,U,B,W,j;l=Math.abs(a),c=s*s+o*o,h=Math.sqrt(c),p=c+a*a,g=Math.sqrt(p),W=Math.atan2(o,s),y=a*a/p,w=c/p,I=n.a2/g,P=n.a3-n.a4/g,w>.3?(b=l/g*(1+w*(n.a1+I+y*P)/g),B=Math.asin(b),T=b*b,x=Math.sqrt(1-T)):(x=h/g*(1-y*(n.a5-I-w*P)/g),B=Math.acos(x),T=1-x*x,b=Math.sqrt(T)),M=1-Ii.eccentricitySquared*T,$=Ii.radius/Math.sqrt(M),R=n.a6*$,I=h-$*x,P=l-R*b,V=x*I+b*P,N=x*P-b*I,U=N/(R/M+V),B+=U,j=V+N*U/2,a<0&&(B=-B),i[r++]=qE*W,i[r++]=qE*B,i[r]=j}function jbe(t,e,i,r){Cb(t,e,i,r),rE(i,r,i,r)}function Gbe(t,e,i,r){Cb(t,e,i,r),xb(i,r,i,r)}function sje(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=g5(t,i.source),n=g5(e,i.dest);return r===ne.UNKNOWN&&n===ne.UNKNOWN?xs(t,e)?i.projector=An:i.projector=null:i.projector=cO[r][n],i}function $Q(){return{source:{spatialReference:null,spatialReferenceId:ne.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ne.UNKNOWN,metersPerUnit:1},projector:An}}const oje={spatialReference:null,spatialReferenceId:ne.UNKNOWN},aje={spatialReference:null,spatialReferenceId:ne.UNKNOWN},zU=$Q(),HE=Wt(1),qE=vo(1),VU=Math.PI,Hbe=.5*VU,Mb=Ii.radius,Fae=Mb*VU/180,kae=180/(Mb*VU);function io(t,e,i,r,n,s,o=Math.floor(t.length/3)){const a=Mv(e,n,zU);if(a==null)return!1;if(a===An){if(t===r&&i===s)return!0;const c=i+3*o;for(let h=i,p=s;h<c;h++,p++)r[p]=t[h];return!0}const l=i+3*o;for(let c=i,h=s;c<l;c+=3,h+=3)a(t,c,r,h);return!0}const dIt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:io},Symbol.toStringTag,{value:"Module"}));function Uae(t,e,i,r,n,s){return ZP[0]=t,ZP[1]=e,ZP[2]=i,io(ZP,r,0,n,s,0)}const ZP=A();let YP=0,q6=class z9{static fromGE(e){const i=new z9;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=YP++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=YP++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=YP++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=YP++}getInverse(){const e=new z9;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},y5=class uO{static cacheKey(e,i){var r,n,s,o,a,l;return[((r=e.wkid)==null?void 0:r.toString())??"-1",((n=e.wkt)==null?void 0:n.toString())??"",((s=e.wkt2)==null?void 0:s.toString())??"",((o=i.wkid)==null?void 0:o.toString())??"-1",((a=i.wkt)==null?void 0:a.toString())??"",((l=i.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const i=new uO;let r="";for(const n of e.steps){const s=q6.fromGE(n);i.steps.push(s),r+=s.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const i of e.steps)i instanceof q6?this.steps.push(i):this.steps.push(new q6({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new uO;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[uO.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const s of this.steps)r+=s.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const n=this._cachedProjection[uO.cacheKey(e,i)];return n===void 0?null:n}};function qbe(t,e,i){if(e==null||i==null||i.vcsWkid||xs(e,i)||bv(e)||bv(i))return null;const r=AR(e)/AR(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>lje(n,r);case"polyline":case"esriGeometryPolyline":return n=>uje(n,r);case"polygon":case"esriGeometryPolygon":return n=>cje(n,r);case"multipoint":case"esriGeometryMultipoint":return n=>hje(n,r);case"extent":case"esriGeometryEnvelope":return n=>dje(n,r);default:return null}}function lje(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function cje(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function uje(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function hje(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function dje(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let jp=null,$v=null,BA=null,AN={};const OQ=new L3;function HC(){return!!jp&&Hve()}function Wbe(){return!!HC()||(qt(OQ),WE(),!1)}function Zw(t,e){return!t||!e||tf(t,e)||Wbe()}function Zbe(t,e){return!tf(t,e)&&!HC()}function WE(t){return BA==null&&(BA=Promise.all([qve(),fe(()=>import("./geometryEngineBase-yFIvKOkM.js"),__vite__mapDeps([15,3])).then(e=>e.g),fe(()=>import("./hydrated-DyMAxGe_.js"),[])])),BA.then(([,e,{hydratedAdapter:i}])=>{zt(t),$v=i,jp=e.default,jp._enableProjection(eke),OQ.notify()})}function Hv(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:V9($v,t,t[0].spatialReference,e,i,r):V9($v,[t],t.spatialReference,e,i,r)[0]}function V9(t,e,i,r,n=null,s=null){if(i==null||r==null)return e;if(tf(i,r,n))return e.map(o=>jA(o,i,r));if(n==null&&n5(i))return e.map(o=>jA(o,i,nt.WGS84)).map(o=>Ov(o,r));if(n==null&&n5(r))return e.map(o=>Ov(o,nt.WGS84)).map(o=>jA(o,nt.WGS84,r));if(n==null){const o=y5.cacheKey(i,r);AN[o]!==void 0?n=AN[o]:((n=Xbe(i,r,void 0))==null&&(n=new y5),AN[o]=n)}if(jp==null||t==null)throw new BU;return s!=null?jp._project(t,e,i,r,n,s):jp._project(t,e,i,r,n)}function pje(t,e){const i=Ybe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function Ybe(t,e){if(!HC()){for(const i of t)if(i!=null&&!xs(i.spatialReference,e)&&Rp(i.spatialReference)&&Rp(e)&&!tf(i.spatialReference,e))return qt(OQ),{pending:WE(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:xs(i.spatialReference,e)?i:Rp(i.spatialReference)&&Rp(e)?Ov(i,e):null)}}function Xbe(t,e,i=null){if(t==null||e==null)return null;if(jp==null||$v==null)throw new BU;const r=jp._getTransformation($v,t,e,i,i==null?void 0:i.spatialReference);return r!==null?y5.fromGE(r):null}function fje(t,e,i=null){if(jp==null||$v==null)throw new BU;const r=jp._getTransformationBySuitability($v,t,e,i,i==null?void 0:i.spatialReference);if(r!==null){const n=[];for(const s of r)n.push(y5.fromGE(s));return n}return[]}let BU=class extends Y{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function mje(){jp=null,$v=null,BA=null,AN={}}const gje={get loadPromise(){return BA}};function Ov(t,e){try{const i=Hv(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=qbe(i.type,t.spatialReference,e);return r!=null&&r(i),i}catch(i){if(!(i instanceof BU))throw i;return null}}async function Av(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await H3(r,e,null,i),Ov(t,e)}function tf(t,e,i){return!i&&(!!xs(t,e)||Rp(t)&&Rp(e)&&!!Mv(t,e,zU))}function yje(t,e){if(xs(t,e))return!0;if(!Rp(t)||!Rp(e))return!1;const i=wv(t)||bm(t)||r5(t),r=wv(e)||bm(e)||r5(e);return i&&r}async function H3(t,e,i,r){if(HC())return Jse(r);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(n&&s&&!tf(n,s,o))return WE(r)}else if(t&&e&&!tf(t,e,i))return WE(r);return Jse(r)}function jA(t,e,i){return t?"x"in t?Qbe(t,e,new wt,i,0):"xmin"in t?ixe(t,e,new pr,i,0):"rings"in t?txe(t,e,new Qp,i,0):"paths"in t?exe(t,e,new OU,i,0):"points"in t?Kbe(t,e,new kC,i,0):null:null}function Jbe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&Qbe(t,t.spatialReference,e,i,r)!=null}function Qbe(t,e,i,r,n){ml[0]=t.x,ml[1]=t.y;const s=t.z;return ml[2]=s!==void 0?s:n,io(ml,e,0,ml,r,0)?(i.x=ml[0],i.y=ml[1],i.spatialReference=r,s!==void 0||bv(r)?(i.z=ml[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function _je(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&Kbe(t,t.spatialReference,e,i,r)!=null}function Kbe(t,e,i,r,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,h=[];for(const g of s)h.push(g[0],g[1],o?g[2]:n);if(!io(h,e,0,h,r,0,c))return null;const p=o||bv(r);for(let g=0;g<c;++g){const y=3*g,w=h[y],b=h[y+1];p&&a?l.push([w,b,h[y+2],s[g][3]]):p?l.push([w,b,h[y+2]]):a?l.push([w,b,s[g][2]]):l.push([w,b])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function vje(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&exe(t,t.spatialReference,e,i,r)!=null}function exe(t,e,i,r,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];if(!rxe(s,o??!1,a??!1,e,l,r,n))return null;const c=o||bv(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function wje(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&txe(t,t.spatialReference,e,i,r)!=null}function txe(t,e,i,r,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];if(!rxe(s,o??!1,a??!1,e,l,r,n))return null;const c=o||bv(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function bje(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&ixe(t,t.spatialReference,e,i,r)!=null}function ixe(t,e,i,r,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t,p=c?t.zmin:n;if(!Uae(s,o,p,e,ml,r))return null;const g=c||bv(r);i.xmin=ml[0],i.ymin=ml[1],g&&(i.zmin=ml[2]);const y=c?t.zmax:n;return Uae(a,l,y,e,ml,r)?(i.xmax=ml[0],i.ymax=ml[1],g&&(i.zmax=ml[2]),h&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function rxe(t,e,i,r,n,s,o=0){const a=new Array;for(const h of t)for(const p of h)a.push(p[0],p[1],e?p[2]:o);if(!io(a,r,0,a,s,0))return!1;let l=0;n.length=0;const c=e||bv(s);for(const h of t){const p=new Array;for(const g of h)c&&i?p.push([a[l++],a[l++],a[l++],g[3]]):c?p.push([a[l++],a[l++],a[l++]]):i?(p.push([a[l++],a[l++],g[2]]),l++):(p.push([a[l++],a[l++]]),l++);n.push(p)}return!0}const ml=A(),fIt=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:tf,getTransformation:Xbe,getTransformations:fje,initializeProjection:H3,isEqualBaseGCS:yje,isLoaded:HC,isLoadedOrLoad:Wbe,isLoadedOrLoadFor:Zw,load:WE,project:Hv,projectExtent:bje,projectMany:V9,projectMultipoint:_je,projectOrLoad:pje,projectOrLoadMany:Ybe,projectPoint:Jbe,projectPolygon:wje,projectPolyline:vje,projectWithZConversion:Av,projectWithoutEngine:jA,requiresLoad:Zbe,test:gje,tryProjectWithZConversion:Ov,unload:mje},Symbol.toStringTag,{value:"Module"})),nxe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},sxe=Object.values(nxe),oxe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${sxe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),xje=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${sxe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Sje=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function mIt(t){return oxe.test(t)}function qC(t){if(t==null)return null;const e=_o(t),i=(e==null?void 0:e.path.match(oxe))||(e==null?void 0:e.path.match(xje));if(!i)return null;const[,r,n,s,o]=i,a=n.indexOf("/");return{title:AQ(a!==-1?n.slice(a+1):n),serverType:nxe[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function Tje(t){const e=_o(t).path.match(Sje);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function AQ(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function Eje(t,e){const i=[];if(t){const r=qC(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=AQ(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function axe(t){let e=sd(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")))}function Cje(t,e){return t&&Ove(Rve(t,e))}function Mje(t){let{url:e}=t;if(!e)return{url:e};e=Rve(e,t.logger);const i=_o(e),r=qC(i.path);let n;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(n=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const s=Tje(i.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:Ove(e),layerId:n}}function $je(t,e,i,r,n){Hb(e,r,"url",n),r.url&&t.layerId!=null&&(r.url=ld(r.url,i,t.layerId.toString()))}function gIt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return i&&(r||n||s)}function Oje(t,e){if(!t)return null;if(!B9(t))return new Y("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=Gv.deriveUnitFromSR(t,e).heightUnit;return i!==r?new Y("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function yIt(t,e,i){const r=lxe(t),n=e,s=Aje(r,n,i);if(r){const o=Gv.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new Y("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new Y("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!Rje(t)||s===Mc.Unsupported)return new Y("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(s){case Mc.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new Y("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case Mc.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new Y("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case Mc.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new Y("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}}return null}function Aje(t,e,i){if(!B9(t)||!B9(e))return Mc.Unsupported;if(t==null||e==null)return Mc.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Mc.Units;if(t.heightModel!==e.heightModel)return Mc.HeightModel;switch(t.heightModel){case"gravity-related-height":return Mc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Mc.Ok:Mc.CRS;default:return Mc.Unsupported}}var Mc;function B9(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function Rje(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!hxe(t)}function lxe(t){var r;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?qC(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&cxe(t)&&t.heightModelInfo?t.heightModelInfo:hxe(t)?Gv.deriveUnitFromSR(Pje,t.spatialReference):null}function cxe(t){return"heightModelInfo"in t}function uxe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function hxe(t){return uxe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):dxe(t)}function Ije(t){return t.layers!=null||dxe(t)||uxe(t)||cxe(t)}function dxe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"focusArea":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Mc||(Mc={}));const Pje=new Gv({heightModel:"gravity-related-height"});function _It(t,e){return{...pxe(t,e),readResourcePaths:[]}}function zae(t,e,i){const r=_o(t.itemUrl);return{...pxe(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function pxe(t,e){return{origin:e,url:_o(t.itemUrl),portal:t.portal||va.getDefault(),portalItem:t}}async function Lje(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return iO(t);const i=nt.WGS84;return await H3(e,i),Hv(t,i)}function Dje(t,e){if(!fxe(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function fxe(t,e){var i;return!!((i=t.typeKeywords)!=null&&i.includes(e))}function vIt(t){return fxe(t,j9.HOSTED_SERVICE)}function Nje(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function Vae(t,e,i){i?Dje(t,e):Nje(t,e)}async function wIt(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return Lje(i)}const j9={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer"};function Bae(t){var l;const{portal:e,isOrgItem:i,itemControl:r}=t,n=(l=e.user)==null?void 0:l.privileges;let s=!n||n.includes("features:user:edit"),o=!!i&&!!(n!=null&&n.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}let Q0=class extends we{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([f({type:String,json:{write:!0}})],Q0.prototype,"facilityIdField",void 0),u([f({type:String,json:{write:!0}})],Q0.prototype,"layerId",void 0),u([f({type:String,json:{write:!0}})],Q0.prototype,"nameField",void 0),u([f({type:String,json:{write:!0}})],Q0.prototype,"siteIdField",void 0),u([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Q0.prototype,"sublayerId",void 0),Q0=u([L("esri.layers.support.FacilityLayerInfo")],Q0);const Fje=Q0;let Xd=class extends we{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};u([f({type:String,json:{write:!0}})],Xd.prototype,"facilityIdField",void 0),u([f({type:String,json:{write:!0}})],Xd.prototype,"layerId",void 0),u([f({type:String,json:{write:!0}})],Xd.prototype,"levelIdField",void 0),u([f({type:String,json:{write:!0}})],Xd.prototype,"levelNumberField",void 0),u([f({type:String,json:{write:!0}})],Xd.prototype,"longNameField",void 0),u([f({type:String,json:{write:!0}})],Xd.prototype,"shortNameField",void 0),u([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Xd.prototype,"sublayerId",void 0),u([f({type:String,json:{write:!0}})],Xd.prototype,"verticalOrderField",void 0),Xd=u([L("esri.layers.support.LevelLayerInfo")],Xd);const kje=Xd;let J1=class extends we{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([f({type:String,json:{write:!0}})],J1.prototype,"layerId",void 0),u([f({type:String,json:{write:!0}})],J1.prototype,"nameField",void 0),u([f({type:String,json:{write:!0}})],J1.prototype,"siteIdField",void 0),u([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],J1.prototype,"sublayerId",void 0),J1=u([L("esri.layers.support.SiteLayerInfo")],J1);const Uje=J1;let uT=class extends we{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};u([f({type:kje,json:{write:!0}})],uT.prototype,"levelLayer",void 0),u([f({type:Fje,json:{write:!0}})],uT.prototype,"facilityLayer",void 0),u([f({type:Uje,json:{write:!0}})],uT.prototype,"siteLayer",void 0),uT=u([L("esri.support.MapFloorInfo")],uT);const zje=uT,Vje=Symbol("WebScene"),Bje="webscene:schema-validation";function jje(t){return new Y(Bje,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var ct;function G9(t){return t==="global"?ct.Global:ct.Local}function W6(t){return t===ct.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(ct||(ct={}));function zR(t,e){return t!=null&&(e==null||(e===ct.Local?!t.isGeographic||t.isWGS84||t.wkid===Fc.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Fc.CGCS2000||t.wkid===Fc.GCSMARS2000||t.wkid===Fc.GCSMARS2000_SPHERE||t.wkid===Fc.GCSMOON2000))}var $u;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})($u||($u={}));var H9;let Pf=H9=class extends we{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new H9(te({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};u([f({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],Pf.prototype,"enabled",void 0),u([f({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],Pf.prototype,"longNames",void 0),u([f({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],Pf.prototype,"minimized",void 0),u([f({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],Pf.prototype,"pinnedLevels",void 0),u([f({type:String,json:{read:{source:"site"},write:{target:"site"}}})],Pf.prototype,"site",void 0),u([f({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],Pf.prototype,"facility",void 0),u([f({type:String,json:{read:{source:"level"},write:{target:"level"}}})],Pf.prototype,"level",void 0),Pf=H9=u([L("esri.webdoc.widgets.FloorFilter")],Pf);const Gje=Pf;var q9;const XP=new sr({slider:"slider",picker:"picker"});let hT=q9=class extends we{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new q9({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};u([f({type:XP.apiValues,nonNullable:!0,json:{type:XP.jsonValues,default:null,read:{reader:XP.read},write:{isRequired:!0,writer:XP.write}}})],hT.prototype,"interactionMode",void 0),u([f({type:Wi,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],hT.prototype,"numStops",void 0),u([f({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],hT.prototype,"stopInterval",void 0),hT=q9=u([L("esri.webdoc.widgets.Range")],hT);const Hje=hT,RQ=Za()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let hO=class extends Or(we){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return Rbe(this.value,this.unit,"milliseconds")}};u([_t(RQ,{nonNullable:!0})],hO.prototype,"unit",void 0),u([f({type:Number,json:{write:!0},nonNullable:!0})],hO.prototype,"value",void 0),hO=u([L("esri.time.TimeInterval")],hO);const ZE=hO;var W9;let $o=W9=class extends we{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){return t?ja.fromArray(t):void 0}writeCurrentTimeExtent(t,e,i){t&&Uo(i,t.toArray(),e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,n=i.startTime!=null?new Date(i.startTime):null;return new ja({start:n,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,n=t.start;r&&(i.endTime=r!=null?r.getTime():null),n&&(i.startTime=n!=null?n.getTime():null)}readStopInterval(t,e,i){return t?ZE.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const n=t.toJSON(r);Uo("properties.timeStopInterval",{interval:n.value,units:n.unit},e)}readStops(t){return t!=null&&t.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t!=null&&t.length&&Uo(i,t.map(r=>r.getTime()),e)}clone(){return new W9(te({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};u([f({type:ja,json:{type:[[Wi,RC]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],$o.prototype,"currentTimeExtent",void 0),u([Pe("currentTimeExtent")],$o.prototype,"readCurrentTimeExtent",null),u([ke("currentTimeExtent")],$o.prototype,"writeCurrentTimeExtent",null),u([f({type:ja,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],$o.prototype,"fullTimeExtent",void 0),u([Pe("fullTimeExtent")],$o.prototype,"readFullTimeExtent",null),u([ke("fullTimeExtent")],$o.prototype,"writeFullTimeExtent",null),u([f({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],$o.prototype,"loop",void 0),u([f({type:Wi,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var r;const t=!!this.stopInterval,e=!!((r=this.stops)!=null&&r.length),i=!(t||e);return{enabled:i,isRequired:i}}}}})],$o.prototype,"numStops",void 0),u([f({type:[1,2],nonNullable:!0,json:{type:Wi,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],$o.prototype,"numThumbs",void 0),u([f({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],$o.prototype,"stopDelay",void 0),u([f({type:ZE,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:RQ.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){var i;const t=this.numStops!=null,e=!!((i=this.stops)!=null&&i.length);return{enabled:!e,isRequired:!(t||e)}}}}})],$o.prototype,"stopInterval",void 0),u([Pe("stopInterval")],$o.prototype,"readStopInterval",null),u([ke("stopInterval")],$o.prototype,"writeStopInterval",null),u([f({type:[Date],json:{type:[Wi],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],$o.prototype,"stops",void 0),u([Pe("stops")],$o.prototype,"readStops",null),u([ke("stops")],$o.prototype,"writeStops",null),$o=W9=u([L("esri.webdoc.widgets.TimeSlider")],$o);const qje=$o;var Z9;let dT=Z9=class extends we{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new Z9(te({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};u([f({type:Hje,json:{write:!0}})],dT.prototype,"range",void 0),u([f({type:qje,json:{write:!0}})],dT.prototype,"timeSlider",void 0),u([f({type:Gje,json:{write:!0}})],dT.prototype,"floorFilter",void 0),dT=Z9=u([L("esri.webdoc.Widgets")],dT);const Wje=dT,Zje="randomUUID"in crypto;function jU(){if(Zje)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function CIt(){return`{${jU().toUpperCase()}}`}function Yje(){return`{${jU()}}`}function Xje(t){const e=t.toUpperCase();return t[0]!=="{"?`{${e}}`:e}async function Jje(t,e={},i){await t.load(i);const r=ld(t.itemUrl,"resources"),{start:n=1,num:s=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:n,num:s,sortOrder:o,sortField:a,token:t.apiKey},signal:i==null?void 0:i.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:g})=>({created:new Date(h),size:p,resource:t.resourceFromPath(g)}))}}async function Qje(t,e,i,r){const n=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new Y(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[h,p]=mxe(o.path),g=`${h}/${l??""}/${c??""}`;n.has(g)||n.set(g,{prefix:h,compress:l,access:c,files:[]}),n.get(g).files.push({fileName:p,content:a})}await t.load(r);const s=ld(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of n.values())for(let p=0;p<c.length;p+=25){const g=c.slice(p,p+25),y=new FormData;o&&o!=="."&&y.append("resourcesPrefix",o),a&&y.append("compress","true"),l&&y.append("access",l);let w=0;for(const{fileName:b,content:x}of g)y.append("file"+ ++w,x,b);y.append("f","json"),await t.portal.request(s,{method:"post",body:y,signal:r==null?void 0:r.signal})}}async function Kje(t,e,i){if(!e.hasPath())throw new Y("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=ld(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i==null?void 0:i.signal}),e.portalItem=null}async function eGe(t,e){await t.load(e);const i=ld(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function mxe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function IQ(t){const[e,i]=tGe(t),[r,n]=mxe(e);return[r,n,i]}function tGe(t){const e=_5e(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function RN(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await Br(t.url,{responseType:"blob"})).data}function iGe(t,e){if(!t.hasPath())return null;const[i,,r]=IQ(t.path);return t.portalItem.resourceFromPath(ld(i,e+r))}function gxe(t,e){if(!t.hasPath())return null;const[i,,r]=IQ(t.path);return t.portalItem.resourceFromPath(ld(i,e+r))}const y2=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:Qje,contentToBlob:RN,fetchResources:Jje,getSiblingOfSameType:iGe,getSiblingOfSameTypeI:gxe,removeAllResources:eGe,removeResource:Kje,splitPrefixFileNameAndExtension:IQ},Symbol.toStringTag,{value:"Module"}));async function rGe(t,e,i){const r=await yxe(t,e,i);await _xe(r,e,i)}async function nGe(t,e,i,r,n){const s=await yxe(i,r,n);await t.update({data:e}),await _xe(s,r,n)}async function yxe(t,e,i){if(!(e!=null&&e.resources))return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const n=new Set(e.resources.toKeep.map(p=>p.resource.path)),s=new Set,o=[];n.forEach(p=>{r.delete(p),t.paths.push(p)});const a=[],l=[],c=[];for(const p of e.resources.toUpdate)if(r.delete(p.resource.path),n.has(p.resource.path)||s.has(p.resource.path)){const{resource:g,content:y,finish:w}=p,b=gxe(g,jU());t.paths.push(b.path),a.push({resource:b,content:await RN(y),compress:p.compress}),w&&c.push(()=>w(b))}else{t.paths.push(p.resource.path),l.push({resource:p.resource,content:await RN(p.content),compress:p.compress});const g=p.finish;g&&c.push(()=>g(p.resource)),s.add(p.resource.path)}for(const p of e.resources.toAdd)if(t.paths.push(p.resource.path),r.has(p.resource.path))r.delete(p.resource.path);else{a.push({resource:p.resource,content:await RN(p.content),compress:p.compress});const g=p.finish;g&&c.push(()=>g(p.resource))}if(a.length||l.length){const{addOrUpdateResources:p}=await fe(()=>Promise.resolve().then(()=>y2),void 0);await p(e.portalItem,a,"add",i),await p(e.portalItem,l,"update",i)}if(c.forEach(p=>p()),o.length===0)return r;const h=await MFe(o);if(zt(i),h.length>0)throw new Y("save:resources","Failed to save one or more resources",{errors:h});return r}async function _xe(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const n of t){const s=e.portalItem.resourceFromPath(n);r.push(s.portalItem.removeResource(s,i))}await lU(r)}async function MIt(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const sGe=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function oGe(t,e,i){let r=(t.messages??[]).filter(({type:n})=>n==="error").map(({name:n,message:s,details:o})=>new Y(n,s,o));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(n=>new Y("url:unsupported",`Relative url '${n}' is not supported`)))),i){const{ignoreUnsupported:n,supplementalUnsupportedErrors:s=[],requiredPropertyChecksDisabled:o}=i;n&&(r=r.filter(({name:a})=>!(sGe.has(a)||s.includes(a)))),o&&(r=r.filter(a=>a.name!=="web-document-write:property-required"))}if(r.length>0)throw new Y(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const aGe={width:600,height:400},JP=1.5;function lGe(t,e){e=e||aGe;let{width:i,height:r}=e;const n=i/r;return n<JP?r=i/JP:n>JP&&(i=r*JP),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function cGe(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function uGe(t){return typeof t=="string"?_o(t):te(t)}function hGe(t,e,i){const r={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s))r[n]=s.map(o=>hGe(o));else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(i==null?void 0:i[n]);r[n]=JSON.stringify(o)}else r[n]=JSON.stringify(s);else r[n]=s}return r}function $It(t){return{geometryType:fQ(t[0]),geometries:t.map(e=>e.toJSON())}}function dGe(t,e,i){const r=CVe(e);return t.map(n=>{const s=r.fromJSON(n);return s.spatialReference=i,s})}let Q1=class extends we{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),i=this.geometries[0],r={};return r.outSR=woe(this.outSpatialReference),r.inSR=woe(i.spatialReference),r.geometries=JSON.stringify({geometryType:fQ(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([f()],Q1.prototype,"geometries",void 0),u([f({json:{read:{source:"outSR"}}})],Q1.prototype,"outSpatialReference",void 0),u([f()],Q1.prototype,"transformation",void 0),u([f()],Q1.prototype,"transformForward",void 0),Q1=u([L("esri.rest.support.ProjectParameters")],Q1);const pGe=Q1,fGe=is(pGe);async function AIt(t,e,i){e=fGe(e);const r=uGe(t),n={...r.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=fQ(e.geometries[0]),a=cGe(n,i);return Br(r.path+"/project",a).then(({data:{geometries:l}})=>dGe(l,o,s))}["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(t=>t.toLowerCase());async function mGe(t,e){var n;const{item:i,authenticated:r}=t;return i!=null&&i.id&&((n=i.typeKeywords)!=null&&n.includes("useOnly"))?i.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await i.reload(),{copyAllowed:i.itemControl==="admin"||i.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function gGe(t,e,i,r){const n=t.portal,{item:s}=e,{folder:o,copyAllResources:a}=r;let l=!1;if(a&&(s!=null&&s.id)&&Tve(s.portal.url,n.url)&&parseInt(s.portal.currentVersion,10)>=2023){const{total:c}=await s.fetchResources();l=!!c}if(l){const c=await s.copy({copyResources:"all",folder:o});t.id=c.id,t.portal=c.portal;const h=t.toJSON();await t.load(),t.read(h),await t.update({data:i})}else await n.user.addItem({item:t,folder:o,data:i});return l}function jae(t){return{enabled:!!(t!=null&&t.length)}}const PQ=new sr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var Y9;let pT=Y9=class extends we{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Y9({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([f({type:Boolean,json:{write:!0}})],pT.prototype,"exactMatch",void 0),u([f({type:String,json:{write:!0}})],pT.prototype,"name",void 0),u([_t(PQ)],pT.prototype,"type",void 0),pT=Y9=u([L("esri.webdoc.applicationProperties.SearchLayerField")],pT);const yGe=pT;var X9;let fT=X9=class extends we{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new X9(te({field:this.field,id:this.id,subLayer:this.subLayer}))}};u([f({type:yGe,json:{write:{isRequired:!0}}})],fT.prototype,"field",void 0),u([f({type:String,json:{write:{isRequired:!0}}})],fT.prototype,"id",void 0),u([f({type:Wi,json:{write:!0}})],fT.prototype,"subLayer",void 0),fT=X9=u([L("esri.webdoc.applicationProperties.SearchLayer")],fT);const _Ge=fT;var J9;let mT=J9=class extends we{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new J9({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([f({type:Boolean,json:{write:!0}})],mT.prototype,"exactMatch",void 0),u([f({type:String,json:{write:!0}})],mT.prototype,"name",void 0),u([_t(PQ)],mT.prototype,"type",void 0),mT=J9=u([L("esri.webdoc.applicationProperties.SearchTableField")],mT);const vGe=mT;var Q9;let dO=Q9=class extends we{constructor(t){super(t),this.field=null,this.id=null}clone(){return new Q9(te({field:this.field,id:this.id}))}};u([f({type:vGe,json:{write:{isRequired:!0}}})],dO.prototype,"field",void 0),u([f({type:String,json:{write:{isRequired:!0}}})],dO.prototype,"id",void 0),dO=Q9=u([L("esri.webdoc.applicationProperties.SearchTable")],dO);const wGe=dO;var K9;const vxe=ot.ofType(_Ge),wxe=ot.ofType(wGe);let Lf=K9=class extends we{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new vxe,this.tables=new wxe}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new K9(te({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};u([f({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Lf.prototype,"addressSearchEnabled",void 0),u([Pe("addressSearchEnabled")],Lf.prototype,"readAddressSearchEnabled",null),u([ke("addressSearchEnabled")],Lf.prototype,"writeAddressSearchEnabled",null),u([f({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Lf.prototype,"enabled",void 0),u([f({type:String,json:{write:!0}})],Lf.prototype,"hintText",void 0),u([f({type:vxe,json:{write:{overridePolicy:jae},origins:{"web-scene":{write:{isRequired:!0}}}}})],Lf.prototype,"layers",void 0),u([f({type:wxe,json:{read:!0,write:{overridePolicy:jae}}})],Lf.prototype,"tables",void 0),Lf=K9=u([L("esri.webdoc.applicationProperties.Search")],Lf);const bGe=Lf;var e7;let IN=e7=class extends we{constructor(t){super(t),this.search=null}clone(){return new e7(te({search:this.search}))}};u([f({type:bGe,json:{write:!0}})],IN.prototype,"search",void 0),IN=e7=u([L("esri.webdoc.applicationProperties.Viewing")],IN);const xGe=IN;var t7;let PN=t7=class extends we{constructor(t){super(t),this.viewing=null}clone(){var t;return new t7({viewing:((t=this.viewing)==null?void 0:t.clone())??null})}};u([f({type:xGe,json:{write:!0}})],PN.prototype,"viewing",void 0),PN=t7=u([L("esri.webscene.ApplicationProperties")],PN);const SGe=PN;var i7;let pO=i7=class extends we{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new i7({cloudCover:this.cloudCover})}};u([_t({sunny:"sunny"})],pO.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],pO.prototype,"cloudCover",void 0),pO=i7=u([L("esri.views.3d.environment.SunnyWeather")],pO);const _5=pO;var r7;let fO=r7=class extends we{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new r7({cloudCover:this.cloudCover})}};u([_t({cloudy:"cloudy"})],fO.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],fO.prototype,"cloudCover",void 0),fO=r7=u([L("esri.views.3d.environment.CloudyWeather")],fO);const TGe=fO;var n7;let mO=n7=class extends we{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new n7({fogStrength:this.fogStrength})}};u([_t({foggy:"foggy"})],mO.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],mO.prototype,"fogStrength",void 0),mO=n7=u([L("esri.views.3d.environment.FoggyWeather")],mO);const EGe=mO;var s7;let gT=s7=class extends we{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new s7({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([_t({rainy:"rainy"})],gT.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],gT.prototype,"cloudCover",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],gT.prototype,"precipitation",void 0),gT=s7=u([L("esri.views.3d.environment.RainyWeather")],gT);const CGe=gT;var o7;let K1=o7=class extends we{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new o7({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([_t({snowy:"snowy"})],K1.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],K1.prototype,"cloudCover",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],K1.prototype,"precipitation",void 0),u([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],K1.prototype,"snowCover",void 0),K1=o7=u([L("esri.views.3d.environment.SnowyWeather")],K1);const MGe=K1,LQ={key:"type",base:_5,typeMap:{sunny:_5,cloudy:TGe,rainy:CGe,snowy:MGe,foggy:EGe}},$Ge=Object.keys(LQ.typeMap);function OGe(t,e){return!!$Ge.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const ob=1e4,AGe=1e5;var a7;let gh=a7=class extends we{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new a7(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([f({readOnly:!0,type:["sun"],json:{write:!0}})],gh.prototype,"type",void 0),u([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],gh.prototype,"date",void 0),u([Pe("date",["datetime"])],gh.prototype,"readDate",null),u([ke("date")],gh.prototype,"writeDate",null),u([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],gh.prototype,"directShadowsEnabled",void 0),u([Pe("directShadowsEnabled",["directShadows"])],gh.prototype,"readDirectShadowsEnabled",null),u([ke("directShadowsEnabled")],gh.prototype,"writedirectShadowsEnabled",null),u([f({type:Number,json:{write:!0}})],gh.prototype,"displayUTCOffset",void 0),u([ke("displayUTCOffset")],gh.prototype,"writeDisplayUTCOffset",null),gh=a7=u([L("esri.webscene.SunLighting")],gh);const Yb=gh;var l7;let gO=l7=class extends we{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new l7(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([f({readOnly:!0,type:["virtual"],json:{write:!0}})],gO.prototype,"type",void 0),u([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],gO.prototype,"directShadowsEnabled",void 0),gO=l7=u([L("esri.webscene.VirtualLighting")],gO);const q3=gO,bxe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Yb,virtual:q3}};let LN=class extends we{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};u([f({readOnly:!0,json:{read:!1}})],LN.prototype,"type",void 0),LN=u([L("esri.webscene.background.Background")],LN);const xxe=LN;function RGe(t,e){const i=e.transparency!=null?FE(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new mt([r[0]||0,r[1]||0,r[2]||0,i]):null}function IGe(t,e){e.color=t.toJSON().slice(0,3);const i=z3(t.a);i!==0&&(e.transparency=i)}const Fy={type:mt,json:{type:[Wi],default:null,read:{source:["color","transparency"],reader:RGe},write:{target:{color:{type:[Wi]},transparency:{type:Wi}},writer:IGe}}},Tm={type:Number,cast:mr,json:{write:!0}};var c7;const PGe={...Fy,nonNullable:!0};let yO=c7=class extends xxe{constructor(t){super(t),this.type="color",this.color=new mt([0,0,0,1])}clone(){return new c7(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([_t({color:"color"},{readOnly:!0})],yO.prototype,"type",void 0),u([f(PGe)],yO.prototype,"color",void 0),yO=c7=u([L("esri.webscene.background.ColorBackground")],yO);const Sxe=yO,Gae={base:xxe,key:"type",typeMap:{color:Sxe}};function LGe(t){return(e,i,r)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,r),s}}}const DGe={types:Gae,json:{read:LGe(Gae),write:{overridePolicy:(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)})}}};var u7;const Hae=(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)});let K0=u7=class extends we{constructor(t){super(t),this.lighting=new Yb,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){OGe(t==null?void 0:t.type,de.getLogger(this))&&this._set("weather",t)}clone(){return new u7(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?q3.prototype.clone.call(this.lighting):Yb.prototype.clone.call(this.lighting),background:te(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([f({types:bxe,nonNullable:!0,json:{write:!0}})],K0.prototype,"lighting",void 0),u([f(DGe)],K0.prototype,"background",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Hae}}})],K0.prototype,"atmosphereEnabled",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Hae}}})],K0.prototype,"starsEnabled",void 0),u([f({types:LQ,nonNullable:!0,json:{write:!0},value:new _5})],K0.prototype,"weather",null),K0=u7=u([L("esri.webscene.Environment")],K0);const YE=K0,Txe={type:ja,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?ja.fromArray(t):ja.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r!=null&&r.messages&&r.messages.push(new Y("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[Wi,RC]]}}}}};var h7;let e_=h7=class extends we{constructor(t){super(t),this.environment=new YE,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(t){this._set("viewingMode",t)}clone(){var t,e,i;return new h7({environment:this.environment.clone(),spatialReference:((t=this.spatialReference)==null?void 0:t.clone())??null,viewingMode:this.viewingMode,viewpoint:((e=this.viewpoint)==null?void 0:e.clone())??null,timeExtent:((i=this.timeExtent)==null?void 0:i.clone())??null})}};u([f({type:YE,json:{write:{isRequired:!0}}})],e_.prototype,"environment",void 0),u([f({type:nt})],e_.prototype,"spatialReference",void 0),u([f({type:["local","global"]})],e_.prototype,"viewingMode",null),u([f({type:ef,json:{write:{isRequired:!0}}})],e_.prototype,"viewpoint",void 0),u([f(Txe)],e_.prototype,"timeExtent",void 0),e_=h7=u([L("esri.webscene.InitialViewProperties")],e_);const v5=e_;function Fe(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ye(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ve(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function xe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Ae(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function DQ(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Exe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function NGe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Cxe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function XE(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function Mxe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function $xe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function Oxe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function FGe(t,e=0,i=1){return t[0]=Math.min(Math.max(t[0],e),i),t[1]=Math.min(Math.max(t[1],e),i),t[2]=Math.min(Math.max(t[2],e),i),t}function kGe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ue(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Us(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Nr(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}function to(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function No(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function od(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function UGe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Me(t,e){const i=e[0],r=e[1],n=e[2];let s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function Te(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ot(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];return t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o,t}function zGe(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2],c=n*l-s*a,h=s*o-r*l,p=r*a-n*o,g=Math.sqrt(c*c+h*h+p*p);return t[0]=c/g,t[1]=h/g,t[2]=p/g,t}function br(t,e,i,r){const n=e[0],s=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t}function VGe(t,e,i,r,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),h=o*(3-2*s);return t[0]=e[0]*a+i[0]*l+r[0]*c+n[0]*h,t[1]=e[1]*a+i[1]*l+r[1]*c+n[1]*h,t[2]=e[2]*a+i[2]*l+r[2]*c+n[2]*h,t}function BGe(t,e,i,r,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,h=3*s*a,p=3*l*o,g=l*s;return t[0]=e[0]*c+i[0]*h+r[0]*p+n[0]*g,t[1]=e[1]*c+i[1]*h+r[1]*p+n[1]*g,t[2]=e[2]*c+i[2]*h+r[2]*p+n[2]*g,t}function jGe(t,e=1){const i=V3,r=2*i()*Math.PI,n=2*i()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function Mt(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12],t[1]=i[1]*r+i[5]*n+i[9]*s+i[13],t[2]=i[2]*r+i[6]*n+i[10]*s+i[14],t}function Zl(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t}function Ac(t,e,i){const r=i[0],n=i[1],s=i[2],o=i[3],a=e[0],l=e[1],c=e[2],h=n*c-s*l,p=s*a-r*c,g=r*l-n*a,y=n*g-s*p,w=s*h-r*g,b=r*p-n*h,x=2*o;return t[0]=a+h*x+2*y,t[1]=l+p*x+2*w,t[2]=c+g*x+2*b,t}function GGe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function HGe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function qGe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function Axe(t,e){Me(qae,t),Me(Wae,e);const i=Te(qae,Wae);return i>1?0:i<-1?Math.PI:Math.acos(i)}const qae=A(),Wae=A();function WGe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Qs(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function JE(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=Bo();return Math.abs(i-s)<=l*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function _x(t,e,i){const r=i[0]-e[0],n=i[1]-e[1],s=i[2]-e[2];let o=r*r+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const nr=Ae,ZGe=DQ,YGe=Exe,Na=Nr,Xb=to,ua=Fe,w5=No,Zae=Object.freeze(Object.defineProperty({__proto__:null,abs:XE,add:xe,angle:Axe,bezier:BGe,ceil:NGe,clamp:FGe,copy:ye,cross:Ot,crossAndNormalize:zGe,direction:_x,dist:Na,distance:Nr,div:YGe,divide:Exe,dot:Te,equals:JE,exactEquals:Qs,floor:Cxe,hermite:VGe,inverse:UGe,len:ua,length:Fe,lerp:br,max:Oxe,min:$xe,mul:ZGe,multiply:DQ,negate:od,normalize:Me,random:jGe,rotateX:GGe,rotateY:HGe,rotateZ:qGe,round:kGe,scale:ue,scaleAndAdd:Us,set:ve,sign:Mxe,sqrDist:Xb,sqrLen:w5,squaredDistance:to,squaredLength:No,str:WGe,sub:nr,subtract:Ae,transformMat3:Zl,transformMat4:Mt,transformQuat:Ac},Symbol.toStringTag,{value:"Module"}));let XGe=class{constructor(e,i){this._observable=new L3,this._value=e,this._equalityFunction=i}get value(){return qt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function Xl(t,e=m_e){return new XGe(t,e)}const jo=Symbol("Yield");let JGe=class{constructor(){this._tasks=new Array,this._runningTasks=Xl(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return jo;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return++this._runningTasks.value,new Promise((n,s)=>this._tasks.push(new Yae(n,s,e,i,r))).finally(()=>--this._runningTasks.value)}unshift(e,i,r){return++this._runningTasks.value,new Promise((n,s)=>this._tasks.unshift(new Yae(n,s,e,i,r))).finally(()=>--this._runningTasks.value)}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const n=zo(i.signal);if(n&&!i.abortCallback)i.reject(ki());else{const s=n?(r=i.abortCallback)==null?void 0:r.call(i,ki()):i.callback(e);qu(s)?s.then(i.resolve,i.reject):i.resolve(s)}}catch(n){i.reject(n)}return!0}cancelAll(){const e=ki();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0}},Yae=class{constructor(e,i,r,n=void 0,s=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=n,this.abortCallback=s}},_O=class extends Ne{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([f()],_O.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([f()],_O.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),_O=u([L("esri.views.support.debugFlags")],_O);const QGe=new _O;var Di;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Di||(Di={}));function KGe(){return new b5.Scheduler}var xt;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t.MAPVIEW_FETCH_QUEUE="mapview fetch queue",t.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",t.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(xt||(xt={}));const Ah=0,Xae=new Map([[xt.RESOURCE_CONTROLLER_IMMEDIATE,Ah],[xt.RESOURCE_CONTROLLER,4],[xt.SLIDE,Ah],[xt.STREAM_DATA_LOADER,Ah],[xt.ELEVATION_QUERY,Ah],[xt.TERRAIN_SURFACE,1],[xt.SURFACE_GEOMETRY_UPDATES,1],[xt.LOD_RENDERER,2],[xt.GRAPHICS_CORE,2],[xt.I3S_CONTROLLER,2],[xt.POINT_CLOUD_LAYER,2],[xt.FEATURE_TILE_FETCHER,2],[xt.CLOUDS_GENERATOR,2],[xt.OVERLAY,4],[xt.STAGE,4],[xt.GRAPHICS_DECONFLICTOR,4],[xt.FILTER_VISIBILITY,4],[xt.SCALE_VISIBILITY,4],[xt.FRUSTUM_VISIBILITY,4],[xt.POINT_OF_INTEREST_FREQUENT,6],[xt.POINT_OF_INTEREST_INFREQUENT,30],[xt.LABELER,8],[xt.FEATURE_QUERY_ENGINE,8],[xt.FEATURE_TILE_TREE,16],[xt.FEATURE_TILE_TREE_ACTIVE,Ah],[xt.ELEVATION_ALIGNMENT,12],[xt.ELEVATION_ALIGNMENT_SCENE,14],[xt.TEXT_TEXTURE_ATLAS,12],[xt.TEXTURE_UNLOAD,12],[xt.LINE_OF_SIGHT_TOOL,16],[xt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Ah],[xt.SNAPPING,Ah],[xt.SHADOW_ACCUMULATOR,30],[xt.MAPVIEW_FETCH_QUEUE,Ah],[xt.MAPVIEW_LAYERVIEW_UPDATE,2],[xt.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,Ah]]);function Jae(t){return Xae.has(t)?Xae.get(t):typeof t=="number"?t:1}const e8e=6.5,Qae=1,t8e=30,i8e=1e3/30,r8e=100,Kae=.9;var b5,w1;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=Xl(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new ry("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Di.INTERACTING,this._tasks=new mi,this._runQueue=new mi,this._load=0,this._idleStateCallbacks=new mi,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=oe(()=>QGe.SCHEDULER_LOG_SLOW_TASKS,s=>this._debug=s,Si);for(const s of Object.keys(xt))this.performanceInfo.tasks.set(xt[s],new ry(xt[s]))}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Sr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=new i(this,s,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new ry(s)),a}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Di.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Di.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Di.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test&&(this._test.usedBudget=0),++this._frameNumber;let o=e8e,a=s.frameDuration,l=Qae;switch(this.state){case Di.IDLE:o=0,a=Math.max(r8e,s.frameDuration),l=t8e;break;case Di.INTERACTING:a=Math.max(i8e,s.frameDuration);case Di.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Di.IDLE&&a<Qae&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Di.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Di.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return w1.SCHEDULED;let o=w1.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=w1.READY:o!==w1.READY&&(o=w1.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Kae+s*(1-Kae)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Ah&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Ah&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===jo&&(a.blockFrame=this._frameNumber)}catch(c){de.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,xt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(xt))this._frameTaskTimes.set(xt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).push(o)),this.performanceInfo.total.push(s)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,o,a){this._scheduler=s,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new JGe,this._handles=new Dy,this._basePriority=Jae(o),this.schedulePriority=this._basePriority,this._task=Xl(a??this._queue),this._handles.add(Kl(()=>this.task.running,l=>s.taskRunningChanged(l)))}remove(){this.processQueue(kc),this._scheduler.removeTask(this),this.schedule=QE.schedule,this.reschedule=QE.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){if(this.name===s)return;this.name=s;const o=Jae(s);this._basePriority!==Ah&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){return this._queue.runTask(s)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Di.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(b5||(b5={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(w1||(w1={}));const kc=(()=>{const t=new b5.Budget;return t.enabled=!1,t})();let n8e=class{remove(){}processQueue(){}schedule(e,i,r){try{if(zo(i)){const n=ki();return r?Promise.resolve(r(n)):Promise.reject(n)}return $H(e(kc))}catch(n){return Promise.reject(n)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const QE=new n8e;var d7;let $p=d7=class extends we{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return $ve(this.url)}get isDataURI(){return Rm(this.url)}clone(){return new d7({url:this.url})}};u([f({type:String,json:{write:{isRequired:!0}}})],$p.prototype,"url",void 0),u([f()],$p.prototype,"isSecureUrl",null),u([f()],$p.prototype,"isDataURI",null),$p=d7=u([L("esri.webdoc.support.SlideThumbnail")],$p);var p7;let DN=p7=class extends we{constructor(){super(...arguments),this.text=""}clone(){return new p7({text:this.text})}};u([f({type:String,json:{write:!0}})],DN.prototype,"text",void 0),DN=p7=u([L("esri.webscene.support.Description")],DN);const NN=DN;var f7;let _2=f7=class extends we{constructor(){super(...arguments),this.lighting=new Yb,this.weather=new _5}clone(){return new f7({lighting:te(this.lighting),weather:te(this.weather)})}};u([f({types:bxe,json:{write:!0}})],_2.prototype,"lighting",void 0),u([f({types:LQ,json:{write:!0}})],_2.prototype,"weather",void 0),_2=f7=u([L("esri.webscene.Environment")],_2);var FN;let kN=FN=class extends we{constructor(){super(...arguments),this.opacity=null}clone(){return new FN({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=(t==null?void 0:t.clone())??new DR).opacity=this.opacity),t}static fromGround(t){return new FN({opacity:t.opacity})}};u([f({type:Number,json:{type:Wi,read:{reader:FE,source:"transparency"},write:{writer:(t,e)=>{e.transparency=z3(t)},target:"transparency"}}})],kN.prototype,"opacity",void 0),kN=FN=u([L("esri.webscene.support.SlideGround")],kN);const Rxe=kN;var m7;let v2=m7=class extends we{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new m7({id:this.id,sublayerIds:te(this.sublayerIds)})}};u([f({type:String,json:{write:!0}})],v2.prototype,"id",void 0),u([f({type:[Wi],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],v2.prototype,"sublayerIds",void 0),v2=m7=u([L("esri.webscene.support.SlideVisibleLayer")],v2);var g7;let UN=g7=class extends we{constructor(){super(...arguments),this.text=""}clone(){return new g7({text:this.text})}};u([f({type:String,json:{write:{isRequired:!0}}})],UN.prototype,"text",void 0),UN=g7=u([L("esri.webscene.support.Title")],UN);const GA=UN;let s8e=0;const y7=ot.ofType(v2),o8e=["caption","cover","none"];let so=class extends Or(we){constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+s8e++,this.title=new GA,this.description=new NN,this.hidden=!1,this.thumbnail=new $p,this.viewpoint=null,this.basemap=null,this.ground=null,this.layout="caption",this.environment=new _2,this.timeExtent=null,this.visibleLayers=new y7}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=Ye(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new GA({text:e}):is(GA,e)}castDescription(e){return typeof e=="string"?new NN({text:e}):is(NN,e)}castThumbnail(e){return typeof e=="string"?new $p({url:e}):is($p,e)}castBasemap(e){return oQ(e)}set visibleLayers(e){this._set("visibleLayers",vm(e,this._get("visibleLayers"),y7))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof kU){const r=ele(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(de.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}async _updateVisibleLayersFrom(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(n=>{if(n.visible){const s=ele(r);i.push(new v2({id:n.layer.id,sublayerIds:s}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i==null?void 0:i.screenshot};return e.when(()=>{var n;return this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?q3.prototype.clone.apply(e.environment.lighting):Yb.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?Rxe.fromGround(e.map.ground):null,this.timeExtent=((n=e.timeExtent)==null?void 0:n.clone())??null,this._updateVisibleLayersFrom(e)}).then(()=>e.takeScreenshot(r)).then(n=>(this.thumbnail=new $p({url:n.dataUrl}),this))}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const n=R3(i,()=>r==null?void 0:r.abort()),s=()=>{this._applyToController===r&&(this._applyToController=null),r=null,n==null||n.remove()};try{await kE(()=>e.ready,r.signal)}catch(p){throw s(),p}if(r.signal.aborted)throw s(),ki();const o=e.resourceController.scheduler.registerTask(xt.SLIDE);let a=!1;const l={animate:!0,...i,signal:this._applyToController.signal},c=async()=>{await Promise.all([o.schedule(async()=>a=await this._setViewpointOfInterest(e,l)),o.schedule(()=>this._applyBasemap(e,l),l.signal),o.schedule(()=>this._loadLayersWithSublayerVisibility(e))]),await Promise.all([o.schedule(()=>this._applyLayerVisibility(e),l.signal),o.schedule(()=>this._applyGround(e),l.signal),o.schedule(()=>this._applyViewpoint(e,l),l.signal),o.schedule(()=>{var p;return e.timeExtent=((p=this.timeExtent)==null?void 0:p.clone())??null},l.signal),o.schedule(()=>e.environment.weather=this.environment.weather.clone())])},h=await Xp(e.addUpdatingPromise(c()));if(a&&(e.contentCamera=null),o.remove(),s(),h.ok===!1)throw h.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(Bn(r))throw r}e.map.basemap=Vze(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const i=new ot;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>{var n;return((n=this.visibleLayers.find(s=>s.id===i.id))==null?void 0:n.sublayerIds)?i.load():null}))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(o=>o.id===i.id);i.visible=r!=null;const n=r==null?void 0:r.sublayerIds,s=Ixe(i);n&&s&&s.forEach(o=>o.visible=n.includes(o.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i!=null&&i.ignoreViewpoint||!(i!=null&&i.useDestinationCamera))return!1;const{toCameraAsync:r}=await fe(()=>Promise.resolve().then(()=>Ert),void 0),n=await r(e,this.viewpoint);return e.contentCamera=n,n!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(n=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),n}).finally(()=>{Sr(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const n=new Date(i.date.toString()),[s,o]=this._getTime(n),[a,l]=this._getTime(r.date),c=l8e(o,l),h=e.renderCoordsHelper,p=A();h.toRenderCoords(e.camera.position,p);const g=A(),y=A();this.viewpoint.camera!=null&&h.toRenderCoords(this.viewpoint.camera.position,g);const w=new Date;return Kl(()=>e.camera,b=>{h.toRenderCoords(b.position,y);const x=to(p,y),T=to(g,y);let M=0;x+T!==0&&(M=x/(x+T));const $=s+(a-s)*M,R=c8e(o,c*M);i.date=this._setTime(w,$,R)})}static createFrom(e,i){return new this().updateFrom(e,i)}};u([f({type:String,json:{write:{isRequired:!0}}})],so.prototype,"id",void 0),u([f({type:GA,json:{default:()=>new GA({text:""}),write:{isRequired:!0}}})],so.prototype,"title",void 0),u([$i("title")],so.prototype,"castTitle",null),u([f({type:NN,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],so.prototype,"description",void 0),u([$i("description")],so.prototype,"castDescription",null),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],so.prototype,"hidden",void 0),u([f({type:$p,json:{default:()=>new $p({url:""}),write:{isRequired:!0}}})],so.prototype,"thumbnail",void 0),u([$i("thumbnail")],so.prototype,"castThumbnail",null),u([f({type:ef,nonNullable:!0,json:{write:{isRequired:!0}}})],so.prototype,"viewpoint",void 0),u([f({type:J2,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],so.prototype,"basemap",void 0),u([$i("basemap")],so.prototype,"castBasemap",null),u([f({type:Rxe,json:{write:!0}})],so.prototype,"ground",void 0),u([f({type:o8e,json:{write:!0,default:"caption"},nonNullable:!0})],so.prototype,"layout",void 0),u([f({type:y7,json:{write:{isRequired:!0}}})],so.prototype,"visibleLayers",null),u([$i("visibleLayers")],so.prototype,"castVisibleLayers",null),u([f({type:_2,json:{write:!0}})],so.prototype,"environment",void 0),u([f(Txe)],so.prototype,"timeExtent",void 0),so=u([L("esri.webscene.Slide")],so);const a8e=so;function Ixe(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function ele(t){const e=Ixe(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const _7=86400,tle=43200;function l8e(t,e){let i=e-t;return i>tle&&(i-=_7),i<-tle&&(i+=_7),i}function c8e(t,e){return BUe(t+e,_7)}const v7=ot.ofType(a8e);let zN=class extends we{constructor(e){super(e),this.slides=new v7}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",vm(e,this._get("slides"),v7))}clone(){return new this.constructor({slides:this.slides.clone()})}};u([f({type:v7,nonNullable:!0,json:{write:!0}}),$i(RJ)],zN.prototype,"slides",null),zN=u([L("esri.webscene.Presentation")],zN);const Pxe=zN;var w7;let yT=w7=class extends we{constructor(t){super(t)}clone(){return new w7({name:this.name,path:this.path,title:this.title})}};u([f({type:String,json:{write:!0}})],yT.prototype,"name",void 0),u([f({type:String,json:{write:!0}})],yT.prototype,"path",void 0),u([f({type:String,json:{write:!0}})],yT.prototype,"title",void 0),yT=w7=u([L("esri.webscene.TransportationNetwork")],yT);const u8e=yT;let GU=class b7{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}greaterEqual(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new Y(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new b7(this.major,this.minor,this._context)}static parse(e,i=""){const[r,n]=e.split("."),s=/^\s*\d+\s*$/;if(!(r!=null&&r.match)||!s.test(r))throw new Y((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(n!=null&&n.match)||!s.test(n))throw new Y((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(n,10);return new b7(o,a,i)}},x5=class extends GU{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.greaterEqual(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},h8e=null;function d8e(){return h8e}var Lxe;const $b=new x5(1,35),p8e=()=>{const e=[],i=$b.major;for(let r=8;r<=$b.minor;r++)e.push(`${i}.${r}`);return e},Z6="Web Scene";let Mr=class extends wm.LoadableMixin(D3(EQ(Pbe))){constructor(e){super(e),this[Lxe]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new Pxe,this.initialViewProperties=new v5,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=cU(async(i,r,n)=>{switch(i){case $u.SAVE:return this._saveImpl(r);case $u.SAVE_AS:return this._saveAsImpl(n,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{de.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(Vo(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=Ye(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,n){i[r]=this._layersToJSON(e,"operational-layers",n)}readSourceVersion(e,i){const[r,n]=i.version.split(".");return new x5(parseInt(r,10),parseInt(n,10))}writeSourceVersion(e,i,r){i[r]=`${$b.major}.${$b.minor}`}writeTables(e,i,r,n){const s=this._layersToJSON(e,"tables",n);s.length&&(i[r]=s)}get thumbnailUrl(){var e;return((e=this.portalItem)==null?void 0:e.thumbnailUrl)??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=Nve}writeGround(e,i,r,n){i[r]=e?e.write({},n):{transparency:0,layers:[]}}readInitialViewProperties(e,i){var s,o,a;const r={};(s=i.initialState)!=null&&s.environment&&(r.environment=YE.fromJSON(i.initialState.environment)),r.spatialReference=i.spatialReference?nt.fromJSON(i.spatialReference):nt.WebMercator,r.viewingMode=i.viewingMode??"global",(o=i.initialState)!=null&&o.viewpoint&&(r.viewpoint=ef.fromJSON(i.initialState.viewpoint));const n=(a=i.initialState)==null?void 0:a.timeExtent;return n!=null&&(r.timeExtent=ja.fromArray(n)),new v5(r)}get spatialReference(){var e;return((e=this.initialViewProperties)==null?void 0:e.spatialReference)??nt.WebMercator}get viewingMode(){var e;return((e=this.initialViewProperties)==null?void 0:e.viewingMode)??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy(),this._validateFeatureLayerSymbolVisibility()})),Promise.resolve(this)}loadAll(){return DJ(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){var s;i={...i,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,n=this._isAuthoringAppSetByUser;if(mve(this,e,o=>super.read(e,o),i),n||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&((s=this.sourceVersion)==null?void 0:s.supportsVisibleElevationLayersInSlides)){const o=e.baseMap.elevationLayers.map(h=>({id:h.id})),a=this.presentation.slides,l=(h,p)=>h.visibleLayers.some(g=>g.id===p),c=o.filter(h=>!a.some(p=>l(p,h.id)));a.forEach(h=>{h.visibleLayers.addMany(c)})}}_writeBasemapElevationLayers(e){var r;const i=(r=e.ground)==null?void 0:r.layers;!e.baseMap&&(i!=null&&i.length)&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=te(i))}_layersToJSON(e,i,r){const n={...r,layerContainerType:i};return e.map(s=>this._verifyWritableLayer(s,r)?s.write({},n):null).filter(s=>!!s).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i!=null&&i.messages&&i.messages.push(new Y("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){var s;if(this.loadStatus!=="loaded"){const o=new Y("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw de.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),o}this._runLayersIdGC();const r=!(i!=null&&i.messages);i={messages:[],...i,origin:"web-scene"};const n=super.write(e,i);if(r){const o=((s=i.messages)==null?void 0:s.filter(a=>a.name==="web-document-write:property-required"))??[];if(o.length){const a=new Y("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:o});throw de.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",o),a}}return this._writeBasemapElevationLayers(n),n}async save(e){return this._debouncedSaveOperations($u.SAVE,e)}async _saveImpl(e){var s;if(!this.portalItem)throw new Y("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(((s=this.portalItem)==null?void 0:s.type)!==Z6)throw new Y("webscene:portal-item-wrong-type",`Portal item needs to have type "${Z6}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(zae(this.portalItem,"web-scene",!0)),n=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(n,r,$u.SAVE,e),this._updateTypeKeywords(this.portalItem),await nGe(this.portalItem,n,this._resourceReferences,r),Dae(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations($u.SAVE_AS,i,e)}async _saveAsImpl(e,i){let r=vb.from(e);if(!r)throw new Y("webscene:portal-item-required","saveAs requires a portal item to save to");r.id&&(r=r.clone(),r.id=null);const n=r.portal||va.getDefault();await this._ensureLoadBeforeSave(),r.type=Z6,r.portal=n;const s=this._enableVerifyItemRelativeUrls(zae(r,"web-scene",!0)),o=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(o,s,i);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(r),await n.signIn();const c=this.portalItem,h={item:c,authenticated:!(!(c!=null&&c.id)||!c.portal.user)},{copyAllowed:p,itemReloaded:g}=await mGe(h,n);if(h.authenticated||(h.authenticated=g),!p)throw new Y(`${s.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const y={...i,copyAllResources:!0};return await gGe(r,h,o,y)&&(this._resourceReferences.portalItem=r),await rGe(this._resourceReferences,s),this.portalItem=r,D9.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?_o(r.itemUrl):void 0}),Dae(s),a&&(this.thumbnailUrl=l?Ive(a,"w","8192"):a),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){var e;this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,i,r,n){if(!mU(this.spatialReference))throw new Y("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:s,requiredPropertyChecksDisabled:o,strictSchemaValidationEnabled:a}=n||{};oGe(i,{errorName:"webscene:save"},{ignoreUnsupported:s,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:o});const l=d8e();if(a&&l){const c=(await l()).validate(e);if(!c.length)return;const h=`webscene did not validate:
${c.join(`
`)}`;de.getLogger(this).error(`${r===$u.SAVE_AS?"saveAs":"save"}(): ${h}`);const p=c.map(g=>new Y("webscene:schema-validation",g));throw jje(p)}}_verifySaveAs(e,i,r){return this._verifySave(e,i,$u.SAVE_AS,r)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(){return!1}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){var r;if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=YE.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=((r=e.timeExtent)==null?void 0:r.clone())??null,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const n of e.allLayerViews){const s="visible";s in n&&s in n.layer&&n._isOverridden(s)&&(n.layer[s]=n[s])}if(!i.widgetsExcluded)for(const n of e.persistableViewModels)n.updateWebDocument(this);(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this._updateFromThumbnail(e,i.thumbnailSize??void 0)}async _updateFromThumbnail(e,i){const r=lGe(e,i),n=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=n.dataUrl}_loadFromSource(){var e;return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):(e=this.portalItem)!=null&&e.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,i){const r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r,i)}_extractOperationalLayers(e){var s;const i=[];if(!((s=this.sourceVersion)!=null&&s.supportsGround)&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const o of e.baseMap.elevationLayers)i.push(o);const r=[],n=o=>{var a;return o.layers&&(o.layers=o.layers.filter(n)),o.layerType!=="ArcGISTiledElevationServiceLayer"||((a=this.sourceVersion)!=null&&a.supportsGround||r.push(o),!1)};return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(n):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,i){var h;const r=new ot;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:n}=await fe(()=>import("./layersCreator-DeJ1MgNa.js"),__vite__mapDeps([10,11,12,13])),{operationalLayers:s,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],c={context:{...i,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||va.getDefault()),a.length>0){const p={...c,context:{...c.context,layerContainerType:"ground"}};p.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(n(this.ground.layers,a,p))}if(o.length>0){const p={...c,context:{...c.context,layerContainerType:"ground"}};p.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(n(r,o,p))}s&&s.length>0&&l.push(n(this.layers,s,c)),(h=e.tables)!=null&&h.length&&l.push(n(this.tables,e.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(l),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r.filter(p=>p.type==="base-elevation"||p.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const n=r.beforeSave();n&&e.push(n)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(n=>{throw new Y("webscene:load-portal-item","Failed to load portal item",{error:n})}),e.type!=="Web Scene")throw new Y("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:_o(e.itemUrl),portal:e.portal||va.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!zR(i,ct.Global))return Promise.reject(new Y("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||tf(l,i)}else{if(!zR(i,ct.Local))return Promise.reject(new Y("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const n=l=>{var c,h;return((c=l==null?void 0:l.camera)==null?void 0:c.position.spatialReference)??((h=l==null?void 0:l.targetGeometry)==null?void 0:h.spatialReference)},s=e.viewpoint,o=n(s);if(o&&!r(o))return Promise.reject(new Y("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:i,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!r(n(l.viewpoint)));if(a){const l=n(a.viewpoint);return Promise.reject(new Y("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=Oje(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateFeatureLayerSymbolVisibility(){var e;(e=this.sourceVersion)!=null&&e.greaterEqual(1,35)||this.layers.forEach(i=>{i.type==="feature"&&oe(()=>i.loaded,()=>i.warnInvisibleDrapedSymbols(),{once:!0,sync:!0})})}_validateJSON(e){const i=x5.parse(e.version||"","webscene");return $b.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=nt.WebMercator.toJSON()),e}_updateTypeKeywords(e){Vae(e,j9.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),Vae(e,j9.DEVELOPER_BASEMAP,joe(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&joe(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,n)=>n.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||nt.WebMercator}get _verifyItemRelativeRootPath(){var e;return(e=this.portalItem)!=null&&e.itemUrl?_o(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){var n,s;this._unscheduleLayersIdGC();const e=(s=(n=this.applicationProperties)==null?void 0:n.viewing)==null?void 0:s.search,i=o=>this.allLayers.some(a=>a.id===o&&a.persistenceEnabled);e!=null&&e.layers&&(e.layers=e.layers.filter(o=>i(o.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(o=>{o.visibleLayers&&(o.visibleLayers=o.visibleLayers.filter(a=>i(a.id)))})}static fromJSON(e){if(!e)throw new Y("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};Lxe=Vje,Mr.version=`${$b.major}.${$b.minor}`,u([f({type:SGe,json:{write:!0}})],Mr.prototype,"applicationProperties",void 0),u([f({type:pr,json:{read:{source:"clippingArea.geometry",reader:Sv},write:{target:"clippingArea.geometry"}}})],Mr.prototype,"clippingArea",void 0),u([ke("clippingArea")],Mr.prototype,"writeClippingArea",null),u([f({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Mr.prototype,"clippingEnabled",void 0),u([Pe("clippingEnabled",["clippingArea"])],Mr.prototype,"readClippingEnabled",null),u([ke("clippingEnabled")],Mr.prototype,"writeClippingEnabled",null),u([f({type:zje,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Mr.prototype,"floorInfo",void 0),u([f({type:Gv,json:{write:!0}})],Mr.prototype,"heightModelInfo",void 0),u([f({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Mr.prototype,"layers",void 0),u([ke("layers")],Mr.prototype,"writeLayers",null),u([f({readOnly:!0,type:x5,json:{type:p8e(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Mr.prototype,"sourceVersion",void 0),u([Pe("sourceVersion",["version"])],Mr.prototype,"readSourceVersion",null),u([ke("sourceVersion")],Mr.prototype,"writeSourceVersion",null),u([f({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],Mr.prototype,"tables",void 0),u([ke("tables")],Mr.prototype,"writeTables",null),u([f()],Mr.prototype,"thumbnailUrl",null),u([f({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Mr.prototype,"authoringApp",null),u([ke("authoringApp")],Mr.prototype,"writeAuthoringApp",null),u([f({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Mr.prototype,"authoringAppVersion",null),u([ke("authoringAppVersion")],Mr.prototype,"writeAuthoringAppVersion",null),u([f({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Mr.prototype,"ground",void 0),u([ke("ground")],Mr.prototype,"writeGround",null),u([f({type:ot.ofType(u8e),json:{write:!0}})],Mr.prototype,"transportationNetworks",void 0),u([f({type:Pxe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const n={...r,isPresentation:!0};e.presentation=t.write({},n)}}}}})],Mr.prototype,"presentation",void 0),u([f({type:v5,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new v5({viewingMode:"global",spatialReference:nt.WebMercator})}})],Mr.prototype,"initialViewProperties",void 0),u([Pe("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],Mr.prototype,"readInitialViewProperties",null),u([f({type:nt,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Mr.prototype,"spatialReference",null),u([f({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Mr.prototype,"viewingMode",null),u([f({type:vb})],Mr.prototype,"portalItem",void 0),u([f()],Mr.prototype,"resourceInfo",void 0),u([f({type:Wje,json:{write:!0}})],Mr.prototype,"widgets",void 0),Mr=u([L("esri.WebScene")],Mr);const f8e=Mr;function HU(t){return typeof t=="string"?document.getElementById(t):t??null}function ile(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let S5=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new L3,this._items=new Set}get length(){return qt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return qt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){qt(this._observable),yield*this._items}};const Dxe=new FinalizationRegistry(t=>{t.close()});function m8e(t,e){Dxe.register(t,e,e)}function g8e(t){Dxe.unregister(t)}function Nxe(t,e){return new Proxy({},{get:(i,r,n)=>(...s)=>{let o,a;const l=s[s.length-1];return y8e(l)&&(o=l.signal,a=l.transferList,s.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),s,{transferList:a,signal:o})}})}function y8e(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const _8e={statsWorker:()=>fe(()=>import("./statsWorker-D6hKRK3F.js"),__vite__mapDeps([16,17,18,19,20])),geometryEngineWorker:()=>fe(()=>import("./geometryEngineWorker-BiqU-FdE.js"),__vite__mapDeps([21,22,15,3,23])),CSVSourceWorker:()=>fe(()=>import("./CSVSourceWorker-CUf0BNhY.js"),__vite__mapDeps([24,25,23,26,27,28,29,30,31,32,33,34,35,36,17,18,19,20,37,38,39,40,41,42])),EdgeProcessingWorker:()=>fe(()=>import("./EdgeProcessingWorker-DAlngX68.js"),__vite__mapDeps([43,44,45,46,47])),ElevationSamplerWorker:()=>fe(()=>import("./ElevationSamplerWorker-CLvOQ9p5.js"),__vite__mapDeps([48,28,29,49,50])),FeatureServiceSnappingSourceWorker:()=>fe(()=>import("./FeatureServiceSnappingSourceWorker-JlW1dDGN.js"),__vite__mapDeps([51,26,27,28,29,30,31,32,33,34,35,23,36,17,18,19,20,37,38,39,52,53,54,55])),GeoJSONSourceWorker:()=>fe(()=>import("./GeoJSONSourceWorker-DzymMPOe.js"),__vite__mapDeps([56,26,27,28,29,30,31,32,33,34,35,23,36,17,18,19,20,37,38,39,57,25,41,42,58])),LercWorker:()=>fe(()=>import("./LercWorker-BtqWYL1Z.js"),[]),MemorySourceWorker:()=>fe(()=>import("./MemorySourceWorker-xsaUczO9.js"),__vite__mapDeps([59,60,26,27,28,29,30,31,32,33,34,35,23,36,17,18,19,20,37,38,39,41,42,58,25])),PBFDecoderWorker:()=>fe(()=>import("./PBFDecoderWorker-D4qql28G.js"),__vite__mapDeps([61,53,54])),FeaturePipelineWorker:()=>fe(()=>import("./FeaturePipelineWorker-DCm0Y782.js"),__vite__mapDeps([62,63,64,65,66,67,68,69,70,71,35,31,32,23,38,39,30,33,34,36,17,18,19,20,37,29,55,53,54,72,57,25,41,42,58,73,74])),PointCloudWorker:()=>fe(()=>import("./PointCloudWorker-C2jYn8ig.js"),__vite__mapDeps([75,76,77,78])),RasterWorker:()=>fe(()=>import("./RasterWorker-D6-zBh2l.js"),__vite__mapDeps([79,80,3,81,82])),SceneLayerSnappingSourceWorker:()=>fe(()=>import("./SceneLayerSnappingSourceWorker-B-cIn5SV.js"),__vite__mapDeps([83,46,47,45])),SceneLayerWorker:()=>fe(()=>import("./SceneLayerWorker-BG9YJKNE.js").then(t=>t.S),__vite__mapDeps([84,85,86,78])),WFSSourceWorker:()=>fe(()=>import("./WFSSourceWorker-DPBtuAHx.js"),__vite__mapDeps([87,26,27,28,29,30,31,32,33,34,35,23,36,17,18,19,20,37,38,39,57,25,58,88,89])),WorkerTileHandler:()=>fe(()=>import("./WorkerTileHandler-Bv_3y1xM.js"),__vite__mapDeps([90,71,54,68,63,91,69,65])),Lyr3DWorker:()=>fe(()=>import("./Lyr3DWorker-DkTXfClf.js"),__vite__mapDeps([92,93,94])),Feature3DPipelineWorker:()=>fe(()=>import("./Feature3DPipelineWorker-DOxphKnl.js"),__vite__mapDeps([95,30,31,32,33,34,35,23,36,17,18,19,20,37,28,29,39,55,53,54]))},Fxe="worker:port-closed";var da;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(da||(da={}));let v8e=0;function kxe(){return v8e++}function w8e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function VR(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function NQ(t,e,i,r){if(e.type===da.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==da.INVOKE&&e.type!==da.RESPONSE)return void t.postMessage(e);let n;if(w8e(i)?(n=rle(i.transferList),e.data=i.result):(n=rle(r),e.data=i),n){if(pe("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case da.INVOKE:throw o;case da.RESPONSE:return void NQ(t,{type:da.RESPONSE,jobId:e.jobId,error:VR(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function BR(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function rle(t){if(!(t!=null&&t.length))return null;if(pe("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!b8e(i));return e.length?e:null}function b8e(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function BIt(t){try{return await t}catch(e){const i=(e==null?void 0:e.name)===Fxe;if(!(Bn(e)||i))throw e;return}}const{CLOSE:nle,ABORT:sle,INVOKE:ole,RESPONSE:n$,OPEN_PORT:ale,ON:x8e}=da,S8e=2;let T8e=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===da.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},Rv=class _T{static connect(e,i){const r=new MessageChannel;let n;n=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new _T(r.port1,{channel:r,client:n,schedule:i});return typeof n=="object"&&"remoteClient"in n&&(n.remoteClient=s),_T.clients.set(s,n),r.port2}static loadWorker(e){const i=_8e[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new T8e(n=>this._onInvokeMessage(n)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:nle}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const n=r==null?void 0:r.signal,s=r==null?void 0:r.transferList;if(!this._port)return Promise.reject(new Y(Fxe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=kxe();return new Promise((a,l)=>{if(zo(n))return this._processWork(),void l(ki());const c=_a(n,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Sr(p.abortHandle),this._post({type:sle,jobId:o}),l(ki()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:ole,jobId:o,methodName:e,abortable:n!=null},i,s)})}createInvokeProxy(e){return Nxe(this,e)}on(e,i){const r=new MessageChannel;function n(s){i(s.data)}return this._port.postMessage({type:da.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),Ui(()=>{r.port1.postMessage({type:da.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:ale,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=S8e)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:n,resolver:s}=e;this.apply(i,r,n).then(a=>s.resolve(a)).catch(a=>s.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Sr(e.abortHandle),e.reject(ki(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=BR(e);if(r)switch(r.type){case n$:this._onResponseMessage(r);break;case ole:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case sle:this._onAbortMessage(r);break;case nle:this._onCloseMessage();break;case ale:this._onOpenPortMessage(r);break;case x8e:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&_T.clients.get(this)===e&&e.destroy(),_T.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n=[],abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let g=0;g<p.length-1;g++)c=c[p[g]],h=c[p[g+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);n.push({client:this,signal:o?o.signal:null}),l=h.apply(c,n)}catch(p){return void this._post({type:n$,jobId:r,error:VR(p)})}qu(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:n$,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),Bn(p)||this._post({type:n$,jobId:r,error:VR(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:n$,jobId:r},l)}_onOpenPortMessage(e){new _T(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,s=>{i.postMessage(s)}),n=OC(e.port,"message",s=>{const o=BR(s);(o==null?void 0:o.type)===da.CLOSE&&(n.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs;if(!s.has(i))return;const o=s.get(i);s.delete(i),this._processWork(),Sr(o.abortHandle),r?o.reject(Y.fromJSON(JSON.parse(r))):o.resolve(n)}_post(e,i,r){return NQ(this._port,e,i,r)}};Rv.kernelInfo={buildDate:Lve,fullVersion:OJ,revision:Dve},Rv.clients=new Map;let E8e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new S5}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,i){return new Promise((r,n)=>{let s=!0;const o=a=>{zt(i.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];qu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Rv(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new Rv(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(ki(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,g8e(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const n=Ho();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:r,resolver:n});for(let s=0;s<this._clientPromises.length;s++){const o=this._clients[s];o?o.jobAdded():this._clientPromises[s].then(a=>a==null?void 0:a.jobAdded())}return n.promise}createInvokeProxy(e){return Nxe(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>Fb(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(i[n]=s.openPort()),--r==0&&e(i)})})}get test(){}};const C8e={async request(t,e){var o,a;const i=t.options,r=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&((o=BH(t.url))!=null&&o.after)?r:"array-buffer";const n=await Br(t.url,i),s={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((a=n.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=new TextEncoder().encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=new TextEncoder().encode(s.data).buffer}return{result:s,transferList:[s.data]}}},M8e={ar:"ar-u-nu-latn"};let VN=new WeakMap,Uxe={};function x7(t){const e=t||Uxe;if(!VN.has(e)){const i=Vc(),r=M8e[Vc()]||i;VN.set(e,new Intl.NumberFormat(r,t))}return VN.get(e)}function HIt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function W3(t,e){return Object.is(t,-0)&&(t=0),x7(e).format(t)}function qIt(t,e=Vc()){var r,n;if(!t)return null;let i=lle.get(e);if(!i){const s=x7().formatToParts(12345.6),o=[...x7({useGrouping:!1}).format(9876543210)].reverse(),a=new Map(o.map((y,w)=>[y,w])),l=new RegExp(`[${(r=s.find(y=>y.type==="group"))==null?void 0:r.value}]`,"g"),c=new RegExp(`[${(n=s.find(y=>y.type==="decimal"))==null?void 0:n.value}]`),h=new RegExp(`[${o.join("")}]`,"g"),p=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,g=/[-\u2212\u2013\u2014\u2015]/g;i=y=>{if((y=y.trim().replaceAll(l,"").replace(c,".").replace(h,b=>String(a.get(b))).replaceAll(p,"").replaceAll(g,"-"))==="")return null;const w=Number(y);return isNaN(w)?null:w},lle.set(e,i)}return i(t)}GJ(()=>{VN=new WeakMap,Uxe={}});const lle=new Map;async function $8e(t,e,i,r){const n=e.exec(i);if(!n)throw new Y("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=dUe(r),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let h;try{h=await cle(t(c))}catch(p){if(c===l)throw new Y("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await cle(t(l))}catch(g){throw new Y("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:g})}}return h}async function cle(t){if(ule.fetchBundleAsset!=null)return ule.fetchBundleAsset(t);const e=await Br(t,{responseType:"text"});return JSON.parse(e.data)}let O8e=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let n;n=typeof r=="string"?s=>new URL(s,new URL(r,window.location.href)).href:r instanceof URL?s=>new URL(s,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return $8e(this.getAssetUrl,this.matcher,e,i)}};function A8e(t){return new O8e(t)}const ule={};hUe(A8e({pattern:"esri/",location:vr}));const hle={};function R8e(t){var i;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((i=t.packages)==null?void 0:i.slice())||[],paths:{...hle.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=hle.baseUrl),e}let I8e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},BN=class{constructor(){this._dispatcher=new I8e,this._workerPostMessage({type:da.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){$E(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){$E(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=BR(e);if(i&&i.type===da.OPEN){const{modulePath:r,jobId:n}=i;let s=await Rv.loadWorker(r);s||(s=await import(r));const o=Rv.connect(s);this._workerPostMessage({type:da.OPENED,jobId:n,data:o})}}};const S7=()=>de.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:P8e}=da,L8e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let QP,KP;const dle="Failed to create Worker. Fallback to execute module in main thread";async function D8e(){if(!pe("esri-workers"))return ple(new BN);if(!QP&&!KP)try{const e=L8e.split("{CONFIGURATION}").join(N8e());QP=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){KP=e||{}}let t;if(QP)try{t=new Worker(QP,{name:"esri-worker-"+F8e++})}catch{S7().warn(dle,KP),t=new BN}else S7().warn(dle,KP),t=new BN;return ple(t)}async function ple(t){return new Promise(e=>{function i(n){const s=BR(n);s&&s.type===P8e&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(n){n.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),S7().warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new BN).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function N8e(){let t;if(Qr.default!=null){const n={...Qr};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(Qr));t.assetsPath=Iu(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Iu(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Vc(),t.has={"esri-csp-restrictions":pe("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":pe("esri-2d-update-debug"),"esri-2d-log-updating":pe("esri-2d-log-updating"),"featurelayer-pbf":pe("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":pe("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":pe("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":pe("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":pe("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":pe("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":pe("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":pe("featurelayer-snapshot-enabled"),"esri-atomics":pe("esri-atomics"),"esri-shared-array-buffer":pe("esri-shared-array-buffer"),"esri-tiles-debug":pe("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":pe("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":pe("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Iu(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Iu(t.workers.workerPath):t.workers.workerPath=Iu(vr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Qr.workers.loaderConfig,i=R8e({baseUrl:e==null?void 0:e.baseUrl,locale:Vc(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:Lve,fullVersion:OJ,revision:Dve}})}let F8e=0;const{ABORT:fle,INVOKE:k8e,OPEN:U8e,OPENED:z8e,RESPONSE:s$}=da;let V8e=class zxe{static async create(e){const i=await D8e();return new zxe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),de.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,n=kxe();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:R3(r,()=>{this._outJobs.delete(n),this._post({type:fle,jobId:n})})};this._outJobs.set(n,a),this._post({type:U8e,jobId:n,modulePath:e})})}_onMessage(e){const i=BR(e);if(i)switch(i.type){case z8e:this._onOpenedMessage(i);break;case s$:this._onResponseMessage(i);break;case fle:this._onAbortMessage(i);break;case k8e:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);n&&(n.controller&&n.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=C8e[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(h){return void this._post({type:s$,jobId:r,error:VR(h)})}qu(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:s$,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Bn(h)||this._post({type:s$,jobId:r,error:VR(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:s$,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Sr(n.abortHandle),n.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Sr(s.abortHandle),r?s.reject(Y.fromJSON(JSON.parse(r))):s.resolve(n))}_post(e,i,r){return NQ(this.worker,e,i,r)}};const mle=pe("host-browser")?Math.min(navigator.hardwareConcurrency-1,pe("workers-pool-size")??8):0;let ab=pe("esri-mobile")?Math.min(mle,3):mle;ab||(ab=pe("safari")&&pe("mac")?7:2);let gle=0;const jN=[];function B8e(){Vxe()}async function eL(t,e){const i=new E8e,{registryTarget:r,...n}=e;return await i.open(t,n),r&&m8e(r,i),i}async function j8e(t,e={}){if(typeof t!="string")throw new Y("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(pe("host-webworker")&&!pe("esri-workers")&&(i="local"),i==="local"){let r=await Rv.loadWorker(t);r||(r=await import(t)),zt(e.signal);const n=e.client||r;return eL([Rv.connect(r,e.schedule)],{...e,client:n})}if(await Vxe(),zt(e.signal),i==="dedicated"){const r=gle++%ab;return eL([await jN[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,ab);if(r<ab){const n=new Array(r);for(let s=0;s<r;++s){const o=gle++%ab;n[s]=jN[o].open(t,e)}return eL(n,e)}}return eL(jN.map(r=>r.open(t,e)),e)}let tL=null;async function Vxe(){if(tL)return tL;new AbortController;const t=[];for(let e=0;e<ab;e++){const i=V8e.create(e).then(r=>(jN[e]=r,r));t.push(i)}return tL=Promise.all(t),tL}function Bxe(t,e){const i=bl(t),r=bl(e),n=i.store,s=r.store,o=r.metadata;for(const a in o){const l=o[a],c=n.originOf(a),h=s.originOf(a);if(!l.readOnly&&h!==Ni.DEFAULTS)if(c===Ni.DEFAULTS)t.set(a,s.get(a));else{const p=n.get(a),g=s.get(a);p&&g&&g instanceof Ne&&p instanceof Ne&&p instanceof g.constructor&&Bxe(p,g)}}}let HA=class extends ot{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ot.ofType(this.itemType.Type))(e):new ot(e)}};function T5(t,e){return{type:t,cast:RJ,set(i){const r=vm(i,this._get(e),t);r.owner=this,this._set(e,r)}}}u([f()],HA.prototype,"owner",null),HA=u([L("esri.core.support.OwningCollection")],HA);function FQ(t,e,i,r){return t!=null&&(xs(e,r)?(xv(i,t),!0):(uc[0]=t[0],uc[1]=t[1],uc[2]=0,!!io(uc,e,0,uc,r,0)&&(i[0]=uc[0],i[1]=uc[1],uc[0]=t[2],uc[1]=t[3],uc[2]=0,!!io(uc,e,0,uc,r,0)&&(i[2]=uc[0],i[3]=uc[1],!0))))}const uc=A();function ec(t,e,i,r){if(tf(t.spatialReference,i)){iL[0]=t.x,iL[1]=t.y;const s=t.z;return iL[2]=s??r??0,io(iL,t.spatialReference,0,e,i,0)}const n=Ov(t,i);return!!n&&(e[0]=n==null?void 0:n.x,e[1]=n==null?void 0:n.y,e[2]=(n==null?void 0:n.z)??r??0,!0)}async function E5(t,e,i,r,n){return await H3(t.spatialReference,i,null,n),ec(t,e,i,r)}const iL=A();let ky=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&$E(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*yle);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,yle));e++)this._items.push(this._allocator())}};const yle=1024;function ut(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jxe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function kQ(t,e,i,r,n,s,o,a,l,c,h,p,g,y,w,b){return[t,e,i,r,n,s,o,a,l,c,h,p,g,y,w,b]}function G8e(t,e){return new Float64Array(t,e,16)}const Js=ut();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Js,clone:jxe,create:ut,createView:G8e,fromValues:kQ},Symbol.toStringTag,{value:"Module"}));function In(){return[1,0,0,0,1,0,0,0,1]}function Gxe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function Hxe(t,e,i,r,n,s,o,a,l){return[t,e,i,r,n,s,o,a,l]}function H8e(t,e){return new Float64Array(t,e,9)}const vx=In();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:vx,clone:Gxe,create:In,createView:H8e,fromValues:Hxe},Symbol.toStringTag,{value:"Module"}));function vd(){return[0,0,0,1]}function q8e(t){return[t[0],t[1],t[2],t[3]]}function W8e(t,e,i,r){return[t,e,i,r]}const UQ=vd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:UQ,clone:q8e,create:vd,fromValues:W8e},Symbol.toStringTag,{value:"Module"}));function Yt(){return[0,0]}function C5(t){return[t[0],t[1]]}function ks(t,e){return[t,e]}function Z8e(t,e=Yt()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Y8e(t,e){return new Float64Array(t,e,2)}function zQ(){return Yt()}function qxe(){return ks(1,1)}function Wxe(){return ks(1,0)}function Zxe(){return ks(0,1)}const Jb=zQ(),Yxe=qxe(),X8e=Wxe(),J8e=Zxe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Yxe,UNIT_X:X8e,UNIT_Y:J8e,ZEROS:Jb,clone:C5,create:Yt,createView:Y8e,fromArray:Z8e,fromValues:ks,ones:qxe,unitX:Wxe,unitY:Zxe,zeros:zQ},Symbol.toStringTag,{value:"Module"}));function Ti(){return[0,0,0,0]}function qU(t){return[t[0],t[1],t[2],t[3]]}function Ri(t,e,i,r){return[t,e,i,r]}function M5(t,e,i,r){return[t,e,i,r]}function VQ(t,e=Ti()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Q8e(t,e){return new Float64Array(t,e,4)}function Xxe(){return Ti()}function Jxe(){return Ri(1,1,1,1)}function Qxe(){return Ri(1,0,0,0)}function Kxe(){return Ri(0,1,0,0)}function eSe(){return Ri(0,0,1,0)}function tSe(){return Ri(0,0,0,1)}const hs=Xxe(),WU=Jxe(),K8e=Qxe(),eHe=Kxe(),tHe=eSe(),iHe=tSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:WU,UNIT_W:iHe,UNIT_X:K8e,UNIT_Y:eHe,UNIT_Z:tHe,ZEROS:hs,clone:qU,create:Ti,createView:Q8e,freeze:M5,fromArray:VQ,fromValues:Ri,ones:Jxe,unitW:tSe,unitX:Qxe,unitY:Kxe,unitZ:eSe,zeros:Xxe},Symbol.toStringTag,{value:"Module"}));let WC=class ew{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&$E(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new ew(Yt)}static createVec3f64(){return new ew(A)}static createVec4f64(){return new ew(Ti)}static createMat3f64(){return new ew(In)}static createMat4f64(){return new ew(ut)}static createQuatf64(){return new ew(vd)}get test(){}};const QIt=WC.createVec2f64(),et=WC.createVec3f64(),BQ=WC.createVec4f64();WC.createMat3f64();const jQ=WC.createMat4f64(),rHe=WC.createQuatf64();function Uy(t){return t?{origin:En(t.origin),vector:En(t.vector)}:{origin:A(),vector:A()}}function iSe(t,e){const i=oHe.get();return i.origin=t,i.vector=e,i}function KIt(t,e=Uy()){return nHe(t.origin,t.vector,e)}function nHe(t,e,i=Uy()){return ye(i.origin,t),ye(i.vector,e),i}function GN(t,e,i=Uy()){return ye(i.origin,t),Ae(i.vector,e,t),i}function rSe(t,e){const i=Ae(et.get(),e,t.origin),r=Te(t.vector,i),n=Te(t.vector,t.vector),s=Oe(r/n,0,1),o=Ae(et.get(),ue(et.get(),t.vector,s),i);return Te(o,o)}function ePt(t,e,i){return T7(t,e,0,1,i)}function tPt(t,e,i){return xe(i,t.origin,ue(i,t.vector,e))}function T7(t,e,i,r,n){const{vector:s,origin:o}=t,a=Ae(et.get(),e,o),l=Te(s,a)/No(s);return ue(n,s,Oe(l,i,r)),xe(n,n,t.origin)}function iPt(t,e){if(nSe(t,iSe(e.origin,e.direction),!1,$5)){const{tA:i,pB:r,distance2:n}=$5;if(i>=0&&i<=1)return n;if(i<0)return to(t.origin,r);if(i>1)return to(xe(et.get(),t.origin,t.vector),r)}return null}function sHe(t,e,i){return!!nSe(t,e,!0,$5)&&(ye(i,$5.pA),!0)}function nSe(t,e,i,r){const s=t.origin,o=xe(et.get(),s,t.vector),a=e.origin,l=xe(et.get(),a,e.vector),c=et.get(),h=et.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=et.get();if(p[0]=o[0]-s[0],p[1]=o[1]-s[1],p[2]=o[2]-s[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],y=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],w=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],b=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],x=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*b-y*y;if(Math.abs(x)<1e-6)return!1;let T=(g*y-w*b)/x,M=(g+y*T)/b;i&&(T=Oe(T,0,1),M=Oe(M,0,1));const $=et.get(),R=et.get();return $[0]=s[0]+T*p[0],$[1]=s[1]+T*p[1],$[2]=s[2]+T*p[2],R[0]=a[0]+M*h[0],R[1]=a[1]+M*h[1],R[2]=a[2]+M*h[2],r.tA=T,r.tB=M,r.pA=$,r.pB=R,r.distance2=to($,R),!0}const $5={tA:0,tB:0,pA:A(),pB:A(),distance2:0},oHe=new ky(()=>Uy());function ed(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function aHe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function _n(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function GQ(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function sSe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function oSe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function aSe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function lHe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function cHe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function uHe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function hHe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function dHe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function KE(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function pHe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function lSe(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+s*s)}function O5(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return i*i+r*r+n*n+s*s}function HQ(t){const e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)}function ZU(t){const e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}function fHe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function mHe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function cSe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=n*o,t[3]=s*o),t}function uSe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function YU(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function gHe(t,e=1){const i=V3;let r,n,s,o,a,l;do r=2*i()-1,n=2*i()-1,a=r*r+n*n;while(a>=1);do s=2*i()-1,o=2*i()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function zc(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,t[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,t[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,t[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,t}function yHe(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*s-l*n,p=c*n+l*r-o*s,g=c*s+o*n-a*r,y=-o*r-a*n-l*s;return t[0]=h*c+y*-o+p*-l-g*-a,t[1]=p*c+y*-a+g*-o-h*-l,t[2]=g*c+y*-l+h*-a-p*-o,t[3]=e[3],t}function _He(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Ob(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Qb(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Bo();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))}const vHe=sSe,wHe=oSe,bHe=aSe,xHe=lSe,SHe=O5,THe=HQ,EHe=ZU,hSe=Object.freeze(Object.defineProperty({__proto__:null,add:GQ,ceil:lHe,copy:ed,copyVec3:aHe,dist:xHe,distance:lSe,div:bHe,divide:aSe,dot:uSe,equals:Qb,exactEquals:Ob,floor:cHe,inverse:mHe,len:THe,length:HQ,lerp:YU,max:hHe,min:uHe,mul:wHe,multiply:oSe,negate:fHe,normalize:cSe,random:gHe,round:dHe,scale:KE,scaleAndAdd:pHe,set:_n,sqrDist:SHe,sqrLen:EHe,squaredDistance:O5,squaredLength:ZU,str:_He,sub:vHe,subtract:sSe,transformMat4:zc,transformQuat:yHe},Symbol.toStringTag,{value:"Module"}));function rPt(t,e,i){const r=Te(t,e)/Te(t,t);return ue(i,t,r)}function uv(t,e){return Te(t,e)/Fe(t)}function qQ(t,e){const i=Te(t,e)/(Fe(t)*Fe(e));return-Ga(i)}function dSe(t,e,i){Me(rL,t),Me(Y6,e);const r=Te(rL,Y6),n=Ga(r),s=Ot(rL,rL,Y6);return Te(s,i)<0?2*Math.PI-n:n}const rL=A(),Y6=A();function eC(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function CHe(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return ve(t,i,r,n),t}function nPt(t,e,i){i=i||t;const r=Te(t,e);ve(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Me(i,i)}function MHe(t,e,i){Math.abs(t[0])>Math.abs(t[1])?ve(e,0,1,0):ve(e,1,0,0),Ot(i,t,e),Ot(e,i,t),Me(i,i),Me(e,e)}function nL(t,e,i,r,n,s){const o=t+(e-t)*n;return o+(i+(r-i)*n-o)*s}function pSe(t,e,i,r=A()){const n=Fe(t),s=Fe(e),o=Te(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*n+i*s)/Math.sin(a),c=l/n*Math.sin((1-i)*a),h=l/s*Math.sin(i*a);return ue(lb,t,c),ue(cb,e,h),xe(r,lb,cb)}return br(r,t,e,i)}function sPt(t,e,i,r=A(),n=A()){const s=Fe(t),o=Fe(e),a=Te(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),g=(1-i)*s+i*o;{const y=g/c,w=y/o*h;ue(lb,t,y/s*p),ue(cb,e,w),xe(r,lb,cb)}{const y=1/s*(-Math.cos((1-i)*l)*l*g+p*(-s+o));ue(lb,t,y);const w=1/o*(Math.cos(i*l)*l*g+h*(-s+o));ue(cb,e,w),xe(n,lb,cb),ue(n,n,1/c)}return n}return br(r,t,e,i),Ae(n,e,t),Me(n,n),n}function XU(t,e,i){t=Me(lb,t),e=Me(cb,e);const r=Ga(Te(t,e));if(i){const n=Ot($He,t,e);if(Te(n,i)<0)return-r}return r}function HN(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const n=t[r-1][0],s=t[r][0],o=(s-i)/(s-n);return o*t[r-1][1]+(1-o)*t[r][1]}}function oPt(t,e,i,r){Ae(_le,e,t),Ae(vle,i,t),Ot(r,_le,vle),Me(r,r),r[3]=-Te(t,r)}function aPt(t,e){if(ve(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)xe(e,e,t[i]);ue(e,e,1/t.length)}}const _le=A(),vle=A(),$He=A(),lb=A(),cb=A();function dn(t=vO){return[t[0],t[1],t[2],t[3]]}function OHe(t=vO[0],e=vO[1],i=vO[2],r=vO[3]){return Yg(t,e,i,r,BQ.get())}function WQ(t,e){return Yg(e[0],e[1],e[2],e[3],t)}function lPt(t){return t}function Yg(t,e,i,r,n=dn()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function fSe(t,e,i){return ye(i,t),i[3]=e,i}function tC(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function bp(t,e,i,r=dn()){const n=i[0]-e[0],s=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=s*c-o*l,p=o*a-n*c,g=n*l-s*a,y=h*h+p*p+g*g,w=Math.abs(y-1)>1e-5&&y>1e-12?1/Math.sqrt(y):1;return r[0]=h*w,r[1]=p*w,r[2]=g*w,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function mSe(t,e,i,r=0,n=Math.floor(i*(1/3)),s=Math.floor(i*(2/3))){if(i<3)return!1;e(o$,r);let o=n,a=!1;for(;o<i-1&&!a;)e(dS,o),o++,a=!Qs(o$,dS);if(!a)return!1;for(o=Math.max(o,s),a=!1;o<i&&!a;)e(Yw,o),o++,Ae(sL,o$,dS),Me(sL,sL),Ae(oL,dS,Yw),Me(oL,oL),a=!Qs(o$,Yw)&&!Qs(dS,Yw)&&Math.abs(Te(sL,oL))<AHe;return a?(bp(o$,dS,Yw,t),!0):(r!==0||n!==1||s!==2)&&mSe(t,e,i,0,1,2)}function cPt(t,e,i=!0){const r=e.length/3;return mSe(t,(n,s)=>ve(n,e[3*s+0],e[3*s+1],e[3*s+2]),i?r-1:r)}const AHe=.99619469809,o$=A(),dS=A(),Yw=A(),sL=A(),oL=A();function E7(t,e,i){return e!==t&&WQ(t,e),t[3]=-Te(t,i),t}function RHe(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function C7(t,e,i,r){return Ot(Yw,e,t),tC(i,Yw,r)}function uPt(t,e,i,r){return JU(Z3(t,e,Ae(et.get(),i,e),FHe,r))}function ZC(t,e,i){return e!=null&&JU(Z3(t,e.origin,e.direction,kHe,i))}function gSe(t,e,i){return JU(Z3(t,e.origin,e.vector,Gp.NONE,i))}function IHe(t,e,i){return JU(Z3(t,e.origin,e.vector,Gp.CLAMP,i))}function A5(t,e){return us(t,e)>=0}function PHe(t,e){const i=Te(t,e.ray.direction),r=-us(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function LHe(t,e){const i=Te(t,e.ray.direction),r=-us(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function DHe(t,e,i){const r=ue(et.get(),t,-t[3]),n=NHe(t,Ae(et.get(),e,r),et.get());return xe(i,n,r),i}function hPt(t,e,i,r){const n=t,s=et.get(),o=et.get();MHe(n,s,o);const a=Ae(et.get(),i,e),l=uv(s,a),c=uv(o,a),h=uv(n,a);return ve(r,l,c,h)}function NHe(t,e,i){const r=ue(et.get(),t,Te(t,e));return Ae(i,e,r),i}function dPt(t,e){return Math.abs(us(t,e))}function us(t,e){return Te(t,e)+t[3]}var ql;function JU(t){return t===ql.INTERSECTS_INSIDE_OUT||t===ql.INTERSECTS_OUTSIDE_IN}function Z3(t,e,i,r,n){const s=Te(t,i),o=us(t,e);if(s===0)return o>=0?ql.INSIDE:ql.OUTSIDE;let a=-o/s;return r&Gp.CLAMP&&(a=Oe(a,0,1)),!(r&Gp.INFINITE_MIN)&&a<0||!(r&Gp.INFINITE_MAX)&&a>1?o>=0?ql.INSIDE:ql.OUTSIDE:(xe(n,e,ue(n,i,a)),o>=0?ql.INTERSECTS_INSIDE_OUT:ql.INTERSECTS_OUTSIDE_IN)}(function(t){t[t.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",t[t.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",t[t.INSIDE=2]="INSIDE",t[t.OUTSIDE=3]="OUTSIDE"})(ql||(ql={}));const vO=[0,0,1,0];var Gp;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Gp||(Gp={}));const FHe=Gp.INFINITE_MIN|Gp.INFINITE_MAX,kHe=Gp.INFINITE_MAX;function qv(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function UHe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function QU(t,e,i,r,n,s,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function ZQ(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wx(t,e){if(t===e){const i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function YC(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=h*o-a*c,g=-h*s+a*l,y=c*s-o*l;let w=i*p+r*g+n*y;return w?(w=1/w,t[0]=p*w,t[1]=(-h*r+n*c)*w,t[2]=(a*r-n*o)*w,t[3]=g*w,t[4]=(h*i-n*l)*w,t[5]=(-a*i+n*s)*w,t[6]=y*w,t[7]=(-c*i+r*l)*w,t[8]=(o*i-r*s)*w,t):null}function zHe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=n*c-r*h,t[2]=r*a-n*o,t[3]=a*l-s*h,t[4]=i*h-n*l,t[5]=n*s-i*a,t[6]=s*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*s,t}function VHe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+i*(-c*n+o*a)+r*(l*n-s*a)}function KU(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],g=i[0],y=i[1],w=i[2],b=i[3],x=i[4],T=i[5],M=i[6],$=i[7],R=i[8];return t[0]=g*r+y*o+w*c,t[1]=g*n+y*a+w*h,t[2]=g*s+y*l+w*p,t[3]=b*r+x*o+T*c,t[4]=b*n+x*a+T*h,t[5]=b*s+x*l+T*p,t[6]=M*r+$*o+R*c,t[7]=M*n+$*a+R*h,t[8]=M*s+$*l+R*p,t}function jR(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],g=i[0],y=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=g*r+y*o+c,t[7]=g*n+y*a+h,t[8]=g*s+y*l+p,t}function YQ(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],g=Math.sin(i),y=Math.cos(i);return t[0]=y*r+g*o,t[1]=y*n+g*a,t[2]=y*s+g*l,t[3]=y*o-g*r,t[4]=y*a-g*n,t[5]=y*l-g*s,t[6]=c,t[7]=h,t[8]=p,t}function ez(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function BHe(t,e,i){const r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function jHe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function GHe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function HHe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function qHe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function GR(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,h=r*o,p=r*a,g=n*o,y=n*a,w=n*l,b=s*o,x=s*a,T=s*l;return t[0]=1-p-w,t[3]=h-T,t[6]=g+x,t[1]=h+T,t[4]=1-c-w,t[7]=y-b,t[2]=g-x,t[5]=y+b,t[8]=1-c-p,t}function ySe(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],p=h*o-a*c,g=-h*s+a*l,y=c*s-o*l,w=i*p+r*g+n*y;if(!w)return null;const b=1/w;return t[0]=p*b,t[1]=(-h*r+n*c)*b,t[2]=(a*r-n*o)*b,t[3]=g*b,t[4]=(h*i-n*l)*b,t[5]=(-a*i+n*s)*b,t[6]=y*b,t[7]=(-c*i+r*l)*b,t[8]=(o*i-r*s)*b,t}function _Se(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],g=e[10],y=e[11],w=e[12],b=e[13],x=e[14],T=e[15],M=i*a-r*o,$=i*l-n*o,R=i*c-s*o,I=r*l-n*a,P=r*c-s*a,N=n*c-s*l,V=h*b-p*w,U=h*x-g*w,B=h*T-y*w,W=p*x-g*b,j=p*T-y*b,Q=g*T-y*x;let Z=M*Q-$*j+R*W+I*B-P*U+N*V;return Z?(Z=1/Z,t[0]=(a*Q-l*j+c*W)*Z,t[1]=(l*B-o*Q-c*U)*Z,t[2]=(o*j-a*B+c*V)*Z,t[3]=(n*j-r*Q-s*W)*Z,t[4]=(i*Q-n*B+s*U)*Z,t[5]=(r*B-i*j-s*V)*Z,t[6]=(b*N-x*P+T*I)*Z,t[7]=(x*R-w*N-T*$)*Z,t[8]=(w*P-b*R+T*M)*Z,t):null}function WHe(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function ZHe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function YHe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function XHe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function vSe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function JHe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function QHe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function KHe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function e9e(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=e[0],g=e[1],y=e[2],w=e[3],b=e[4],x=e[5],T=e[6],M=e[7],$=e[8],R=Bo();return Math.abs(i-p)<=R*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-g)<=R*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-y)<=R*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-w)<=R*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-b)<=R*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-x)<=R*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-T)<=R*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-M)<=R*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(h-$)<=R*Math.max(1,Math.abs(h),Math.abs($))}function t9e(t){const e=Bo(),i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+h*h))<=e}const i9e=KU,r9e=vSe;Object.freeze(Object.defineProperty({__proto__:null,add:XHe,adjoint:zHe,copy:UHe,determinant:VHe,equals:e9e,exactEquals:KHe,frob:YHe,fromMat2d:qHe,fromMat4:qv,fromQuat:GR,fromRotation:GHe,fromScaling:HHe,fromTranslation:jHe,identity:ZQ,invert:YC,isOrthoNormal:t9e,mul:i9e,multiply:KU,multiplyScalar:JHe,multiplyScalarAndAdd:QHe,normalFromMat4:_Se,normalFromMat4Legacy:ySe,projection:WHe,rotate:YQ,scale:ez,scaleByVec2:BHe,set:QU,str:ZHe,sub:r9e,subtract:vSe,translate:jR,transpose:wx},Symbol.toStringTag,{value:"Module"}));function zs(t){return t?wle(En(t.origin),En(t.direction)):wle(A(),A())}function wle(t,e){return{origin:t,direction:e}}function pPt(t,e){return ym(t.origin,e.origin)&&ym(t.direction,e.direction)}function rf(t,e){const i=o9e.get();return i.origin=t,i.direction=e,i}function R5(t,e=zs()){return tz(t.origin,t.direction,e)}function wSe(t,e,i=zs()){return ye(i.origin,t),Ae(i.direction,e,t),i}function tz(t,e,i=zs()){return ye(i.origin,t),ye(i.direction,e),i}function n9e(t,e){const i=Ot(et.get(),Me(et.get(),t.direction),Ae(et.get(),e,t.origin));return Te(i,i)}function s9e(t,e,i){const r=Te(t.direction,Ae(i,e,t.origin));return xe(i,t.origin,ue(i,t.direction,r)),i}function fPt(t,e,i,r){const n=t.origin,s=e.origin,o=t.direction,a=e.direction,l=Te(Me(J6,o),Me(ble,a));if(Math.abs(l)>=1)return null;const c=Ot(J6,o,a),h=nr(X6,s,n),p=QU(xle,o[0],o[1],o[2],-a[0],-a[1],-a[2],c[0],c[1],c[2]),g=YC(xle,p);if(g==null)return[i,r];const y=Te(ve(J6,g[0],g[3],g[6]),h),w=Te(ve(ble,g[1],g[4],g[7]),h);return xe(i,n,ue(X6,o,y)),xe(r,s,ue(X6,a,w)),[i,r]}const o9e=new ky(()=>zs()),X6=A(),J6=A(),ble=A(),xle=In(),Q6=()=>de.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let a9e=class{constructor(){this.plane=dn(),this.origin=A(),this.basis1=A(),this.basis2=A()}};const bSe=a9e;function Wv(t=ISe){return{plane:dn(t.plane),origin:En(t.origin),basis1:En(t.basis1),basis2:En(t.basis2)}}function l9e(t,e,i){const r=x9e.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=OHe(0,0,0,0),iz(r),r}function bx(t,e=Wv()){return XQ(t.origin,t.basis1,t.basis2,e)}function c9e(t,e){ye(e.origin,t.origin),ye(e.basis1,t.basis1),ye(e.basis2,t.basis2),WQ(e.plane,t.plane)}function XQ(t,e,i,r=Wv()){return ye(r.origin,t),ye(r.basis1,e),ye(r.basis2,i),iz(r),w9e(r,"fromValues()"),r}function iz(t){C7(t.basis2,t.basis1,t.origin,t.plane)}function xSe(t,e,i){t!==i&&bx(t,i);const r=ue(et.get(),by(t),e);return xe(i.origin,i.origin,r),i.plane[3]-=e,i}function u9e(t,e,i){return SSe(e,i),xSe(i,eK(t,t.origin),i),i}function h9e(t,e){const i=t.basis1[0],r=t.basis2[1],[n,s]=t.origin;return lQ(n-i,s-r,n+i,s+r,e)}function SSe(t,e=Wv()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return ve(e.origin,t[0]+i,t[1]+r,0),ve(e.basis1,i,0,0),ve(e.basis2,0,r,0),Yg(0,0,1,0,e.plane),e}function JQ(t,e,i){return!!ZC(t.plane,e,i)&&ASe(t,i)}function d9e(t,e,i){if(JQ(t,e,i))return i;const r=TSe(t,e,et.get());return xe(i,e.origin,ue(et.get(),e.direction,Nr(e.origin,r)/Fe(e.direction))),i}function TSe(t,e,i){const r=I5.get();RSe(t,e,r,I5.get());let n=Number.POSITIVE_INFINITY;for(const s of iK){const o=tK(t,s,rz.get()),a=et.get();if(gSe(r,o,a)){const l=_x(et.get(),e.origin,a),c=Math.abs(Ga(Te(e.direction,l)));c<n&&(n=c,ye(i,a))}}return n===Number.POSITIVE_INFINITY?CSe(t,e,i):i}function ESe(t,e){return(e-t)/e}function CSe(t,e,i){if(JQ(t,e,i))return i;const r=I5.get(),n=I5.get();RSe(t,e,r,n);let s=Number.POSITIVE_INFINITY;for(const o of iK){const a=tK(t,o,rz.get()),l=et.get();if(IHe(r,a,l)){const c=n9e(e,l);if(!A5(n,l))continue;c<s&&(s=c,ye(i,l))}}return QQ(t,e.origin)<s&&MSe(t,e.origin,i),i}function MSe(t,e,i){const r=DHe(t.plane,e,et.get()),n=T7(Sle(t,t.basis1),r,-1,1,et.get()),s=T7(Sle(t,t.basis2),r,-1,1,et.get());return Ae(i,xe(et.get(),n,s),t.origin),i}function $Se(t,e,i){const{origin:r,basis1:n,basis2:s}=t,o=Ae(et.get(),e,r),a=uv(n,o),l=uv(s,o),c=uv(by(t),o);return ve(i,a,l,c)}function QQ(t,e){const i=$Se(t,e,et.get()),{basis1:r,basis2:n}=t,s=Fe(r),o=Fe(n),a=Math.max(Math.abs(i[0])-s,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function p9e(t,e){return Math.sqrt(QQ(t,e))}function f9e(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of iK){const n=tK(t,r,rz.get()),s=rSe(n,e);s>i&&(i=s)}return Math.sqrt(i)}function KQ(t,e){return A5(t.plane,e)&&ASe(t,e)}function m9e(t,e,i,r){return v9e(t,i,r)}function eK(t,e){const i=-t.plane[3];return uv(by(t),e)-i}function g9e(t,e,i,r){const n=eK(t,e),s=ue(b9e,by(t),i-n);return xe(r,e,s),r}function y9e(t,e){return Qs(t.basis1,e.basis1)&&Qs(t.basis2,e.basis2)&&Qs(t.origin,e.origin)}function OSe(t,e,i){return t!==i&&bx(t,i),Yl(pS,e),Gc(pS,pS),Mt(i.basis1,t.basis1,pS),Mt(i.basis2,t.basis2,pS),Mt(i.plane,t.plane,pS),Mt(i.origin,t.origin,e),E7(i.plane,i.plane,i.origin),i}function _9e(t,e,i,r){return t!==r&&bx(t,r),dd(K6,e,i),Mt(r.basis1,t.basis1,K6),Mt(r.basis2,t.basis2,K6),iz(r),r}function by(t){return t.plane}function v9e(t,e,i){switch(e){case wl.X:ye(i,t.basis1),Me(i,i);break;case wl.Y:ye(i,t.basis2),Me(i,i);break;case wl.Z:ye(i,by(t))}return i}function ASe(t,e){const i=Ae(et.get(),e,t.origin),r=No(t.basis1),n=No(t.basis2),s=Te(t.basis1,i),o=Te(t.basis2,i);return-s-r<0&&s-r<0&&-o-n<0&&o-n<0}function Sle(t,e){const i=rz.get();return ye(i.origin,t.origin),ye(i.vector,e),i}function tK(t,e,i){const{basis1:r,basis2:n,origin:s}=t,o=ue(et.get(),r,e.origin[0]),a=ue(et.get(),n,e.origin[1]);xe(i.origin,o,a),xe(i.origin,i.origin,s);const l=ue(et.get(),r,e.direction[0]),c=ue(et.get(),n,e.direction[1]);return ue(i.vector,xe(l,l,c),2),i}function w9e(t,e){Math.abs(Te(t.basis1,t.basis2)/(Fe(t.basis1)*Fe(t.basis2)))>1e-6&&Q6().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Te(t.basis1,by(t)))>1e-6&&Q6().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Te(by(t),t.origin)-t.plane[3])>1e-6&&Q6().warn(e,"Plane offset is not consistent with plane origin")}function RSe(t,e,i,r){const n=by(t);C7(n,e.direction,e.origin,i),C7(i,n,e.origin,r)}const ISe={plane:dn(),origin:Qe(0,0,0),basis1:Qe(1,0,0),basis2:Qe(0,1,0)},I5=new ky(dn),rz=new ky(Uy),b9e=A(),x9e=new ky(()=>Wv()),iK=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],pS=ut(),K6=ut(),S9e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:bSe,altitudeAt:eK,axisAt:m9e,cameraFrustumCoverage:ESe,closestPoint:CSe,closestPointOnSilhouette:TSe,copy:bx,copyWithoutVerify:c9e,create:Wv,distance:p9e,distance2:QQ,distanceToSilhouette:f9e,elevate:xSe,equals:y9e,extrusionContainsPoint:KQ,fromAABoundingRect:SSe,fromValues:XQ,getExtent:h9e,intersectRay:JQ,intersectRayClosestSilhouette:d9e,normal:by,projectPoint:MSe,projectPointLocal:$Se,rotate:_9e,setAltitudeAt:g9e,setExtent:u9e,transform:OSe,up:ISe,updateUnboundedPlane:iz,wrap:l9e},Symbol.toStringTag,{value:"Module"})),T9e=new nt(e1e),w2=new nt(gU),b2=new nt(yU),gPt=new nt(t1e);function Iv(t){const e=Tle.get(t);if(e)return e;let i=T9e;if(t)if(t===w2)i=w2;else if(t===b2)i=b2;else{const r=t.wkid,n=t.latestWkid;if(r!=null||n!=null)PE(r)||PE(n)?i=w2:(LE(r)||LE(n))&&(i=b2);else{const s=t.wkt2??t.wkt;if(s){const o=s.toUpperCase();o===E9e?i=w2:o===C9e&&(i=b2)}}}return Tle.set(t,i),i}const Tle=new Map,E9e=w2.wkt.toUpperCase(),C9e=b2.wkt.toUpperCase();function Ele(t,e){const i=Fe(t),r=cd(t[2]/i),n=Math.atan2(t[1]/i,t[0]/i);return ve(e,i,r,n),e}const PSe=Pn();function Pn(){return Ti()}const M9e=Qb,$9e=Qb;function Kb(t,e){return ed(e,t)}function LSe(t,e){return Ri(t[0],t[1],t[2],e)}function O9e(t){return t}function A9e(t){t[0]=t[1]=t[2]=t[3]=0}function XC(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function uy(t){return t[3]}function R9e(t){return t}function DSe(t,e,i,r){return Ri(t,e,i,r)}function I9e(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function P9e(t,e,i){return t!==i&&Kb(t,i),i}function L9e(t,e){return e}function Zv(t,e,i){if(e==null||!NSe(t,e,P5))return!1;let{t0:r,t1:n}=P5;if((r<0||n<r&&n>0)&&(r=n),r<0)return!1;if(i){const{origin:s,direction:o}=e;i[0]=s[0]+o[0]*r,i[1]=s[1]+o[1]*r,i[2]=s[2]+o[2]*r}return!0}function D9e(t,e,i){const r=wSe(e,i);if(!NSe(t,r,P5))return[];const{origin:n,direction:s}=r,{t0:o,t1:a}=P5,l=c=>{const h=A();return Us(h,n,s,c),nK(t,h,h)};return Math.abs(o-a)<Bo()?[l(o)]:[l(o),l(a)]}const P5={t0:0,t1:0};function NSe(t,e,i){const{origin:r,direction:n}=e,s=N9e;s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const N9e=A();function M7(t,e){return Zv(t,e,null)}function F9e(t,e,i){if(Zv(t,e,i))return i;const r=JC(t,e,et.get());return xe(i,e.origin,ue(et.get(),e.direction,Nr(e.origin,r)/Fe(e.direction))),i}function JC(t,e,i){const r=et.get(),n=jQ.get();Ot(r,e.origin,e.direction);const s=uy(t);Ot(i,r,e.origin),ue(i,i,1/Fe(i)*s);const o=kSe(t,e.origin),a=qQ(e.origin,i);return dd(n,a+o,r),Mt(i,i,n),i}function rK(t,e,i,r){const n=uy(t),s=n*n,o=e+.5*Math.PI,a=i*i+s-2*Math.cos(o)*i*n,l=Math.sqrt(a),c=a-s;if(c<=0)return .5;const h=Math.sqrt(c),p=Math.acos(h/l)-Math.asin(n/(l/Math.sin(o)));return Math.min(1,(p+.5*r)/r)}function k9e(t,e,i){return Zv(t,e,i)?i:(s9e(e,t,i),nK(t,i,i))}function nK(t,e,i){const r=Ae(et.get(),e,t),n=ue(et.get(),r,t[3]/Fe(r));return xe(i,n,t)}function FSe(t,e){const i=Ae(et.get(),e,t),r=No(i),n=t[3]*t[3];return Math.sqrt(Math.abs(r-n))}function kSe(t,e){const i=Ae(et.get(),e,t),r=Fe(i),n=uy(t),s=n+Math.abs(n-r);return Ga(n/s)}const ej=A();function USe(t,e,i,r){const n=Ae(ej,e,t);switch(i){case wl.X:{const s=Ele(n,ej)[2];return ve(r,-Math.sin(s),Math.cos(s),0)}case wl.Y:{const s=Ele(n,ej),o=s[1],a=s[2],l=Math.sin(o);return ve(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case wl.Z:return Me(r,n);default:return}}function zSe(t,e){const i=Ae($7,e,t);return Fe(i)-t[3]}function U9e(t,e,i,r){const n=zSe(t,e),s=USe(t,e,wl.Z,$7),o=ue($7,s,i-n);return xe(r,e,o)}function z9e(t,e){const i=to(t,e),r=uy(t);return i<=r*r}function V9e(t,e,i=Ti()){const r=Nr(t,e),n=t[3],s=e[3];return r+s<n?(ed(i,t),i):r+n<s?(ed(i,e),i):(br(i,t,e,(r+s-n)/(2*r)),i[3]=(r+n+s)/2,i)}const $7=A(),nz=Pn(),B9e=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:PSe,altitudeAt:zSe,angleToSilhouette:kSe,axisAt:USe,cameraFrustumCoverage:rK,clear:A9e,closestPoint:k9e,closestPointOnSilhouette:JC,containsPoint:z9e,copy:Kb,create:Pn,distanceToSilhouette:FSe,elevate:I9e,equals:$9e,exactEquals:M9e,fromCenterAndRadius:LSe,fromRadius:XC,fromValues:DSe,getCenter:R9e,getExtent:L9e,getRadius:uy,intersectLine:D9e,intersectRay:Zv,intersectRayClosestSilhouette:F9e,intersectsRay:M7,projectPoint:nK,setAltitudeAt:U9e,setExtent:P9e,tmpSphere:nz,union:V9e,wrap:O9e},Symbol.toStringTag,{value:"Module"}));function j9e(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function G9e(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function H9e(t,e){return t.operations.getExtent(t.value,e),e}function q9e(t){return{operations:t,value:t.create()}}function VSe(t,e,i=q9e(t)){return i.operations=t,t.copy(e,i.value),i}function W9e(t){return VSe(B9e,DSe(0,0,0,xr(t).radius))}const Cle=2**50;function Z9e(){return VSe(S9e,XQ([0,0,0],[Cle,0,0],[0,Cle,0]))}function Y9e(t,e,i){return t.operations.axisAt(t.value,e,wl.Z,i)}function X9e(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function J9e(t,e,i){return t.operations.intersectRay(t.value,e,i)}function Q9e(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function K9e(t,e){return t.operations.altitudeAt(t.value,e)}function BSe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function e7e(t,e,i,r){return e!==r&&ps(r,e),ve(fS,r[12],r[13],r[14]),BSe(t,fS,i,fS),r[12]=fS[0],r[13]=fS[1],r[14]=fS[2],r}function tj(t,e,i){return t.operations.elevate(t.value,e,i.value)}const fS=A();function Mle(t,e,i,r,n){return n[0]=Te(t,e),n[1]=Te(t,i),n[2]=Te(t,r),n}function O7(t,e,i,r,n){ye(i,t),ye(aL,e),Me(aL,aL),Ot(r,aL,i),Ot(n,r,i)}function t7e(t,e){return t?Iv(e):e.isGeographic?nt.PlateCarree:e}const aL=A(),sK=96;function yPt(t,e){const i=t.extent,r=t.width,n=Ql(i==null?void 0:i.spatialReference);return i&&r?i.width/r*n*kJ*sK:0}function i7e(t,e){return t/(Ql(e)*kJ*sK)}function r7e(t){return t/(kJ*sK)}function _Pt(t,e,i){return n7e(t,e)&&s7e(t,i)}function n7e(t,e){return e===0||lv(t,e)||t<e}function s7e(t,e){return e===0||lv(t,e)||t>e}let iC=class extends HA{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(de.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};iC=u([L("esri.support.AnalysesCollection")],iC);const qN={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],n=this.values;return r>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},ij={xsmall:544,small:768,medium:992,large:1200};function o7e(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function rj(t,e){return e?qN[t].valueToClassName[e].split(" "):[]}const a7e=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=ij}initialize(){this.addHandles(oe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Si))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!o7e(i)){const r=JSON.stringify(ij,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=ij}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=Ic.acquire(),r=Ic.acquire();let n,s=!1;for(n in qN){const o=this[n],a=qN[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,rj(n,o).forEach(l=>r.push(l)),rj(n,a).forEach(l=>i.push(l)))}s&&(this._applyClassNameChanges(i,r),Ic.release(i),Ic.release(r))}_applyClassNameChanges(i,r){const n=this.container;n&&(r.forEach(s=>n.classList.remove(s)),i.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in qN)rj(r,this[r]).forEach(n=>i.classList.remove(n))}};return u([f()],e.prototype,"breakpoints",null),u([f()],e.prototype,"orientation",void 0),u([f()],e.prototype,"widthBreakpoint",void 0),u([f()],e.prototype,"heightBreakpoint",void 0),e=u([L("esri.views.BreakpointsOwner")],e),e};let hv=class extends Ne{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,oe)}addWhen(e,i,r={}){return this._installWatch(e,i,r,Kl)}addOnCollectionChange(e,i,{initial:r=!1,final:n=!1}={}){const s=++this._handleId;return this.addHandles([Vo(e,"after-changes",this._createSyncUpdatingCallback(),xi),Vo(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>i({added:[],removed:o.toArray()}):void 0})],s),Ui(()=>this.removeHandles(s))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Ui(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(lL)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},n){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,i,r);return this.addHandles(o,s),Ui(()=>this.removeHandles(s))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),n=oe(e,r,{sync:!0,equals:()=>!1});return this.addHandles(n,i),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(lL),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(AC(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(lL))}),lL)}}};u([f({readOnly:!0})],hv.prototype,"updating",void 0),hv=u([L("esri.core.support.UpdatingHandles")],hv);const lL=-42;/*!
 * @esri/arcgis-html-sanitizer - v4.1.0-next.3 - Wed Sep 25 2024 10:04:57 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var L5=function(){return L5=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},L5.apply(this,arguments)},A7={exports:{}},Ss={},R7={exports:{}},xx={};function jSe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function l7e(t,e,i){}function c7e(t,e,i){}var u7e=/javascript\s*\:/img;function h7e(t,e){return u7e.test(e)?"":e}xx.whiteList=jSe();xx.getDefaultWhiteList=jSe;xx.onAttr=l7e;xx.onIgnoreAttr=c7e;xx.safeAttrValue=h7e;var d7e={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},a$=d7e;function p7e(t,e){t=a$.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,n=0,s=0,o="";function a(){if(!r){var h=a$.trim(t.slice(n,s)),p=h.indexOf(":");if(p!==-1){var g=a$.trim(h.slice(0,p)),y=a$.trim(h.slice(p+1));if(g){var w=e(n,o.length,g,y,h);w&&(o+=w+"; ")}}}n=s+1}for(;s<i;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return a$.trim(o)}var f7e=p7e,cL=xx,m7e=f7e;function $le(t){return t==null}function g7e(t){var e={};for(var i in t)e[i]=t[i];return e}function GSe(t){t=g7e(t||{}),t.whiteList=t.whiteList||cL.whiteList,t.onAttr=t.onAttr||cL.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||cL.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||cL.safeAttrValue,this.options=t}GSe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onAttr,s=i.onIgnoreAttr,o=i.safeAttrValue,a=m7e(t,function(l,c,h,p,g){var y=r[h],w=!1;if(y===!0?w=y:typeof y=="function"?w=y(p):y instanceof RegExp&&(w=y.test(p)),w!==!0&&(w=!1),p=o(h,p),!!p){var b={position:c,sourcePosition:l,source:g,isWhite:w};if(w){var x=n(h,p,b);return $le(x)?h+":"+p:x}else{var x=s(h,p,b);if(!$le(x))return x}}});return a};var y7e=GSe;(function(t,e){var i=xx,r=y7e;function n(o,a){var l=new r(a);return l.process(o)}e=t.exports=n,e.FilterCSS=r;for(var s in i)e[s]=i[s]})(R7,R7.exports);var oK=R7.exports,aK={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},_7e=oK.FilterCSS,v7e=oK.getDefaultWhiteList,D5=aK;function HSe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var qSe=new _7e;function w7e(t,e,i){}function b7e(t,e,i){}function x7e(t,e,i){}function S7e(t,e,i){}function WSe(t){return t.replace(E7e,"&lt;").replace(C7e,"&gt;")}function T7e(t,e,i,r){if(i=KSe(i),e==="href"||e==="src"){if(i=D5.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(uL.lastIndex=0,uL.test(i))return""}else if(e==="style"){if(Ole.lastIndex=0,Ole.test(i)||(Ale.lastIndex=0,Ale.test(i)&&(uL.lastIndex=0,uL.test(i))))return"";r!==!1&&(r=r||qSe,i=r.process(i))}return i=eTe(i),i}var E7e=/</g,C7e=/>/g,M7e=/"/g,$7e=/&quot;/g,O7e=/&#([a-zA-Z0-9]*);?/gim,A7e=/&colon;?/gim,R7e=/&newline;?/gim,uL=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Ole=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Ale=/u\s*r\s*l\s*\(.*/gi;function ZSe(t){return t.replace(M7e,"&quot;")}function YSe(t){return t.replace($7e,'"')}function XSe(t){return t.replace(O7e,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function JSe(t){return t.replace(A7e,":").replace(R7e," ")}function QSe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return D5.trim(e)}function KSe(t){return t=YSe(t),t=XSe(t),t=JSe(t),t=QSe(t),t}function eTe(t){return t=ZSe(t),t=WSe(t),t}function I7e(){return""}function P7e(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:D5.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return n.push([s!==!1?s:l.position,h]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return D5.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function L7e(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var n=t.indexOf("-->",r);if(n===-1)break;i=n+3}return e}function D7e(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}Ss.whiteList=HSe();Ss.getDefaultWhiteList=HSe;Ss.onTag=w7e;Ss.onIgnoreTag=b7e;Ss.onTagAttr=x7e;Ss.onIgnoreTagAttr=S7e;Ss.safeAttrValue=T7e;Ss.escapeHtml=WSe;Ss.escapeQuote=ZSe;Ss.unescapeQuote=YSe;Ss.escapeHtmlEntities=XSe;Ss.escapeDangerHtml5Entities=JSe;Ss.clearNonPrintableCharacter=QSe;Ss.friendlyAttrValue=KSe;Ss.escapeAttrValue=eTe;Ss.onIgnoreTagStripAll=I7e;Ss.StripTagBody=P7e;Ss.stripCommentTag=L7e;Ss.stripBlankChar=D7e;Ss.cssFilter=qSe;Ss.getDefaultCSSWhiteList=v7e;var sz={},I_=aK;function N7e(t){var e=I_.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=I_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function F7e(t){return t.slice(0,2)==="</"}function k7e(t,e,i){var r="",n=0,s=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(s===!1){if(p==="<"){s=a;continue}}else if(o===!1){if(p==="<"){r+=i(t.slice(n,a)),s=a,n=a;continue}if(p===">"){r+=i(t.slice(n,s)),h=t.slice(s,a+1),c=N7e(h),r+=e(s,r.length,c,h,F7e(h)),n=a+1,s=!1;continue}if(p==='"'||p==="'")for(var g=1,y=t.charAt(a-g);y.trim()===""||y==="=";){if(y==="="){o=p;continue e}y=t.charAt(a-++g)}}else if(p===o){o=!1;continue}}return n<t.length&&(r+=i(t.substr(n))),r}var U7e=/[^a-zA-Z0-9\\_:.-]/gim;function z7e(t,e){var i=0,r=0,n=[],s=!1,o=t.length;function a(g,y){if(g=I_.trim(g),g=g.replace(U7e,"").toLowerCase(),!(g.length<1)){var w=e(g,y||"");w&&n.push(w)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,p;if(s===!1&&c==="="){s=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:B7e(t,l+1);continue}if(s!==!1&&l===r){if(p=t.indexOf(c,l+1),p===-1)break;h=I_.trim(t.slice(r+1,p)),a(s,h),s=!1,l=p,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(p=V7e(t,l),p===-1){h=I_.trim(t.slice(i,l)),a(h),s=!1,i=l+1;continue}else{l=p-1;continue}else if(p=j7e(t,l-1),p===-1){h=I_.trim(t.slice(i,l)),h=Rle(h),a(s,h),s=!1,i=l+1;continue}else continue}return i<t.length&&(s===!1?a(t.slice(i)):a(s,Rle(I_.trim(t.slice(i))))),I_.trim(n.join(" "))}function V7e(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function B7e(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function j7e(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function G7e(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Rle(t){return G7e(t)?t.substr(1,t.length-2):t}sz.parseTag=k7e;sz.parseAttr=z7e;var H7e=oK.FilterCSS,fp=Ss,tTe=sz,q7e=tTe.parseTag,W7e=tTe.parseAttr,WN=aK;function hL(t){return t==null}function Z7e(t){var e=WN.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=WN.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=WN.trim(t.slice(0,-1))),{html:t,closing:i}}function Y7e(t){var e={};for(var i in t)e[i]=t[i];return e}function X7e(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function iTe(t){t=Y7e(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=fp.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=X7e(t.whiteList||t.allowList):t.whiteList=fp.whiteList,t.onTag=t.onTag||fp.onTag,t.onTagAttr=t.onTagAttr||fp.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||fp.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||fp.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||fp.safeAttrValue,t.escapeHtml=t.escapeHtml||fp.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new H7e(t.css))}iTe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onTag,s=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=e.cssFilter;i.stripBlankChar&&(t=fp.stripBlankChar(t)),i.allowCommentTag||(t=fp.stripCommentTag(t));var p=!1;i.stripIgnoreTagBody&&(p=fp.StripTagBody(i.stripIgnoreTagBody,s),s=p.onIgnoreTag);var g=q7e(t,function(y,w,b,x,T){var M={sourcePosition:y,position:w,isClosing:T,isWhite:Object.prototype.hasOwnProperty.call(r,b)},$=n(b,x,M);if(!hL($))return $;if(M.isWhite){if(M.isClosing)return"</"+b+">";var R=Z7e(x),I=r[b],P=W7e(R.html,function(N,V){var U=WN.indexOf(I,N)!==-1,B=o(b,N,V,U);return hL(B)?U?(V=l(b,N,V,h),V?N+'="'+V+'"':N):(B=a(b,N,V,U),hL(B)?void 0:B):B});return x="<"+b,P&&(x+=" "+P),R.closing&&(x+=" /"),x+=">",x}else return $=s(b,x,M),hL($)?c(x):$},c);return p&&(g=p.remove(g)),g};var J7e=iTe;(function(t,e){var i=Ss,r=sz,n=J7e;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(A7,A7.exports);var mS=A7.exports,Q7e=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},K7e=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],del:["style"],details:["open","style"],div:["align","aria-hidden","aria-label","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["aria-hidden","aria-label","style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=L5(L5({},mS.getDefaultCSSWhiteList()),{"align-items":!0,"align-self":!0,flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,float:!0,gap:!0,grid:!0,"grid-area":!0,"grid-auto-columns":!0,"grid-auto-flow":!0,"grid-auto-rows":!0,"grid-column":!0,"grid-column-end":!0,"grid-column-start":!0,"grid-row":!0,"grid-row-end":!0,"grid-row-start":!0,"grid-template":!0,"grid-template-areas":!0,"grid-template-columns":!0,"grid-template-rows":!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"line-height":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?r.sanitizeUrl(a):mS.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!i?n=e:e&&i?(n=Object.create(this.arcgisFilterOptions),n.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(s){if(s==="whiteList")n.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(s==="css"){var o=e.css.whiteList;o!=null&&e.css instanceof Object&&Object.keys(o).forEach(function(a){return n.css.whiteList[a]=o[a]})}else n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList,n.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=n,this._xssFilter=new mS.FilterXSS(n)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,n=r===void 0?!0:r,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?mS.escapeAttrValue(e):!s&&!n?mS.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,n):mS.safeAttrValue(e,i,r,n)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,n){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(n){Array.isArray(r[n])&&Array.isArray(i[n])?i[n]=i[n].concat(r[n]):i[n]=r[n]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(Q7e(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],h=r.validate(c,i);return h.isValid?a[l]=c:(n=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const oz=new Map;function rTe(){oz.clear()}function eqe(t){return oz.get(t)}function tqe(t,e){oz.set(t,e)}function nj(t){oz.delete(t)}function iqe(...t){const e=Ic.acquire();for(let r=0;r<t.length;r++){const n=t[r],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const i=e.join(" ");return Ic.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{var n;rTe();for(const s of r)(n=t.get(s.target))==null||n(s)}),i=(r,n,s)=>(t.set(r,n),e.observe(r,s),Ui(()=>{e.unobserve(r),t.delete(r)}));return(r,n,s)=>{let o=null;return Fb([oe(()=>typeof r=="function"?r():r,a=>{o==null||o.remove(),a&&(o=i(a,n,s))},hi),Ui(()=>o==null?void 0:o.remove())])}})();function rqe(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function bPt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function xPt(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const nqe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],sqe=nqe.reduce((t,e)=>(t[e]=[],t),{}),oqe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],nTe=new K7e({whiteList:sqe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(oqe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function aqe(t){return t==="Enter"||t===" "}async function lqe(t,e){await kFe(A3(e));const i=typeof t=="function"?t():t;i&&("setFocus"in i&&typeof i.setFocus=="function"?await i.setFocus():i instanceof HTMLElement&&i.focus())}const sTe="http://www.w3.org/",az=`${sTe}2000/svg`,oTe=`${sTe}1999/xlink`;let Ile=[],lK=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},cK=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),aTe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},cqe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(cK(t[r],e))return r}return-1},sj=(t,e,i,r)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(cK(a,n))throw new Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},uqe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},I7=[],P7=!1,lTe=t=>{(t.children||[]).forEach(lTe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Ple=()=>{P7=!1,I7.forEach(lTe),I7.length=0},Lle=t=>{I7.push(t),P7||(P7=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Ple,{timeout:16}):setTimeout(Ple,16))},Dle=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Lle(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Lle(t))},hqe=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")D7(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let g=c[p];l[g]&&t.classList.add(g)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let g=c[p],y=l[g];y&&(aTe(y),i.styleApplyer(t,g,y))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):i.namespace===az?a==="href"?t.setAttributeNS(oTe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=nTe.sanitize(l):L7(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function L7(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let N5,dqe=(t,e,i)=>{if(e)for(let r of e)x2(r,t,void 0,i)},cTe=(t,e,i)=>{dqe(t,e.children,i),e.text&&(t.textContent=e.text),hqe(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},x2=(t,e,i,r)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(n,i):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(s-1),p=o.slice(s,l);h==="."?n.classList.add(p):h==="#"?n.id=p:(p==="svg"&&(r=lK(r,{namespace:az})),r.namespace!==void 0?n=t.domNode=a.createElementNS(r.namespace,p):(n=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(n,i):n.parentNode!==e&&e.appendChild(n)),s=l+1}}cTe(n,t,r)}},D7=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},pqe=(t,e,i,r)=>{if(!i)return;let n=!1,s=Object.keys(i),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=i[l],h=e[l];if(l==="class")h!==c&&(D7(t,h,!1),D7(t,c,!0));else if(l==="classes"){let p=t.classList,g=Object.keys(c),y=g.length;for(let w=0;w<y;w++){let b=g[w],x=!!c[b];x!==!!h[b]&&(n=!0,x?p.add(b):p.remove(b))}}else if(l==="styles"){let p=Object.keys(c),g=p.length;for(let y=0;y<g;y++){let w=p[y],b=c[w];b!==h[w]&&(n=!0,b?(aTe(b),r.styleApplyer(t,w,b)):r.styleApplyer(t,w,""))}}else if(c||typeof h!="string"||(c=""),l!=="value"||L7(t)){if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===az?l==="href"?t.setAttributeNS(oTe,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=nTe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):L7(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}else{let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(n=!0)}}return n},fqe=(t,e,i,r,n)=>{if(i===r)return!1;r=r||Ile;let s,o=(i=i||Ile).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,g=r[c];if(p!==void 0&&cK(p,g))h=N5(p,g,n)||h,l++;else{let y=cqe(i,g,l+1);if(y>=0){for(s=l;s<y;s++)Dle(i[s]),sj(i,s,t,"removed");h=N5(i[y],g,n)||h,l=y+1}else x2(g,e,l<o?i[l].domNode:void 0,n),uqe(g),sj(r,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)Dle(i[s]),sj(i,s,t,"removed");return h};N5=(t,e,i)=>{let r=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,n=!0,n}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=lK(i,{namespace:az})),t.text!==e.text&&(s=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,s=fqe(e,r,t.children,e.children,i)||s,s=pqe(r,t.properties,e.properties,i)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),n};let l$=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,N5(r,i,e)},domNode:t.domNode});const mqe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let vT=t=>lK(mqe,t),X_={create:(t,e)=>(e=vT(e),x2(t,document.createElement("div"),void 0,e),l$(t,e)),append:(t,e,i)=>(i=vT(i),x2(e,t,void 0,i),l$(e,i)),insertBefore:(t,e,i)=>(i=vT(i),x2(e,t.parentNode,t,i),l$(e,i)),merge:(t,e,i)=>(i=vT(i),e.domNode=t,cTe(t,e,i),l$(e,i)),replace:(t,e,i)=>(i=vT(i),x2(e,t.parentNode,t,i),t.parentNode.removeChild(t),l$(e,i))},uTe,gqe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};uTe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let yqe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?uTe(i.children,n=>n.domNode===r):void 0}),i},_qe=(t,e,i)=>{let r=function(n){i("domEvent",n);let s=e(),o=gqe(n.currentTarget,s.domNode);o.reverse();let a,l=yqe(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",n),a};return(n,s,o,a)=>r},Nle=t=>{let e,i,r=vT(t),n=r.performanceLogger,s=!0,o=!1,a=[],l=[],c=(p,g,y)=>{let w,b=()=>w;r.eventHandlerInterceptor=_qe(e,b,n),w=p(g,y(),r),a.push(w),l.push(y)},h=()=>{if(i=void 0,s){s=!1,n("renderStart",void 0);for(let p=0;p<a.length;p++){let g=l[p]();n("rendered",void 0),a[p].update(g),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(p,g)=>{c(X_.append,p,g)},insertBefore:(p,g)=>{c(X_.insertBefore,p,g)},merge:(p,g)=>{c(X_.merge,p,g)},replace:(p,g)=>{c(X_.replace,p,g)},detach:p=>{for(let g=0;g<l.length;g++)if(l[g]===p)return l.splice(g,1),a.splice(g,1)[0];throw new Error("renderFunction was not found")}},e},t_=class extends Ne{constructor(){super(...arguments),this.items=new ot,this._watchUpdatingTracking=new hv,this._callbacks=new Map,this._projector=Nle(),this._hiddenProjector=Nle()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const n=()=>r.render();this._callbacks.set(r,n),this._projector.append(this.surface,n)}for(const r of i.removed){const n=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(n.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);r.append(i,s),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n!=null&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(s);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),n=this.computeBoundingRect(i);return Math.max(r.left,n.left)<=Math.min(r.right,n.right)&&Math.max(r.top,n.top)<=Math.min(r.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!(i!=null&&i.disableDecorations);if(!this.items.some(s=>s.visible&&!(r&&s.isDecoration)))return;const n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(s=>{r&&s.isDecoration||(n.save(),s.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([f({readOnly:!0})],t_.prototype,"surface",void 0),u([f({readOnly:!0})],t_.prototype,"items",void 0),u([f({readOnly:!0})],t_.prototype,"needsRender",null),u([f({readOnly:!0})],t_.prototype,"_watchUpdatingTracking",void 0),u([f({readOnly:!0})],t_.prototype,"updating",null),t_=u([L("esri.views.overlay.ViewOverlay")],t_);const Fle=t_,oj=[0,0];function vqe(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return oj[0]=i.left+((e==null?void 0:e.pageXOffset)??0),oj[1]=i.top+((e==null?void 0:e.pageYOffset)??0),oj}function kle(t){t&&(t.textContent="",t.parentNode&&t.parentNode.removeChild(t))}function wqe(t){const e=document.createElement("div");return t.appendChild(e),e}const c$=16,dL=750,bqe=512,xqe=2,Sqe=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:c$,time:dL},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([oe(()=>this.cursor,r=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",r)}),oe(()=>this.navigating,r=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([oe(()=>this.ui,(i,r)=>this._handleUIChange(i,r),Si),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Ye(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),n=HU(i);if(n||typeof i!="string"||de.getLogger(this).error("#container",`element with id '${i}' not found`),r===n)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(kle(this.root),this._set("root",null)),this.userContent&&(ile(this.userContent,r),kle(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",ile(n,s),n.appendChild(s),this._set("userContent",s);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Fle;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(oe(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Ub({render:()=>{var h;return(h=this.overlay)==null?void 0:h.render()}}):this._overlayRenderTaskHandle=Sr(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,r,n){const s=this.position;return i-=s?s[0]:0,r-=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}containerToPage(i,r,n){const s=this.position;return i+=s?s[0]:0,r+=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(oe(()=>this.root,n=>{i.container=n?wqe(n):null},Si),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=c$,i.time=dL,this.addHandles([OC(window,"resize",()=>{i.freq=c$,i.time=dL}),Ub({prepare:r=>{const n=this._measure(),s=this._freqInfo;if(s.time+=r.deltaTime,n&&(s.freq=c$,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?c$:Math.min(dL,s.freq*xqe),!n&&s.freq>=bqe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,n=i?i.clientHeight:0;if(r===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return r===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:r,height:n}),!0)}_position(){const i=this.container,r=this.position,n=i&&vqe(i);return!!n&&(!r||n[0]!==r[0]||n[1]!==r[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return u([f()],e.prototype,"container",null),u([f({readOnly:!0})],e.prototype,"focused",null),u([f({readOnly:!0})],e.prototype,"height",void 0),u([f()],e.prototype,"messagesCommon",void 0),u([f({type:Fle})],e.prototype,"overlay",void 0),u([f({readOnly:!0})],e.prototype,"position",void 0),u([f({readOnly:!0})],e.prototype,"resizing",void 0),u([f({readOnly:!0})],e.prototype,"root",void 0),u([f({value:null,readOnly:!0})],e.prototype,"size",null),u([f({readOnly:!0})],e.prototype,"surface",void 0),u([f({readOnly:!0})],e.prototype,"suspended",void 0),u([f()],e.prototype,"ui",void 0),u([f({readOnly:!0})],e.prototype,"userContent",void 0),u([f({readOnly:!0})],e.prototype,"width",void 0),u([f()],e.prototype,"widthBreakpoint",void 0),e=u([L("esri.views.DOMContainer")],e),e};function Sx(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function TPt(t,e,i,r,n){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=n}function tc(t,e,i,r,n){return!(e==null||r==null||t.length<2)&&(u$.x=t[0],u$.y=t[1],u$.z=t[2],u$.spatialReference=e,ec(u$,i,r,n))}const u$=Sx(0,0,0,nt.WGS84);function Tx(t,e,i){return!!tc(t,e,pL,i.spatialReference)&&(i.x=pL[0],i.y=pL[1],i.z=pL[2],!0)}async function hTe(t,e,i,r){return await H3(e,i.spatialReference,null,r),Tx(t,e,i)}const pL=A();var on,Go;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(on||(on={}));let Tqe=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Go.ALL,this.normalRequired=!0,this.excludeLabels=!1}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Go||(Go={}));let Eqe=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},Cqe=class extends Eqe{constructor(e,i,r,n){super(e,i,r),this.center=n!=null?En(n):null}},dTe=class{constructor(e){this.layerUid=e}},Y3=class extends dTe{constructor(e,i){super(e),this.graphicUid=i}};function wd(t){return(t==null?void 0:t.dist)!=null}function Ule(t){return(e,i,r)=>(br(zle,e,i,r),!KQ(t,zle))}function lz(t){return wd(t)&&t.intersector===on.OBJECT&&!!t.target}function cz(t){return wd(t)&&t.intersector===on.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const zle=A();function Mqe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function F5(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function uK(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>Bo()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function uz(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+o*a+n*c-s*l,t[1]=n*h+o*l+s*a-r*c,t[2]=s*h+o*c+r*l-n*a,t[3]=o*h-r*a-n*l-s*c,t}function $qe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-r*a,t}function Oqe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-s*a,t[1]=n*l+o*a,t[2]=s*l+r*a,t[3]=o*l-n*a,t}function Aqe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=n*l-r*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function Rqe(t,e){const i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t}function ZN(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,h,p,g,y=i[0],w=i[1],b=i[2],x=i[3];return c=n*y+s*w+o*b+a*x,c<0&&(c=-c,y=-y,w=-w,b=-b,x=-x),1-c>Bo()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,g=Math.sin(r*l)/h):(p=1-r,g=r),t[0]=p*n+g*y,t[1]=p*s+g*w,t[2]=p*o+g*b,t[3]=p*a+g*x,t}function Iqe(t){const e=V3,i=e(),r=e(),n=e(),s=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function Pqe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=s*a,t}function dv(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function pTe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+o]-e[3*o+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function Lqe(t,e,i,r){const n=.5*Math.PI/180;e*=n,i*=n,r*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return t[0]=s*l*h-o*a*c,t[1]=o*a*h+s*l*c,t[2]=o*l*c-s*a*h,t[3]=o*l*h+s*a*c,t}function Dqe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Nqe=ed,fTe=_n,Fqe=GQ,kqe=uz,Uqe=KE,zqe=uSe,Vqe=YU,mTe=HQ,Bqe=mTe,gTe=ZU,jqe=gTe,hK=cSe,Gqe=Ob,Hqe=Qb;function qqe(t,e,i){const r=Te(e,i);return r<-.999999?(Ot(gf,Wqe,e),ua(gf)<1e-6&&Ot(gf,Zqe,e),Me(gf,gf),F5(t,gf,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ot(gf,e,i),t[0]=gf[0],t[1]=gf[1],t[2]=gf[2],t[3]=1+r,hK(t,t))}const gf=A(),Wqe=Qe(1,0,0),Zqe=Qe(0,1,0);function Yqe(t,e,i,r,n,s){return ZN(Vle,e,n,s),ZN(Ble,i,r,s),ZN(t,Vle,Ble,2*s*(1-s)),t}const Vle=vd(),Ble=vd();function Xqe(t,e,i,r){const n=Jqe;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],hK(t,pTe(t,n))}const Jqe=In();Object.freeze(Object.defineProperty({__proto__:null,add:Fqe,calculateW:Rqe,conjugate:dv,copy:Nqe,dot:zqe,equals:Hqe,exactEquals:Gqe,fromEuler:Lqe,fromMat3:pTe,getAxisAngle:uK,identity:Mqe,invert:Pqe,len:Bqe,length:mTe,lerp:Vqe,mul:kqe,multiply:uz,normalize:hK,random:Iqe,rotateX:$qe,rotateY:Oqe,rotateZ:Aqe,rotationTo:qqe,scale:Uqe,set:fTe,setAxes:Xqe,setAxisAngle:F5,slerp:ZN,sqlerp:Yqe,sqrLen:jqe,squaredLength:gTe,str:Dqe},Symbol.toStringTag,{value:"Module"}));function yTe(t,e,i){const r=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Qqe(t,e,i){return yTe(t,e,i),Gc(i,i),i}function X3(t,e,i,r){if(t==null||r==null)return!1;const n=g5(t,oje),s=g5(r,aje);if(n===s&&!aj(s)&&(n!==ne.UNKNOWN||xs(t,r)))return rQ(i,e),!0;if(aj(s)){const a=cO[n][ne.LON_LAT],l=cO[ne.LON_LAT][s];return a!=null&&l!=null&&(a(e,0,E0,0),l(E0,0,C0,0),yTe(fL*E0[0],fL*E0[1],i),i[12]=C0[0],i[13]=C0[1],i[14]=C0[2],!0)}const o=aj(n);if((s===ne.WEB_MERCATOR||s===ne.PLATE_CARREE||s===ne.WGS84||s===ne.CGCS2000)&&(n===ne.WGS84||o||n===ne.WEB_MERCATOR||n===ne.CGCS2000)){const a=cO[n][ne.LON_LAT],l=cO[ne.LON_LAT][s];return a!=null&&l!=null&&(a(e,0,E0,0),l(E0,0,C0,0),o?Qqe(fL*E0[0],fL*E0[1],i):Jp(i),i[12]=C0[0],i[13]=C0[1],i[14]=C0[2],!0)}return!1}function aj(t){return t===ne.SPHERICAL_ECEF||t===ne.SPHERICAL_MARS_PCPF||t===ne.SPHERICAL_MOON_PCPF||t===ne.WGS84_ECEF}const fL=Wt(1),E0=A(),C0=A();let hz=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},Ji=class extends hz{constructor(e,i,r,n=!1,s=r){super(e,r,s),this.indices=i,this.exclusive=n}};const rC=1e-6,h$=A(),mL=A();function Kqe(t,e){const{data:i,size:r}=t,n=i.length/r;if(n<=0)return;const s=new cWe(t);F7(h$,s.minProj,s.maxProj),wO(h$,h$,.5),Vh(mL,s.maxProj,s.minProj);const o=N7(mL),a=new uWe;a.quality=o,n<14&&(t=new hz(new Float64Array(s.buffer,112,42),3));const l=A(),c=A(),h=A(),p=A(),g=A(),y=A(),w=A();switch(eWe(s,t,w,l,c,h,p,g,y,a)){case 1:return void qle(h$,mL,e);case 2:return void aWe(t,p,e)}tWe(t,w,l,c,h,p,g,y,a),_Te(t,a.b0,a.b1,a.b2,sE,oE);const b=A();Vh(b,oE,sE),a.quality=N7(b),a.quality<o?vTe(a.b0,a.b1,a.b2,sE,oE,b,e):qle(h$,mL,e)}function eWe(t,e,i,r,n,s,o,a,l,c){return iWe(t,r,n),k7(r,n)<rC?1:(Vh(o,r,n),la(o,o),rWe(e,r,o,s)<rC?2:(Vh(a,n,s),la(a,a),Vh(l,s,r),la(l,l),Bh(i,a,o),la(i,i),tw(e,i,o,a,l,c),0))}const d$=A(),p$=A(),oh=A(),ah=A(),lh=A(),M0=A(),$0=A(),O0=A();function tWe(t,e,i,r,n,s,o,a,l){nWe(t,e,i,d$,p$),d$[0]!==void 0&&(Vh(oh,d$,i),la(oh,oh),Vh(ah,d$,r),la(ah,ah),Vh(lh,d$,n),la(lh,lh),Bh(M0,ah,s),la(M0,M0),Bh($0,lh,o),la($0,$0),Bh(O0,oh,a),la(O0,O0),tw(t,M0,s,ah,oh,l),tw(t,$0,o,lh,ah,l),tw(t,O0,a,oh,lh,l)),p$[0]!==void 0&&(Vh(oh,p$,i),la(oh,oh),Vh(ah,p$,r),la(ah,ah),Vh(lh,p$,n),la(lh,lh),Bh(M0,ah,s),la(M0,M0),Bh($0,lh,o),la($0,$0),Bh(O0,oh,a),la(O0,O0),tw(t,M0,s,ah,oh,l),tw(t,$0,o,lh,ah,l),tw(t,O0,a,oh,lh,l))}function iWe(t,e,i){let r=k7(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=k7(t.maxVert[s],t.minVert[s]);o>r&&(r=o,n=s)}Du(e,t.minVert[n]),Du(i,t.maxVert[n])}const ch=[0,0,0];function rWe(t,e,i,r){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){ch[0]=n[l]-e[0],ch[1]=n[l+1]-e[1],ch[2]=n[l+2]-e[2];const c=i[0]*ch[0]+i[1]*ch[1]+i[2]*ch[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=ch[0]*ch[0]+ch[1]*ch[1]+ch[2]*ch[2]-c*c/h;p>o&&(o=p,a=l)}return Du(r,n,a),o}const Ws=Yt();function nWe(t,e,i,r,n){oWe(t,e,Ws,n,r);const s=bTe(i,e);Ws[1]-rC<=s&&(r[0]=void 0),Ws[0]+rC>=s&&(n[0]=void 0)}const jle=A(),Gle=A(),Hle=A(),gS=A(),yS=A(),gL=A();function tw(t,e,i,r,n,s){if(wTe(e)<rC)return;Bh(jle,i,e),Bh(Gle,r,e),Bh(Hle,n,e),nE(t,e,Ws),yS[1]=Ws[0],gS[1]=Ws[1],gL[1]=gS[1]-yS[1];const o=[i,r,n],a=[jle,Gle,Hle];for(let l=0;l<3;++l){nE(t,o[l],Ws),yS[0]=Ws[0],gS[0]=Ws[1],nE(t,a[l],Ws),yS[2]=Ws[0],gS[2]=Ws[1],gL[0]=gS[0]-yS[0],gL[2]=gS[2]-yS[2];const c=N7(gL);c<s.quality&&(Du(s.b0,o[l]),Du(s.b1,e),Du(s.b2,a[l]),s.quality=c)}}const sWe=A();function nE(t,e,i){const{data:r,size:n}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<r.length;s+=n){const o=r[s]*e[0]+r[s+1]*e[1]+r[s+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function oWe(t,e,i,r,n){const{data:s,size:o}=t;Du(r,s),Du(n,r),i[0]=bTe(sWe,e),i[1]=i[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<i[0]&&(i[0]=l,Du(r,s,a)),l>i[1]&&(i[1]=l,Du(n,s,a))}}function qle(t,e,i){i.center=t,i.halfSize=ue(e,e,.5),i.quaternion=UQ}const Zm=A(),_S=A(),f$=A(),sE=A(),oE=A(),Wle=A();function aWe(t,e,i){Du(Zm,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Zm[0]=0:Math.abs(e[1])>Math.abs(e[2])?Zm[1]=0:Zm[2]=0,wTe(Zm)<rC&&(Zm[0]=Zm[1]=Zm[2]=1),Bh(_S,e,Zm),la(_S,_S),Bh(f$,e,_S),la(f$,f$),_Te(t,e,_S,f$,sE,oE),Vh(Wle,oE,sE),vTe(e,_S,f$,sE,oE,Wle,i)}function _Te(t,e,i,r,n,s){nE(t,e,Ws),n[0]=Ws[0],s[0]=Ws[1],nE(t,i,Ws),n[1]=Ws[0],s[1]=Ws[1],nE(t,r,Ws),n[2]=Ws[0],s[2]=Ws[1]}const b1=A(),m$=A(),yL=A(),yf=Hxe(1,0,0,0,1,0,0,0,1),lWe=vd();function vTe(t,e,i,r,n,s,o){yf[0]=t[0],yf[1]=t[1],yf[2]=t[2],yf[3]=e[0],yf[4]=e[1],yf[5]=e[2],yf[6]=i[0],yf[7]=i[1],yf[8]=i[2],o.quaternion=hWe(lWe,yf),F7(b1,r,n),wO(b1,b1,.5),wO(m$,t,b1[0]),wO(yL,e,b1[1]),F7(m$,m$,yL),wO(yL,i,b1[2]),o.center=xe(m$,m$,yL),o.halfSize=ue(b1,s,.5)}const nu=7;let cWe=class{constructor(e){this.minVert=new Array(nu),this.maxVert=new Array(nu);const i=64*nu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,nu),r+=8*nu,this.maxProj=new Float64Array(this.buffer,r,nu),r+=8*nu;for(let l=0;l<nu;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<nu;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<nu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(nu),s=new Array(nu),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<nu;++l){let c=n[l];Du(this.minVert[l],o,c),c=s[l],Du(this.maxVert[l],o,c)}}},uWe=class{constructor(){this.b0=Qe(1,0,0),this.b1=Qe(0,1,0),this.b2=Qe(0,0,1),this.quality=0}};function N7(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function F7(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function Vh(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function wO(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Du(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function Bh(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o}function la(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function wTe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function k7(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function bTe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function hWe(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*s+s]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+r]+e[3*r+n])*o,t[s]=(e[3*s+r]+e[3*r+s])*o}return t}let xTe=class YN{constructor(e=ws,i=bWe,r=UQ){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){const e=new YN;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new YN;return i._data=e.slice(),i}static fromJSON(e){return new YN(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return ve(et.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return ve(et.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return fTe(rHe.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=yn,r=this._data;i[0]=r[6],i[1]=r[7],i[2]=r[8],i[3]=r[9];for(let n=0;n<8;++n){const s=e[n];s[0]=(1&n?-1:1)*r[3],s[1]=(2&n?-1:1)*r[4],s[2]=(4&n?-1:1)*r[5],Ac(s,s,i),s[0]+=r[0],s[1]+=r[1],s[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){wi[0]=this._data[0]-e[0],wi[1]=this._data[1]-e[1],wi[2]=this._data[2]-e[2];const i=this.getQuaternion(Kg);return dv(yn,i),Ac(wi,wi,yn),XE(wi,wi),Ym[0]=Math.min(wi[0],this._data[3]),Ym[1]=Math.min(wi[1],this._data[4]),Ym[2]=Math.min(wi[2],this._data[5]),Xb(Ym,wi)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;wi[0]=r[0]-e[0],wi[1]=r[1]-e[1],wi[2]=r[2]-e[2];const n=e[3],s=n+i;return!(w5(wi)>s*s)&&(yn[0]=-r[6],yn[1]=-r[7],yn[2]=-r[8],yn[3]=r[9],Ac(wi,wi,yn),XE(wi,wi),Ym[0]=Math.min(wi[0],r[3]),Ym[1]=Math.min(wi[1],r[4]),Ym[2]=Math.min(wi[2],r[5]),Xb(Ym,wi)<n*n)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const n=this._data,s=yn;s[0]=-n[6],s[1]=-n[7],s[2]=-n[8],s[3]=n[9],wi[0]=e[0]-n[0],wi[1]=e[1]-n[1],wi[2]=e[2]-n[2];const o=Ac(wi,wi,yn),a=Ac(Ym,i,yn);let l=-1/0,c=1/0;const h=this.getHalfSize(aE);for(let p=0;p<3;p++){const g=o[p],y=a[p],w=h[p]+r;if(Math.abs(y)>1e-6){const b=(w-g)/y,x=(-w-g)/y;l=Math.max(l,Math.min(b,x)),c=Math.min(c,Math.max(b,x))}else if(g>w||g<-w)return!1}return l<=c}projectedArea(e,i,r,n){const s=this.getQuaternion(Kg);dv(yn,s),wi[0]=e[0]-this._data[0],wi[1]=e[1]-this._data[1],wi[2]=e[2]-this._data[2],Ac(wi,wi,yn);const o=this.getHalfSize(aE),a=wi[0]<-o[0]?-1:wi[0]>o[0]?1:0,l=wi[1]<-o[1]?-1:wi[1]>o[1]?1:0,c=wi[2]<-o[2]?-1:wi[2]>o[2]?1:0,h=Math.abs(a)+Math.abs(l)+Math.abs(c);if(h===0)return 1/0;const p=h===1?4:6,g=6*(a+3*l+9*c+13);GR(wT,s),ez(wT,wT,o);const y=this.getCenter(Op);for(let x=0;x<p;x++){const T=fWe[g+x];ve(wi,((1&T)<<1)-1,(2&T)-1,((4&T)>>1)-1),Zl(wi,wi,wT),xe(x1,y,wi),x1[3]=1,zc(x1,x1,i);const M=1/Math.max(1e-6,x1[3]);kd[2*x]=x1[0]*M,kd[2*x+1]=x1[1]*M}const w=2*p-2;let b=kd[0]*(kd[3]-kd[w+1])+kd[w]*(kd[1]-kd[w-1]);for(let x=2;x<w;x+=2)b+=kd[x]*(kd[x+3]-kd[x-1]);return Math.abs(b)*r*n*.125}projectedRadius(e){const i=this.getQuaternion(Kg);return dv(yn,i),Ac(wi,e,yn),Math.abs(wi[0]*this._data[3])+Math.abs(wi[1]*this._data[4])+Math.abs(wi[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(Kg),r=GR(wT,i),n=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),s=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-n,e[1]=this._data[1]-s,e[2]=this._data[2]-o,e[3]=this._data[0]+n,e[4]=this._data[1]+s,e[5]=this._data[2]+o}transform(e,i,r,n=0,s=Iv(r),o=Iv(i),a=Mv(i,o)){if(r===s)i.isGeographic?_We(this,e,i,n,o):yWe(this,e,i,n,o,a);else if(i.isWGS84&&(r.isWebMercator||$R(r)))mWe(i,this,r,e,n);else if(i.isWebMercator&&$R(r))gWe(i,this,r,e,n);else{const l=this.getCenter(Op);l[2]+=n,io(l,i,0,l,r,0),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(Kg),e.halfSize=this.getHalfSize(aE))}}};const yn=vd(),Kg=vd(),dWe=vd(),wi=A(),Ym=A(),x1=Ti();function pWe(t,e=new xTe){return Kqe(t,e),e}const kd=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],fWe=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function STe(t,e,i,r,n){const s=t.getQuaternion(Kg);n.quaternion=s,dv(yn,s);const o=t.getCenter(Op),a=t.getHalfSize(aE);if(r===ct.Global){Ac(Wr,o,yn),XE(mp,Wr),$xe(ou,mp,a),nr(ou,mp,ou);const l=Fe(ou);xe(ou,mp,a);const c=Fe(ou);if(l<i)n.center=o,ve(Wr,i,i,i),n.halfSize=xe(Wr,a,Wr);else{const h=c>0?1+e/c:1,p=l>0?1+i/l:1,g=(p+h)/2,y=(p-h)/2;ue(ou,mp,y),n.halfSize=Us(ou,ou,a,g),ue(ou,mp,g),Us(ou,ou,a,y),Mxe(Wr,Wr),DQ(Wr,ou,Wr);const w=t.getQuaternion(dWe);n.center=Ac(Wr,Wr,w)}}else{n.center=Us(Wr,o,UE,(i+e)/2);const l=Ac(Wr,UE,yn);XE(l,l),n.halfSize=Us(mp,a,l,(i-e)/2)}return n}function mWe(t,e,i,r,n){e.getCenter(Op),Op[2]+=n;const s=Iv(i);io(Op,t,0,Op,s,0),TTe(s,e,Op,i,r)}function gWe(t,e,i,r,n){e.getCenter(Op),Op[2]+=n,TTe(t,e,Op,i,r)}function TTe(t,e,i,r,n){const s=e.getQuaternion(Kg),o=GR(wT,s),a=e.getHalfSize(aE);for(let l=0;l<8;++l){for(let c=0;c<3;++c)im[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let h=i[c];for(let p=0;p<3;++p)h+=im[p]*o[3*p+c];XN[3*l+c]=h}}io(XN,t,0,XN,r,0,8),pWe(vWe,n)}function yWe(t,e,i,r,n=Iv(i),s=Mv(i,n)){t.getCorners(Zle),t.getCenter(im),im[2]+=r,X3(i,im,su,n),e.setCenter(su[12],su[13],su[14]);const o=2*Math.sqrt(1+su[0]+su[5]+su[10]);yn[0]=(su[6]-su[9])/o,yn[1]=(su[8]-su[2])/o,yn[2]=(su[1]-su[4])/o,yn[3]=.25*o;const a=t.getQuaternion(Kg);e.quaternion=uz(yn,yn,a),dv(yn,yn),ve(mp,0,0,0);const l=e.getCenter(wWe);for(const c of Zle)c[2]+=r,s(c,0,c,0),nr(Wr,c,l),Ac(Wr,Wr,yn),XE(Wr,Wr),Oxe(mp,mp,Wr);e.halfSize=mp}function _We(t,e,i,r,n=Iv(i)){const s=xr(i),o=1+Math.max(0,r)/(s.radius+t.centerZ);t.getCenter(im),im[2]+=r,io(im,i,0,im,n,0),e.center=im;const a=t.getQuaternion(Kg);e.quaternion=a,dv(yn,a),ve(Wr,0,0,1),Ac(Wr,Wr,yn);const l=t.getHalfSize(aE);ve(Wr,l[0]*Math.abs(Wr[0]),l[1]*Math.abs(Wr[1]),l[2]*Math.abs(Wr[2])),ue(Wr,Wr,s.inverseFlattening),xe(Wr,l,Wr),e.halfSize=ue(Wr,Wr,o)}const XN=new Array(24),vWe=new hz(XN,3),im=A(),Op=A(),wWe=A(),aE=A(),wT=In(),su=ut(),Zle=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Wr=A(),mp=A(),ou=A(),bWe=xm(-1,-1,-1);let xWe=class{constructor(){this._transform=ut(),this._transformInverse=new _L({value:this._transform},Yl,ut),this._transformInverseTranspose=new _L(this._transformInverse,Gc,ut),this._transformTranspose=new _L({value:this._transform},Gc,ut),this._transformInverseRotation=new _L({value:this._transform},ySe,In)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){ps(this._transform,e)}multiplyTransform(e){fs(this._transform,this._transform,e)}set(e){ps(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},_L=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},SWe=class{constructor(e=0){this.offset=e,this.tmpVertex=A()}applyToVertex(e,i,r){const n=ve(dK,e,i,r),s=xe(ETe,n,this.localOrigin),o=this.offset/Fe(s);return Us(this.tmpVertex,n,s,o),this.tmpVertex}applyToAabb(e){const i=MWe,r=$We,n=OWe;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],n[l]=i[l];const s=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=s[l],e[l+3]=s[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let h=0;h<3;++h)e[h]=Math.min(e[h],c[h]),e[h+3]=Math.max(e[h+3],c[h])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)n[c]=l&1<<c?r[c]:i[c];o(n)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)n[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(n)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},TWe=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=A(),this._tmpMbs=Pn(),this._tmpObb=new xTe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Fe(e)}applyToVertex(e,i,r){const n=ve(dK,e,i,r),s=ve(ETe,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/Fe(s);return Us(this._tmpVertex,n,s,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],n=e[1],s=e[2]+i,o=e[3],a=e[4],l=e[5]+i,c=Math.abs(r),h=Math.abs(n),p=Math.abs(s),g=Math.abs(o),y=Math.abs(a),w=Math.abs(l),b=.5*(1+Math.sign(r*o))*Math.min(c,g),x=.5*(1+Math.sign(n*a))*Math.min(h,y),T=.5*(1+Math.sign(s*l))*Math.min(p,w),M=Math.max(c,g),$=Math.max(h,y),R=Math.max(p,w),I=Math.sqrt(b*b+x*x+T*T),P=Math.sign(c+r),N=Math.sign(h+n),V=Math.sign(p+s),U=Math.sign(g+o),B=Math.sign(y+a),W=Math.sign(w+l),j=this._totalOffset;if(I<j)return e[0]-=(1-P)*j,e[1]-=(1-N)*j,e[2]-=(1-V)*j,e[3]+=U*j,e[4]+=B*j,e[5]+=W*j,e;const Q=j/Math.sqrt(M*M+$*$+R*R),Z=j/I,X=Z-Q,ge=-X;return e[0]+=r*(P*ge+Z),e[1]+=n*(N*ge+Z),e[2]+=s*(V*ge+Z),e[3]+=o*(U*X+Q),e[4]+=a*(B*X+Q),e[5]+=l*(W*X+Q),e}applyToMbs(e){const i=Fe(e),r=this._totalOffset/i;return Us(this._tmpMbs,e,e,r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/i,this._tmpMbs}applyToObb(e){return STe(e,this._totalOffset,this._totalOffset,ct.Global,this._tmpObb),this._tmpObb}},EWe=class{constructor(e=0){this.offset=e,this.sphere=Pn(),this.tmpVertex=A()}applyToVertex(e,i,r){const n=this.objectTransform.transform,s=ve(dK,e,i,r),o=Mt(s,s,n),a=this.offset/Fe(o);Us(o,o,o,a);const l=this.objectTransform.inverse;return Mt(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Fe(e);Us(e,e,e,r);const n=this.offset/Fe(i);Us(i,i,i,n)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Fe(e),r=this.offset/i;return Us(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const Yle=new EWe;function U7(t){return t!=null?(Yle.offset=t,Yle):null}const Xle=new TWe;function Jle(t){return t!=null?(Xle.offset=t,Xle):null}const Qle=new SWe;function CWe(t){return t!=null?(Qle.offset=t,Qle):null}const Pv="terrain",dK=A(),ETe=A(),MWe=A(),$We=A(),OWe=A(),nC=1e-5;let AWe=class{constructor(e){this.options=new Tqe,this._results=new RWe,this.transform=new xWe,this.tolerance=nC,this.verticalOffset=null,this._ray=zs(),this._rayEnd=A(),this._rayBeginTransformed=A(),this._rayEndTransformed=A(),this.viewingMode=e??ct.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(wSe(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&R5(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===ct.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,xe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,n,s){var a;this.point=i,this.filterPredicate=n,this.tolerance=r??nC;const o=U7(this.verticalOffset);if(e&&e.length>0){const l=s?c=>{s(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const h=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);h!=null?(o!=null?h.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):h.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&h.forEachDegenerateObject(l)):c.objects.forAll(p=>l(p))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,n=U7(this.verticalOffset);for(const s of i){if(!s.visible)continue;const{material:o,id:a}=s;if(!o.visible)continue;this.transform.setAndInvalidateLazyTransforms(r,s.transformation),Mt(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Mt(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;n!=null&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,g,y,w)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const b=g?this._results.hud:this._results,x=g?T=>{const M=new Cqe(e,a,p,w);T.set(on.HUD,M,c,h,Js,y)}:T=>T.set(on.OBJECT,{object:e,geometryId:a,triangleNr:p},c,h,l,y);if((b.min.drapedLayerOrder==null||y>=b.min.drapedLayerOrder)&&(b.min.dist==null||c<b.min.dist)&&x(b.min),this.options.store!==Go.MIN&&(b.max.drapedLayerOrder==null||y<b.max.drapedLayerOrder)&&(b.max.dist==null||c>b.max.dist)&&x(b.max),this.options.store===Go.ALL)if(g){const T=new z7(this._ray);x(T),this._results.hud.all.push(T)}else{const T=new lE(this._ray);x(T),this._results.all.push(T)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?Kle(i.drapedLayerOrder,r.drapedLayerOrder):Kle(i.drapedLayerGraphicOrder,r.drapedLayerGraphicOrder))}};function Kle(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function pd(t){return new AWe(t)}let RWe=class{constructor(){this.min=new lE(zs()),this.max=new lE(zs()),this.hud={min:new z7(zs()),max:new z7(zs()),all:new Array},this.ground=new lE(zs()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},lE=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ue(vL,this.ray.direction,this.dist),Fe(vL)):null}getIntersectionPoint(e){return!!wd(this)&&(ue(vL,this.ray.direction,this.dist),xe(e,this.ray.origin,vL),!0)}getTransformedNormal(e){return ye(g$,this.normal),g$[3]=0,zc(g$,g$,this.transformation),ye(e,g$),Me(e,e)}constructor(e){this.intersector=on.OBJECT,this.normal=A(),this.transformation=ut(),this._ray=zs(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=on.OBJECT,R5(e,this._ray)}set(e,i,r,n,s,o,a){this.intersector=e,this.dist=r,ye(this.normal,n??UE),ps(this.transformation,s??Js),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){R5(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ye(this.normal,e.normal),ps(this.transformation,e.transformation)}},z7=class extends lE{constructor(){super(...arguments),this.intersector=on.HUD}};function pK(t){return new lE(t)}const vL=A(),g$=Ti();function CTe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,k5,r)!=null&&uwe(i,k5)}function dz(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Ex(t,e,i,r){const n=t.state.camera.clone();e&&i&&r&&(n.eye=e,n.center=i,n.up=r),IWe(t,n.ray,A0)||ye(A0,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(to(n.eye,A0)<o){const a=s.collision.enabled;ye(S1,n.viewForward),ue(S1,S1,o),a?n.eye=Ae(k5,A0,S1):xe(A0,n.eye,S1);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),h=s.collision.elevationMargin;a&&c<h&&(Ae(S1,A0,n.eye),n.eye=l.setAltitude(k5,h,n.eye),xe(A0,n.eye,S1))}return n.center=A0,n}function ece(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=dz(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,i,t.renderDataExtent,r,LWe),o=s*s;return to(e,i)>o}function IWe(t,e,i){let r=tce[t.viewingMode];r||(r=pd(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,tce[t.viewingMode]=r);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||ece(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||ece(t,e.origin,i))||!!n&&PWe(e,i,xr(t.spatialReference).radius)}function PWe(t,e,i){const r=Te(t.origin,t.origin)-i*i,n=r>0?Math.sqrt(r)/3:1;return ue(e,t.direction,n/Fe(t.direction)),xe(e,e,t.origin),!0}const tce={},k5=A(),A0=A(),S1=A(),LWe={near:0,far:0};function pz(t){return t?{ray:zs(t.ray),c0:t.c0,c1:t.c1}:{ray:zs(),c0:0,c1:Number.MAX_VALUE}}function DWe(t,e=pz()){return R5(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function NWe(t,e,i=pz()){const r=Fe(t.vector);return tz(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function jPt(t,e){return MTe(t,t.c0,e)}function GPt(t,e){return MTe(t,t.c1,e)}function MTe(t,e,i){return xe(i,t.ray.origin,ue(i,t.ray.direction,e))}new ky(()=>pz());function HR(t){return t?[dn(t[0]),dn(t[1]),dn(t[2]),dn(t[3]),dn(t[4]),dn(t[5])]:[dn(),dn(),dn(),dn(),dn(),dn()]}function $Te(){return[A(),A(),A(),A(),A(),A(),A(),A()]}function U5(t,e){for(let i=0;i<QC;i++)WQ(t[i],e[i]);return t}function OTe(t,e,i,r=VWe){const n=fs(jQ.get(),e,t);Yl(n,n);for(let s=0;s<UWe;++s){const o=zc(BQ.get(),zWe[s],n);ve(r[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}ATe(i,r)}function ATe(t,e){bp(e[oi.FAR_BOTTOM_LEFT],e[oi.NEAR_BOTTOM_LEFT],e[oi.NEAR_TOP_LEFT],t[mo.LEFT]),bp(e[oi.NEAR_BOTTOM_RIGHT],e[oi.FAR_BOTTOM_RIGHT],e[oi.FAR_TOP_RIGHT],t[mo.RIGHT]),bp(e[oi.FAR_BOTTOM_LEFT],e[oi.FAR_BOTTOM_RIGHT],e[oi.NEAR_BOTTOM_RIGHT],t[mo.BOTTOM]),bp(e[oi.NEAR_TOP_LEFT],e[oi.NEAR_TOP_RIGHT],e[oi.FAR_TOP_RIGHT],t[mo.TOP]),bp(e[oi.NEAR_BOTTOM_LEFT],e[oi.NEAR_BOTTOM_RIGHT],e[oi.NEAR_TOP_RIGHT],t[mo.NEAR]),bp(e[oi.FAR_BOTTOM_RIGHT],e[oi.FAR_BOTTOM_LEFT],e[oi.FAR_TOP_LEFT],t[mo.FAR])}function J_(t,e){for(let i=0;i<QC;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function V7(t,e){return RTe(t,DWe(e,ITe.get()))}function HPt(t,e){for(let i=0;i<QC;i++){const r=t[i];if(!LHe(r,e))return!1}return!0}function FWe(t,e,i){return RTe(t,NWe(e,i,ITe.get()))}function z5(t,e){for(let i=0;i<QC;i++)if(us(t[i],e)>0)return!1;return!0}function RTe(t,e){for(let i=0;i<QC;i++)if(!PHe(t[i],e))return!1;return!0}var mo,oi;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(mo||(mo={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(oi||(oi={}));const kWe={bottom:[oi.FAR_BOTTOM_RIGHT,oi.NEAR_BOTTOM_RIGHT,oi.NEAR_BOTTOM_LEFT,oi.FAR_BOTTOM_LEFT],near:[oi.NEAR_BOTTOM_LEFT,oi.NEAR_BOTTOM_RIGHT,oi.NEAR_TOP_RIGHT,oi.NEAR_TOP_LEFT],far:[oi.FAR_BOTTOM_RIGHT,oi.FAR_BOTTOM_LEFT,oi.FAR_TOP_LEFT,oi.FAR_TOP_RIGHT],right:[oi.NEAR_BOTTOM_RIGHT,oi.FAR_BOTTOM_RIGHT,oi.FAR_TOP_RIGHT,oi.NEAR_TOP_RIGHT],left:[oi.FAR_BOTTOM_LEFT,oi.NEAR_BOTTOM_LEFT,oi.NEAR_TOP_LEFT,oi.FAR_TOP_LEFT],top:[oi.FAR_TOP_LEFT,oi.NEAR_TOP_LEFT,oi.NEAR_TOP_RIGHT,oi.FAR_TOP_RIGHT]},QC=6,UWe=8,zWe=[Ri(-1,-1,-1,1),Ri(1,-1,-1,1),Ri(1,1,-1,1),Ri(-1,1,-1,1),Ri(-1,-1,1,1),Ri(1,-1,1,1),Ri(1,1,1,1),Ri(-1,1,1,1)],ITe=new ky(pz),VWe=$Te();function Ha(t,e){return t[0]=e[0],t[1]=e[1],t}function ln(t,e,i){return t[0]=e,t[1]=i,t}function i_(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function ey(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function PTe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function LTe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function BWe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function jWe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function GWe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function HWe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function qWe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function U_(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function WWe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function Lv(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function V5(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function DTe(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function NTe(t){const e=t[0],i=t[1];return e*e+i*i}function FTe(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ZWe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function B7(t,e){const i=e[0],r=e[1];let n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function aa(t,e){return t[0]*e[0]+t[1]*e[1]}function YWe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function jh(t,e,i,r){const n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t}function XWe(t,e=1){const i=2*V3()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function JWe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t}function QWe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t}function KWe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function eZe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}function kTe(t,e,i,r){const n=e[0]-i[0],s=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=n*a-s*o+i[0],t[1]=n*o+s*a+i[1],t}function tZe(t,e){const i=t[0],r=t[1],n=e[0],s=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(i*n+r*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function iZe(t){return"vec2("+t[0]+", "+t[1]+")"}function UTe(t,e){return t[0]===e[0]&&t[1]===e[1]}function fz(t,e){const i=t[0],r=t[1],n=e[0],s=e[1],o=Bo();return Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))}function rZe(t,e,i,r,n){let s=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*s+r[1]*o)*(n-1);return s=r[0]*a,o=r[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const nZe=DTe,sZe=ey,oZe=PTe,aZe=LTe,lZe=Lv,cZe=V5,uZe=NTe;Object.freeze(Object.defineProperty({__proto__:null,add:i_,angle:tZe,ceil:BWe,copy:Ha,cross:YWe,dist:lZe,distance:Lv,div:aZe,divide:LTe,dot:aa,equals:fz,exactEquals:UTe,floor:jWe,inverse:ZWe,len:nZe,length:DTe,lerp:jh,max:HWe,min:GWe,mul:oZe,multiply:PTe,negate:FTe,normalize:B7,projectAndScale:rZe,random:XWe,rotate:kTe,round:qWe,scale:U_,scaleAndAdd:WWe,set:ln,sqrDist:cZe,sqrLen:uZe,squaredDistance:V5,squaredLength:NTe,str:iZe,sub:sZe,subtract:ey,transformMat2:JWe,transformMat2d:QWe,transformMat3:KWe,transformMat4:eZe},Symbol.toStringTag,{value:"Module"}));function hZe(t,e){const i=[],r=[];return wL(i,t,e,om.LEFT),wL(r,i,e,om.BOTTOM),wL(i,r,e,om.RIGHT),wL(r,i,e,om.TOP),r}function wL(t,e,i,r){const n=dZe(i,r);if(t.length=0,e.length){n(bL,e[0],e[0])===Ou.INSIDE&&y$(t,e[0]);for(let s=0;s<e.length;s++){const o=e[s===e.length-1?0:s+1];switch(n(bL,e[s],o)){case Ou.INSIDE:y$(t,o);break;case Ou.INSIDE_OUT:y$(t,C5(bL));break;case Ou.OUTSIDE_IN:y$(t,C5(bL)),y$(t,o);case Ou.OUTSIDE:}}}}function y$(t,e){t.length!==0&&fz(t.at(-1),e)||t.push(e)}function dZe(t,e){const i=e===om.LEFT||e===om.RIGHT?0:1,r=t[e],n=e===om.LEFT||e===om.BOTTOM?S2.MIN:S2.MAX,s=i===0?1:0;return(o,a,l)=>{if(a[i]<r&&l[i]<r)return n===S2.MIN?Ou.OUTSIDE:Ou.INSIDE;if(a[i]>r&&l[i]>r)return n===S2.MIN?Ou.INSIDE:Ou.OUTSIDE;const c=(l[s]-a[s])/(l[i]-a[i]),h=a[s]+c*(r-a[i]);return o[i]=r,o[s]=h,(a[i]<r?1:-1)*n>0?Ou.OUTSIDE_IN:Ou.INSIDE_OUT}}var S2,Ou,om;(function(t){t[t.MIN=1]="MIN",t[t.MAX=-1]="MAX"})(S2||(S2={})),function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INSIDE=1]="INSIDE",t[t.OUTSIDE_IN=2]="OUTSIDE_IN",t[t.INSIDE_OUT=3]="INSIDE_OUT"}(Ou||(Ou={})),function(t){t[t.LEFT=0]="LEFT",t[t.BOTTOM=1]="BOTTOM",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP"}(om||(om={}));const bL=Yt();let B5=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=HR(),this._points=$Te(),this.lines=new Array(12),this._origin=A(),this._direction=A(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:A(),endpoint:null}}update(e){OTe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ye(this._origin,e.eye),ye(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ye(this._points[i],e[i]);ATe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return J_(this.frustum,e)}intersectsRay(e){return V7(this.frustum,e)}intersectsLineSegment(e,i){return FWe(this.frustum,e,i)}intersectsPoint(e){return z5(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;lj(this.lines[i],e[i],e[r]),lj(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),lj(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};var Xg;function lj(t,e,i){t.origin=e,t.endpoint=i,_x(t.direction,e,i)}B5.planePointIndices=kWe,B5.nearFarLineIndices=[[oi.NEAR_BOTTOM_LEFT,oi.FAR_BOTTOM_LEFT],[oi.NEAR_BOTTOM_RIGHT,oi.FAR_BOTTOM_RIGHT],[oi.NEAR_TOP_RIGHT,oi.FAR_TOP_RIGHT],[oi.NEAR_TOP_LEFT,oi.FAR_TOP_LEFT]],function(t){t[t.NEAR_FAR_BOTTOM_LEFT=0]="NEAR_FAR_BOTTOM_LEFT",t[t.NEAR_FAR_BOTTOM_RIGHT=1]="NEAR_FAR_BOTTOM_RIGHT",t[t.NEAR_FAR_TOP_RIGHT=2]="NEAR_FAR_TOP_RIGHT",t[t.NEAR_FAR_TOP_LEFT=3]="NEAR_FAR_TOP_LEFT",t[t.NEAR_BOTTOM=4]="NEAR_BOTTOM",t[t.NEAR_RIGHT=5]="NEAR_RIGHT",t[t.NEAR_TOP=6]="NEAR_TOP",t[t.NEAR_LEFT=7]="NEAR_LEFT",t[t.FAR_BOTTOM=8]="FAR_BOTTOM",t[t.FAR_RIGHT=9]="FAR_RIGHT",t[t.FAR_TOP=10]="FAR_TOP",t[t.FAR_LEFT=11]="FAR_LEFT"}(Xg||(Xg={}));const pZe=A(),xL=A();function fK(){return{direction:A(),up:A()}}function zTe(t,e,i,r,n){let s=Me(pZe,t),o=Te(s,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Te(e,r)),o<.99?(ye(s,e),a&&ue(s,s,-1)):s=null);let l=0;if(s){ue(xL,r,Te(r,s)),Ae(s,s,xL);const h=Te(s,n)/(Fe(s)*Fe(n));Ot(xL,s,n),l=(Te(xL,r)>0?1:-1)*vo(Ga(h))}const c=vo(Ga(-Te(r,t)/Fe(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}function VTe(t,e,i,r){Ae(ice,i,e),gSe(r,iSe(e,ice),t)||t===i||ye(t,i)}const ice=A(),BTe=Qe(0,1,0),jTe=Qe(0,0,1),_$=ut(),Xm=A(),Jm=A();function GTe(t,e,i,r=fK()){const{direction:n,up:s}=r;return D1e(_$,-Wt(e)),zE(_$,_$,Wt(i)),Mt(n,jTe,_$),ue(n,n,-1),Mt(s,BTe,_$),r}function fZe(t,e,i,r){return zTe(e,i,r,jTe,BTe)}function mZe(t,e,i,r){const n=GTe(t,i,r),s=A();return ue(s,n.direction,-e),xe(s,s,t),{up:n.up,eye:s,heading:i,tilt:r}}function gZe(t){return vo(t)}function yZe(t){return Wt(t)}function _Ze(t,e,i,r,n){const s=t.renderSpatialReference,o=t.spatialReference??e.spatialReference;return ec(e,Xm,s),ec(e,Jm,s),Xm[0]-=i/2,Jm[0]+=i/2,Xm[1]-=r/2,Jm[1]+=r/2,tc(Xm,s,Xm,o),tc(Jm,s,Jm,o),n?(n.xmin=Xm[0],n.ymin=Xm[1],n.xmax=Jm[0],n.ymax=Jm[1],n.spatialReference=o):n=new pr(Xm[0],Xm[1],Jm[0],Jm[1],o),n}function vZe(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,n=r.getAltitude(e),s=t.spatialReference,o=t.state.camera.eye,a=[],l=i.planes[mo.FAR];for(let c=0;c<4;c++){const h=i.lines[c];r.intersectInfiniteManifold(rf(h.origin,h.direction),n,xp)||wZe(xp,i,r,h.endpoint,n),VTe(xp,o,xp,l),a.push(ks(xp[0],xp[1]))}return bZe(hZe(a,r.extent),r,s)}function wZe(t,e,i,r,n){const s=e.lines[Xg.FAR_LEFT].direction,o=(n-i.getAltitude(r))/s[2];Us(t,r,s,o)}function bZe(t,e,i){const r=t.map(n=>(ve(xp,n[0],n[1],0),e.fromRenderCoords(xp,xp,i),[xp[0],xp[1]]));return r.length<=2?new Qp({spatialReference:i}):(r.push(r[0].slice()),aQ(r)||r.reverse(),new Qp({rings:[r],spatialReference:i}))}const xp=A(),xZe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:fZe,eyeForCenterWithHeadingTilt:mZe,eyeTiltToLookAtTilt:yZe,headingTiltToDirectionUp:GTe,lookAtTiltToEyeTilt:gZe,toArea:vZe,toExtent:_Ze},Symbol.toStringTag,{value:"Module"}));function xy(t,e,i){t.worldUpAtPosition(e,rce),Ae(cj,i,e);const r=Fe(cj);return r===0?0:Ga(Te(cj,rce)/r)}const rce=A(),cj=A();function nce(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return SZe(t,e.longitude,e.latitude,i.longitude,i.latitude)}function SZe(t,e,i,r,n){const s=Wt(i),o=Wt(n),a=s-o,l=Wt(e)-Wt(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*cd(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*h*h))*t;return Math.round(1e4*p)/1e4}function TZe(t,e,i){const r=e.spatialReference,n=xr(r),s=new wt(e.x,t.y,r),o=new wt(i.x,t.y,r),a=new wt(t.x,e.y,r),l=new wt(t.x,i.y,r);return{lon:nce(n.radius,s,o),lat:nce(n.radius,a,l)}}function EZe(t,e,i){const r=e/i,n=Wt(t),s=Math.sin(r/2),o=Math.cos(n),a=2*cd(Math.sqrt(s*s/(o*o)));return vo(a)}function CZe(t,e){return t/15}function sce(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=CZe(i);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}const HTe=Qe(0,0,1),qTe=Me(A(),Qe(1,1,1)),MZe=new Ev(-180,180),v$=ut(),P_=A(),vS=A();function WTe(t,e,i,r=fK()){Ot(P_,t,HTe),Te(P_,P_)===0&&Ot(P_,t,qTe),dd(v$,-Wt(e),t),Lu(v$,v$,-Wt(i),P_);const{up:n,direction:s}=r;return Ot(n,P_,t),Me(n,n),Mt(n,n,v$),Me(s,t),od(s,s),Mt(s,s,v$),r}function $Ze(t,e,i,r){const n=P_,s=vS;return Me(n,t),Ot(vS,n,HTe),Te(vS,vS)===0&&Ot(vS,n,qTe),Ot(s,vS,n),zTe(e,i,r,n,s)}function OZe(t,e,i,r){const n={eye:A(),up:null,tilt:r,heading:i},s=P_;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Wt(i),l=Wt(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),g=Math.cos(l),y=Fe(s);let w;if(Math.abs(l)<1e-8)w=o+y;else{const ge=y/p,ae=cd(o/ge),z=Math.PI-l-ae;w=ge*Math.sin(z)}const b=g*o,x=o*o*(p*p),T=h*h*x,M=w-b,$=M*M,R=T*(T+$-s[1]*s[1]);if(R<0)return ue(n.eye,s,w/y),n.tilt=0,SL(n,t);const I=Math.sqrt(R),P=s[1]*M,N=T+$;let V;if(V=h>0?-I+P:I+P,Math.abs(N)<1e-8)return y<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):ue(n.eye,s,w/y),n.tilt=0,uj(n.eye),SL(n,t);n.eye[1]=V/N;const U=c*c*x,B=p*o,W=h*B*n.eye[1],j=n.eye[1]*n.eye[1],Q=1-j,Z=Math.sqrt(Q),X=T*j+U-2*W*Z*M+Q*$;return Math.abs(X)<1e-8?(ue(n.eye,s,w/y),n.tilt=0,uj(n.eye),SL(n,t)):(n.eye[0]=(Q*(w*s[0]-b*s[0])-B*Z*(s[0]*n.eye[1]*h+s[2]*c))/X,n.eye[2]=(Q*(w*s[2]-b*s[2])-B*Z*(s[2]*n.eye[1]*h-s[0]*c))/X,ue(n.eye,n.eye,w),uj(n.eye),SL(n,t))}function uj(t){const e=t[1];t[1]=-t[2],t[2]=e}function SL(t,e){const i=WTe(e,t.heading,t.tilt);return t.up=i.up,t}function AZe(t,e,i){const r=Fe(e),n=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),s=cd(i/(n/Math.sin(t)));return vo(t-s)}function RZe(t,e,i){const r=Wt(t),n=Fe(e);return cd(i/(n/Math.sin(r)))+r}function IZe(t,e,i,r,n){let s,o,a,l;const c=e.latitude,h=xr(t.spatialReference).radius,p=e.longitude,g=EZe(c,i,h)/2;s=p-g,o=p+g;const y=Wt(c),w=(1+Math.sin(y))/(1-Math.sin(y)),b=(w+1)*Math.tan(r/h/2),x=b*b;function T($){const R=Math.PI/2;return($=q6e.normalize($,-R))>R&&($=Math.PI-$),$}if(a=1.5*Math.PI-2*Math.atan(.5*(b+Math.sqrt(4*w+x))),l=a+r/h,a=T(a),l=T(l),l<a){const $=l;l=a,a=$}if(a=Math.max(vo(a),-90),l=Math.min(vo(l),90),o=MZe.monotonic(s,o),o-s>180){const $=(o-s-180)/2;s+=$,o-=$}const M=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:nt.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=M):n=new pr(s,a,o,l,M),t.spatialReference&&t.spatialReference.isWebMercator&&DA(n,!1,n),n}function PZe(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,n=r.getAltitude(e),s=t.spatialReference,o=r.referenceEllipsoid.radius,a=t.state.camera,l=a.eye,c=1+Nr(l,e)/(o+n),h=Math.sqrt(c*c-1),{minCurvature:p,maxCurvature:g,minSamples:y,maxSamples:w}=FZe,b=NZe(t),x=Oe((h-p)/(g-p),0,1),T=Math.round(Bt(y,w,x)),M=a.aboveGround,$=i.planes[mo.FAR],R=[],I=tC(ws,kZe,dn()),P=tC(ws,UZe,dn());_n(hj,0,0,0,0);const N=U=>{};for(let U=0;U<4;U++){const B=U===Xg.NEAR_FAR_BOTTOM_RIGHT&&!M||U===Xg.NEAR_FAR_TOP_LEFT&&M?1-b:0,W=U===Xg.NEAR_FAR_BOTTOM_RIGHT&&M||U===Xg.NEAR_FAR_TOP_LEFT&&!M?b:1,j=i.lines[U],Q=i.lines[U===3?0:U+1];for(let Z=0;Z<T;Z++){const X=Z/T,ge=U===Xg.NEAR_FAR_BOTTOM_RIGHT?1-(1-X)**2:U===Xg.NEAR_FAR_TOP_LEFT?X**2:X,ae=Z===0?0:Bt(B,W,ge),z=br(VZe,j.origin,Q.origin,ae),he=pSe(j.direction,Q.direction,ae,zZe);r.intersectManifoldClosestSilhouette(rf(z,he),n,Vl),VTe(Vl,l,Vl,$),R.push(En(Vl)),R.length!==0&&N(Xb(R.at(-1),Vl));const ce=(A5(I,Vl)?1:0)|(A5(P,Vl)?2:0);hj[ce]=1}}R.length>2&&N(Xb(R[0],R.at(-1)));const V=LZe(ZU(hj)>1?DZe(ZTe(R,I),P):[R],r,s);return new Qp({rings:V,spatialReference:s})}function LZe(t,e,i){const r=2*Bo();return t.map(n=>{const s=[];let o=!1;for(const a of n)e.fromRenderCoords(a,Vl,i),Math.abs(a[0])<r&&Math.abs(a[1])<r?(s.push([null,Vl[1]]),s.push([null,Vl[1]]),o=!0):s.push([Vl[0],Vl[1]]);if(o)for(let a=0;a<s.length;a++){const l=s[a];if(l[0]!=null)continue;const c=s[a+1],h=s.at(a===0?-1:a-1);l[0]=h[0],a++;const p=s.at(a===s.length-1?0:a+1);c[0]=p[0]}return s.push(s[0]),aQ(s)||s.reverse(),s})}function DZe(t,e){const i=[];for(const r of t)i.push(...ZTe(r,e));return i}function ZTe(t,e){const i=[],r=[],n=Bo();for(let o=0;o<t.length;o++){const a=t[o],l=o===t.length-1?t[0]:t[o+1],c=GN(a,l,BZe),h=Z3(e,c.origin,c.vector,Gp.NONE,Vl);switch(h){case ql.INSIDE:i.push(a);break;case ql.OUTSIDE:r.push(a);break;case ql.INTERSECTS_INSIDE_OUT:case ql.INTERSECTS_OUTSIDE_IN:{const[p,g,y]=h===ql.INTERSECTS_INSIDE_OUT?[1,i,r]:[-1,r,i],w=e,b=Us(A(),Vl,w,p*n),x=Us(A(),Vl,w,p*-n);g.push(a),g.push(b),y.push(x)}}}const s=[];return i.length&&s.push(i),r.length&&s.push(r),s}function NZe(t){const{renderCoordsHelper:e,state:{camera:i}}=t,{center:r,eye:n}=i,s=Math.abs(e.getAltitude(r)),o=Math.abs(Math.PI/2-xy(e,r,n));return XC(oce,e.referenceEllipsoid.radius+s),rK(oce,o,i.distance,i.fovY)}const FZe={minCurvature:Wt(5),maxCurvature:Wt(50),minSamples:1,maxSamples:6},kZe=Qe(1,0,0),UZe=Qe(0,1,0),zZe=A(),VZe=A(),Vl=A(),oce=Pn(),BZe=Uy(),hj=Ti(),jZe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:$Ze,eyeForCenterWithHeadingTilt:OZe,eyeTiltToLookAtTilt:RZe,headingTiltToDirectionUp:WTe,lookAtTiltToEyeTilt:AZe,toArea:PZe,toExtent:IZe},Symbol.toStringTag,{value:"Module"}));function j5(t){return t.type==="point"}let GZe=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function YTe(t){return"array"in t}function am(t,e,i="ground"){if(j5(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(YTe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}const mK=()=>de.getLogger("esri.views.3d.support.cameraUtils"),XTe=39.37,JTe=96,HZe=JTe*XTe,j7=1,qZe=8,WZe=5,QTe=1,ZZe={heading:0,tilt:0},qA=A(),YZe=new Ev(-20037508342788905e-9,20037508342788905e-9),XZe=new Ev(-180,180);var yo;function Yv(t){return t.spatialReference??nt.WGS84}function Xv({state:t}){return t.isGlobal?jZe:xZe}function JZe(t,e,i,r,n){return Xv(t).headingTiltToDirectionUp(e,i,r,n)}function em(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=Xv(t).headingTiltToDirectionUp,n=A();if(!ec(e.position,n,i))return null;const s=r(n,e.heading,e.tilt);ue(s.direction,s.direction,t.state.camera.distance),xe(s.direction,s.direction,n);const o=Ex(t,n,s.direction,s.up);return o.fov=Wt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(yo||(yo={}));const wS=A();function sC(t,e,i){const r=t.renderSpatialReference,n=J3(t,e.eye,e.viewForward,e.up,ZZe);let s=Yv(t);return tc(e.eye,r,wS,s)||(s=nt.WGS84,tc(e.eye,r,wS,s)),i==null?i=new Hc(new wt(wS,s),n.heading,n.tilt,vo(e.fov)):(i.position.x=wS[0],i.position.y=wS[1],i.position.z=wS[2],i.position.spatialReference=s,i.heading=n.heading,i.tilt=n.tilt,i.fov=vo(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function qR(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper;return i.width/2/i.pixelRatio/(JTe*XTe/(e/=r))/Math.tan(i.fovX/2)}function ex(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper,n=e*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;return HZe/(s/n)*r}function KTe(t,e,i,r){const n=r.levelAtScale(e),s=e2e(J3(t,i.eye,i.viewForward,i.up).tilt),o=Math.max(n-s,0);return r.scaleAtLevel(o)}function ace(t,e,i){const r=i.levelAtScale(t),n=e2e(e);return i.scaleAtLevel(r+n)}function e2e(t){return 2*((t>90?180-t:t)/90)**2}function QZe(t,e,i){var o,a,l,c;const r=(o=t.basemapTerrain)==null?void 0:o.tilingScheme;if(!r)return 0;if(i==null){const h=(l=(a=t.pointsOfInterest)==null?void 0:a.cameraOnSurface)==null?void 0:l.renderLocation;i=(h&&((c=t.renderCoordsHelper)==null?void 0:c.getAltitude(h)))??0}const n=xr(t.spatialReference).radius,s=t.state.viewingMode===ct.Local?e.eye[2]:Fe(e.eye)-n;return KTe(t,ex(t,Math.abs(s-i)),e,r)}function KZe(t,e,i){const r=em(t,e);return r?QZe(t,r,i):0}const eYe=1,tYe=100;function iYe(t,e,i,r,n){var h;if(e===0)return 0;const s=Nr(i.eye,r),o=(h=t.basemapTerrain)==null?void 0:h.tilingScheme;if(!o)return mK().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),s;let a=s;const l=J3(t,i.eye,i.viewForward,i.up),c=l.tilt>90;if(t.state.viewingMode===ct.Local){const p=(qR(t,ace(e,l.tilt,o))-Math.abs(i.eye[2]-n[2]))/Math.cos(Wt(l.tilt));a=c?a-p:a+p}else{let p=1/0,g=0,y=WR(t,l.heading,l.tilt,r,s,yo.ADJUST);if(!y)return a;const w=Fe(n);for(;p>eYe&&g<tYe;){const b=Fe(y.eye),x=c?180-y.tilt:y.tilt,T=Wt(x),M=Math.sin(T)*b,$=Math.cos(T)*b,R=qR(t,ace(e,y.tilt,o)),I=c?w-R:w+R,P=cd(M/I),N=Math.cos(P)*I-$,V=Nr(y.eye,r);a=c?V-N:V+N,y=WR(t,l.heading,l.tilt,r,a,yo.ADJUST);const U=yK(t,y,vo(i.fov));if(!y||!U)return a;const B=KZe(t,U,w-xr(t.spatialReference).radius);p=Math.abs(e-B),++g}}return a}async function rYe(t,e,i,r,n,s){return mz(t,e,qR(t,i),r,n,s)}function nYe(t,e,i,r,n,s){return yK(t,WR(t,r.heading,r.tilt,e,i,n),r.fov,s)}async function mz(t,e,i,r,n,s){const o=await i2e(t,r.heading,r.tilt,e,i,n,s);return zt(s),f2e(t,o,r.fov,s)}function J3(t,e,i,r,n){return Xv(t).directionToHeadingTilt(e,i,r,n)}function t2e(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,qA,t.spatialReference)&&t.elevationProvider&&(am(t.elevationProvider,qA)??0)>qA[2]-QTe)}async function sYe(t,e,i){if(t2e(t,e))return!0;const{elevationProvider:r,spatialReference:n,renderCoordsHelper:s}=t;if(r==null||!s.fromRenderCoords(e,qA,n))return!1;const[o,a,l]=qA,c=await r.queryElevation(o,a,l,n,"ground",i)??0;return zt(i),c>l-QTe}async function oYe(t,e,i){const r=A();if(e==null)return ye(r,t.state.camera.center);if(e instanceof wt){const{renderSpatialReference:n,basemapTerrain:s,elevationProvider:o}=t,a=e.spatialReference;if(await E5(e,r,n,0,{signal:i}),zt(i),e.z==null&&s!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);zt(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return ye(r,e)}function aYe(t,e){const i=A();if(e==null)return ye(i,t.state.camera.center);if(e instanceof wt){if(!ec(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:n}=t;if(e.z==null&&r!=null&&n!=null){const s=am(n,e);s!=null&&t.renderCoordsHelper.setAltitude(i,s)}return i}return ye(i,e)}function WR(t,e,i,r,n,s){return r2e(t,e,i,r instanceof wt?r:null,aYe(t,r),n,s)}async function i2e(t,e,i,r,n,s,o){const a=r instanceof wt?r:null,l=await oYe(t,r,o);return zt(o),n2e(t,e,i,a,l,n,s,o)}function r2e(t,e,i,r,n,s,o){if(n==null||!r&&(r=new wt({spatialReference:Yv(t)}),!Tx(n,t.renderSpatialReference,r)))return null;const a=s2e(t,e,i,n,s,o);if(o2e(t,i,o)&&t2e(t,a.eye)){const{tilt:l,mode:c}=a2e(t,i,n,s);return r2e(t,e,l,r,n,s,c)}return l2e(a,n)}async function n2e(t,e,i,r,n,s,o,a){r||(r=new wt({spatialReference:Yv(t)}),await hTe(n,t.renderSpatialReference,r,{signal:a})||(r=null)),zt(a);const l=s2e(t,e,i,n,s,o);if(o2e(t,i,o)&&await sYe(t,l.eye,a)){zt(a);const{tilt:c,mode:h}=a2e(t,i,n,s);return n2e(t,e,c,r,n,s,h,a)}return l2e(l,n)}function s2e(t,e,i,r,n,s){const o=uYe(t,e,i,r,n=Math.max(n,t.state.constraints.minimumPoiDistance),s);return(0,Xv(t).eyeForCenterWithHeadingTilt)(r,n,o.heading,o.tilt)}function o2e(t,e,i){const r=t.map.ground.navigationConstraint;return i===yo.ADJUST&&t.state.isGlobal&&e>0&&(r==null||r.type==="stay-above")}function a2e(t,e,i,r){const n=p2e(t,i,r,dYe(t,r,e,i));return{tilt:n,mode:e-n<1?yo.LOCKED:yo.ADJUST}}function l2e(t,e){return{...t,center:En(e)}}function c2e(t,e){const{state:i,spatialReference:r}=t,n=e.spatialReference;return i.isGlobal&&zR(n,ct.Global)||i.isLocal&&r.equals(n)}function u2e(t,e){let i,r,n;if(t.state.isGlobal){const h=new wt(e.xmin,e.ymin,e.spatialReference),p=new wt(e.xmax,e.ymax,e.spatialReference),g=e.spatialReference.isGeographic?XZe:YZe;i=new wt({x:g.center(h.x,p.x),y:(p.y+h.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const y=xr(e.spatialReference),w=TZe(i,h,p);r=w.lon,n=w.lat,g.diff(h.x,p.x)>g.range/2&&(r+=y.halfCircumference),r=Math.min(r,y.halfCircumference),n=Math.min(n,y.halfCircumference)}else{const h=t.renderSpatialReference??e.spatialReference;h.equals(e.spatialReference)||(e=Hv(e,h)),r=e.xmax-e.xmin,n=e.ymax-e.ymin;const p=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new wt({x:e.xmin+.5*r,y:e.ymin+.5*n,z:p,spatialReference:h})}const s=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*n*l,.5*s*c)/j7}}async function h2e(t,e,i,r,n,s){const o=c2e(t,e)?e:await Av(e,t.spatialReference,{signal:s});zt(s);const{center:a,distance:l}=u2e(t,o),c=await i2e(t,i,r,a,l,n,s);return zt(s),f2e(t,c,t.camera.fov,s)}function JN(t,e,i,r,n,s){let o;try{o=c2e(t,e)?e:Hv(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=u2e(t,o),c=WR(t,i,r,a,l,n);return c==null?null:yK(t,c,t.camera.fov,s)}function d2e(t,e,i){const r=t.renderSpatialReference,n=new wt({spatialReference:Yv(t)});if(!Tx(i,r,n))return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=Na(e.eye,i),l=2*a*s*j7,c=2*a*o*j7;return Xv(t).toExtent(t,n,l,c)}function lYe(t,e){return Xv(t).toArea(t,e)}function cYe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>qZe)return!0;const n=e,s=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return Nr(n,s)/(Math.tan(.5*t.state.camera.fov)*r)>WZe}function uYe(t,e,i,r,n,s){let o=0;return s===yo.ADJUST&&cYe(t,r,n)?(e=0,o=hYe(t,n,i,r)):o=gK(t,r,n,i),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:i=p2e(t,r,n,o)}}const G5=.7;function hYe(t,e,i,r){const n=gK(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-G5)+s.max*G5;return Math.min(n,o)}function dYe(t,e,i,r){let n=gK(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-G5)+n*G5}function p2e(t,e,i,r){return Xv(t).lookAtTiltToEyeTilt(r,e,i)}function gK(t,e,i,r){return Xv(t).eyeTiltToLookAtTilt(r,e,i)}function yK(t,e,i,r){if(e==null)return null;const n=t.renderSpatialReference,s=new wt({spatialReference:Yv(t)});return Tx(e.eye,n,s)?(r??(r=new Hc),r.position=s,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function f2e(t,e,i,r){const n=t.renderSpatialReference,s=new wt({spatialReference:Yv(t)});return await hTe(e.eye,n,s,{signal:r}),zt(r),new Hc(s,e.heading,e.tilt,i)}function pYe(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);mK().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function m2e(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);mK().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}const _K=()=>de.getLogger("esri.layers.support.ElevationSampler");let g2e=class{queryElevation(e){return y2e(e.clone(),this)}on(){return Ui()}projectIfRequired(e,i){return _2e(e,i)}},fYe=class extends g2e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const n=e.tile.extent;this.extent=CU(n,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=Ql(i.spatialReference),o=i.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return MU(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,n=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return _K().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},XPt=class extends g2e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let n;super(),typeof i=="number"?(this.noDataValue=i,n=null):(n=i,this.noDataValue=r),this.samplers=n?e.map(o=>new fYe(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=CU(Zi(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){let r,n=!1;for(const s of this.samplers)if(s.containsAt(e,i)&&(n=!0,r=s.elevationAt(e,i),r!==s.noDataValue))return r;return r??(n||_K().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};function y2e(t,e){const i=_2e(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":mYe(t,i,e);break;case"polyline":gYe(t,i,e);break;case"multipoint":yYe(t,i,e)}return t}function _2e(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=k3(t,e);return r||_K().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function mYe(t,e,i){t.z=i.elevationAt(e.x,e.y)}function gYe(t,e,i){rm.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];rm.x=c[0],rm.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(rm.x,rm.y)}}t.hasZ=!0}function yYe(t,e,i){rm.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];rm.x=o[0],rm.y=o[1],r&&(s[3]=s[2]),s[2]=i.elevationAt(rm.x,rm.y)}t.hasZ=!0}const rm=new wt;var G7;let Df=G7=class extends we{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new G7({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Df.prototype,"cols",void 0),u([f({type:Wi,json:{write:!0}})],Df.prototype,"level",void 0),u([f({type:String,json:{write:!0}})],Df.prototype,"levelValue",void 0),u([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Df.prototype,"origin",void 0),u([f({type:Number,json:{write:!0}})],Df.prototype,"resolution",void 0),u([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Df.prototype,"rows",void 0),u([f({type:Number,json:{write:!0}})],Df.prototype,"scale",void 0),Df=G7=u([L("esri.layers.support.LOD")],Df);const Sp=Df;let _Ye=class{constructor(e,i,r,n,s=void 0){this.id=e,this.level=i,this.row=r,this.col=n,this.extent=s}};var r_;const lce=new sr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Aa=r_=class extends we{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:n=nt.WebMercator,numLODs:s=24}=t;if(!Rp(n)){const p=[];if(i)for(let g=0;g<i.length;g++){const y=i[g];p.push(new Sp({level:g,scale:y,resolution:y}))}else{let g=5e-4;for(let y=s-1;y>=0;y--)p.unshift(new Sp({level:y,scale:g,resolution:g})),g*=2}return new r_({dpi:96,lods:p,origin:new wt(0,0,n),size:[r,r],spatialReference:n})}const o=cy(n),a=t.origin?new wt({x:t.origin.x,y:t.origin.y,spatialReference:n}):new wt(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(Ql(n)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const g=i[p],y=g*c;h.push(new Sp({level:p,scale:g,resolution:y}))}else{let p=N3(n)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const g=Math.ceil(s/e);h.push(new Sp({level:0,scale:p,resolution:p*c}));for(let y=1;y<g;y++){const w=p/2**e,b=w*c;h.push(new Sp({level:y,scale:w,resolution:b})),p=w}}return new r_({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=cy(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return wt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],n=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(s=>{r.push(s.scale),e=s.scale>e?s.scale:e,i=s.scale<i?s.scale:i,n[s.level]=s})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const n=e[r],s=e[r+1];if(n<=t)return r;if(s===t)return r+1;if(n>t&&s<t)return r+Math.log(n/t)/Math.log(n/s)}return r}tileAt(t,e,i,r){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=i;else if(xs(e.spatialReference,this.spatialReference))s=e.x,o=e.y,r=i;else{const c=k3(e,this.spatialReference);if(c==null)return null;s=c.x,o=c.y,r=i}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return r||(r=new _Ye(null,0,0,0,Zi())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=r_.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===r_.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,n=i.resolution*this.size[0]/2**r,s=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Zi()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,n=r*this.size[0],s=r*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return r_.fromJSON(this.write({}))}getCompatibleForVTL(t){if(this.size[0]!==this.size[1]||this.size[0]===256&&t===512)return null;const e=(this.size[0]===512&&t===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===t&&e===0)return this;const i=[],r=this.lods.length-e;for(let n=0;n<r;n++){const s=n+e,{scale:o,resolution:a}=s>=0?this.lods[s]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new Sp({level:n,scale:o,resolution:a}))}return new r_({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};u([f({type:Number,json:{write:!0}})],Aa.prototype,"compressionQuality",void 0),u([f({type:Number,json:{write:!0}})],Aa.prototype,"dpi",void 0),u([f({type:String,json:{read:lce.read,write:lce.write,origins:{"web-scene":{read:!1,write:!1}}}})],Aa.prototype,"format",void 0),u([f({readOnly:!0})],Aa.prototype,"isWrappable",null),u([f({type:wt,json:{write:!0}})],Aa.prototype,"origin",void 0),u([Pe("origin")],Aa.prototype,"readOrigin",null),u([f({type:[Sp],value:null,json:{write:!0}})],Aa.prototype,"lods",null),u([f({readOnly:!0})],Aa.prototype,"scales",void 0),u([f({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Aa.prototype,"size",void 0),u([Pe("size",["rows","cols"])],Aa.prototype,"readSize",null),u([ke("size",{cols:{type:Wi},rows:{type:Wi}})],Aa.prototype,"writeSize",null),u([f({type:nt,json:{write:!0}})],Aa.prototype,"spatialReference",void 0),Aa=r_=u([L("esri.layers.support.TileInfo")],Aa),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Aa||(Aa={}));const QN=Aa,vYe=12;let Lc=class yc{constructor(e){const i=yc.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=N3(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const n=r.lods.reduce((c,h)=>(h.level<c.minLod.level&&(c.minLod=h),c.max=Math.max(c.max,h.level),c),{minLod:r.lods[0],max:-1/0}),s=n.minLod,o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new yc(this.toTileInfo())}toTileInfo(){return new QN({dpi:this.dpi,origin:new wt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Sp({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+r*o,n[2]=this.origin[0]+(r+1)*o,n[3]=this.origin[1]-i*a,n[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Coe(e[0]),i[1]=r9(e[1]),i[2]=Coe(e[2]),i[3]=r9(e[3])):this._isGCS&&(i[0]=Wt(e[0]),i[1]=Wt(e[1]),i[2]=Wt(e[2]),i[3]=Wt(e[3]))}getExtentGeometry(e,i,r,n=new pr){return this.getExtent(e,i,r,_f),n.spatialReference=this.spatialReference,n.xmin=_f[0],n.ymin=_f[1],n.xmax=_f[2],n.ymax=_f[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:n}=this.levels[this.levels.length-1],s=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:n/2,tileSize:[s,s]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(yc.checkUnsupported(e))return!1;const r=new yc(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const n=Math.min(this.levels.length-1,r.levels.length-1,i),s=this.levels[n].resolution;let o=.5*s;return!lv(r.origin[0],this.origin[0],o)||!lv(r.origin[1],this.origin[1],o)?!1:(o=.5*s/2**n/this.pixelSize*vYe,lv(s,r.levels[n].resolution,o))}rootTilesInExtent(e,i=null,r=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;yc.computeRowColExtent(e,s,this.origin,_f);let o=_f[1],a=_f[3],l=_f[0],c=_f[2];const h=c-l,p=a-o;if(h*p>r){const g=Math.floor(Math.sqrt(r));p>g&&(o=o+Math.floor(.5*p)-Math.floor(.5*g),a=o+g),h>g&&(l=l+Math.floor(.5*h)-Math.floor(.5*g),c=l+g)}for(let g=o;g<a;g++)for(let y=l;y<c;y++)n.push([0,g,y]);return i!=null&&(i[0]=this.origin[0]+l*s[0],i[1]=this.origin[1]-a*s[1],i[2]=this.origin[0]+c*s[0],i[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,i,r,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-r[0])/i[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-r[0])/i[0])),n[1]=Math.max(0,Math.floor((r[1]-e[3]+s)/i[1])),n[3]=Math.max(0,Math.ceil((r[1]-e[1]-s)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(n=>!zUe(n.resolution,r/2**n.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,n)=>r-n);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new Y("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?vK():e.lods.length<1?new Y("tilingscheme:generic","Tiling scheme must have at least one level"):yc.isPowerOfTwo(e)?yc.hasGapInLevels(e)?new Y("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):yc.tileSizeSupported(e)?yc.hasOriginPerLODs(e)?new Y("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new Y("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new Y("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],n=e[3]-e[1],s=Ql(i),o=1.2*Math.max(r,n),a=256,l=o/a,c=l*s*(96/.0254),h=new yc(new QN({size:[a,a],origin:new wt({x:e[0]-.5*(o-r),y:e[3]+.5*(o-n)}),lods:[new Sp({level:0,resolution:l,scale:c})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const i=new yc(yc.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const n=256/i,s=new yc(new QN({size:[i,i],origin:new wt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Sp({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(r),s}get test(){}};function vK(){return new Y("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Lc.WebMercatorAuxiliarySphereTileInfo=new QN({size:[256,256],origin:new wt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:nt.WebMercator}),spatialReference:nt.WebMercator,lods:[new Sp({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Lc.WebMercatorAuxiliarySphere=Lc.makeWebMercatorAuxiliarySphere(19);const _f=Zi(),T2=64,bO=512,wYe=2.5,wK=VUe(f9/10),v2e=2,w2e=Zi();Lc.WebMercatorAuxiliarySphere.getExtent(0,0,0,w2e);const bYe=Zi([-180,-90,180,90]),xYe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",SYe="Surface extent is too large for tile resolution at level 0.",Ds=4;let n_=class extends ns.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=wK}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const i=CU(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??nt.WGS84}elevationAt(e,i){var r;if(this.extent==null||!dl(this.extent,e,i)){const n=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return de.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return y2e(e.clone(),this)}};u([f({readOnly:!0})],n_.prototype,"demResolution",void 0),u([f({readOnly:!0})],n_.prototype,"extent",null),u([f({readOnly:!0})],n_.prototype,"noDataValue",void 0),u([f()],n_.prototype,"spatialReference",null),u([f({constructOnly:!0})],n_.prototype,"view",void 0),n_=u([L("esri.views.support.GroundViewElevationSampler")],n_);const TYe=n_;let mg=class extends Ne{constructor(e){super(e),this.view=null,this.layerViews=new ot}initialize(){this.addHandles(Kl(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new TYe({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?d2e(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>oe(()=>e.updating,()=>this._updateUpdating(),xi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([f({readOnly:!0})],mg.prototype,"elevationSampler",null),u([f({readOnly:!0})],mg.prototype,"extent",null),u([f({type:Boolean,readOnly:!0})],mg.prototype,"updating",null),u([f({constructOnly:!0})],mg.prototype,"view",void 0),u([f({type:ot,readOnly:!0})],mg.prototype,"layerViews",void 0),u([f({readOnly:!0})],mg.prototype,"suspended",null),mg=u([L("esri.views.GroundView")],mg);const EYe=mg,CYe=pe("mac")?"Meta":"Control",MYe=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),$Ye=t=>MYe.has(t);let OYe=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},qo=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let n;typeof i=="function"?(r=i,n=[]):n=i||[];const s=typeof e=="string"?new OYe(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const g=p.indexOf(h);p.splice(g,1),o(),this._manager&&this._manager.updateDependencies()}},l=new AYe(s,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new RYe(e,{onEmit:(r,n,s,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,n,s,o)},onRemove:r=>{var n;delete this._outgoing[r.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const n of i)if(n.match.matches(e)&&((r=n.callback)==null||r.call(n,e),e.shouldStopPropagation()))break}}},AYe=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},RYe=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},IYe=class extends qo{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>this._update(i.data))}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:n}=e;i===this._value&&this._x===r&&this._y===n||(this._value=i,this._x=r,this._y=n,this._onChange(i,r,n))}},PYe=class extends qo{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Xl(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Sy=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const n=e[r],s=new L_e(n,void 0,void 0,2,2);this._properties[r]={pool:s,acquired:[]}}this._afterDispatchHandle=Z_e(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)eoe(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let n=r.pool.acquire();for(r.acquired.push(n);n===i;)r.acquired.push(n),n=r.pool.acquire();return n}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const n of i.acquired)eoe(n)?i.acquired[r++]=n:i.pool.release(n);i.acquired.length=r}}},yh=class extends Ne{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=CYe,this._latestPointerType="mouse",this._propertiesPool=new Sy({latestPointerLocation:NYe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=pv.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const n={name:e,handlers:i.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var n;r.removed=!0,(n=r.uninstallCallback)==null||n.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):de.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const n=this._handlers[r];n.priorityIndex=r,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const n=this._handlersPriority[r];n.priorityIndex=r;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)$Ye(a)||i.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==i||n.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=i,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const s=i;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,n=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,n)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const n=()=>{r||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),r=!0)},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=i.native;s("Alt",!!(o!=null&&o.altKey)),s("Control",!!(o!=null&&o.ctrlKey)),s("Ctrl",!!(o!=null&&o.ctrlKey)),s("Shift",!!(o!=null&&o.shiftKey)),s("Meta",!!(o!=null&&o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new IYe((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new PYe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],pv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,pv.INTERNAL)}_setPointerCapture(e,i,r,n){const s=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,n){this._emitInputEvent(0,e,i,r,n)}_emitInputEvent(e,i,r,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new LYe(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new S5,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r,n;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:s,priorityIndex:o}=e.events.pop(),a=(i=s.data)==null?void 0:i.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((n=(r=e.currentHandler).eventCallback)==null||n.call(r,s)),s.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new S5;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const n of i.handler.incomingEventMatches){if(r.eventType!==n.eventType)continue;const s=r.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===r.keyModifiers.length!=(s.length===n.keyModifiers.length))return r.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let n=0;for(;n<i.length&&this._compareHandlerPriority(r,i[n])>=0;)n++;i.splice(n,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>this._onEventReceived(i,r))},disablePointerCapture:e}}};u([f({readOnly:!0})],yh.prototype,"hasPendingInputs",null),u([f({constructOnly:!0})],yh.prototype,"eventSource",void 0),u([f({constructOnly:!0})],yh.prototype,"recognizers",void 0),u([f()],yh.prototype,"_latestPointerType",void 0),u([f()],yh.prototype,"latestPointerType",null),u([f()],yh.prototype,"multiTouchActive",null),u([f({readOnly:!0})],yh.prototype,"latestPointerLocation",void 0),u([f()],yh.prototype,"_paused",void 0),u([f({readOnly:!0})],yh.prototype,"updating",null),yh=u([L("esri.views.input.InputManager")],yh);let LYe=class{constructor(e,i,r,n,s){this.type=e,this.data=i,this.timestamp=r,this.modifiers=n,this.cancelable=s,this._propagationState=L_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=L_.STOPPED}shouldStopPropagation(){return!!(this._propagationState&L_.STOPPED)}async(e){this._propagationState|=L_.PAUSED;const i=(r,n)=>{this._propagationState&=~L_.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&L_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var L_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(L_||(L_={}));const pv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let DYe=class{};const NYe=DYe;function R0(t){return t!=null&&"open"in t&&"declaredClass"in t}function cce(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const FYe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([oe(()=>[this.ui,this.popup],([i,r],n)=>{const s="popup",o="manual";if(n){const[a,l]=n;a&&R0(l)&&(l.view=null,cce(l)&&a.remove(l,s))}i&&R0(r)&&(r.view=this,cce(r)&&i.add(r,{key:s,position:o,internal:!0}))},Si),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(R0(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),R0(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},pv.WIDGET)]),kE(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{fe(()=>import("./Popup-C0qv6WTK.js"),__vite__mapDeps([96,1,97,18,98,99,55,31,32,53,54,100,34,101,67,66]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(R0(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void de.getLogger(this).error(new Y("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),R0(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!R0(this.popup))return this._popupSetupTask=Ny(async r=>{const{default:n}=await fe(()=>import("./Popup-C0qv6WTK.js"),__vite__mapDeps([96,1,97,18,98,99,55,31,32,53,54,100,34,101,67,66]));if(zt(r),!this.popup||R0(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new n(s)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},n){const s=[],o=[];let a=!1;const l=$Fe(n,pe("popup-view-fetch-timeout")??UYe),c=g=>{const y=new kYe(g);return o.push(y),s.push(y.promise),y},h=g=>{const y=o.at(-1);return y&&y.layerView===g&&!a?y:c(g)};for(const g of r)"graphic"in g?(h(g.layerView).graphics.push(g.graphic),a=!1):(s.push(g.layerView.fetchPopupFeaturesAtLocation(g.mapPoint,l)),a=!0);o.map(g=>g.resolve(l));const p=CFe(s).then(g=>g.filter(y=>!!y).flat());return{pendingFeatures:s,allGraphicsPromise:p,location:i}}async _getPopupHits(i,r){const{hits:n,location:s}=await this.popupHitTest(i);zt(r);const o=[];for(const a of n)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:s}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r==null?void 0:r.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return u([f()],e.prototype,"popup",void 0),u([f()],e.prototype,"popupEnabled",void 0),e=u([L("esri.views.PopupView")],e),e};let kYe=class{constructor(e){this.layerView=e,this._resolver=Ho(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:n}=this;if(!i)return n.resolve(r),n.promise;let s;return i.fetchPopupFeaturesFromGraphics(r,e).catch(o=>(s=o,null)).then(o=>{o?n.resolve(o):n.reject(s)}),n.promise}};const UYe=5e3;async function bK(t,e){const{WhereClause:i}=await fe(()=>import("./WhereClause-CR5MzVSq.js").then(r=>r.W),__vite__mapDeps([33,34]));return i.create(t,{fieldsIndex:e})}function zYe(t,e){return t==="1=1"?e??t:e==="1=1"?t??e:t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}function xK(t){return typeof t=="string"||t instanceof String}var cE;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(cE||(cE={}));const VYe=[cE.HMS_MS,cE.HMS,cE.HM,"TT"],BYe="yyyy-MM-dd";cE.HMS;function uce(t){if(!t||!xK(t))return null;const e=ai.fromFormat(t,BYe);return e.isValid?e:null}function hce(t){return t&&xK(t)?JNe(VYe,e=>{const i=ai.fromFormat(t,e);return i.isValid?i:null})??null:null}function dce(t){if(!t||!xK(t))return null;const e=ai.fromISO(t);return e.isValid?e:null}var oC;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(oC||(oC={}));const jYe=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function GYe(t){return t!=null&&jYe.has(t.type)}function b2e(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function x2e(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function S2e(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function HYe(t,e,i){const r=t==null?void 0:t.domain;if(!r)return null;switch(r.type){case"range":{const{min:n,max:s}=T2e(t);if(n!=null&&+e<n||s!=null&&+e>s)return oC.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(n=>n==null||n.code!==e))return oC.INVALID_CODED_VALUE}return null}function T2e(t,e){const i=t==null?void 0:t.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,n="range"in i?i.range[1]:i.maxValue,s=GYe(t);return b2e(t)||S2e(t)||x2e(t)?{...qYe(t,n,r),isInteger:s}:{min:r!=null&&typeof r=="number"?r:null,max:n!=null&&typeof n=="number"?n:null,rawMin:r,rawMax:n,isInteger:s}}function qYe(t,e,i){var r,n,s,o,a,l;return b2e(t)?{min:(r=uce(i))==null?void 0:r.toMillis(),max:(n=uce(e))==null?void 0:n.toMillis(),rawMin:i,rawMax:e}:S2e(t)?{min:(s=hce(i))==null?void 0:s.toMillis(),max:(o=hce(e))==null?void 0:o.toMillis(),rawMin:i,rawMax:e}:x2e(t)?{min:(a=dce(i))==null?void 0:a.toMillis(),max:(l=dce(e))==null?void 0:l.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}const WYe=()=>de.getLogger("esri.support.arcadeOnDemand");let dj;function Dv(){return dj||(dj=(async()=>{const t=await fe(()=>import("./arcadeUtils-eOSMY2XH.js").then(e=>e.i),__vite__mapDeps([102,103,34,104,100,40,105]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),dj}const ZYe=(t,e,i)=>SK.create(t,e,i,null,["$feature","$view"],[]),YYe=(t,e,i)=>SK.create(t,e,i,null,["$feature","$view"],[]),XYe=(t,e,i,r)=>SK.create(t,e,i,r,["$feature","$view"],[]);let SK=class E2e{constructor(e,i,r,n,s,o,a){this.services=null,this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o==null?void 0:o.fields;this.fields=l??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await Dv(),h=i instanceof nt?i:nt.fromJSON(i);let p;try{p=a.parseScript(e,o)}catch(V){return WYe().error(new Y("arcade-bad-expression","Failed to parse arcade script",{script:e,error:V})),null}const g=s.reduce((V,U)=>({...V,[U]:null}),{});let y=null;n!=null&&(y=new c(n),y.immutable=!0,g.$config=null);const w=a.scriptUsesGeometryEngine(p),b=w&&a.enableGeometrySupport(),x=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),T=a.scriptIsAsync(p),M=T&&a.enableAsyncSupport(),$={vars:g,spatialReference:h,useAsync:!!M};await Promise.all([b,x,M]);const R=new Set;await a.loadDependentModules(R,p,null,T,w);const I=new c;I.immutable=!1,I.setField("scale",0);const P=a.compileScript(p,$),N=(V,U)=>{var W;const B=(W=V.$view)==null?void 0:W.timeZone;return"$view"in V&&V.$view&&(I.setField("scale",typeof V.$view=="object"&&"scale"in V.$view?V.$view.scale:void 0),V.$view=I),y&&(V.$config=y),P({vars:V,spatialReference:h,services:U,timeZone:B})};return new E2e(e,a,p,N,new l,r,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const JYe=/^([0-9_])/,QYe=/[^a-z0-9_\u0080-\uffff]+/gi;function KYe(t){return t==null?null:t.trim().replaceAll(QYe,"_").replace(JYe,"F$1")||null}const eXe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],tXe=["field","normalizationField"];function pce(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(fce(eXe,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)fce(tXe,r,e)}}function fce(t,e,i){if(t)for(const r of t){const n=iU(r,e),s=n&&typeof n!="function"&&i.get(n);s&&Uo(r,s.name,e)}}function C2e(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),n=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const r=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const pj=new Set;function TK(t,e){return t&&e?(pj.clear(),tx(pj,t,e),Array.from(pj).sort()):[]}function tx(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of i)Jl(t,e,n);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const n of i)n!=null&&t.add(n)}}function Jl(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function dLt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function Sl(t,e,i){var s;if(!i)return;const{arcadeUtils:r}=await Dv(),n=r.extractFieldNames(i,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)Jl(t,e,o)}async function M2e(t,e,i){if(i&&i!=="1=1"){const r=await bK(i,e);if(!r.isStandardized)throw new Y("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});tx(t,e,r.fieldNames)}}function iXe({displayField:t,fields:e}){return t||(e!=null&&e.length?fj(e,"name-or-title")||fj(e,"unique-identifier")||fj(e,"type-or-category")||rXe(e):null)}function rXe(t){for(const e of t){if(!(e!=null&&e.name))continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function fj(t,e){for(const i of t)if(i!=null&&i.valueType&&i.valueType===e)return i.name;return null}async function pLt(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function nXe(t,e,i){i.onStatisticExpression?Sl(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function fLt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],n=i.popupTemplate;r.push(sXe(t,e,n)),i.fields&&r.push(...i.fields.map(async s=>nXe(t,e.fieldsIndex,s))),await Promise.all(r)}async function sXe(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(s=>Sl(t,e.fieldsIndex,s.expression)));const n=i==null?void 0:i.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&r.push(Sl(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(r)}async function mLt(t,e,i){e&&(e.timeInfo&&(i!=null&&i.timeExtent)&&tx(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&tx(t,e.fieldsIndex,[e.floorInfo.floorField]),(i==null?void 0:i.where)!=null&&await M2e(t,e.fieldsIndex,i.where))}async function gLt(t,e,i){e&&i&&await Promise.all(i.map(r=>oXe(t,e,r)))}async function oXe(t,e,i){e&&i&&(i.valueExpression?await Sl(t,e.fieldsIndex,i.valueExpression):i.field&&Jl(t,e.fieldsIndex,i.field))}function yLt(t){return t?TK(t.fieldsIndex,$2e(t)):[]}function aXe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?TK(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const lXe=new Set(["oid","global-id","guid"]),cXe=new Set(["oid","global-id"]),uXe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function hXe(t){const e=new Set;O2e(t).forEach(r=>e.add(r)),aXe(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function $2e(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:n,editorField:s}=e;return[i,r,n,s].filter(Boolean)}function O2e(t){return $2e(t).map(e=>e.toLowerCase())}function dXe(t,e){var i;return t.editable&&!lXe.has(t.type)&&!O2e(e).includes(((i=t.name)==null?void 0:i.toLowerCase())??"")}function pXe(t,e){var r;const i=((r=t.name)==null?void 0:r.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&i===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&i===e.globalIdField.toLowerCase()||hXe(e).includes(i)||cXe.has(t.type)||uXe.some(n=>n.test(i)))}async function _Lt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i!=null&&i.length&&await Promise.all(i.map(n=>fXe(t,r,n)))}async function fXe(t,e,i){if(!i)return;const r=i.getLabelExpression(),n=i.where;if(r.type==="arcade")await Sl(t,e,r.expression);else{const s=r.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{Jl(t,e,o.slice(1,-1))})}await M2e(t,e,n)}function mXe(t){const e=t.defaultValue;return e!==void 0&&I2e(t,e)?e:t.nullable?null:void 0}function vLt(t){const e=typeof t=="string"?{type:t}:t;return L2e(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function A2e(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function gXe(t){return t===null||A2e(t)}function yXe(t){return t===null||Number.isInteger(t)}function R2e(t){return t!=null&&typeof t=="string"}function _Xe(t){return t===null||R2e(t)}function vXe(){return!0}function I2e(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?yXe:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?gXe:A2e;break;case"string":case"esriFieldTypeString":i=t.nullable?_Xe:R2e;break;default:i=vXe}return arguments.length===1?i:i(e)}const wXe=["integer","small-integer","big-integer"],bXe=["single","double"],xXe=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],SXe=["esriFieldTypeSingle","esriFieldTypeDouble"],P2e=new Set([...wXe,...xXe]),TXe=new Set([...bXe,...SXe]),EXe=B_e(P2e,TXe);function CXe(t){return t!=null&&P2e.has(t.type)}function EK(t){return t!=null&&EXe.has(t.type)}function L2e(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function D2e(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function wLt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function bLt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function MXe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function mce(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function gce(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function xLt(t,e){return $Xe(t,e)===null}var H5,q5;function SLt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function $Xe(t,e){return t==null||t.nullable&&e===null?null:EK(t)&&!OXe(t.type,Number(e))?H5.OUT_OF_RANGE:I2e(t,e)?t.domain?HYe(t,e):null:q5.INVALID_TYPE}function OXe(t,e){const i=typeof t=="string"?N2e(t):t;if(!i)return!1;const r=i.min,n=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=n:e>=r&&e<=n}function N2e(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return AXe;case"esriFieldTypeInteger":case"integer":return RXe;case"esriFieldTypeBigInteger":case"big-integer":return IXe;case"esriFieldTypeSingle":case"single":return PXe;case"esriFieldTypeDouble":case"double":return LXe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(H5||(H5={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(q5||(q5={}));const AXe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},RXe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},IXe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},PXe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},LXe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function TLt(t,e,i){switch(t){case oC.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case oC.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case q5.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case H5.OUT_OF_RANGE:{const{min:r,max:n}=N2e(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${n}`}}}function ELt(t,e){return!DXe(t,e,null)}function DXe(t,e,i){if(!(e!=null&&e.attributes)||!t){if(i!=null)for(const s of t??[])i.add(s);return!0}const r=new Set(Object.keys(e.attributes));let n=!1;for(const s of t)if(!r.has(s)){if(n=!0,i==null)break;i.add(s)}return n}function NXe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}function F2e(t){const e=t==null?void 0:t.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let KN=class extends we{constructor(e){super(e),this.type=null}};u([f({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],KN.prototype,"type",void 0),KN=u([L("esri.popup.content.Content")],KN);const zy=KN;var H7;let iw=H7=class extends zy{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new H7({description:this.description,displayType:this.displayType,title:this.title})}};u([f({type:String,json:{write:!0}})],iw.prototype,"description",void 0),u([f({type:["auto","preview","list"],json:{write:!0}})],iw.prototype,"displayType",void 0),u([f({type:String,json:{write:!0}})],iw.prototype,"title",void 0),u([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],iw.prototype,"type",void 0),iw=H7=u([L("esri.popup.content.AttachmentsContent")],iw);const aC=iw;var q7;let rw=q7=class extends zy{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new q7({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?te(this.outFields):null})}};u([f()],rw.prototype,"creator",void 0),u([f()],rw.prototype,"destroyer",void 0),u([f()],rw.prototype,"outFields",void 0),u([f({type:["custom"],readOnly:!0})],rw.prototype,"type",void 0),rw=q7=u([L("esri.popup.content.CustomContent")],rw);const FXe=rw;var W7;let bT=W7=class extends we{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new W7({title:this.title,expression:this.expression})}};u([f({type:String,json:{write:!0}})],bT.prototype,"title",void 0),u([f({type:String,json:{write:!0}})],bT.prototype,"expression",void 0),u([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],bT.prototype,"returnType",void 0),bT=W7=u([L("esri.popup.ElementExpressionInfo")],bT);const kXe=bT;var Z7;let xO=Z7=class extends zy{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new Z7({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([f({type:kXe,json:{write:!0}})],xO.prototype,"expressionInfo",void 0),u([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],xO.prototype,"type",void 0),xO=Z7=u([L("esri.popup.content.ExpressionContent")],xO);const gz=xO;let xT=class extends Or(we){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};u([_t(U6e)],xT.prototype,"dateFormat",void 0),u([f({type:Boolean,json:{write:!0}})],xT.prototype,"digitSeparator",void 0),u([f({type:Wi,json:{write:!0}})],xT.prototype,"places",void 0),xT=u([L("esri.popup.support.FieldInfoFormat")],xT);const eF=xT;var Y7;let Jd=Y7=class extends we{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){var t;return new Y7({fieldName:this.fieldName,format:(t=this.format)==null?void 0:t.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([f({type:String,json:{write:!0}})],Jd.prototype,"fieldName",void 0),u([f({type:eF,json:{write:!0}})],Jd.prototype,"format",void 0),u([f({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Jd.prototype,"isEditable",void 0),u([f({type:String,json:{write:!0}})],Jd.prototype,"label",void 0),u([_t(new sr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Jd.prototype,"stringFieldOption",void 0),u([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Jd.prototype,"statisticType",void 0),u([f({type:String,json:{write:!0}})],Jd.prototype,"tooltip",void 0),u([f({type:Boolean,json:{write:!0}})],Jd.prototype,"visible",void 0),Jd=Y7=u([L("esri.popup.FieldInfo")],Jd);const CK=Jd;var X7;let gg=X7=class extends zy{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new X7(te({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([f({type:Object,json:{write:!0}})],gg.prototype,"attributes",void 0),u([f({type:String,json:{write:!0}})],gg.prototype,"description",void 0),u([f({type:[CK]})],gg.prototype,"fieldInfos",void 0),u([ke("fieldInfos")],gg.prototype,"writeFieldInfos",null),u([f({type:String,json:{write:!0}})],gg.prototype,"title",void 0),u([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],gg.prototype,"type",void 0),gg=X7=u([L("esri.popup.content.FieldsContent")],gg);const lC=gg;let nw=class extends we{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([f({type:String,json:{write:!0}})],nw.prototype,"altText",void 0),u([f({type:String,json:{write:!0}})],nw.prototype,"caption",void 0),u([f({type:String,json:{write:!0}})],nw.prototype,"title",void 0),u([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],nw.prototype,"type",void 0),nw=u([L("esri.popup.content.mixins.MediaInfo")],nw);const MK=nw;var J7;let sw=J7=class extends Ne{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){var t;return new J7({color:(t=this.color)==null?void 0:t.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([f()],sw.prototype,"color",void 0),u([f()],sw.prototype,"fieldName",void 0),u([f()],sw.prototype,"tooltip",void 0),u([f()],sw.prototype,"value",void 0),sw=J7=u([L("esri.popup.content.support.ChartMediaInfoValueSeries")],sw);const UXe=sw;var Q7;let s_=Q7=class extends we{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Q7({colors:te(this.colors),fields:te(this.fields),normalizeField:this.normalizeField,series:te(this.series),tooltipField:this.tooltipField})}};u([f({type:[mt],json:{type:[[Wi]],write:!0}})],s_.prototype,"colors",void 0),u([f({type:[String],json:{write:!0}})],s_.prototype,"fields",void 0),u([f({type:String,json:{write:!0}})],s_.prototype,"normalizeField",void 0),u([f({type:[UXe],json:{read:!1}})],s_.prototype,"series",void 0),u([f({type:String,json:{write:!0}})],s_.prototype,"tooltipField",void 0),s_=Q7=u([L("esri.popup.content.support.ChartMediaInfoValue")],s_);const zXe=s_;let SO=class extends MK{constructor(e){super(e),this.type=null,this.value=void 0}};u([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],SO.prototype,"type",void 0),u([f({type:zXe,json:{write:!0}})],SO.prototype,"value",void 0),SO=u([L("esri.popup.content.mixins.ChartMediaInfo")],SO);const yz=SO,_z=Za()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var K7;let tF=K7=class extends yz{constructor(t){super(t),this.type="bar-chart"}clone(){var t;return new K7({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};u([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:_z.write}})],tF.prototype,"type",void 0),tF=K7=u([L("esri.popup.content.BarChartMediaInfo")],tF);const k2e=tF;var eq;let iF=eq=class extends yz{constructor(t){super(t),this.type="column-chart"}clone(){var t;return new eq({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};u([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:_z.write}})],iF.prototype,"type",void 0),iF=eq=u([L("esri.popup.content.ColumnChartMediaInfo")],iF);const U2e=iF;var tq;let TO=tq=class extends we{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new tq({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([f({type:String,json:{write:!0}})],TO.prototype,"linkURL",void 0),u([f({type:String,json:{write:!0}})],TO.prototype,"sourceURL",void 0),TO=tq=u([L("esri.popup.content.support.ImageMediaInfoValue")],TO);const VXe=TO;var iq;let ST=iq=class extends MK{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){var t;return new iq({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:(t=this.value)==null?void 0:t.clone()})}};u([f({type:Number,json:{write:!0}})],ST.prototype,"refreshInterval",void 0),u([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],ST.prototype,"type",void 0),u([f({type:VXe,json:{write:!0}})],ST.prototype,"value",void 0),ST=iq=u([L("esri.popup.content.ImageMediaInfo")],ST);const z2e=ST;var rq;let rF=rq=class extends yz{constructor(t){super(t),this.type="line-chart"}clone(){var t;return new rq({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};u([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:_z.write}})],rF.prototype,"type",void 0),rF=rq=u([L("esri.popup.content.LineChartMediaInfo")],rF);const V2e=rF;var nq;let nF=nq=class extends yz{constructor(t){super(t),this.type="pie-chart"}clone(){var t;return new nq({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};u([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:_z.write}})],nF.prototype,"type",void 0),nF=nq=u([L("esri.popup.content.PieChartMediaInfo")],nF);const B2e=nF,sq={base:MK,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":k2e,"column-chart":U2e,"line-chart":V2e,"pie-chart":B2e,image:z2e}};var oq;let Qd=oq=class extends zy{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?z2e.fromJSON(e):e.type==="barchart"?k2e.fromJSON(e):e.type==="columnchart"?U2e.fromJSON(e):e.type==="linechart"?V2e.fromJSON(e):e.type==="piechart"?B2e.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new oq(te({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([f()],Qd.prototype,"activeMediaInfoIndex",void 0),u([f({type:Object,json:{write:!0}})],Qd.prototype,"attributes",void 0),u([f({type:String,json:{write:!0}})],Qd.prototype,"description",void 0),u([f({types:[sq]})],Qd.prototype,"mediaInfos",void 0),u([Pe("mediaInfos")],Qd.prototype,"readMediaInfos",null),u([ke("mediaInfos")],Qd.prototype,"writeMediaInfos",null),u([f({type:String,json:{write:!0}})],Qd.prototype,"title",void 0),u([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Qd.prototype,"type",void 0),Qd=oq=u([L("esri.popup.content.MediaContent")],Qd);const ZR=Qd;var aq;let EO=aq=class extends we{constructor(t){super(t),this.field=null,this.order=null}clone(){return new aq({field:this.field,order:this.order})}};u([f({type:String,json:{write:!0}})],EO.prototype,"field",void 0),u([f({type:["asc","desc"],json:{write:!0}})],EO.prototype,"order",void 0),EO=aq=u([L("esri.popup.support.RelatedRecordsInfoFieldOrder")],EO);const $K=EO;let Nf=class extends Or(zy){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([f({type:String,json:{write:!0}})],Nf.prototype,"description",void 0),u([f({type:Number,json:{type:Wi,write:!0}})],Nf.prototype,"displayCount",void 0),u([f({type:["list"],json:{write:!0}})],Nf.prototype,"displayType",void 0),u([f({type:[$K],json:{write:!0}})],Nf.prototype,"orderByFields",void 0),u([f({type:Number,json:{type:Wi,write:!0}})],Nf.prototype,"relationshipId",void 0),u([f({type:String,json:{write:!0}})],Nf.prototype,"title",void 0),u([f({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Nf.prototype,"type",void 0),Nf=u([L("esri.popup.content.RelationshipContent")],Nf);const YR=Nf;var lq;let CO=lq=class extends zy{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new lq({text:this.text})}};u([f({type:String,json:{write:!0}})],CO.prototype,"text",void 0),u([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],CO.prototype,"type",void 0),CO=lq=u([L("esri.popup.content.TextContent")],CO);const XR=CO;let Ff=class extends Or(we){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.open=!1,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};u([f({type:String,json:{write:!0}})],Ff.prototype,"title",void 0),u([f({type:String,json:{write:!0}})],Ff.prototype,"description",void 0),u([f({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],Ff.prototype,"type",void 0),u([f({type:Boolean,json:{read:!1}})],Ff.prototype,"open",void 0),u([f({type:Number,json:{type:Wi,write:!0}})],Ff.prototype,"associatedNetworkSourceId",void 0),u([f({type:Number,json:{type:Wi,write:!0}})],Ff.prototype,"associatedAssetGroup",void 0),u([f({type:Number,json:{type:Wi,write:!0}})],Ff.prototype,"associatedAssetType",void 0),Ff=u([L("esri.popup.support.UtilityNetworkAssociationType")],Ff);const BXe=Ff;let ow=class extends Or(zy){constructor(e){super(e),this.description=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};u([f({type:String,json:{write:!0}})],ow.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],ow.prototype,"title",void 0),u([f({type:[BXe],json:{write:!0}})],ow.prototype,"associationTypes",void 0),u([_t({utilityNetworkAssociations:"utility-network-associations"})],ow.prototype,"type",void 0),ow=u([L("esri.popup.content.UtilityNetworkAssociationsContent")],ow);const OK=ow,jXe={base:null,key:"type",typeMap:{attachment:aC,media:ZR,text:XR,expression:gz,field:lC,relationship:YR,utilityNetworkAssociations:OK}},GXe={base:null,key:"type",typeMap:{attachment:aC,media:ZR,text:XR,expression:gz,field:lC,relationship:YR}};var cq;let aw=cq=class extends we{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new cq({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([f({type:String,json:{write:!0}})],aw.prototype,"name",void 0),u([f({type:String,json:{write:!0}})],aw.prototype,"title",void 0),u([f({type:String,json:{write:!0}})],aw.prototype,"expression",void 0),u([f({type:["string","number"],json:{write:!0}})],aw.prototype,"returnType",void 0),aw=cq=u([L("esri.popup.ExpressionInfo")],aw);const HXe=aw;var uq;let MO=uq=class extends we{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new uq({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([f({type:Boolean,json:{write:!0}})],MO.prototype,"returnTopmostRaster",void 0),u([f({type:Boolean,json:{write:!0}})],MO.prototype,"showNoDataRecords",void 0),MO=uq=u([L("esri.popup.LayerOptions")],MO);const qXe=MO;var hq;let $O=hq=class extends we{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new hq({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?te(this.orderByFields):null})}};u([f({type:Boolean,json:{write:!0}})],$O.prototype,"showRelatedRecords",void 0),u([f({type:[$K],json:{write:!0}})],$O.prototype,"orderByFields",void 0),$O=hq=u([L("esri.popup.RelatedRecordsInfo")],$O);const yce=$O;var dq;let _h=dq=class extends mQ(Ne){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new dq({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([f()],_h.prototype,"active",void 0),u([f()],_h.prototype,"className",void 0),u([f()],_h.prototype,"disabled",void 0),u([f()],_h.prototype,"icon",void 0),u([f()],_h.prototype,"id",void 0),u([f()],_h.prototype,"indicator",void 0),u([f()],_h.prototype,"title",void 0),u([f()],_h.prototype,"type",void 0),u([f()],_h.prototype,"visible",void 0),_h=dq=u([L("esri.support.actions.ActionBase")],_h);const AK=_h;var pq;let sF=pq=class extends AK{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new pq({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([f()],sF.prototype,"image",void 0),sF=pq=u([L("esri.support.actions.ActionButton")],sF);const WXe=sF;var fq;let OO=fq=class extends AK{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new fq({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([f()],OO.prototype,"image",void 0),u([f()],OO.prototype,"value",void 0),OO=fq=u([L("esri.support.actions.ActionToggle")],OO);const ZXe=OO,w$="relationships/",_ce="expression/",YXe=ot.ofType({key:"type",defaultKeyValue:"button",base:AK,typeMap:{button:WXe,toggle:ZXe}}),XXe={base:zy,key:"type",typeMap:{media:ZR,custom:FXe,text:XR,attachments:aC,fields:lC,expression:gz,relationship:YR,utilityNetworkAssociations:OK}},j2e=new Set(["attachments","fields","media","text","expression","relationship"]),JXe=new Set([...j2e,"utility-network-associations"]);let oo=class extends Or(we){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>Bu(XXe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||qu(e)?e:(de.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeWebSceneContent(e,i,r,n){this._writePopupTemplateContent(e,i,n)}writeWebMapContent(e,i,r,n){this._writePopupTemplateContent(e,i,n)}writeFieldInfos(e,i,r,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});i.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(n);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,n){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),tx(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writePopupTemplateContent(e,i,r){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(n=>(r==null?void 0:r.origin)==="web-scene"?j2e.has(n.type):JXe.has(n.type)).map(n=>n==null?void 0:n.toJSON(r)),i.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(i):n.type==="media"?this._writeMediaContent(n,i):n.type==="text"?this._writeTextContent(n,i):n.type==="relationship"&&this._writeRelationshipContent(n,i)})):i.description=e}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=te(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(n=>{const s=i.fieldInfos.find(o=>{var a,l;return((a=o.fieldName)==null?void 0:a.toLowerCase())===((l=n.fieldName)==null?void 0:l.toLowerCase())});s?s.visible=!0:i.fieldInfos.push(n)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var s,o;const r=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=te(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const n={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!i||n.mediaInfos||(s.mediaInfos=i,n.mediaInfos=!0),ZR.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),XR.fromJSON(s)):s.type==="attachments"?aC.fromJSON(s):s.type==="fields"?lC.fromJSON(s):s.type==="expression"?gz.fromJSON(s):s.type==="relationship"?YR.fromJSON(s):s.type==="utilityNetworkAssociations"?OK.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(w$)))return null;const n=i.replace(w$,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?YR.fromJSON({relationshipId:s,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:n}=e;return{field:`${w$}${i}/${n}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new XR({text:e})):s.push(new lC),Array.isArray(i)&&i.length&&s.push(ZR.fromJSON({mediaInfos:i})),r&&s.push(aC.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return i==="text"?this._extractFieldNames(e.text):i==="relationship"||i==="utility-network-associations"?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){const{caption:i,title:r,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=s,p=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,n)=>[...r,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(n=>Sl(e,i,n.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(w$)||i.startsWith(_ce))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return F2e(e).filter(i=>!(i.indexOf(w$)===0||i.indexOf(_ce)===0))}};u([f({type:YXe})],oo.prototype,"actions",void 0),u([f()],oo.prototype,"content",void 0),u([$i("content")],oo.prototype,"castContent",null),u([Pe("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],oo.prototype,"readContent",null),u([ke("web-scene","content",{popupElements:{type:ot.ofType(GXe)},showAttachments:{type:Boolean},mediaInfos:{type:ot.ofType(sq)},description:{type:String},relatedRecordsInfo:{type:yce}})],oo.prototype,"writeWebSceneContent",null),u([ke("content",{popupElements:{type:ot.ofType(jXe)},showAttachments:{type:Boolean},mediaInfos:{type:ot.ofType(sq)},description:{type:String},relatedRecordsInfo:{type:yce}})],oo.prototype,"writeWebMapContent",null),u([f({type:[HXe],json:{write:!0}})],oo.prototype,"expressionInfos",void 0),u([f({type:[CK]})],oo.prototype,"fieldInfos",void 0),u([ke("fieldInfos")],oo.prototype,"writeFieldInfos",null),u([f({type:qXe})],oo.prototype,"layerOptions",void 0),u([ke("layerOptions")],oo.prototype,"writeLayerOptions",null),u([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],oo.prototype,"lastEditInfoEnabled",void 0),u([f()],oo.prototype,"outFields",void 0),u([f()],oo.prototype,"overwriteActions",void 0),u([f()],oo.prototype,"returnGeometry",void 0),u([f({json:{type:String}})],oo.prototype,"title",void 0),u([ke("title")],oo.prototype,"writeTitle",null),oo=u([L("esri.PopupTemplate")],oo);const KC=oo,vce=new sr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let QXe=0,TT=class extends we{constructor(e){super(e),this.id="sym"+QXe++,this.type=null,this.color=new mt([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([f({type:vce.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:vce.write}}})],TT.prototype,"type",void 0),u([f({type:mt,json:{write:{allowNull:!0}}})],TT.prototype,"color",void 0),u([Pe("color")],TT.prototype,"readColor",null),TT=u([L("esri.symbols.Symbol")],TT);const Ya=TT;var mq;let o_=mq=class extends Ya{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const n=r.map(s=>{const o=s.valueExpressionInfo;return o?Sl(t,e,o.expression):null});await Promise.all(n)}}}clone(){return new mq({data:te(this.data)})}hash(){return __e(JSON.stringify(this.data)).toString()}};u([f({json:{write:!1}})],o_.prototype,"color",void 0),u([f({json:{write:!0}})],o_.prototype,"data",void 0),u([Pe("data",["symbol"])],o_.prototype,"readData",null),u([ke("data",{})],o_.prototype,"writeData",null),u([_t({CIMSymbolReference:"cim"},{readOnly:!0})],o_.prototype,"type",void 0),o_=mq=u([L("esri.symbols.CIMSymbol")],o_);const Jv=o_;let ET=class extends we{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};u([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],ET.prototype,"enabled",void 0),u([ke("enabled")],ET.prototype,"writeEnabled",null),u([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],ET.prototype,"type",void 0),ET=u([L("esri.symbols.Symbol3DLayer")],ET);const Pm=ET;let lw=class extends we{constructor(e){super(e),this.color=new mt([0,0,0,1]),this.extensionLength=0,this.size=ud(1)}clone(){}cloneProperties(){return{color:te(this.color),size:this.size,extensionLength:this.extensionLength}}};u([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],lw.prototype,"type",void 0),u([f(Fy)],lw.prototype,"color",void 0),u([f({...Tm,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],lw.prototype,"extensionLength",void 0),u([f(Tm)],lw.prototype,"size",void 0),lw=u([L("esri.symbols.edges.Edges3D")],lw);const RK=lw;var gq;let oF=gq=class extends RK{constructor(t){super(t),this.type="sketch"}clone(){return new gq(this.cloneProperties())}};u([_t({sketch:"sketch"},{readOnly:!0})],oF.prototype,"type",void 0),oF=gq=u([L("esri.symbols.edges.SketchEdges3D")],oF);const KXe=oF;var yq;let aF=yq=class extends RK{constructor(t){super(t),this.type="solid"}clone(){return new yq(this.cloneProperties())}};u([_t({solid:"solid"},{readOnly:!0})],aF.prototype,"type",void 0),aF=yq=u([L("esri.symbols.edges.SolidEdges3D")],aF);const G2e=aF,H2e={types:{key:"type",base:RK,typeMap:{solid:G2e,sketch:KXe}},json:{write:!0}};var _q;let Nu=_q=class extends we{constructor(t){super(t),this.color=null,this.emissiveFactor=null}clone(){var e;const t={color:((e=this.color)==null?void 0:e.clone())??null,emissiveFactor:this.emissiveFactor?En(this.emissiveFactor):null};return new _q(t)}};u([f(Fy)],Nu.prototype,"color",void 0),u([f({type:[Number],json:{write:!1}})],Nu.prototype,"emissiveFactor",void 0),Nu=_q=u([L("esri.symbols.support.Symbol3DMaterial")],Nu);var vq;let a_=vq=class extends Pm{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){var t,e;return new vq({edges:(t=this.edges)==null?void 0:t.clone(),enabled:this.enabled,material:(e=this.material)==null?void 0:e.clone(),castShadows:this.castShadows,size:this.size})}};u([_t({Extrude:"extrude"},{readOnly:!0})],a_.prototype,"type",void 0),u([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],a_.prototype,"size",void 0),u([f({type:Nu,json:{write:!0}})],a_.prototype,"material",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],a_.prototype,"castShadows",void 0),u([f(H2e)],a_.prototype,"edges",void 0),a_=vq=u([L("esri.symbols.ExtrudeSymbol3DLayer")],a_);const q2e=a_;let AO=class extends Ya{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([_t({esriSLS:"simple-line"},{readOnly:!0})],AO.prototype,"type",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],AO.prototype,"width",void 0),AO=u([L("esri.symbols.LineSymbol")],AO);const eJe=AO,tJe=["begin","end","begin-end"],W2e=["arrow","circle","square","diamond","cross","x"];var wq;let kf=wq=class extends we{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new wq({color:te(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([f({type:["begin","end","begin-end"],json:{write:!0}})],kf.prototype,"placement",void 0),u([_t({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],kf.prototype,"type",void 0),u([f({type:W2e})],kf.prototype,"style",void 0),u([ke("style")],kf.prototype,"writeStyle",null),u([f({type:mt,value:null,json:{write:{allowNull:!0}}})],kf.prototype,"color",null),u([Pe("color")],kf.prototype,"readColor",null),u([ke("color")],kf.prototype,"writeColor",null),kf=wq=u([L("esri.symbols.LineSymbolMarker")],kf);const iJe=kf;var bq;const mj=new sr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let yg=bq=class extends eJe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=mr(i)),r!=null&&(o.cap=r),n!=null&&(o.join=n),s!=null&&(o.miterLimit=mr(s)),o}clone(){var t;return new bq({color:te(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([_t({esriSLS:"simple-line"},{readOnly:!0})],yg.prototype,"type",void 0),u([f({type:mj.apiValues,json:{read:mj.read,write:mj.write}})],yg.prototype,"style",void 0),u([f({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],yg.prototype,"cap",void 0),u([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],yg.prototype,"join",void 0),u([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":iJe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],yg.prototype,"marker",void 0),u([f({type:Number,json:{read:!1,write:!1}})],yg.prototype,"miterLimit",void 0),yg=bq=u([L("esri.symbols.SimpleLineSymbol")],yg);const Wu=yg;let RO=class extends Ya{constructor(e){super(e),this.outline=null,this.type=null}hash(){var e;return`${this.type}.${(e=this.outline)==null?void 0:e.hash()}`}};u([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Wu}},json:{default:null,write:!0}})],RO.prototype,"outline",void 0),u([f({type:["simple-fill","picture-fill"],readOnly:!0})],RO.prototype,"type",void 0),RO=u([L("esri.symbols.FillSymbol")],RO);const Z2e=RO;let lF=class extends we{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};u([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],lF.prototype,"type",void 0),lF=u([L("esri.symbols.patterns.LinePattern3D")],lF);const Y2e=lF,rJe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var xq;const nJe=Za()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let IO=xq=class extends Y2e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new xq(t)}};u([f({type:["style"]})],IO.prototype,"type",void 0),u([_t(nJe),f({type:rJe})],IO.prototype,"style",void 0),IO=xq=u([L("esri.symbols.patterns.LineStylePattern3D")],IO);const IK=IO;let cF=class extends we{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};u([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],cF.prototype,"type",void 0),cF=u([L("esri.symbols.patterns.Pattern3D")],cF);const X2e=cF,sJe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var Sq;let PO=Sq=class extends X2e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new Sq({style:this.style})}};u([f({type:["style"]})],PO.prototype,"type",void 0),u([f({type:sJe,json:{read:!0,write:!0}})],PO.prototype,"style",void 0),PO=Sq=u([L("esri.symbols.patterns.StylePattern3D")],PO);const J2e=PO,oJe={types:{key:"type",base:X2e,typeMap:{style:J2e}},json:{write:!0}},Q2e={types:{key:"type",base:Y2e,typeMap:{style:IK}},json:{write:!0}},WA=new mt("white");new mt("black");const aJe=new mt([255,255,255,0]);function lJe(t){return t.r===0&&t.g===0&&t.b===0}var Tq;let ZA=Tq=class extends Nu{constructor(t){super(t),this.colorMixMode=null}clone(){var e;const t={color:((e=this.color)==null?void 0:e.clone())??null,emissiveFactor:this.emissiveFactor?En(this.emissiveFactor):null,colorMixMode:this.colorMixMode};return new Tq(t)}};u([_t({multiply:"multiply",replace:"replace",tint:"tint"})],ZA.prototype,"colorMixMode",void 0),ZA=Tq=u([L("esri.symbols.support.Symbol3DFillMaterial")],ZA);function PK(t,e=!1){return t<=Vu?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function VLt(t){return(yy(t)?t.length:t.byteLength/8)<=Vu?Array.from(t):new Float64Array(t)}function BLt(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function bd(t=sEe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function cC(t,e,i,r,n,s,o=bd()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function jLt(t,e=bd()){return cJe(t,0,t.length/3,e)}function cJe(t,e,i,r=bd()){return wz(r,Cq),uJe(r,t,e,i),r}function GLt(t,e=PK(24)){const[i,r,n,s,o,a]=t;return e[0]=i,e[1]=r,e[2]=n,e[3]=i,e[4]=r,e[5]=a,e[6]=i,e[7]=o,e[8]=n,e[9]=i,e[10]=o,e[11]=a,e[12]=s,e[13]=r,e[14]=n,e[15]=s,e[16]=r,e[17]=a,e[18]=s,e[19]=o,e[20]=n,e[21]=s,e[22]=o,e[23]=a,e}function HLt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new pr(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function K2e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function qLt(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function ix(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function uJe(t,e,i=0,r=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<r;h++)n=Math.min(n,e[i+3*h]),s=Math.min(s,e[i+3*h+1]),o=Math.min(o,e[i+3*h+2]),a=Math.max(a,e[i+3*h]),l=Math.max(l,e[i+3*h+1]),c=Math.max(c,e[i+3*h+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function gj(t,e,i){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let h=0;h<r;h++){const p=e[h];n=Math.min(n,p[0]),s=Math.min(s,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=e[h];n=Math.min(n,p[0]),s=Math.min(s,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function hJe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function Cx(t){return t[0]>=t[3]?0:t[3]-t[0]}function Mx(t){return t[1]>=t[4]?0:t[4]-t[1]}function Qv(t){return t[2]>=t[5]?0:t[5]-t[2]}function eEe(t){const e=Cx(t),i=Qv(t),r=Mx(t);return Math.sqrt(e*e+i*i+r*r)}function vz(t,e=[0,0,0]){return e[0]=t[0]+Cx(t)/2,e[1]=t[1]+Mx(t)/2,e[2]=t[2]+Qv(t)/2,e}function WLt(t,e=[0,0,0]){return e[0]=Cx(t),e[1]=Mx(t),e[2]=Qv(t),e}function dJe(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function ZLt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function pJe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function YLt(t,e){return e==null||pJe(t,e)}function fJe(t,e,i,r,n=t){return n[0]=t[0]+e,n[1]=t[1]+i,n[2]=t[2]+r,n[3]=t[3]+e,n[4]=t[4]+i,n[5]=t[5]+r,n}function XLt(t,e,i=t){const r=t[0]+Cx(t)/2,n=t[1]+Mx(t)/2,s=t[2]+Qv(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=n+(t[1]-n)*e,i[2]=s+(t[2]-s)*e,i[3]=r+(t[3]-r)*e,i[4]=n+(t[4]-n)*e,i[5]=s+(t[5]-s)*e,i}function JLt(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function tEe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function iEe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function wz(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function fd(t){return t?wz(t,Cq):bd(Cq)}function rEe(t,e){return e||(e=Zi()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function QLt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function mJe(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function Eq(t){return t.length===6}function nEe(t){return Cx(t)===0&&Mx(t)===0&&Qv(t)===0}function KLt(t,e,i){if(t==null||e==null)return t===e;if(!Eq(t)||!Eq(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function gJe(t,e,i,r,n,s){return cC(t,e,i,r,n,s,yJe)}const eDt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Cq=[1/0,1/0,1/0,-1/0,-1/0,-1/0],sEe=[0,0,0,0,0,0],yJe=bd();function tDt(t,{isPrimitive:e,width:i,depth:r,height:n}){const s=e?10:1;if(i==null&&n==null&&r==null)return[s*t[0],s*t[1],s*t[2]];const o=Qe(i,r,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const _Je=cC(-.5,-.5,-.5,.5,.5,.5),vJe=cC(-.5,-.5,0,.5,.5,1),wJe=cC(-.5,-.5,0,.5,.5,.5);function iDt(t){switch(t){case"sphere":case"cube":case"diamond":return _Je;case"cylinder":case"cone":case"inverted-cone":return vJe;case"tetrahedron":return wJe;default:return}}const LK=["butt","square","round"],bJe=[...LK,"none"],oEe=["miter","bevel","round"];var Mq;let cw=Mq=class extends we{constructor(t){super(t),this.color=new mt([0,0,0,1]),this.size=ud(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new Mq(t)}};u([f(Fy)],cw.prototype,"color",void 0),u([f(Tm)],cw.prototype,"size",void 0),u([f(Q2e)],cw.prototype,"pattern",void 0),u([f({type:LK,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],cw.prototype,"patternCap",void 0),cw=Mq=u([L("esri.symbols.support.Symbol3DOutline")],cw);var uF;let _g=uF=class extends Pm{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new uF(t)}static fromSimpleFillSymbol(t){var r,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="solid"?new IK({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((n=t.outline)==null?void 0:n.color)??WA).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(i.patternCap=t.outline.cap),new uF({material:new ZA({color:(t.color??aJe).clone()}),pattern:t.style&&t.style!=="solid"?new J2e({style:t.style}):null,outline:i})}};u([_t({Fill:"fill"},{readOnly:!0})],_g.prototype,"type",void 0),u([f({type:ZA,json:{write:!0}})],_g.prototype,"material",void 0),u([f(oJe)],_g.prototype,"pattern",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],_g.prototype,"castShadows",void 0),u([f({type:cw,json:{write:!0}})],_g.prototype,"outline",void 0),u([f(H2e)],_g.prototype,"edges",void 0),_g=uF=u([L("esri.symbols.FillSymbol3DLayer")],_g);const $x=_g,xJe=["none","underline","line-through"],SJe=["normal","italic","oblique"],TJe=["normal","lighter","bold","bolder"],aEe={type:Number,cast:t=>{const e=Hl(t);return e===0?1:Oe(e,.1,4)},nonNullable:!0},EJe=["left","right","center"],CJe=["baseline","top","middle","bottom"],lEe={type:EJe,nonNullable:!0},cEe={type:CJe,nonNullable:!0},rDt=8;var $q;let vg=$q=class extends we{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return mr(t)}clone(){return new $q({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([f({type:xJe,json:{default:"none",write:!0}})],vg.prototype,"decoration",void 0),u([f({type:String,json:{write:!0}})],vg.prototype,"family",void 0),u([f({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],vg.prototype,"size",void 0),u([$i("size")],vg.prototype,"castSize",null),u([f({type:SJe,json:{default:"normal",write:!0}})],vg.prototype,"style",void 0),u([f({type:TJe,json:{default:"normal",write:!0}})],vg.prototype,"weight",void 0),vg=$q=u([L("esri.symbols.Font")],vg);const bz=vg;var Oq;const MJe=Za()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let uw=Oq=class extends we{constructor(t){super(t)}readHref(t,e,i){return t?NC(t,i):e.dataURI}writeHref(t,e,i,r){t&&(Rm(t)?e.dataURI=t:(e.href=U3(t,r),Fu(e.href)&&(e.href=nd(e.href))))}clone(){return new Oq({href:this.href,primitive:this.primitive})}};u([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],uw.prototype,"href",void 0),u([Pe("href")],uw.prototype,"readHref",null),u([ke("href",{href:{type:String},dataURI:{type:String}})],uw.prototype,"writeHref",null),u([_t(MJe)],uw.prototype,"primitive",void 0),uw=Oq=u([L("esri.symbols.support.IconSymbol3DLayerResource")],uw);const nDt="circle";var Aq;let E2=Aq=class extends Ne{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new Aq({x:this.x,y:this.y})}};u([f({type:Number})],E2.prototype,"x",void 0),u([f({type:Number})],E2.prototype,"y",void 0),E2=Aq=u([L("esri.symbols.support.Symbol3DAnchorPosition2D")],E2);var Rq;let LO=Rq=class extends we{constructor(t){super(t),this.color=new mt([0,0,0,1]),this.size=ud(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new Rq(t)}};u([f(Fy)],LO.prototype,"color",void 0),u([f(Tm)],LO.prototype,"size",void 0),LO=Rq=u([L("esri.symbols.support.Symbol3DIconOutline")],LO);var CT;const uEe="esri.symbols.IconSymbol3DLayer";let Kd=CT=class extends Pm{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null,this.angle=0}clone(){return new CT({anchor:this.anchor,anchorPosition:te(this.anchorPosition),enabled:this.enabled,material:te(this.material),outline:te(this.outline),resource:te(this.resource),angle:this.angle,size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||WA,i=wce(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||WA).clone()}:null;return new CT({size:t.size,angle:t.angle,resource:{primitive:OJe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||lJe(t.color)?WA:t.color,i=wce(t);return new CT({size:t.width<=t.height?t.height:t.width,angle:t.angle,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new CT({resource:{href:Mve({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};u([f({type:Nu,json:{write:!0}})],Kd.prototype,"material",void 0),u([f({type:uw,json:{write:!0}})],Kd.prototype,"resource",void 0),u([_t({Icon:"icon"},{readOnly:!0})],Kd.prototype,"type",void 0),u([f(Tm)],Kd.prototype,"size",void 0),u([_t({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"},{default:"center"})],Kd.prototype,"anchor",void 0),u([f({type:E2,json:{type:[Number],read:{reader:t=>new E2({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Kd.prototype,"anchorPosition",void 0),u([f({type:LO,json:{write:!0}})],Kd.prototype,"outline",void 0),u([f({type:Number,json:{write:!0,default:0}})],Kd.prototype,"angle",void 0),Kd=CT=u([L(uEe)],Kd);const Q_=Kd;function wce(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=bce(t.xoffset),n=bce(t.yoffset);return(r||n)&&e&&i?{x:-r/e,y:n/i}:null}function bce(t){return isFinite(t)?t:0}const $Je={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function OJe(t){return $Je[t]||(de.getLogger(uEe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}let hw=class extends Or(we){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],hw.prototype,"type",void 0),u([f({type:tJe,json:{default:"begin-end",write:!0}})],hw.prototype,"placement",void 0),u([f({type:W2e,json:{default:"arrow",write:!0}})],hw.prototype,"style",void 0),u([f({type:mt,json:{type:[Wi],default:null,write:!0}})],hw.prototype,"color",void 0),hw=u([L("esri.symbols.LineStyleMarker3D")],hw);const Iq=hw;var hF;let Uf=hF=class extends Pm{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=ud(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new hF(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??ud(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style?new IK({style:t.style}):null,material:new Nu({color:(t.color||WA).clone()}),marker:t.marker?new Iq({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new hF(e)}};u([f({type:Nu,json:{write:!0}})],Uf.prototype,"material",void 0),u([_t({Line:"line"},{readOnly:!0})],Uf.prototype,"type",void 0),u([f({type:oEe,json:{write:!0,default:"miter"}})],Uf.prototype,"join",void 0),u([f({type:LK,json:{write:!0,default:"butt"}})],Uf.prototype,"cap",void 0),u([f(Tm)],Uf.prototype,"size",void 0),u([f(Q2e)],Uf.prototype,"pattern",void 0),u([f({types:{key:"type",base:Iq,typeMap:{style:Iq}},json:{write:!0}})],Uf.prototype,"marker",void 0),Uf=hF=u([L("esri.symbols.LineSymbol3DLayer")],Uf);const eM=Uf;var Pq;const AJe=Za()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let DO=Pq=class extends we{clone(){return new Pq({href:this.href,primitive:this.primitive})}};u([f({type:String,json:{read:qJ,write:Hb}})],DO.prototype,"href",void 0),u([_t(AJe)],DO.prototype,"primitive",void 0),DO=Pq=u([L("esri.symbols.support.ObjectSymbol3DLayerResource")],DO);const RJe="sphere";var Lq;let Xw=Lq=class extends Ne{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Lq({x:this.x,y:this.y,z:this.z})}};u([f({type:Number})],Xw.prototype,"x",void 0),u([f({type:Number})],Xw.prototype,"y",void 0),u([f({type:Number})],Xw.prototype,"z",void 0),Xw=Lq=u([L("esri.symbols.support.Symbol3DAnchorPosition3D")],Xw);var Dq;let al=Dq=class extends Pm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,i;return new Dq({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(i=this.resource)==null?void 0:i.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([f({type:Nu,json:{write:!0}})],al.prototype,"material",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],al.prototype,"castShadows",void 0),u([f({type:DO,json:{write:!0}})],al.prototype,"resource",void 0),u([_t({Object:"object"},{readOnly:!0})],al.prototype,"type",void 0),u([f({type:Number,json:{write:!0}})],al.prototype,"width",void 0),u([f({type:Number,json:{write:!0}})],al.prototype,"height",void 0),u([f({type:Number,json:{write:!0}})],al.prototype,"depth",void 0),u([_t({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"},{default:"origin"})],al.prototype,"anchor",void 0),u([f({type:Xw,json:{type:[Number],read:{reader:t=>new Xw({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],al.prototype,"anchorPosition",void 0),u([f({type:Number,json:{write:!0}})],al.prototype,"heading",void 0),u([f({type:Number,json:{write:!0}})],al.prototype,"tilt",void 0),u([f({type:Number,json:{write:!0}})],al.prototype,"roll",void 0),u([f({readOnly:!0})],al.prototype,"isPrimitive",null),al=Dq=u([L("esri.symbols.ObjectSymbol3DLayer")],al);const xz=al;var Nq;let Pl=Nq=class extends Pm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new Nq({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([f({type:Nu,json:{write:!0}})],Pl.prototype,"material",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pl.prototype,"castShadows",void 0),u([_t({Path:"path"},{readOnly:!0})],Pl.prototype,"type",void 0),u([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],Pl.prototype,"profile",void 0),u([f({type:oEe,json:{write:!0,default:"miter"}})],Pl.prototype,"join",void 0),u([f({type:bJe,json:{write:!0,default:"butt"}})],Pl.prototype,"cap",void 0),u([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Pl.prototype,"width",void 0),u([Pe("width",["width","size","height"])],Pl.prototype,"readWidth",null),u([f({type:Number,json:{write:!0}})],Pl.prototype,"height",void 0),u([Pe("height",["height","size","width"])],Pl.prototype,"readHeight",null),u([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Pl.prototype,"anchor",void 0),u([f({type:["heading","all"],json:{write:!0,default:"all"}})],Pl.prototype,"profileRotation",void 0),Pl=Nq=u([L("esri.symbols.PathSymbol3DLayer")],Pl);const DK=Pl;var Fq;let C2=Fq=class extends we{constructor(){super(...arguments),this.color=new mt([0,0,0,1]),this.size=0}clone(){const t={color:te(this.color),size:this.size};return new Fq(t)}};u([f(Fy)],C2.prototype,"color",void 0),u([f(Tm)],C2.prototype,"size",void 0),C2=Fq=u([L("esri.symbols.support.Symbol3DHalo")],C2);let YA=class extends Or(we){constructor(e){super(e),this.color=null}};u([f(Fy)],YA.prototype,"color",void 0),YA=u([L("esri.symbols.support.Symbol3DTextBackground")],YA);var dF;let _c=dF=class extends Pm{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const n={...r,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new dF({enabled:this.enabled,font:this.font&&te(this.font),halo:this.halo&&te(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:te(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new dF({font:t.font!=null?t.font.clone():new bz,halo:IJe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Nu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new YA({color:t.backgroundColor.clone()}):null})}};function IJe(t,e){return t&&e!=null&&e>0?new C2({color:te(t),size:e}):null}u([f({type:bz,json:{write:!0}})],_c.prototype,"font",null),u([ke("font")],_c.prototype,"writeFont",null),u([f({type:C2,json:{write:!0}})],_c.prototype,"halo",void 0),u([f({...lEe,json:{default:"center",write:!0}})],_c.prototype,"horizontalAlignment",void 0),u([f({...aEe,json:{default:1,write:!0}})],_c.prototype,"lineHeight",void 0),u([f({type:Nu,json:{write:!0}})],_c.prototype,"material",void 0),u([f({type:YA,json:{write:!0}})],_c.prototype,"background",void 0),u([f(Tm)],_c.prototype,"size",null),u([f({type:String,json:{write:!0}})],_c.prototype,"text",void 0),u([_t({Text:"text"},{readOnly:!0})],_c.prototype,"type",void 0),u([f({...cEe,json:{default:"baseline",write:!0}})],_c.prototype,"verticalAlignment",void 0),_c=dF=u([L("esri.symbols.TextSymbol3DLayer")],_c);const Ox=_c;var kq;let l_=kq=class extends Pm{constructor(t){super(t),this.color=Uq.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new kq({color:te(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([f({type:mt,nonNullable:!0,json:{type:[Wi],write:(t,e,i)=>e[i]=t.toArray(mt.AlphaMode.UNLESS_OPAQUE),default:()=>Uq.clone(),defaultEquals:t=>t.toCss(!0)===Uq.toCss(!0)}})],l_.prototype,"color",void 0),u([_t({Water:"water"},{readOnly:!0})],l_.prototype,"type",void 0),u([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],l_.prototype,"waterbodySize",void 0),u([f({type:Number,json:{write:!0,default:null}})],l_.prototype,"waveDirection",void 0),u([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],l_.prototype,"waveStrength",void 0),l_=kq=u([L("esri.symbols.WaterSymbol3DLayer")],l_);const hEe=l_,Uq=new mt([0,119,190]);var zq;let dw=zq=class extends Ne{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new zq({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([f({type:String})],dw.prototype,"name",void 0),u([f({type:String})],dw.prototype,"styleUrl",void 0),u([f({type:String})],dw.prototype,"styleName",void 0),u([f({type:va})],dw.prototype,"portal",void 0),dw=zq=u([L("esri.symbols.support.StyleOrigin")],dw);const Vq=dw;var Bq;let XA=Bq=class extends Ne{constructor(){super(...arguments),this.url=""}clone(){return new Bq({url:this.url})}};u([f({type:String})],XA.prototype,"url",void 0),XA=Bq=u([L("esri.symbols.support.Thumbnail")],XA);const dEe={icon:Q_,object:xz,line:eM,path:DK,fill:$x,extrude:q2e,text:Ox,water:hEe},PJe=ot.ofType({base:Pm,key:"type",typeMap:dEe,errorContext:"symbol-layer"});let zf=class extends Ya{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i==null?void 0:i.type,n=r||ot;this._set("symbolLayers",new n)}get color(){return null}set color(e){this.constructed&&de.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){vm(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const n=NC(e.styleUrl,r);return new Vq({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new Vq({portal:(r==null?void 0:r.portal)||va.getDefault(),styleName:e.styleName,name:e.name});r!=null&&r.messages&&r.messages.push(new Yp("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,n){if(e.styleUrl&&e.name){let s=U3(e.styleUrl,n);Fu(s)&&(s=nd(s)),i.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&(n!=null&&n.portal)&&!Eve(e.portal.restUrl,n.portal.restUrl)?n!=null&&n.messages&&n.messages.push(new Yp("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Pm||e&&dEe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([f({json:{read:!1,write:!1}})],zf.prototype,"color",null),u([f({type:PJe,nonNullable:!0,json:{write:!0}}),$i(RJ)],zf.prototype,"symbolLayers",null),u([f({type:Vq})],zf.prototype,"styleOrigin",void 0),u([Pe("styleOrigin")],zf.prototype,"readStyleOrigin",null),u([ke("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],zf.prototype,"writeStyleOrigin",null),u([f({type:XA,json:{read:!1}})],zf.prototype,"thumbnail",void 0),u([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],zf.prototype,"type",void 0),zf=u([L("esri.symbols.Symbol3D")],zf);const Ax=zf;let NO=class extends we{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};u([f({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],NO.prototype,"type",void 0),u([f({readOnly:!0})],NO.prototype,"visible",void 0),NO=u([L("esri.symbols.callouts.Callout3D")],NO);const pEe=NO;var jq;let pF=jq=class extends we{constructor(t){super(t),this.color=new mt("white")}clone(){return new jq({color:te(this.color)})}};u([f(Fy)],pF.prototype,"color",void 0),pF=jq=u([L("esri.symbols.callouts.LineCallout3DBorder")],pF);const LJe=pF;var Gq;let c_=Gq=class extends pEe{constructor(t){super(t),this.type="line",this.color=new mt([0,0,0,1]),this.size=ud(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new Gq({color:te(this.color),size:this.size,border:te(this.border)})}};u([_t({line:"line"})],c_.prototype,"type",void 0),u([f(Fy)],c_.prototype,"color",void 0),u([f(Tm)],c_.prototype,"size",void 0),u([f({type:LJe,json:{write:!0}})],c_.prototype,"border",void 0),u([f({readOnly:!0})],c_.prototype,"visible",null),c_=Gq=u([L("esri.symbols.callouts.LineCallout3D")],c_);const fEe=c_;function NK(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function mEe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!NK(t)}function gEe(t){return t.type==="point-3d"||t.type==="label-3d"}function DJe(t){return t.horizontalAlignment==="center"}const yEe={types:{key:"type",base:pEe,typeMap:{line:fEe}},json:{write:!0}};var Hq;let MT=Hq=class extends we{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new Hq({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([f(Tm)],MT.prototype,"screenLength",void 0),u([f({type:Number,nonNullable:!0,json:{write:!0,default:0}})],MT.prototype,"minWorldLength",void 0),u([f({type:Number,json:{write:!0}})],MT.prototype,"maxWorldLength",void 0),MT=Hq=u([L("esri.symbols.support.Symbol3DVerticalOffset")],MT);const FK=MT;var fF;const _Ee=ot.ofType({base:null,key:"type",typeMap:{text:Ox}});let u_=fF=class extends Ax{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new _Ee,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return mEe(this)}hasVisibleVerticalOffset(){return NK(this)}clone(){return new fF({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail),callout:te(this.callout),verticalOffset:te(this.verticalOffset)})}static fromTextSymbol(t){return new fF({symbolLayers:new ot([Ox.fromTextSymbol(t)])})}};u([f({type:FK,json:{write:!0}})],u_.prototype,"verticalOffset",void 0),u([f(yEe)],u_.prototype,"callout",void 0),u([f({json:{read:!1,write:!1}})],u_.prototype,"styleOrigin",void 0),u([f({type:_Ee})],u_.prototype,"symbolLayers",void 0),u([_t({LabelSymbol3D:"label-3d"},{readOnly:!0})],u_.prototype,"type",void 0),u_=fF=u([L("esri.symbols.LabelSymbol3D")],u_);const Sz=u_;var mF;const vEe=ot.ofType({base:null,key:"type",typeMap:{line:eM,path:DK}}),NJe=ot.ofType({base:null,key:"type",typeMap:{line:eM,path:DK}});let FO=mF=class extends Ax{constructor(t){super(t),this.symbolLayers=new vEe,this.type="line-3d"}clone(){return new mF({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromSimpleLineSymbol(t){return new mF({symbolLayers:new ot([eM.fromSimpleLineSymbol(t)])})}};u([f({type:vEe,json:{type:NJe}})],FO.prototype,"symbolLayers",void 0),u([_t({LineSymbol3D:"line-3d"},{readOnly:!0})],FO.prototype,"type",void 0),FO=mF=u([L("esri.symbols.LineSymbol3D")],FO);const Rx=FO;let h_=class extends Ya{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],h_.prototype,"angle",void 0),u([f({type:["simple-marker","picture-marker"],readOnly:!0})],h_.prototype,"type",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],h_.prototype,"xoffset",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],h_.prototype,"yoffset",void 0),u([f({cast:t=>t==="auto"?t:Hl(mr(t)),json:{write:!0}})],h_.prototype,"size",void 0),h_=u([L("esri.symbols.MarkerSymbol")],h_);const wEe=h_;var gF;const bEe=ot.ofType({base:null,key:"type",typeMap:{fill:$x}});let kO=gF=class extends Ax{constructor(t){super(t),this.symbolLayers=new bEe,this.type="mesh-3d"}clone(){return new gF({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromSimpleFillSymbol(t){return new gF({symbolLayers:new ot([$x.fromSimpleFillSymbol(t)])})}};u([f({type:bEe})],kO.prototype,"symbolLayers",void 0),u([_t({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],kO.prototype,"type",void 0),kO=gF=u([L("esri.symbols.MeshSymbol3D")],kO);const Q3=kO;function FJe(t,e,i){return e.imageData?Mve({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):xEe(e.url,i)}function xEe(t,e){if(!Fu(t)){const i=UJe(e);if(i)return ld(i,"images",t)}return NC(t,e)}function kJe(t,e,i,r){if(Rm(t)){const n=RE(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,i&&i.imageData===e.imageData&&i.url&&Hb(i.url,e,"url",r)}else Hb(t,e,"url",r)}const SEe={json:{read:{source:["imageData","url"],reader:FJe},write:{writer(t,e,i,r){kJe(t,e,this.source,r)}}}},TEe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=xEe(e.url,i)),r}}}};function UJe(t){var n,s;if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i==null?void 0:i.type;return r==="feature"||r==="stream"?(n=i.parsedUrl)==null?void 0:n.path:r==="map-image"||r==="tile"?(s=t.url)==null?void 0:s.path:null}var qq;let vh=qq=class extends Z2e{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),i!=null&&(n.width=mr(i)),r!=null&&(n.height=mr(r)),n}clone(){const t=new qq({color:te(this.color),height:this.height,outline:te(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",te(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([_t({esriPFS:"picture-fill"},{readOnly:!0})],vh.prototype,"type",void 0),u([f(SEe)],vh.prototype,"url",void 0),u([f({type:Number,json:{write:!0}})],vh.prototype,"xscale",void 0),u([f({type:Number,json:{write:!0}})],vh.prototype,"yscale",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],vh.prototype,"width",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],vh.prototype,"height",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],vh.prototype,"xoffset",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],vh.prototype,"yoffset",void 0),u([f(TEe)],vh.prototype,"source",void 0),vh=qq=u([L("esri.symbols.PictureFillSymbol")],vh);const kK=vh;var Wq;let ep=Wq=class extends wEe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=mr(e)),i!=null&&(r.height=mr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new Wq({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",te(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([f({json:{write:!1}})],ep.prototype,"color",void 0),u([_t({esriPMS:"picture-marker"},{readOnly:!0})],ep.prototype,"type",void 0),u([f(SEe)],ep.prototype,"url",void 0),u([f(TEe)],ep.prototype,"source",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],ep.prototype,"height",void 0),u([Pe("height",["height","size"])],ep.prototype,"readHeight",null),u([f({type:Number,cast:mr,json:{write:!0}})],ep.prototype,"width",void 0),u([f({json:{write:!1}})],ep.prototype,"size",void 0),ep=Wq=u([L("esri.symbols.PictureMarkerSymbol")],ep);const K3=ep;var pw;const EEe=ot.ofType({base:null,key:"type",typeMap:{icon:Q_,object:xz,text:Ox}});let fw=pw=class extends Ax{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new EEe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return mEe(this)}hasVisibleVerticalOffset(){return NK(this)}clone(){return new pw({verticalOffset:te(this.verticalOffset),callout:te(this.callout),styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new pw({symbolLayers:new ot([Q_.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new pw({symbolLayers:new ot([Q_.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var r,n;if(((n=(r=t.data)==null?void 0:r.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new pw(i!=null&&i.callout?{symbolLayers:new ot([Q_.fromCIMSymbol(t)]),callout:new fEe({size:.5,color:new mt([0,0,0])}),verticalOffset:new FK({screenLength:40})}:{symbolLayers:new ot([Q_.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new pw({symbolLayers:new ot([Ox.fromTextSymbol(t)])})}};u([f({type:FK,json:{write:!0}})],fw.prototype,"verticalOffset",void 0),u([f(yEe)],fw.prototype,"callout",void 0),u([f({type:EEe,json:{origins:{"web-scene":{write:!0}}}})],fw.prototype,"symbolLayers",void 0),u([_t({PointSymbol3D:"point-3d"},{readOnly:!0})],fw.prototype,"type",void 0),fw=pw=u([L("esri.symbols.PointSymbol3D")],fw);const td=fw;var UO;const CEe=ot.ofType({base:null,key:"type",typeMap:{extrude:q2e,fill:$x,icon:Q_,line:eM,object:xz,text:Ox,water:hEe}});let zO=UO=class extends Ax{constructor(t){super(t),this.symbolLayers=new CEe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&ME(de.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&ME(de.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(Vo(()=>this.symbolLayers,"after-add",({item:e})=>t(e),xi))}clone(){return new UO({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromJSON(t){var i;const e=new UO;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),n=e.symbolLayers.at(1);!n.enabled||(i=t.symbolLayers)!=null&&i[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:n.size,color:n.material!=null?n.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new UO({symbolLayers:new ot([$x.fromSimpleFillSymbol(t)])})}};u([f({type:CEe,json:{write:!0}})],zO.prototype,"symbolLayers",void 0),u([_t({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],zO.prototype,"type",void 0),zO=UO=u([L("esri.symbols.PolygonSymbol3D")],zO);const Kv=zO;var Zq;const yj=new sr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let mw=Zq=class extends Z2e{constructor(...t){super(...t),this.color=new mt([0,0,0,.25]),this.outline=new Wu,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new Zq({color:te(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([f()],mw.prototype,"color",void 0),u([f()],mw.prototype,"outline",void 0),u([_t({esriSFS:"simple-fill"},{readOnly:!0})],mw.prototype,"type",void 0),u([f({type:yj.apiValues,json:{read:yj.read,write:yj.write}})],mw.prototype,"style",void 0),mw=Zq=u([L("esri.symbols.SimpleFillSymbol")],mw);const Ix=mw;var Yq;const _j=new sr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Vf=Yq=class extends wEe{constructor(...t){super(...t),this.color=new mt([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Wu}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=mr(e)),i&&(n.outline=i),r&&(n.color=r),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new Yq({angle:this.angle,color:te(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([f()],Vf.prototype,"color",void 0),u([ke("color")],Vf.prototype,"writeColor",null),u([_t({esriSMS:"simple-marker"},{readOnly:!0})],Vf.prototype,"type",void 0),u([f()],Vf.prototype,"size",void 0),u([f({type:_j.apiValues,json:{read:_j.read,write:_j.write}})],Vf.prototype,"style",void 0),u([f({type:String,json:{write:!0}})],Vf.prototype,"path",null),u([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Wu}},json:{default:null,write:!0}})],Vf.prototype,"outline",void 0),Vf=Yq=u([L("esri.symbols.SimpleMarkerSymbol")],Vf);const Lm=Vf;var Xq;let qn=Xq=class extends Ya{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new bz,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return mr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new Xq({angle:this.angle,backgroundColor:te(this.backgroundColor),borderLineColor:te(this.borderLineColor),borderLineSize:this.borderLineSize,color:te(this.color),font:this.font&&this.font.clone(),haloColor:te(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,i;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(i=this.haloColor)==null?void 0:i.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([f({type:mt,json:{write:!0}})],qn.prototype,"backgroundColor",void 0),u([f({type:mt,json:{write:!0}})],qn.prototype,"borderLineColor",void 0),u([f({type:Number,json:{write:!0},cast:mr})],qn.prototype,"borderLineSize",void 0),u([f({type:bz,json:{write:!0}})],qn.prototype,"font",void 0),u([f({...lEe,json:{write:!0}})],qn.prototype,"horizontalAlignment",void 0),u([f({type:Boolean,json:{write:!0}})],qn.prototype,"kerning",void 0),u([f({type:mt,json:{write:!0}})],qn.prototype,"haloColor",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],qn.prototype,"haloSize",void 0),u([f({type:Boolean,json:{write:!0}})],qn.prototype,"rightToLeft",void 0),u([f({type:Boolean,json:{write:!0}})],qn.prototype,"rotated",void 0),u([f({type:String,json:{write:!0}})],qn.prototype,"text",void 0),u([_t({esriTS:"text"},{readOnly:!0})],qn.prototype,"type",void 0),u([f({...cEe,json:{write:!0}})],qn.prototype,"verticalAlignment",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],qn.prototype,"xoffset",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],qn.prototype,"yoffset",void 0),u([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],qn.prototype,"angle",void 0),u([f({type:Number,json:{write:!0}})],qn.prototype,"width",void 0),u([f({type:Number})],qn.prototype,"lineWidth",void 0),u([ke("lineWidth")],qn.prototype,"writeLineWidth",null),u([$i("lineWidth")],qn.prototype,"castLineWidth",null),u([f(aEe)],qn.prototype,"lineHeight",void 0),u([ke("lineHeight")],qn.prototype,"writeLineHeight",null),qn=Xq=u([L("esri.symbols.TextSymbol")],qn);const tM=qn;var Jq;let tp=Jq=class extends Ya{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:va.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new Jq({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:n}=await fe(()=>import("./webStyleSymbolUtils-CCH7KzLJ.js"),__vite__mapDeps([106,107]));zt(e);const s=n(this,{portal:this.portal},t,e);s.catch(a=>{de.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i!=null&&i.set(r,o.clone()),o):null}};u([f({json:{write:!1}})],tp.prototype,"color",void 0),u([f({type:String,json:{write:!0}})],tp.prototype,"styleName",void 0),u([f({type:va,json:{write:!1}})],tp.prototype,"portal",void 0),u([f({type:String,json:{read:qJ,write:Hb}})],tp.prototype,"styleUrl",void 0),u([f({type:XA,json:{read:!1}})],tp.prototype,"thumbnail",void 0),u([f({type:String,json:{write:!0}})],tp.prototype,"name",void 0),u([_t({styleSymbolReference:"web-style"},{readOnly:!0})],tp.prototype,"type",void 0),u([f()],tp.prototype,"_fetchCacheKey",null),tp=Jq=u([L("esri.symbols.WebStyleSymbol")],tp);const Px=tp;function uDt(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function xce(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const K_={base:Ya,key:"type",typeMap:{"simple-fill":Ix,"picture-fill":kK,"picture-marker":K3,"simple-line":Wu,"simple-marker":Lm,text:tM,"label-3d":Sz,"line-3d":Rx,"mesh-3d":Q3,"point-3d":td,"polygon-3d":Kv,"web-style":Px,cim:Jv},errorContext:"symbol"},hDt={base:Ya,key:"type",typeMap:{"picture-marker":K3,"simple-marker":Lm,"point-3d":td,cim:Jv},errorContext:"symbol"},dDt={base:Ya,key:"type",typeMap:{"simple-line":Wu,"line-3d":Rx,cim:Jv},errorContext:"symbol"},pDt={base:Ya,key:"type",typeMap:{"simple-fill":Ix,"picture-fill":kK,"polygon-3d":Kv,cim:Jv},errorContext:"symbol"},zJe={base:Ya,key:"type",typeMap:{"picture-marker":K3,"simple-marker":Lm,text:tM,"web-style":Px,cim:Jv},errorContext:"symbol"},VJe=IC({types:K_}),MEe={base:Ya,key:"type",typeMap:{"simple-fill":Ix,"picture-fill":kK,"picture-marker":K3,"simple-line":Wu,"simple-marker":Lm,text:tM,"line-3d":Rx,"mesh-3d":Q3,"point-3d":td,"polygon-3d":Kv,"web-style":Px,cim:Jv},errorContext:"symbol"},BJe={base:Ya,key:"type",typeMap:{text:tM,"label-3d":Sz},errorContext:"symbol"},Sce={base:Ya,key:"type",typeMap:{"line-3d":Rx,"mesh-3d":Q3,"point-3d":td,"polygon-3d":Kv,"web-style":Px,cim:Jv},errorContext:"symbol"},jJe={base:Ya,key:"type",typeMap:{"label-3d":Sz},errorContext:"symbol"},$Ee=Bu(K_);var Qq;function GJe(t){if(!t)return null;const e={};for(const i in t){const r=Sv(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function HJe(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let vc=Qq=class extends Or(we){constructor(t){super(t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,this._version=0,Object.defineProperty(this,"uid",{value:rd(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&ZNe(de.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),(t==null?void 0:t.type)!=="mesh"&&this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}get version(){return this._version}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new Qq({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[e,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(t&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:HJe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:W4(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(this._version++,!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(n.action=r),t==="attributes"&&(n.attributeName=r),this.layer.graphicChanged(n)}_watchMeshGeometryChanges(){this.addHandles([Kl(()=>{var t,e;return((t=this.geometry)==null?void 0:t.type)==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:(e=this.geometry.transform)==null?void 0:e.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0},({localMatrix:t,origin:e})=>{this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===e||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=e,this.notifyMeshTransformChanged())}),Kl(()=>{var t;return((t=this.geometry)==null?void 0:t.type)==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0},()=>{var e;const t=this.geometry;(t==null?void 0:t.type)==="mesh"&&t.vertexSpace.origin?(this._lastMeshTransform.localMatrix=(e=t.transform)==null?void 0:e.localMatrix,this._lastMeshTransform.origin=t.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(t,e)=>t===e,sync:!0})])}};u([f({value:null,json:{read:GJe}})],vc.prototype,"aggregateGeometries",null),u([f({value:null})],vc.prototype,"attributes",null),u([f({value:null,types:UC,json:{read:Sv}})],vc.prototype,"geometry",null),u([f({type:Boolean})],vc.prototype,"isAggregate",void 0),u([f({clonable:"reference"})],vc.prototype,"layer",void 0),u([f({clonable:"reference"})],vc.prototype,"origin",void 0),u([f({type:KC})],vc.prototype,"popupTemplate",void 0),u([f({clonable:"reference"})],vc.prototype,"sourceLayer",void 0),u([f({value:null,types:K_})],vc.prototype,"symbol",null),u([f({clonable:!1,json:{read:!1,write:!1}})],vc.prototype,"_version",void 0),u([f({type:Boolean,value:!0})],vc.prototype,"visible",null),vc=Qq=u([L("esri.Graphic")],vc);const qc=vc;let Ab=class extends HA{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([AJ({Type:qc,ensureType:is(qc)})],Ab.prototype,"itemType",void 0),Ab=u([L("esri.support.GraphicsCollection")],Ab);let d_=class extends Ne{constructor(e){super(e),this.view=null,this.baseLayerViews=new ot,this.referenceLayerViews=new ot,this._loadingHandle=oe(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},Si)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r,n;if((i=this.view)!=null&&i.suspended)return!1;const e=(n=(r=this.view)==null?void 0:r.map)==null?void 0:n.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};u([f({constructOnly:!0})],d_.prototype,"view",void 0),u([f({readOnly:!0})],d_.prototype,"baseLayerViews",void 0),u([f({readOnly:!0})],d_.prototype,"referenceLayerViews",void 0),u([f({readOnly:!0})],d_.prototype,"suspended",null),u([f({type:Boolean,readOnly:!0})],d_.prototype,"updating",null),d_=u([L("esri.views.BasemapView")],d_);const qJe=d_;function WJe(t){return"tryRecycleWith"in t}function ZJe(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let YJe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=Ho(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,_a(this._controller.signal,()=>{const n=new Y("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!WJe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==i)continue;const o=this.layerView.tryRecycleWith(s,{signal:r});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(zt(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>_a(this._controller.signal,()=>h(ki())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var n,s;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),JJe(i))o=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new Y("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(i);zt(e),o="default"in h?new h.default({layer:i,view:r}):new h({layer:i,view:r})}const l=()=>{a=Sr(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=_a(e,l),zt(e);try{await o.when()}catch(h){throw l(),h}if(!((s=(n=this._map)==null?void 0:n.allLayers)==null?void 0:s.includes(i)))return l(),void this._deferred.reject(new Y("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new Y("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}},wh=class extends Ne{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new hv,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const n of i)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Ho(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(AC(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,n=[],s=this.view.ready,o=p=>{if(p!=null){for(const g of p)if(g){r.add(g);const y=this._layerLayerViewInfoMap.get(g);y&&s?y.start():y||this._recyclingInfoMap.has(g)||n.push(g),"layers"in g&&g.layers&&o(g.layers)}}};for(const p of this._rootCollectionNames)o(Vp(this,p));for(const[p,g]of this._layerLayerViewInfoMap)if(!r.has(p)){this._layerLayerViewInfoMap.delete(g.layer);const y=g.tryRecycle(n);y?(this.notifyChange("updating"),this._recyclingInfoMap.set(g.layer,g),y.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(g.layer),this._layerLayerViewInfoMap.set(g.layer,g),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(g.layer),g.destroy(),this._reschedule()})):g.destroy()}for(const[p,g]of this._recyclingInfoMap)r.has(p)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(g.layer),g.destroy());for(const p of n)this._createLayerView(p);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(h=i==null?void 0:i.basemap)==null?void 0:h.referenceLayers,i==null?void 0:i.layers].filter(p=>!!p);r.forEach(p=>"layers"in p&&a.push(p.layers)),this.addHandles(a.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Vo(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),oe(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),hi)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),I6(this._recyclingInfoMap),I6(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(ki()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||ny(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(I6(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new Y("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){var s;this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!(r!=null&&r.done))return!0;const n=r.layerView;return!(!n||!i||n.parent===i)||!!(r.done&&n&&"layers"in e&&((s=e.layers)!=null&&s.length))&&e.layers.some(o=>this.isCreatingLayerViewsForLayer(o,n))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Vp(this,e),Vp(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=s,a.parent=r,i.at(n)!==a&&i.splice(n,0,a),"layers"in s&&ZJe(a)&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<i.length&&i.splice(n,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new YJe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(Bn(r)||r.name==="cancelled:layerview-create")||de.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([f()],wh.prototype,"_workPromise",void 0),u([f({readOnly:!0})],wh.prototype,"_watchUpdatingTracking",void 0),u([f({readOnly:!0})],wh.prototype,"_layersToLayerViews",null),u([f({readOnly:!0})],wh.prototype,"_rootCollectionNames",null),u([f()],wh.prototype,"layerViewImporter",void 0),u([f()],wh.prototype,"supportsGround",void 0),u([f({readOnly:!0})],wh.prototype,"updating",null),u([f({readOnly:!0})],wh.prototype,"updatingRemaining",null),u([f({constructOnly:!0})],wh.prototype,"view",void 0),wh=u([L("esri.views.LayerViewManager")],wh);const XJe=wh;function JJe(t){return"createLayerView"in t&&t.createLayerView!=null}let mu=class extends Ne{constructor(e){super(e),this.factor=1.5,this.offset=ju(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([f({type:Number})],mu.prototype,"factor",void 0),u([f({nonNullable:!0})],mu.prototype,"offset",void 0),u([f()],mu.prototype,"position",void 0),u([f({type:Number,range:{min:0}})],mu.prototype,"size",void 0),u([f()],mu.prototype,"maskUrl",void 0),u([f()],mu.prototype,"maskEnabled",void 0),u([f()],mu.prototype,"overlayUrl",void 0),u([f()],mu.prototype,"overlayEnabled",void 0),u([f({readOnly:!0})],mu.prototype,"version",null),u([f({type:Boolean})],mu.prototype,"visible",void 0),mu=u([L("esri.views.Magnifier")],mu);const OEe=mu;let yF=class{constructor(e){this._observable=new L3,this._map=new Map(e)}get size(){return qt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return qt(this._observable),this._map.entries()}forEach(e,i){qt(this._observable),this._map.forEach((r,n)=>e.call(i,r,n,this),i)}get(e){return qt(this._observable),this._map.get(e)}has(e){return qt(this._observable),this._map.has(e)}keys(){return qt(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return qt(this._observable),this._map.values()}[Symbol.iterator](){return qt(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var Kq;let ub=Kq=class extends we{constructor(t){super(t),this.name=null,this.code=null}clone(){return new Kq({name:this.name,code:this.code})}};u([f({type:String,json:{write:!0}})],ub.prototype,"name",void 0),u([f({type:[String,Number],json:{write:!0}})],ub.prototype,"code",void 0),ub=Kq=u([L("esri.layers.support.CodedValue")],ub);const QJe=new sr({inherited:"inherited",codedValue:"coded-value",range:"range"});let VO=class extends we{constructor(e){super(e),this.name=null,this.type=null}};u([f({type:String,json:{write:!0}})],VO.prototype,"name",void 0),u([_t(QJe)],VO.prototype,"type",void 0),VO=u([L("esri.layers.support.Domain")],VO);const Tz=VO;var eW;let BO=eW=class extends Tz{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new eW({codedValues:te(this.codedValues),name:this.name})}};u([f({type:[ub],json:{write:!0}})],BO.prototype,"codedValues",void 0),u([_t({codedValue:"coded-value"})],BO.prototype,"type",void 0),BO=eW=u([L("esri.layers.support.CodedValueDomain")],BO);const Ez=BO;var tW;let _F=tW=class extends Tz{constructor(t){super(t),this.type="inherited"}clone(){return new tW}};u([_t({inherited:"inherited"})],_F.prototype,"type",void 0),_F=tW=u([L("esri.layers.support.InheritedDomain")],_F);const AEe=_F;var iW;let $T=iW=class extends Tz{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new iW({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([f({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],$T.prototype,"maxValue",void 0),u([f({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[0]}},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],$T.prototype,"minValue",void 0),u([_t({range:"range"})],$T.prototype,"type",void 0),$T=iW=u([L("esri.layers.support.RangeDomain")],$T);const REe=$T,IEe={key:"type",base:Tz,typeMap:{range:REe,"coded-value":Ez,inherited:AEe}};function Cz(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return REe.fromJSON(t);case"codedValue":return Ez.fromJSON(t);case"inherited":return AEe.fromJSON(t)}return null}var rW;const KJe=new sr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let ll=rW=class extends we{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?KJe.fromJSON(i.fieldValueType):null}clone(){var t;return new rW({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((t=this.domain)==null?void 0:t.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([f({type:String,json:{write:!0}})],ll.prototype,"alias",void 0),u([f({type:[String,Number],json:{write:{allowNull:!0}}})],ll.prototype,"defaultValue",void 0),u([f()],ll.prototype,"description",void 0),u([Pe("description")],ll.prototype,"readDescription",null),u([f({types:IEe,json:{read:{reader:Cz},write:!0}})],ll.prototype,"domain",void 0),u([f({type:Boolean,json:{write:!0}})],ll.prototype,"editable",void 0),u([f({type:Wi,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],ll.prototype,"length",void 0),u([f({type:String,json:{write:!0}})],ll.prototype,"name",void 0),u([f({type:Boolean,json:{write:!0}})],ll.prototype,"nullable",void 0),u([_t(PQ)],ll.prototype,"type",void 0),u([f()],ll.prototype,"valueType",void 0),u([Pe("valueType",["description"])],ll.prototype,"readValueType",null),u([f({type:Boolean,json:{read:!1}})],ll.prototype,"visible",void 0),ll=rW=u([L("esri.layers.support.Field")],ll);const Mz=ll;var nW;let OT=nW=class extends we{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new nW({mapLayerId:t,gdbVersion:e})}};u([_t({mapLayer:"map-layer"})],OT.prototype,"type",void 0),u([f({type:Wi,json:{write:!0}})],OT.prototype,"mapLayerId",void 0),u([f({type:String,json:{write:!0}})],OT.prototype,"gdbVersion",void 0),OT=nW=u([L("esri.layers.support.source.MapLayerSource")],OT);var sW;let wg=sW=class extends we{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:n};return new sW(s)}};u([_t({queryTable:"query-table"})],wg.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],wg.prototype,"workspaceId",void 0),u([f({type:String,json:{write:!0}})],wg.prototype,"query",void 0),u([f({type:String,json:{write:!0}})],wg.prototype,"oidFields",void 0),u([f({type:nt,json:{write:!0}})],wg.prototype,"spatialReference",void 0),u([_t(Twe)],wg.prototype,"geometryType",void 0),wg=sW=u([L("esri.layers.support.source.QueryTableDataSource")],wg);var oW;let AT=oW=class extends we{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new oW({workspaceId:t,dataSourceName:e})}};u([_t({raster:"raster"})],AT.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],AT.prototype,"dataSourceName",void 0),u([f({type:String,json:{write:!0}})],AT.prototype,"workspaceId",void 0),AT=oW=u([L("esri.layers.support.source.RasterDataSource")],AT);var aW;let gw=aW=class extends we{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new aW({workspaceId:t,gdbVersion:e,dataSourceName:i})}};u([_t({table:"table"})],gw.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],gw.prototype,"workspaceId",void 0),u([f({type:String,json:{write:!0}})],gw.prototype,"gdbVersion",void 0),u([f({type:String,json:{write:!0}})],gw.prototype,"dataSourceName",void 0),gw=aW=u([L("esri.layers.support.source.TableDataSource")],gw);var lW,cW;const eQe=Za()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let gu=lW=class extends we{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Tce()(t,e,i)}castLeftTableSource(t){return Bu(uW(),t)}readRightTableSource(t,e,i){return Tce()(t,e,i)}castRightTableSource(t){return Bu(uW(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:n};return new lW(s)}};u([_t({joinTable:"join-table"})],gu.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],gu.prototype,"leftTableKey",void 0),u([f({type:String,json:{write:!0}})],gu.prototype,"rightTableKey",void 0),u([f({json:{write:!0}})],gu.prototype,"leftTableSource",void 0),u([Pe("leftTableSource")],gu.prototype,"readLeftTableSource",null),u([$i("leftTableSource")],gu.prototype,"castLeftTableSource",null),u([f({json:{write:!0}})],gu.prototype,"rightTableSource",void 0),u([Pe("rightTableSource")],gu.prototype,"readRightTableSource",null),u([$i("rightTableSource")],gu.prototype,"castRightTableSource",null),u([_t(eQe)],gu.prototype,"joinType",void 0),gu=lW=u([L("esri.layers.support.source.JoinTableDataSource")],gu);let vj=null;function Tce(){return vj||(vj=IC({types:uW()})),vj}let wj=null;function uW(){return wj||(wj={key:"type",base:null,typeMap:{"data-layer":gp,"map-layer":OT}}),wj}const tQe={key:"type",base:null,typeMap:{"join-table":gu,"query-table":wg,raster:AT,table:gw}};let gp=cW=class extends we{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new cW({fields:t,dataSource:e})}};u([_t({dataLayer:"data-layer"})],gp.prototype,"type",void 0),u([f({type:[Mz],json:{write:!0}})],gp.prototype,"fields",void 0),u([f({types:tQe,json:{write:!0}})],gp.prototype,"dataSource",void 0),gp=cW=u([L("esri.layers.support.source.DataLayerSource")],gp),gp.from=is(gp);let yw=class extends Or(we){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([f({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],yw.prototype,"onFields",void 0),u([f({type:String,json:{write:!0}})],yw.prototype,"operator",void 0),u([f({type:String,json:{write:!0}})],yw.prototype,"searchTerm",void 0),u([f({type:String,json:{write:!0}})],yw.prototype,"searchType",void 0),yw=u([L("esri.rest.support.FullTextSearch")],yw);const iQe=yw;var hW;const Ece=new sr({upperLeft:"upper-left",lowerLeft:"lower-left"});let _w=hW=class extends we{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new hW(te({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([f({type:pr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],_w.prototype,"extent",void 0),u([f({type:["view","edit"],json:{write:!0}})],_w.prototype,"mode",void 0),u([f({type:String,json:{read:Ece.read,write:Ece.write}})],_w.prototype,"originPosition",void 0),u([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],_w.prototype,"tolerance",void 0),_w=hW=u([L("esri.rest.support.QuantizationParameters")],_w);const rQe=_w,nQe=new sr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var dW;const Cce=new sr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let ip=dW=class extends we{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=te(t))}clone(){return new dW({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:te(this.statisticParameters)})}};u([f({type:Number,json:{write:!0}})],ip.prototype,"maxPointCount",void 0),u([f({type:Number,json:{write:!0}})],ip.prototype,"maxRecordCount",void 0),u([f({type:Number,json:{write:!0}})],ip.prototype,"maxVertexCount",void 0),u([f({type:String,json:{write:!0}})],ip.prototype,"onStatisticField",void 0),u([f({type:String,json:{write:!0}})],ip.prototype,"outStatisticFieldName",void 0),u([f({type:String,json:{read:{source:"statisticType",reader:Cce.read},write:{target:"statisticType",writer:Cce.write}}})],ip.prototype,"statisticType",void 0),u([f({type:Object})],ip.prototype,"statisticParameters",void 0),u([ke("statisticParameters")],ip.prototype,"writeStatisticParameters",null),ip=dW=u([L("esri.rest.support.StatisticDefinition")],ip);const sQe=ip;var vF;const oQe=new sr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Zt=vF=class extends we{static from(t){return dU(vF,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const n=t[r];Array.isArray(n)?i[r]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?i[r]=n.getTime():i[r]=n}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new vF(te({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Zt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([f({json:{write:!0}})],Zt.prototype,"aggregateIds",void 0),u([f({type:Boolean,json:{write:!0}})],Zt.prototype,"cacheHint",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],Zt.prototype,"compactGeometryEnabled",void 0),u([f({json:{write:!0}})],Zt.prototype,"datumTransformation",void 0),u([$i("datumTransformation")],Zt.prototype,"castDatumTransformation",null),u([f({type:Boolean,json:{default:!1,write:!0}})],Zt.prototype,"defaultSpatialReferenceEnabled",void 0),u([f({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Zt.prototype,"distance",void 0),u([f({type:gp,json:{write:!0}})],Zt.prototype,"dynamicDataSource",void 0),u([f({type:String,json:{write:!0}})],Zt.prototype,"formatOf3DObjects",void 0),u([f({type:[iQe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Zt.prototype,"fullText",void 0),u([f({type:String,json:{write:!0}})],Zt.prototype,"gdbVersion",void 0),u([f({types:UC,json:{read:Sv,write:!0}})],Zt.prototype,"geometry",void 0),u([f({type:Number,json:{write:!0}})],Zt.prototype,"geometryPrecision",void 0),u([f({type:[String],json:{write:!0}})],Zt.prototype,"groupByFieldsForStatistics",void 0),u([f({type:String,json:{write:!0}})],Zt.prototype,"having",void 0),u([f({type:Date})],Zt.prototype,"historicMoment",void 0),u([ke("historicMoment")],Zt.prototype,"writeHistoricMoment",null),u([f({type:Number,json:{write:!0}})],Zt.prototype,"maxAllowableOffset",void 0),u([f({type:Number,cast:t=>t<1?1:t>Zt.MAX_MAX_RECORD_COUNT_FACTOR?Zt.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Zt.prototype,"maxRecordCountFactor",void 0),u([f({type:["xyFootprint"],json:{write:!0}})],Zt.prototype,"multipatchOption",void 0),u([f({type:Number,json:{read:{source:"resultRecordCount"}}})],Zt.prototype,"num",void 0),u([f({json:{write:!0}})],Zt.prototype,"objectIds",void 0),u([f({type:[String],json:{write:!0}})],Zt.prototype,"orderByFields",void 0),u([f({type:[String],json:{write:!0}})],Zt.prototype,"outFields",void 0),u([f({type:nt,json:{name:"outSR",write:!0}})],Zt.prototype,"outSpatialReference",void 0),u([f({type:[sQe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Zt.prototype,"outStatistics",void 0),u([f({json:{write:!0}})],Zt.prototype,"parameterValues",void 0),u([ke("parameterValues")],Zt.prototype,"writeParameterValues",null),u([f({type:wt,json:{write:!0}})],Zt.prototype,"pixelSize",void 0),u([f({type:rQe,json:{write:!0}})],Zt.prototype,"quantizationParameters",void 0),u([f({type:[Object],json:{write:!0}})],Zt.prototype,"rangeValues",void 0),u([f({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Zt.prototype,"relationParameter",void 0),u([f({type:String,json:{write:!0}})],Zt.prototype,"resultType",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],Zt.prototype,"returnCentroid",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],Zt.prototype,"returnDistinctValues",void 0),u([f({type:Boolean,json:{default:!0,write:!0}})],Zt.prototype,"returnExceededLimitFeatures",void 0),u([f({type:Boolean,json:{write:!0}})],Zt.prototype,"returnGeometry",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],Zt.prototype,"returnQueryGeometry",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],Zt.prototype,"returnM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zt.prototype,"returnZ",void 0),u([f({type:nt,json:{write:!0}})],Zt.prototype,"sourceSpatialReference",void 0),u([_t(nQe,{ignoreUnknown:!1,name:"spatialRel"})],Zt.prototype,"spatialRelationship",void 0),u([f({type:Number,json:{read:{source:"resultOffset"}}})],Zt.prototype,"start",void 0),u([ke("start"),ke("num")],Zt.prototype,"writeStart",null),u([f({type:String,json:{write:!0}})],Zt.prototype,"sqlFormat",void 0),u([f({type:String,json:{write:!0}})],Zt.prototype,"text",void 0),u([f({type:ja,json:{write:!0}})],Zt.prototype,"timeExtent",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],Zt.prototype,"timeReferenceUnknownClient",void 0),u([_t(oQe,{ignoreUnknown:!1}),f({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],Zt.prototype,"units",void 0),u([f({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Zt.prototype,"where",void 0),u([ke("where")],Zt.prototype,"writeWhere",null),Zt=vF=u([L("esri.rest.support.Query")],Zt);const Ty=Zt;function TL(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let bg=class extends ns.EventedAccessor{constructor(e){super(e),this._selectionMap=new yF,this._sources=new ot,this._trashCan=[],this._layerEditHandles=new ot,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([oe(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),Vo(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const n of i.removed)r.delete(n);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new ot;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(TL(i)&&!_Ue(i)||Z1(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(Sr)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){vm(e,this._sources)}async getSelectedFeatures(e,i={},r="layerView"){const{view:n,selections:s}=this,o=(e!==void 0?s.filter(a=>e.includes(a.layer)):s).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,h=Z1(l)?l.parent:l;if(h==null||!$ce(h))return null;if(r==="layer")return Oce(h,c,i);if(Mce(h))return null;const p=await n.whenLayerView(h).catch(()=>null);return p?Oce(p,c,i):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const i=new Map;for(const[s,o]of this._selectionMap)i.set(s,[...o.selection]);let r=!1;const n=e.current.concat(e.added);for(const s of n){const o=s.sourceLayer,a=s.getObjectId();if(this.sources.includes(o)&&(TL(o)||Z1(o))&&a!==null){const l=hU(i,o,()=>[]);l.includes(a)||(l.push(a),r=!0)}}for(const s of e.removed){const o=s.sourceLayer,a=s.getObjectId();if(this.sources.includes(o)&&(TL(o)||Z1(o))&&a!==null){const l=i.get(o),c=l==null?void 0:l.indexOf(a);c!==void 0&&c>=0&&(l==null||l.splice(c,1),r=!0)}}if(r){const{_selectionMap:s,_trashCan:o}=this,a=[];for(const[l,c]of i){const h=s.get(l);h!==void 0&&o.push(h),s.set(l,{selection:c}),a.push({layer:l,selection:c,...bH(h!==void 0?h.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){const i=this._selectionMap.get(e);return i==null?void 0:i.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),n=r!==void 0?[...r.selection]:[];for(const s of i)n.includes(s)||n.push(s);this._setSelection(e,n)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const n=[];for(const s of r.selection)i.includes(s)||n.push(s);this._setSelection(e,n)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const n=new Set(r.selection),s=new Set(i),o=jFe(n,s);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,n]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...n.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var o;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const a=this._trashCan.pop();(o=a==null?void 0:a.highlightHandle)==null||o.remove()}const{sources:e,view:i,_selectionMap:r,showHighlight:n}=this,s=this._vizTaskId;for(const a of e){const l=r.get(a),c=Z1(a)?a.parent:a;if(c!=null&&$ce(c)){if(Mce(c))continue;i.whenLayerView(c).then(h=>{var p;(p=l==null?void 0:l.highlightHandle)==null||p.remove(),l!=null&&n&&s===this._vizTaskId&&"highlight"in h&&typeof h.highlight=="function"&&l.selection.length>0&&(l.highlightHandle=h.highlight(l.selection,"selection"))}).catch(()=>{var h;(h=l==null?void 0:l.highlightHandle)==null||h.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Sr);for(const e of this.sources){const i=Z1(e)?e.parent:e;if(i!=null&&TL(i)){const r=i.on("edits",n=>{this._handleEditChanges(n,e)});this._layerEditHandles.push(r)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=e.deletedFeatures.filter(n=>n.error==null).map(n=>n.objectId).filter(Bv);this.removeFromSelection(i,r)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!lQe(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const n={layer:e,selection:[...i],...bH(r!==void 0?r.selection:[],i)};this._onSelectionChange([n])}}};u([f({readOnly:!0,nonNullable:!0})],bg.prototype,"selections",null),u([f({readOnly:!0,nonNullable:!0})],bg.prototype,"count",null),u([f({constructOnly:!0,nonNullable:!0})],bg.prototype,"view",void 0),u([f({readOnly:!0,nonNullable:!0})],bg.prototype,"hasSelection",null),u([f()],bg.prototype,"showHighlight",void 0),u([f()],bg.prototype,"sources",null),bg=u([L("esri.views.SelectionManager")],bg);const Mce=t=>{var e;return Z1(t)?((e=t.parent)==null?void 0:e.isTable)===!0:t.isTable},aQe=t=>t.layer!==void 0,$ce=t=>(t==null?void 0:t.when)!==void 0,lQe=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let n=0;n<i.length;n++)if(i[n]!==r[n])return!1}return!0},Oce=async(t,e,i={})=>{let r;if(aQe(t)){const n=t;r=n===void 0?null:await n.queryFeatures(new Ty({...i,objectIds:e})).then(s=>({data:s,layer:t.layer}))}else{const n=t;r=n===void 0?null:await n.queryFeatures(new Ty({...i,objectIds:e})).then(s=>({data:s,layer:n}))}return r},cQe=bg;let jO=class extends Or(Ne){constructor(e){super(e),this.accentColor=new mt([255,127,0]),this.textColor=new mt([255,255,255])}};u([f({type:mt,nonNullable:!0})],jO.prototype,"accentColor",void 0),u([f({type:mt,nonNullable:!0})],jO.prototype,"textColor",void 0),jO=u([L("esri.views.Theme")],jO);const pW=jO;var Ace;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Ace||(Ace={}));const PEe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],LEe={};function DEe(t){return!!LEe[t]}function uQe(t){for(const e of t)if(!DEe(e))return!1;return!0}PEe.forEach(t=>{LEe[t]=!0});let hQe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,n){const s=Array.isArray(e)?e:e.split(",");if(!uQe(s))return s.some(DEe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:n=r,n=n??pv.DEFAULT;const l=this._createUniqueGroupName(),c=new dQe(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const h of s){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),Ui(()=>this._removeHandler(l,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const n=this._handlerCounts.get(r);n===void 0||(n===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,n-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},dQe=class extends qo{constructor(e,i,r,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of i)switch(s){case"click":this.registerIncoming("click",r,o=>n(mQe(e,o)));break;case"double-click":this.registerIncoming("double-click",r,o=>n(gQe(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>n(yQe(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>n(_Qe(e,o)));break;case"hold":this.registerIncoming("hold",r,o=>n(vQe(e,o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>n(wQe(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>n(bQe(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>n(b$(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>n(b$(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>n(b$(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>n(xQe(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>n(SQe(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>n(b$(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>n(b$(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{n(TQe(o))});break;case"focus":this.registerIncoming("focus",r,o=>{n(pQe(o))});break;case"blur":this.registerIncoming("blur",r,o=>{n(fQe(o))})}}_wrapDrag(e){const i=e.data,{x:r,y:n}=i.center,{action:s,pointerType:o,button:a}=i;if(s==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=e,g={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:r,y:n,origin:g,pointerType:o,button:a,buttons:c,radius:i.radius,angle:vo(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}};function pQe(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function fQe(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function mQe(t,e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:h,screenPoint:ju(s,o),mapPoint:eI(t,s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function gQe(t,e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:eI(t,s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function yQe(t,e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:p,mapPoint:eI(t,s,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}function _Qe(t,e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:p,mapPoint:eI(t,s,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}function vQe(t,e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:eI(t,s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}function eI(t,e,i){return t.toMap(ju(e,i),{exclude:[]})}function wQe(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:n,timestamp:s}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:s,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function bQe(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:n}=t;return{type:"key-up",key:e,native:i,timestamp:n,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:s=>t.async(s),preventDefault:()=>t.preventDefault()}}function b$(t,e){const{x:i,y:r,button:n,buttons:s,native:o,eventId:a}=t.data,l=o.pointerId,c=o.pointerType,{cancelable:h,timestamp:p}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:n,buttons:s,native:o,timestamp:p,eventId:a,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}function xQe(t){const{x:e,y:i,buttons:r,native:n,eventId:s}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,h={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:p,timestamp:g}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:h,native:n,timestamp:g,eventId:s,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}function SQe(t){const{cancelable:e,data:i,timestamp:r}=t,{x:n,y:s,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:n,y:s,deltaY:o,native:a,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function TQe(t){const{action:e,state:i,device:r}=t.data,{cancelable:n,timestamp:s}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:s,action:e,buttons:o,axes:a,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}var JR,Rce,Ice;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(JR||(JR={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Rce||(Rce={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Ice||(Ice={}));function EQe(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return de.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function fW(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(JR.USER)&&t.getEditableFlag(JR.MANAGER)}function Bf(t){return ju(t.x,t.y)}function CDt(t){return ds(t.x,t.y)}function NEe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?ju(e.clientX-i.left,e.clientY-i.top):ju(0,0)}function Pce(t,e){return e instanceof Event?NEe(t,e):Bf(e)}function Lce(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let CQe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":Nce(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:e.action==="start"?this._externallyDragging=!0:e.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Fce(e))break;const n=Bf(e),s=bS(n,e.pointerType,i.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!Fce(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=n==null?void 0:n.manipulator,o=n==null?void 0:n.tool;if(s==null||o==null)break;const a=Bf(e);a.x=Oe(a.x,0,i.view.width),a.y=Oe(a.y,0,i.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const n=Bf(e),s=bS(n,e.pointerType,i.forEachTool);if(MQe(e)||i.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),bj(o,r);break}case"click":{const n=Bf(e),s=bS(n,e.pointerType,i.forEachTool),o=s==null?void 0:s.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const n=Bf(e),s=bS(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),bj(o,r);break}case"immediate-double-click":{const n=Bf(e),s=bS(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),e.pointerType==="mouse"&&bj(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Bf(i)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){var n;const r=(n=this._grabbedManipulators.get(e.pointerId))==null?void 0:n.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Bf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=Dce(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=Dce(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:n})=>{i.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{r.add(n)}),e(n=>{n.hasGrabbedManipulators=i.has(n),n.hasHoveredManipulators=r.has(n);const s=this._grabbedManipulators.values(),o=YNe(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},n=!0,s){const o=(a,l)=>a===e&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(ju(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){const r=e.type;r!=="pointer-up"&&r!=="immediate-click"&&r!=="pointer-move"||!Nce(e.pointerType)||(r!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition(Bf(e),e.pointerId,e.pointerType,i))}_updateHoveredStateForPointerAtScreenPosition(e,i,r,n){var a;let s=bS(e,r,n);const o=(a=this._hoveredManipulators.get(i))==null?void 0:a.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(i,s)):this._hoveredManipulators.delete(i),this._onFocusChange(n))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach(({manipulator:i},r)=>{e===r&&(this._hoveredManipulators.delete(e),i.hovering=!1)})}};function Dce(t){for(const{manipulator:e}of t.values())if(e!=null&&e.interactive){if(e.grabbing&&e.grabCursor)return e.grabCursor;if(e.cursor)return e.cursor}return null}function bS(t,e,i){let r=null;return i(n=>{if(n.manipulators==null||!fW(n))return!1;const s=n.manipulators.intersect(t,e);return s!=null&&(r={tool:n,manipulator:s},!0)}),r}function Nce(t){return t==="mouse"}function Fce(t){return t.pointerType!=="mouse"||t.button===0}function MQe(t){return!!t.native.shiftKey}function bj(t,e){t!=null&&t.consumesClicks&&e()}const kce="attached",xj="tools",$Qe=1e3;let jf=class extends Ne{constructor(e){super(e),this._updatingHandles=new hv,this._clock=O3,this._manipulatorState=new CQe,this.tools=new ot,this.cursor=null,this._interacting=!1,this._interactingTimeout=$Qe,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(PEe,e=>{this._handleInputEvent(e)},pv.TOOL),...EQe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void de.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i!=null&&i.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const n=fW(r);this.activeTool!=null&&n||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Sr(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([oe(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i)))],kce):this.addHandles(oe(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(kce),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(n=>{!i&&n.visible&&n.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(xj),this._forEachTool(e=>{if(e instanceof Ne){const i=oe(()=>[e.cursor,e.visible,e.editable],()=>{fW(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,xj)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],xj)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,JR.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};u([f({constructOnly:!0,nonNullable:!0})],jf.prototype,"view",void 0),u([f({value:null})],jf.prototype,"activeTool",null),u([f({readOnly:!0,type:ot})],jf.prototype,"tools",void 0),u([f({readOnly:!0})],jf.prototype,"cursor",void 0),u([f({readOnly:!0})],jf.prototype,"updating",null),u([f()],jf.prototype,"_interacting",void 0),u([f({readOnly:!0})],jf.prototype,"interacting",null),jf=u([L("esri.views.ToolViewManager")],jf);let RT=class extends Ne{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":OQe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return AQe[this.deviceType]}};u([f({nonNullable:!0,readOnly:!0})],RT.prototype,"nativeIndex",void 0),u([f({type:String,readOnly:!0})],RT.prototype,"deviceType",null),u([f({type:Number,readOnly:!0})],RT.prototype,"axisThreshold",null),RT=u([L("esri.views.input.gamepad.GamepadInputDevice")],RT);const UK=RT,OQe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),AQe={standard:.15,spacemouse:.025,unknown:0};let GO=class extends Ne{constructor(...e){super(...e),this.devices=new ot,this.enabledFocusMode="document"}};u([f({type:ot.ofType(UK),readOnly:!0})],GO.prototype,"devices",void 0),u([f({type:["document","view","none"]})],GO.prototype,"enabledFocusMode",void 0),GO=u([L("esri.views.input.gamepad.GamepadSettings")],GO);const RQe=GO;let wF=class extends Ne{constructor(){super(...arguments),this.gamepad=new RQe}};u([f({readOnly:!0})],wF.prototype,"gamepad",void 0),wF=u([L("esri.views.input.Input")],wF);const IQe=wF,PQe=()=>Qr.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;let p_=class extends Ne{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([f({type:Boolean,nonNullable:!0})],p_.prototype,"enabled",void 0),u([f({type:UK})],p_.prototype,"device",void 0),u([f({type:["pan","zoom"],nonNullable:!0})],p_.prototype,"mode",void 0),u([f({type:["forward-down","forward-up"],nonNullable:!0})],p_.prototype,"tiltDirection",void 0),u([f({type:Number,nonNullable:!0})],p_.prototype,"velocityFactor",void 0),p_=u([L("esri.views.navigation.gamepad.GamepadSettings")],p_);const FEe=p_;let vw=class extends Ne{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new FEe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!PQe()}};u([f({type:Boolean})],vw.prototype,"browserTouchPanEnabled",void 0),u([f({type:FEe,nonNullable:!0})],vw.prototype,"gamepad",void 0),u([f({type:Boolean})],vw.prototype,"momentumEnabled",void 0),u([f({type:Boolean})],vw.prototype,"mouseWheelZoomEnabled",void 0),vw=u([L("esri.views.navigation.Navigation")],vw);const kEe=vw;let mW,Sj=null;async function LQe(t){Sj||(Sj=fe(()=>import("./geometryServiceUtils-CXxwqLu3.js"),[]).then(e=>mW=e)),await Sj,zt(t)}async function UEe(t,e,i,r){if(!t)return null;const n=t.spatialReference;return HC()||tf(n,e)?Hv(t,e):mW?mW.projectGeometry(t,e,i,r):(await Promise.race([LQe(r),WE(r)]),UEe(t,e,i,r))}let xn=class extends Ne{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=jc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,n,s,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,r=>{const n=this._getSupportedSpatialReferences(r);if(n.length>0){const s=this._narrowDownSpatialReferenceCandidates(e,n);s!=null&&(e=s)}return(e==null?void 0:e.length)===1})&&(e==null?void 0:e.length)!==1)return{updating:!0};const i=this._pickSpatialReferenceCandidate(e);return{spatialReference:(i==null?void 0:i.spatialReference)??null,viewingMode:(i==null?void 0:i.viewingMode)??null,updating:!1}}get _tileInfoTask(){var s,o;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=(s=this.map)==null?void 0:s.call(this),i=this.spatialReference;if(!i)return{updating:this._spatialReferenceTask.updating};let r;const n=this._collectLayers([{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.baseLayers},{layers:e==null?void 0:e.layers}],a=>{var l;return!(!("tileInfo"in a)||!((l=a.tileInfo)!=null&&l.spatialReference.equals(i)))&&(r=a,!0)},a=>"tileInfo"in a);return r?{tileInfo:r.tileInfo,updating:!1}:{updating:n}}get _heightModelInfoTask(){var r;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};let e={};const i=this._collectLayers(this.mapCollections,n=>{var o,a;const s=lxe(n);return!!s&&(e={heightModelInfo:s,vcsWkid:(o=n.spatialReference)==null?void 0:o.vcsWkid,latestVcsWkid:(a=n.spatialReference)==null?void 0:a.latestVcsWkid},!0)},n=>Ije(n));return{...e,updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],i=this._collectLayers(this.mapCollections,r=>{const n="fullExtents"in r&&r.fullExtents||(r.fullExtent!=null?[r.fullExtent]:[]),s=this.requiresExtentInSpatialReference?null:n[0],o=n.find(a=>a.spatialReference.equals(this.spatialReference))??s;if(o)return e.push({extent:o,layer:r}),!0;if(this._getSupportedSpatialReferences(r).length>0)for(const a of n)e.push({extent:a,layer:r});return!1});return{candidates:e,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),n=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=jc(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:n.clone(),task:Ny(async s=>{try{const o=await UEe(r.extent,n,"portalItem"in r.layer?r.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(zo(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const n of e)for(const s of i){if(!n.spatialReference.equals(s.spatialReference))continue;const o=NQe(n.viewingMode,s.viewingMode);if(o!==!1){r.push({spatialReference:n.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==ct.Local)&&(e=e.filter(({viewingMode:r})=>r!==ct.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const n of i){const s=this.getSpatialReferenceSupport(n,e);if(s!=null){const o=s.constraints??[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e,i,r=()=>!0){var s;if(this._loadMaybe((s=this.map)==null?void 0:s.call(this))!=="loaded")return!0;const n=new DQe(r,i);for(const o of e)if(this._collectCollection(o,n),n.done||n.preloading===this.sourcePreloadCount)break;return n.updating}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers)if(i.layerFilter(r)){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":if(i.updating||(i.done=i.pushLayer(r)),i.done||i.preloading===this.sourcePreloadCount)break;"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.done||i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{Bn(i)}),"loading"):e.loadStatus:"loaded"}};u([f()],xn.prototype,"required",void 0),u([f({constructOnly:!0})],xn.prototype,"map",void 0),u([f({constructOnly:!0})],xn.prototype,"getSpatialReferenceSupport",void 0),u([f()],xn.prototype,"defaultSpatialReference",void 0),u([f()],xn.prototype,"userSpatialReference",void 0),u([f()],xn.prototype,"sourcePreloadCount",void 0),u([f()],xn.prototype,"priorityCollection",void 0),u([f()],xn.prototype,"requiresExtentInSpatialReference",void 0),u([f()],xn.prototype,"suspended",void 0),u([f({readOnly:!0})],xn.prototype,"ready",null),u([f({readOnly:!0})],xn.prototype,"heightModelInfoReady",null),u([f({readOnly:!0})],xn.prototype,"spatialReference",null),u([f({readOnly:!0})],xn.prototype,"extent",null),u([f({readOnly:!0})],xn.prototype,"heightModelInfo",null),u([f({readOnly:!0})],xn.prototype,"vcsWkid",null),u([f({readOnly:!0})],xn.prototype,"latestVcsWkid",null),u([f({readOnly:!0})],xn.prototype,"viewingMode",null),u([f({readOnly:!0})],xn.prototype,"tileInfo",null),u([f({readOnly:!0})],xn.prototype,"mapCollections",null),u([f({readOnly:!0})],xn.prototype,"_spatialReferenceTask",null),u([f({readOnly:!0})],xn.prototype,"_tileInfoTask",null),u([f({readOnly:!0})],xn.prototype,"_heightModelInfoTask",null),u([f({readOnly:!0})],xn.prototype,"_extentCandidatesTask",null),u([f()],xn.prototype,"_extentTask",null),u([f()],xn.prototype,"_projectExtentTask",void 0),xn=u([L("esri.views.support.DefaultsFromMap")],xn);let DQe=class{constructor(e,i){this.layerFilter=e,this.pushLayer=i,this.preloading=-1,this.updating=!1,this.done=!1}};function NQe(t,e){return t!=null?e!=null?t===e&&t:t:e}var HO;let Nt=HO=class extends ns.EventedMixin(D3(Ne)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new Dy,this.updatingHandles=new hv,this.allLayerViews=new NR({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:kQe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new Ab,this.analyses=new iC,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ot,this.magnifier=new OEe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new IQe,this.navigation=new kEe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new hQe(this),this.persistableViewModels=new ot,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(oe(()=>this.preconditionsReady,e=>{var r,n;const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,HO.views.add(this)):(this._lockedSpatialReference=null,HO.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)(r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(n=this.layerViewManager)==null||n.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(s){return void queueMicrotask(()=>{this.fatalError=new Y("startup-error",null,s)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},xi))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,kE(()=>this.ready)))),this.basemapView=new qJe({view:this}),this.layerViewManager=new XJe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new jf({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new cQe({view:this}),this.addHandles([oe(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},hi),oe(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},xi),oe(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},hi)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([oe(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const n=Ui(()=>t=jc(t));t=Ny(async s=>{try{await mJ(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}de.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(n,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(HO.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Ye(this.graphics),this.analyses=Ye(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Ye(this.analysisViewManager),this.toolViewManager=Ye(this.toolViewManager),this.layerViewManager=Ye(this.layerViewManager),this.selectionManager=Ye(this.selectionManager),this.basemapView=Ye(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Ye(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return de.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new xn({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||wm.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(de.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),wm.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)){const r=t.clone();return r.vcsWkid=this.defaultsFromMap.vcsWkid,r.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,r}return t}set spatialReference(t){const e=!xs(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(t){this._userTimeExtent=t}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Sm}set timeZone(t){this._userTimeZone=t,N6e(t)||de.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new pW}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(t){throw new Y("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&de.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Kl(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Nt.views=new ot,u([f()],Nt.prototype,"_userSpatialReference",void 0),u([f()],Nt.prototype,"activeTool",null),u([f({readOnly:!0})],Nt.prototype,"allLayerViews",void 0),u([f()],Nt.prototype,"groundView",void 0),u([f()],Nt.prototype,"animation",null),u([f()],Nt.prototype,"basemapView",void 0),u([f()],Nt.prototype,"center",null),u([f()],Nt.prototype,"defaultsFromMapSettings",null),u([f()],Nt.prototype,"defaultsFromMap",null),u([f()],Nt.prototype,"fatalError",void 0),u([f({type:pr})],Nt.prototype,"extent",null),u([f(T5(Ab,"graphics"))],Nt.prototype,"graphics",void 0),u([f(T5(iC,"analyses"))],Nt.prototype,"analyses",void 0),u([f({readOnly:!0,type:Gv})],Nt.prototype,"heightModelInfo",null),u([f({readOnly:!0})],Nt.prototype,"interacting",null),u([f({readOnly:!0})],Nt.prototype,"navigating",null),u([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Nt.prototype,"preconditionsReady",null),u([f({readOnly:!0})],Nt.prototype,"typeSpecificPreconditionsReady",void 0),u([f({type:ot,readOnly:!0})],Nt.prototype,"layerViews",void 0),u([f()],Nt.prototype,"resolution",null),u([f({type:OEe})],Nt.prototype,"magnifier",void 0),u([f({value:null,type:Pbe})],Nt.prototype,"map",null),u([f()],Nt.prototype,"padding",void 0),u([f({readOnly:!0})],Nt.prototype,"ready",void 0),u([f({type:nt})],Nt.prototype,"spatialReference",null),u([f()],Nt.prototype,"spatialReferenceWarningDelay",void 0),u([f()],Nt.prototype,"stationary",null),u([f({readOnly:!0})],Nt.prototype,"supportsGround",void 0),u([f({type:ja})],Nt.prototype,"timeExtent",null),u([f({type:String,nonNullable:!0})],Nt.prototype,"timeZone",null),u([f()],Nt.prototype,"tools",null),u([f()],Nt.prototype,"toolViewManager",void 0),u([f({readOnly:!0})],Nt.prototype,"type",void 0),u([f({type:Number})],Nt.prototype,"scale",void 0),u([f({readOnly:!0})],Nt.prototype,"updating",void 0),u([f({readOnly:!0})],Nt.prototype,"initialExtentRequired",void 0),u([f({readOnly:!0})],Nt.prototype,"initialExtent",null),u([f()],Nt.prototype,"cursor",null),u([f({readOnly:!0})],Nt.prototype,"input",void 0),u([f({type:kEe,nonNullable:!0})],Nt.prototype,"navigation",void 0),u([f()],Nt.prototype,"layerViewManager",void 0),u([f()],Nt.prototype,"analysisViewManager",void 0),u([f()],Nt.prototype,"selectionManager",void 0),u([f()],Nt.prototype,"width",void 0),u([f()],Nt.prototype,"height",void 0),u([f({readOnly:!0})],Nt.prototype,"resizing",void 0),u([f({value:null,readOnly:!0})],Nt.prototype,"size",null),u([f({readOnly:!0})],Nt.prototype,"suspended",void 0),u([f({readOnly:!0})],Nt.prototype,"viewEvents",void 0),u([f({readOnly:!0})],Nt.prototype,"persistableViewModels",void 0),u([f()],Nt.prototype,"_isValid",void 0),u([f()],Nt.prototype,"_readyCycleForced",void 0),u([f()],Nt.prototype,"_lockedSpatialReference",void 0),u([f()],Nt.prototype,"_userTimeZone",void 0),u([f()],Nt.prototype,"_lockedTimeZone",void 0),u([f()],Nt.prototype,"_userTimeExtent",void 0),u([f()],Nt.prototype,"_lockedTimeExtent",void 0),u([f({type:pW})],Nt.prototype,"theme",void 0),u([f({readOnly:!0,type:pW})],Nt.prototype,"effectiveTheme",null),Nt=HO=u([L("esri.views.View")],Nt);const Tj=globalThis.$arcgis;Tj&&!Tj.views&&Object.defineProperty(Tj,"views",{configurable:!1,enumerable:!0,writable:!1,value:Nt.views});const FQe=Nt;function kQe(t){return t.layerViews}let f_=class extends Q4{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Ho(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new Y("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,i){i||(i=qu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};u([f({readOnly:!0})],f_.prototype,"done",null),u([f({readOnly:!0,type:String})],f_.prototype,"state",void 0),u([f()],f_.prototype,"target",void 0),f_=u([L("esri.views.ViewAnimation")],f_),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(f_||(f_={}));const uC=f_,x$=()=>fe(()=>import("./TileLayerView3D-ByDE9Nwf.js"),__vite__mapDeps([108,109,110,111,112,113,114,103,34,104,100,40,115,116,31,32,117,118,119])),Uce=()=>fe(()=>import("./ElevationLayerView3D-DIiKMxlH.js"),__vite__mapDeps([120,8,9,109,110,112])),zce={"base-dynamic":()=>fe(()=>import("./BaseDynamicLayerView3D-7S68WDyQ.js"),__vite__mapDeps([121,122,109,123,124,125,126,127,112,113])),"base-elevation":Uce,"base-tile":x$,"bing-maps":x$,"building-scene":()=>fe(()=>import("./BuildingSceneLayerView3D-z2oBXdvH.js"),__vite__mapDeps([128,103,34,104,100,40,129,130,42,131,132,86,78,119,33,133,134,135,136,137,85,101,138,139,140,141,142,143,144,69,47,49,50,145,146,147,148,149,150,151,38,39,28,29,9,84,152,118,153,154,155,30,31,32,35,23,36,17,18,19,20,37,156,157,109,112])),catalog:()=>fe(()=>import("./CatalogLayerView3D-C019XNs-.js"),__vite__mapDeps([158,109,112])),"catalog-dynamic-group":()=>fe(()=>import("./CatalogDynamicGroupLayerView3D-uYnODT6o.js"),__vite__mapDeps([159,109,112])),"catalog-footprint":()=>fe(()=>import("./CatalogFootprintLayerView3D-ChZrcSVZ.js"),__vite__mapDeps([160,161,162,156,157,123,124,163,98,164,165,105,166,151,38,39,28,29,119,167,152,115,30,31,32,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,26,27,109,55,53,54,9,168,112,113])),csv:()=>fe(()=>import("./CSVLayerView3D-CXQUejUg.js"),__vite__mapDeps([169,161,162,156,157,123,124,163,98,164,165,105,166,151,38,39,28,29,119,167,152,115,30,31,32,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,26,27,109,55,53,54,9,168,112,113])),dimension:()=>fe(()=>import("./DimensionLayerView3D-D3KpGcI3.js"),__vite__mapDeps([170,109,112])),elevation:Uce,feature:()=>fe(()=>import("./FeatureLayerView3D-C0DGkb6P.js"),__vite__mapDeps([171,161,162,156,157,123,124,163,98,164,165,105,166,151,38,39,28,29,119,167,152,115,30,31,32,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,26,27,109,55,53,54,9,168,112,113])),focusArea:()=>fe(()=>import("./FocusAreaLayerView3D-DNh7noTI.js"),__vite__mapDeps([172,69,109,173,37,166,144,47,112])),geojson:()=>fe(()=>import("./GeoJSONLayerView3D-DJ1cST_H.js"),__vite__mapDeps([174,161,162,156,157,123,124,163,98,164,165,105,166,151,38,39,28,29,119,167,152,115,30,31,32,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,26,27,109,55,53,54,9,168,112,113])),graphics:()=>fe(()=>import("./GraphicsLayerView3D-H_GgPc5m.js"),__vite__mapDeps([175,109,164,176,166,151,38,39,28,29,119,167,118,103,34,104,100,40,123,124,112])),group:()=>fe(()=>import("./GroupLayerView-j1VX5KjM.js"),__vite__mapDeps([177,112])),imagery:()=>fe(()=>import("./ImageryLayerView3D-l7Yu5xBC.js"),__vite__mapDeps([178,122,109,123,124,125,126,127,112,113,156,157,119])),"integrated-mesh":()=>fe(()=>import("./IntegratedMeshLayerView3D-rSfR1Xuq.js"),__vite__mapDeps([179,133,103,34,104,100,40,134,135,136,137,85,86,78,101,138,139,140,141,142,143,144,69,47,49,50,145,146,147,148,149,150,151,38,39,28,29,119,9,84,152,118,153,109,112])),"integrated-mesh-3dtiles":()=>fe(()=>import("./IntegratedMesh3DTilesLayerView3D-Cta-hCiF.js"),__vite__mapDeps([180,134,135,93,109,112])),"line-of-sight":()=>fe(()=>import("./LineOfSightLayerView3D-Bdc1zho0.js"),__vite__mapDeps([181,109,112])),"map-image":()=>fe(()=>import("./MapImageLayerView3D-MOh8vl5P.js"),__vite__mapDeps([182,122,109,123,124,125,126,127,112,113,183,115,117,156,157,114,103,34,104,100,40,116,31,32,118,119])),media:()=>fe(()=>import("./MediaLayerView3D-CpcAZ15Z.js").then(t=>t.M),__vite__mapDeps([184,185,186,32,109,66,187,188,157,189,190,125,126,127,112])),"ogc-feature":()=>fe(()=>import("./OGCFeatureLayerView3D-C4foLqcJ.js"),__vite__mapDeps([191,161,162,156,157,123,124,163,98,164,165,105,166,151,38,39,28,29,119,167,152,115,30,31,32,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,26,27,109,55,53,54,9,168,112,113])),"open-street-map":x$,"oriented-imagery":()=>fe(()=>import("./FeatureLayerView3D-C0DGkb6P.js"),__vite__mapDeps([171,161,162,156,157,123,124,163,98,164,165,105,166,151,38,39,28,29,119,167,152,115,30,31,32,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,26,27,109,55,53,54,9,168,112,113])),"point-cloud":()=>fe(()=>import("./PointCloudLayerView3D-BMj4klCC.js"),__vite__mapDeps([192,109,9,86,78,76,77,118,103,34,104,100,40,193,119,112])),viewshed:()=>fe(()=>import("./ViewshedLayerView3D-kCQJK5bd.js"),__vite__mapDeps([194,109,112])),voxel:()=>fe(()=>import("./VoxelLayerView3D-C-fwc2JO.js"),__vite__mapDeps([195,109,196,193,119,112])),route:()=>fe(()=>import("./RouteLayerView3D-D573MJnI.js"),__vite__mapDeps([197,198,109,176,166,151,38,39,28,29,119,167,118,103,34,104,100,40,123,124,168,112])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?fe(()=>import("./SceneLayerView3D-C8HkDPJ8.js"),__vite__mapDeps([199,101,33,34,115,133,103,104,100,40,134,135,136,137,85,86,78,138,139,140,141,142,143,144,69,47,49,50,145,146,147,148,149,150,151,38,39,28,29,119,9,84,152,118,153,109,200,155,30,31,32,35,23,36,17,18,19,20,37,156,157,112,154,193])):fe(()=>import("./SceneLayerGraphicsView3D-RZu0xcve.js"),__vite__mapDeps([201,136,135,137,85,86,78,101,138,139,140,141,142,143,144,69,47,49,50,145,146,147,9,109,165,105,166,151,38,39,28,29,119,167,152,115,30,31,32,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,200,155,156,157,112,193])),stream:()=>fe(()=>import("./StreamLayerView3D-Dg10qYB2.js"),__vite__mapDeps([202,73,74,55,31,32,53,54,168,162,156,157,123,124,163,98,164,165,105,166,151,38,39,28,29,119,167,152,115,30,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,26,27,109,112])),tile:x$,"imagery-tile":()=>fe(()=>import("./ImageryTileLayerView3D-Bmu2e-2N.js"),__vite__mapDeps([203,82,109,110,156,157,119,112,113,116])),"vector-tile":()=>fe(()=>import("./VectorTileLayerView3D-C1RacXeL.js"),__vite__mapDeps([204,71,54,70,63,91,109,110,112])),wcs:()=>fe(()=>import("./ImageryTileLayerView3D-Bmu2e-2N.js"),__vite__mapDeps([203,82,109,110,156,157,119,112,113,116])),"web-tile":x$,wfs:()=>fe(()=>import("./WFSLayerView3D-elY_5kOc.js"),__vite__mapDeps([205,161,162,156,157,123,124,163,98,164,165,105,166,151,38,39,28,29,119,167,152,115,30,31,32,33,34,35,23,36,17,18,19,20,37,118,103,104,100,40,26,27,109,55,53,54,9,168,112,113])),wms:()=>fe(()=>import("./WMSLayerView3D-DbyfgVo9.js"),__vite__mapDeps([206,122,109,123,124,125,126,127,112,113,207,156,157])),wmts:()=>fe(()=>import("./WMTSLayerView3D-uLtitmMB.js"),__vite__mapDeps([208,109,110,111,112,113])),parquet:null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function UQe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Y(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const Vce={hasLayerViewModule:t=>zce[t.type]!=null,importLayerView:t=>{const e=zce[t.type];if(e==null)throw UQe(t);return e(t)}},Bce="analyses-owner-handles";var M2,Jw;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(M2||(M2={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(Jw||(Jw={}));let ww=class extends Ne{constructor(e){super(e),this._allAnalysisViews=new ot,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=jce(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(ki("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(ki()),this._attachedToViewResolver=jce()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===Jw.REMOVED)throw new Y("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),Bce)}_disconnectOwners(){this.removeHandles(Bce),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const i=e.on("after-add",n=>this._addAnalysis(n.item)),r=e.on("after-remove",n=>this._removeAnalysis(n.item));return Ui(()=>{i.remove(),r.remove();for(const n of e)this._removeAnalysis(n)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:M2.PENDING,list:Jw.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=Ny(n=>this._createAnalysisViewPromise(r,n))}else i.state.list=Jw.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=Jw.REMOVED,this._scheduleUpdate()):de.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=AC(()=>this._update()))}_update(){this._scheduledUpdateHandle=Sr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Jw.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case M2.PENDING:e.createAnalysisViewTask=jc(e.createAnalysisViewTask);break;case M2.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Ye(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,n=r.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(zo(i))throw this._creatingViewCount-=1,ki("AnalysisView creation aborted");const o=new s.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(zo(i))throw this._creatingViewCount-=1,o.destroy(),ki("AnalysisView creation aborted");return e.view=o,e.state.view=M2.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return fe(()=>import("./AreaMeasurementAnalysisView3D-LYL3nTBi.js"),__vite__mapDeps([209,210,211,212,213,214,15,3,215,189,216,69,217,218,219,190,220,126,127,221]));case"dimension":return fe(()=>import("./DimensionAnalysisView3D-B8-oTfGU.js"),__vite__mapDeps([222,212,223,211,220,189,217,218,224,216,214,15,3,215,225,226,227,228,229,127,188,187,157,190,230,231,219,163,232,125,126,233,234,221,235,236,237]));case"direct-line-measurement":return fe(()=>import("./DirectLineMeasurementAnalysisView3D-piMUzX-0.js"),__vite__mapDeps([238,210,211,212,217,218,216,214,15,3,215,189,220,228,226,229,127,221]));case"line-of-sight":return fe(()=>import("./LineOfSightAnalysisView3D-C2PWmpBg.js"),__vite__mapDeps([239,212,240,217,218,241,149,150,231,229,127,219,190,242,227,235]));case"slice":return fe(()=>import("./SliceAnalysisView3D-BSUo5L2q.js"),__vite__mapDeps([243,212,244,245,231,229,127,219,190,125,126,149,150,217,218,130,42,131,132,86,78,119,234,232,235,236,221]));case"viewshed":return fe(()=>import("./ViewshedAnalysisView3D-RZKTX820.js"),__vite__mapDeps([246,240,212,217,218,247,231,229,127,219,190,232,248,225,226,227,221,245,235,187,236]))}}};function jce(){const t=Ho();return t.promise.catch(()=>{}),t}u([f()],ww.prototype,"updating",null),u([f({constructOnly:!0})],ww.prototype,"view",void 0),u([f()],ww.prototype,"_allAnalysisViews",void 0),u([f()],ww.prototype,"_creatingViewCount",void 0),ww=u([L("esri.views.3d.analysis.AnalysisViewManager3D")],ww);const zQe=ww;let xg=class extends Ne{constructor(e){super(e),this.collision=new qO,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===ct.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==ct.Local?this._set("altitude",e):de.getLogger(this).warn("Altitude constraint is ignored in local scenes")}get mode(){return this.state.viewingMode}clampAltitude(e){return this.altitude?Oe(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Oe(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===ct.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=Ej)=>(r.min=ca.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?HN([[4e3,ca.max],[1e4,Wt(88)],[6e6,Wt(88)]]):()=>ca.max;return(i,r=Ej)=>(r.min=ca.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?HN([[4e3,ca.max],[5e4,Wt(88)],[6e6,Wt(88)],[2e7,ca.min]]):HN([[3e5,ca.max],[3e6,Wt(88)],[6e6,Wt(88)],[2e7,ca.min]]);return(i,r=Ej)=>(r.min=ca.min,r.max=e(i),r)}};function VQe(t){return{min:-2e5,max:4*t.radius}}u([f()],xg.prototype,"altitude",null),u([f({readOnly:!0})],xg.prototype,"collision",void 0),u([f()],xg.prototype,"distance",void 0),u([f({readOnly:!0})],xg.prototype,"minimumPoiDistance",void 0),u([f()],xg.prototype,"tilt",void 0),u([f({constructOnly:!0})],xg.prototype,"state",void 0),xg=u([L("esri.views.3d.state.Constraints")],xg);const Gce=VQe(Ii),ca={min:Wt(.5),max:Wt(179.5)},Ej={min:0,max:0};let qO=class extends Ne{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([f({type:Boolean})],qO.prototype,"enabled",void 0),u([f({type:Number})],qO.prototype,"elevationMargin",void 0),qO=u([L("esri.views.3d.state.Constraints.CollisionConstraint")],qO);let $2=class extends Zb{constructor(){super(...arguments),this.min=Gce.min,this.max=Gce.max}};u([f({type:Number})],$2.prototype,"min",void 0),u([f({type:Number})],$2.prototype,"max",void 0),$2=u([L("esri.views.3d.constraints.AltitudeConstraint")],$2);let Bg=class extends Zb{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};u([f({type:Number,value:1e-8})],Bg.prototype,"near",null),u([$i("near")],Bg.prototype,"castNear",null),u([f({type:Number,value:1e-8})],Bg.prototype,"far",null),u([$i("far")],Bg.prototype,"castFar",null),u([f({type:["auto","manual"]})],Bg.prototype,"mode",void 0),Bg=u([L("esri.views.3d.constraints.ClipDistanceConstraint")],Bg);const gW={min:vo(ca.min),max:vo(ca.max)};let Qw=class extends Zb{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Oe(e,gW.min,gW.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([f({type:["auto","manual"]})],Qw.prototype,"mode",void 0),u([f({type:Number,value:gW.max})],Qw.prototype,"max",null),u([$i("max")],Qw.prototype,"castMax",null),Qw=u([L("esri.views.3d.constraints.TiltConstraint")],Qw);let Kw=class extends Zb{constructor(e){super(e),this.tilt=new Qw,this.altitude=new $2,this.clipDistance=new Bg}};u([f({type:Qw})],Kw.prototype,"tilt",void 0),u([f({type:$2})],Kw.prototype,"altitude",void 0),u([f({type:Bg})],Kw.prototype,"clipDistance",void 0),Kw=u([L("esri.views.3d.constraints.Constraints")],Kw);function Hce(t){return xs(t,w2)||LC(t)?{wkid:Fc.GCSMARS2000}:xs(t,b2)||DC(t)?{wkid:Fc.GCSMOON2000}:nt.WGS84}var Au,Ey;function BQe(t){return t!=null&&!t.running}(function(t){t[t.Idle=0]="Idle",t[t.Rendering=1]="Rendering",t[t.Ready=2]="Ready",t[t.Fading=3]="Fading"})(Au||(Au={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA",t[t.COUNT=2]="COUNT"}(Ey||(Ey={}));let jQe=class{};const Ar=jQe;function C(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}function Ge(t,e,i=""){return t?e:i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(C||(C={}));let GQe=class{constructor(e){this._bits=[...e]}equals(e){return ym(this._bits,e.bits)}get code(){return this._code??(this._code=String.fromCharCode(...this._bits)),this._code}get bits(){return this._bits}},Zu=class extends Ar{constructor(){var e;super(),this._parameterBits=((e=this._parameterBits)==null?void 0:e.map(()=>0))??[],this._parameterNames??(this._parameterNames=[])}get key(){return this._key??(this._key=new GQe(this._parameterBits)),this._key}decode(e=this.key){const i=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map(n=>`    ${n}: ${this[n]}`).join(`
`);return this._parameterBits=i,r}};function le(t={}){return(e,i)=>{var c,h;e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:((c=e._parameterNames)==null?void 0:c.slice())??[],configurable:!0,writable:!0}),e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:((h=e._parameterBits)==null?void 0:h.slice())??[0],configurable:!0,writable:!0}),e._parameterNames.push(i);const r=t.count||2,n=Math.ceil(Math.log2(r)),s=e._parameterBits;let o=0;for(;s[o]+n>16;)o++,o>=s.length&&s.push(0);const a=s[o],l=(1<<n)-1<<a;s[o]+=n,t.count?Object.defineProperty(e,i,{get(){return(this._parameterBits[o]&l)>>a},set(p){if(this[i]!==p){if(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~l|+p<<a&l,typeof p!="number")throw new Y(`Configuration value for ${i} must be a number, got ${typeof p}`);if(t.count==null)throw new Y(`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(e,i,{get(){return!!((this._parameterBits[o]&l)>>a)},set(p){if(this[i]!==p&&(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~l|+p<<a&l,typeof p!="boolean"))throw new Y(`Configuration value for ${i} must be boolean, got ${typeof p}`)}})}}var Wl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Wl||(Wl={}));let yW=class extends Zu{constructor(){super(...arguments),this.steps=Wl.SIXTEEN,this.writeTextureChannels=Ey.RG}};u([le({count:Wl.COUNT})],yW.prototype,"steps",void 0),u([le({count:Ey.COUNT})],yW.prototype,"writeTextureChannels",void 0);let S$=class{constructor(e,i,r,n,s,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const oa={sunny:new S$([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Wl.SIXTEEN),cloudy:new S$([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Wl.TWOHUNDRED,.6),rainy:new S$([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Wl.TWOHUNDRED,.4),snowy:new S$([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Wl.HUNDRED,.65),foggy:new S$([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Wl.SIXTEEN)};oa.default=oa.sunny;function Dc(){return new Float32Array(3)}function _W(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function $r(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function HQe(t,e){return new Float32Array(t,e,3)}function zEe(){return Dc()}function VEe(){return $r(1,1,1)}function BEe(){return $r(1,0,0)}function jEe(){return $r(0,1,0)}function GEe(){return $r(0,0,1)}const qQe=zEe(),WQe=VEe(),ZQe=BEe(),YQe=jEe(),XQe=GEe();Object.freeze(Object.defineProperty({__proto__:null,ONES:WQe,UNIT_X:ZQe,UNIT_Y:YQe,UNIT_Z:XQe,ZEROS:qQe,clone:_W,create:Dc,createView:HQe,fromValues:$r,ones:VEe,unitX:BEe,unitY:jEe,unitZ:GEe,zeros:zEe},Symbol.toStringTag,{value:"Module"}));const kh=pe("esri-mobile")?64:128,JQe=kh/128,pp=Math.ceil(Math.sqrt(kh)),hy=(kh+2)*pp,QQe=1e5,EL=128,KQe=hy/1560;var k;function eKe(t){return t===k.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.ROTATION="rotation",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.START_UP="startUp",t.END_UP="endUp",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(k||(k={}));function xa(t,e=!0){t.attributes.add(k.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.main.add(C`
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?C`uv = position * 0.5 + vec2(0.5);`:""}
  `)}var Fi;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Fi||(Fi={}));let Mn=class{constructor(e,i,r,n,s=null){if(this.name=e,this.type=i,this.arraySize=s,this.bind={[Fi.Pass]:null,[Fi.Draw]:null},n)switch(r){case Fi.Pass:this.bind[Fi.Pass]=n;break;case Fi.Draw:this.bind[Fi.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},rs=class extends Mn{constructor(e,i){super(e,"vec2",Fi.Pass,(r,n,s)=>r.setUniform2fv(e,i(n,s)))}},rt=class extends Mn{constructor(e,i){super(e,"float",Fi.Pass,(r,n,s)=>r.setUniform1f(e,i(n,s)))}},xd=class extends Mn{constructor(e,i){super(e,"mat3",Fi.Pass,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}};const tl=Ti();let tKe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function St(t,e="Assertion"){if(!t){const i=new Error(e).stack;throw new tKe(`${e} at ${i}`)}}function xS(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function HEe(t,e,i,r){let n,s=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],h=(r[2]-t[2])/e[2];return c>h&&(n=c,c=h,h=n),!(s>h||c>o)&&(h<o&&(o=h),!(o<0))}function CL(t,e,i,r,n,s=Yt()){const o=(r[n]-i[n])*(e[0]-t[0])-(r[0]-i[0])*(e[n]-t[n]),a=(r[0]-i[0])*(t[n]-i[n])-(r[n]-i[n])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function qce(t,e,i,r,n){tl[0]=t[0],tl[1]=t[1],tl[2]=t[2],tl[3]=1,zc(tl,tl,e),n.length>2&&(n[2]=-tl[2]),zc(tl,tl,i),St(tl[3]!==0),n[0]=tl[0]/tl[3],n[1]=tl[1]/tl[3],n[2]=tl[2]/tl[3],n[0]=(.5*n[0]+.5)*r[2]+r[0],n[1]=(.5*n[1]+.5)*r[3]+r[1]}function iKe(t,e){return Math.log(t)/Math.log(e)}function rKe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const nKe=()=>de.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let qEe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},or=class extends qEe{constructor(){super(...arguments),this.vertex=new Wce,this.fragment=new Wce,this.attributes=new lKe,this.varyings=new cKe,this.extensions=new vW,this.outputs=new bW}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=s.main.generateSource(),c=e==="vertex"?dKe:hKe,h=s.constants.generateSource(),p=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${c}

${h.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${n.join(`
`)}

${p.join(`
`)}

${a.join(`
`)}

${l.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[Fi.Pass];o&&i.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[Fi.Pass];o&&i.set(s.name,o)});const r=Array.from(i.values()),n=r.length;return(s,o)=>{for(let a=0;a<n;++a)r[a](e,s,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[Fi.Draw];o&&i.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[Fi.Draw];o&&i.set(s.name,o)});const r=Array.from(i.values()),n=r.length;return(s,o,a)=>{for(let l=0;l<n;++l)r[l](e,a,s,o)}}},sKe=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new Y(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else nKe().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},oKe=class{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(){if(this._bodies.length>0)return[`void main() {
 ${this._bodies.join(`
`)||""} 
}`];throw new Y("Shader does not contain main function body.")}},aKe=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},Wce=class extends qEe{constructor(){super(...arguments),this.uniforms=new sKe(this),this.main=new oKe(this),this.code=new aKe(this),this.constants=new uKe(this)}get builder(){return this}},lKe=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},cKe=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&St(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,n)=>i.push(e==="vertex"?`out ${r} ${n};`:`in ${r} ${n};`)),i}},vW=class wW{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?wW.ALLOWLIST_VERTEX:wW.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};vW.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],vW.ALLOWLIST_VERTEX=[];let bW=class xW{constructor(){this._entries=new Map}add(e,i,r=0){const n=this._entries.get(r);n?St(n.name===e&&n.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:xW.DEFAULT_NAME,type:xW.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,n)=>i.push(`layout(location = ${n}) out ${r.type} ${r.name};`)),i}};bW.DEFAULT_TYPE="vec4",bW.DEFAULT_NAME="fragColor";let uKe=class Rs{constructor(e){this._stage=e,this._entries=new Set}add(e,i,r){let n="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":n=Rs._numberToFloatStr(r);break;case"int":n=Rs._numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${Rs._numberToFloatStr(r[0])},                            ${Rs._numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${Rs._numberToFloatStr(r[0])},                            ${Rs._numberToFloatStr(r[1])},                            ${Rs._numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${Rs._numberToFloatStr(r[0])},                            ${Rs._numberToFloatStr(r[1])},                            ${Rs._numberToFloatStr(r[2])},                            ${Rs._numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${Rs._numberToIntStr(r[0])},                             ${Rs._numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${Rs._numberToIntStr(r[0])},                             ${Rs._numberToIntStr(r[1])},                             ${Rs._numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${Rs._numberToIntStr(r[0])},                             ${Rs._numberToIntStr(r[1])},                             ${Rs._numberToIntStr(r[2])},                             ${Rs._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${i}(${Array.prototype.map.call(r,s=>Rs._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${n};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const hKe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,dKe=`precision highp float;
precision highp sampler2D;`;let ht=class extends Mn{constructor(e,i){super(e,"sampler2D",Fi.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function $z(t){t.code.add(C`vec2 sphereIntersect(vec3 start, vec3 dir, float distance) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * distance;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`)}let zK=class extends Ar{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.viewMatrix=In()}};const uE=pe("esri-mobile")?1024:2048;function WEe(t){const e=new or;e.include(xa,!1);const i=e.fragment;return i.include($z),i.uniforms.add(new rt("cloudRadius",r=>r.cloudRadius),new rt("power",r=>Bt(35,120,r.absorption)),new rt("sigmaE",r=>1+r.absorption),new rt("density",r=>Bt(0,.3,r.density)),new rt("cloudSize",r=>Bt(0,.02,Math.max(.01,1-r.cloudSize))),new rt("detailSize",r=>Bt(0,.2,Math.max(.01,1-r.detailSize))),new rt("smoothness",r=>Bt(0,.5,1-r.smoothness)),new rt("cloudHeight",r=>Bt(0,1500,r.cloudHeight)),new rt("coverage",r=>r.coverage),new xd("view",r=>r.viewMatrix),new ht("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new rs("cloudVariables",r=>ln(pKe,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*uE),i.code.add(C`
    const int STEPS = ${t.steps===Wl.SIXTEEN?C`16`:t.steps===Wl.HUNDRED?C`100`:C`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(C`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${C.float(hy)};
      const float dataWidth = ${C.float(hy)};
      const float tileRows = ${C.float(pp)};
      const vec3 atlasDimensions = vec3(${C.float(kh)}, ${C.float(kh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${C.float(JQe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${C.float(KQe)} * p) / ${C.float(hy)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(C`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(C`float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}
float multipleOctaves(float extinction, float mu, float stepL) {
float attenuation = 1.0;
float contribution = 1.0;
float phaseAttenuation = 1.0;
float luminance = 0.0;
for (int i = 0; i < 4; i++) {
float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
attenuation *= 0.2;
contribution *= 0.6;
phaseAttenuation *= 0.5;
}
return luminance;
}`),i.code.add(C`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(C`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.main.add(C`if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
float cloudDistance = cloudRadius + cloudStart;
float rayStartDistance = dot(viewPos, viewPos) - (cloudDistance * cloudDistance);
vec2 rayStartIntersect = sphereIntersect(viewPos, rayDir, rayStartDistance);
float rayEndDistance = dot(viewPos, viewPos) - ((cloudDistance + cloudHeight) * (cloudDistance + cloudHeight));
vec2 rayEndIntersect = sphereIntersect(viewPos, rayDir, rayEndDistance);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);`),e}const pKe=Yt(),fKe=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:zK,build:WEe,cubeMapSize:uE},Symbol.toStringTag,{value:"Module"}));let ar=class{constructor(e,i){this._module=e,this._load=i}get(){return this._module}async reload(){return this._module=await this._load(),this._module}};const md=new Map([[k.POSITION,0],[k.NORMAL,1],[k.NORMALCOMPRESSED,1],[k.UV0,2],[k.COLOR,3],[k.COLORFEATUREATTRIBUTE,3],[k.SIZE,4],[k.TANGENT,4],[k.CENTEROFFSETANDDISTANCE,5],[k.SYMBOLCOLOR,5],[k.FEATUREATTRIBUTE,6],[k.INSTANCEFEATUREATTRIBUTE,6],[k.INSTANCECOLOR,7],[k.OBJECTANDLAYERIDCOLOR,7],[k.INSTANCEOBJECTANDLAYERIDCOLOR,7],[k.ROTATION,8],[k.INSTANCEMODEL,8],[k.INSTANCEMODELNORMAL,12],[k.INSTANCEMODELORIGINHI,11],[k.INSTANCEMODELORIGINLO,15]]),mKe=()=>de.getLogger("esri.views.webgl.checkWebGLError");function gKe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const W5=!!pe("enable-feature:webgl-debug");function yp(){return W5}function SW(){return W5}function Gh(t){if(yp()){const e=t.getError();if(e){const i=gKe(t,e),r=new Error().stack;mKe().error(new Y("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let Zce=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new mi({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=yp()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform2iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if((i==null?void 0:i.glName)==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){var e;this._context.useProgram(this),this._textures.forEach((i,r)=>{this._context.bindTexture(i.texture,i.unit),this.setUniform1i(r,i.unit)}),(e=this._fragmentUniforms)==null||e.forEach(i=>{i.type!=="sampler2D"&&i.type!=="samplerCube"||this._textures.has(i.name)||console.error(`Texture sampler ${i.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Xi,ur,ei,Cy,Ct,Lp,hC,Hi,gr,wn,Mi,Tr,vn,kt,gt,qa,ha,Vn,Ru,La;(function(t){t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t[t.COLOR=16384]="COLOR"})(Xi||(Xi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(ur||(ur={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(ei||(ei={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Cy||(Cy={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(Ct||(Ct={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Lp||(Lp={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(hC||(hC={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT"}(Hi||(Hi={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(gr||(gr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(wn||(wn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Mi||(Mi={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Tr||(Tr={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(vn||(vn={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(kt||(kt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(gt||(gt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(qa||(qa={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(ha||(ha={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Vn||(Vn={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Ru||(Ru={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(La||(La={}));const Cj=33984;var Kn,Sn,Fa;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(Kn||(Kn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Sn||(Sn={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(Fa||(Fa={}));const rx=33306;var Fn,Yce,Xce,Jce,Z5,TW,Qce;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Fn||(Fn={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Yce||(Yce={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Xce||(Xce={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(Jce||(Jce={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(Z5||(Z5={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(TW||(TW={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Qce||(Qce={}));var ic,dC,Gt,Nv,Hu,nx,Ks,ev;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(ic||(ic={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(dC||(dC={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Gt||(Gt={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Nv||(Nv={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Hu||(Hu={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee"}(nx||(nx={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Ks||(Ks={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(ev||(ev={}));function Lx(t,e,i=Cy.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function e1(t,e,i,r,n=Cy.ADD,s=Cy.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const yKe=Lx(ei.ZERO,ei.ONE_MINUS_SRC_ALPHA),VK=Lx(ei.ONE,ei.ZERO),_Ke=Lx(ei.ONE,ei.ONE),iM=Lx(ei.ONE,ei.ONE_MINUS_SRC_ALPHA),gd=e1(ei.SRC_ALPHA,ei.ONE,ei.ONE_MINUS_SRC_ALPHA,ei.ONE_MINUS_SRC_ALPHA),BK={face:Lp.BACK,mode:hC.CCW},vKe={face:Lp.FRONT,mode:hC.CCW},ZEe=t=>t===ic.Back?BK:t===ic.Front?vKe:null,tI={zNear:0,zFar:1},Qi={r:!0,g:!0,b:!0,a:!0};function wKe(t){return OKe.intern(t)}function bKe(t){return AKe.intern(t)}function xKe(t){return RKe.intern(t)}function SKe(t){return IKe.intern(t)}function TKe(t){return PKe.intern(t)}function EKe(t){return LKe.intern(t)}function CKe(t){return DKe.intern(t)}function MKe(t){return NKe.intern(t)}function $Ke(t){return FKe.intern(t)}function Pi(t){return kKe.intern(t)}let Dm=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function Nm(t){return"["+t.join(",")+"]"}const OKe=new Dm(YEe,t=>({__tag:"Blending",...t}));function YEe(t){return t?Nm([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const AKe=new Dm(XEe,t=>({__tag:"Culling",...t}));function XEe(t){return t?Nm([t.face,t.mode]):null}const RKe=new Dm(JEe,t=>({__tag:"PolygonOffset",...t}));function JEe(t){return t?Nm([t.factor,t.units]):null}const IKe=new Dm(QEe,t=>({__tag:"DepthTest",...t}));function QEe(t){return t?Nm([t.func]):null}const PKe=new Dm(KEe,t=>({__tag:"StencilTest",...t}));function KEe(t){return t?Nm([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const LKe=new Dm(eCe,t=>({__tag:"DepthWrite",...t}));function eCe(t){return t?Nm([t.zNear,t.zFar]):null}const DKe=new Dm(tCe,t=>({__tag:"ColorWrite",...t}));function tCe(t){return t?Nm([t.r,t.g,t.b,t.a]):null}const NKe=new Dm(iCe,t=>({__tag:"StencilWrite",...t}));function iCe(t){return t?Nm([t.mask]):null}const FKe=new Dm(rCe,t=>({__tag:"DrawBuffers",...t}));function rCe(t){return t?Nm(t.buffers):null}const kKe=new Dm(UKe,t=>({blending:wKe(t.blending),culling:bKe(t.culling),polygonOffset:xKe(t.polygonOffset),depthTest:SKe(t.depthTest),stencilTest:TKe(t.stencilTest),depthWrite:EKe(t.depthWrite),colorWrite:CKe(t.colorWrite),stencilWrite:MKe(t.stencilWrite),drawBuffers:$Ke(t.drawBuffers)}));function UKe(t){return t?Nm([YEe(t.blending),XEe(t.culling),JEe(t.polygonOffset),QEe(t.depthTest),KEe(t.stencilTest),eCe(t.depthWrite),tCe(t.colorWrite),iCe(t.stencilWrite),rCe(t.drawBuffers)]):null}let zKe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,n){return(r||e!==i)&&(n(e),this._pipelineInvalid=!0),e}},hr=class{constructor(e,i,r,n,s=md){this.release=n,this.locations=s,this.primitiveType=ur.TRIANGLES,this.key=i.key,this._program=new Zce(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i),this.reload=async o=>{if(o&&await r.reload(),!this.key.equals(i.key))throw new Error("Configuration was changed after construction, cannot reload shader");Ht(this._program),this._program=new Zce(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i)}}destroy(){this._program=Ht(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,i){return this._pipeline}initializePipeline(e){return Pi({blending:iM,colorWrite:Qi})}},Mj=class extends hr{constructor(e,i,r){super(e,i,new ar(fKe,()=>fe(()=>Promise.resolve().then(()=>XOt),void 0)),r)}initializePipeline(e){return Pi({blending:Lx(ei.CONSTANT_COLOR,ei.ONE_MINUS_CONSTANT_COLOR,Cy.ADD,e.writeTextureChannels===Ey.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:gr.LEQUAL},colorWrite:Qi})}};var Dp;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Dp||(Dp={}));let nCe=class extends Zu{constructor(){super(...arguments),this.mode=Dp.Full}};u([le({count:Dp.COUNT})],nCe.prototype,"mode",void 0);let jK=class extends Ar{constructor(){super(...arguments),this.weatherTile=ks(0,0)}};function sCe(t){const e=new or;return e.include(xa,!1),e.fragment.code.add(C`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Dp.Full&&(e.fragment.code.add(C`float saturate(float x) {
return clamp(x, 0.0, 1.0);
}`),e.fragment.code.add(C`vec3 modulo(vec3 m, float n) {
return mod(mod(m, n) + n, n);
}
vec3 hash(vec3 p3, float frequency) {
p3 = modulo(p3, frequency);
p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yxz + 33.33);
return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
}`),e.fragment.code.add(C`vec3 fade(vec3 t) {
return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
}`),e.fragment.code.add(C`
    float gradientNoise(vec3 p, float frequency) {
      vec3 i = floor(p);
      vec3 f = fract(p);
      vec3 u = fade(f);
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequency = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequency;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${C.float(pp)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${C.float(8)});

      float worley0 = worley(p, ${C.float(2)} * 2.0);
      float worley1 = worley(p, ${C.float(2)} * 8.0);
      float worley2 = worley(p, ${C.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${C.float(2)});
      float worley1 = worley(p, ${C.float(2)} * 2.0);
      float worley2 = worley(p, ${C.float(2)} * 4.0);
      float worley3 = worley(p, ${C.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)),e.fragment.uniforms.add(new rs("weatherTile",i=>i.weatherTile)).code.add(C`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${C.float(EL)});

      // Get global coordinates of p
      p += weatherTile * ${C.float(EL)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${C.float(QQe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.mode===Dp.Full?e.fragment.main.add(C`
      float padWidth = 1.0;
      float paddedSize = ${C.float(kh)} + 2.0 * padWidth;
      float tileCount = ${C.float(pp)} * ${C.float(pp)};
      vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

      bool padCell = false;
      if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      bool startPadX = false;
      bool startPadY = false;
      bool endPadX = false;
      bool endPadY = false;

      if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
        startPadX = true;
      }

      if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
        startPadY = true;
      }

      if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
        endPadX = true;
      }

      if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
        endPadY = true;
      }

      vec2 padding = vec2(2.0 * padWidth) * tile;
      vec2 uv;

      if (padCell) {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;

        if (startPadX) {
          pixel.x += ${C.float(kh)};
        }

        if (startPadY) {
          pixel.y += ${C.float(kh)};
        }

        if (endPadX) {
          pixel.x -= ${C.float(kh)};
        }

        if (endPadY) {
          pixel.y -= ${C.float(kh)};
        }

        uv = vec2(pixel.xy / ${C.float(kh)});
      } else {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;
        uv = vec2(pixel.xy / ${C.float(kh)});
      }

      vec3 p_ = get3Dfrom2D(uv);
      vec3 p = p_;
      p.z /= (${C.float(pp)} * ${C.float(pp)});

      float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      float worleyNoise = getTextureForPointWorley(p);

      fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      p_ = mod(p_ + 1.0, ${C.float(pp)} * ${C.float(pp)});
      p = p_;
      p.z /= (${C.float(pp)} * ${C.float(pp)});

      worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      worleyNoise = getTextureForPointWorley(p);

      fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      vec2 mapUV = ${C.float(EL)} * (gl_FragCoord.xy / ${C.float(hy)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor.ba = vec2(0.0, map);
      `):e.fragment.main.add(C`
      vec2 mapUV = ${C.float(EL)} * (gl_FragCoord.xy / ${C.float(hy)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor = vec4(map);
    `),e}const VKe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:jK,build:sCe},Symbol.toStringTag,{value:"Module"}));let $j=class extends hr{constructor(e,i,r){super(e,i,new ar(VKe,()=>fe(()=>Promise.resolve().then(()=>JOt),void 0)),r)}initializePipeline(e){return Pi({blending:e.mode===Dp.Full?VK:e1(ei.ZERO,ei.ONE,ei.ONE,ei.ZERO),depthTest:{func:gr.ALWAYS},colorWrite:Qi})}};const Kce=()=>de.getLogger("esri.views.webgl.BufferObject");let bs=class bw{static createIndex(e,i,r){return new bw(e,Ct.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new bw(e,Ct.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){return new bw(e,Ct.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=Vn.STREAM_READ,r){const n=new bw(e,Ct.PIXEL_PACK_BUFFER,i);return r&&n.setSize(r),n}static createPixelUnpack(e,i=Vn.STREAM_DRAW,r){return new bw(e,Ct.PIXEL_UNPACK_BUFFER,i,r)}static createTransformFeedback(e,i=Vn.STATIC_DRAW,r){const n=new bw(e,Ct.TRANSFORM_FEEDBACK_BUFFER,i);return n.setSize(r),n}constructor(e,i,r,n){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Kn.BufferObject,this),this._glName=this._context.gl.createBuffer(),Gh(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===Ct.ELEMENT_ARRAY_BUFFER){if(this._indexType===Hi.UNSIGNED_INT)return 4*this._size;if(this._indexType===Hi.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===Ct.ELEMENT_ARRAY_BUFFER||this.bufferType===Ct.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Kn.BufferObject,this),this._context=null):this._glName&&Kce().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===Ct.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case Hi.UNSIGNED_SHORT:e*=2;break;case Hi.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Ct.ELEMENT_ARRAY_BUFFER&&(q_(e)?this._indexType=Hi.UNSIGNED_BYTE:tU(e)?(i/=2,this._indexType=Hi.UNSIGNED_SHORT):hJ(e)&&(i/=4,this._indexType=Hi.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;i!=null?n.bufferData(this.bufferType,i,this.usage):n.bufferData(this.bufferType,e,this.usage),Gh(n),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,n){if(!e)return;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,n-r),Gh(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,i=0,r,n){if(r<0||n<0)return;const s=BKe(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return;i+s*(n??0)>this.usedMemory&&Kce().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===Ct.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,Ct.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(Ct.TRANSFORM_FEEDBACK_BUFFER,i,e,r,n),this._context.unbindBuffer(Ct.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,Ct.COPY_READ_BUFFER),o.getBufferSubData(Ct.COPY_READ_BUFFER,i,e,r,n),this._context.unbindBuffer(Ct.COPY_READ_BUFFER))}async getSubDataAsync(e,i=0,r,n){await this._context.clientWaitAsync(),this.getSubData(e,i,r,n)}};function BKe(t){return RNe(t)}var My;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(My||(My={}));function jKe(t){switch(t){case Hi.BYTE:case Hi.UNSIGNED_BYTE:return 1;case Hi.SHORT:case Hi.UNSIGNED_SHORT:case Hi.HALF_FLOAT:return 2;case Hi.FLOAT:case Hi.INT:case Hi.UNSIGNED_INT:return 4}}function oCe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function pC(t,e){var i;return(((i=t.vertexBuffers.get(e))==null?void 0:i.usedMemory)??0)/GKe(t.layout.get(e))}function GKe(t){return t[0].stride}function GK(t,e,i,r,n=0){var o;const s=t.gl;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);if(l==null){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&t.gl.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)s.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),s.enableVertexAttribArray(l+h),a.divisor>0&&t.gl.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)s.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),s.enableVertexAttribArray(l+h),a.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(l+h,a.divisor));else console.error("Unsupported vertex attribute element count: "+a.count);if(yp()){const h=oCe(t),p=jKe(a.type),g=a.offset,y=Math.round(p/g)!==p/g?`. Offset not a multiple of stride. DataType requires ${p} bytes, but descriptor has an offset of ${g}`:"";h&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}${y}:`,h,a)}}}function aCe(t,e,i,r){var s,o,a;const n=t.gl;t.bindBuffer(i);for(const l of r){const c=e.get(l.name);if(l.count<=4)n.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((s=t.gl)==null||s.vertexAttribDivisor(c,0));else if(l.count===9)for(let h=0;h<3;h++)n.disableVertexAttribArray(c+h),l.divisor&&l.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(c+h,0));else if(l.count===16)for(let h=0;h<4;h++)n.disableVertexAttribArray(c+h),l.divisor&&l.divisor>0&&((a=t.gl)==null||a.vertexAttribDivisor(c+h,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(Ct.ARRAY_BUFFER)}function HK(t){switch(t){case kt.ALPHA:case kt.LUMINANCE:case kt.RED:case kt.RED_INTEGER:case gt.R8:case gt.R8I:case gt.R8UI:case gt.R8_SNORM:case ha.STENCIL_INDEX8:return 1;case kt.LUMINANCE_ALPHA:case kt.RG:case kt.RG_INTEGER:case gt.RGBA4:case gt.R16F:case gt.R16I:case gt.R16UI:case gt.RG8:case gt.RG8I:case gt.RG8UI:case gt.RG8_SNORM:case gt.RGB565:case gt.RGB5_A1:case ha.DEPTH_COMPONENT16:return 2;case kt.DEPTH_COMPONENT:case kt.RGB:case kt.RGB_INTEGER:case gt.RGB8:case gt.RGB8I:case gt.RGB8UI:case gt.RGB8_SNORM:case gt.SRGB8:case ha.DEPTH_COMPONENT24:return 3;case kt.DEPTH_STENCIL:case kt.DEPTH24_STENCIL8:case kt.RGBA:case kt.RGBA_INTEGER:case gt.RGBA8:case gt.R32F:case gt.R11F_G11F_B10F:case gt.RG16F:case gt.R32I:case gt.R32UI:case gt.RG16I:case gt.RG16UI:case gt.RGBA8I:case gt.RGBA8UI:case gt.RGBA8_SNORM:case gt.SRGB8_ALPHA8:case gt.RGB9_E5:case gt.RGB10_A2UI:case gt.RGB10_A2:case ha.DEPTH_STENCIL:case ha.DEPTH_COMPONENT32F:case ha.DEPTH24_STENCIL8:return 4;case ha.DEPTH32F_STENCIL8:return 5;case gt.RGB16F:case gt.RGB16I:case gt.RGB16UI:return 6;case gt.RG32F:case gt.RG32I:case gt.RG32UI:case gt.RGBA16F:case gt.RGBA16I:case gt.RGBA16UI:return 8;case gt.RGB32F:case gt.RGB32I:case gt.RGB32UI:return 12;case gt.RGBA32F:case gt.RGBA32I:case gt.RGBA32UI:return 16;case Fn.COMPRESSED_RGB_S3TC_DXT1_EXT:case Fn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Fn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Fn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Fn.COMPRESSED_R11_EAC:case Fn.COMPRESSED_SIGNED_R11_EAC:case Fn.COMPRESSED_RGB8_ETC2:case Fn.COMPRESSED_SRGB8_ETC2:case Fn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Fn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Fn.COMPRESSED_RG11_EAC:case Fn.COMPRESSED_SIGNED_RG11_EAC:case Fn.COMPRESSED_RGBA8_ETC2_EAC:case Fn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let lCe=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function HKe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*HK(t.internalFormat)}let cCe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=My.RenderBuffer,this._context.instanceCounter.increment(Kn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=i;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,n,s):r.renderbufferStorage(r.RENDERBUFFER,o,n,s),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return HKe(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const n=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):n.renderbufferStorage(n.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Kn.Renderbuffer,this),this._context=null)}},jr=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=vn.TEXTURE_2D,this.pixelFormat=kt.RGBA,this.dataType=qa.UNSIGNED_BYTE,this.samplingMode=Mi.LINEAR,this.wrapMode=Tr.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function qKe(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:HK(t.internalFormat))*(t.target===vn.TEXTURE_CUBE_MAP?6:1))}let WKe=class uCe extends jr{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case gt.R16F:case gt.R16I:case gt.R16UI:case gt.R32F:case gt.R32I:case gt.R32UI:case gt.R8_SNORM:case gt.R8:case gt.R8I:case gt.R8UI:this.pixelFormat=kt.RED}}static validate(e,i){return new uCe(e,i)}},fr=class bh{constructor(e,i=null,r=null){if(this.type=My.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const n=WKe.validate(e,i);if(!n)throw new Y("Texture descriptor invalid");this._descriptor=n}this._descriptor.target===vn.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return qKe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(Kn.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new Y("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===vn.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=vn.TEXTURE_CUBE_MAP_POSITIVE_X;i<=vn.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){var c;const r=(c=this._descriptor.context)==null?void 0:c.gl;if(!r)return;Gh(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(Kn.Texture,this));const n=this._descriptor,s=i??n.target,o=T$(s),a=this._descriptor.context.bindTexture(this,bh.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(bh.TEXTURE_UNIT_FOR_UPDATES),ML(n),this._configurePixelStorage(),Gh(r);const l=this._deriveInternalFormat();if(iue(e)){let h="width"in e?e.width:e.codedWidth,p="height"in e?e.height:e.codedHeight;const g=1;e instanceof HTMLVideoElement&&(h=e.videoWidth,p=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,h,p,g),this._texImage(s,0,l,h,p,g,e),Gh(r),n.hasMipmap&&(this.generateMipmap(),Gh(r)),n.width||(n.width=h),n.height||(n.height=p),o&&!n.depth&&(n.depth=g)}else{const{width:h,height:p,depth:g}=n;if(h==null||p==null)throw new Y("Width and height must be specified!");if(o&&g==null)throw new Y("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,h,p,g),bF(e)){const y=e.levels,w=rue(s,h,p,g),b=Math.min(w-1,y.length-1);r.texParameteri(n.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,b);const x=l;if(!XKe(x))throw new Y("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((T,M,$,R)=>{const I=y[Math.min(T,y.length-1)];this._compressedTexImage(s,T,x,M,$,R,I)},b)}else this._texImage(s,0,l,h,p,g,e),Gh(r),n.hasMipmap&&this.generateMipmap()}eue(r,this._descriptor),tue(r,this._descriptor),ZKe(this._descriptor.context,this._descriptor),Gh(r),this._descriptor.context.bindTexture(a,bh.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:h,pixelFormat:p,dataType:g,target:y,isImmutable:w}=l;if(w&&!this._wasImmutablyAllocated)throw new Y("Cannot update immutable texture before allocation!");const b=h.bindTexture(this,bh.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+n>l.width||r+s>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:x}=h;a&&x.pixelStorei(x.UNPACK_SKIP_ROWS,a),iue(o)?x.texSubImage2D(y,e,i,r,n,s,p,g,o):bF(o)?x.compressedTexSubImage2D(y,e,i,r,n,s,c,o.levels[e]):x.texSubImage2D(y,e,i,r,n,s,p,g,o),a&&x.pixelStorei(x.UNPACK_SKIP_ROWS,0),h.bindTexture(b,bh.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,h=this._deriveInternalFormat(),{context:p,pixelFormat:g,dataType:y,isImmutable:w,target:b}=c;if(w&&!this._wasImmutablyAllocated)throw new Y("Cannot update immutable texture before allocation!");T$(b)||console.warn("Attempting to set 3D texture data on a non-3D texture");const x=p.bindTexture(this,bh.TEXTURE_UNIT_FOR_UPDATES);p.setActiveTexture(bh.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||n<0||i+s>c.width||r+o>c.height||n+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:T}=p;if(bF(l))l=l.levels[e],T.compressedTexSubImage3D(b,e,i,r,n,s,o,a,h,l);else{const M=l;T.texSubImage3D(b,e,i,r,n,s,o,a,g,y,M)}p.bindTexture(x,bh.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Y("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,ML(e)}e.samplingMode===Mi.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Mi.LINEAR_MIPMAP_NEAREST):e.samplingMode===Mi.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Mi.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,bh.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(bh.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,bh.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new Y("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,ML(e)}e.samplingMode===Mi.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=Mi.LINEAR):e.samplingMode===Mi.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Mi.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,ML(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,i=e.context.gl;this._samplingModeDirty&&(eue(i,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(tue(i,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===kt.DEPTH_STENCIL&&(this._descriptor.internalFormat=kt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case qa.FLOAT:switch(this._descriptor.pixelFormat){case kt.RGBA:return this._descriptor.internalFormat=gt.RGBA32F;case kt.RGB:return this._descriptor.internalFormat=gt.RGB32F;default:throw new Y("Unable to derive format")}case qa.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case kt.RGBA:return this._descriptor.internalFormat=gt.RGBA8;case kt.RGB:return this._descriptor.internalFormat=gt.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===kt.DEPTH_STENCIL?kt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,i,r,n,s,o){const{gl:a}=this._descriptor.context;if(!YKe(i))throw new Y("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?rue(e,n,s,o):1;if(T$(e)){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,n,s,o)}else a.texStorage2D(e,l,i,n,s);this._wasImmutablyAllocated=!0}_texImage(e,i,r,n,s,o,a){const l=this._descriptor.context.gl,c=T$(e),{isImmutable:h,pixelFormat:p,dataType:g}=this._descriptor;if(h){if(a!=null){const y=a;if(c){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,n,s,o,p,g,y)}else l.texSubImage2D(e,i,0,0,n,s,p,g,y)}}else{const y=a;if(c){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,n,s,o,0,p,g,y)}else l.texImage2D(e,i,r,n,s,0,p,g,y)}}_compressedTexImage(e,i,r,n,s,o,a){const l=this._descriptor.context.gl,c=T$(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,n,s,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,n,s,r,a)}else if(c){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,n,s,o,0,a)}else l.compressedTexImage2D(e,i,r,n,s,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===vn.TEXTURE_3D;if(r==null||n==null||l&&s==null)throw new Y("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,n,s),o&&(r!==1||n!==1||l&&s!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}};function ML(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function eue(t,e){let i=e.samplingMode,r=e.samplingMode;i===Mi.LINEAR_MIPMAP_NEAREST||i===Mi.LINEAR_MIPMAP_LINEAR?(i=Mi.LINEAR,e.hasMipmap||(r=Mi.LINEAR)):i!==Mi.NEAREST_MIPMAP_NEAREST&&i!==Mi.NEAREST_MIPMAP_LINEAR||(i=Mi.NEAREST,e.hasMipmap||(r=Mi.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function tue(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function ZKe(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function YKe(t){return t in gt}function XKe(t){return t in Fn}function bF(t){return t!=null&&"type"in t&&t.type==="compressed"}function JKe(t){return t!=null&&"byteLength"in t}function iue(t){return t!=null&&!bF(t)&&!JKe(t)}function T$(t){return t===vn.TEXTURE_3D||t===vn.TEXTURE_2D_ARRAY}function rue(t,e,i,r=1){let n=Math.max(e,i);return t===vn.TEXTURE_3D&&(n=Math.max(n,r)),Math.round(Math.log(n)/Math.LN2)+1}fr.TEXTURE_UNIT_FOR_UPDATES=0;const QKe=()=>de.getLogger("esri.views.webgl.FramebufferObject");let Fm=class WO{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Kn.FramebufferObject,this);const n=xF(i)?i:new fr(this._context,i);if(this._colorAttachments.set(Sn.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(Sn.COLOR_ATTACHMENT0),r!=null)if(eet(r))this._depthStencilTexture=xF(r)?r:new fr(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=KKe(r)?r:new cCe(this._context,r);this._depthStencilBuffer=s,this._validateRenderBufferDescriptor(s.descriptor)}}dispose(){var i,r;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((n,s)=>{var o;return(o=this.detachColorTexture(s))==null?void 0:o.dispose()}),(i=this.detachDepthStencilBuffer())==null||i.dispose(),(r=this.detachDepthStencilTexture())==null||r.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Kn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Sn.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var i;const e=this._colorAttachments.get(Sn.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.width)??0}get height(){var i;const e=this._colorAttachments.get(Sn.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.height)??0}get usedMemory(){var e;return[...this._colorAttachments].reduce((i,[r,n])=>i+n.usedMemory,((e=this.depthStencil)==null?void 0:e.usedMemory)??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&xF(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=Sn.COLOR_ATTACHMENT0){var n;if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),(n=this.detachColorTexture(i))==null||n.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=Sn.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i){if(this._initialized){const r=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(r)}return this._colorAttachments.delete(e),i}}setColorTextureTarget(e,i=Sn.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case My.Texture:return this._attachDepthStencilTexture(e);case My.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var r;if(e==null)return;const i=e.descriptor;i.pixelFormat!==kt.DEPTH_STENCIL&&i.pixelFormat!==kt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==qa.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,rx)),(r=this._depthStencilTexture)==null||r.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,rx),this._context.bindFramebuffer(i)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,n=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(La.FRAMEBUFFER,n,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,n=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(La.FRAMEBUFFER,n,r.RENDERBUFFER,null),this._context.bindFramebuffer(i)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,n,s,o,a){(e<0||i<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==vn.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+r>this.width||i+n>this.height||s+r>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,fr.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(fr.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(vn.TEXTURE_2D,0,s,o,e,i,r,n),c.bindTexture(h,fr.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,n,s,o,a){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,n,s,o,a)}async readPixelsAsync(e,i,r,n,s,o,a){const{gl:l}=this._context,c=bs.createPixelPack(this._context,Vn.STREAM_READ,a.byteLength);this._context.bindBuffer(c);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),l.readPixels(e,i,r,n,s,o,0),this._context.unbindBuffer(Ct.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(h),await c.getSubDataAsync(a),c.dispose()}resize(e,i){var n,s;if(this.width===e&&this.height===i)return;const r={width:e,height:i};hb(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(r.width,r.height)),(n=this._depthStencilTexture)==null||n.resize(r.width,r.height),this._initialized&&(hb(r,this._context.parameters.maxRenderbufferSize),(s=this._depthStencilBuffer)==null||s.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=La.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((n,s)=>this._framebufferTexture2D(n.glName,s,nue(n),e)),this._depthStencilBuffer){const n=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,n,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,nue(this._depthStencilTexture),e);yp()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=Sn.COLOR_ATTACHMENT0,r=vn.TEXTURE_2D,n=La.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,i,r,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(La.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=Ht(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Ht(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==vn.TEXTURE_2D&&e.target!==vn.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),hb(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){hb(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case ha.DEPTH_COMPONENT16:case ha.DEPTH_COMPONENT24:case ha.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case ha.DEPTH24_STENCIL8:case ha.DEPTH32F_STENCIL8:case ha.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case ha.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(WO._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;WO._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-Sn.COLOR_ATTACHMENT0;i+1>WO._MAX_COLOR_ATTACHMENTS&&de.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${WO._MAX_COLOR_ATTACHMENTS} color attachments`)}};function xF(t){return t!=null&&"type"in t&&t.type===My.Texture}function KKe(t){return t!=null&&"type"in t&&t.type===My.RenderBuffer}function eet(t){return xF(t)||t!=null&&"pixelFormat"in t}function hb(t,e){const i=Math.max(t.width,t.height);if(i>e){QKe().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function nue(t){return t.descriptor.target===vn.TEXTURE_CUBE_MAP?vn.TEXTURE_CUBE_MAP_POSITIVE_X:vn.TEXTURE_2D}Fm._MAX_COLOR_ATTACHMENTS=-1;let SF=class extends Ne{constructor(e){super(e),this._needsRender=!0,this._passParameters=new jK,this._configuration=new nCe,this._fbo=new Fm(e.context.renderContext.rctx,new jr(hy)),this._configuration.mode=Dp.Full,e.context.techniques.precompile($j,this._configuration),this._configuration.mode=Dp.WeatherMap,e.context.techniques.precompile($j,this._configuration)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?Dp.WeatherMap:Dp.Full;const e=this.context.techniques.acquire($j,this._configuration);return e.compiled&&(this._texture=this._render(e)),e.release(),this._texture}updateWeatherMap(e){fz(this._passParameters.weatherTile,e)||(Ha(this._passParameters.weatherTile,e),this._needsRender=!0)}destroy(){this._weatherMapTechniqueCached=Lr(this._weatherMapTechniqueCached),this._fbo=Ht(this._fbo)}_render(e){if(!this._fbo)return null;const i=this.context.renderContext.rctx,r=i.getViewport();return i.setViewport(0,0,hy,hy),i.bindFramebuffer(this._fbo),i.bindTechnique(e,this.context.renderContext.bind,this._passParameters),i.screen.draw(),i.setViewport(r.x,r.y,r.width,r.height),this._needsRender=!1,this._fbo.colorTexture}};u([f({constructOnly:!0})],SF.prototype,"context",void 0),SF=u([L("esri.views.3d.environment.NoiseTextureAtlas")],SF);let Ll=class extends Ne{constructor(e){super(e),this._state=Xl(Au.Idle),this._passParameters=new zK,this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this._tilesPerFace=1,this.coverage=Bt(oa.default.coverage[0],oa.default.coverage[1],.5),this.density=Bt(oa.default.density[0],oa.default.density[1],.5),this.absorption=Bt(oa.default.absorption[0],oa.default.absorption[1],.5),this.cloudSize=Bt(oa.default.cloudSize[0],oa.default.cloudSize[1],.5),this.detailSize=Bt(oa.default.detailSize[0],oa.default.detailSize[1],.5),this.smoothness=Bt(oa.default.smoothness[0],oa.default.smoothness[1],.5),this.cloudHeight=Bt(oa.default.cloudHeight[0],oa.default.cloudHeight[1],.5),this.raymarchingSteps=oa.default.raymarchingSteps,this._viewMatrix=ut(),this._dirty=!0,this.running=!0,this._configuration=new yW}initialize(){const e=xr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius;const i=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(xt.CLOUDS_GENERATOR,this),oe(()=>this.coverage,i,Si),oe(()=>this.density,i,Si),oe(()=>this.absorption,i,Si),oe(()=>this.cloudSize,i,Si),oe(()=>this.detailSize,i,Si),oe(()=>this.smoothness,i,Si),oe(()=>this.cloudHeight,i,Si),oe(()=>this.raymarchingSteps,i,Si)]);const r=C5(this._computeWeatherTile());let n=0;this.addHandles(oe(()=>{const s=this._computeWeatherTile();return fz(r,s)||(++n,Ha(r,s)),n},i))}destroy(){this.destroyCubeMap(),this._passParameters.noiseTexture=Ye(this._passParameters.noiseTexture)}_precompileTechniques(){this._configuration.steps=this.raymarchingSteps,this._configuration.writeTextureChannels=Ey.RG,this.context.techniques.precompile(Mj,this._configuration),this._configuration.writeTextureChannels=Ey.BA,this.context.techniques.precompile(Mj,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case Wl.SIXTEEN:this._tilesPerFace=1;break;case Wl.HUNDRED:this._tilesPerFace=4;break;case Wl.COUNT:case Wl.TWOHUNDRED:this._tilesPerFace=8;break;default:this.raymarchingSteps}return this._configuration.writeTextureChannels=1-this.parameters.readChannels,this._configuration.steps=this.raymarchingSteps,this.context.techniques.acquire(Mj,this._configuration)}_computeWeatherTile(){var l,c;const{camera:e,environment:i}=this.view,{latitude:r,longitude:n}=e.position;if(r==null||n==null)return Jb;ln(Ud,(r+90)/180,(n+180)/360);const s=Math.floor(this._weatherTileCount*Math.abs(2*Ud[0]-1));Ud[0]=Math.floor(2*this._weatherTileCount*Ud[0]),Ud[1]=Math.floor(4*(this._weatherTileCount-s)*Ud[1]);let o=0,a=0;if(((l=i==null?void 0:i.lighting)==null?void 0:l.type)!=="virtual"&&((c=i==null?void 0:i.lighting)==null?void 0:c.date)!=null){const h=new Date(i.lighting.date);h.setUTCHours(i.lighting.date.getUTCHours()+(i.lighting.displayUTCOffset??0)),o=31*h.getUTCMonth()+h.getUTCDate(),a=h.getUTCFullYear()}return Ud[0]=(Ud[0]+o)%(2*this._weatherTileCount),Ud[1]=(Ud[1]+a%100)%(4*this._weatherTileCount),Ud}get state(){return this._state.value}set state(e){this._state.value=e}get usedMemory(){var e,i,r;return(((e=this._fbo)==null?void 0:e.usedMemory)??0)+(((r=(i=this._passParameters.noiseTexture)==null?void 0:i.textureAtlas)==null?void 0:r.usedMemory)??0)}_ensureNoiseTexture(){var e;return(e=this._passParameters).noiseTexture??(e.noiseTexture=new SF({context:this.context})),this._passParameters.noiseTexture}_ensureFrameBufferCube(e){const i=this.context.renderContext.rctx;if(this._fbo==null){const r=new jr(e);r.target=vn.TEXTURE_CUBE_MAP,r.wrapMode=Tr.CLAMP_TO_EDGE,this._fbo=new Fm(i,r),this.parameters.data=this}return i.unbindTexture(this._fbo.colorTexture),this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=Ht(this._fbo),this.parameters.data=null}applyPreset(e,i){const r=e.median,n=s=>{const o=Bt(s[0],s[1],r);return i<.5?Bt(s[0],o,2*i):Bt(o,s[1],2*(i-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps,this._precompileTechniques()}setDirty(){this._dirty=this.running=!0}runTask(e){if(this.state===Au.Fading)return jo;this._dirty&&(this._faceIndex=this._tileIndex=0,this.state=Au.Rendering,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);const i=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!i.compiled)return i.release(),jo;const r=tet[this._faceIndex],n=iet[this._faceIndex];V1e(this._viewMatrix,ret,r,n),qv(this._passParameters.viewMatrix,this._viewMatrix);const s=this.context.renderContext.rctx,o=s.getViewport(),a=uE/this._tilesPerFace,l=this._tileIndex*a;s.setViewport(0,l,uE,a);const c=this._ensureFrameBufferCube(uE);s.bindFramebuffer(c),s.bindTechnique(i,this.context.renderContext.bind,this._passParameters);const h=vn.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(h),s.screen.draw(),i.release(),s.gl.flush(),s.setViewport(o.x,o.y,o.width,o.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this._faceIndex=this._tileIndex=0,this.state=Au.Ready,this.running=!1):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),jo}};u([f({constructOnly:!0})],Ll.prototype,"context",void 0),u([f({constructOnly:!0})],Ll.prototype,"view",void 0),u([f({constructOnly:!0})],Ll.prototype,"requestRender",void 0),u([f()],Ll.prototype,"coverage",void 0),u([f()],Ll.prototype,"density",void 0),u([f()],Ll.prototype,"absorption",void 0),u([f()],Ll.prototype,"cloudSize",void 0),u([f()],Ll.prototype,"detailSize",void 0),u([f()],Ll.prototype,"smoothness",void 0),u([f()],Ll.prototype,"cloudHeight",void 0),u([f()],Ll.prototype,"raymarchingSteps",void 0),u([f()],Ll.prototype,"running",void 0),Ll=u([L("esri.views.3d.environment.CloudsRenderer")],Ll);const tet=[$r(1,0,0),$r(-1,0,0),$r(0,1,0),$r(0,-1,0),$r(0,0,1)],iet=[$r(0,1,0),$r(0,1,0),$r(0,0,-1),$r(0,0,1),$r(0,1,0)],ret=FC(),Ud=zQ();var Io,ii;(function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"})(Io||(Io={})),function(t){t.SSAO="ssao",t.LASERLINES="laserline-color",t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color",t.OCCLUDED="occluded-color",t.VIEWSHED="viewshed-color",t.OPAQUE_ENVIRONMENT="opaque-environment-color",t.TRANSPARENT_ENVIRONMENT="transparent-environment-color"}(ii||(ii={}));var $y;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})($y||($y={}));let hCe=class extends Zu{constructor(){super(...arguments),this.type=$y.Rain}};u([le({count:$y.COUNT})],hCe.prototype,"type",void 0);let fi=class extends Mn{constructor(e,i){super(e,"vec3",Fi.Pass,(r,n,s)=>r.setUniform3fv(e,i(n,s)))}},Bs=class extends Mn{constructor(e,i){super(e,"mat4",Fi.Pass,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};function dCe(t){const e=new or;return e.attributes.add(k.POSITION,"vec3"),e.attributes.add(k.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new fi("cameraPosition",(i,r)=>r.camera.eye),new fi("offset",(i,r)=>net(i,r)),new rt("width",i=>i.width),new rt("time",i=>i.time),new Bs("proj",(i,r)=>r.camera.projectionMatrix),new Bs("view",(i,r)=>r.camera.viewMatrix)),e.varyings.add("vUv","vec2"),e.vertex.code.add(C`vec3 hash31(float p){
vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yzx + 33.33);
return fract((p3.xxy + p3.yzz) * p3.zyx);
}
float hash11(float p){
p = fract(p * 0.1031);
p *= p + 33.33;
p *= p + p;
return fract(p);
}
vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
}`),e.vertex.main.add(C`
      vUv = position.xz;
      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundredths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===$y.Rain?C`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:C`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
  `),e.fragment.uniforms.add(new rt("opacity",i=>i.opacity),new fi("particleColor",(i,r)=>set(r,t))),e.fragment.main.add(C`
    float d = length(vUv - vec2(0.5));

    ${t.type===$y.Rain?C`d = 0.35 * smoothstep(0.5, 0.0, d);`:C`d = smoothstep(0.5, 0.1, d);`}
    fragColor = opacity * vec4(particleColor * d, d);
  `),e}function net(t,e){const i=e.camera.eye,r=.5*t.width,n=1/t.width,s=Cxe(EW,ve(EW,(i[0]+r)*n,(i[1]+r)*n,(i[2]+r)*n));return nr(s,i,ue(s,s,t.width))}function set(t,e){const i=e.type===$y.Rain?aet:oet,r=ue(EW,i,cet),n=t.camera.eye;Me(sue,n);const s=Math.max(0,Te(sue,t.lighting.mainLight.direction));return br(r,r,i,s)}const EW=A(),sue=A(),oet=Qe(1,1,1),aet=Qe(.85,.85,.85),cet=.7,uet=Object.freeze(Object.defineProperty({__proto__:null,build:dCe},Symbol.toStringTag,{value:"Module"}));let het=class extends Ar{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=0}},oue=class extends hr{constructor(e,i,r){super(e,i,new ar(uet,()=>fe(()=>Promise.resolve().then(()=>QOt),void 0)),r,new Map([[k.POSITION,0],[k.INSTANCEFEATUREATTRIBUTE,1]]))}initializePipeline(){return Pi({blending:iM,depthTest:{func:gr.LEQUAL},colorWrite:Qi})}},nf=class{constructor(e,i,r,n,s,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};function Sd(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{var c;const n=t.fields.get(r),s=n.constructor.ElementCount,o=det(n.constructor.ElementType),a=n.offset,l=((c=n.optional)==null?void 0:c.glNormalized)??!1;return new nf(r,s,o,a,i,l,e)})}function det(t){const e=pet[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const pet={u8:Hi.UNSIGNED_BYTE,u16:Hi.UNSIGNED_SHORT,u32:Hi.UNSIGNED_INT,i8:Hi.BYTE,i16:Hi.SHORT,i32:Hi.INT,f32:Hi.FLOAT};let qK=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};qK.ElementCount=9;let WK=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){this.copyFromTypedBuffer(e,i.typedBuffer,r*i.typedBufferStride)}copyFromTypedBuffer(e,i,r){const n=this.typedBuffer;let s=e*this.typedBufferStride;for(let o=0;o<16;++o)n[s++]=i[r++]}get buffer(){return this.typedBuffer.buffer}};WK.ElementCount=16;let Vy=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};Vy.ElementCount=1;let By=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,ln(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};By.ElementCount=2;let jy=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,ve(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};jy.ElementCount=3;let Gy=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,_n(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Gy.ElementCount=4;let Oz=class pCe extends Vy{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}static fromTypedArray(e,i){return new pCe(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Oz.ElementType="f32";let iI=class CW extends By{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(CW,e,i)}static fromTypedArray(e,i){return new CW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iI.ElementType="f32";let Fv=class MW extends jy{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(MW,e,i)}static fromTypedArray(e,i){return new MW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Fv.ElementType="f32";let sx=class $W extends Gy{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer($W,e,i)}static fromTypedArray(e,i){return new $W(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};sx.ElementType="f32";let ox=class OW extends qK{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(OW,e,i)}static fromTypedArray(e,i){return new OW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ox.ElementType="f32";let ZK=class AW extends qK{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(AW,e,i)}static fromTypedArray(e,i){return new AW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ZK.ElementType="f64";let YK=class RW extends WK{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(RW,e,i)}static fromTypedArray(e,i){return new RW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};YK.ElementType="f32";let QR=class IW extends WK{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(IW,e,i)}static fromTypedArray(e,i){return new IW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};QR.ElementType="f64";let XK=class PW extends Vy{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(PW,e,i)}static fromTypedArray(e,i){return new PW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};XK.ElementType="f64";let JK=class LW extends By{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(LW,e,i)}static fromTypedArray(e,i){return new LW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};JK.ElementType="f64";let Az=class DW extends jy{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(DW,e,i)}static fromTypedArray(e,i){return new DW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Az.ElementType="f64";let Rz=class NW extends Gy{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(NW,e,i)}static fromTypedArray(e,i){return new NW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Rz.ElementType="f64";let KR=class FW extends Vy{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(FW,e,i)}static fromTypedArray(e,i){return new FW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};KR.ElementType="u8";let QK=class kW extends By{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(kW,e,i)}static fromTypedArray(e,i){return new kW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};QK.ElementType="u8";let fCe=class UW extends jy{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(UW,e,i)}static fromTypedArray(e,i){return new UW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};fCe.ElementType="u8";let Wc=class zW extends Gy{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(zW,e,i)}static fromTypedArray(e,i){return new zW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Wc.ElementType="u8";let KK=class VW extends Vy{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(VW,e,i)}static fromTypedArray(e,i){return new VW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};KK.ElementType="u16";let mCe=class BW extends By{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(BW,e,i)}static fromTypedArray(e,i){return new BW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};mCe.ElementType="u16";let gCe=class jW extends jy{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(jW,e,i)}static fromTypedArray(e,i){return new jW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};gCe.ElementType="u16";let eee=class GW extends Gy{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(GW,e,i)}static fromTypedArray(e,i){return new GW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};eee.ElementType="u16";let tee=class HW extends Vy{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(HW,e,i)}static fromTypedArray(e,i){return new HW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tee.ElementType="u32";let yCe=class qW extends By{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(qW,e,i)}static fromTypedArray(e,i){return new qW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};yCe.ElementType="u32";let _Ce=class WW extends jy{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(WW,e,i)}static fromTypedArray(e,i){return new WW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_Ce.ElementType="u32";let vCe=class ZW extends Gy{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(ZW,e,i)}static fromTypedArray(e,i){return new ZW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vCe.ElementType="u32";let iee=class YW extends Vy{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(YW,e,i)}static fromTypedArray(e,i){return new YW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iee.ElementType="i8";let ree=class XW extends By{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(XW,e,i)}static fromTypedArray(e,i){return new XW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ree.ElementType="i8";let wCe=class JW extends jy{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(JW,e,i)}static fromTypedArray(e,i){return new JW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};wCe.ElementType="i8";let bCe=class QW extends Gy{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(QW,e,i)}static fromTypedArray(e,i){return new QW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};bCe.ElementType="i8";let xCe=class KW extends Vy{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(KW,e,i)}static fromTypedArray(e,i){return new KW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};xCe.ElementType="i16";let Iz=class eZ extends By{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(eZ,e,i)}static fromTypedArray(e,i){return new eZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Iz.ElementType="i16";let SCe=class tZ extends jy{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(tZ,e,i)}static fromTypedArray(e,i){return new tZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};SCe.ElementType="i16";let TCe=class iZ extends Gy{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(iZ,e,i)}static fromTypedArray(e,i){return new iZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};TCe.ElementType="i16";let ECe=class rZ extends Vy{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(rZ,e,i)}static fromTypedArray(e,i){return new rZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ECe.ElementType="i32";let CCe=class nZ extends By{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(nZ,e,i)}static fromTypedArray(e,i){return new nZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};CCe.ElementType="i32";let MCe=class sZ extends jy{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(sZ,e,i)}static fromTypedArray(e,i){return new sZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};MCe.ElementType="i32";let $Ce=class oZ extends Gy{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(oZ,e,i)}static fromTypedArray(e,i){return new oZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$Ce.ElementType="i32";function aue(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let lue=class OCe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const n=e.fields.get(r);this[r]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new OCe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,n=e.count){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,i*s,n*s/4);new Uint32Array(this.buffer,r*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,i*s,n*s);new Uint8Array(this.buffer,r*s,n*s).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},fet=class ACe{constructor(e){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:get(i[1].constructor)})))}freeze(){return this}vec2f(e,i){return this._appendField(e,iI,i),this}vec2f64(e,i){return this._appendField(e,JK,i),this}vec3f(e,i){return this._appendField(e,Fv,i),this}vec3f64(e,i){return this._appendField(e,Az,i),this}vec4f(e,i){return this._appendField(e,sx,i),this}vec4f64(e,i){return this._appendField(e,Rz,i),this}mat3f(e,i){return this._appendField(e,ox,i),this}mat3f64(e,i){return this._appendField(e,ZK,i),this}mat4f(e,i){return this._appendField(e,YK,i),this}mat4f64(e,i){return this._appendField(e,QR,i),this}vec4u8(e,i){return this._appendField(e,Wc,i),this}f32(e,i){return this._appendField(e,Oz,i),this}f64(e,i){return this._appendField(e,XK,i),this}u8(e,i){return this._appendField(e,KR,i),this}u16(e,i){return this._appendField(e,KK,i),this}i8(e,i){return this._appendField(e,iee,i),this}vec2i8(e,i){return this._appendField(e,ree,i),this}vec2i16(e,i){return this._appendField(e,Iz,i),this}vec2u8(e,i){return this._appendField(e,QK,i),this}vec4u16(e,i){return this._appendField(e,eee,i),this}u32(e,i){return this._appendField(e,tee,i),this}_appendField(e,i,r){if(this._fields.has(e))return void St(!1,`${e} already added to vertex buffer layout`);const n=i.ElementCount*aue(i.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:i,offset:s,optional:r})}createBuffer(e){return new lue(this,e)}createView(e){return new lue(this,e)}clone(){const e=new ACe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,aue(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Zc(){return new fet}let NNt=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const n={...i,constructor:RCe(i.constructor)};this.fields.push([r,n])}),this.stride=e.stride}};const met=[Oz,iI,Fv,sx,ox,YK,XK,JK,Az,Rz,ZK,QR,KR,QK,fCe,Wc,KK,mCe,gCe,eee,tee,yCe,_Ce,vCe,iee,ree,wCe,bCe,xCe,Iz,SCe,TCe,ECe,CCe,MCe,$Ce];function RCe(t){return`${t.ElementType}_${t.ElementCount}`}function get(t){return ICe.get(t)}const ICe=new Map;met.forEach(t=>ICe.set(RCe(t),t));let IT=class extends Ne{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=Io.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([oe(()=>this.view.ready,e=>{var i;e&&((i=this.view._stage)==null||i.renderer.addRenderNode(this))},Si)])}destroy(){var e,i;(i=(e=this.view._stage)==null?void 0:e.renderer)==null||i.removeRenderNode(this)}precompile(){}render(){throw new Y("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){var r,n,s;const e=(n=(r=this._frameBuffer)==null?void 0:r.getTexture())==null?void 0:n.descriptor,i=this.view._stage.renderer.fboCache.acquire((e==null?void 0:e.width)??640,(e==null?void 0:e.height)??480,this.produces);return(s=i.fbo)==null||s.initializeAndBind(),i}bindRenderTarget(){var e,i;return(i=(e=this._frameBuffer)==null?void 0:e.fbo)==null||i.initializeAndBind(),this._frameBuffer}requestRender(e){var i;e===Gt.UPDATE&&((i=this.view._stage)==null||i.renderView.requestRender(e)),this._dirty=!0}resetWebGLState(){var e;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer((e=this._frameBuffer)==null?void 0:e.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){var e;return(e=this.view._stage)==null?void 0:e.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find(({name:i})=>i===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};u([f({constructOnly:!0})],IT.prototype,"view",void 0),u([f({constructOnly:!0})],IT.prototype,"consumes",void 0),u([f()],IT.prototype,"produces",void 0),IT=u([L("esri.views.3d.webgl.RenderNode")],IT);const Hy=IT,Oj=()=>de.getLogger("esri.views.webgl.VertexArrayObject");let rI=class{constructor(e,i,r,n,s=null){this._context=e,this._locations=i,this._layout=r,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce((e,i)=>e+i.usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*h_e}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this._indexBuffer=Ht(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&Oj().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Kn.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(Kn.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||Oj().error("Vertex buffer dictionary is empty!");const n=this._context.gl;this._buffers.forEach((s,o)=>{const a=i.get(o);a?GK(this._context,this._locations,s,a):Oj().error("Vertex element descriptor is empty!")}),r!=null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},km=class extends rI{},xw=class extends Hy{constructor(e){super(e),this.consumes={required:[ii.TRANSPARENT_ENVIRONMENT]},this.produces=ii.TRANSPARENT_ENVIRONMENT,this._rainSpeed=.1,this._snowSpeed=.01,this._numParticles=0,this._passParameters=new het,this._configuration=new hCe;const{view:i,type:r,techniques:n}=e;this._configuration.type=r==="rainy"?$y.Rain:$y.Snow,n.precompile(oue,this._configuration),this._passParameters.time=0,this._passParameters.radius=xr(i.spatialReference).radius,this.addHandles(oe(()=>i.environment.weather,s=>{s.type===r&&this.addHandles(oe(()=>s.precipitation,o=>this._adjustParticles(o),hi))},hi)),this.addHandles(oe(()=>{var s;return((s=i._stage)==null?void 0:s.renderer.renderContext.bind.clouds.fadeFactor)??1},s=>{this._passParameters.opacity=s,s===1&&(this.removeHandles("opacity"),this.addHandles(oe(()=>{var o;return((o=i._stage)==null?void 0:o.renderer.renderContext.bind.clouds.opacity)??1},o=>this._passParameters.opacity=o,hi),"opacity"))},xi),"opacity")}_adjustParticles(e){const r=e<.5?Bt(0,.35,2*e):Bt(.35,1,2*(e-.5));this._numParticles=cue*r}destroy(){this._numParticles=0,this._vao=Ht(this._vao),this._instanceIdBuffer=Ht(this._instanceIdBuffer)}fadeOut(e){this.removeAllHandles(),this.addHandles(oe(()=>{var i;return((i=this.renderContext)==null?void 0:i.bind.clouds.fadeFactor)??1},i=>{this._passParameters.opacity=1-i,i===1&&(this.removeAllHandles(),e())}),"opacity")}updateAnimation(e){const i=(this.type==="rainy"?this._rainSpeed:this._snowSpeed)*U_e(e.time)%1e5;return this._passParameters.time!==i&&(this._passParameters.time=i,!0)}render(e){const i=this.renderingContext;this._instanceIdBuffer??(this._instanceIdBuffer=this._createInstanceIndices(i));const r=Math.round(this._numParticles*this._passParameters.opacity),n=e.find(({name:a})=>a===ii.TRANSPARENT_ENVIRONMENT);if(r<1)return n;const s=this.techniques.acquire(oue,this._configuration);if(!s.compiled)return s.release(),this.requestRender(Gt.UPDATE),n;const o=i.bindTechnique(s,this.bindParameters,this._passParameters);return this._vao??(this._vao=yet(i,s.locations)),i.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),GK(i,s.locations,this._instanceIdBuffer,uue,0),i.drawArraysInstanced(ur.TRIANGLES,0,3,r),aCe(i,s.locations,this._instanceIdBuffer,uue),s.release(),n}_createInstanceIndices(e){const i=[];for(let r=0;r<cue;r++)i.push(r);return bs.createVertex(e,Vn.STATIC_DRAW,new Float32Array(i))}};function yet(t,e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new km(t,e,new Map([["geometry",Sd(_et)]]),new Map([["geometry",bs.createVertex(t,Vn.STATIC_DRAW,i)]]))}u([f()],xw.prototype,"consumes",void 0),u([f()],xw.prototype,"produces",void 0),u([f({constructOnly:!0})],xw.prototype,"type",void 0),u([f({constructOnly:!0})],xw.prototype,"techniques",void 0),xw=u([L("esri.views.3d.environment.Precipitation")],xw);const cue=25e4,_et=Zc().vec3f(k.POSITION),uue=Sd(Zc().f32(k.INSTANCEFEATUREATTRIBUTE),1);var J;function Aj(t){return t===J.Shadow||t===J.ShadowHighlight||t===J.ShadowExcludeHighlight||t===J.ViewshedShadow}function vet(t){return aZ(t)||t===J.Normal}function hue(t){return Tet(t)||t===J.Normal}function Pz(t){return t===J.Highlight||t===J.ObjectAndLayerIdColor}function wet(t){return rM(t)||Pz(t)}function rM(t){return t===J.Color}function yd(t){return rM(t)||nee(t)}function BNt(t){return rM(t)||t===J.ObjectAndLayerIdColor}function bet(t){return rM(t)||t===J.Highlight}function jNt(t){return bet(t)||Lz(t)}function TF(t){return rM(t)||Pz(t)}function xet(t){return yd(t)||Pz(t)}function aZ(t){return TF(t)||Lz(t)}function Tet(t){return xet(t)||Lz(t)}function Lz(t){return t===J.Depth}function nee(t){return t===J.ColorEmission}(function(t){t[t.Color=0]="Color",t[t.ColorEmission=1]="ColorEmission",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.ViewshedShadow=7]="ViewshedShadow",t[t.Highlight=8]="Highlight",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.COUNT=10]="COUNT"})(J||(J={}));const PCe={required:[]},Eet={required:[J.Depth]};let LCe=class extends Ne{precompile(e){const i=this.acquireTechniques(e);return Dz(i),i!=null}consumes(){return PCe}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}},nM=class extends LCe{},Cet=class extends LCe{};function Dz(t){Array.isArray(t)?t.forEach(e=>e==null?void 0:e.release()):t==null||t.release()}let Sw=class extends nM{constructor(e){super(e),this.produces=new Map([]),this._clouds=Xl(null),this._incarnation=0,this._precipitation=null}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var e,i;this.removeHandles(),this.uninitializeRenderContext(),(i=(e=this.view)==null?void 0:e._stage)==null||i.removeRenderPlugin(this),this._set("view",null)}get updating(){var e;return!!((e=this._clouds.value)!=null&&e.running)}get weatherVisible(){return Fe(this.view.state.camera.eye)-xr(this.view.spatialReference).radius<=ob}get usedMemory(){var e;return((e=this._clouds.value)==null?void 0:e.usedMemory)??0}_fadeOutPrecipitation(){var e;this._precipitation&&((e=this._precipitationOutgoing)==null||e.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut(()=>{this._precipitationOutgoing=Ye(this._precipitationOutgoing)}),this._precipitation=null,++this._incarnation)}get weather(){var e,i;return(i=(e=this.view)==null?void 0:e.environmentManager)!=null&&i.weatherEnabled?this.view.environment.weather:null}initializeRenderContext(e){this._context=e;const i=this.view,r=()=>this._requestRender();this.addHandles([oe(()=>this._precipitation,r,xi),oe(()=>{var n;return(n=this._clouds.value)==null?void 0:n.state},r,xi),oe(()=>i.state.mode,r,xi),oe(()=>this._updateClouds(),r,xi),oe(()=>this._updatePrecipitation(),r,xi),oe(()=>this.weather,n=>this._initWeather(n))])}uninitializeRenderContext(){this._context=null,this._clouds.value=Ye(this._clouds.value),this._precipitation=Ye(this._precipitation),this._precipitationOutgoing=Ye(this._precipitationOutgoing)}prepareRender(e){const{bind:i,time:r}=e;if(this.view.viewingMode!=="local"&&i.clouds.data){i.clouds.fade(i.camera,r,this.view.qualitySettings.fadeDuration);const n=this._clouds.value;n&&n.state===Au.Idle&&n.coverage===0&&!n.running&&n.destroyCubeMap()}}acquireTechniques(){return[]}render(){}_requestRender(){var e;(e=this._context)==null||e.requestRender()}_initWeather(e){const i=this._context;if(!e||!i)return void(this._clouds.value=Ye(this._clouds.value));if(this._clouds.value)return;const r=this.view;this._clouds.value=new Ll({context:i,view:r,requestRender:()=>this._requestRender()})}_updateClouds(){const e=this.view.environment.weather;return e==null||this._clouds.value==null||this._clouds.value.applyPreset(oa[e.type],Met(e)),++this._incarnation}_updatePrecipitation(){var n;const e=this.view.environment.weather;if(e.type===((n=this._precipitation)==null?void 0:n.type))return this._incarnation;this._fadeOutPrecipitation();const i=e.type==="rainy"||e.type==="snowy",r=this._context;return i&&r&&(this._precipitation=new xw({view:this.view,techniques:r.techniques,type:e.type}),++this._incarnation),this._incarnation}get test(){}};function Met(t){switch(t.type){case"rainy":case"snowy":case"cloudy":case"sunny":return t.cloudCover;case"foggy":return t.fogStrength}}u([f({constructOnly:!0})],Sw.prototype,"view",void 0),u([f({type:Boolean,readOnly:!0})],Sw.prototype,"updating",null),u([f({readOnly:!0})],Sw.prototype,"weatherVisible",null),u([f()],Sw.prototype,"_context",void 0),Sw=u([L("esri.views.3d.environment.EnvironmentRenderer")],Sw);var Nz=Math.PI,es=Math.sin,Do=Math.cos,see=Math.tan,DCe=Math.asin,oee=Math.atan2,NCe=Math.acos,Zs=Nz/180,FCe=864e5,kCe=2440588,UCe=2451545,$et={dec:0,ra:0};function Oet(t){return t.valueOf()/FCe-.5+kCe}function $L(t){return new Date((t+.5-kCe)*FCe)}function EF(t){return Oet(t)-UCe}var Y5=23.4397*Zs;function zCe(t,e){return oee(es(t)*Do(Y5)-see(e)*es(Y5),Do(t))}function aee(t,e){return DCe(es(e)*Do(Y5)+Do(e)*es(Y5)*es(t))}function VCe(t,e,i){return oee(es(t),Do(t)*es(e)-see(i)*Do(e))}function BCe(t,e,i){return DCe(es(e)*es(i)+Do(e)*Do(i)*Do(t))}function jCe(t,e){return Zs*(280.16+360.9856235*t)-e}function GCe(t){return Zs*(357.5291+.98560028*t)}function HCe(t){return Zs*(1.9148*es(t)+.02*es(2*t)+3e-4*es(3*t))}function qCe(t,e){return t+e+102.9372*Zs+Nz}function WCe(t,e){var i=GCe(t),r=qCe(i,HCe(i));return e||(e={dec:0,ra:0}),e.dec=aee(r,0),e.ra=zCe(r,0),e}var Bl={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,e,i,r){var n=Zs*-i,s=Zs*e,o=EF(t),a=WCe(o,$et),l=jCe(o,n)-a.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=VCe(l,s,a.dec),r.altitude=BCe(l,s,a.dec),r}},CF=[[-.83,"sunrise","sunset"]];Bl.addTime=function(t,e,i){CF.push([t,e,i])};var ZCe=9e-4;function Aet(t,e){return Math.round(t-ZCe-e/(2*Nz))}function due(t,e,i){return ZCe+(t+e)/(2*Nz)+i}function pue(t,e,i){return UCe+t+.0053*es(e)-.0069*es(2*i)}function Ret(t,e,i){return NCe((es(t)-es(e)*es(i))/(Do(e)*Do(i)))}function fue(t){var e=Zs*(134.963+13.064993*t),i=Zs*(93.272+13.22935*t),r=Zs*(218.316+13.176396*t)+6.289*Zs*es(e),n=5.128*Zs*es(i),s=385001-20905*Do(e);return{ra:zCe(r,n),dec:aee(r,n),dist:s}}Bl.getTimes=function(t,e,i){var r=Zs*-i,n=Zs*e,s=Aet(EF(t),r),o=due(0,r,s),a=GCe(o),l=HCe(a),c=qCe(a,l),h=aee(c,0),p=pue(o,a,c);function g(R){return pue(due(Ret(R,n,h),r,s),a,c)}function y(R){var I=(es(R)-es(n)*es(h))/(Do(n)*Do(h));return I<-1?Bl.PolarException.MIDNIGHT_SUN:I>1?Bl.PolarException.POLAR_NIGHT:Bl.PolarException.NORMAL}var w,b,x,T,M,$={solarNoon:$L(p),nadir:$L(p-.5),polarException:Bl.PolarException.NORMAL};for(w=0,b=CF.length;w<b;w+=1)M=p-((T=g((x=CF[w])[0]*Zs))-p),$[x[1]]=$L(M),$[x[2]]=$L(T);return $.polarException=y(CF[0][0]*Zs),$},Bl.getMoonPosition=function(t,e,i){var r=Zs*-i,n=Zs*e,s=EF(t),o=fue(s),a=jCe(s,r)-o.ra,l=BCe(a,n,o.dec);return l+=.017*Zs/see(l+10.26*Zs/(l+5.1*Zs)),{azimuth:VCe(a,n,o.dec),altitude:l,distance:o.dist}},Bl.getMoonFraction=function(t){var e=EF(t),i=WCe(e),r=fue(e),n=149598e3,s=NCe(es(i.dec)*es(r.dec)+Do(i.dec)*Do(r.dec)*Do(i.ra-r.ra)),o=oee(n*es(s),r.dist-n*Do(s));return(1+Do(o))/2};const yl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let OL=class{constructor(e,i){this.direct=e,this.ambient=i}};function Iet(t,e,i,r,n,s){ve(s.ambient.color,1,1,1),s.ambient.intensity=yl.global.ambient,ve(s.direct.color,1,1,1),s.direct.intensity=yl.global.direct;const o=e[2],a=Oe((Math.abs(o)-yl.local.altitude)/(yl.global.altitude-yl.local.altitude),0,1);let l;if(s.globalFactor=a,t!=null&&(l=Bl.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=Uet(t,l,r);else{const h=XCe(r);c={direct:{intensity:yl.local.directAtNoon*h.direct,color:Qe(1,1,1)},ambient:{intensity:yl.local.ambientAtNoon*h.ambient,color:Qe(1,1,1)},timeOfDay:"early afternoon"}}br(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Bt(c.ambient.intensity,s.ambient.intensity,a),br(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Bt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,s.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}s.noonFactor=t!=null?ket(t,l):1,t!=null?Pet(t,e,i,s.direct.directionToLightSource):YCe(n,i,s.direct.directionToLightSource)}function YCe(t,e,i){e===ct.Global?Me(Lj,t.eye):ve(Lj,0,0,1),ue(Dj,t.viewForward,-1);const r=XU(Dj,Lj),n=Math.max(r-2*Nj,0),s=.85*n/(n+1),o=Math.max(Nj,r-Nj-s);dd(Cue,-o,t.viewRight),Mt(i,Dj,Cue),xe(i,i,ue(zet,t.viewRight,Vet)),Me(i,i)}function Pet(t,e,i,r){const n=Fet,s=Jp(Net);if(i===ct.Global)Bl.getPosition(t,0,0,n),ve(r,0,0,-1),zE(s,s,-n.azimuth),xU(s,s,-n.altitude),Mt(r,r,s);else{const o=yl.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Oe(c,0,1),c<1?(Bl.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),ve(r,0,-1,0),VE(s,s,-n.azimuth),zE(s,s,-n.altitude),Mt(r,r,s)}}function Let(t,e){if(e===ct.Global)return!0;const i=yl.planarDirection;return Math.abs(t)<i.localAltitude}const Det=Qe(.5773502691896258,-.5773502691896258,.5773502691896258);let mue=class{constructor(){this.ambient={color:Qe(1,1,1),intensity:.55},this.direct={color:Qe(1,1,1),intensity:.55,directionToLightSource:En(Det)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const Net=ut(),Fet={azimuth:0,altitude:0};function ket(t,e){const i=t.valueOf();let r,n;e.polarException===Bl.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=r+432e6):e.polarException===Bl.PolarException.POLAR_NIGHT?(r=i-2,n=i-1):(r=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=r+(n-r)/2;return 1-Oe(Math.abs(i-s)/432e5,0,1)}function XCe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new OL(1,1);case"rainy":return new OL(.4,1.2);case"snowy":return new OL(.5,1.3);case"foggy":return new OL(.2,1.6)}}function gue(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const Rj=Qe(.01,.01,.01),lZ=Qe(1,.6,.5),cZ=Qe(1,.98,.98),yue=Qe(1,1,1),Ij=Qe(.8,.8,1),uZ=Qe(.8,.8,1),hZ=Qe(.98,.98,1),_ue=Qe(1,1,1),Pj=ks(.01,yl.local.ambientAtNight),dZ=ks(yl.local.directAtTwilight,yl.local.ambientAtTwilight),pZ=ks(.9*yl.local.directAtNoon,yl.local.ambientAtNoon),vue=ks(yl.local.directAtNoon,yl.local.ambientAtNoon),wue=pZ,bue=cZ,xue=hZ,Sue=dZ,Tue=lZ,Eue=uZ;function Uet(t,e,i){const r=t.valueOf();let n,s;e.polarException===Bl.PolarException.MIDNIGHT_SUN?(n=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===Bl.PolarException.POLAR_NIGHT?(n=r-2,s=r-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,g=n-p/2,y=n+p/2,w=s-p/2,b=s+p/2,x=Yt(),T=A(),M=A();let $="";if(r<g||r>b)Ha(x,Pj),ye(T,Rj),ye(M,Ij),$="night";else if(r<y){const P=(r-g)/(y-g);jh(x,Pj,dZ,P),br(T,Rj,lZ,P),br(M,Ij,uZ,P),$="sun rising"}else if(r<c){const P=(r-y)/(c-y);jh(x,dZ,pZ,P),br(T,lZ,cZ,P),br(M,uZ,hZ,P),$="early morning"}else if(r<a){const P=(r-c)/(a-c);jh(x,pZ,vue,P),br(T,cZ,yue,P),br(M,hZ,_ue,P),$="late morning"}else if(r<h){const P=(r-a)/(h-a);jh(x,vue,wue,P),br(T,yue,bue,P),br(M,_ue,xue,P),$="early afternoon"}else if(r<w){const P=(r-h)/(w-h);jh(x,wue,Sue,P),br(T,bue,Tue,P),br(M,xue,Eue,P),$="late afternoon"}else if(r<b){const P=(r-w)/(b-w);jh(x,Sue,Pj,P),br(T,Tue,Rj,P),br(M,Eue,Ij,P),$="sun setting"}let R=0;switch(i){case"rainy":case"foggy":R=.8;break;case"snowy":R=.5}R>0&&(gue(T,R),gue(M,R));const I=XCe(i);return{direct:{intensity:x[0]*I.direct,color:T},ambient:{intensity:x[1]*I.ambient,color:M},timeOfDay:$}}const Cue=ut(),Lj=A(),Dj=A(),zet=A(),Nj=.25,Vet=.2;var Rb;(function(t){t[t.Immediate=0]="Immediate",t[t.FadeWithWeather=1]="FadeWithWeather"})(Rb||(Rb={}));let lee=class{constructor(e=FC()){this.intensity=e}},JCe=class{constructor(e=FC(),i=Qe(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},X5=class{constructor(e=FC(),i=Qe(.57735,.57735,.57735),r=!0,n=1,s=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=n,this.environmentStrength=s}},QCe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}},xh=class extends ns.EventedAccessor{constructor(){super(),this._tmpLightParameters=new mue,this._defaultLightParameters=new mue,this._tmpDate=new Date,this._tmpTz={hours:0,minutes:0,seconds:0},this._viewHandlesKey="viewHandles",this._trackingEnabled=!1,this._mainLight=new X5,this._ambientLight=new lee,this._moonLight=new JCe,this._disableProjectionEngineAutoLoad=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!!((e=this._renderer)!=null&&e.updating)||!this._canProjectCameraPosition}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===ct.Global&&mU(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){var r,n,s,o;const e=((o=(s=(n=(r=this._view)==null?void 0:r.stateManager)==null?void 0:n.camera)==null?void 0:s.position)==null?void 0:o.spatialReference)??nt.WGS84,i=Hce(e);return this._disableProjectionEngineAutoLoad||Zw(e,i)}connectView(e){if(this._renderer)return;this._renderer=new Sw({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([oe(()=>e.environment.lighting,n=>this._updateLightingHandler(n),xi),oe(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),xi),oe(()=>e.environment.lighting.directShadowsEnabled,i,xi),oe(()=>e.qualitySettings.ambientOcclusion,i,xi),oe(()=>e.qualitySettings.reflections,i,xi),oe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),xi),oe(()=>e.environment.weather.type,()=>this._updateLighting(null,Rb.FadeWithWeather),xi),oe(()=>this.weatherEnabled,()=>this._updateLighting(null,Rb.FadeWithWeather),xi),oe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),hi),oe(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),hi),oe(()=>e.state.camera,r,hi),Kl(()=>this._canProjectCameraPosition,r,xi)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Ye(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(e),this._referencePositionGeographic!=null)){const r=sce(this._referencePositionGeographic,this._tmpTz);r!=null&&(i.autoUpdate(null,r),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;if(!r)return;const{position:n}=r,s=n.spatialReference??nt.WGS84,o=Hce(s),a=this._referencePositionGeographic??A();if(!ec(n,a,o))return this._referencePositionGeographic=null,void this._updateLighting();this._referencePositionGeographic=a,this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(a,e)||this._updateLighting(e)}_updateLighting(e,i=Rb.Immediate){const r=this._view,{lighting:n}=r.environment,s=n.type==="virtual",o=this._referencePositionGeographic,a=o!=null?this._tmpLightParameters:this._defaultLightParameters;if(o){e??(e=s?null:n.date);const y=this.weatherVisible?r.environment.weather.type:"disabled";Iet(e,o,r.state.viewingMode,y,r.state.camera,a)}else s&&YCe(r.state.camera,r.state.viewingMode,a.direct.directionToLightSource);const l=this._mainLight,c=a.direct;ue(l.intensity,c.color,c.intensity*Math.PI),ye(l.direction,c.directionToLightSource),l.specularStrength=a.specularStrength,l.environmentStrength=a.environmentStrength;const h=this._ambientLight;ue(h.intensity,a.ambient.color,a.ambient.intensity);const p=this._moonLight;br(p.intensity,Bet,jet,a.globalFactor);const g=(1-.5*a.globalFactor)*(1-.4*a.noonFactor*(1-a.globalFactor));ue(p.intensity,p.intensity,g),ye(p.direction,c.directionToLightSource),this._view._stage.renderer.updateLighting([l,h,p],a.noonFactor,a.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=this._tmpDate;r.setTime((i||this._view.environment.lighting.date).getTime());const n=sce(e,this._tmpTz);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=r.getUTCHours()-(n.hours-s.hours),a=r.getUTCMinutes()-(n.minutes-s.minutes),l=r.getUTCSeconds()-(n.seconds-s.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePositionGeographic==null||Let(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._referencePositionGeographic=null,e&&this._cameraHandler()}get test(){}};u([f({type:Boolean,readOnly:!0})],xh.prototype,"updating",null),u([f()],xh.prototype,"_disableProjectionEngineAutoLoad",void 0),u([f()],xh.prototype,"_disableWeather",void 0),u([f()],xh.prototype,"weatherEnabled",null),u([f()],xh.prototype,"weatherVisible",null),u([f()],xh.prototype,"referencePositionGeographic",null),u([f()],xh.prototype,"_renderer",void 0),u([f()],xh.prototype,"_referencePositionGeographic",void 0),u([f()],xh.prototype,"_canProjectCameraPosition",null),xh=u([L("esri.views.3d.environment.EnvironmentManager")],xh);const Bet=Qe(.22,.22,.33),jet=Qe(.22,.22,.22);var PT;let m_=PT=class extends ns.EventedMixin(Yb){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new PT(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=PT.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=PT.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==n&&(AL.target=this,AL.timezoneOffset=n,this.emit("timezone-will-change",AL),AL.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new PT({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([f({type:Boolean})],m_.prototype,"cameraTrackingEnabled",void 0),u([f({type:Date})],m_.prototype,"defaultDate",null),u([f({type:Date})],m_.prototype,"date",null),m_=PT=u([L("esri.views.3d.environment.SunLighting")],m_),function(t){function e({hours:i,minutes:r,seconds:n}){return Math.round(i+r/60+n/3600)}t.calculateTimezoneOffset=e}(m_||(m_={}));const AL={target:null,timezoneOffset:0},Tw=m_;var MF;let $F=MF=class extends ns.EventedMixin(q3){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new MF({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new MF(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([f({type:Boolean})],$F.prototype,"cameraTrackingEnabled",void 0),$F=MF=u([L("esri.views.3d.environment.VirtualLighting")],$F);const ZO=$F,Get={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Tw,virtual:ZO}};var YO;let XO=YO=class extends YE{constructor(t){super(t),this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new YO({...e,lighting:e.lighting?e.lighting.type==="virtual"?ZO.fromWebsceneLighting(e.lighting):Tw.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(S_e(e)),e}_convertLighting(t){var e,i;return t?t instanceof Tw||t instanceof ZO?t:t instanceof Yb?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Tw({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof q3?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new ZO({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):Bu(Get,t):new Tw}clone(){return new YO({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:te(this.background)})}cloneWithWebsceneEnvironment(t){return new YO({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:te(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Tw.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):ZO.fromWebsceneLighting(t.lighting);default:return t.lighting,Tw.fromWebsceneLighting(t.lighting)}}};u([f({nonNullable:!0})],XO.prototype,"lighting",void 0),u([$i("lighting")],XO.prototype,"castLighting",null),XO=YO=u([L("esri.views.3d.environment.SceneViewEnvironment")],XO);const LT=XO;var Xr;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Xr||(Xr={}));var pi;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(pi||(pi={}));var Em;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Em||(Em={}));let Yu=class{constructor(e=Xr.ALL,i=pi.NONE,r=0,n=null,s=null,o=Em.TUMBLE){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=n,this.interactionDirection=s,this.tiltMode=o}};function e3(t,e){return!!(t&e)}function J5(t,e,i,r,n,s){t!==0&&(i?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):r!=null?(s.min-=Math.max(0,(e-s.min)*(1-r)),s.max+=Math.max(0,(e-s.max)*(1-r))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const Dx=new Yu(Xr.NONE);function KCe(t,e,i,r){return e=e||t.viewForward,ye(r,e),ue(r,r,Math.sign(Te(e,i))),r}function iFt(t,e,i,r){return Yet(t,e,i,Wet(r,e,i,!0))}function Het(t,e,i,r){const n=Te(i,Ae(t,r,e));return xe(t,e,ue(t,i,n))}const qet={dir:A(),len:0,clip:Yt()};function Wet(t,e,i,r){const n=qet;return t?(i&&r&&(n.len=Nr(e,i)),ye(n.dir,t)):(n.len=Nr(e,i),Ae(n.dir,i,e),ue(n.dir,n.dir,1/n.len)),n}function Zet(t,e,i){const r=Te(t,i.dir),n=-us(t,e);if(n<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return n>0;if((n<0||r<0)&&!(n<0&&r<0))return!0;const s=n/r;return r>0?s<i.clip[1]&&(i.clip[1]=s):s>i.clip[0]&&(i.clip[0]=s),i.clip[0]<=i.clip[1]}function Yet(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!Zet(t[n],e,r))return!1;return!0}function Xet(t,e,i=Dx){const r=cee(t,e,i);if(r===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+r,o=KCe(e,i.interactionDirection,Ket(t,e,Math.sign(r),rtt),itt),a=ye(ntt,e.viewForward),l=n.intersectInfiniteManifold(rf(e.eye,o),s,Fj);return e.eye=l??n.setAltitude(Fj,s,e.eye),e.center=Het(Fj,e.eye,a,e.center),!0}function cee(t,e,i=Dx){if(!Jet(t,i)||!t.state.constraints.altitude)return 0;const r=ett(t.state.constraints.altitude,ttt);Qet(t,i,r);const n=t.renderCoordsHelper.getAltitude(e.eye),s=Oe(n,r.min,r.max)-n;return Math.abs(s)<=1e-6?0:s}function Jet(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==pi.TUMBLE||!e3(e.selection,Xr.TILT))}function Qet(t,e,i){const r=e.interactionType;if(r===pi.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===pi.TUMBLE||r===pi.ZOOM,c=cee(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=n,i.max=s,J5(c,h,l,a,.05*h,i)}function Ket(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),ue(r,r,i),r}function ett(t,e){return e.min=t.min,e.max=t.max,e}const ttt={min:0,max:0},itt=A(),rtt=A(),ntt=A(),Fj=A();function uee(t,e,i=Dx){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;RL.min=0,RL.max=r,ott(t,i,RL);const n=hee(t,e),s=RL.max-n;return s>=-1e-6?0:s}function stt(t,e,i=Dx){const r=uee(t,e,i);if(r===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=hee(t,e)+r,o=ye(ltt,e.eye),a=KCe(e,i.interactionDirection,att(e,n.renderLocation,htt),utt);if(!Zv(LSe(n.renderLocation,s),rf(e.eye,a),IL))return!1;e.eye=IL;const l=Ae(ctt,e.eye,o);e.center=xe(IL,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,IL);return h!=null&&(e.center=h),!0}function ott(t,e,i){const r=e.interactionType;if(r===pi.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===pi.ZOOM||r===pi.PAN,c=uee(t,o),h=c===0?0:hee(t,o);i.min=n,i.max=s,J5(c,h,l,a,.05*h,i)}function hee(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Nr(e.eye,i.renderLocation):0}function att(t,e,i){return _x(i,t.eye,e)}const RL={min:0,max:0},ltt=A(),ctt=A(),utt=A(),htt=A(),IL=A();function sM(t,e,i=id.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const n=dz(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+r.collision.elevationMargin;if(s>=o)return!1;const a=Fe(e.eye);if(Ae(PL,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(dtt,o,e.eye),i===id.EYE_AND_CENTER)e.center=xe(PL,e.eye,PL);else if(i===id.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=ue(PL,e.center,l)}return!0}var id;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(id||(id={}));const PL=A(),dtt=A();function eMe(t,e,i,r=!0){E$.eyeCenterDistance=0,E$.requiresTwoSteps=!1;const n=dee(t,e,i,Dx,E$);if(n===0)return!1;switch(dd(LL,-n,e.viewRight),i.tiltMode){case Em.LOOK_AROUND:Mt(I0,e.viewForward,LL),ue(I0,I0,E$.eyeCenterDistance),e.center=xe(z_,e.eye,I0);break;case Em.TUMBLE:Ae(I0,e.center,e.eye),Mt(I0,I0,LL),e.eye=Ae(z_,e.center,I0);break;default:i.tiltMode}return e.up=Mt(z_,e.up,LL),!E$.requiresTwoSteps||!r||eMe(t,e,i,!1)}function dee(t,e,i,r=Dx,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,xtt);return btt(t,i,o),r.interactionType===pi.TUMBLE&&e3(r.selection,Xr.ALTITUDE)&&tMe(t,r.interactionStartCamera,o),i.tiltMode===Em.LOOK_AROUND||r.tiltMode===Em.LOOK_AROUND?ftt(t,e,o,n):ptt(t,e,o)}function ptt(t,e,i){const r=xy(t.renderCoordsHelper,e.center,e.eye),n=r-Oe(r,i.min,i.max);return t3(n)?n:0}function ftt(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return gtt(t,e,i,r);case"local":return mtt(t,e,i,r)}}function mtt(t,e,i,r){const n=xy(t.renderCoordsHelper,e.center,e.eye),s=Oe(n,i.min,i.max),o=n-s;if(!t3(o))return 0;if(r){const a=Math.abs(t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.max(Math.cos(s),1e-4);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function gtt(t,e,i,r){const n=ytt(t,e,Stt),s=Oe(n.tiltAtCenter,i.min,i.max);if(!t3(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=_tt(n),a=vtt(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=wtt(n,o)),r&&(r.eyeCenterDistance=fZ(n,o)),a}function ytt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+xr(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,r,z_);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,s!=null?(i.eyeCenterDistance=Nr(e.eye,s),i.tiltAtCenter=xy(t.renderCoordsHelper,s,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=xy(t.renderCoordsHelper,e.center,e.eye):(JC(XC(nz,n),e.ray,z_),i.eyeCenterDistance=Nr(e.eye,z_),i.tiltAtCenter=Ga(-Te(e.viewForward,Me(z_,z_)))),i.radius=n,i.eyeRadius=Fe(e.eye),i.constraints=t.state.constraints,i}function t3(t){return Math.abs(t)>1e-9}function _tt(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let n=r,s=e.clampTilt(i,r);const o=fZ(t,s);if(e.clampTilt(o,r)===s)return s;let a=0;for(;a<10&&t3(s-n);){const l=(n+s)/2,c=fZ(t,l);t3(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function fZ(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-Oe(e,0,Math.PI),r=cd(t.radius/t.eyeRadius*Math.sin(i)),n=Math.PI-i-r,s=Math.sin(n)/Math.sin(i);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return s*t.eyeRadius}function vtt(t,e){const i=cd(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=cd(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function wtt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function btt(t,e,i){if(e.interactionType===pi.NONE)return;const{interactionStartCamera:r,interactionFactor:n}=e;if(!r)return;const{min:s,max:o}=i,a=dee(t,r,Dx,e),l=a===0?0:xy(t.renderCoordsHelper,r.center,r.eye);i.min=s,i.max=o,e.interactionType===pi.TUMBLE?(e3(e.selection,Xr.ALTITUDE)&&tMe(t,r,i),J5(a,l,!0,n,Mue,i)):J5(a,l,!1,n,Mue,i)}function tMe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const n=No(e.center),s=Math.sqrt(n),o=e.distance,a=xr(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-n)/(-2*s*o),p=(c*c-o*o-n)/(-2*s*o);i.min=Math.max(i.min,Math.min(Math.PI-Ga(p),i.max)),i.max=Math.min(i.max,Math.PI-Ga(h))}const I0=A(),LL=ut(),z_=A(),Mue=Wt(5),xtt={min:0,max:0},Stt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},E$={eyeCenterDistance:0,requiresTwoSteps:!1},Ttt=t=>t,Fz=t=>t*t,pee=t=>1-Fz(1-t),Ett=t=>t<.5?Fz(2*t)/2:(pee(2*(t-.5))+1)/2,fee=t=>t*t*t,iMe=t=>1-fee(1-t),rMe=t=>t<.5?fee(2*t)/2:(iMe(2*(t-.5))+1)/2,mee=t=>t*t*t*t,nMe=t=>1-mee(1-t),Ctt=t=>t<.5?mee(2*t)/2:(nMe(2*(t-.5))+1)/2,gee=t=>t*t*t*t*t,sMe=t=>1-gee(1-t),Mtt=t=>t<.5?gee(2*t)/2:(sMe(2*(t-.5))+1)/2,yee=t=>1-Math.cos(t*Math.PI/2),oMe=t=>1-yee(1-t),$tt=t=>t<.5?yee(2*t)/2:(oMe(2*(t-.5))+1)/2,_ee=t=>2**(10*(t-1)),nI=t=>1-_ee(1-t),Ott=t=>t<.5?_ee(2*t)/2:(nI(2*(t-.5))+1)/2,vee=t=>-(Math.sqrt(1-t*t)-1),aMe=t=>1-vee(1-t),Att=t=>t<.5?vee(2*t)/2:(aMe(2*(t-.5))+1)/2;function Td(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Ed(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const Rtt=Ed(Td(1),1),Itt=Ed(Td(1),0),mZ=Ed(Td(1),.5),Ptt=Ed(Td(2),1),Ltt=Ed(Td(2),0),Dtt=Ed(Td(2),.5),Ntt=Ed(Td(3),1),Ftt=Ed(Td(3),0),ktt=Ed(Td(3),.5),Utt=Ed(Td(4),1),ztt=Ed(Td(4),0),Vtt=Ed(Td(4),.5),Btt={linear:Ttt,"in-quad":Fz,"out-quad":pee,"in-out-quad":Ett,"in-coast-quad":Rtt,"out-coast-quad":Itt,"in-out-coast-quad":mZ,"in-cubic":fee,"out-cubic":iMe,"in-out-cubic":rMe,"in-coast-cubic":Ptt,"out-coast-cubic":Ltt,"in-out-coast-cubic":Dtt,"in-quart":mee,"out-quart":nMe,"in-out-quart":Ctt,"in-coast-quart":Ntt,"out-coast-quart":Ftt,"in-out-coast-quart":ktt,"in-quint":gee,"out-quint":sMe,"in-out-quint":Mtt,"in-coast-quint":Utt,"out-coast-quint":ztt,"in-out-coast-quint":Vtt,"in-sine":yee,"out-sine":oMe,"in-out-sine":$tt,"in-expo":_ee,"out-expo":nI,"in-out-expo":Ott,"in-circ":vee,"out-circ":aMe,"in-out-circ":Att};function zn(t,e,i=qtt,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<Wtt;a++){let l=0;for(const c of Htt)if(e3(i.selection,c.type)){const h=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(n=!0,l+=h)}if(l===0)break}const s=e3(i.selection,Xr.COLLISION),o=jtt(i.interactionType,t);return s&&sM(t,r,o)&&(n=!0),n&&r.computeUp(t.state.viewingMode),n}function jtt(t,e){switch(t){case pi.PAN:return id.EYE_AND_CENTER;case pi.ASCEND:return e.state.isGlobal?id.EYE_AND_CENTER_SCALE:id.EYE_AND_CENTER;default:return id.EYE}}function Hh(t){const e=Math.min(1,t/150);return rMe(e)}function Gtt(t,e,i){return dee(t,e,i)*e.distance}const Htt=[{type:Xr.TILT,error:Gtt,apply:eMe},{type:Xr.ALTITUDE,error:cee,apply:Xet},{type:Xr.DISTANCE,error:uee,apply:stt}],qtt=new Yu,Wtt=5;let $ue=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=A(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=En(Oue),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotate(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===ct.Global){const s=(Fe(this.center)+Fe(e.center))/2;i.pan=XU(this.center,e.center)*s}else i.pan=Nr(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const n=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,n),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===ct.Global?pSe(e.center,i.center,r.pan,this.center):br(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?Bt(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=Bt(e.pitch,i.pitch,r.rotate);let n=e._yaw;const s=i._yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this._yaw=Bt(n,s,r.rotate),this._fov=Bt(e.fov,i.fov,r.fov)}copyFrom(e){ye(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,ye(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,Aue);ye(this.center,e.center),Ae(Qo,e.center,e.eye),Zl(Qo,Qo,i),Zl(L0,e.up,i),this._distance=Fe(Qo),this._distance!==0&&(Qo[0]/=this._distance,Qo[1]/=this._distance,Qo[2]/=this._distance),this._pitch=Ztt(Qo),this._yaw=Ytt(Qo,L0),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,Aue);wx(i,i),this._axisAngleVec3(OF,this._pitch-Math.PI/2,Oue,Qo),this._axisAngleVec3(db,this._yaw,Qo,Qo),this._axisAngleVec3(OF,this._pitch-Math.PI/2,db,L0),this._axisAngleVec3(db,this._yaw,L0,L0),ue(Qo,Qo,this._distance),Zl(Qo,Qo,i),Zl(L0,L0,i),e.center=this.center,e.eye=Ae(Qo,this.center,Qo),e.up=L0,e.fov=this._fov}_axisAngleVec3(e,i,r,n){const s=Math.cos(i),o=Math.sin(i);return ue(au,r,s),Ot(Cc,e,r),ue(Cc,Cc,o),ue(P0,e,(1-s)*Te(e,r)),xe(n,xe(n,au,Cc),P0)}_lookAtOrientation(e,i=In()){return this._upAtLookAt(e,P0),Ot(au,this.direction,P0),Me(au,au),au[0]===0&&au[1]===0&&au[2]===0&&ye(au,OF),Ot(Cc,P0,au),Me(Cc,Cc),i[0]=au[0],i[1]=Cc[0],i[2]=P0[0],i[3]=au[1],i[4]=Cc[1],i[5]=P0[1],i[6]=au[2],i[7]=Cc[2],i[8]=P0[2],i}_upAtLookAt(e,i){return this.viewingMode===ct.Local?ye(i,db):Me(i,e)}};function Ztt(t){return Math.PI-XU(db,t)}function Ytt(t,e){const i=Xtt;return Math.abs(e[2])<.5?(ye(i,e),t[2]>0&&ue(i,i,-1)):ye(i,t),Ot(Cc,i,db),Me(Cc,Cc),XU(OF,Cc,db)}const au=A(),Cc=A(),P0=A(),Qo=A(),L0=A(),Xtt=A(),db=UE,Oue=KJ,OF=QJ,Aue=In();let Jtt=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const Q5={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Qtt=class lMe{constructor(e){this._createCamera=e,this.compared=new Jtt,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:Q5.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new lMe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow??Q5.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>Bo()}get hasFov(){return Math.abs(this.compared.fov)>Bo()}get hasRotate(){return this.compared.rotate>Bo()}},Ktt=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},eit=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,n=0;const s=this.definition,o=this.segments.reduce((a,l)=>a||l.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const l=this.segments[a],c=l.definition;if(e<=l.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),s.hasPan&&!isNaN(i.pan)&&isFinite(s.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/s.compared.pan:i.pan=1,s.hasRotate&&!isNaN(i.rotate)&&isFinite(s.compared.rotate)?i.rotate=(n+c.compared.rotate*i.rotate)/s.compared.rotate:i.rotate=1,o&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:h,targetZoom:p}=c.compared,g=i.zoom*(p-h)+h,y=this.segments[0].definition.compared.sourceZoom,w=this.segments[this.segments.length-1].definition.compared.targetZoom,b=Math.abs(p-y)>Math.abs(h-y)?p:h;i.zoomOffset=b-w,i.zoom=(g-y)/(b-y)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,n+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},kj=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,n=i.targetZoom;this._zoomSign=r>n?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const s=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;r&&(n&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else n?this._panPixelFlow=l:r?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);if(this._time=Math.max(this.rotateTime,this.zoomTime,this.panTime),this.fovTime>this._time){const c=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=c,this._panPixelFlow/=c,this._rotatePixelFlow/=c}}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/tit:0}get panTime(){if(!this.definition.hasPan)return 0;if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const tit=Wt(45);function iit(t,e,i){const r=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function rit(t,e,i){const r=1/e,n=Math.log(t.compared.sourceZoom*r),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function nit(t,e,i){const r=e-t.compared.sourceZoom,n=1/r,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function sit(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function oit(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function ait(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function lit(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function cit(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function uit(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function hit(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function dit(t,e,i){const r=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*n*s*a+t.halfWindowSize*r*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function pit(t,e,i){const r=e-t.compared.targetZoom,n=1/r,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function fit(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function mit(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function git(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function yit(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,n=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*n);return t.compared.sourceZoom<=t.compared.targetZoom?s*(i-n):s*(i+n)}function _it(t,e){let i=vit(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=r.ascensionFactor===0,s=r.descensionFactor===0,o=n?sit:iit,a=n?oit:rit,l=n?ait:nit,c=s?fit:hit,h=s?mit:dit,p=s?git:pit,g=R=>o(t,R,r)+lit(t,R,r)+c(t,R,r),y=R=>a(t,R,r)+cit(t,R,r)+h(t,R,r),w=R=>l(t,R,r)+uit(t,R,r)+p(t,R,r);let b=g(i);const x=yit(t);let T;const M=e.maximumIterations||20,$=e.maximumDistance!=null?e.maximumDistance:1/0;for(T=0;T<M;T++){const R=e.desiredSlope??1e-6;let I=y(i);Math.abs(I)>R&&(I+=R);const P=I/w(i);if(isNaN(P)||i>=$&&P<0){if(!isFinite($))return null;i=$,b=g(i);break}if(i-=P,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const N=g(i);if(Math.abs(N-b)/b<=.005)break;b=N}return b>x*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function vit(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let wit=class extends eit{constructor(e,i){super(),this._preallocSegments=[new kj,new kj,new kj],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i!=null&&i.apex?_it(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i==null?void 0:i.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=pee(r.zoom):e===this._descensionSegment&&(r.zoom=Fz(r.zoom))}_updateWithApex(e,i){const[r,n,s]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.definition.segmentStart=r.definition.segmentEnd,n.definition.segmentEnd=r.definition.segmentEnd+l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.definition.segmentStart=o+l,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const bit=new Ktt;let xit=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=mZ,this.definition=new Qtt(e),this.path=new wit}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(k_e(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?mZ:nI)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,bit);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,n=i.minDuration??Q5.minDuration/r,s=i.maxDuration??Q5.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,n),s)}},Sit=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new xit(()=>new $ue(e)),this._current=new $ue(e)}update(e,i,r){const{source:n,target:s}=this._animation.definition,o=Ae(Tit,i.center,e.center),a=Fe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ye(n.direction,o),ye(s.direction,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(i),this._current.copyFrom(n),this._animation.update(n,s,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){this._animation.cameraAt(e,this._current),this._current.copyToRenderCamera(i)}step(e,i){this.finished||(this.currentTime=this.currentTime+k_e(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const Tit=A();var sn;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(sn||(sn={}));let Jg=class extends Ne{constructor(e){super(e),this.state=sn.Ready}get running(){return this.state===sn.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=sn.Stopped,!0)}finishController(){this.state=sn.Finished}get steppingFinished(){return!1}};u([f({constructOnly:!0})],Jg.prototype,"view",void 0),u([f({readOnly:!0})],Jg.prototype,"running",null),u([f()],Jg.prototype,"state",void 0),u([f({readOnly:!0})],Jg.prototype,"isInteractive",null),Jg=u([L("esri.views.3d.state.controllers.CameraController")],Jg);let i3=class extends Jg{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(ki()),this._asyncResult=null),this.state===sn.Finished||this.state===sn.Stopped?(nU(e),this.state===sn.Finished?e.resolve():e.reject(ki())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=sn.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==sn.Ready&&this.state!==sn.Running||(this.viewAnimation.state===uC.State.FINISHED?this.finish():this.viewAnimation.state===uC.State.STOPPED&&(this.state=sn.Stopped))}onControllerEnd(e){this.viewAnimation==null||this.viewAnimation.done||(this.state===sn.Finished?this.viewAnimation.finish():this.state===sn.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===sn.Finished?this._asyncResult.resolve():this._asyncResult.reject(ki()))}finish(){this.finishController()}};i3=u([L("esri.views.3d.state.controllers.AnimationController")],i3);function Eit(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Cit(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Mit(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function $it(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let gZ=class{constructor(){this.adds=new mi,this.removes=new mi,this.updates=new mi({allocator:e=>e||new Oit,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Oit=class{},Ait=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Ph,yi;function cMe(t){const e=new Map,i=r=>{let n=e.get(r);return n||(n=new Ait,e.set(r,n)),n};return t.removes.forAll(r=>{Uj(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{Uj(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{Uj(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function Uj(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Ph||(Ph={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(yi||(yi={}));var yZ;let gi=yZ=class extends Ne{constructor(t){super(t),this._ray=zs(),this._viewport=Ri(0,0,1,1),this._padding=Ri(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ks(1,1e3),this._viewDirty=!0,this._viewMatrix=ut(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ut(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ut(),this._frustumDirty=!0,this._frustum=HR(),this._fullViewport=Ti(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=A(),this._up=A(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Ae(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){ps(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),ve(A(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),ve(A(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),ve(A(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=KE(Ti(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Qb(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=KE(Ti(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&Qb(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[yi.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[yi.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[yi.RIGHT]+this._padding[yi.LEFT]}set fullWidth(t){this.width=t-(this._padding[yi.RIGHT]+this._padding[yi.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[yi.TOP]+this._padding[yi.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[yi.TOP]+this._padding[yi.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[yi.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[yi.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){Ob(this._padding,t)||(this._viewport[0]+=t[yi.LEFT]-this._padding[yi.LEFT],this._viewport[1]+=t[yi.BOTTOM]-this._padding[yi.BOTTOM],this._viewport[2]-=t[yi.RIGHT]+t[yi.LEFT]-(this._padding[yi.RIGHT]+this._padding[yi.LEFT]),this._viewport[3]-=t[yi.TOP]+t[yi.BOTTOM]-(this._padding[yi.TOP]+this._padding[yi.BOTTOM]),ed(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(fs(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return Yl(ut(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ut()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Mit(this._fov,this.width,this.height)}set fovX(t){this._fov=Eit(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return $it(this._fov,this.width,this.height)}set fovY(t){this._fov=Cit(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Nr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Yl(this._viewInverseTransposeMatrix,this.viewMatrix),Gc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,n=i/this.rows,s=r/this.columns,o=-r/2+this.column*s,a=o+s,l=-i/2+this.row*n,c=l+n,h=U1e(ut(),o*(1+2*this._padding[yi.LEFT]/t),a*(1+2*this._padding[yi.RIGHT]/t),l*(1+2*this._padding[yi.BOTTOM]/e),c*(1+2*this._padding[yi.TOP]/e),this.near,this.far),p=this._get("projectionMatrix");return p&&nQ(p,h)?p:h}copyFrom(t){ye(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,ed(this._viewport,t.viewport),this.notifyChange("_viewport"),ed(this._padding,t.padding),this.notifyChange("_padding"),Ha(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(ps(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(U5(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(ps(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),ed(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return new yZ().copyFrom(this)}equals(t){return Qs(this.eye,t.eye)&&Qs(this.center,t.center)&&Qs(this.up,t.up)&&Ob(this._viewport,t.viewport)&&Ob(this._padding,t.padding)&&UTe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||O5(t.screenPadding,this.screenPadding)>=e||O5(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;nr(Ca,t.eye,t.center),nr(zj,this.eye,this.center);const i=Te(Ca,zj),r=w5(Ca),n=w5(zj),s=5e-4;return i*i>=(1-1e-10)*r*n&&Xb(t.eye,this.eye)<Math.max(r,n)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(uv(this.viewForward,Ae(Ca,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=ds()){return t[0]=(this.padding[yi.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[yi.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[yi.LEFT]+this.width*e,t[1]=this.padding[yi.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Bi&&ye(Bi,t),Bi[3]=1,zc(Bi,Bi,this.projectionMatrix);const i=Math.abs(Bi[3]);ue(Bi,Bi,1/i);const r=this.fullViewport;e[0]=Bt(0,r[0]+r[2],.5+.5*Bi[0]),e[1]=Bt(0,r[1]+r[3],.5+.5*Bi[1]),e[2]=.5*(Bi[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Bi[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Bi[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Bi[2]=(2*t[2]-1)*t[3],Bi[3]=t[3],this.inverseProjectionMatrix!=null&&(zc(Bi,Bi,this.inverseProjectionMatrix),e[0]=Bi[0],e[1]=Bi[1],e[2]=Bi[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,Vj),this.renderToScreen(Vj,e),e}projectToRenderScreen(t,e){if(Bi[0]=t[0],Bi[1]=t[1],Bi[2]=t[2],Bi[3]=1,zc(Bi,Bi,this.viewProjectionMatrix),Bi[3]===0)return null;const i=Bi;ue(i,i,1/Math.abs(Bi[3]));const r=this.fullViewport,n=Bt(0,r[0]+r[2],.5+.5*i[0]),s=Bt(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=n,e.y=s):(e[0]=n,e[1]=s,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,Vj),e)}unprojectFromRenderScreen(t,e){if(fs(DL,this.projectionMatrix,this.viewMatrix),!Yl(DL,DL))return null;const i=this.fullViewport;return Bi[0]=2*(t[0]-i[0])/i[2]-1,Bi[1]=2*(t[1]-i[1])/i[3]-1,Bi[2]=2*t[2]-1,Bi[3]=1,zc(Bi,Bi,DL),Bi[3]===0?null:(e[0]=Bi[0]/Bi[3],e[1]=Bi[1]/Bi[3],e[2]=Bi[2]/Bi[3],e)}constrainWindowSize(t,e,i,r){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-i/2,0),a=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-s-r/2,0),h=i-l- -Math.min(this.fullWidth-n-i/2,0),p=r-c- -Math.min(s-r/2,0);return[Math.round(o),Math.round(a),Math.round(h),Math.round(p)]}computeUp(t){t===ct.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){Ae(Ca,this.center,this.eye);const t=Fe(this.center);t<1?(ve(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Te(Ca,this.center))>.9999*Fe(Ca)*t||(Ot(this._up,Ca,this.center),Ot(this._up,this._up,Ca),Me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){_x(Ca,this.eye,this.center),Math.abs(Ca[2])<=.9999&&(ue(Ca,Ca,Ca[2]),ve(this._up,-Ca[0],-Ca[1],1-Ca[2]),Me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Qs(t,e)||(ye(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):de.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(OTe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(SU(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([f()],gi.prototype,"_viewport",void 0),u([f()],gi.prototype,"_padding",void 0),u([f()],gi.prototype,"_fov",void 0),u([f()],gi.prototype,"_nearFar",void 0),u([f()],gi.prototype,"_viewDirty",void 0),u([f()],gi.prototype,"_viewMatrix",void 0),u([f()],gi.prototype,"_pixelRatio",void 0),u([f()],gi.prototype,"pixelRatio",null),u([f()],gi.prototype,"row",void 0),u([f()],gi.prototype,"column",void 0),u([f()],gi.prototype,"_rows",void 0),u([f()],gi.prototype,"rows",null),u([f()],gi.prototype,"_columns",void 0),u([f()],gi.prototype,"columns",null),u([f()],gi.prototype,"eye",null),u([f()],gi.prototype,"center",null),u([f()],gi.prototype,"_center",void 0),u([f()],gi.prototype,"up",null),u([f()],gi.prototype,"_up",void 0),u([f()],gi.prototype,"viewMatrix",null),u([f({readOnly:!0})],gi.prototype,"viewForward",null),u([f({readOnly:!0})],gi.prototype,"viewUp",null),u([f({readOnly:!0})],gi.prototype,"viewRight",null),u([f({readOnly:!0})],gi.prototype,"nearFar",null),u([f()],gi.prototype,"near",null),u([f()],gi.prototype,"far",null),u([f()],gi.prototype,"viewport",null),u([f({readOnly:!0})],gi.prototype,"screenViewport",null),u([f({readOnly:!0})],gi.prototype,"screenPadding",null),u([f()],gi.prototype,"x",null),u([f()],gi.prototype,"y",null),u([f()],gi.prototype,"width",null),u([f()],gi.prototype,"height",null),u([f()],gi.prototype,"fullWidth",null),u([f()],gi.prototype,"fullHeight",null),u([f({readOnly:!0})],gi.prototype,"_aspect",null),u([f()],gi.prototype,"padding",null),u([f({readOnly:!0})],gi.prototype,"projectionMatrix",null),u([f({readOnly:!0})],gi.prototype,"inverseProjectionMatrix",null),u([f()],gi.prototype,"fov",null),u([f()],gi.prototype,"fovX",null),u([f()],gi.prototype,"fovY",null),u([f()],gi.prototype,"viewInverseTransposeMatrix",null),u([f({readOnly:!0})],gi.prototype,"_projectionMatrixInternal",null),u([f()],gi.prototype,"relativeElevation",void 0),gi=yZ=u([L("esri.views.3d.webgl.RenderCamera")],gi);const Jr=gi,Bi=Ti(),DL=ut(),Ca=A(),zj=A(),Vj=Ip();let pb=class extends i3{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.type="point-to-point",this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Sit(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new uC}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);NL.copyFrom(this.view.state.camera);const n=pd(this.view.state.viewingMode);this._intersectionHelper.intersectRay(NL.ray,n,Rue)&&(NL.center=Rue),this.animation.update(NL,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Btt[e.easing]:e.easing}}};u([f({constructOnly:!0})],pb.prototype,"mode",void 0),u([f({readOnly:!0})],pb.prototype,"isInteractive",null),pb=u([L("esri.views.3d.state.controllers.PointToPointAnimationController")],pb);const NL=new Jr,Rue=A();function Iue(t){return t!=null&&"type"in t&&t.type==="point-to-point"}function kz(t=Iit){return[t[0],t[1],t[2],t[3]]}function r3(t,e){return Rit(t[0],t[1],t[2],e,BQ.get())}function Rit(t,e,i,r,n=kz()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function wee(t,e,i){return Ot(i,t,e),Me(i,i),i[3]=qQ(t,e),i}const Iit=[0,0,1,0];function yFt(t,e,i=zs()){return bee(t,Mp(e),i),Me(i.direction,i.direction),i}function bee(t,e,i){return Pit(t,t.screenToRender(e,et.get()),i)}function Pit(t,e,i){const r=Ha(et.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const n=Ha(et.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,et.get());return s==null?null:(Ae(i.direction,s,i.origin),i)}function oM(t,e,i){return xee(t,t.screenToRender(e,et.get()),i)}function xee(t,e,i){ye(i.origin,t.eye);const r=ve(et.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(r,et.get());return n==null?null:(Ae(i.direction,n,i.origin),i)}function See(t,e,i,r){const n=oM(e,i,Lit);return Zv(t,n,r)}const Lit=zs();var fC;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(fC||(fC={}));const uMe=30,K5=[1,3e8],sI=80,hMe=8,dMe=200,pMe=1508e5,fMe=5,mMe=50,Dit=5,Nit=10,Bj=90,Nx={exclude:new Set([Pv])};function Ib(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function _Z(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function kv(t,e,i){const r=dd(jQ.get(),i[3],i);r==null||j1e(r,Js)||(Ae(wr,t.eye,e),Mt(wr,wr,r),t.eye=xe(wr,wr,e),Ae(wr,t.center,e),Mt(wr,wr,r),t.center=xe(wr,wr,e),t.up=Mt(wr,t.up,r))}function Fit(t,e,i,r){return ZC(t,bee(e,i,Cee),r)}function vZ(t,e,i,r){return ZC(t,oM(e,i,Cee),r)}function Tee(t,e,i,r){const n=et.get();let s=1-i;Ae(n,e,t.eye);const o=Fe(n);let a=o*(1-s);s>=0&&a<r&&(a=r,s=-(a-o)/o),Math.abs(o-a)<1e-6||(ue(n,n,s),t.eye=xe(wr,t.eye,n),t.center=br(wr,t.center,e,s))}function gMe(t,e,i){e.getScreenCenter(Pue),See(t,e,Pue,wr)&&(e.center=wr);const r=e.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;const s=ue(et.get(),e.viewForward,n);e.eye=Ae(wr,e.center,s)}const Pue=ds();function jj(t,e){ve(e,0,0,0);for(const i of t)xe(e,e,i);ue(e,e,1/t.length)}function AF(t,e,i,r){return Math.sin(t/Fe(e))*(i+r.radius)}function Lue(t,e,i,r){return AF(Math.PI/2,e,i,r)+(t-Math.PI/2)}var ma;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(ma||(ma={}));const Due={Elevation:3e4,Angle:Wt(16)},FL={Pole:.95,Angle:Wt(18),Tilt:45},yMe=Wt(80);function _Me(t,e,i,r,n,s){const o=A(),a=Pn();let l=!0,c=!0;return t.intersectScreen(i,o,s)?a[3]=Fe(o):(c=!1,e.aboveGround&&n!==fC.Ellipsoid?a[3]=Math.max(Fe(e.center),.9*r.radius):a[3]=Fe(e.eye)-e.relativeElevation,n===fC.Silhouette?n3(a,e,i,o):l=See(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function oI(t,e,i,r){const n=t.relativeElevation;if(n>Due.Elevation&&r==="global")return ma.Horizontal;oM(t,e,Hj);const s=Math.sign(n),o=i.worldUpAtPosition(t.eye,wr);return-s*Te(o,Hj.direction)<Math.sin(Due.Angle)*Fe(Hj.direction)?ma.Vertical:ma.Horizontal}function vMe(t,e,i){Ae(Gj,i,e),t.eye=Ae(wr,t.eye,Gj),t.center=Ae(wr,t.center,Gj)}const Gj=A();function n3(t,e,i,r){const n=oM(e,i,Cee);return n!=null&&(JC(t,n,kL),Zv(t,n,r)?!(to(kL,n.origin)<to(r,n.origin))||(ye(r,kL),!1):(Ae(SS,e.eye,e.center),Me(SS,SS),fSe(SS,-Te(Me(SS,SS),kL),Nue),ZC(Nue,n,r),!1))}const kL=A(),SS=A(),Nue=dn();function wMe(t,e,i,r,n,s){let o=0;if(Ot(ik,t,e),Ae(BL,t,e),Fe(t)<=n||!r.aboveGround){Ot(i,BL,r.eye);const a=Te(t,e)/(Fe(t)*Fe(e));if(a<.9999)o=Ga(a);else{const c=Fe(Ot(A(),t,e))/(Fe(t)*Fe(e));o=cd(c)}const l=Math.cos(Oe(Cv.normalize(Wt(s)),0,yMe));o=-o-Math.max(0,Fe(e)-n)/(l*n)}else Ae(Fue,r.eye,r.center),Ot(i,BL,Fue),o=-Fe(BL)/n;return Me(i,i),ue(i,i,Fe(ik)),o}const Fue=A();function kue(t,e,i,r){let n,s;const o=Math.cos(Oe(Cv.normalize(Wt(r)),0,yMe));return n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Ga(e/i),s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Ga(t/i),(s-n)*i}function kit(t,e,i,r,n,s,o,a,l,c){const h=kue(t[2],e[2],s[3],a),p=l?kue(t[0],e[0],s[3],180):e[0]-t[0],g=Math.sin(o)*p-Math.cos(o)*h,y=Math.cos(o)*p+Math.sin(o)*h;Me(wr,n);const w=l?g/Math.sqrt(Math.abs(s[3]**2-Te(i,wr)**2)):g/s[3],b=y/Math.sqrt(Math.abs(s[3]**2-Te(i,r)**2));ln(c,w,b)}function bMe(t,e,i,r,n,s,o,a,l,c){Ot(ik,t,e),O7(s.up,s.eye,UL,zL,VL),O7([0,0,1],s.eye,dy,fv,EMe),ye(i,fv),ye(r,dy),Me(i,i),ue(i,i,Fe(ik)),Mle(t,Me(zL,zL),Me(VL,VL),Me(UL,UL),Uue),Mle(e,zL,VL,UL,zue),kit(Uue,zue,t,dy,fv,o,a,l,c,n)}function Uit(t,e,i,r,n,s,o){dd(ek,n,r),dd(tk,o,s),fs(O2,ek,tk),Ae(e,t,i),Mt(e,e,O2),xe(e,e,i)}function xMe(t,e,i,r,n,s){dd(ek,r,i),dd(tk,s,n),fs(O2,ek,tk),Ae(wr,t.eye,e),Mt(wr,wr,O2),t.eye=xe(wr,wr,e),Ae(wr,t.center,e),Mt(wr,wr,O2),t.center=xe(wr,wr,e),Ae(wr,t.up,e),Mt(wr,wr,O2),t.up=xe(wr,wr,e)}function Eee(t,e,i,r,n,s){return(Math.abs(r)>Math.PI-FL.Angle||Math.abs(r)<FL.Angle)&&(Math.abs(t[2])<i*FL.Pole||Math.abs(e)>i)&&s.aboveGround&&n<FL.Tilt}function SMe(t,e,i,r,n,s){if(s)wee(i,r,Vue),kv(e,t,Vue);else{const o=wMe(i,r,Bue,e,t[3],n);kv(e,t,r3(Bue,o))}}function TMe(t,e,i,r,n,s,o){const a=o?20:1,l=1e-12;let c,h;ye(T1,r),jL.copyFrom(e);for(let p=0;p<a&&to(i,T1)>l&&(c=to(i,T1),bMe(i,T1,fv,dy,C$,jL,t,n,s,o),xMe(jL,t,dy,C$[1],fv,C$[0]),Uit(T1,T1,t,dy,C$[1],fv,C$[0]),h=to(i,T1),h<c||p===0);p++)e.copyFrom(jL)}function zit(t,e,i,r,n,s,o){Eee(i,Te(e.up,i),t[3],-Cv.normalize(Wt(n)),s,e)?TMe(t,e,i,r,-Cv.normalize(Wt(n)),s,o):SMe(t,e,i,r,s,o)}function Vit(t,e,i,r,n,s){const{eye:o}=t;O7([0,0,1],o,dy,fv,EMe);const a=e.translation[0]*i.pan,l=n.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Te(t.center,dy)**2/Fe(t.center)**2)),.5),h=(Math.sin(s)*l+Math.cos(s)*a)/c,p=-Math.cos(s)*l+Math.sin(s)*a;switch(Lu(r.pan.matrix,r.pan.matrix,h,dy),r.pan.enabled=!0,n.mode){case"pan":Lu(r.pan.matrix,r.pan.matrix,p,fv),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Bit(t,e,i,r,n){const{eye:s,viewRight:o}=t,a=Ot(et.get(),o,s),l=e.translation[0]*i.pan;switch(l!==0&&(Lu(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Lu(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function jit(t,e,i,r,n,s,o,a,l){Eee(t.center,Te(t.up,t.center),Fe(t.center),-Cv.normalize(Wt(s)),o,e)?Vit(e,i,r,a,l,-Cv.normalize(Wt(n))):Bit(e,i,r,a,l)}const dy=A(),fv=A(),EMe=A(),UL=A(),zL=A(),VL=A(),Uue=A(),zue=A(),C$=Yt(),Vue=kz(),ek=ut(),tk=ut(),O2=ut(),T1=A(),wr=A(),BL=A(),jL=new Jr,ik=A(),Bue=A(),Cee={origin:A(),direction:A()},Hj={origin:A(),direction:A()},jue=.6,qj=4,Git=60;let rk=class extends pb{constructor(){super(...arguments),this._zoomLocation=A(),this._tmpCamera=new Jr,this._tmpViewDir=A(),this._tmpRayDir=zs(),this._targetOnSphere=A(),this._tmpCenter=A(),this._beginCamera=new Jr,this._constraintOptions=new Yu(Xr.ALL_EXCEPT_COLLISION,pi.ZOOM,null,this._beginCamera),this._sphere=Pn()}initialize(){this._intersector=pd(this.view.state.viewingMode)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let n=!1,s=!1;this._intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?Nx:{})&&(n=e>0,s=!0),this._tmpCamera.copyFrom(r.camera),n?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ye(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,i,s),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:nI}}_updateCamera(e,i,r,n){const s=oI(e,r,this.view.renderCoordsHelper,this.view.viewingMode),o=Math.abs(this.view.camera.position.z),a=this._zoomLocation;Me(HL,e.eye),ue(HL,HL,-1),oM(e,r,this._tmpRayDir),Me(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=Oe(Math.min(hMe,1/Math.abs(Te(HL,this._tmpRayDir.direction)))*o,dMe,pMe);if(s===ma.Horizontal){let c=jue**i;this._sphere[3]=Fe(a),Ae(this._tmpViewDir,e.center,e.eye);const h=Math.min(Fe(this._tmpViewDir),l);let p=h*c;if(c<=1&&p<qj&&(p=qj,c=p/h),Math.abs(h-p)<1e-6)return;const g=Fe(e.center);if(this._sphere[3]!==g){const y=this._sphere[3]+c*(g-this._sphere[3]);e.center=ue(GL,e.center,y/g)}ue(this._tmpViewDir,this._tmpViewDir,-c),e.eye=xe(GL,e.center,this._tmpViewDir),zn(this.view,e,this._constraintOptions),to(a,e.center)>1e-12&&See(this._sphere,e,r,this._targetOnSphere)&&zit(this._sphere,e,a,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=jue**Math.abs(i);const h=i>0?1:-1;Ae(this._tmpViewDir,a,e.eye);const p=Fe(this._tmpViewDir),g=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,Git);let y=g??l;y=n&&i>0?Math.min(y,p):y,ue(this._tmpRayDir.direction,this._tmpRayDir.direction,y),xe(a,this._tmpRayDir.origin,this._tmpRayDir.direction);let w=y*c;const b=Math.max(qj,1.01*e.nearFar[0]);if(i>0&&w<b&&(w=b,c=w/y),Math.abs(y-w)<1e-6)return;ue(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-c)),e.eye=xe(GL,e.eye,this._tmpRayDir.direction),e.center=xe(GL,e.center,this._tmpRayDir.direction)}sM(this.view,e)}};rk=u([L("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],rk);const GL=A(),HL=A();let RF,IF=null;const hE=new Map;async function vFt(t){IF==null&&(RF==null&&(RF=fe(()=>import("./VoxelWasmPerSceneView-s4fw6RxJ.js"),__vite__mapDeps([249,196]))),IF=await RF);const e=t.view;let i=hE.get(e);return i||(i=new IF.default({view:e}),hE.set(e,i)),i.addVoxelLayer(t)}function s3(t){return hE.get(t)}function wFt(t){const e=t.view,i=hE.get(e);i&&i.removeVoxelLayer(t)<1&&(hE.delete(e),hE.size===0&&(RF=null,IF=null))}const Hit=.6,qit=4,Wit=60;let nk=class extends pb{constructor(){super(...arguments),this._zoomLocation=A(),this._tmpCamera=new Jr,this._tmpRayDir=A(),this._tmpCenter=A(),this._beginCamera=new Jr,this._constraintOptions=new Yu(Xr.ALL,pi.ZOOM,null,this._beginCamera)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const n=pd(this.view.state.viewingMode);let s=!1;e>0?(s=this._intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?Nx:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ye(this._zoomLocation,this._tmpCamera.center);const o=Hit**e;let a=this.view._stage.renderView.getMinimalDepthForArea(s3(this.view),i[0],i[1],this.view.state.camera,Wit);Ae(qL,this._tmpCamera.eye,this._zoomLocation),Me(qL,qL);const l=Oe(Math.min(hMe,1/Math.abs(Te(Zit,qL)))*Math.abs(this.view.camera.position.z),dMe,pMe);if(a=a??l,a){const c=A();Ae(c,this._zoomLocation,this._tmpCamera.eye),(a<Fe(c)||!s)&&(Me(c,c),xe(this._zoomLocation,this._tmpCamera.eye,ue(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:nI}}_updateCamera(e,i,r){Ae(this._tmpRayDir,r,e.eye);const n=Fe(this._tmpRayDir);let s=n*i;const o=i<=1,a=Math.max(qit,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,i=s/n),Math.abs(n-s)<1e-6||(ue(this._tmpRayDir,this._tmpRayDir,i),e.eye=Ae(Gue,r,this._tmpRayDir),e.center=br(Gue,e.center,r,1-i),zn(this.view,e,this._constraintOptions)))}};nk=u([L("esri.views.3d.state.controllers.ZoomStepControllerLocal")],nk);const Gue=A(),Zit=Qe(0,0,1),qL=A();function Yit(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Mee(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let Xit=class extends qo{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(Yit(i,"primary")){const r=this._view.state.isGlobal?new rk({view:this._view,mode:"animation"}):new nk({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.step(Math.log(.5)/Math.log(.6),ds(i.x,i.y)),e.stopPropagation()}}};function $ee(t){return Oe((t-1e5)/9e5,0,1)}const wZ=1e4,PF=Qe(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),Wj=3,Zj=Qe(Wj*parseFloat(65e-8.toFixed(6)),Wj*parseFloat(1881e-9.toFixed(6)),Wj*parseFloat(85e-9.toFixed(6))),Jit=3996e-9,Qit=Qe(parseFloat(Number(PF[0]+Zj[0]).toFixed(6)),parseFloat(Number(PF[1]+Zj[1]).toFixed(6)),parseFloat(Number(PF[2]+Zj[2]).toFixed(6)));function Kit(t,e,i){return t===ct.Global?new trt(i):new ert(e,i)}let ert=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=xr(i),this._unitInMeters=Ql(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,n,s){var $;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=($=this._elevationProvider)==null?void 0:$.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(r=r??new pr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);Ae(E1,i,e),TS[0]=E1[0]>0?r.xmax:r.xmin,TS[1]=E1[1]>0?r.ymax:r.ymin,TS[2]=E1[2]>0?p/2:-p/2,Ae(TS,TS,e),Me(E1,E1);const g=1.1*Te(TS,E1)*this._unitInMeters,y=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),w=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),b=w*nrt*this._unitInMeters,x=w*srt*this._unitInMeters,T=Oe((o-x)/(b-x),0,1)**3,M=Math.min(Bt(y,g,T),y)*Math.max(Math.log(Math.abs(l)),1);return CMe(Math.min(M,Math.max(34064e4,p))/this._unitInMeters,irt,this._unitInMeters,s)}},trt=class{constructor(e){this._referenceEllipsoid=xr(e)}compute(e,i,r,n,s){s||(s={near:0,far:0});const o=Fe(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),g=o+this._referenceEllipsoid.radius;return CMe(1.2*Bt(p,g,$ee(h)),Oe(2e4-(Math.log(h)-7.983)/9.011*19900,100,2e4),1,s)}};function CMe(t,e,i,r){const n=rrt/i;return t/e>n?(r.far=t,r.near=r.far/e):(r.near=n,r.far=r.near*e),r}const irt=2e4,rrt=2,nrt=.001,srt=1e-4,TS=A(),E1=A();let LF=class extends Ne{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&CTe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>sM(this.view,e,id.EYE_AND_CENTER))}};u([f({constructOnly:!0})],LF.prototype,"view",void 0),LF=u([L("esri.views.3d.state.SurfaceCollisionConstraint")],LF);let JO=class extends Ne{constructor(e){super(e),this.nearFarHeuristic=Kit(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([oe(()=>{var e,i,r,n;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(n=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),oe(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),oe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),xi),oe(()=>{var e,i,r,n;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(n=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),xi),oe(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),xi),oe(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),xi),oe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),xi),oe(()=>{var e,i,r,n,s,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),xi)]),this.view.state.isLocal&&this.addHandles(oe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Si)),this._updateNearFar(),this.view.state.viewingMode!==ct.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new LF({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>Hue(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?Hue(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,dz(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Xr.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==ct.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(Wt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(vo(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,n=3*i/Math.atan(r.camera.fov/2);n!==r.constraints.distance&&(r.constraints.distance=n)}_reapplyConstraints(e=Xr.ALL){this.view.state.updateCamera(i=>zn(this.view,i,new Yu(e,pi.NONE,null)))}};function Hue(t,e){e&&(t.near=e.near,t.far=e.far)}u([f({constructOnly:!0})],JO.prototype,"view",void 0),u([f({readOnly:!0})],JO.prototype,"surfaceCollisionConstraint",void 0),JO=u([L("esri.views.3d.state.ConstraintsManager")],JO);let JA=class extends Jg{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=sn.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||CTe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),sM(this.view,e,id.EYE_AND_CENTER)||this.constraintEnabled||(this.state=sn.Stopped)})}};u([f({constructOnly:!0})],JA.prototype,"desiredCamera",null),JA=u([L("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],JA);const ort=.66;function MMe(t){return 360-UU.normalize(t)}function Uz(t){return UU.normalize(360-t)}function $Me(t,e,i){const r=e.camera;if(r!=null)return art(r,Yv(t));const{targetGeometry:n}=e;if(n==null)return null;const{camera:s,mode:o}=AMe(t,e.rotation,i);if(n.type==="point")return crt(t,e,n,s,o);const a=n.extent;return a==null?null:JN(t,a,s.heading,s.tilt,o)}async function OMe(t,e,i,r){const n=e.camera;if(n!=null)return lrt(n,Yv(t),r);const{targetGeometry:s}=e;if(s==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=AMe(t,e.rotation,i);if(s.type==="point")return urt(t,e,s,o,a,r);const l=s.extent;if(l==null)throw new Error("Target geometry has no extent!");return h2e(t,l,o.heading,o.tilt,a,r)}function art(t,e){const i=t.position;let r;try{r=Ov(i,e)}catch{return null}if(!r)return null;const n=t.clone();return n.position=r.clone(),n}async function lrt(t,e,i){const r=t.position,n=await Av(r,e,{signal:i});zt(i);const s=t.clone();return s.position=n.clone(),s}function AMe(t,e,i){const r=sC(t,t.state.camera);let n=yo.ADJUST;return e!=null&&(r.heading=MMe(e),n=yo.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:n}}function crt(t,e,i,r,n){const s=t.spatialReference;let o;try{o=Ov(i.clone(),s)}catch{return null}if(!o)return null;const a=e.scale!=null?qR(t,e.scale):t.state.camera.distance;return nYe(t,o,a,r,n)}async function urt(t,e,i,r,n,s){const o=t.spatialReference,a=await Av(i.clone(),o,{signal:s});zt(s);const l=e.scale!=null?qR(t,e.scale):t.state.camera.distance;return mz(t,a,l,r,n,s)}function RMe(t,e,i=null){return i==null&&(i=new ef),Aee(t,null,e.clone(),i)}async function IMe(t,e,i){const r=wrt(t,e);if(!r)throw new Y("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new Hc({fov:t.camera.fov}),s=new ef({camera:n});if(r.target instanceof ef)return C1(await prt(t,r.target,r,i,s));if(r.target instanceof Hc)return C1(await LMe(t,r.target,i,s));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof pr){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return C1(o||c?await bZ(t,r,r.target.center,n,i,s):await yrt(t,r,r.target,n,i,s))}const a=new xrt,l=o?hrt(t,r):void 0;if(await PMe(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(vz(a.boundingBox,kn),Su.x=kn[0],Su.y=kn[1],Su.z=kn[2],Su.spatialReference=t.spatialReference,isFinite(Su.z)&&a.hasZ?c=nEe(a.boundingBox):(Su.z=void 0,c=uVe(rEe(a.boundingBox,Srt))),o||c)return C1(await bZ(t,r,Su,n,i,s));const h=brt(t,a.screenSpaceObjects);return C1(await vrt(t,r,Su,a.boundingBox,h,n,i,s))}return r.position?C1(await mrt(t,r,n,s,i)):C1(await grt(t,r,n,i,s))}function Oee(t,e){return e.scale==null&&e.zoom!=null?m2e(t,e.zoom):e.scale}function hrt(t,e){const i=Oee(t,e);return i?r7e(i):void 0}function zz(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=MMe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Aee(t,e,i,r){const n=t.spatialReference||nt.WGS84;if(e??(e=em(t,i)),e==null)return r;const s=new wt({spatialReference:n});return Tx(e.center,t.renderSpatialReference,s)&&(r.targetGeometry=s,r.scale=ex(t,e.distance),r.rotation=Uz(i.heading),r.camera=i),r}async function sk(t,e,i,r){var p;const n=()=>new Y("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw n();e.type==="mesh"&&(e=e.extent);const s=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let g;switch(e.type){case"point":g=e;break;case"multipoint":case"polyline":g=(p=e.extent)==null?void 0:p.center;break;case"extent":g=e.center;break;case"polygon":g=e.centroid}g!=null&&s&&t.elevationProvider?(g=await Av(g,s,{signal:r}),kn[2]=am(t.elevationProvider,g)??0):kn[2]=0}const o=Trt[e.type],a=new Array;if(o(e,e.hasZ?g=>{a.push([g[0],g[1],g[2]])}:g=>{a.push([g[0],g[1]])},kn),a.length===0)throw n();const l=e.spatialReference,c=t.spatialReference,h=await Av(new kC({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:a}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[g,y,w]of h.points)kn[0]=g,kn[1]=y,kn[2]=w,ix(i.boundingBox,kn);else for(const[g,y]of h.points)kn[0]=g,kn[1]=y,ix(i.boundingBox,kn)}async function drt(t,e,i,r,n){const s=await Xp(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void await sk(t,e.geometry,r,n);const o=s.value,a=await Xp(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await sk(t,e.geometry,r,n);const{screenSpaceObjects:l,boundingBox:c}=a.value;K2e(r.boundingBox,c),l&&l.forEach(h=>{r.screenSpaceObjects.push(h)}),isFinite(c[2])&&(r.hasZ=!0)}async function PMe(t,e,i,r,n){var s;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return Su.x=o,Su.y=a,Su.z=void 0,Su.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:nt.WGS84,void await sk(t,Su,r,n)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>PMe(t,o,i,r,n))):e instanceof jv?await sk(t,e,r,n):e instanceof qc&&await drt(t,e,i,r,n)}async function prt(t,e,i,r,n){if(e.camera)return LMe(t,e.camera,r,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,i.heading!=null?n.rotation=Uz(i.heading):i.rotation!=null&&(n.rotation=i.rotation);const s=Oee(t,i);return s!=null&&(n.scale=s),n.camera=await OMe(t,n,i.tilt,r),n}async function LMe(t,e,i,r){const n=t.spatialReference,s=await Av(e.position,n,{signal:i}),o=e.clone();return o.position=s,Aee(t,null,o,r)}async function frt(t,e,i,r,n,s,o){const a=t.renderSpatialReference;return await E5(e,Yj,a,0,{signal:o}),await E5(i,ZL,a,0,{signal:o}),s.targetGeometry=new wt(e),n.position=new wt(i),Ae(ok,Yj,ZL),J3(t,ZL,ok,r.up,n),s.scale=ex(t,Nr(ZL,Yj)),s.rotation=Uz(n.heading),s.camera=n,s}async function bZ(t,e,i,r,n,s){s.targetGeometry=i.clone();const o=Ex(t);if(e.position)return frt(t,s.targetGeometry,e.position,o,r,s,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ue(kn,o.viewForward,-l);o.eye=xe(kn,o.center,c),s.scale=ex(t,l)}sC(t,o,r);const a=zz(r,e)?yo.LOCKED:yo.ADJUST;if(!e.zoomFactor){const l=Oee(t,e);if(l==null){await E5(s.targetGeometry,kn,t.renderSpatialReference,0,{signal:n});const c=z5(o.frustum,kn)?Nr(o.eye,kn):o.distance;s.camera=await mz(t,s.targetGeometry,c,r,a),s.scale=ex(t,c)}else s.scale=l,s.camera=await rYe(t,s.targetGeometry,s.scale,r,a,n)}return s}async function mrt(t,e,i,r,n){const s=Ex(t);ye(ok,s.viewForward),J3(t,s.eye,ok,s.up,Xj);const o=t.spatialReference,{position:a}=e;if(a){const l=await Av(a,o,{signal:n});i.position=l}else i.position=new wt;return i.heading=e.heading!=null?e.heading:Xj.heading,i.tilt=e.tilt!=null?e.tilt:Xj.tilt,Aee(t,null,i,r)}async function grt(t,e,i,r,n){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const s=Ex(t),{spatialReference:o,renderSpatialReference:a}=t,l=new wt({spatialReference:o});return Tx(s.center,a,l)?bZ(t,e,l,i,r,n):n}return n.scale=t.scale,n.camera=t.camera.clone(),zz(n.camera,e),n}async function yrt(t,e,i,r,n,s){s.targetGeometry=i.clone();const o=Ex(t);sC(t,o,r);const a=zz(r,e)?yo.LOCKED:yo.ADJUST;return s.camera=await h2e(t,i,r.heading,r.tilt,a,n),s}function _rt(t,e,i,r,n){let s=0;i.z!=null?s=i.z:t.basemapTerrain&&t.elevationProvider&&(s=am(t.elevationProvider,i)),ve(kn,i.x,i.y,s),X3(t.spatialReference,kn,que,t.renderSpatialReference),qv(WL,que),wx(WL,WL),fd(M$);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let w=0;w<o.length;w++){const b=o[w];let x=r[b[2]];isFinite(x)||(x=s),ve(kn,r[b[0]],r[b[1]],x),tc(kn,t.spatialReference,kn,t.renderSpatialReference),ix(M$,Zl(kn,kn,WL))}const a=Cx(M$),l=Qv(M$),c=Mx(M$),h=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),g=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,y=.5*l*p+.5*Math.max(a,c);return Math.max(g,y)/n}async function vrt(t,e,i,r,n,s,o,a){a.targetGeometry=i.clone();const l=Ex(t),c=_rt(t,l,i,r,n);sC(t,l,s);const h=zz(s,e)?yo.LOCKED:yo.ADJUST;return a.camera=await mz(t,a.targetGeometry,c,s,h,o),a.scale=ex(t,c),a}function wrt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function C1(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=Uz(t.camera.heading)),t}function brt(t,e){const i=ort;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;r=Math.max(r,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return i-r/Math.min(t.width,t.height)*2}class xrt{constructor(){this.hasZ=!1,this.boundingBox=fd(),this.screenSpaceObjects=new Array}}const kn=A(),que=ut(),WL=In(),M$=bd(),Srt=Zi(),ok=A(),ZL=A(),Yj=A(),Xj={heading:0,tilt:0},Su=new wt,Trt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,n=t.hasZ;for(let s=0;s<r.length;s++)i[0]=r[s][0],i[1]=r[s][1],n&&(i[2]=r[s][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(ve(i,t.xmin,t.ymin,t.zmin)),e(ve(i,t.xmax,t.ymin,t.zmin)),e(ve(i,t.xmin,t.ymax,t.zmin)),e(ve(i,t.xmax,t.ymax,t.zmin)),e(ve(i,t.xmin,t.ymin,t.zmax)),e(ve(i,t.xmax,t.ymin,t.zmax)),e(ve(i,t.xmin,t.ymax,t.zmax)),e(ve(i,t.xmax,t.ymax,t.zmax))):(e(ve(i,t.xmin,t.ymin,i[2])),e(ve(i,t.xmax,t.ymin,i[2])),e(ve(i,t.xmin,t.ymax,i[2])),e(ve(i,t.xmax,t.ymax,i[2])))}},Ert=Object.freeze(Object.defineProperty({__proto__:null,create:IMe,fromCamera:RMe,toCameraAsync:OMe,toCameraSync:$Me},Symbol.toStringTag,{value:"Module"}));let Crt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;this._options.signal!=null&&_a(this._options.signal,()=>this.abort()),this._abortController=o,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController(),this._reject(ki())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await kE(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await IMe(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){var s;const i=!!(this._target instanceof ef&&this._target.camera||this._target instanceof Hc),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this._reject(new Y("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const n=em(this.view,r);return n==null?(this._reject(new Y("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new Y("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.running||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let n;e.isFullySpecified?(n=new JA({view:this.view,desiredCamera:e.camera}),sM(this.view,e.camera,id.EYE_AND_CENTER)):zn(this.view,e.camera),i.begin(e.camera,this._options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.running?Iue(a)&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===sn.Finished&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(i.state){case sn.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case sn.Ready:case sn.Rejected:case sn.Running:case sn.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(s,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return Iue(r)&&(r.updateStateFromViewAnimation(),r.running&&(e=r,i=e.viewAnimation)),e==null&&(e=new pb({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e),e.state===sn.Rejected)?(i==null||i.stop(),this._reject(new Y("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null):e}},Oy=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}getInner(e){return this._outer.get(e)}set(e,i,r){const n=this._outer.get(e);n?n.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}forAll(e){for(const i of this._outer.values())for(const r of i.values())e(r)}};var Jn;function Wue(t=!pe("disable-feature:high-quality-idle"),e=null){const i=new Oy;return t?(i.set(Di.IDLE,Jn.Antialiasing,e!=="low"),i.set(Di.IDLE,Jn.HighResolutionAtmosphere,e!=="low"),i.set(Di.IDLE,Jn.HighQualityTransparency,!0),i.set(Di.IDLE,Jn.SSAO,!0),i.set(Di.IDLE,Jn.WaterReflection,!0),i.set(Di.IDLE,Jn.PhysicalPixelRendering,!0)):(i.set(Di.ANIMATING,Jn.HighResolutionShadows,!0),i.set(Di.ANIMATING,Jn.HighResolutionViewshed,!0),i.set(Di.INTERACTING,Jn.HighResolutionShadows,!0),i.set(Di.INTERACTING,Jn.HighResolutionViewshed,!0)),i.set(Di.IDLE,Jn.HighResolutionShadows,!0),i.set(Di.IDLE,Jn.HighResolutionViewshed,!0),i.set(Di.IDLE,Jn.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.HighResolutionViewshed=7]="HighResolutionViewshed",t[t.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(Jn||(Jn={}));let Wn=class extends Ne{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Zue,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Zue:0}},this._propertiesPool=new Sy({frustum:B5},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new Mrt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Vo(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),oe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),xi)]),Kl(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([Ub({prepare:()=>this._prepareFrame()}),oe(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(XL)}),Vo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Ye(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=sC(this.view,this.view.state.camera,Jj);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableCache(!0),this.setStateCamera(em(this.view,e),{applyConstraints:!1})||de.getLogger(this).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=sC(this.view,this.view.state.contentCamera,Jj);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=em(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(Qj),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,n=FR(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([oe(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(Qj),this.test.contentCameraResetState.clear())}),oe(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),oe(()=>this.view.state.camera,o=>{const a=to(n,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],Qj),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():de.getLogger(this).error("#center=","Invalid center",e):de.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):de.getLogger(this).error("#center=","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){const e=this._get("extent");return e?Qp.fromExtent(e):null}return lYe(this.view,this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=d2e(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||de.getLogger(this).error("#extent=","Invalid extent",e):de.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):de.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var i;const e=this.view.map;return e&&"initialViewProperties"in e?(i=e.initialViewProperties)==null?void 0:i.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");const e=this.view.basemapTerrain.tilingScheme,i=this.view.pointsOfInterest.cameraOnSurface.scale;return e&&i?KTe(this.view,i,this.view.state.contentCamera,e):this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||de.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,n=this._get("padding"),s=Math.round(i[yi.TOP]/r),o=Math.round(i[yi.RIGHT]/r),a=Math.round(i[yi.BOTTOM]/r),l=Math.round(i[yi.LEFT]/r);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,YL),this.view.state.updateCamera(i=>i.padding=YL))}_paddingToArray(e,i,r){e?_n(r,e.top||0,e.right||0,e.bottom||0,e.left||0):_n(r,0,0,0,0);for(let n=0;n<4;n++)r[n]=Math.round(r[n]*i)}get screenCenter(){const e=this.padding;return ju((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?RMe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||de.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,n=r!=null&&r.spatialReference;de.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else de.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?pYe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||de.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){var n;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=(n=this.view._stage.renderView.renderingContext)==null?void 0:n.parameters.maxTextureSize;return r&&hb(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(Jn.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(Jn.PhysicalPixelRendering,Di.IDLE)||e.isFeatureEnabled(Jn.PhysicalPixelRendering,Di.INTERACTING)||e.isFeatureEnabled(Jn.PhysicalPixelRendering,Di.ANIMATING))}preinit(e){var i,r,n;return!(this._isOverridden("center")&&!Zw(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!Zw(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!Zw(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||Zw((i=this.viewpoint.targetGeometry)==null?void 0:i.spatialReference,e)&&Zw((n=(r=this.viewpoint.camera)==null?void 0:r.position)==null?void 0:n.spatialReference,e))}init(){this._constraintsManager=new JO({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===ct.Local&&this.addHandles(Kl(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(XL),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),XL)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(XL),this._constraintsManager=Ye(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new Crt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(Ex(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(n=>r.stepController(e,n)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:n}of Ort){const s=e.has(r),o=this._isOverridden(r);!s&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||o)&&n.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Hc)return void this.setStateCamera(em(this.view,e),{applyConstraints:!1});if(e instanceof ef){if(e.targetGeometry instanceof pr){const s=JN(this.view,e.targetGeometry,0,.5,yo.LOCKED);return void(s!=null&&this.setStateCamera(em(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,r)}const i=JN(this.view,e,0,.5,yo.LOCKED);i!=null&&this.setStateCamera(em(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&$rt.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof ef?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Hc?this.isCompatible(e.position):e.spatialReference&&!Zbe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Art){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=D0){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=WR(this.view,n,s,e,i,yo.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){let i;if(e.hasZ)i=this.view.state.camera.distance;else{const{centerOnContent:r}=this.view.pointsOfInterest;r.runTask(),i=r.distance}return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),n=JN(this.view,e,i,r,yo.ADJUST,Jj);return n?em(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const i=this.view,r=i.pointsOfInterest.centerOnContent;r.runTask();const n=r.renderLocation,s=i.pointsOfInterest.cameraOnSurface.renderLocation,o=iYe(i,e,i.state.contentCamera,n,s);return this._centerPointAtDistanceToCamera(n,o)}_zoomToCamera(e){return this._scaleToCamera(m2e(this.view,e))}_viewpointToCamera(e){return em(this.view,$Me(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&zn(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new JA({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===r.width&&n.fullHeight===r.height&&n.pixelRatio===r.pixelRatio||(D0.copyFrom(n),D0.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,YL),D0.padding=YL),D0.fullWidth=r.width,D0.fullHeight=r.height,D0.pixelRatio=r.pixelRatio,this.view.state.camera=D0),this._updateViewState()}}_updateElevation(e){var s,o;const i=(s=this.view.basemapTerrain)==null?void 0:s.spatialReference,r=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,n=i?dz(this.view,e.eye):0;e.relativeElevation=r-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Di.ANIMATING:this.view.interacting?this.view.state.mode=Di.INTERACTING:(this.view.state.mode===Di.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Di.INTERACTING:this.view.state.mode=Di.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([f({type:Hc,dependsOn:["view.state.camera","ready"]})],Wn.prototype,"camera",null),u([f({type:Hc,dependsOn:["view.state.contentCamera","ready"]})],Wn.prototype,"contentCamera",null),u([f({type:wt})],Wn.prototype,"center",null),u([f()],Wn.prototype,"visibleArea",null),u([f({type:pr})],Wn.prototype,"extent",null),u([f({readOnly:!0})],Wn.prototype,"frustum",null),u([f()],Wn.prototype,"_constraintsManager",void 0),u([f({readOnly:!0})],Wn.prototype,"constraintsManager",null),u([f()],Wn.prototype,"_initialViewpoint",null),u([f({readOnly:!0})],Wn.prototype,"hasInitialView",null),u([f({readOnly:!0,type:Boolean})],Wn.prototype,"ready",void 0),u([f({type:Number})],Wn.prototype,"scale",null),u([f()],Wn.prototype,"padding",null),u([f({readOnly:!0})],Wn.prototype,"screenCenter",null),u([f({constructOnly:!0})],Wn.prototype,"view",void 0),u([f({type:ef})],Wn.prototype,"viewpoint",null),u([f({type:Number})],Wn.prototype,"zoom",null),u([f({readOnly:!0})],Wn.prototype,"_rasterPixelRatio",null),u([f({readOnly:!0})],Wn.prototype,"_usePhysicalPixelRendering",null),u([f({readOnly:!0})],Wn.prototype,"_usePhysicalPixelRenderingAny",null),u([f()],Wn.prototype,"_windowDevicePixelRatio",void 0),u([f()],Wn.prototype,"_devicePixelRatioOverride",void 0),Wn=u([L("esri.views.3d.state.ViewStateManager")],Wn);let Mrt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const $rt=new Set(["camera","viewpoint","extent","scale","center","zoom"]),Ort=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Art={heading:0,tilt:0},Jj=new Hc,D0=new Jr,YL=Ti(),XL="pending-initial-view",Qj="content-camera-reset",Zue=300,Yue=100;let Np=class extends Jg{constructor(){super(...arguments),this.startCamera=new Jr,this.currentCamera=new Jr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Yue}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=sn.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Yue),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([f({readOnly:!0})],Np.prototype,"isInteractive",null),u([f()],Np.prototype,"_lastInteraction",void 0),Np=u([L("esri.views.3d.state.controllers.InteractiveController")],Np);var $c;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})($c||($c={}));let QA=class extends Np{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=$c.CENTER,this._rotScale=0,this._lastPoint=Yt(),this._tmpWorldUp=A(),this._tmpViewDir=A(),this._tmpRotCurPoint=Yt(),this._tmpTransf=ut(),this._tmpAxis=A(),this._tmpPivotPoint=A(),this._pivotPos=A(),this._constraintOptions=new Yu(Xr.ALL,pi.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===$c.CENTER?3:1.5}begin(e){if(this.running){switch(this.pivot){case $c.EYE:ye(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=pi.LOOK_AROUND,this._constraintOptions.tiltMode=Em.LOOK_AROUND,this._constraintOptions.selection=Xr.NONE;break;case $c.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Nx:{});i||ye(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=pi.TUMBLE,this._constraintOptions.tiltMode=Em.TUMBLE,this._constraintOptions.selection=Xr.ALL&~Xr.DISTANCE;break}}Ib(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,n=A();Ae(n,this._pivotPos,r.eye);const s=Fe(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Xue);let a=Math.max(Math.min(Dit,1/Math.abs(Te(Xue,r.viewForward)))*o,Nit);i&&(a=Math.min(s,a));const l=ds(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=oI(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let h=this.view._stage.renderView.getMinimalDepthForArea(s3(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*Bj,Bj),p=this.view._stage.renderView.getMinimalDepthForArea(s3(this.view),e[0],e[1],r,Bj);h==null&&p==null||(h=h??p??0,p=p==null||c===ma.Horizontal?h:p,a=h>p?p:h,a=i?Math.min(a,s):a),Me(n,n),ye(this._pivotPos,xe(this._tmpPivotPoint,r.eye,ue(this._tmpPivotPoint,n,a)))}update(e){if(this.running){switch(this.pivot){case $c.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case $c.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}zn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(e,i,r,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),Ib(e,i,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Ae(this._tmpViewDir,r,n);const a=Fe(this._tmpViewDir),l=Ga(Te(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===$c.EYE){s*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;s=c-Math.max(-h,Math.min(h,c+s))}return s=Oe(s+l,ca.min,ca.max)-l,Ot(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===$c.CENTER&&(o=-o),dd(this._tmpTransf,o,this._tmpWorldUp),Lu(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Mt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Mt(Kj,e.up,this._tmpTransf),xe(Kj,n,this._tmpViewDir),Ha(this._lastPoint,this._tmpRotCurPoint),Kj}};u([f()],QA.prototype,"pivot",void 0),QA=u([L("esri.views.3d.state.controllers.RotateController")],QA);const Kj=A(),Xue=A();let eG=class extends qo{constructor(e,i,r,n){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Mee(e.data,this.pointerAction))return;const r=ds(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new QA({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Rrt(t){return t&&"nodeType"in t}function Irt(t){return t&&typeof t.render=="function"}const Jue={component:"esri-component"};let Ew=class extends Ne{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,i;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((i=this.node)==null?void 0:i.id)}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(Jue.component),i&&i.classList.remove(Jue.component),this._set("node",e))}castNode(e){var i;return(i=this.widget)==null||i.destroy(),e?typeof e=="string"||Rrt(e)?(this._set("widget",null),HU(e)):(Irt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([f()],Ew.prototype,"id",null),u([f()],Ew.prototype,"node",null),u([$i("node")],Ew.prototype,"castNode",null),u([f({readOnly:!0})],Ew.prototype,"widget",void 0),Ew=u([L("esri.views.ui.Component")],Ew);const KA=Ew;var o3;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(o3||(o3={}));function Prt(t,e){return{type:zb(e),value:t,unit:e}}function NFt(t){return{value:t}}function Lrt(t,e){return{type:zb(e),value:t,unit:e}}function Drt(t,e){return{type:zb(e),value:t,unit:e}}function Vz(t,e,i="arithmetic"){return{type:zb(e),value:t,unit:e,rotationType:i}}function FFt(t,e){const i=Nrt(t,e);return t.type==="angle"?Vz(i,e,t.rotationType):Prt(i,e)}function Nrt(t,e){return Zr(t.value,t.unit,e)}function kFt(t,e){return t==null?e:e==null||t.value>Zr(e.value,e.unit,t.unit)?t:e}function UFt(t,e){return t==null?null:{...t,value:t.value*e}}function Frt(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const zFt=Lrt(0,"meters"),VFt=Drt(0,"square-meters");Vz(0,"radians");const BFt=Vz(0,"degrees"),jFt=Vz(0,"degrees","geographic");function DMe(t,e,i){return t.units[e][i]}function Fx(t,e,i,r=2,n="abbr"){return`${W3(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${DMe(t,i,n)}`}function Bz(t,e,i,r=2,n="abbr"){return`${W3(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${DMe(t,i,n)}`}function GFt(t,e,i,r=2,n="abbr"){const s=UJ(e,i);return Fx(t,Zr(e,i,s),s,r,n)}function HFt(t,e,i,r=2,n="abbr"){const s=UJ(e,i);return Bz(t,Zr(e,i,s),s,r,n)}function qFt(t,e,i,r=2,n="abbr"){const s=zJ(e,i);return Fx(t,Zr(e,i,s),s,r,n)}function WFt(t,e,i,r=2,n="abbr"){const s=zJ(e,i);return Bz(t,Zr(e,i,s),s,r,n)}function ZFt(t,e,i,r=2,n="abbr"){const s=VJ(e,i);return Fx(t,Zr(e,i,s),s,r,n)}function YFt(t,e,i,r=2,n="abbr"){const s=VJ(e,i);return Bz(t,Zr(e,i,s),s,r,n)}function XFt(t,e,i,r=2,n="abbr"){const s=BJ(e,i);return Fx(t,Zr(e,i,s),s,r,n)}function JFt(t,e,i,r=2,n="abbr"){const s=BJ(e,i);return Bz(t,Zr(e,i,s),s,r,n)}function QFt(t,e,i,r=2,n="abbr"){const s=mke(e,i);return Fx(t,Zr(e,i,s),s,r,n)}function KFt(t,e,i,r=2,n="abbr"){const s=gke(e,i);return Fx(t,Zr(e,i,s),s,r,n)}const krt=(t,e)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:e,minimumFractionDigits:e,signDisplay:t>0?"never":"exceptZero"});function Urt(t,e,i,r,n,s=UU,o=!0){let a=s.normalize(Frt(Zr(t,e,"degrees"),i,r),0,o);const l=krt(a,n??2);return a=zrt(a,l),W3(a,l)}const Que=new Map;function zrt(t,e){const i=JSON.stringify(e);let r=Que.get(i);return r||(r=new Intl.NumberFormat("en-US",e),Que.set(i,r)),/^[-+]?360\.?0*?$/.test(r.format(t))?0:t}const Kue=["B","kB","MB","GB","TB"];function e4t(t,e){let i=(e=Math.round(e))===0?0:Math.floor(Math.log(e)/Math.log(o3.KILOBYTES));i=Oe(i,0,Kue.length-1);const r=W3(e/o3.KILOBYTES**i,{maximumFractionDigits:2});return rU(t.units.bytes[Kue[i]],{fileSize:r})}const Vrt={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},Brt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},jrt=t=>({...Brt,...t}),Grt=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},Hrt=(t,e)=>t.find(e),ehe=(t,e,i=!1)=>{let r=t;return e.forEach((n,s)=>{const o=r!=null&&r.children?Hrt(r.children,a=>a.domNode===n):void 0;i&&!o&&s!==e.length-1||(r=o)}),r},qrt=t=>{let e;const i={...Vrt,...t},r=jrt(i),n=r.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],h=(g,y,w)=>{var T;let b;r.eventHandlerInterceptor=(M,$,R,I)=>function(P){let N;n("domEvent",P);const V=Grt(P.currentTarget,b.domNode),U=V.some(W=>{var j;return customElements.get((j=W==null?void 0:W.tagName)==null?void 0:j.toLowerCase())});if(P.eventPhase===Event.CAPTURING_PHASE||!U)V.reverse(),N=ehe(b.getLastRender(),V);else{const W=P.composedPath(),j=W.slice(W.indexOf(P.currentTarget),W.indexOf(b.domNode)).reverse();N=ehe(b.getLastRender(),j,!0)}let B;return N&&(B=i.handleInterceptedEvent(e,N,this,P)),n("domEventProcessed",P),B},(T=i.postProcessProjectionOptions)==null||T.call(i,r);const x=w();b=g(y,x,r),r.eventHandlerInterceptor=void 0,l.push(b),c.push(w),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(b,x)};let p=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let g=0;g<l.length;g++){const y=c[g]();n("rendered",void 0);try{l[g].update(y)}catch(w){console.error(w)}n("patched",void 0)}n("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{s||a||(s=requestAnimationFrame(p))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(g,y)=>{h(X_.append,g,y)},insertBefore:(g,y)=>{h(X_.insertBefore,g,y)},merge:(g,y)=>{h(X_.merge,g,y)},replace:(g,y)=>{h(X_.replace,g,y)},detach:g=>{for(let y=0;y<c.length;y++)if(c[y]===g)return c.splice(y,1),l.splice(y,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.13.2
 */const NMe="calcite-mode-auto",FMe="calcite-mode-dark",Wrt="calcite-mode-light",t4t={autoMode:NMe,darkMode:FMe,lightMode:Wrt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},i4t={filter:250,nextTick:0,resize:150,reposition:100};var Yh={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},Zrt=Object.defineProperty,Yrt=(t,e)=>{for(var i in e)Zrt(t,i,{get:e[i],enumerable:!0})},kMe=new WeakMap,kx=t=>kMe.get(t),Xrt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return kMe.set(t,i)},the=(t,e)=>e in t,aI=(t,e)=>(0,console.error)(t,e),ak=new Map,Jrt=[],Qrt="slot-fb{display:contents}slot-fb[hidden]{display:none}",ihe="http://www.w3.org/1999/xlink",lI=typeof window<"u"?window:{},Hp=lI.document||{head:{}},r4t=lI.HTMLElement||class{},ba={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},Krt=(()=>{let t=!1;try{Hp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),ent=t=>Promise.resolve(t),tnt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),xZ=!1,SZ=[],UMe=[],zMe=(t,e)=>i=>{t.push(i),xZ||(xZ=!0,e&&ba.$flags$&4?int(TZ):ba.raf(TZ))},rhe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){aI(i)}t.length=0},TZ=()=>{rhe(SZ),rhe(UMe),(xZ=SZ.length>0)&&ba.raf(TZ)},int=t=>ent().then(t),n4t=zMe(SZ,!1),rnt=zMe(UMe,!0),nnt=t=>{const e=new URL(t,ba.$resourcesUrl$);return e.origin!==lI.location.origin?e.href:e.pathname},snt=t=>ba.$resourcesUrl$=t,nhe={},ont="http://www.w3.org/2000/svg",ant="http://www.w3.org/1999/xhtml",lnt=t=>t!=null,Ree=t=>(t=typeof t,t==="object"||t==="function");function cnt(t){var e,i,r;return(r=(i=(e=t.head)==null?void 0:e.querySelector('meta[name="csp-nonce"]'))==null?void 0:i.getAttribute("content"))!=null?r:void 0}var unt={};Yrt(unt,{err:()=>VMe,map:()=>hnt,ok:()=>EZ,unwrap:()=>dnt,unwrapErr:()=>pnt});var EZ=t=>({isOk:!0,isErr:!1,value:t}),VMe=t=>({isOk:!1,isErr:!0,value:t});function hnt(t,e){if(t.isOk){const i=e(t.value);return i instanceof Promise?i.then(r=>EZ(r)):EZ(i)}if(t.isErr){const i=t.value;return VMe(i)}throw"should never get here"}var dnt=t=>{if(t.isOk)return t.value;throw t.value},pnt=t=>{if(t.isErr)return t.value;throw t.value},ax=(t,e="")=>()=>{},BMe=(t,e,...i)=>{let r=null,n=null,s=null,o=!1,a=!1;const l=[],c=p=>{for(let g=0;g<p.length;g++)r=p[g],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!Ree(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?lk(null,r):r),a=o)};if(c(i),e){e.key&&(n=e.key),e.name&&(s=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(g=>p[g]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,gnt);const h=lk(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=n,h.$name$=s,h},lk=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},fnt={},mnt=t=>t&&t.$tag$===fnt,gnt={forEach:(t,e)=>t.map(she).forEach(e),map:(t,e)=>t.map(she).map(e).map(ynt)},she=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),ynt=t=>{if(typeof t.vtag=="function"){const i={...t.vattrs};return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),BMe(t.vtag,i,...t.vchildren||[])}const e=lk(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},_nt=t=>Jrt.map(e=>e(t)).find(e=>!!e),vnt=(t,e)=>t!=null&&!Ree(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,wnt=t=>t,s4t=(t,e,i)=>{const r=wnt(t);return{emit:n=>bnt(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:n})}},bnt=(t,e,i)=>{const r=ba.ce(e,i);return t.dispatchEvent(r),r},ohe=new WeakMap,xnt=(t,e,i)=>{let r=ak.get(t);tnt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,ak.set(t,r)},Snt=(t,e,i)=>{var r;const n=jMe(e,i),s=ak.get(n);if(t=t.nodeType===11?t:Hp,s)if(typeof s=="string"){t=t.head||t;let o=ohe.get(t),a;if(o||ohe.set(t,o=new Set),!o.has(n)){{a=Hp.createElement("style"),a.innerHTML=s;const l=(r=ba.$nonce$)!=null?r:cnt(Hp);l!=null&&a.setAttribute("nonce",l),(!(e.$flags$&1)||e.$flags$&1&&t.nodeName!=="HEAD")&&t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=Qrt),o&&o.add(n)}}else t.adoptedStyleSheets.includes(s)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,s]);return n},Tnt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,n=ax("attachStyles",e.$tagName$),s=Snt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&r&2&&(i["s-sc"]=s,i.classList.add(s+"-h"),r&2&&i.classList.add(s+"-s")),n()},jMe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),ahe=(t,e,i,r,n,s)=>{if(i!==r){let o=the(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=lhe(i),h=lhe(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):the(lI,a)?e=a.slice(2):e=a[2]+e.slice(3),i||r){const l=e.endsWith(GMe);e=e.replace(Cnt,""),i&&ba.rel(t,e,i,l),r&&ba.ael(t,e,r,l)}}else{const l=Ree(r);if((o||l&&r!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=r;else{const h=r??"";e==="list"?o=!1:(i==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(ihe,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(ihe,e,r):t.setAttribute(e,r))}}},Ent=/\s/,lhe=t=>t?t.split(Ent):[],GMe="Capture",Cnt=new RegExp(GMe+"$"),HMe=(t,e,i)=>{const r=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||nhe,s=e.$attrs$||nhe;for(const o of che(Object.keys(n)))o in s||ahe(r,o,n[o],void 0,i,e.$flags$);for(const o of che(Object.keys(s)))ahe(r,o,n[o],s[o],i,e.$flags$)};function che(t){return t.includes("ref")?[...t.filter(e=>e!=="ref"),"ref"]:t}var DT,CZ,mC,ck=!1,uk=!1,Iee=!1,Tu=!1,hk=(t,e,i,r)=>{var n;const s=e.$children$[i];let o=0,a,l,c;if(ck||(Iee=!0,s.$tag$==="slot"&&(DT&&r.classList.add(DT+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)a=s.$elm$=Hp.createTextNode(s.$text$);else if(s.$flags$&1)a=s.$elm$=Hp.createTextNode("");else{if(Tu||(Tu=s.$tag$==="svg"),a=s.$elm$=Hp.createElementNS(Tu?ont:ant,!ck&&Yh.slotRelocation&&s.$flags$&2?"slot-fb":s.$tag$),Tu&&s.$tag$==="foreignObject"&&(Tu=!1),HMe(null,s,Tu),!!a.getRootNode().querySelector("body")&&Yh.scoped&&lnt(DT)&&a["s-si"]!==DT&&a.classList.add(a["s-si"]=DT),Lee(a,r),s.$children$)for(o=0;o<s.$children$.length;++o)l=hk(t,s,o,a),l&&a.appendChild(l);s.$tag$==="svg"?Tu=!1:a.tagName==="foreignObject"&&(Tu=!0)}return a["s-hn"]=mC,s.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=CZ,a["s-sn"]=s.$name$||"",a["s-rf"]=(n=s.$attrs$)==null?void 0:n.ref,c=t&&t.$children$&&t.$children$[i],c&&c.$tag$===s.$tag$&&t.$elm$&&a3(t.$elm$,!1)),a},a3=(t,e)=>{ba.$flags$|=1;const i=Array.from(t.childNodes);if(t["s-sr"]&&Yh.experimentalSlotFixes){let r=t;for(;r=r.nextSibling;)r&&r["s-sn"]===t["s-sn"]&&r["s-sh"]===mC&&i.push(r)}for(let r=i.length-1;r>=0;r--){const n=i[r];n["s-hn"]!==mC&&n["s-ol"]&&(mv(ZMe(n),n,Pee(n)),n["s-ol"].remove(),n["s-ol"]=void 0,n["s-sh"]=void 0,Iee=!0),e&&a3(n,e)}ba.$flags$&=-2},qMe=(t,e,i,r,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===mC&&(o=o.shadowRoot);n<=s;++n)r[n]&&(a=hk(null,i,n,t),a&&(r[n].$elm$=a,mv(o,a,Pee(e))))},WMe=(t,e,i)=>{for(let r=e;r<=i;++r){const n=t[r];if(n){const s=n.$elm$;JMe(n),s&&(uk=!0,s["s-ol"]?s["s-ol"].remove():a3(s,!0),s.remove())}}},Mnt=(t,e,i,r,n=!1)=>{let s=0,o=0,a=0,l=0,c=e.length-1,h=e[0],p=e[c],g=r.length-1,y=r[0],w=r[g],b,x;for(;s<=c&&o<=g;)if(h==null)h=e[++s];else if(p==null)p=e[--c];else if(y==null)y=r[++o];else if(w==null)w=r[--g];else if(JL(h,y,n))NT(h,y,n),h=e[++s],y=r[++o];else if(JL(p,w,n))NT(p,w,n),p=e[--c],w=r[--g];else if(JL(h,w,n))(h.$tag$==="slot"||w.$tag$==="slot")&&a3(h.$elm$.parentNode,!1),NT(h,w,n),mv(t,h.$elm$,p.$elm$.nextSibling),h=e[++s],w=r[--g];else if(JL(p,y,n))(h.$tag$==="slot"||w.$tag$==="slot")&&a3(p.$elm$.parentNode,!1),NT(p,y,n),mv(t,p.$elm$,h.$elm$),p=e[--c],y=r[++o];else{for(a=-1,l=s;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===y.$key$){a=l;break}a>=0?(x=e[a],x.$tag$!==y.$tag$?b=hk(e&&e[o],i,a,t):(NT(x,y,n),e[a]=void 0,b=x.$elm$),y=r[++o]):(b=hk(e&&e[o],i,o,t),y=r[++o]),b&&mv(ZMe(h.$elm$),b,Pee(h.$elm$))}s>c?qMe(t,r[g+1]==null?null:r[g+1].$elm$,i,r,o,g):o>g&&WMe(e,s,c)},JL=(t,e,i=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?"$nodeId$"in t&&i&&t.$elm$.nodeType!==8?!1:t.$name$===e.$name$:i?!0:t.$key$===e.$key$:!1,Pee=t=>t&&t["s-ol"]||t,ZMe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,NT=(t,e,i=!1)=>{const r=e.$elm$=t.$elm$,n=t.$children$,s=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(Tu=o==="svg"?!0:o==="foreignObject"?!1:Tu,o==="slot"&&!ck||HMe(t,e,Tu),n!==null&&s!==null?Mnt(r,n,e,s,i):s!==null?(t.$text$!==null&&(r.textContent=""),qMe(r,null,e,s,0,s.length-1)):!i&&Yh.updatable&&n!==null&&WMe(n,0,n.length-1),Tu&&o==="svg"&&(Tu=!1)):(l=r["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(r.data=a)},YMe=t=>{const e=t.childNodes;for(const i of e)if(i.nodeType===1){if(i["s-sr"]){const r=i["s-sn"];i.hidden=!1;for(const n of e)if(n!==i){if(n["s-hn"]!==i["s-hn"]||r!==""){if(n.nodeType===1&&(r===n.getAttribute("slot")||r===n["s-sn"])||n.nodeType===3&&r===n["s-sn"]){i.hidden=!0;break}}else if(n.nodeType===1||n.nodeType===3&&n.textContent.trim()!==""){i.hidden=!0;break}}}YMe(i)}},Qg=[],XMe=t=>{let e,i,r;for(const n of t.childNodes){if(n["s-sr"]&&(e=n["s-cr"])&&e.parentNode){i=e.parentNode.childNodes;const s=n["s-sn"];for(r=i.length-1;r>=0;r--)if(e=i[r],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==n["s-hn"]&&!Yh.experimentalSlotFixes)if(uhe(e,s)){let o=Qg.find(a=>a.$nodeToRelocate$===e);uk=!0,e["s-sn"]=e["s-sn"]||s,o?(o.$nodeToRelocate$["s-sh"]=n["s-hn"],o.$slotRefNode$=n):(e["s-sh"]=n["s-hn"],Qg.push({$slotRefNode$:n,$nodeToRelocate$:e})),e["s-sr"]&&Qg.map(a=>{uhe(a.$nodeToRelocate$,e["s-sn"])&&(o=Qg.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else Qg.some(o=>o.$nodeToRelocate$===e)||Qg.push({$nodeToRelocate$:e})}n.nodeType===1&&XMe(n)}},uhe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",JMe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(JMe)},mv=(t,e,i)=>{const r=t==null?void 0:t.insertBefore(e,i);return Lee(e,t),r},QMe=t=>{const e=[];return t&&e.push(...t["s-scs"]||[],t["s-si"],t["s-sc"],...QMe(t.parentElement)),e},Lee=(t,e,i=!1)=>{var r;if(t&&e&&t.nodeType===1){const n=new Set(QMe(e).filter(Boolean));if(n.size&&((r=t.classList)==null||r.add(...t["s-scs"]=[...n]),t["s-ol"]||i))for(const s of Array.from(t.childNodes))Lee(s,t,!0)}},$nt=(t,e,i=!1)=>{var r,n,s,o,a;const l=t.$hostElement$,c=t.$cmpMeta$,h=t.$vnode$||lk(null,null),p=mnt(e)?e:BMe(null,null,e);if(mC=l.tagName,c.$attrsToReflect$&&(p.$attrs$=p.$attrs$||{},c.$attrsToReflect$.map(([g,y])=>p.$attrs$[y]=l[g])),i&&p.$attrs$)for(const g of Object.keys(p.$attrs$))l.hasAttribute(g)&&!["key","ref","style","class"].includes(g)&&(p.$attrs$[g]=l[g]);p.$tag$=null,p.$flags$|=4,t.$vnode$=p,p.$elm$=h.$elm$=l.shadowRoot||l,DT=l["s-sc"],ck=(c.$flags$&1)!==0,CZ=l["s-cr"],uk=!1,NT(h,p,i);{if(ba.$flags$|=1,Iee){XMe(p.$elm$);for(const g of Qg){const y=g.$nodeToRelocate$;if(!y["s-ol"]){const w=Hp.createTextNode("");w["s-nr"]=y,mv(y.parentNode,y["s-ol"]=w,y)}}for(const g of Qg){const y=g.$nodeToRelocate$,w=g.$slotRefNode$;if(w){const b=w.parentNode;let x=w.nextSibling;{let T=(r=y["s-ol"])==null?void 0:r.previousSibling;for(;T;){let M=(n=T["s-nr"])!=null?n:null;if(M&&M["s-sn"]===y["s-sn"]&&b===M.parentNode){for(M=M.nextSibling;M===y||M!=null&&M["s-sr"];)M=M==null?void 0:M.nextSibling;if(!M||!M["s-nr"]){x=M;break}}T=T.previousSibling}}(!x&&b!==y.parentNode||y.nextSibling!==x)&&y!==x&&(!y["s-hn"]&&y["s-ol"]&&(y["s-hn"]=y["s-ol"].parentNode.nodeName),mv(b,y,x),y.nodeType===1&&(y.hidden=(s=y["s-ih"])!=null?s:!1)),y&&typeof w["s-rf"]=="function"&&w["s-rf"](y)}else y.nodeType===1&&(i&&(y["s-ih"]=(o=y.hidden)!=null?o:!1),y.hidden=!0)}}uk&&YMe(p.$elm$),ba.$flags$&=-2,Qg.length=0}if(Yh.experimentalScopedSlotChanges&&c.$flags$&2)for(const g of p.$elm$.childNodes)g["s-hn"]!==mC&&!g["s-sh"]&&(i&&g["s-ih"]==null&&(g["s-ih"]=(a=g.hidden)!=null?a:!1),g.hidden=!0);CZ=void 0},Ont=(t,e)=>{},Dee=(t,e)=>(t.$flags$|=16,Ont(t,t.$ancestorComponent$),rnt(()=>Ant(t,e))),Ant=(t,e)=>{const i=t.$hostElement$,r=ax("scheduleUpdate",t.$cmpMeta$.$tagName$),n=i;if(!n)throw new Error(`Can't render component <${i.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let s;return e?s=dE(n,"componentWillLoad"):s=dE(n,"componentWillUpdate"),s=hhe(s,()=>dE(n,"componentWillRender")),r(),hhe(s,()=>Int(t,n,e))},hhe=(t,e)=>Rnt(t)?t.then(e).catch(i=>{console.error(i),e()}):e(),Rnt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",Int=async(t,e,i)=>{const r=t.$hostElement$,n=ax("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&Tnt(t);const s=ax("render",t.$cmpMeta$.$tagName$);Pnt(t,e,r,i),s(),n(),Lnt(t)},dhe=null,Pnt=(t,e,i,r)=>{try{dhe=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(Yh.hasRenderFn||Yh.reflect)&&(Yh.vdomRender||Yh.reflect)&&(Yh.hydrateServerSide||$nt(t,e,r))}catch(l){aI(l,t.$hostElement$)}return dhe=null,null},Lnt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=ax("postUpdate",e),n=i;t.$ancestorComponent$,dE(n,"componentDidRender"),t.$flags$&64?(dE(n,"componentDidUpdate"),r()):(t.$flags$|=64,dE(n,"componentDidLoad"),r())},o4t=t=>{{const e=kx(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&Dee(e,!1),i}},dE=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){aI(r)}},Dnt=(t,e)=>kx(t).$instanceValues$.get(e),Nnt=(t,e,i,r)=>{const n=kx(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;i=vnt(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){n.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[e];p&&p.map(g=>{try{l[g](i,o,e)}catch(y){aI(y,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;Dee(n,!1)}}}},Fnt=(t,e,i)=>{var r,n;const s=t.prototype;if(e.$members$||e.$watchers$||t.watchers){t.watchers&&!e.$watchers$&&(e.$watchers$=t.watchers);const o=Object.entries((r=e.$members$)!=null?r:{});o.map(([a,[l]])=>{(l&31||l&32)&&Object.defineProperty(s,a,{get(){return Dnt(this,a)},set(c){Nnt(this,a,c,e)},configurable:!0,enumerable:!0})});{const a=new Map;s.attributeChangedCallback=function(l,c,h){ba.jmp(()=>{var p;const g=a.get(l);if(this.hasOwnProperty(g))h=this[g],delete this[g];else{if(s.hasOwnProperty(g)&&typeof this[g]=="number"&&this[g]==h)return;if(g==null){const y=kx(this),w=y==null?void 0:y.$flags$;if(w&&!(w&8)&&w&128&&h!==c){const x=this,T=(p=e.$watchers$)==null?void 0:p[l];T==null||T.forEach(M=>{x[M]!=null&&x[M].call(x,h,c,l)})}return}}this[g]=h===null&&typeof this[g]=="boolean"?!1:h})},t.observedAttributes=Array.from(new Set([...Object.keys((n=e.$watchers$)!=null?n:{}),...o.filter(([l,c])=>c[0]&15).map(([l,c])=>{var h;const p=c[1]||l;return a.set(p,l),c[0]&512&&((h=e.$attrsToReflect$)==null||h.push([l,p])),p})]))}}return t},knt=async(t,e,i,r)=>{let n;if(!(e.$flags$&32)){e.$flags$|=32,i.$lazyBundleId$;{n=t.constructor;const o=t.localName;customElements.whenDefined(o).then(()=>e.$flags$|=128)}if(n&&n.style){let o;typeof n.style=="string"?o=n.style:typeof n.style!="string"&&(e.$modeName$=_nt(t),e.$modeName$&&(o=n.style[e.$modeName$]));const a=jMe(i,e.$modeName$);if(!ak.has(a)){const l=ax("registerStyles",i.$tagName$);xnt(a,o,!!(i.$flags$&1)),l()}}}e.$ancestorComponent$,Dee(e,!0)},phe=t=>{},Unt=t=>{if(!(ba.$flags$&1)){const e=kx(t),i=e.$cmpMeta$,r=ax("connectedCallback",i.$tagName$);e.$flags$&1?(KMe(t,e,i.$listeners$),e!=null&&e.$lazyInstance$?phe(e.$lazyInstance$):e!=null&&e.$onReadyPromise$&&e.$onReadyPromise$.then(()=>phe(e.$lazyInstance$))):(e.$flags$|=1,i.$flags$&12&&znt(t),i.$members$&&Object.entries(i.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),knt(t,e,i)),r()}},znt=t=>{const e=t["s-cr"]=Hp.createComment("");e["s-cn"]=!0,mv(t,e,t.firstChild)},Vnt=async t=>{if(!(ba.$flags$&1)){const e=kx(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},a4t=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){Xrt(this,i)},connectedCallback(){const s=kx(this);KMe(this,s,i.$listeners$),Unt(this),r&&r.call(this)},disconnectedCallback(){Vnt(this),n&&n.call(this)},__attachShadow(){if(!this.shadowRoot)this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)});else if(this.shadowRoot.mode!=="open")throw new Error(`Unable to re-use existing shadow root for ${i.$tagName$}! Mode is set to ${this.shadowRoot.mode} but Stencil only supports open shadow roots.`)}}),t.is=i.$tagName$,Fnt(t,i)},l4t=(t,e)=>e,KMe=(t,e,i,r)=>{i&&i.map(([n,s,o])=>{const a=jnt(t,n),l=Bnt(e,o),c=Gnt(n);ba.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>ba.rel(a,s,l,c))})},Bnt=(t,e)=>i=>{var r;try{Yh.lazyLoad||t.$hostElement$[e](i)}catch(n){aI(n)}},jnt=(t,e)=>e&4?Hp:e&8?lI:e&16?Hp.body:t,Gnt=t=>Krt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.13.2
 */const py=globalThis.calciteConfig,c4t=(py==null?void 0:py.focusTrapStack)||[];py!=null&&py.logLevel;const fhe="2.13.2",Hnt="2024-10-24",qnt="e38e2977d";function Wnt(){if(py&&py.version)return;console.info(`Using Calcite Components ${fhe} [Date: ${Hnt}, Revision: ${qnt}]`);const t=py||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:fhe,writable:!1}),globalThis.calciteConfig=t}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.13.2
 */const Znt=()=>typeof navigator<"u"&&typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.13.2
 */function mhe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(FMe)||t.contains(NMe)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&r(o),s=o};let s=i();r(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Ynt(){Znt()&&(document.readyState==="interactive"?mhe():document.addEventListener("DOMContentLoaded",()=>mhe(),{once:!0})),Wnt()}const Xnt=Ynt;Xnt();let e$e;function Jnt(){try{nnt(".")}catch{snt(Iu(vr(e$e)))}}function Nee(t){var i;const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push((i=t[r])==null?void 0:i.call(t));return e.length>0?Promise.all(e):null}e$e="components/assets";const t$e=Symbol("widget"),i$e=Symbol("widget-test-data"),Qnt=[],Knt={},dk=new WeakMap;function r$e(t,e){let i=e.children;if(i!=null&&i.length)for(let n=0;n<i.length;++n)i[n]=r$e(t,i[n]);else i=Qnt;const r=e.vnodeSelector;if(pk(r)){const n=e.properties||Knt,s=n.key||r,o={key:s,afterCreate:est,afterUpdate:tst,afterRemoved:n$e,parentWidget:t,widgetConstructor:r,widgetProperties:{...n,key:s,children:i}};return{vnodeSelector:r.vnodeSelector,properties:o,children:void 0,text:void 0,domNode:null}}return e}function est(t,e,i,{parentWidget:r,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,dk.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r.addHandles(Ui(()=>n$e(t))),queueMicrotask(()=>{o[i$e].projector.renderNow()})}function tst(t,e,i,{widgetProperties:r}){var s;const n=dk.get(t);n&&(n.set(r),(s=n.afterUpdate)==null||s.call(n,n,t))}function n$e(t){var i;const e=dk.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),dk.delete(t))}function pk(t){return typeof t=="function"&&t[t$e]}const ghe=new Set;function ist(t){ghe.add(t),t.finally(()=>ghe.delete(t))}var s$e;const rst="esri.widgets.Widget";let nst=0;function o$e(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?o$e(t[r],e[r]):t[r]=e[r]);return t}const sst=qrt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,n,s,o)=>{const a=e==null?void 0:e(r,n,s,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in s)||l){const c=r[2].toLowerCase()+r.slice(3),h=y=>a==null?void 0:a.call(s,y);s.addEventListener(c,h,l);const p=()=>s.removeEventListener(c,h,l),g=o.afterRemoved;o.afterRemoved=y=>{g==null||g(y),p()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:n,type:s}=r,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(rTe(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let tG=!1,ao=class extends D3(ns.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=sst,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=cU(async()=>{var l;if((l=this._messageBundleProps)!=null&&l.length){const c=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:h,propertyName:p})=>{if(this.destroyed)return;let g=await w1e(h);this.uiStrings&&Object.keys(this.uiStrings)&&(g=o$e(te(g),this.uiStrings)),this[p]=g}));if(this.destroyed)return;for(const h of c)h.status==="rejected"&&de.getLogger(this).error("widget-intl:locale-error",this.declaredClass,h.reason)}await this.loadLocale()}),Jnt();const r="esri-widget-uid-"+jU(),n=this.render.bind(this);this._trackingTarget=new uU(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const s=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),o=()=>{var p,g;if(!this._readyForTrueRender||this.destroyed)return null;const l=n()??s(),c=l.properties??(l.properties={});if(c.key??(c.key=r),pk(l.vnodeSelector)){if(!this.visible)return s()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),(p=c.styles).display??(p.display="");let h=0;return(g=l.children)==null||g.forEach(y=>{var w;pk(y.vnodeSelector)||(y.properties??(y.properties={}),(w=y.properties).key??(w.key=`${this.id}--${h++}`))}),r$e(this,l)};this.render=()=>{if(tG)return o();let l=eqe(this)??null;if(l)return l;this._trackingTarget.clear(),tG=!0;try{l=_y(this._trackingTarget,o)}catch(c){throw de.getLogger(this).error(c),c}finally{tG=!1}return l&&tqe(this,l),l};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),ist(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){var i;const e=this.loadDependencies();return(i=this._messageBundleProps)!=null&&i.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(Xse):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Ye(this._trackingTarget),Ye(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,nj(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return HU(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+nst++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(s$e=t$e,i$e)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(nj(this),this._projector.scheduleRender())}own(e){b_e(de.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return iqe.apply(this,e)}renderNow(){nj(this),this._projector.renderNow()}_postInitialize(){var i;if(this.destroyed)return;this.scheduleRender(),(i=this._delegatedEventNames)!=null&&i.length&&this.addHandles(oe(()=>this.viewModel,(r,n)=>{n&&this.removeHandles("delegated-events"),r&&aU(r)&&this.addHandles(this._delegatedEventNames.map(s=>OC(r,s,o=>{this.emit(s,o)})),"delegated-events")},hi)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Xse),this.scheduleRender()};this.addHandles([g1e(e),oe(()=>this.uiStrings,e),Kl(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var i;this._attached&&(this._projector.detach(this.render),this._attached=!1),(i=e==null?void 0:e.parentNode)==null||i.removeChild(e)}};ao[s$e]=!0,ao.vnodeSelector="div",u([f()],ao.prototype,"_readyForTrueRender",void 0),u([f({value:null})],ao.prototype,"container",null),u([$i("container")],ao.prototype,"castContainer",null),u([f()],ao.prototype,"icon",null),u([f()],ao.prototype,"id",null),u([f()],ao.prototype,"label",null),u([f()],ao.prototype,"renderable",null),u([f()],ao.prototype,"uiStrings",void 0),u([f()],ao.prototype,"viewModel",void 0),u([f({value:!0})],ao.prototype,"visible",null),u([f()],ao.prototype,"key",void 0),u([f()],ao.prototype,"children",void 0),u([f()],ao.prototype,"afterCreate",void 0),u([f()],ao.prototype,"afterUpdate",void 0),u([f()],ao.prototype,"afterRemoved",void 0),ao=u([L(rst)],ao);const cI=ao;function gC(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var ost=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},a$e=function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i];Array.isArray(n)?a$e(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=ost(n)),e.push(n))}},ast=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var n=[];return a$e(i,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function ya(t,e,...i){return typeof t!="function"||pk(t)?ast(t,e,...i):t(e,...i)}function h4t(...t){return t}const QL="esri-fov-overlay",KL={base:QL,outer:`${QL}-outer`,reset:`${QL}-reset`,text:`${QL}-text`};let Sg=class extends cI{constructor(e){super(e),this.onReset=()=>{},this._messagesCommon=null,this._messagesUnits=null,this.fov=null}render(){return ya("div",{class:KL.outer},ya("div",{class:KL.base},ya("p",{class:KL.text},this._overlay),ya("p",{class:KL.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){const{fov:e,_messagesUnits:i}=this;if(!i||e==null)return"";const r=Urt(vo(e),"degrees","arithmetic","arithmetic",0),n=lst/(2*Math.tan(e/2));return`${r} | ${Fx(i,n,"millimeters",0,"abbr")} |`}get _reset(){return this._messagesUnits&&this.fov!=null?"":""}};u([f()],Sg.prototype,"onReset",void 0),u([f(),gC("esri/t9n/common")],Sg.prototype,"_messagesCommon",void 0),u([f(),gC("esri/core/t9n/Units")],Sg.prototype,"_messagesUnits",void 0),u([f()],Sg.prototype,"fov",void 0),u([f()],Sg.prototype,"_overlay",null),u([f()],Sg.prototype,"_reset",null),Sg=u([L("esri.widgets.FovOverlay")],Sg);const lst=Math.sqrt(1872);let pE=class extends Np{constructor(e){super(e),this.onStop=null,this._timeOutId=void 0,this._onReset=()=>{this._startSize=this._lastDrag=null,this._setFov(cst),this.updateTimeout()},this._center=A(),this._viewForward=A(),this._constraints=new Yu(Xr.ALL,pi.ZOOM)}begin(e){dst(e)?this._showOverlay().fov=e.fov:(this._lastDrag=e[1],this._startSize=null,this._ensureStartSize(this.view.state.camera))}updateTimeout(){clearTimeout(this._timeOutId),this._timeOutId=setTimeout(this.onStop,1500)}update(e){if(this._lastDrag==null)return this._lastDrag=e[1],this._startSize=null,void this._ensureStartSize(this.view.state.camera);const i=-(this._lastDrag-e[1])/2;this._lastDrag=e[1],this.step(i)}step(e){if(!this.running)return void(this._startSize=this._lastDrag=null);const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),n=vo(r.fov)+e,s=Wt(Oe(n,ust,hst));s!==r.fov?this._setFov(s):this._showOverlay().fov=r.fov}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(e){super.onControllerEnd(e),this._startSize=this._lastDrag=null,this.hideOverlay()}_showOverlay(){return this._overlay||(this._overlay=new KA({id:"esri.FovOverlay",node:new Sg({onReset:this._onReset})}),this.view.ui.add(this._overlay)),this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=Ye(this._overlay))}_setFov(e){const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),n=this._ensureStartSize(r)/Math.tan(e/2),s=xe(iG,this._center,ue(iG,this._viewForward,-n));r.eye=s,r.fov=e,this._constraints.interactionStartCamera=i.camera,this._constraints.interactionFactor=Hh(this.currentCamera.height-i.camera.height),zn(this.view,this.currentCamera,this._constraints),this.begin(r),this.commitCamera()}_ensureStartSize(e){if(this._startSize==null){ye(this._viewForward,e.viewForward);const i=this.view._stage.renderView.getMinimalDepthForArea(null,e.fullWidth/e.pixelRatio*.5,e.fullHeight/e.pixelRatio*.5,e,sI),r=Nr(e.eye,this.view.pointsOfInterest.centerOnContent.renderLocation),n=i??r;xe(this._center,e.eye,ue(iG,this._viewForward,n)),this._startSize=n*Math.tan(e.fov/2)}return this._startSize}};u([f()],pE.prototype,"onStop",void 0),pE=u([L("esri.views.3d.state.controllers.FovController")],pE);const cst=Wt(new Hc().fov),ust=10,hst=150,iG=A();function dst(t){return!Array.isArray(t)}let MZ=class extends Np{constructor(){super(...arguments),this._pickPoint=A(),this._tmpP0=Yt(),this._panAxisAngle=kz(),this._tmpRayDir=A(),this._tmpRayDirPick=A(),this._targetOnSphere=A(),this._navMode=ma.Horizontal,this._tmpRay={origin:A(),direction:A()},this.dragBeginPoint=ds(),this._normalizedAnchorPoint=Yt(),this._constraintOptions=new Yu(Xr.ALL_EXCEPT_COLLISION,pi.ZOOM,0,this.startCamera),this._sphere=Pn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;Ha(this.dragBeginPoint,e),Ib(this.startCamera,e,this._normalizedAnchorPoint);const i=xr(this.view.spatialReference),r=_Me(this._intersectionHelper,this.startCamera,e,i,fC.Ellipsoid,this.view.map.ground.opacity===0?Nx:{});if(this._navMode=oI(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===ma.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let n;oM(this.startCamera,e,this._tmpRay),Me(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(Ae(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),n=Fe(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,yhe);let o=Oe(Math.min(uMe,1/Math.abs(Te(yhe,this._tmpRay.direction)))*s,K5[0],K5[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,sI);o=a??o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,ue(this._tmpRay.direction,this._tmpRay.direction,o),xe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.running){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===ma.Horizontal){Ae(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Fe(this._tmpRayDir);Ib(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;if(this._hasPickPoint&&n<i){const o=1-(1-n/i)*(1-this._sphere[3]/Fe(this.currentCamera.center));this.currentCamera.center=ue(eD,this.currentCamera.center,o)}ue(this._tmpRayDir,this._tmpRayDir,-n/i),this.currentCamera.eye=xe(eD,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Hh(Lv(this.dragBeginPoint,e)),zn(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(n3(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),wee(this._pickPoint,this._targetOnSphere,this._panAxisAngle),kv(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Fe(this._tmpRay.direction);Ib(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;ue(this._tmpRayDir,this._tmpRay.direction,1-n/i),this.currentCamera.eye=xe(eD,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=xe(eD,this.currentCamera.center,this._tmpRayDir)}sM(this.view,this.currentCamera),this.commitCamera()}}finish(){this.running&&this.finishController()}};MZ=u([L("esri.views.3d.state.controllers.ZoomControllerGlobal")],MZ);const eD=A(),yhe=A();let $Z=class extends Np{constructor(){super(...arguments),this._tmpP=A(),this._tmpDir=A(),this._tmpN=A(),this._tmpP0=Yt(),this._tmpPoi=A(),this._tmpRayDir=A(),this.dragBeginPoint=ds(),this._normalizedAnchorPoint=Yt(),this._constraintOptions=new Yu(Xr.ALL,pi.ZOOM,0,this.startCamera,A()),this._plane=dn()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;Ha(this.dragBeginPoint,e),Ib(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Nx:{});Ae(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Fe(this._tmpDir);Me(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=Oe(Math.min(uMe,1/Math.abs(Te(pst,this._tmpDir)))*n,K5[0],K5[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(s3(this.view),e[0],e[1],this.view.state.camera,sI);s=o??s,s=i?Math.min(s,r):s,ue(this._tmpDir,this._tmpDir,s),xe(this._tmpP,this.startCamera.eye,this._tmpDir),Ae(this._tmpN,this.startCamera.eye,this.startCamera.center),Me(this._tmpN,this._tmpN),this._tmpN[1]<0&&od(this._tmpN,this._tmpN),tC(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.running)return;Fit(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ye(this._tmpPoi,this.currentCamera.center),Ib(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Ha(this._normalizedAnchorPoint,this._tmpP0),Ae(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Fe(this._tmpRayDir);let n=r*(1-i);this._constraintOptions.interactionDirection&&(ye(this._constraintOptions.interactionDirection,this._tmpRayDir),ue(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const s=this.view.state.constraints.minimumPoiDistance;i>=0&&n<s&&(n=s,i=-(n-r)/r),Math.abs(r-n)<1e-6||(ue(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=xe(M1,this.currentCamera.eye,this._tmpRayDir),br(M1,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?M1[2]=Math.max(this.startCamera.center[2],M1[2]):M1[2]=Math.min(this.startCamera.center[2],M1[2]),this.currentCamera.center=M1,this._constraintOptions.interactionFactor=Hh(Lv(this.dragBeginPoint,e)),zn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}finish(){this.running&&this.finishController()}};$Z=u([L("esri.views.3d.state.controllers.ZoomControllerLocal")],$Z);const M1=A(),pst=Qe(0,0,1);let fst=class extends qo{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._fovModifier=r,this.registerIncoming("drag",[r],n=>this._handleZoom(n)),this.registerIncoming("drag",n=>this._handleZoom(n))}_handleZoom(e){var n,s;const i=e.data;if(i.pointers.size>1||!Mee(e.data,this.pointerAction))return;const r=ds(i.center.x,i.center.y);switch(i.action){case"start":{(n=this._cameraController)==null||n.finish();const o=this._view,a=e.modifiers.has(this._fovModifier);this._cameraController=a?new pE({view:o,onStop:()=>this._stopController()}):o.state.isGlobal?new MZ({view:o}):new $Z({view:o}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break}case"update":(s=this._cameraController)==null||s.update(r);break;case"end":this._cameraController instanceof pE?this._cameraController.updateTimeout():this._stopController()}e.stopPropagation()}_stopController(){var e;(e=this._cameraController)==null||e.finish(),this._cameraController=null}};function zd(t){let e=t*t;return t<0&&(e*=-1),e}function _he(t,e,i){const r=i,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(r.translation[0]=zd(n.axes[0]),r.translation[1]=zd(n.axes[1]),r.translation[2]=zd(n.buttons[7])-zd(n.buttons[6]),r.heading=zd(n.axes[2]),r.tilt=zd(n.axes[3])):s.deviceType==="spacemouse"&&(r.translation[0]=1.2*zd(n.axes[0]),r.translation[1]=1.2*zd(n.axes[1]),r.translation[2]=2*-zd(n.axes[2]),r.heading=1.2*zd(n.axes[5]),r.tilt=1.2*zd(n.axes[3])),r.tilt*=o,ue(r.translation,r.translation,a),r}function vhe(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function rG(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let fb=class extends Np{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Jr,this._headingStart=0,this._constraintOptions=new Yu(Xr.ALL,pi.NONE,0,new Jr,null,Em.LOOK_AROUND)}handleEventGamepad(e){const i=_he(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||rG(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,vhe(this._keysButtonState,this._transformation)}directionActive(e){return this._keysButtonState[e]===1}countActiveDirections(){return this._keysButtonState.reduce((e,i)=>i>0?e+1:e,0)}deactivateDirection(e){this._keysButtonState[e]=0;const i=vhe(this._keysButtonState,this._transformation);rG(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,$1),this._applyDisabledMovementTypes($1),this._applyPan($1.pan),this._applyRotate($1.rotate),this._applyZoom($1.zoom),this._applyAscend($1.ascend),this._constraintOptions.interactionType=pi.NONE,this._constraintOptions.selection=Xr.COLLISION,zn(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;Ae(Cl,i.center,i.eye),Mt(Cl,Cl,e.matrix),i.center=xe(Cl,Cl,i.eye),i.up=Mt(Cl,i.up,e.matrix),this._constraintOptions.interactionType=pi.LOOK_AROUND,this._constraintOptions.selection=Xr.ALL_EXCEPT_COLLISION,zn(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=Mt(Cl,i.eye,e.matrix),i.center=Mt(Cl,i.center,e.matrix),this.view.state.isGlobal&&(i.up=Mt(Cl,i.up,e.matrix)),this._constraintOptions.interactionType=pi.PAN,this._constraintOptions.selection=Xr.ALL,zn(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=xe(Cl,this.currentCamera.eye,ue(et.get(),i,e)),ye($$,i),od($$,$$),this._constraintOptions.interactionDirection=$$,this._constraintOptions.interactionType=pi.ZOOM,this._constraintOptions.selection=Xr.ALL_EXCEPT_COLLISION,zn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,et.get());if(this._constraintOptions.interactionDirection=ye($$,i),this.view.state.isGlobal){const r=Fe(this.currentCamera.eye),n=(r+e)/r;this.currentCamera.eye=ue(Cl,this.currentCamera.eye,n),this.currentCamera.center=ue(Cl,this.currentCamera.center,n)}else{const r=ue(et.get(),i,e);this.currentCamera.eye=xe(Cl,this.currentCamera.eye,r),this.currentCamera.center=xe(Cl,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=pi.ASCEND,this._constraintOptions.selection=Xr.COLLISION,zn(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Xr.ALL_EXCEPT_COLLISION,zn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){bst(r);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,i,r):this._calculateControlTransformationGlobal(n,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,Cl)}_calculateControlTransformationLocal(e,i,r){const{viewRight:n,viewForward:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=ve(et.get(),s[0],s[1],0);Me(l,l);const c=o.translation[0]*e.pan;if(c!==0){const b=ue(et.get(),n,c);hd(r.pan.matrix,r.pan.matrix,b),r.pan.enabled=!0}switch(a.mode){case"pan":{const b=-o.translation[1]*e.pan;if(b!==0){const x=ue(et.get(),l,b);hd(r.pan.matrix,r.pan.matrix,x),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;r.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Lu(r.rotate.matrix,r.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,et.get())),r.rotate.enabled=!0);const g=o.tilt*e.rotate,y=xy(this.view.renderCoordsHelper,i.center,i.eye),w=Oe(y+g,ca.min,ca.max)-y;w&&(Lu(r.rotate.matrix,r.rotate.matrix,w,n),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:n,viewRight:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=Ot(et.get(),s,n);Me(l,l),od(l,l),jit(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan($1.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;r.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Lu(r.rotate.matrix,r.rotate.matrix,p,this._tmpCamera.eye),r.rotate.enabled=!0);const g=o.tilt*e.rotate,y=this._clampTiltDeltaGlobalToValidRange(g,i.ray,c);y!==0&&(Lu(r.rotate.matrix,r.rotate.matrix,y,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const n=xr(this.view.spatialReference),s=AF(ca.min,i.origin,r,n);let o=0,a=0;const l=et.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=xy(this.view.renderCoordsHelper,l,i.origin);o=AF(c,i.origin,r,n),a=AF(ca.max,i.origin,r,n)}else{JC(XC(nz,r+n.radius),i,l);const c=Math.PI+qQ(i.direction,l);o=Lue(c,i.origin,r,n),a=Lue(ca.max,i.origin,r,n)}return Oe(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=i+Math.abs(s-i);return n.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:n}=this.view.state,{direction:s}=JZe(this.view,i,0,l$e,wst),o=r.intersectManifoldClosestSilhouette(rf(i,s),e,et.get()),a=Nr(i,o),l=r.intersectManifoldClosestSilhouette(rf(i,_x(et.get(),i,n.center)),e,et.get()),c=Nr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:n,isGlobal:s}=r,o=i.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,et.get());if(s){const a=Ae(et.get(),e,o),l=Fe(a);ue(a,a,1/l);const c=Me(et.get(),e),h=Ga(Te(c,a));return l*Math.sin(Math.min(gst,h))}{const a=ye(et.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Nr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:yst}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+xr(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=et.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=n.width/2,h=whe*n.width,p=whe*n.width,g=l*Math.tan(.5*n.fovX)/c,y=g/r,w=g/this._computeHeadingRotateRadius(o),b=a-i;return{pan:(s?y:g)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*b-b),zoom:2**(h*e/c)*l-l,rotate:Oe(w*p,_st,vst)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Jp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Jp(e.rotate.matrix))}static activatesFor(e,i){const r=_he(i,e.navigation.gamepad,mst);return!(i.action==="end"||rG(r))}};u([f({constructOnly:!0})],fb.prototype,"gamepadDevice",void 0),u([f({constructOnly:!0})],fb.prototype,"disableMovements",void 0),fb=u([L("esri.views.3d.state.controllers.GamepadKeyboardController")],fb);const mst={translation:[0,0,0],heading:0,tilt:0,zoom:0},l$e=80,gst=Wt(l$e),whe=.75,yst=5,_st=Wt(30),vst=Wt(80),$1={zoom:0,ascend:0,pan:{enabled:!1,matrix:ut()},rotate:{enabled:!1,matrix:ut()}},Cl=A(),$$=A(),wst=fK();function bst(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Jp(t.pan.matrix),t.rotate.enabled=!1,Jp(t.rotate.matrix)}let xst=class extends qo{constructor(e){super(!0),this._view=e,this._watchHandles=new Dy,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([oe(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Si),oe(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){var n;const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=(n=this._cameraControllerGamepad)==null?void 0:n.running;if(r||fb.activatesFor(this._view,e.data)){if(!r){const s=new fb({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s),s.state!==sn.Rejected&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function Sst(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),Ui(()=>document.removeEventListener("visibilitychange",e))}var Sc;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Sc||(Sc={}));let Tst=class extends qo{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:ct.Local},this._stickyKeyTimeoutHandle=void 0,this._stickyKeyDuration=200,this._keyToNumber={[i.left]:Sc.LEFT,[i.right]:Sc.RIGHT,[i.forward]:Sc.FORWARD,[i.backward]:Sc.BACKWARD,[i.up]:Sc.UP,[i.down]:Sc.DOWN,[i.headingLeft]:Sc.HEADINGLEFT,[i.headingRight]:Sc.HEADINGRIGHT,[i.tiltUp]:Sc.TILTUP,[i.tiltDown]:Sc.TILTDOWN,[i.zoomIn]:Sc.ZOOMIN,[i.zoomOut]:Sc.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=Sst(r=>r?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}setStickyKeyDuration(e){this._stickyKeyDuration=e}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];if(i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new fb({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running)){if(e.stopPropagation(),this._cameraControllerKeyboard.directionActive(i)||(this._cameraControllerKeyboard.activateDirection(i),this._cameraControllerKeyboard.countActiveDirections()>1||!this._isPanning(i)))return;this._stickyKeyDuration>0&&(this._stickyKeyTimeoutHandle=setTimeout(()=>{var r;this._stickyKeyTimeoutHandle=void 0,this._stickyDirection!=null&&this._stickyDirection!==void 0&&((r=this._cameraControllerKeyboard)==null||r.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)},this._stickyKeyDuration))}}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){var r,n,s;if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];if(i!=null&&((r=this._cameraControllerKeyboard)!=null&&r.running)){e.stopPropagation();const o=this._stickyKeyTimeoutHandle===void 0;if(this._stickyKeyTimeoutHandle!==void 0&&((n=this._cameraControllerKeyboard)==null?void 0:n.countActiveDirections())===1)return void(this._stickyDirection=i);(s=this._cameraControllerKeyboard)==null||s.deactivateDirection(i),o&&(this._stickyDirection=void 0)}}_isPanning(e){return e<=3}},Est=class extends qo{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",[i],r=>this._handleFov(r)),this.registerIncoming("mouse-wheel",r=>this._handleZoom(r))}_handleZoom(e){var r;if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;(r=this._zoomController)!=null&&r.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new rk({view:this._view,mode:"interaction"}):new nk({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._zoomController)),this._zoomController.step(-i.deltaY/60,ds(i.x,i.y)),e.preventDefault(),e.stopPropagation()}_handleFov(e){var i,r,n;this._view.navigation.mouseWheelZoomEnabled&&((i=this._fovController)!=null&&i.running||((r=this._zoomController)==null||r.finish(),(n=this._fovController)==null||n.hideOverlay(),this._fovController=new pE({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),this._fovController.state!==sn.Rejected)?(this._fovController.updateTimeout(),this._fovController.step(e.data.deltaY/20),e.preventDefault(),e.stopPropagation()):this._stopFovController())}_stopFovController(){var e;(e=this._fovController)==null||e.finish(),this._fovController=null}},fk=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},lx=class extends i3{constructor(){super(...arguments),this._beginCamera=new Jr,this._elapsedTimeSec=0,this.constraintOptions=new Yu(Xr.ALL,pi.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new uC}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),zn(this.view,i,this.constraintOptions)}};lx=u([L("esri.views.3d.state.controllers.momentum.MomentumController")],lx);let eR=class extends lx{constructor(e){super(e),this.interactionType=pi.PAN,this._tmpPan=A()}momentumStep(e,i){const r=this.momentum.value(e);ue(this._tmpPan,this.momentum.direction,r),i.eye=Ae(bhe,i.eye,this._tmpPan),i.center=Ae(bhe,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([f({constructOnly:!0})],eR.prototype,"momentum",void 0),eR=u([L("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],eR);const bhe=A(),Cst=A(),tD=A();let DF=class extends lx{constructor(e){super(e),this.interactionType=pi.PAN}momentumStep(e,i){const r=this.momentum.value1(e),n=this.momentum.value2(e);ye(tD,i.eye),Me(tD,tD),Ot(this.momentum.axis2,tD,this.momentum.axis1),xMe(i,Cst,this.momentum.axis1,r,this.momentum.axis2,n)}};u([f({constructOnly:!0})],DF.prototype,"momentum",void 0),DF=u([L("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],DF);let eb=class extends lx{set center(e){this._set("center",En(e))}set axis(e){this._set("axis",En(e))}constructor(e){super(e),this.interactionType=pi.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);kv(i,this.center,r3(this.axis,r))}};u([f({constructOnly:!0})],eb.prototype,"momentum",void 0),u([f({constructOnly:!0})],eb.prototype,"center",null),u([f({constructOnly:!0})],eb.prototype,"axis",null),eb=u([L("esri.views.3d.state.controllers.momentum.RotationMomentumController")],eb);let A2=class extends lx{set zoomCenter(e){this._set("zoomCenter",En(e))}constructor(e){super(e),this.interactionType=pi.ZOOM,this.constraintOptions.interactionDirection=A()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ye(r,i.eye);const n=this.momentum.valueDelta(0,e);Tee(i,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),_x(r,i.eye,r)}};u([f({constructOnly:!0})],A2.prototype,"momentum",void 0),u([f({constructOnly:!0})],A2.prototype,"zoomCenter",null),A2=u([L("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],A2);let Cw=class extends lx{set screenCenter(e){this._set("screenCenter",ds(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",En(e))}constructor(e){super(e),this.interactionType=pi.ZOOM,this.radius=0,this._tmpSceneCenter=A(),this._tmpZoomAxisAngle=kz(),this._sphere=Pn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);gMe(this._sphere,i,r),this.constraintOptions.interactionType=pi.ZOOM,zn(this.view,i,this.constraintOptions),n3(this._sphere,i,this.screenCenter,this._tmpSceneCenter),wee(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),kv(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=pi.PAN}};u([f({constructOnly:!0})],Cw.prototype,"momentum",void 0),u([f({constructOnly:!0})],Cw.prototype,"screenCenter",null),u([f({constructOnly:!0})],Cw.prototype,"sceneCenter",null),u([f({constructOnly:!0})],Cw.prototype,"radius",void 0),Cw=u([L("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Cw);let Tp=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},jz=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},Mst=class extends jz{constructor(e,i,r,n,s){super(e,i,r),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},c$e=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Tp(.6),this._screen=[new Tp(.4),new Tp(.4)],this._scene=[new Tp(.6),new Tp(.6),new Tp(.6)],this._tmpDirection=A()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=n==null||r==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){ve(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=Fe(this._tmpDirection);n>0&&ue(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new Mst(e,i,r,s==null?0:n/s,this._tmpDirection)}},xhe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const She=1e-5;let $st=class extends jz{constructor(e,i,r,n,s,o=0,a){super(e,i,r),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},Ost=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=A(),this._tmpAxis2=A(),this._tmpAngles=Yt(),this._time=new Tp(.3),this._screen=[new Tp(.4),new Tp(.4)],this._angle1=new xhe(.6),this._angle2=new xhe(.6),this._axis1=A(),this._axis2=A(),this._lastScene=A()}addMomentumDirectRotation(e,i,r,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=wMe(this._lastScene,i,this._tmpAxis2,n,s,o);this._angle2.update(0),No(this._tmpAxis2)<She?a=0:Me(this._axis1,this._tmpAxis2),this._angle1.update(a),ye(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;bMe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),No(this._tmpAxis2)<She?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Me(this._axis1,this._tmpAxis1),Me(this._axis2,this._tmpAxis2)),ye(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=r==null||n==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new $st(e,i,r,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},u$e=class{constructor(e=2.5,i=.01,r=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=n,this.enabled=!0,this.value=new Tp(.8),this.time=new Tp(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Oe(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new jz(e,i,r)}},h$e=class extends u$e{constructor(e=3,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){const r=this.value.lastValue;if(r!=null){let n=e-r;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=r+n}super.add(e,i)}},Ast=class extends jz{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),n=super.value(e+i)-r;return Math.exp(n)}},d$e=class extends u$e{constructor(e=2.5,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Ast(e,i,r)}},OZ=class extends Np{constructor(){super(...arguments),this._smoothRotation=new fk(.05),this._rotationAxis=A(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=dn(),this._beginRadius=0,this._smoothScaling=new fk(.05),this._zoomCenterScreen=ds(),this._zoomMomentumEstimator=new d$e,this._rotationMomentumEstimator=new h$e,this._panSphericalMomentumEstimator=new Ost,this._panPlanarMomentumEstimator=new c$e,this._adjustedSphere=Pn(),this._tmp3d=A(),this._tmpScreenPointArray=ds(),this._beginScreenPoint=ds(),this._beginScenePoint=A(),this._screenPickPoint=ds(),this._scenePickPoint=A(),this._navMode=ma.Horizontal,this._sphere=Pn(),this._pointerCount=0,this._tmpInteractionDirection=A(),this._beginCamera=new Jr,this._constraintOptions=new Yu(Xr.ALL,pi.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-Cv.normalize(Wt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Mp(e.center,this._screenPickPoint),Ha(this._beginScreenPoint,this._screenPickPoint);const i=xr(this.view.spatialReference),r=_Me(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,fC.Silhouette,this.view.map.ground.opacity===0?Nx:{});r.scenePickPoint!=null&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,ye(this._beginScenePoint,this._scenePickPoint),this._navMode=oI(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===ma.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navMode===ma.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navMode===ma.Horizontal?new Cw({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new A2({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new eb({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._navMode===ma.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new DF({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new eR({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,i){const r=od(this._tmp3d,this.startCamera.viewForward);tC(this._scenePickPoint,r,this._panningPlane);const n=ds(this._screenPickPoint[0],0),s=A(),o=Fe(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],n3(this._adjustedSphere,this.startCamera,n,s);const a=Ip();this.startCamera.projectToRenderScreen(s,a);const l=A(),c=A(),h=A();Ae(l,this._scenePickPoint,this.currentCamera.eye);const p=Fe(l);Me(l,l);const g=fMe*Math.max(Math.abs(this.view.camera.position.z),mMe),y=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,sI);let w=y??g;w=i?Math.min(w,p):w,ye(h,xe(c,this.currentCamera.eye,ue(c,l,w))),this._panningPlane[3]=-Te(this._panningPlane,h),this.startCamera.center=xe(c,this.startCamera.eye,ue(c,this.startCamera.viewForward,w));const b=Mp(e.center,this._tmpScreenPointArray);vZ(this._panningPlane,this.startCamera,b,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),gMe(this._sphere,this.currentCamera,this._smoothScaling.value),Mp(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=pi.ZOOM,this._constraintOptions.interactionFactor=Hh(e.radius-this._beginRadius),zn(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=Mp(e.center,this._tmpScreenPointArray);n3(this._sphere,this.currentCamera,i,this._tmp3d),Eee(this._beginScenePoint,Te(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(TMe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(SMe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=pi.PAN,this._constraintOptions.interactionFactor=Hh(Lv(this._screenPickPoint,i)),zn(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Me(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||od(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+_Z(e.angle-i),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),kv(this.currentCamera,this._sphere,r3(this._rotationAxis,s)),this._constraintOptions.interactionType=pi.TUMBLE,this._constraintOptions.interactionFactor=Hh(e.radius*r),zn(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=Mp(e.center,this._tmpScreenPointArray);vZ(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(vMe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=pi.PAN,this._constraintOptions.interactionFactor=Hh(Lv(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),zn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Tee(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=pi.ZOOM,this._constraintOptions.interactionFactor=Hh(e.radius-this._beginRadius),zn(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ye(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||od(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=_Z(r);const n=i+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),kv(this.currentCamera,this._sphere,r3(this._rotationAxis,o)),this._constraintOptions.interactionType=pi.TUMBLE,this._constraintOptions.interactionFactor=Hh(e.radius*o),zn(this.view,this.currentCamera,this._constraintOptions)}};OZ=u([L("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],OZ);const The=Qe(0,0,1);let AZ=class extends Np{constructor(){super(...arguments),this._rotationValueSmooth=new fk(.05),this._scalingValueSmooth=new fk(.05),this._planeHorizontal=dn(),this._planeVertical=dn(),this._rotationMomentumEstimator=new h$e,this._panMomentumEstimator=new c$e(300,12,.9),this._zoomMomentumEstimator=new d$e,this._beginRadius=0,this._beginCenter=A(),this._beginAngle=0,this._tmpPoints=[],this._navMode=ma.Horizontal,this._beginCenterScreen=ds(),this._tmpCentroid3d=A(),this._tmpCentroid2d=ds(),this._tmp2d=ds(),this._pointerCount=0,this._beginCamera=new Jr,this._constraintOptions=new Yu(Xr.ALL,pi.NONE,0,this._beginCamera)}begin(e){if(!this.running)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Mp(e.center,this._beginCenterScreen),fSe(The,0,this._planeHorizontal);const r=A(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?Nx:{}),s=A();od(s,this.startCamera.viewForward);const o=A();ye(o,The);const a=Te(s,o);this._navMode=oI(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=Math.min(fMe,1/Math.abs(Te(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),mMe);E7(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||RHe(this._planeHorizontal,this._planeHorizontal);const c=A(),h=A(),p=A();Ae(c,r,this.currentCamera.eye);const g=Fe(c);if(Me(c,c),this._navMode===ma.Vertical){ue(o,o,a),Ae(this._planeVertical,s,o),Me(this._planeVertical,this._planeVertical),E7(this._planeVertical,this._planeVertical,r);const y=this.view._stage.renderView.getMinimalDepthForArea(s3(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,sI);let w=y??l;w=n?Math.min(w,g):w,ye(p,xe(h,this.currentCamera.eye,ue(h,c,w))),this._planeVertical[3]=-Te(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),jj(this._tmpPoints,this._beginCenter)}else{const y=n?g:l;ye(p,xe(h,this.currentCamera.eye,ue(h,c,y))),this._planeHorizontal[3]=-Te(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),jj(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navMode===ma.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(i){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),Tee(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=pi.ZOOM,this._constraintOptions.interactionFactor=Hh(Math.abs(e.radius-this._beginRadius)),zn(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),jj(this._tmpPoints,this._tmpCentroid3d),Mp(e.center,this._tmpCentroid2d),vMe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=pi.PAN,this._constraintOptions.interactionFactor=Hh(Lv(this._beginCenterScreen,this._tmpCentroid2d)),zn(this.view,this.currentCamera,this._constraintOptions),i){const s=n,o=this._rotationValueSmooth.value,a=o+_Z(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const h=this._planeHorizontal;kv(this.currentCamera,s,r3(h,c)),this._constraintOptions.interactionType=pi.TUMBLE,this._constraintOptions.interactionFactor=Hh(Math.abs(e.radius*c)),zn(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new A2({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new eb({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new eR({view:this.view,momentum:n}):null}_computePlanePoints(e,i,r,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=A()),vZ(i,r,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};AZ=u([L("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],AZ);let Ehe=class extends qo{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Mee(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,n=this._momentum&&this._momentum.running&&i<r;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.running?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){var r;if((r=this._controller)!=null&&r.running){this._lastEndTimestamp=e.timestamp;const n=this._controller.end(e.data);i&&n&&(this._momentum=n,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new OZ({view:this._view}):new AZ({view:this._view})}},Rst=class extends qo{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},p$e=class extends qo{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Ist=class extends p$e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Pst=class extends p$e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Lst=class extends qo{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var n,s,o;const i=this._invert?-1:1,r=ds(0,e.data.delta*i);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new QA({view:this._view,pivot:$c.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(s=this._cameraController)==null||s.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function Che(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>Fst(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Dst(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Nst(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Fst(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let kst=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Che(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=r&&n,this.supported&&(Mhe(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new UK(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=Ub({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;Mhe(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=Che(s),l=r||Nst(a);o&&(o.timestamp===n.timestamp||!o.active&&l||Dst(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_emitGamepadEvent(e,i,r){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!r)return;const o=!s&&r?"start":s&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}};function Ust(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function Mhe(t){for(const e of navigator.getGamepads())Ust(e)&&t(e)}const $he=pe("edge"),zst=pe("chrome"),Vst=pe("ff"),Bst=pe("safari"),Ohe="esri-view-surface",ES={touchNone:`${Ohe}--touch-none`,touchPan:`${Ohe}--touch-pan`};let f$e=class m$e{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new kst(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Ye(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(nG[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&nG[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(nG[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?ES.touchNone:ES.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?ES.touchPan:ES.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(ES.touchNone),this._element.classList.remove(ES.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=NEe(this._element,e);return m$e.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const n={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_getDeltaFromTrackpadOrMouseWheel(e){return e.shiftKey&&pe("mac")&&e.deltaY===0?e.deltaX:e.deltaY}_handleMouseWheel(e,i){let r=this._getDeltaFromTrackpadOrMouseWheel(i);switch(i.deltaMode){case 0:$he&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}$he?r*=.7:zst||Bst?r*=.6:Vst&&(r*=1.375);const n=100,s=Math.abs(r);s>n&&(r=r/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};f$e.test={disableSubpixelCoordinates:!1};const nG={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let jst=class extends qo{constructor(){super(!0),this.registerIncoming("context-menu",e=>e.data.native.preventDefault())}};const Pu={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function RZ(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Gst(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function Hst(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:ju()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[$,R]=t,[I,P]=[R.x-$.x,R.y-$.y];return e.radius=Math.sqrt(I*I+P*P)/2,e.center.x=($.x+R.x)/2,e.center.y=($.y+R.y)/2,e}let i=0,r=0;for(let $=0;$<t.length;$++)i+=t[$].x,r+=t[$].y;i/=t.length,r/=t.length;const n=t.map($=>$.x-i),s=t.map($=>$.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,g=0;for(let $=0;$<n.length;$++){const R=n[$],I=s[$],P=R*R,N=I*I;o+=P,a+=N,l+=R*I,c+=P*R,h+=N*I,p+=R*N,g+=I*P}const y=.5*(c+p),w=.5*(h+g),b=o*a-l*l,x=(y*a-w*l)/b,T=(o*w-l*y)/b,M=ju(x+i,T+r);return{radius:Math.sqrt(x*x+T*T+(o+a)/t.length),center:M}}function tR(t){const{native:e}=t,{pointerId:i,button:r,pointerType:n}=e;return n==="mouse"?`${i}:${r}`:`${n}`}let qst=class extends qo{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:n,pointers:Wst(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=iD(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,n);const s=NF(n,g$e(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=iD(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=iD(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=NF(r,i)-e,r.lastAngle=NF(r,i)-e})}_emitEvent(e,i,r){const n=iD(this._activePointerMap);this._drag.emit(this._createPayload(e,i,n,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,n=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,n)):(this._addPointer(r),this._emitEvent("added",r,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function g$e(t){const e=[];return t.forEach(i=>{e.push(ju(i.event.x,i.event.y))}),Hst(e)}function iD(t){const e=g$e(t);let i=0;return t.forEach(r=>{let n=NF(r,e),s=n-r.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=r.lastAngle+s,r.lastAngle=n;const o=n-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function Wst(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function NF(t,e){const i=t.event,r=i.x-e.center.x,n=i.y-e.center.y;return Math.atan2(n,r)}var Ahe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Ahe||(Ahe={}));let Zst=class extends qo{constructor(e=Pu.maximumDoubleClickDelay,i=Pu.maximumDoubleClickDistance,r=Pu.maximumDoubleTouchDelay,n=Pu.maximumDoubleTouchDistance,s=O3){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=tR(i);if(!this._pointerState.has(r)){const n={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,n),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=tR(i),n=this._pointerState.get(r);if(n&&n.downButton===i.native.button){const s=n.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),RZ(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(i))):RZ(n,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=tR(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Yst=class extends qo{constructor(e=Pu.maximumClickDelay,i=Pu.movementUntilMouseDrag,r=Pu.movementUntilPenDrag,n=Pu.movementUntilTouchDrag,s=Pu.holdDelay,o=O3){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a)),this.registerIncoming("pointer-up",a=>this._handlePointerLoss(a,"pointer-up")),this.registerIncoming("pointer-capture-lost",a=>this._handlePointerLoss(a,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",a=>this._handlePointerLoss(a,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",a=>this._handlePointerMove(a)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Sr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(r,s),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,n=this._pointerState.get(r);n&&(n.isDragging?this._pointerDrag.emit(rD("update",n,i),void 0,n.modifiers):Gst(i,n.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),n.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,r===n.startEvent.native.pointerId?this._pointerDrag.emit(rD("start",n,i)):this._pointerDrag.emit(rD("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,n=r.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(rD("end",s,i==="pointer-up"?r:s.previousEvent),void 0,s.modifiers):i==="pointer-up"&&s.downButton===r.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(n),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function rD(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let Xst=class extends qo{constructor(e=Pu.maximumDoubleClickDelay,i=Pu.maximumDoubleClickDistance,r=Pu.maximumDoubleTouchDelay,n=Pu.maximumDoubleTouchDistance,s=O3){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",o=>this._handleImmediateClick(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Sr(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Sr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,n=Jst(i);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;RZ(o,i)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=tR(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,n=tR(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s);this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function Jst(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}let Qst=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Kst=class extends qo{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Qst({start:(r,n)=>this._observeStart(r,n),update:(r,n,s)=>this._observeUpdate(r,n,s),end:(r,n)=>this._observeEnd(n)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:b,y:x}of i.pointers.values())r=Math.max(r,b),n=Math.min(n,b),s=Math.max(s,x),o=Math.min(o,x);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:b,y:x}of e.pointers.values())a=Math.max(a,b),l=Math.min(l,b),c=Math.max(c,x),h=Math.min(h,x);const p=r-n,g=s-o,y=a-l,w=c-h;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(y-p)<=this._maxDelta&&Math.abs(w-g)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((n,s)=>{const o=i.pointers.get(s);r=Math.min(r,Math.abs(n.y-o.y))}),r>=this._threshold}},rp=class extends Ne{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Ye(this._inputManager)}connect(){const e=this.view;this._source=new f$e(this.view.surface,e.input);const i=[new Zst,new Yst,new Xst,new qst(this.view.navigation),new Kst],r=new yh({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new jst],pv.INTERNAL);const n={fov:"Shift",lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};this._modeDragPan=new Ehe(e,"primary"),this._modeDragRotate=new eG(e,"secondary",$c.CENTER),this._modeDragZoom=new fst(e,"tertiary",n.fov),this._modeKeyboardNavigation=new Tst(e,n.pan),r.installHandlers("navigation",[new Rst(e),new Xit(e),new xst(e),new Est(e,n.fov),new Pst(e,n.resetTilt),new Ist(e,n.resetHeading),new eG(e,"primary",$c.EYE,[n.lookAround]),new eG(e,"secondary",$c.CENTER,[n.lookAround]),new Ehe(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new Lst(e)],pv.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(oe(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Si))}isModifierKeyDown(e){var i;return((i=this._inputManager)==null?void 0:i.isModifierKeyDown(e))??!1}_updateMode(){var n;const e=this.mode,i=this.primaryDragAction,r=(n=IZ.get(e))==null?void 0:n.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){}};u([f()],rp.prototype,"view",void 0),u([f({value:"pan"})],rp.prototype,"primaryDragAction",null),u([f({value:"default"})],rp.prototype,"mode",null),u([f({readOnly:!0})],rp.prototype,"updating",null),u([f()],rp.prototype,"latestPointerType",null),u([f()],rp.prototype,"latestPointerLocation",null),u([f()],rp.prototype,"multiTouchActive",null),u([f()],rp.prototype,"_inputManager",void 0),rp=u([L("esri.views.3d.input.SceneInputManager")],rp);const IZ=new Map,sG=new Map,oG=new Map;sG.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),sG.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),oG.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),oG.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),IZ.set("default",sG),IZ.set("pro",oG);const eot=rp;let Zn=class extends Ne{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([f()],Zn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([f()],Zn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([f()],Zn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([f()],Zn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([f()],Zn.prototype,"LABELS_SHOW_BORDER",void 0),u([f()],Zn.prototype,"TEXT_SHOW_BASELINE",void 0),u([f()],Zn.prototype,"TEXT_SHOW_BORDER",void 0),u([f()],Zn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([f()],Zn.prototype,"OVERLAY_SHOW_CENTER",void 0),u([f()],Zn.prototype,"SHOW_POI",void 0),u([f()],Zn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([f()],Zn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([f()],Zn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([f()],Zn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([f()],Zn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([f()],Zn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([f()],Zn.prototype,"I3S_TREE_SHOW_TILES",void 0),u([f()],Zn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([f()],Zn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([f()],Zn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([f()],Zn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([f()],Zn.prototype,"LINE_WIREFRAMES",void 0),Zn=u([L("esri.views.3d.support.debugFlags")],Zn);const Cn=new Zn;let Eu,fE,PZ=!1,LZ=!1,DZ=!1,NZ=!1,iR=null;function tot(t,e){if(!LZ||!fE)return;y$e();const i=fE;let r=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];r+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,h=(s+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),_$e(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function iot(t){DZ=Cn.DECONFLICTOR_SHOW_VISIBLE,NZ=Cn.DECONFLICTOR_SHOW_INVISIBLE,PZ=DZ||NZ,LZ=Cn.DECONFLICTOR_SHOW_GRID,iR=null,PZ||LZ?iR=()=>rot(t):Eu&&(Eu.parentElement.removeChild(Eu),Eu=null)}function y$e(){iR&&(iR(),iR=null)}function rot(t){Eu==null&&(Eu=document.createElement("canvas"),Eu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Eu));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:n,height:s}=i,o=n*r,a=s*r;Eu.setAttribute("width",`${o}px`),Eu.setAttribute("height",`${a}px`),Eu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),fE=Eu.getContext("2d"),fE.clearRect(0,0,n,s),fE.font="12px Arial"}function _$e(t,e,i,r,n){y$e();const s=Eu.height,o=fE;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-i),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.closePath()}function not(t,e){PZ&&(e&&DZ||!e&&NZ)&&_$e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var ga,go;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(ga||(ga={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(go||(go={}));function v$e(t,e){return new x$e(t,T$e,e)}function sot(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:n}=T$e;return new x$e(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:aG.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:aG.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:aG.minPixelSize},e)}function oot(t){return Math.abs(t*t*t)}function w$e(t,e,i){const r=i.parameters;return lG.scale=Math.min(r.divisor/(e-r.offset),1),lG.factor=oot(t),lG}function Fee(t,e){return Bt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function aot(t,e,i){const r=w$e(t,e,i);return r.minScaleFactor=0,Fee(1,r)}function Rhe(t,e,i,r){r.scale=aot(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function b$e(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function lot(t,e,i,r){return Fee(t,w$e(e,i,r))}let x$e=class S$e{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,n=cot(),s){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=n,this._fontHeight=s,this._viewingMode===ct.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new S$e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:n,scaleFallOffRange:s}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:h,scaleFallOffFactor:p}=l,g=Math.sin(h)*a,y=.5*Math.PI-h-o*(.5-n*c),w=g/Math.cos(y),b=y+o*s*c,x=(w-p*(g/Math.cos(b)))/(1-p);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=x,r.divisor=w-x,r}_calculateCurvatureDependentParametersLocal(e,i,r=Ihe){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=Ihe){const n=this._description.curvatureDependent,s=1+e.distance/i,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=Oe((o-a)/(l-a),0,1),[h,p]=[n.min,n.max];return r.tiltAngle=Bt(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=Bt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return ESe(r.tiltAngle,e.fovY)}_surfaceCoverageCompensationGlobal(e,i,r){return XC(Phe,i),rK(Phe,r.tiltAngle,e.distance,e.fovY)}};const T$e={curvatureDependent:{min:{curvature:Wt(10),tiltAngle:Wt(12),scaleFallOffFactor:.5},max:{curvature:Wt(70),tiltAngle:Wt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},aG={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function cot(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const lG={scale:0,factor:0,minScaleFactor:0},Ihe={tiltAngle:0,scaleFallOffFactor:0},Phe=Pn();function uot(t){return t instanceof Float32Array&&t.length>=16}function hot(t){return Array.isArray(t)&&t.length>=16}function dot(t){return uot(t)||hot(t)}const yC={unknown:1,inches:Zr(1,"meters","inches"),feet:Zr(1,"meters","feet"),"us-feet":Zr(1,"meters","us-feet"),yards:Zr(1,"meters","yards"),miles:Zr(1,"meters","miles"),"nautical-miles":Zr(1,"meters","nautical-miles"),millimeters:Zr(1,"meters","millimeters"),centimeters:Zr(1,"meters","centimeters"),decimeters:Zr(1,"meters","decimeters"),meters:Zr(1,"meters","meters"),kilometers:Zr(1,"meters","kilometers"),"decimal-degrees":1/yke(1,"meters",Ii.radius)};var Ua,Lhe;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Ua||(Ua={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Lhe||(Lhe={}));let kee=class{constructor(e){this.field=e}},pot=class extends kee{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Ua.Undefined,Ua.Undefined,Ua.Undefined]}},fot=class extends kee{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},mot=class extends kee{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},got=class{};function O$(t){return t!=null}function CS(t){return typeof t=="number"}function Gz(t){return typeof t=="string"}function yot(t){return t==null||Gz(t)}function _ot(t,e,i,r=ut()){const n=t||0,s=e||0,o=i||0;return n!==0&&VE(r,r,-n/180*Math.PI),s!==0&&zE(r,r,s/180*Math.PI),o!==0&&xU(r,r,o/180*Math.PI),r}function N0(t,e,i,r,n){var a;const s=t.minSize,o=t.maxSize;if(t.useSymbolValue){const l=r.symbolSize[i];return e.minSize[i]=l,e.maxSize[i]=l,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Ua.DefinedSize,!0}if(O$(t.field))return O$(t.stops)?t.stops.length===2&&CS(t.stops[0].size)&&CS(t.stops[1].size)?(Dhe(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=Ua.DefinedSize,!0):!1:CS(s)&&CS(o)&&O$(t.minDataValue)&&O$(t.maxDataValue)?(Dhe(s,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=Ua.DefinedSize,!0):t.valueUnit==="unknown"?!1:yC[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/yC[t.valueUnit],e.type[i]=Ua.DefinedSize,!0):!1;if(!O$(t.field)){if((a=t.stops)!=null&&a[0]&&CS(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Ua.DefinedSize,!0;if(CS(s))return e.minSize[i]=s,e.maxSize[i]=s,e.offset[i]=s,e.factor[i]=0,e.type[i]=Ua.DefinedSize,!0}return!1}function Dhe(t,e,i,r,n,s){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-i*o,n.factor[s]=o}function vot(t,e,i,r){if(t.normalizationField||t.valueRepresentation||!yot(t.field))return null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return null}else e.size.field=t.field}else e.size=new pot(t.field);let n;switch(t.axis){case"width":return n=N0(t,e.size,0,i),n?e:null;case"height":return n=N0(t,e.size,2,i),n?e:null;case"depth":return n=N0(t,e.size,1,i),n?e:null;case"width-and-depth":return n=N0(t,e.size,0,i),n&&N0(t,e.size,1,i),n?e:null;case null:case void 0:case"all":return n=N0(t,e.size,0,i),n=n&&N0(t,e.size,1,i),n=n&&N0(t,e.size,2,i),n?e:null;default:return`${t.axis}`,null}}function wot(t,e,i){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===Ua.DefinedSize&&(s*=e.modelSize[n],t.type[n]=Ua.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let r;if(t.type[0]!==Ua.Undefined)r=0;else if(t.type[1]!==Ua.Undefined)r=1;else{if(t.type[2]===Ua.Undefined)return!1;r=2}for(let n=0;n<3;++n)t.type[n]===Ua.Undefined&&(t.minSize[n]=t.minSize[r],t.maxSize[n]=t.maxSize[r],t.offset[n]=t.offset[r],t.factor[n]=t.factor[r],t.type[n]=t.type[r]);return!0}function Nhe(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function bot(t,e,i){if(t.normalizationField)return null;if(Gz(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.color=new fot(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.color.values[n]=s.value,Nhe(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,Nhe(e.color.colors,n,r)}}return e}function xot(t,e,i){if(t.normalizationField)return null;if(Gz(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.opacity=new mot(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=r}}return e}function cG(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function Sot(t,e,i){if(!Gz(t.field))return null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return cG(t,e.rotation,0),e;case"roll":return cG(t,e.rotation,1),e;case null:case void 0:case"heading":return cG(t,e.rotation,2),e;default:return`${t.axis}`,null}}let l5t=class{constructor(e,i=[1,1,1],r=[1,1,1],n=1,s=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=n,this.anchor=s,this.scale=o,this.rotation=a}};function E$e(t,e,i){if(!t)return null;const r=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return null;switch(s.type){case"size":return e.supports.size?vot(s,n,e,i):n;case"color":return e.supports.color?bot(s,n):n;case"opacity":return e.supports.opacity?xot(s,n):null;case"rotation":return e.supports.rotation?Sot(s,n,i):n;default:return null}},new got);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r!=null&&r.size&&!wot(r.size,e)?null:r:null}let Tot=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function h5t(t,e){if(!t||Cn.TESTS_DISABLE_FAST_UPDATES)return null;const i=E$e(t.visualVariables,e);return i?new Tot(i,M$e(i,e),!!i.size):null}function d5t(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,n=E$e(e.visualVariables,i);return!!n&&!!(nD(r.size,n.size,"size")&&nD(r.color,n.color,"color")&&nD(r.rotation,n.rotation,"rotation")&&nD(r.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=M$e(n,i),t.requiresShaderTransformation=!!n.size,!0)}function nD(t,e,i){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&i==="rotation"){const r=t,n=e;for(let s=0;s<3;s++)if(r.type[s]!==n.type[s]||r.offset[s]!==n.offset[s]||r.factor[s]!==n.factor[s])return!1}return!0}let C$e=class extends Ar{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function M$e(t,e){const i=new C$e(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,Jp(rR),_ot(e.rotation[2],e.rotation[0],e.rotation[1],rR),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||In(),qv(i.vvSymbolRotationMatrix,rR)),i}function f5t(t,e,i){if(!t.vvSize)return i;ps(F0,i);const r=t.vvSymbolRotationMatrix;Im(rR,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),fs(F0,F0,rR);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];Fhe[n]=Oe(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return L1e(F0,F0,Fhe),hd(F0,F0,t.vvSymbolAnchor),F0}function Eot(t,e,i){if(!e.vvSize)return ve(t,1,1,1),t;for(let r=0;r<3;++r){const n=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=Oe(n,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function uG(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const F0=ut(),Fhe=A(),rR=ut();function Uee(t){t.vertex.code.add(C`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(C`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(C`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(C`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(C`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(C`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Cot(t){t.uniforms.add(new fi("screenSizePerspective",e=>$$e(e.screenSizePerspective)))}function Hz(t){t.uniforms.add(new fi("screenSizePerspectiveAlignment",e=>$$e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function $$e(t){return ve(Mot,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const Mot=A();let Uu=class extends Mn{constructor(e,i){super(e,"vec3",Fi.Draw,(r,n,s,o)=>r.setUniform3fv(e,i(n,s,o)))}},O$e=class extends Mn{constructor(e,i){super(e,"mat4",Fi.Draw,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};function Uv(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",ws):t.uniforms.add(new Uu("cameraPosition",(i,r)=>ve(A$e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function sy(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Bs("proj",(r,n)=>n.camera.projectionMatrix),new O$e("view",(r,n)=>hd(khe,n.camera.viewMatrix,r.origin)),new Uu("localOrigin",r=>r.origin));const i=r=>ve(A$e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Bs("proj",(r,n)=>n.camera.projectionMatrix),new Bs("view",(r,n)=>hd(khe,n.camera.viewMatrix,i(n))),new fi("localOrigin",(r,n)=>i(n)))}const khe=ut(),A$e=A();function mk(t){t.uniforms.add(new Bs("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function uI(t){t.uniforms.add(new rt("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}let Yr=class extends Mn{constructor(e,i){super(e,"vec4",Fi.Pass,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}};function R$e(t,e){const i=t.vertex;e.hasVerticalOffset?(I$e(i),e.hasScreenSizePerspective&&(t.include(Uee),Hz(i),Uv(t.vertex,e)),i.code.add(C`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?C`vec3 worldNormal = normalize(worldPos + localOrigin);`:C`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?C`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:C`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(C`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const $ot=Ti();function I$e(t){t.uniforms.add(new Yr("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return _n($ot,s*a,o,r,n)}))}const P$e=.5;function L$e(t,e){t.include(Uee),t.attributes.add(k.POSITION,"vec3"),t.attributes.add(k.NORMAL,"vec3"),t.attributes.add(k.CENTEROFFSETANDDISTANCE,"vec4");const i=t.vertex;sy(i,e),Uv(i,e),i.uniforms.add(new Yr("viewport",(r,n)=>n.camera.fullViewport),new rt("polygonOffset",r=>r.shaderPolygonOffset),new rt("cameraGroundRelative",(r,n)=>n.camera.aboveGround?1:-1)),e.hasVerticalOffset&&I$e(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(C`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(C`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.terrainDepthTest?C.float(0):C`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||mk(i),e.draped||(i.uniforms.add(new rt("perDistancePixelRatio",(r,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),i.code.add(C`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${C.float(P$e)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&uI(i),e.hasScreenSizePerspective&&Hz(i),i.code.add(C`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?C`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":C`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}const fn=1/255.5;function _d(){return!!pe("enable-feature:objectAndLayerId-rendering")}let zee=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}acquireTechnique(e,i){return this._techniques.acquire(e,this._material.getConfiguration(this._output,i))}ensureResources(e){return Nv.LOADED}},D$e=class extends zee{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){super.dispose(),this._texture=Lr(this._texture),this._textureNormal=Lr(this._textureNormal),this._textureEmissive=Lr(this._textureEmissive),this._textureOcclusion=Lr(this._textureOcclusion),this._textureMetallicRoughness=Lr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Nv.LOADED:Nv.LOADING}get textureBindParameters(){return new N$e(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Lr(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if(qu(r))return++this._numLoading,void r.then(n=>{if(this._disposed)return Lr(n),void i(null);i(n)}).finally(()=>--this._numLoading);i(r)}},Oot=class extends Ar{constructor(e=null){super(),this.textureEmissive=e}},N$e=class extends Oot{constructor(e=null,i=null,r=null,n=null,s=null,o,a){super(r),this.texture=e,this.textureNormal=i,this.textureOcclusion=n,this.textureMetallicRoughness=s,this.scale=o,this.normalTextureTransformMatrix=a}},Cm=class{constructor(){this.id=rd()}};var Fo;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Fo||(Fo={}));function F$e(t,e,i,r,n){let s=(i.screenLength||0)*t.pixelRatio;n!=null&&(s=lot(s,r,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Oe(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function Uhe(t,e){let i=!1;for(const r in e){const n=e[r];n!==void 0&&(Array.isArray(n)?Array.isArray(t[r])&&ym(n,t[r])||(t[r]=n.slice(),i=!0):t[r]!==n&&(i=!0,t[r]=n))}return i}const k$e={multiply:1,ignore:2,replace:3,tint:4};let qz=class extends Cm{constructor(e,i){super(),this.type=Fo.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=md,this._pp0=Qe(0,0,1),this._pp1=Qe(0,0,0),this._parameters=new i,Uhe(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){Uhe(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}queryRenderOccludedState(e){return this.visible&&this.parameters.renderOccluded===e}get hasEmissions(){return!1}intersectDraped(e,i,r,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,i,r,this._pp0,this._pp1,s)}};var Dr;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Dr||(Dr={}));let Aot=class extends Ar{constructor(){super(...arguments),this.renderOccluded=Dr.Occlude,this.isDecoration=!1}};var Ie;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.HUD_MATERIAL=12]="HUD_MATERIAL",t[t.LABEL_MATERIAL=13]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=14]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=16]="DRAPED_MATERIAL",t[t.DRAPED_WATER=17]="DRAPED_WATER",t[t.VOXEL=18]="VOXEL",t[t.MAX_SLOTS=19]="MAX_SLOTS"})(Ie||(Ie={}));let U$e=class{constructor(){this.factor=new zhe,this.factorAlignment=new zhe}},zhe=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function Rot(t,e,i,r=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=n[s[c]],i+=a;else for(let c=0;c<l;++c){const h=n[s[c]];for(let p=0;p<r;p++)o[i]=h,i+=a}}function Vhe(t,e,i){const{data:r,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length;i*=o;for(let l=0;l<a;++l){const c=2*n[l];s[i]=r[c],s[i+1]=r[c+1],i+=o}}function z$e(t,e,i,r){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const h=3*s[c];o[i]=n[h],o[i+1]=n[h+1],o[i+2]=n[h+2],i+=a}else for(let c=0;c<l;++c){const h=3*s[c];for(let p=0;p<r;++p)o[i]=n[h],o[i+1]=n[h+1],o[i+2]=n[h+2],i+=a}}function l3(t,e,i,r=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r===1)for(let c=0;c<l;++c){const h=4*s[c];o[i]=n[h],o[i+1]=n[h+1],o[i+2]=n[h+2],o[i+3]=n[h+3],i+=a}else for(let c=0;c<l;++c){const h=4*s[c];for(let p=0;p<r;++p)o[i]=n[h],o[i+1]=n[h+1],o[i+2]=n[h+2],o[i+3]=n[h+3],i+=a}}function Bhe(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<i;++s)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=n}function Vee(t,e,i,r,n=1){if(!e)return void z$e(t,i,r,n);const{data:s,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,h=e[0],p=e[1],g=e[2],y=e[4],w=e[5],b=e[6],x=e[8],T=e[9],M=e[10],$=e[12],R=e[13],I=e[14];r*=l;let P=0,N=0,V=0;const U=TU(e)?B=>{P=s[B]+$,N=s[B+1]+R,V=s[B+2]+I}:B=>{const W=s[B],j=s[B+1],Q=s[B+2];P=h*W+y*j+x*Q+$,N=p*W+w*j+T*Q+R,V=g*W+b*j+M*Q+I};if(n===1)for(let B=0;B<c;++B)U(3*o[B]),a[r]=P,a[r+1]=N,a[r+2]=V,r+=l;else for(let B=0;B<c;++B){U(3*o[B]);for(let W=0;W<n;++W)a[r]=P,a[r+1]=N,a[r+2]=V,r+=l}}function Bee(t,e,i,r,n=1){if(!e)return void z$e(t,i,r,n);const{data:s,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,h=o.length,p=a[0],g=a[1],y=a[2],w=a[4],b=a[5],x=a[6],T=a[8],M=a[9],$=a[10],R=!sQ(a),I=1e-6,P=1-I;r*=c;let N=0,V=0,U=0;const B=TU(a)?W=>{N=s[W],V=s[W+1],U=s[W+2]}:W=>{const j=s[W],Q=s[W+1],Z=s[W+2];N=p*j+w*Q+T*Z,V=g*j+b*Q+M*Z,U=y*j+x*Q+$*Z};if(n===1)if(R)for(let W=0;W<h;++W){B(3*o[W]);const j=N*N+V*V+U*U;if(j<P&&j>I){const Q=1/Math.sqrt(j);l[r]=N*Q,l[r+1]=V*Q,l[r+2]=U*Q}else l[r]=N,l[r+1]=V,l[r+2]=U;r+=c}else for(let W=0;W<h;++W)B(3*o[W]),l[r]=N,l[r+1]=V,l[r+2]=U,r+=c;else for(let W=0;W<h;++W){if(B(3*o[W]),R){const j=N*N+V*V+U*U;if(j<P&&j>I){const Q=1/Math.sqrt(j);N*=Q,V*=Q,U*=Q}}for(let j=0;j<n;++j)l[r]=N,l[r+1]=V,l[r+2]=U,r+=c}}function Iot(t,e,i,r,n=1){if(!e)return void l3(t,i,r,n);const{data:s,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,h=o.length,p=a[0],g=a[1],y=a[2],w=a[4],b=a[5],x=a[6],T=a[8],M=a[9],$=a[10],R=!sQ(a),I=1e-6,P=1-I;if(r*=c,n===1)for(let N=0;N<h;++N){const V=4*o[N],U=s[V],B=s[V+1],W=s[V+2],j=s[V+3];let Q=p*U+w*B+T*W,Z=g*U+b*B+M*W,X=y*U+x*B+$*W;if(R){const ge=Q*Q+Z*Z+X*X;if(ge<P&&ge>I){const ae=1/Math.sqrt(ge);Q*=ae,Z*=ae,X*=ae}}l[r]=Q,l[r+1]=Z,l[r+2]=X,l[r+3]=j,r+=c}else for(let N=0;N<h;++N){const V=4*o[N],U=s[V],B=s[V+1],W=s[V+2],j=s[V+3];let Q=p*U+w*B+T*W,Z=g*U+b*B+M*W,X=y*U+x*B+$*W;if(R){const ge=Q*Q+Z*Z+X*X;if(ge<P&&ge>I){const ae=1/Math.sqrt(ge);Q*=ae,Z*=ae,X*=ae}}for(let ge=0;ge<n;++ge)l[r]=Q,l[r+1]=Z,l[r+2]=X,l[r+3]=j,r+=c}}function V$e(t,e,i,r,n=1){const{data:s,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==s.length||e!==4)if(n!==1)if(e!==4)for(let h=0;h<c;++h){const p=3*o[h];for(let g=0;g<n;++g)a[r]=s[p],a[r+1]=s[p+1],a[r+2]=s[p+2],a[r+3]=255,r+=l}else for(let h=0;h<c;++h){const p=4*o[h];for(let g=0;g<n;++g)a[r]=s[p],a[r+1]=s[p+1],a[r+2]=s[p+2],a[r+3]=s[p+3],r+=l}else{if(e===4){for(let h=0;h<c;++h){const p=4*o[h];a[r]=s[p],a[r+1]=s[p+1],a[r+2]=s[p+2],a[r+3]=s[p+3],r+=l}return}for(let h=0;h<c;++h){const p=3*o[h];a[r]=s[p],a[r+1]=s[p+1],a[r+2]=s[p+2],a[r+3]=255,r+=l}}else{a[r]=s[0],a[r+1]=s[1],a[r+2]=s[2],a[r+3]=s[3];const h=new Uint32Array(i.typedBuffer.buffer,i.start),p=l/4,g=h[r/=4];r+=p;const y=c*n;for(let w=1;w<y;++w)h[r]=g,r+=p}}function Pot(t,e,i){const{data:r,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length,l=r[0];i*=o;for(let c=0;c<a;++c)s[i]=l,i+=o}function B$e(t,e,i,r,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(r*=o,n===1)for(let a=0;a<i;++a)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<n;++l)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o}function Lot(t,e,i,r,n,s,o){var a;for(const l of i.fields.keys()){const c=t.get(l),h=c==null?void 0:c.indices;if(c&&h)Dot(l,c,r,n,s,o);else if(l===k.OBJECTANDLAYERIDCOLOR&&e!=null){const p=(a=t.get(k.POSITION))==null?void 0:a.indices;if(p){const g=p.length;B$e(e,s.getField(l,Wc),g,o)}}}}function Dot(t,e,i,r,n,s){switch(t){case k.POSITION:{St(e.size===3);const o=n.getField(t,Fv);St(!!o,`No buffer view for ${t}`),o&&Vee(e,i,o,s);break}case k.NORMAL:{St(e.size===3);const o=n.getField(t,Fv);St(!!o,`No buffer view for ${t}`),o&&Bee(e,r,o,s);break}case k.NORMALCOMPRESSED:{St(e.size===2);const o=n.getField(t,Iz);St(!!o,`No buffer view for ${t}`),o&&Vhe(e,o,s);break}case k.UV0:{St(e.size===2);const o=n.getField(t,iI);St(!!o,`No buffer view for ${t}`),o&&Vhe(e,o,s);break}case k.COLOR:case k.SYMBOLCOLOR:{const o=n.getField(t,Wc);St(!!o,`No buffer view for ${t}`),St(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||V$e(e,e.size,o,s);break}case k.COLORFEATUREATTRIBUTE:{const o=n.getField(t,Oz);St(!!o,`No buffer view for ${t}`),St(e.size===1),o&&e.size===1&&Pot(e,o,s);break}case k.TANGENT:{St(e.size===4);const o=n.getField(t,sx);St(!!o,`No buffer view for ${t}`),o&&Iot(e,i,o,s);break}case k.PROFILERIGHT:case k.PROFILEUP:case k.PROFILEVERTEXANDNORMAL:case k.FEATUREVALUE:{St(e.size===4);const o=n.getField(t,sx);St(!!o,`No buffer view for ${t}`),o&&l3(e,o,s)}}}let M5t=class extends Ar{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function Not(t,e){j$e(t,e,new fi("slicePlaneOrigin",(i,r)=>W$e(e,i,r)),new fi("slicePlaneBasis1",(i,r)=>{var n;return gk(e,i,r,(n=r.slicePlane)==null?void 0:n.basis1)}),new fi("slicePlaneBasis2",(i,r)=>{var n;return gk(e,i,r,(n=r.slicePlane)==null?void 0:n.basis2)}))}function lm(t,e){j$e(t,e,new Uu("slicePlaneOrigin",(i,r)=>W$e(e,i,r)),new Uu("slicePlaneBasis1",(i,r)=>{var n;return gk(e,i,r,(n=r.slicePlane)==null?void 0:n.basis1)}),new Uu("slicePlaneBasis2",(i,r)=>{var n;return gk(e,i,r,(n=r.slicePlane)==null?void 0:n.basis2)}))}function j$e(t,e,...i){if(!e.hasSlicePlane){const o=C`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}const r=C`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=C`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?C`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:C`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i).code.add(r),t.fragment.uniforms.add(...i).code.add(r),t.fragment.code.add(s)}function G$e(t,e,i){return t.instancedDoublePrecision?ve(Fot,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function H$e(t,e){return t!=null?Ae(yk,e.origin,t):e.origin}function q$e(t,e,i){return t.hasSliceTranslatedView?e!=null?hd(kot,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function W$e(t,e,i){if(i.slicePlane==null)return ws;const r=G$e(t,e,i),n=H$e(r,i.slicePlane),s=q$e(t,r,i);return s!=null?Mt(yk,n,s):n}function gk(t,e,i,r){if(r==null||i.slicePlane==null)return ws;const n=G$e(t,e,i),s=H$e(n,i.slicePlane),o=q$e(t,n,i);return o!=null?(xe(A$,r,s),Mt(yk,s,o),Mt(A$,A$,o),Ae(A$,A$,yk)):r}const Fot=A(),yk=A(),A$=A(),kot=ut();function jee(t,e){if(e.output!==J.ObjectAndLayerIdColor)return t.vertex.code.add(C`void forwardObjectAndLayerIdColor() {}`),void t.fragment.code.add(C`void outputObjectAndLayerIdColor() {}`);const i=e.objectAndLayerIdColorInstanced;t.varyings.add("objectAndLayerIdColorVarying","vec4"),t.attributes.add(i?k.INSTANCEOBJECTANDLAYERIDCOLOR:k.OBJECTANDLAYERIDCOLOR,"vec4"),t.vertex.code.add(C`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${i?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),t.fragment.code.add(C`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}let Ay=class extends Mn{constructor(e,i){super(e,"bool",Fi.Pass,(r,n,s)=>r.setUniform1b(e,i(n,s)))}};function Wz(t){t.uniforms.add(new Ay("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(C`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(C`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function qy(t){t.uniforms.add(new rs("zProjectionMap",(e,i)=>Uot(i.camera))),t.code.add(C`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(C`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(C`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function Uot(t){const e=t.projectionMatrix;return ln(zot,e[14],e[10])}const zot=Yt();function hI(t,{occlusionPass:e,terrainDepthTest:i,cullAboveTerrain:r}){i?(t.fragment.include(qy),t.fragment.uniforms.add(new ht("terrainDepthTexture",(n,s)=>{var o;return(o=s.terrainDepth)==null?void 0:o.attachment})).code.add(C`
   ${e?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${e?C`return fragmentDepth < linearDepth && depth < 1.0;`:C`if(fragmentDepth ${r?">":"<="} linearDepth) discard;`}
    }`)):e?t.fragment.code.add(C`#define terrainDepthTest(fragmentDepth) false`):t.fragment.code.add(C`#define terrainDepthTest(fragmentDepth) {}`)}function Vot(t,e){const{vertex:i,fragment:r}=t;t.include(hI,e),i.include(Wz),e.terrainDepthTest&&t.varyings.add("depth","float"),i.main.add(C`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.terrainDepthTest?C`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `),r.main.add(C`fragColor = vec4(1);
if(terrainDepthTest(depth)) {
fragColor.g = 0.5;
}`)}var pl;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(pl||(pl={}));function Z$e(t){t.vertex.uniforms.add(new rt("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===pl.Occluded?1:i.hudRenderStyle===pl.NotOccluded?0:.75),new Yr("viewport",(e,i)=>i.camera.fullViewport),new ht("hudVisibilityTexture",(e,i)=>{var r;return(r=i.hudVisibility)==null?void 0:r.getTexture()})),t.vertex.include(Wz),t.vertex.code.add(C`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}let FZ=class extends Mn{constructor(e,i){super(e,"ivec2",Fi.Pass,(r,n,s)=>r.setUniform2iv(e,i(n,s)))}},Mm=class extends Mn{constructor(e,i){super(e,"int",Fi.Pass,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};function dI(t,e){const{fragment:i}=t;e.output===J.Highlight?(i.uniforms.add(new ht("depthTexture",(r,n)=>n.mainDepth),new ht("highlightTexture",(r,n)=>n.highlightMixTexture),new Mm("highlightLevel",(r,n)=>n.highlightLevel),new FZ("highlightMixOrigin",(r,n)=>n.highlightMixOrigin)),t.outputs.add("fragHighlight","vec2",0),i.code.add(C`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),e.canHaveOverlay&&(i.constants.add("occlusionAndMask","int",85),i.code.add(C`void outputAllHighlights(vec2 highlightToAdd) {
if (highlightToAdd == vec2(0.0)) { discard; }
int occludedOrMask = isHighlightOccluded() ? 0xaa : 0;
ivec2 added = ivec2(highlightToAdd * 255.0);
ivec2 masked = (added & ivec2(occlusionAndMask)) | (ivec2(occludedOrMask) & (added<<1));
fragHighlight = vec2(masked) / 255.0;
}`))):i.code.add(C`void calculateOcclusionAndOutputHighlight() {}`)}let Bot=class extends Mn{constructor(e,i,r){super(e,"vec4",Fi.Pass,(n,s,o)=>n.setUniform4fv(e,i(s,o)),r)}},Xh=class extends Mn{constructor(e,i,r){super(e,"float",Fi.Pass,(n,s,o)=>n.setUniform1fv(e,i(s,o)),r)}},jot=class extends C$e{constructor(){super(...arguments),this.renderOccluded=Dr.Occlude,this.isDecoration=!1}};const hG=8;function Pb(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(k.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new fi("vvSizeMinSize",n=>n.vvSize.minSize)),i.uniforms.add(new fi("vvSizeMaxSize",n=>n.vvSize.maxSize)),i.uniforms.add(new fi("vvSizeOffset",n=>n.vvSize.offset)),i.uniforms.add(new fi("vvSizeFactor",n=>n.vvSize.factor)),i.uniforms.add(new xd("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),i.uniforms.add(new fi("vvSymbolAnchor",n=>n.vvSymbolAnchor)),i.code.add(C`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(C`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?C`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(C`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",hG),i.uniforms.add(new Xh("vvColorValues",n=>n.vvColor.values,hG),new Bot("vvColorColors",n=>n.vvColor.colors,hG)),i.code.add(C`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?C`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(C`vec4 vvColor() { return vec4(1.0); }`)}function aM(t){t.code.add(C`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function t1(t){t.code.add(C`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),t.code.add(C`const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`),t.code.add(C`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}let c3=class extends Mn{constructor(e,i){super(e,"vec4",Fi.Draw,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}};var qi;(function(t){t[t.NONE=0]="NONE",t[t.ColorAlpha=1]="ColorAlpha",t[t.FrontFace=2]="FrontFace",t[t.COUNT=3]="COUNT"})(qi||(qi={}));const Gee={occludedFadeFactor:.6};function Y$e(t){const e=new or,i=t.signedDistanceFieldEnabled;if(e.include(L$e,t),e.include(lm,t),t.occlusionPass)return e.include(Vot,t),e;const{vertex:r,fragment:n}=e;e.include(Uee),e.include(Pb,t),e.include(jee,t),e.include(Z$e),n.include(t1),n.include(aM),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new Yr("viewport",(h,p)=>p.camera.fullViewport),new rs("screenOffset",(h,p)=>ln(X$e,2*h.screenOffset[0]*p.camera.pixelRatio,2*h.screenOffset[1]*p.camera.pixelRatio)),new rs("anchorPosition",h=>u3(h)),new Yr("materialColor",h=>h.color),new rt("materialRotation",h=>h.rotation)),uI(r),i&&(r.uniforms.add(new Yr("outlineColor",h=>h.outlineColor)),n.uniforms.add(new Yr("outlineColor",h=>jhe(h)?h.outlineColor:hs),new rt("outlineSize",h=>jhe(h)?h.outlineSize:0))),t.horizonCullingEnabled&&r.uniforms.add(new c3("pointDistanceSphere",(h,p)=>{const g=p.camera.eye,y=h.origin;return Ri(y[0]-g[0],y[1]-g[1],y[2]-g[2],Ii.radius)})),t.pixelSnappingEnabled&&r.include(Wz),t.hasScreenSizePerspective&&(Cot(r),Hz(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(k.UV0,"vec2"),e.attributes.add(k.COLOR,"vec4"),e.attributes.add(k.SIZE,"vec2"),e.attributes.add(k.ROTATION,"float"),e.attributes.add(k.FEATUREATTRIBUTE,"vec4"),r.code.add(t.horizonCullingEnabled?C`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:C`bool behindHorizon(vec3 posModel) { return false; }`),r.main.add(C`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${Ge(t.hasScreenSizePerspective,C`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,C`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${Ge(t.vvSize,C`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const s=C`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${Ge(t.hasRotation,C`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,o=t.pixelSnappingEnabled?i?C`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:C`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:C`posProj += quadOffset;`;r.main.add(C`
    ${Ge(t.occlusionTestEnabled,C`
      if (!visible) {
        vtc = vec2(0.0);
        ${Ge(t.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${Ge(t.output===J.ObjectAndLayerIdColor,C`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${C.float(fn)};
    ${Ge(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${C.float(fn)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${Ge(t.debugDrawLabelBorder,C`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),n.uniforms.add(new ht("tex",h=>h.texture)),t.occludedFragmentFade&&(n.uniforms.add(new ht("depthMap",(h,p)=>p.mainDepth)),n.uniforms.add(new rt("fadeFactor",()=>Gee.occludedFadeFactor)));const a=t.debugDrawLabelBorder?C`(isBorder > 0.0 ? 0.0 : ${C.float(fn)})`:C.float(fn),l=t.output===J.Highlight,c=C`
    ${Ge(t.debugDrawLabelBorder,C`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${Ge(t.sampleSignedDistanceFieldTexelCenter,C`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,C`vec2 samplePos = vtc;`)}

    ${i?C`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${C.float(fn)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${Ge(!l,C`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        ${Ge(!l,C`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:C`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          ${Ge(!l,C`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${Ge(t.occludedFragmentFade&&!l,C`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= fadeFactor;
        }
        `)}

    ${Ge(!l&&t.debugDrawLabelBorder,C`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(t.output){case J.Color:t.oitPass===qi.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),n.main.add(C`
        ${c}
        ${Ge(t.oitPass===qi.FrontFace,C`fragColor.rgb /= fragColor.a;`)}
        ${Ge(t.oitPass===qi.ColorAlpha,C`fragAlpha = fragColor.a;`)}`);break;case J.ObjectAndLayerIdColor:n.main.add(C`
        ${c}
        outputObjectAndLayerIdColor();`);break;case J.Highlight:e.include(dI,t),n.main.add(C`
        ${c}
        outputHighlight(voccluded == 1.0);`)}return e}function jhe(t){return t.outlineColor[3]>0&&t.outlineSize>0}function u3(t,e=X$e){return t.textureIsSignedDistanceField?Got(t.anchorPosition,t.distanceFieldBoundingBox,e):Ha(e,t.anchorPosition),e}function Got(t,e,i){e!=null?ln(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):ln(i,0,0)}const X$e=Yt(),Hot=Object.freeze(Object.defineProperty({__proto__:null,build:Y$e,calculateAnchorPosForRendering:u3,shaderSettings:Gee},Symbol.toStringTag,{value:"Module"})),J$e=e1(ei.ONE,ei.ZERO,ei.ONE,ei.ONE_MINUS_SRC_ALPHA);function qot(t){return t===qi.FrontFace?null:J$e}function Hee(t){switch(t){case qi.NONE:return gd;case qi.ColorAlpha:return J$e;case qi.FrontFace:case qi.COUNT:return null}}function Q$e(t){if(t.draped)return null;switch(t.oitPass){case qi.NONE:case qi.FrontFace:return t.writeDepth?tI:null;case qi.ColorAlpha:case qi.COUNT:return null}}const Wot=5e5,qee={factor:-1,units:-2};function Zot(t){return t?qee:null}function Wee(t,e=gr.LESS){return t===qi.NONE||t===qi.FrontFace?e:gr.LEQUAL}function Zz(t,e){const i=nee(e);return t===qi.ColorAlpha?i?{buffers:[Sn.COLOR_ATTACHMENT0,Sn.COLOR_ATTACHMENT1,Sn.COLOR_ATTACHMENT2]}:{buffers:[Sn.COLOR_ATTACHMENT0,Sn.COLOR_ATTACHMENT1]}:i?{buffers:[Sn.COLOR_ATTACHMENT0,Sn.COLOR_ATTACHMENT1]}:null}let Yot=class extends hr{constructor(e,i,r){super(e,i,new ar(Hot,()=>fe(()=>Promise.resolve().then(()=>KOt),void 0)),r),this.primitiveType=i.occlusionPass?ur.POINTS:ur.TRIANGLES}initializePipeline(e){const{oitPass:i,hasPolygonOffset:r,draped:n,output:s,depthTestEnabled:o}=e,a=i===qi.NONE,l=r?Xot:null,c=i===qi.ColorAlpha,h=n||!o||c||s===J.Highlight?null:tI;return Pi({blending:s===J.Color?a?iM:qot(i):null,depthTest:o&&!n?{func:gr.LEQUAL}:null,depthWrite:h,drawBuffers:Zz(i,s),colorWrite:Qi,polygonOffset:l})}};const Xot={factor:0,units:-4};var ts;function oy(t,e){switch(e.textureCoordinateType){case ts.Default:return t.attributes.add(k.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(C`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case ts.Compressed:return t.attributes.add(k.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(C`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case ts.Atlas:return t.attributes.add(k.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(k.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(C`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case ts.None:return void t.vertex.code.add(C`void forwardTextureCoordinates() {}`);case ts.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(ts||(ts={}));function Jot(t){t.fragment.code.add(C`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function Yz(t,e){const{textureCoordinateType:i}=e;if(i===ts.None||i===ts.COUNT)return;t.include(oy,e);const r=i===ts.Atlas;r&&t.include(Jot),t.fragment.code.add(C`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${r?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}let $m=class extends Mn{constructor(e,i){super(e,"sampler2D",Fi.Draw,(r,n,s)=>r.bindTexture(e,i(n,s)))}};var ko;(function(t){t[t.None=0]="None",t[t.Value=1]="Value",t[t.Texture=2]="Texture",t[t.COUNT=3]="COUNT"})(ko||(ko={}));function Qot(t,e){if(!yd(e.output))return;const{emissionSource:i,hasEmissiveTextureTransform:r,bindType:n}=e,s=i===ko.Texture;s&&(t.include(Yz,e),t.fragment.uniforms.add(n===Fi.Pass?new ht("texEmission",a=>a.textureEmissive):new $m("texEmission",a=>a.textureEmissive)));const o=i===ko.Value||s;o&&t.fragment.uniforms.add(n===Fi.Pass?new fi("emissionFactor",a=>a.emissiveFactor):new Uu("emissionFactor",a=>a.emissiveFactor)),t.fragment.code.add(C`
    vec4 getEmissions() {
      vec4 emissions = ${o?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${Ge(s,`emissions *= textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)};
      return emissions;
    }
  `)}let kZ=class extends Zu{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};u([le()],kZ.prototype,"instancedDoublePrecision",void 0),u([le()],kZ.prototype,"hasModelTransformation",void 0);let Ry=class extends kZ{constructor(){super(...arguments),this.output=J.Color,this.oitPass=qi.NONE,this.hasSliceHighlight=!0,this.hasSliceInVertexProgram=!1,this.bindType=Fi.Pass,this.writeDepth=!0}};u([le({count:J.COUNT})],Ry.prototype,"output",void 0),u([le({count:qi.COUNT})],Ry.prototype,"oitPass",void 0);let Is=class extends Ry{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.textureCoordinateType=ts.None,this.emissionSource=ko.None,this.discardInvisibleFragments=!0,this.hasSliceInVertexProgram=!0,this.hasVvInstancing=!1}};u([le()],Is.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([le()],Is.prototype,"occlusionTestEnabled",void 0),u([le()],Is.prototype,"signedDistanceFieldEnabled",void 0),u([le()],Is.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),u([le()],Is.prototype,"vvSize",void 0),u([le()],Is.prototype,"vvColor",void 0),u([le()],Is.prototype,"hasVerticalOffset",void 0),u([le()],Is.prototype,"hasScreenSizePerspective",void 0),u([le()],Is.prototype,"hasRotation",void 0),u([le()],Is.prototype,"debugDrawLabelBorder",void 0),u([le()],Is.prototype,"hasSlicePlane",void 0),u([le()],Is.prototype,"hasPolygonOffset",void 0),u([le()],Is.prototype,"depthTestEnabled",void 0),u([le()],Is.prototype,"pixelSnappingEnabled",void 0),u([le()],Is.prototype,"draped",void 0),u([le()],Is.prototype,"terrainDepthTest",void 0),u([le()],Is.prototype,"cullAboveTerrain",void 0),u([le()],Is.prototype,"occlusionPass",void 0),u([le()],Is.prototype,"occludedFragmentFade",void 0),u([le()],Is.prototype,"objectAndLayerIdColorInstanced",void 0),u([le()],Is.prototype,"horizonCullingEnabled",void 0);let Xz=class extends qz{constructor(e,i){super(e,lat),this.produces=new Map([[Ie.HUD_MATERIAL,r=>TF(r)&&!this.parameters.drawInSecondSlot],[Ie.LABEL_MATERIAL,r=>TF(r)&&this.parameters.drawInSecondSlot],[Ie.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[Ie.DRAPED_MATERIAL,r=>this.parameters.draped&&TF(r)]]),this._visible=!0,this._configuration=new Is(i)}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===Ie.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.depthTestEnabled=this.parameters.depthEnabled||i.slot===Ie.OCCLUSION_PIXELS,e===J.Color&&(this._configuration.debugDrawLabelBorder=!!Cn.LABELS_SHOW_BORDER),this._configuration.oitPass=i.oitPass,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration}intersect(e,i,r,n,s,o){const{options:{selectionMode:a,hud:l,excludeLabels:c},point:h,camera:p}=r,{parameters:g}=this;if(!a||!l||c&&g.isLabel||!e.visible||!h)return;const{scaleX:y,scaleY:w}=this._getScreenScale(e,p.pixelRatio);qv(pG,i),e.attributes.has(k.FEATUREATTRIBUTE)&&tat(pG);const b=e.attributes.get(k.POSITION),x=e.attributes.get(k.SIZE),T=e.attributes.get(k.NORMAL),M=e.attributes.get(k.ROTATION),$=e.attributes.get(k.CENTEROFFSETANDDISTANCE);St(b.size>=3);const R=u3(g),I=this.parameters.centerOffsetUnits==="screen";for(let P=0;P<b.data.length/b.size;P++){const N=P*b.size;ve(Ma,b.data[N],b.data[N+1],b.data[N+2]),Mt(Ma,Ma,i),Mt(Ma,Ma,p.viewMatrix);const V=P*$.size;if(ve(lu,$.data[V],$.data[V+1],$.data[V+2]),!I&&(Ma[0]+=lu[0],Ma[1]+=lu[1],lu[2]!==0)){const B=lu[2];Me(lu,Ma),Ae(Ma,Ma,ue(lu,lu,B))}const U=P*T.size;if(ve(R$,T.data[U],T.data[U+1],T.data[U+2]),Ghe(R$,pG,p,mG),this._applyVerticalOffsetTransformationView(Ma,mG,p,dG),p.applyProjection(Ma,il),il[0]>-1){I&&(lu[0]||lu[1])&&(il[0]+=lu[0]*p.pixelRatio,lu[1]!==0&&(il[1]+=Fee(lu[1],dG.factorAlignment)*p.pixelRatio),p.unapplyProjection(il,Ma)),il[0]+=this.parameters.screenOffset[0]*p.pixelRatio,il[1]+=this.parameters.screenOffset[1]*p.pixelRatio,il[0]=Math.floor(il[0]),il[1]=Math.floor(il[1]);const B=P*x.size;hc[0]=x.data[B],hc[1]=x.data[B+1],b$e(hc,dG.factor,hc);const W=sat*p.pixelRatio;let j=0;g.textureIsSignedDistanceField&&(j=Math.min(g.outlineSize,.5*hc[0])*p.pixelRatio/2),hc[0]*=y,hc[1]*=w;const Q=P*M.size,Z=g.rotation+M.data[Q];if(Hhe(h,il[0],il[1],hc,W,j,Z,g,R)){const X=r.ray;if(Mt(qhe,Ma,Yl(rat,p.viewMatrix)),il[0]=h[0],il[1]=h[1],p.unprojectFromRenderScreen(il,Ma)){const ge=A();ye(ge,X.direction);const ae=1/Fe(ge);ue(ge,ge,ae),o(Nr(X.origin,Ma)*ae,ge,-1,!0,1,qhe)}}}}}intersectDraped(e,i,r,n,s,o){const a=e.attributes.get(k.POSITION),l=e.attributes.get(k.SIZE),c=e.attributes.get(k.ROTATION),h=this.parameters,p=u3(h),{scaleX:g,scaleY:y}=this._getScreenScale(e,e.screenToWorldRatio),w=oat*e.screenToWorldRatio;for(let b=0;b<a.data.length/a.size;b++){const x=b*a.size,T=a.data[x],M=a.data[x+1],$=b*l.size;hc[0]=l.data[$],hc[1]=l.data[$+1];let R=0;h.textureIsSignedDistanceField&&(R=Math.min(h.outlineSize,.5*hc[0])*e.screenToWorldRatio/2),hc[0]*=g,hc[1]*=y;const I=b*c.size,P=h.rotation+c.data[I];Hhe(n,T,M,hc,w,R,P,h,p)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new uat}_updateScaleInfo(e,i,r){const n=this.parameters;n.screenSizePerspective!=null?Rhe(r,i,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),n.screenSizePerspectiveAlignment!=null?Rhe(r,i,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,n,s,o,a){const l=Ghe(i,r,s,mG);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,i,r,n,s){return this._applyCenterOffsetNDC(e,i,r,n),s!=null&&ye(s,n),this._applyPolygonOffsetNDC(n,i,r,n),n}_applyPolygonOffsetView(e,i,r,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ye(s,e);const c=Oe(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/n.viewport[2];return ue(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,i,r,n){const s=Fe(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(s)*P$e,l=ue(Ma,i.normal,o*a);return xe(n,e,l),n}_applyVerticalOffsetTransformationView(e,i,r,n){var c;const s=this.parameters;if(!((c=s.verticalOffset)!=null&&c.screenLength)){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const h=Fe(e);this._updateScaleInfo(n,h,i.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=Fe(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,l=F$e(r,o,s.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(n,o,i.cosAngle),ue(i.normal,i.normal,l),xe(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const n=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ye(r,e),n&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Me(R$,r),xe(r,r,ue(R$,R$,i[2])))),r}_applyCenterOffsetNDC(e,i,r,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&ye(n,e),s||(n[0]+=i[0]/r.fullWidth*2,n[1]+=i[1]/r.fullHeight*2),n}_applyPolygonOffsetNDC(e,i,r,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&ye(n,e),s){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);n[2]-=(a||o)*s}return n}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:i,outlineColor:r}=this.parameters,n=e[3]>=fn||i>=fn&&r[3]>=fn;return this._visible&&n}createGLMaterial(e){return new Kot(e)}calculateRelativeScreenBounds(e,i,r=Zi()){return eat(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,i){const r=e.attributes.get(k.FEATUREATTRIBUTE);if(r==null)return{scaleX:i,scaleY:i};const n=VQ(r.data,nat);return Eot(fG,this.parameters,n),{scaleX:fG[0]*i,scaleY:fG[1]*i}}},Kot=class extends D$e{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(Yot,e)}};function eat(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function Ghe(t,e,i,r){return dot(e)&&(e=qv(iat,e)),Zl(r.normal,t,e),Mt(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Te(K$e,aat),r}function tat(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),p=1/Math.sqrt(n*n+s*s+o*o),g=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=n*p,t[4]=s*p,t[5]=o*p,t[6]=a*g,t[7]=l*g,t[8]=c*g,t}function Hhe(t,e,i,r,n,s,o,a,l){let c=e-n-r[0]*l[0],h=c+r[0]+2*n,p=i-n-r[1]*l[1],g=p+r[1]+2*n;const y=a.distanceFieldBoundingBox;return a.textureIsSignedDistanceField&&y!=null&&(c+=r[0]*y[0],p+=r[1]*y[1],h-=r[0]*(1-y[2]),g-=r[1]*(1-y[3]),c-=s,h+=s,p-=s,g+=s),ln(Whe,e,i),kTe(I$,t,Whe,Wt(o)),I$[0]>c&&I$[0]<h&&I$[1]>p&&I$[1]<g}const dG=new U$e,Ma=A(),R$=A(),il=Ti(),K$e=A(),qhe=A(),I$=Yt(),Whe=Yt(),pG=In(),iat=In(),rat=ut(),lu=A(),fG=A(),nat=Ti(),mG={normal:K$e,cosAngle:0},sat=1,oat=2,hc=[0,0],aat=Qe(0,0,1);class lat extends N$e{constructor(){super(...arguments),this.renderOccluded=Dr.Occlude,this.isDecoration=!1,this.color=M5(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=ks(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=M5(1,1,1,1),this.outlineSize=0,this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1,this.isLabel=!1}}const eOe=Zc().vec3f(k.POSITION).vec3f(k.NORMAL).vec2f(k.UV0).vec4u8(k.COLOR).vec2f(k.SIZE).f32(k.ROTATION).vec4f(k.CENTEROFFSETANDDISTANCE).vec4f(k.FEATUREATTRIBUTE),cat=eOe.clone().vec4u8(k.OBJECTANDLAYERIDCOLOR);class uat{constructor(){this.vertexBufferLayout=_d()?cat:eOe}elementCount(e){return 6*e.get(k.POSITION).indices.length}write(e,i,r,n,s,o){var M,$;Vee(r.get(k.POSITION),e,s.position,o,6),Bee(r.get(k.NORMAL),i,s.normal,o,6);const a=(M=r.get(k.UV0))==null?void 0:M.data;let l=0,c=0,h=1,p=1;a&&a.length>=4&&(l=a[0],c=a[1],h=a[2],p=a[3]),h=Math.min(1.99999,h+1),p=Math.min(1.99999,p+1);let g=r.get(k.POSITION).indices.length,y=o;const w=s.uv0;for(let R=0;R<g;++R)w.set(y,0,l),w.set(y,1,c),y++,w.set(y,0,h),w.set(y,1,c),y++,w.set(y,0,h),w.set(y,1,p),y++,w.set(y,0,h),w.set(y,1,p),y++,w.set(y,0,l),w.set(y,1,p),y++,w.set(y,0,l),w.set(y,1,c),y++;V$e(r.get(k.COLOR),4,s.color,o,6);const{data:b,indices:x}=r.get(k.SIZE);g=x.length;const T=s.size;y=o;for(let R=0;R<g;++R){const I=b[2*x[R]],P=b[2*x[R]+1];for(let N=0;N<6;++N)T.set(y,0,I),T.set(y,1,P),y++}if(Rot(r.get(k.ROTATION),s.rotation,o,6),r.get(k.CENTEROFFSETANDDISTANCE)?l3(r.get(k.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,o,6):Bhe(s.centerOffsetAndDistance,o,6*g),r.get(k.FEATUREATTRIBUTE)?l3(r.get(k.FEATUREATTRIBUTE),s.featureAttribute,o,6):Bhe(s.featureAttribute,o,6*g),n!=null){const R=($=r.get(k.POSITION))==null?void 0:$.indices;if(R){const I=R.length,P=s.getField(k.OBJECTANDLAYERIDCOLOR,Wc);B$e(n,P,I,o,6)}}}}const vf=A(),MS=Ti(),P$=Ti(),gG=A(),hat=ut(),dat=Pn(),yG=zs(),pat=A(),fat=Zi();class mat{constructor(){this.aabr=Zi(),this.distance=0,this.culled=!1,this.visible=!1}}class gat{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var Ec;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Ec||(Ec={}));class yat{constructor(){this.camera=new Jr,this.slicePlane=Wv(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),bx(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let R2=class extends Ne{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new yat,this._state=Ec.Idle,this._active=new Map,this._visible=new Map,this._iterators=new bat,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Ec.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Ec.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Ec.Idle:this._startUpdate(),t.madeProgress();case Ec.Process:if(this._state=Ec.Process,!this._processActiveGraphics(t))return;case Ec.Sort:if(this._state=Ec.Sort,!this._sortVisibleGraphics(t))return;case Ec.Deconflict:if(this._state=Ec.Deconflict,!this._deconflictVisibleGraphics(t))return;default:tot(this,this._visible),this._state=Ec.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof Xz}_startUpdate(){iot(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new mat,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),_at(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=iQ(hat,this._viewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?dat:null;let n=0;for(r!=null&&(Mt(r,ws,this._viewState.camera.viewMatrix),r[3]=xr(this.view.spatialReference).radius,n=FSe(r,ws));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o==null?void 0:o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===go.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=r.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}const o=n.graphics3DGraphic,a=!i||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),not(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Zhe(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Zhe(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=vat(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(go.GRAPHIC,ga.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);wy(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=Eat,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,vf)||i!=null&&Tat(a,i,r)))return void(s.culled=!0);this._expandBoundingRect(s,l,c,a)}a==null?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,i){const r=this._viewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;Mt(vf,a,r.viewMatrix);const l=s.attributes,c=l.get(k.NORMAL).data,h=l.get(k.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(vf,c,n.transformation,h,r,i.scaleInfo,vf),_n(MS,vf[0],vf[1],vf[2],1),zc(P$,MS,r.projectionMatrix),ue(i.positionNDC,P$,1/P$[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,gG),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(gG[2]),i.distance=gG[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),_n(P$,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),zc(MS,P$,e),KE(MS,MS,1/MS[3]),ve(i.positionView,vf[0],vf[1],vf[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&KQ(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:n}){const s=this._viewState.camera,o=e.getScreenSize(xat);b$e(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=c5(i.calculateRelativeScreenBounds(o,n.factorAlignment.scale,fat),Bt(0,s.fullWidth,.5+.5*r[0]),Bt(0,s.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(Va(a),Uc(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Q2(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let n=Math.floor(i.aabr[0]/this._accBinsSizeX);n<=Math.floor(i.aabr[2]/this._accBinsSizeX);n++)if(!(n<0||n>=this._accBinsNumX))for(let s=Math.floor(i.aabr[1]/this._accBinsSizeY);s<=Math.floor(i.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;r=!1;const o=this._accBins[n][s];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,$U(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)r.push(new mi)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,ga.DECONFLICTION,e),this.visibilityGroup===go.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function _at(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,ga.DECONFLICTION,!0)}function*Zhe(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*vat(t,e,i){e.clear(),t.forEach((n,s)=>{var l;const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(i,ga.DECONFLICTION);const a=(l=n.info)==null?void 0:l[i];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=r.next();!n.done;n=r.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}u([f({constructOnly:!0})],R2.prototype,"view",void 0),u([f({type:Boolean,readOnly:!0})],R2.prototype,"updating",null),R2=u([L("esri.views.3d.layers.graphics.Deconflictor")],R2);class wat{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class bat{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new mi({allocator:n=>n||new wat})}}const xat=Yt();class Sat{constructor(){this.positionView=A(),this.positionNDC=A(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new U$e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}function Tat(t,e,i){return ye(yG.direction,t.positionView),ve(yG.origin,0,0,0),!!Zv(e,yG,pat)&&t.distanceWithoutPolygonOffset>i}const Eat=new Sat,Cat=2e3;let FF=class extends R2{constructor(e){super(e),this.visibilityGroup=go.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return jo;const i=performance.now();if(e.state!==Di.IDLE&&i-this._lastDeconfliction<Cat)return jo;super.runTask(e),this.state===Ec.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([f({constructOnly:!0})],FF.prototype,"parent",void 0),FF=u([L("esri.views.3d.layers.graphics.LabelDeconflictor")],FF);let UZ=class extends R2{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=go.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([oe(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),oe(()=>{var e,i,r;return(r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity},(e,i)=>{e!==1&&i!==1||this.setDirty()}),oe(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Si)]),this._frameTask=this.view.resourceController.scheduler.registerTask(xt.GRAPHICS_DECONFLICTOR,this),this._labels=new FF({view:this.view,parent:this})}destroy(){this._labels=Ye(this._labels),this._frameTask=Sr(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&OSe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){for(const e of this._contexts.keys())if(e.symbolCreationContext.slicePlaneEnabled)return void this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const n=r.graphic.uid,s=new gat(r,e.symbolCreationContext.slicePlaneEnabled);i.set(n,s),_G(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s);const o=!this._graphicSupportsDeconfliction(r)||!_G(e);r.setVisibilityFlag(go.GRAPHIC,ga.DECONFLICTION,o)}_removeGraphic(e,i){const r=i.graphic.uid,n=e.get(r);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=_G(e);r||Mat(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(n=>n.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!(i!=null&&i.length))return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function _G(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function Mat(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(go.GRAPHIC,ga.DECONFLICTION,!0))}UZ=u([L("esri.views.3d.layers.graphics.GraphicsDeconflictor")],UZ);function tOe(t){return"declaredClass"in t}function Yhe(t){return"declaredClass"in t}function $at(t){return"declaredClass"in t}function Oat(t,e){return t?$at(t)?t:new qc({layer:e,sourceLayer:e,visible:t.visible,symbol:te(t.symbol),attributes:te(t.attributes),geometry:iOe(t.geometry)}):null}function iOe(t){return t==null?null:tOe(t)?t:Sv(Aat(t))}function Aat(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:n}=t.spatialReference,s={wkid:e,wkt:i,wkt2:r,latestWkid:n};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:s}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:Xhe(o),hasZ:a,hasM:l,spatialReference:s}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:Xhe(o),hasZ:a,hasM:l,spatialReference:s}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:h,zmax:p,mmin:g,mmax:y,hasZ:w,hasM:b}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:h,zmax:p,mmin:g,mmax:y,hasZ:w,hasM:b,spatialReference:s}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:nOe(o)?rOe(o):o,hasZ:a,hasM:l,spatialReference:s}}default:return}}function Xhe(t){return Rat(t)?t.map(e=>rOe(e)):t}function rOe(t){return t.map(e=>Array.from(e))}function Rat(t){for(const e of t)if(e.length!==0)return nOe(e);return!1}function nOe(t){return t.length>0&&(E3(t[0])||C3(t[0]))}function Iat(t,e){if(!t)return null;let i;if(Yhe(t)){if(e==null)return t.clone();if(Yhe(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=Sx(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function H5t(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:n}=t,s={wkid:e,wkt:i,wkt2:r,latestWkid:n};return nt.fromJSON(s)}const Zee="__begin__",Yee="__end__",Pat=new RegExp(Zee,"ig"),Lat=new RegExp(Yee,"ig"),Jhe=new RegExp("^"+Zee,"i"),Qhe=new RegExp(Yee+"$","i"),_k='"',Dat=_k+" + ",Nat=" + "+_k;function Fat(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function kat(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function Jz(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Fat(t.labelExpression),e.type="conventional"),e}function Uat(t){const e=Jz(t);if(!e)return null;switch(e.type){case"conventional":return zZ(e.expression);case"arcade":return e.expression}return null}function zat(t){const e=Jz(t);if(!e)return null;switch(e.type){case"conventional":return Bat(e.expression);case"arcade":return Xee(e.expression)}return null}function zZ(t){let e;return t?(e=rU(t,i=>Zee+'$feature["'+i+'"]'+Yee),e=Jhe.test(e)?e.replace(Jhe,""):_k+e,e=Qhe.test(e)?e.replace(Qhe,""):e+_k,e=e.replaceAll(Pat,Dat).replaceAll(Lat,Nat)):e='""',e}const Vat=/^\s*\{([^}]+)\}\s*$/i;function Bat(t){const e=t==null?void 0:t.match(Vat);return(e==null?void 0:e[1].trim())||null}const jat=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,Gat=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Hat=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function Xee(t){if(!t)return null;let e=jat.exec(t)||Gat.exec(t);return e?e[1]||e[3]:(e=Hat.exec(t),e?e[2]:null)}const vG=()=>de.getLogger("esri.layers.support.labelFormatUtils"),wG={type:"simple",evaluate:()=>null},qat={getAttribute:(t,e)=>t.field(e)};async function Wat(t,e,i){if(!t||!t.symbol||!e)return wG;const r=t.where,n=Jz(t);let s;if(n.type==="arcade"){const o=await ZYe(n.expression,i,e);if(o==null)return wG;s={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const h=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(h!=null)return h.toString()}catch(c){vG().error(new Y("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:n}))}return null},needsHydrationToEvaluate:()=>Xee(n.expression)==null}}else s={type:"simple",evaluate:o=>n.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let h=null;return"attributes"in o?o&&o.attributes&&(h=o.attributes[c.name]):h=o.field(c.name),h==null?"":Zat(h,c)})};if(r){let o;try{o=await bK(r,e)}catch(l){return vG().error(new Y("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),wG}const a=s.evaluate;s.evaluate=(l,c)=>{const h="attributes"in l?void 0:qat;try{if(o.testFeature(l,h))return a(l,c)}catch(p){vG().error(new Y("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:p}))}return null}}return s}function Zat(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const n=t;for(const s of i.codedValues)if(s.code===n)return s.name}else if(i.type==="range"){const{max:n,min:s}=T2e(e),o=+t;if(s!=null&&n!=null&&s<=o&&o<=n)return i.name}}let r=t;return D2e(e)?r=FU(r,V6e("short-date")):EK(e)&&(r=W3(+r)),r||""}function q5t(t,e,i,r,n,s,o,a,l,c,h){const p=tlt[h.mode];let g,y,w=0;if(io(t,e,i,r,l.spatialReference,n,a))return p!=null&&p.requiresAlignment(h)?(w=p.applyElevationAlignmentBuffer(r,n,s,o,a,l,c,h),g=s,y=o):(g=r,y=n),io(g,l.spatialReference,y,s,c.spatialReference,o,a)?w:void 0}function Jee(t,e,i,r,n){const s=(j5(t)?t.z:YTe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=am(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=am(e,t,"ground")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=am(e,t,"scene")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(s,r),a=am(e,t,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function W5t(t,e,i,r){return Jee(t,e,i,r,I2),I2.z}function Yat(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:pm.UPDATE:t.onTheGroundChanged}function Khe(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Z5t(t){return t!=="absolute-height"}function sOe(t,e,i,r,n){Jee(e,i,n,r,I2),oOe(t,I2.verticalDistanceToGround);const s=I2.sampledElevation,o=ps(ilt,t.transformation);return sD[0]=e.x,sD[1]=e.y,sD[2]=I2.z,X3(e.spatialReference,sD,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function oOe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(k.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],k.CENTEROFFSETANDDISTANCE))}}function Xat(t,e,i,r,n,s){let o=0;const a=s.spatialReference;e*=3,r*=3;for(let l=0;l<n;++l){const c=t[e],h=t[e+1],p=t[e+2],g=s.getElevation(c,h,p,a,"ground")??0;o+=g,i[r]=c,i[r+1]=h,i[r+2]=g,e+=3,r+=3}return o/n}function Jat(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=s.spatialReference;e*=3,r*=3;for(let g=0;g<n;++g){const y=t[e],w=t[e+1],b=t[e+2],x=s.getElevation(y,w,b,p,"ground")??0;l+=x,i[r]=y,i[r+1]=w,i[r+2]=h==null?b+x+c:x+c,e+=3,r+=3}return l/n}function Qat(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=s.spatialReference;e*=3,r*=3;for(let g=0;g<n;++g){const y=t[e],w=t[e+1],b=t[e+2],x=s.getElevation(y,w,b,p,"scene")??0;l+=x,i[r]=y,i[r+1]=w,i[r+2]=h==null?b+x+c:x+c,e+=3,r+=3}return l/n}function Kat(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function elt(t,e,i,r,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<n;++h){const p=t[e],g=t[e+1],y=t[e+2];i[r]=p,i[r+1]=g,i[r+2]=c==null?y+l:l,e+=3,r+=3}return 0}let aOe=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var pm;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(pm||(pm={}));const tlt={"absolute-height":{applyElevationAlignmentBuffer:elt,requiresAlignment:Kat},"on-the-ground":{applyElevationAlignmentBuffer:Xat,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Jat,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Qat,requiresAlignment:()=>!0}},ilt=ut(),I2=new aOe,sD=A();function Qee(t){if(yy(t)){if(t.length<Vu)return t}else if(t.length<Vu)return Array.from(t);let e=!0,i=!0;return t.some((r,n)=>(e=e&&r===0,i=i&&r===n,!e&&!i)),e?Kee(t.length):i?pI(t.length):yy(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?rlt(t):t}function rlt(t){let e=!0;for(const i of t){if(i>=65536)return yy(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function X5t(t){return t<=Vu?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function J5t(t){return t<=Vu?new Array(t):new Uint32Array(t)}let $S=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const lOe=[0],bG=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function pI(t){if(t===1)return lOe;if(t<Vu)return Array.from(new Uint16Array(bG.buffer,0,t));if(t<bG.length)return new Uint16Array(bG.buffer,0,t);if(t>$S.length){const e=Math.max(2*$S.length,t);$S=new Uint32Array(e);for(let i=0;i<$S.length;i++)$S[i]=i}return new Uint32Array($S.buffer,0,t)}let oD=new Uint8Array(65536);function Kee(t){if(t===1)return lOe;if(t<Vu)return new Array(t).fill(0);if(t>oD.length){const e=Math.max(2*oD.length,t);oD=new Uint8Array(e)}return new Uint8Array(oD.buffer,0,t)}function nlt(t){if(t.length<Vu)return Array.from(t);if(yy(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return tU(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let cOe=class uOe{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,St(e.length>=1),St(r.size===3||r.size===4);const{data:n,size:s,indices:o}=r;St(o.length%this._numIndexPerPrimitive==0),St(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=s*o[this._numIndexPerPrimitive*e[0]];O1.clear(),O1.push(l);const c=Qe(n[l],n[l+1],n[l+2]),h=En(c);for(let y=0;y<a;++y){const w=this._numIndexPerPrimitive*e[y];for(let b=0;b<this._numIndexPerPrimitive;++b){l=s*o[w+b],O1.push(l);let x=n[l];c[0]=Math.min(x,c[0]),h[0]=Math.max(x,h[0]),x=n[l+1],c[1]=Math.min(x,c[1]),h[1]=Math.max(x,h[1]),x=n[l+2],c[2]=Math.min(x,c[2]),h[2]=Math.max(x,h[2])}}this.bbMin=c,this.bbMax=h;const p=br(A(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let g=this.radius*this.radius;for(let y=0;y<O1.length;++y){l=O1.at(y);const w=n[l]-p[0],b=n[l+1]-p[1],x=n[l+2]-p[2],T=w*w+b*b+x*x;if(T<=g)continue;const M=Math.sqrt(T),$=.5*(M-this.radius);this.radius=this.radius+$,g=this.radius*this.radius;const R=$/M;p[0]+=w*R,p[1]+=b*R,p[2]+=x*R}this.center=p,O1.clear()}getChildren(){if(this._children||to(this.bbMin,this.bbMax)<=1)return this._children;const e=br(A(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),n=new Array(8);for(let h=0;h<8;++h)n[h]=0;const{data:s,size:o,indices:a}=this.position;for(let h=0;h<i;++h){let p=0;const g=this._numIndexPerPrimitive*this.primitiveIndices[h];let y=o*a[g],w=s[y],b=s[y+1],x=s[y+2];for(let T=1;T<this._numIndexPerPrimitive;++T){y=o*a[g+T];const M=s[y],$=s[y+1],R=s[y+2];M<w&&(w=M),$<b&&(b=$),R<x&&(x=R)}w<e[0]&&(p|=1),b<e[1]&&(p|=2),x<e[2]&&(p|=4),r[h]=p,++n[p]}let l=0;for(let h=0;h<8;++h)n[h]>0&&++l;if(l<2)return;const c=new Array(8);for(let h=0;h<8;++h)c[h]=n[h]>0?new Uint32Array(n[h]):void 0;for(let h=0;h<8;++h)n[h]=0;for(let h=0;h<i;++h){const p=r[h];c[p][n[p]++]=this.primitiveIndices[h]}this._children=new Array;for(let h=0;h<8;++h)c[h]!==void 0&&this._children.push(new uOe(c[h],this._numIndexPerPrimitive,this.position));return this._children}static prune(){O1.prune()}};const O1=new mi({deallocator:null});function slt(t){return t?{p0:En(t.p0),p1:En(t.p1),p2:En(t.p2)}:{p0:A(),p1:A(),p2:A()}}function Q5t(t,e,i){const r=e[0]-t[0],n=e[1]-t[1],s=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-n*s)}function olt(t,e,i){return Ae(xG,e,t),Ae(ede,i,t),.5*Fe(Ot(xG,xG,ede))}new ky(Uy);new ky(()=>slt());const xG=A(),ede=A();function alt(t,e){if(!t)return!1;const{size:i,data:r,indices:n}=t;ve(e,0,0,0),ve(Lh,0,0,0);let s=0,o=0;for(let a=0;a<n.length-2;a+=3){const l=n[a]*i,c=n[a+1]*i,h=n[a+2]*i;ve(po,r[l],r[l+1],r[l+2]),ve(ty,r[c],r[c+1],r[c+2]),ve(aD,r[h],r[h+1],r[h+2]);const p=olt(po,ty,aD);p?(xe(po,po,ty),xe(po,po,aD),ue(po,po,1/3*p),xe(e,e,po),s+=p):(xe(Lh,Lh,po),xe(Lh,Lh,ty),xe(Lh,Lh,aD),o+=3)}return(o!==0||s!==0)&&(s!==0?(ue(e,e,1/s),!0):o!==0&&(ue(e,Lh,1/o),!0))}function llt(t,e){if(!t)return!1;const{size:i,data:r,indices:n}=t;ve(e,0,0,0);let s=-1,o=0;for(let a=0;a<n.length;a++){const l=n[a]*i;s!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),s=l}return o>1&&ue(e,e,1/o),o>0}function clt(t,e,i){if(!t)return!1;ve(i,0,0,0),ve(Lh,0,0,0);let r=0,n=0;const{size:s,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let h=0;h<c;h+=2){const p=h<l?h+1:0,g=a[h<l?h:l]*s,y=a[p]*s;po[0]=o[g],po[1]=o[g+1],po[2]=o[g+2],ty[0]=o[y],ty[1]=o[y+1],ty[2]=o[y+2],ue(po,xe(po,po,ty),.5);const w=Na(po,ty);w>0?(xe(i,i,ue(po,po,w)),r+=w):r===0&&(xe(Lh,Lh,po),n++)}return r!==0?(ue(i,i,1/r),!0):n!==0&&(ue(i,Lh,1/n),!0)}const po=A(),ty=A(),aD=A(),Lh=A();let hOe=class{constructor(){this.uid=rd()}},dOe=class extends hOe{constructor(e){super(),this.highlightGroupName=e,this.channel=nx.Highlight}},ult=class extends hOe{constructor(){super(...arguments),this.channel=nx.MaskOccludee}},rc=class pOe extends Cm{constructor(e,i,r=null,n=Fo.Mesh,s=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=n,this.objectAndLayerIdColor=s,this.edgeIndicesLength=o,this.highlights=new Set,this._highlightGroupCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:Qee(l.indices)}),a===k.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new pOe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,n)=>{r.exclusive=!1,i._attributes.set(n,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:nlt(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){const e=this._attributes.values().next().value.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Fo.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Fo.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&Mt(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(k.POSITION);return alt(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(k.POSITION);return clt(i,hlt(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(k.POSITION);return llt(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(k.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===Fo.Mesh?3:1;St(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=pI(e.indices.length/i);return new cOe(r,i,e)}get transformation(){return this._transformation??Js}set transformation(e){this._transformation=e&&e!==Js?jxe(e):null}get highlightGroups(){return this._highlightGroupCounts}get hasHighlights(){return this._highlightGroupCounts.size>0}foreachHighlightGroup(e){this._highlightGroupCounts.forEach((i,r)=>e(r))}allocateIdAndHighlight(e){const i=new dOe(e);return this.addHighlight(i)}addHighlight(e){this.highlights.add(e);const{highlightGroupName:i}=e,r=(this._highlightGroupCounts.get(i)??0)+1;return this._highlightGroupCounts.set(i,r),e}removeHighlight(e){if(this.highlights.delete(e)){const{highlightGroupName:i}=e,r=this._highlightGroupCounts.get(i)??0;r<=1?this._highlightGroupCounts.delete(i):this._highlightGroupCounts.set(i,r-1)}}};function hlt(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}function fOe(t){return t.mapPositions!=null}function ikt(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!fOe(l))continue;const{update:c,averageGeometrySampledElevation:h}=gOe(l,e,i,r,n);a+=h,c&&s.geometryVertexAttributeUpdated(l,k.POSITION)}return a/o.length}function dlt(t,e,i,r,n,s){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,Gl),oOe(o,Gl.verticalDistanceToGround),l=Gl.sampledElevation):(r(a,Gl),e.mode!=="absolute-height"&&(l=Gl.sampledElevation));const c=ps(plt,s??o.transformation),h=ve(mOe,c[12],c[13],c[14]);Cn.TESTS_DISABLE_OPTIMIZATIONS?(jl[0]=a.x,jl[1]=a.y,jl[2]=Gl.z,X3(a.spatialReference,jl,c,n.spatialReference)&&(s?ps(s,c):o.transformation=c)):n.setAltitudeOfTransformation(Gl.z,c);const p=ete/n.unitInMeters;return(Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&(s?ps(s,c):o.transformation=c),l}const plt=ut();function rkt(t,e,i,r,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const o=e.centerPointInElevationSR;r(o,Gl);const a=e.mode!=="absolute-height"?Gl.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,h=flt;l.getGlobalTransform(c,h);const p=ve(mOe,h[12],h[13],h[14]);Cn.TESTS_DISABLE_OPTIMIZATIONS?(jl[0]=o.x,jl[1]=o.y,jl[2]=Gl.z,X3(o.spatialReference,jl,h,n.spatialReference)&&l.setGlobalTransform(c,h)):n.setAltitudeOfTransformation(Gl.z,h);const g=ete/n.unitInMeters;return(Cn.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=g||Math.abs(h[13]-p[1])>=g||Math.abs(h[14]-p[2])>=g)&&l.setGlobalTransform(c,h),a}function nkt(t,e,i,r,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!fOe(p))continue;const g=p.attributes.get(k.POSITION);if(g!==l){const{update:y,averageGeometrySampledElevation:w}=gOe(p,e,i,r,n);c=w,l=g,h=y}h&&s.geometryVertexAttributeUpdated(p,k.POSITION),a+=c}return a/o.length}const ete=.01,jl=A(),uh=A(),OS=A(),flt=ut(),mOe=A(),Gl=new aOe;function gOe(t,e,i,r,n){let s=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;uh[0]=o[12],uh[1]=o[13],uh[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(k.POSITION),c=l.data,h=l.size,p=c.length/h,g=new GZe(t.mapPositions,i);let y=0,w=0;for(let b=0;b<p;b++){if(OS[0]=c[y],OS[1]=c[y+1],OS[2]=c[y+2],r(g,Gl),a&&(w+=Gl.sampledElevation),Cn.TESTS_DISABLE_OPTIMIZATIONS)c[y]=g.array[g.offset],c[y+1]=g.array[g.offset+1],c[y+2]=Gl.z,io(c,i,y,c,n.spatialReference,y,1),c[y]-=uh[0],c[y+1]-=uh[1],c[y+2]-=uh[2],s=!0;else{jl[0]=c[y]+uh[0],jl[1]=c[y+1]+uh[1],jl[2]=c[y+2]+uh[2],n.setAltitude(jl,Gl.z),c[y]=jl[0]-uh[0],c[y+1]=jl[1]-uh[1],c[y+2]=jl[2]-uh[2];const x=ete/n.unitInMeters;(Math.abs(OS[0]-c[y])>=x||Math.abs(OS[1]-c[y+1])>=x||Math.abs(OS[2]-c[y+2])>=x)&&(s=!0)}y+=h,g.offset+=3}return w/=p,{update:s,averageGeometrySampledElevation:w}}function mlt(t){return!!t&&yC[t]!=null}function yOe(t){return 1/(yC[t]||1)}function glt(){const t=Object.keys(yC);return eU(t,"decimal-degrees"),t.sort(),t}const ylt=glt(),_lt=()=>de.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function vlt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function skt(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const i=bOe(e);if(i!=null)return{cachedResult:i}}return null}async function okt(t,e,i,r){const n=t==null?void 0:t.expression;if(typeof n!="string")return null;const s=bOe(n);if(s!=null)return{cachedResult:s};const o=await Dv();zt(i);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function _Oe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function vOe(t,e){if(t!=null&&!wOe(t)){if(!e||!t.arcade)return void _lt().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=iOe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function wlt(t){if(t!=null){if(wOe(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function akt(t,e=!1){let i=t==null?void 0:t.featureExpressionInfo;const r=i==null?void 0:i.expression;return e||r==="0"||(i=null),i??null}const blt={cachedResult:0};function wOe(t){return t.cachedResult!=null}function bOe(t){return t==="0"?0:null}let VZ=class xOe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=yOe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=wlt(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=mlt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e==null?void 0:e.arcade;n&&i!=null&&r!=null?(this._featureExpressionInfoContext=vlt(e),vOe(this._featureExpressionInfoContext,_Oe(n.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new xOe;return e!=null&&i.setFromElevationInfo(e),i}},xlt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var BZ;let FT=BZ=class extends Or(we){constructor(t){super(t),this.type="georeferenced",this.origin=null}};FT.absolute=new BZ,u([_t({georeferenced:"georeferenced"},{readOnly:!0})],FT.prototype,"type",void 0),u([f({type:[Number],nonNullable:!1,json:{write:!0}})],FT.prototype,"origin",void 0),FT=BZ=u([L("esri.geometry.support.MeshGeoreferencedVertexSpace")],FT);const Slt=FT;let QO=class extends Or(we){constructor(e){super(e),this.type="local",this.origin=A()}};u([_t({local:"local"},{readOnly:!0})],QO.prototype,"type",void 0),u([f({type:[Number],nonNullable:!0,json:{write:!0}})],QO.prototype,"origin",void 0),QO=u([L("esri.geometry.support.MeshLocalVertexSpace")],QO);const Tlt=QO;function tde(){return de.getLogger("esri.geometry.Mesh")}function ukt(t){return!tte(t)}function tte(t){return t.origin!=null}function hkt(t){return tte(t.vertexSpace)}function Elt(t,e){if(!tte(t))return null;const[i,r,n]=t.origin;return new wt({x:i,y:r,z:n,spatialReference:e})}function dkt(t,e){const{x:i,y:r,z:n,spatialReference:s}=t,o=[i,r,n??0];return(e==null?void 0:e.geographic)!==void 0&&(ME(tde(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),e.vertexSpace&&tde().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),((e==null?void 0:e.vertexSpace)??Mlt(e==null?void 0:e.geographic)??Clt(s))==="local"?new Tlt({origin:o}):new Slt({origin:o})}function Clt(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function Mlt(t){return t==null?void 0:t?"local":"georeferenced"}function pkt(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&Qs(t.origin,e.origin))}function SOe(t,e){if(t.type==="point")return k0(t,e,!1);if(tOe(t))switch(t.type){case"extent":return k0(t.center,e,!1);case"polygon":return k0(t.centroid,e,!1);case"polyline":return k0(ide(t),e,!0);case"mesh":return k0(Elt(t.vertexSpace,t.spatialReference)??t.extent.center,e,!1);case"multipoint":return}else switch(t.type){case"extent":return k0($lt(t),e,!0);case"polygon":return k0(Olt(t),e,!0);case"polyline":return k0(ide(t),e,!0);case"multipoint":return}}function ide(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=nwe(e,rwe(e)/2);return Sx(i[0],i[1],i[2],t.spatialReference)}function $lt(t){return Sx(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Olt(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=owe(t.rings,!!t.hasZ);return Sx(i[0],i[1],i[2],t.spatialReference)}function k0(t,e,i){const r=i?t:Iat(t);return e&&t?Jbe(t,r,e)?r:null:r}function fkt(t){if(!t)return 0;switch(t.type){case"point":return t.z;case"extent":return t.zmax;case"polygon":return t.hasZ?t.rings.reduce((e,i)=>i.reduce((r,n)=>Math.max(r,n[2]),e),-1/0):void 0;case"polyline":return t.hasZ?t.paths.reduce((e,i)=>i.reduce((r,n)=>Math.max(r,n[2]),e),-1/0):void 0;case"mesh":return t.extent.zmax;case"multipoint":return}}function mkt(t,e,i,r=0){if(t){e||(e=Zi());const n=t;let s=.5*n.width*(i-1),o=.5*n.height*(i-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),_n(e,n.xmin-s-r,n.ymin-o-r,n.xmax+s+r,n.ymax+o+r),e}return null}function SG(t,e,i=null){const r=qU(WU);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function gkt(t,e,i,r,n,s=[0,0,0,0]){for(let o=0;o<3;++o)s[o]=(t==null?void 0:t[o])!=null?t[o]:(i==null?void 0:i[o])!=null?i[o]:n[o];return s[3]=e??r??n[3],s}function ykt(t=kR,e,i,r=1){const n=new Array(3);if(e==null||i==null)n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,p=a===0&&!s&&!h,g=i[a];l==="symbol-value"||p?c=g!==0?e[a]/g:1:h&&l!=="proportional"&&isFinite(l)&&(c=g!==0?l/g:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=r;return FR(n)}function Alt(t){return t.isPrimitive!=null}function _kt(t){return Rlt(Alt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function Rlt(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function vkt(t,e,i,r=ut()){return t&&VE(r,r,-t/180*Math.PI),e&&zE(r,r,e/180*Math.PI),i&&xU(r,r,i/180*Math.PI),r}function Ilt(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Ql(e),n=Cx(t)*r,s=Mx(t)*r,o=Qv(t)*(e.isGeographic?1:r);return n===0&&s===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(n,s,o)}var qh;(function(t){t[t.TRANSPARENT=0]="TRANSPARENT",t[t.OPAQUE=1]="OPAQUE"})(qh||(qh={}));let wkt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterial=i,this.hasSlicePlane=r}},TOe=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){var i,r;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(i=e.renderer.edgeView)==null||i.removeObject(this.stageObject),this.stageObject.dispose(),(r=this._sharedResource)==null||r.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:n,_stageLayer:s}=this;if(n==null)return;const o=rde(n.baseMaterial);n.edgeMaterial.objectTransparency!==o&&(n.edgeMaterial.objectTransparency=o,this.resetEdgeObject(i)),s.stage.renderer.withEdgeView(a=>a.updateAllComponentOpacities(r,[e]))}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:n,_stageLayer:s}=this;n!=null&&s.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,n.edgeMaterial,e,!i),n.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:n}=this;n!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(n.add(r),this._addedToStage=!0),i!=null&&n.stage.renderer.withEdgeView(s=>{s.hasObject(r)?s.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,s,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r,n){if(this.elevationAligner==null)return;r!=null&&vOe(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>Jee(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,i,r){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=A()){return ye(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=bd()){const i=this.stageObject.boundingVolumeObjectSpace;return tEe(e,i.min),iEe(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Qm)&&(Mt(Qm,Qm,i),xe(e.render.origin,e.render.origin,Qm),e.render.num++)}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=Plt,l=nEe(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];U0[0]=o[p[0]],U0[1]=o[p[1]],U0[2]=o[p[2]],Mt(U0,U0,this.stageObject.transformation),A1[3*h]=U0[0],A1[3*h+1]=U0[1],A1[3*h+2]=U0[2]}if(!e(A1,0,l))return null;fd(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],A1[h+p]),o[p+3]=Math.max(o[p+3],A1[h+p]);c&&r.push({location:A1.slice(h,h+3),screenSpaceBoundingRect:c})}if(i!=null&&i.service&&this.elevationContext.mode!=="absolute-height"){vz(o,Qm);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=i.service.getElevation(Qm[0],Qm[1],h)??0;else try{const g=Ilt(o,i.service.spatialReference,i);p=await i.service.queryElevation(Qm[0],Qm[1],n,g,h)??0}catch{}fJe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e){e.stateType===nx.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightGroupName)),e.stateType===nx.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:n,_visible:s}=this;i!=null&&n.stage.renderer.withEdgeView(o=>{s?this._addOrUpdateEdgeObject(i,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const n=rde(e.baseMaterial);e.edgeMaterial.objectTransparency=n,i.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function rde(t){return t.parameters.transparent?qh.TRANSPARENT:qh.OPAQUE}const A1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],U0=A(),Qm=A(),Plt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let Llt=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const Dlt=3,Nlt=3,Flt=10;function zu(t,e=!1){return t<=Vu?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Tkt(t){return yy(t)?t.length<Vu?t:new Float32Array(t):t.length<Vu?Array.from(t):t}function nde(t){return(yy(t)?t.length:t.byteLength/8)<=Vu?Array.from(t):new Float32Array(t)}function Ekt(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}var jZ;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=n,t.subtract=s})(jZ||(jZ={}));const AS=jZ,TG=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],klt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Ult=[0,0,1,0,1,1,0,1],zlt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],EOe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)EOe[6*t+e]=t;const Mw=new Array(36);for(let t=0;t<6;t++)Mw[6*t]=0,Mw[6*t+1]=1,Mw[6*t+2]=2,Mw[6*t+3]=2,Mw[6*t+4]=3,Mw[6*t+5]=0;function Vlt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=TG[r][0]*e[0],i[3*r+1]=TG[r][1]*e[1],i[3*r+2]=TG[r][2]*e[2];return new rc(t,[[k.POSITION,new Ji(i,zlt,3,!0)],[k.NORMAL,new Ji(klt,EOe,3)],[k.UV0,new Ji(Ult,Mw,2)]])}const EG=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Blt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],jlt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Glt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function Hlt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=EG[r][0]*e[0],i[3*r+1]=EG[r][1]*e[1],i[3*r+2]=EG[r][2]*e[2];return new rc(t,[[k.POSITION,new Ji(i,jlt,3,!0)],[k.NORMAL,new Ji(Blt,Glt,3)]])}const kF=$r(-.5,0,-.5),UF=$r(.5,0,-.5),zF=$r(0,0,.5),VF=$r(0,.5,0),RS=Dc(),IS=Dc(),mE=Dc(),gE=Dc(),yE=Dc();Ae(RS,kF,VF),Ae(IS,kF,UF),Ot(mE,RS,IS),Me(mE,mE),Ae(RS,UF,VF),Ae(IS,UF,zF),Ot(gE,RS,IS),Me(gE,gE),Ae(RS,zF,VF),Ae(IS,zF,kF),Ot(yE,RS,IS),Me(yE,yE);const CG=[kF,UF,zF,VF],qlt=[0,-1,0,mE[0],mE[1],mE[2],gE[0],gE[1],gE[2],yE[0],yE[1],yE[2]],Wlt=[0,1,2,3,1,0,3,2,1,3,0,2],Zlt=[0,0,0,1,1,1,2,2,2,3,3,3];function Ylt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=CG[r][0]*e[0],i[3*r+1]=CG[r][1]*e[1],i[3*r+2]=CG[r][2]*e[2];return new rc(t,[[k.POSITION,new Ji(i,Wlt,3,!0)],[k.NORMAL,new Ji(qlt,Zlt,3)]])}function Ckt(t,e,i,r,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),p=(c+1)*(h+1),g=zu(3*p),y=zu(3*p),w=zu(2*p),b=[];let x=0;for(let $=0;$<=h;$++){const R=[],I=$/h,P=a+I*l,N=Math.cos(P);for(let V=0;V<=c;V++){const U=V/c,B=s+U*o,W=Math.cos(B)*N,j=Math.sin(P),Q=-Math.sin(B)*N;g[3*x]=W*e,g[3*x+1]=j*e,g[3*x+2]=Q*e,y[3*x]=W,y[3*x+1]=j,y[3*x+2]=Q,w[2*x]=U,w[2*x+1]=I,R.push(x),++x}b.push(R)}const T=new Array;for(let $=0;$<h;$++)for(let R=0;R<c;R++){const I=b[$][R],P=b[$][R+1],N=b[$+1][R+1],V=b[$+1][R];$===0?(T.push(I),T.push(N),T.push(V)):$===h-1?(T.push(I),T.push(P),T.push(N)):(T.push(I),T.push(P),T.push(N),T.push(N),T.push(V),T.push(I))}const M=[[k.POSITION,new Ji(g,T,3,!0)],[k.NORMAL,new Ji(y,T,3,!0)]];return n.uv&&M.push([k.UV0,new Ji(w,T,2,!0)]),n.offset&&(M[0][0]=k.OFFSET,M.push([k.POSITION,new Ji(Float64Array.from(n.offset),Kee(T.length),3,!0)])),new rc(t,M)}function Xlt(t,e,i,r){const n=COe(e,i,r);return new rc(t,n)}function COe(t,e,i){const r=t;let n,s;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;n=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<n.length;c+=3)AS.scale(n,c,t/AS.length(n,c));let o={};function a(c,h){c>h&&([c,h]=[h,c]);const p=c.toString()+"."+h.toString();if(o[p])return o[p];let g=n.length;return n.length+=3,AS.add(n,3*c,n,3*h,n,g),AS.scale(n,g,t/AS.length(n,g)),g/=3,o[p]=g,g}for(let c=0;c<e;c++){const h=s.length,p=new Array(4*h);for(let g=0;g<h;g+=3){const y=s[g],w=s[g+1],b=s[g+2],x=a(y,w),T=a(w,b),M=a(b,y),$=4*g;p[$]=y,p[$+1]=x,p[$+2]=M,p[$+3]=w,p[$+4]=T,p[$+5]=x,p[$+6]=b,p[$+7]=M,p[$+8]=T,p[$+9]=x,p[$+10]=T,p[$+11]=M}s=p,o={}}const l=nde(n);for(let c=0;c<l.length;c+=3)AS.normalize(l,c);return[[k.POSITION,new Ji(nde(n),s,3,!0)],[k.NORMAL,new Ji(l,s,3,!0)]]}function Mkt(t,e,i,r,n,s,o,a,l,c=null){const h=i?En(i):A(),p=e?En(e):Qe(0,0,1),g=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],y=s!=null&&s.length===2?s:[1,1],w=n!=null?[n]:[0],b=Kee(1),x=[[k.POSITION,new Ji(h,b,3,!0)],[k.NORMAL,new Ji(p,b,3,!0)],[k.COLOR,new Ji(g,b,4,!0)],[k.SIZE,new Ji(y,b,2)],[k.ROTATION,new Ji(w,b,1,!0)]];if(a&&x.push([k.UV0,new Ji(a,b,a.length)]),o!=null&&(o=[o[0],o[1],o[2],o[3]],x.push([k.CENTEROFFSETANDDISTANCE,new Ji(o,b,4)])),l){const T=[l[0],l[1],l[2],l[3]];x.push([k.FEATUREATTRIBUTE,new Ji(T,b,4)])}return new rc(t,x,null,Fo.Point,c)}const Jlt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function $kt(t,e=Jlt){const i=new Array(12);for(let c=0;c<4;c++)for(let h=0;h<3;h++)i[3*c+h]=e[c][h];const r=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[k.POSITION,new Ji(i,r,3,!0)],[k.NORMAL,new Ji(n,s,3,!0)],[k.UV0,new Ji(o,r,2,!0)],[k.COLOR,new Ji(a,s,4,!0)]];return new rc(t,l)}function Qlt(t,e,i,r,n=!0,s=!0){let o=0;const a=e,l=t;let c=$r(0,o,0),h=$r(0,o+l,0),p=$r(0,-1,0),g=$r(0,1,0);r&&(o=l,h=$r(0,0,0),c=$r(0,o,0),p=$r(0,1,0),g=$r(0,-1,0));const y=[h,c],w=[p,g],b=i+2,x=Math.sqrt(l*l+a*a);if(r)for(let I=i-1;I>=0;I--){const P=I*(2*Math.PI/i),N=$r(Math.cos(P)*a,o,Math.sin(P)*a);y.push(N);const V=$r(l*Math.cos(P)/x,-a/x,l*Math.sin(P)/x);w.push(V)}else for(let I=0;I<i;I++){const P=I*(2*Math.PI/i),N=$r(Math.cos(P)*a,o,Math.sin(P)*a);y.push(N);const V=$r(l*Math.cos(P)/x,a/x,l*Math.sin(P)/x);w.push(V)}const T=new Array,M=new Array;if(n){for(let I=3;I<y.length;I++)T.push(1),T.push(I-1),T.push(I),M.push(0),M.push(0),M.push(0);T.push(y.length-1),T.push(2),T.push(1),M.push(0),M.push(0),M.push(0)}if(s){for(let I=3;I<y.length;I++)T.push(I),T.push(I-1),T.push(0),M.push(I),M.push(I-1),M.push(1);T.push(0),T.push(2),T.push(y.length-1),M.push(1),M.push(2),M.push(w.length-1)}const $=zu(3*b);for(let I=0;I<b;I++)$[3*I]=y[I][0],$[3*I+1]=y[I][1],$[3*I+2]=y[I][2];const R=zu(3*b);for(let I=0;I<b;I++)R[3*I]=w[I][0],R[3*I+1]=w[I][1],R[3*I+2]=w[I][2];return[[k.POSITION,new Ji($,T,3,!0)],[k.NORMAL,new Ji(R,M,3,!0)]]}function sde(t,e,i,r,n,s=!0,o=!0){return new rc(t,Qlt(e,i,r,n,s,o))}function Klt(t,e,i,r,n,s,o){const a=n?_W(n):$r(1,0,0),l=s?_W(s):$r(0,0,0);o??(o=!0);const c=Dc();Me(c,a);const h=Dc();ue(h,c,Math.abs(e));const p=Dc();ue(p,h,-.5),xe(p,p,l);const g=$r(0,1,0);Math.abs(1-Te(c,g))<.2&&ve(g,0,0,1);const y=Dc();Ot(y,c,g),Me(y,y),Ot(g,y,c);const w=2*r+(o?2:0),b=r+(o?2:0),x=zu(3*w),T=zu(3*b),M=zu(2*w),$=new Array(3*r*(o?4:2)),R=new Array(3*r*(o?4:2));o&&(x[3*(w-2)]=p[0],x[3*(w-2)+1]=p[1],x[3*(w-2)+2]=p[2],M[2*(w-2)]=0,M[2*(w-2)+1]=0,x[3*(w-1)]=x[3*(w-2)]+h[0],x[3*(w-1)+1]=x[3*(w-2)+1]+h[1],x[3*(w-1)+2]=x[3*(w-2)+2]+h[2],M[2*(w-1)]=1,M[2*(w-1)+1]=1,T[3*(b-2)]=-c[0],T[3*(b-2)+1]=-c[1],T[3*(b-2)+2]=-c[2],T[3*(b-1)]=c[0],T[3*(b-1)+1]=c[1],T[3*(b-1)+2]=c[2]);const I=(B,W,j)=>{$[B]=W,R[B]=j};let P=0;const N=Dc(),V=Dc();for(let B=0;B<r;B++){const W=B*(2*Math.PI/r);ue(N,g,Math.sin(W)),ue(V,y,Math.cos(W)),xe(N,N,V),T[3*B]=N[0],T[3*B+1]=N[1],T[3*B+2]=N[2],ue(N,N,i),xe(N,N,p),x[3*B]=N[0],x[3*B+1]=N[1],x[3*B+2]=N[2],M[2*B]=B/r,M[2*B+1]=0,x[3*(B+r)]=x[3*B]+h[0],x[3*(B+r)+1]=x[3*B+1]+h[1],x[3*(B+r)+2]=x[3*B+2]+h[2],M[2*(B+r)]=B/r,M[2*B+1]=1;const j=(B+1)%r;I(P++,B,B),I(P++,B+r,B),I(P++,j,j),I(P++,j,j),I(P++,B+r,B),I(P++,j+r,j)}if(o){for(let B=0;B<r;B++){const W=(B+1)%r;I(P++,w-2,b-2),I(P++,B,b-2),I(P++,W,b-2)}for(let B=0;B<r;B++){const W=(B+1)%r;I(P++,B+r,b-1),I(P++,w-1,b-1),I(P++,W+r,b-1)}}const U=[[k.POSITION,new Ji(x,$,3,!0)],[k.NORMAL,new Ji(T,R,3,!0)],[k.UV0,new Ji(M,$,2,!0)]];return new rc(t,U)}function Okt(t,e,i,r,n,s){r=r||10,n=n==null||n,St(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const h=c/r*2*Math.PI;l.push([Math.cos(h)*i,Math.sin(h)*i])}return ect(t,l,e,o,a,n,s)}function ect(t,e,i,r,n,s,o=$r(0,0,0)){const a=e.length,l=zu(i.length*a*3+(6*r.length||0)),c=zu(i.length*a*3+(r?6:0)),h=new Array,p=new Array;let g=0,y=0;const w=A(),b=A(),x=A(),T=A(),M=A(),$=A(),R=A(),I=A(),P=A(),N=A(),V=A(),U=A(),B=A(),W=dn();ve(P,0,1,0),Ae(b,i[1],i[0]),Me(b,b),s?(xe(I,i[0],o),Me(x,I)):ve(x,0,0,1),ode(b,x,P,P,M,x,ade),ye(T,x),ye(U,M);for(let z=0;z<r.length;z++)ue($,M,r[z][0]),ue(I,x,r[z][2]),xe($,$,I),xe($,$,i[0]),l[g++]=$[0],l[g++]=$[1],l[g++]=$[2];c[y++]=-b[0],c[y++]=-b[1],c[y++]=-b[2];for(let z=0;z<n.length;z++)h.push(n[z][0]>0?n[z][0]:-n[z][0]-1+r.length),h.push(n[z][1]>0?n[z][1]:-n[z][1]-1+r.length),h.push(n[z][2]>0?n[z][2]:-n[z][2]-1+r.length),p.push(0),p.push(0),p.push(0);let j=r.length;const Q=r.length-1;for(let z=0;z<i.length;z++){let he=!1;z>0&&(ye(w,b),z<i.length-1?(Ae(b,i[z+1],i[z]),Me(b,b)):he=!0,xe(N,w,b),Me(N,N),xe(V,i[z-1],T),tC(i[z],N,W),ZC(W,rf(V,w),I)?(Ae(I,I,i[z]),Me(x,I),Ot(M,N,x),Me(M,M)):ode(N,T,U,P,M,x,ade),ye(T,x),ye(U,M)),s&&(xe(I,i[z],o),Me(B,I));for(let ce=0;ce<a;ce++)if(ue($,M,e[ce][0]),ue(I,x,e[ce][1]),xe($,$,I),Me(R,$),c[y++]=R[0],c[y++]=R[1],c[y++]=R[2],xe($,$,i[z]),l[g++]=$[0],l[g++]=$[1],l[g++]=$[2],!he){const G=(ce+1)%a;h.push(j+ce),h.push(j+a+ce),h.push(j+G),h.push(j+G),h.push(j+a+ce),h.push(j+a+G);for(let K=0;K<6;K++){const Se=h.length-6;p.push(h[Se+K]-Q)}}j+=a}const Z=i[i.length-1];for(let z=0;z<r.length;z++)ue($,M,r[z][0]),ue(I,x,r[z][1]),xe($,$,I),xe($,$,Z),l[g++]=$[0],l[g++]=$[1],l[g++]=$[2];const X=y/3;c[y++]=b[0],c[y++]=b[1],c[y++]=b[2];const ge=j-a;for(let z=0;z<n.length;z++)h.push(n[z][0]>=0?j+n[z][0]:-n[z][0]-1+ge),h.push(n[z][2]>=0?j+n[z][2]:-n[z][2]-1+ge),h.push(n[z][1]>=0?j+n[z][1]:-n[z][1]-1+ge),p.push(X),p.push(X),p.push(X);const ae=[[k.POSITION,new Ji(l,h,3,!0)],[k.NORMAL,new Ji(c,p,3,!0)]];return new rc(t,ae)}function Akt(t,e,i,r){St(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),St(e[0].length===3,"createPolylineGeometry(): malformed vertex"),St(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),St(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const n=PK(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let h=0;h<3;h++)n[o++]=e[c][h];c>0&&(s[a++]=c-1,s[a++]=c)}const l=[[k.POSITION,new Ji(n,s,3,!0)]];if(i){const c=zu(3*i.length);let h=0;for(let p=0;p<e.length;p++)for(let g=0;g<3;g++)c[h++]=i[p][g];l.push([k.NORMAL,new Ji(c,s,3,!0)])}return r&&l.push([k.COLOR,new Ji(r,pI(r.length/4),4)]),new rc(t,l,null,Fo.Line)}function Rkt(t,e,i,r,n,s=0){const o=new Array(18),a=[[-i,s,n/2],[r,s,n/2],[0,e+s,n/2],[-i,s,-n/2],[r,s,-n/2],[0,e+s,-n/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new rc(t,[[k.POSITION,new Ji(o,l,3,!0)]])}function Ikt(t,e){const i=t.getMutableAttribute(k.POSITION).data;for(let r=0;r<i.length;r+=3){const n=i[r],s=i[r+1],o=i[r+2];ve(PS,n,s,o),Mt(PS,PS,e),i[r]=PS[0],i[r+1]=PS[1],i[r+2]=PS[2]}}function tct(t,e=t){const i=t.attributes,r=i.get(k.POSITION).data,n=i.get(k.NORMAL).data;if(n){const s=e.getMutableAttribute(k.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(r){const s=e.getMutableAttribute(k.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];s[o+1]=-r[o+2],s[o+2]=a}}}function MG(t,e,i,r,n){return!(Math.abs(Te(e,t))>n)&&(Ot(i,t,e),Me(i,i),Ot(r,i,t),Me(r,r),!0)}function ode(t,e,i,r,n,s,o){return MG(t,e,n,s,o)||MG(t,i,n,s,o)||MG(t,r,n,s,o)}const ade=.99619469809,PS=A();let MOe=class{constructor(e,i=null){this.geometry=e,this.textures=i}get material(){return this.geometry.material}get numTriangles(){return this.geometry instanceof Cm?this.geometry.indexCount/3:this.geometry.elementCount/3}};function ict(t){return t instanceof Cm?t.attributes.get(k.POSITION).indices.length:t.elementCount}let $Oe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const n=Kk(this.components.map(s=>s.geometry));this.numVertices=n.reduce((s,o)=>s+ict(o),0)}},OOe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function rct(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),Kk(e)}function nct(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),Kk(e)}function Nkt(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.geometry instanceof Cm&&e.push(r.geometry)})),Kk(e)}function Fkt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function sct(t,e){const i=(r,n,s=!1)=>new OOe(r.map(o=>{const a=n(o.tesselation);return s&&tct(a),new $Oe([new MOe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Xlt(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Vlt(e,1));case"cone":return i($G,r=>sde(e,1,.5,r,!1),!0);case"inverted-cone":return i($G,r=>sde(e,1,.5,r,!0),!0);case"cylinder":return i($G,r=>Klt(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Ylt(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Hlt(e,1),!0);default:return}}const $G=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let _p=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new AOe}},ite=class extends _p{constructor(e){super(e),this.estimated=!0}},oct=class extends _p{constructor(e,i){super(i),this.numComplexities=e}},act=class extends ite{constructor(e,i){super(i),this.numComplexities=e}},AOe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function lct(t){return t.type==="fill"}function cct(t){return t.type==="extrude"}function rte(t,e,i=0){const r=Oe(t,0,dct);for(let n=0;n<4;n++)e[i+n]=Math.floor(256*pct(r*uct[n]))}function nte(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*hct[r];return i}const uct=[1,256,65536,16777216],hct=[1/256,1/65536,1/16777216,1/4294967296],dct=nte(new Uint8ClampedArray([255,255,255,255]));function pct(t){return t-Math.floor(t)}var Vs;function jkt(t){switch(t){case"multiply":default:return Vs.Multiply;case"ignore":return Vs.Ignore;case"replace":return Vs.Replace;case"tint":return Vs.Tint}}function fct(t,e,i){if(t==null||e===Vs.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Oe(Math.round(t[3]*vk),0,vk),n=r===0||e===Vs.Tint?0:e===Vs.Replace?mct:gct;i[0]=Oe(Math.round(t[0]*LS),0,LS),i[1]=Oe(Math.round(t[1]*LS),0,LS),i[2]=Oe(Math.round(t[2]*LS),0,LS),i[3]=r+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Vs||(Vs={}));const LS=255,vk=85,mct=vk,gct=2*vk;function ROe(t){t.vertex.code.add(C`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${C.int(Vs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${C.int(Vs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${C.int(Vs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${C.int(Vs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let yct=class extends Mn{constructor(e,i){super(e,"int",Fi.Draw,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};var fm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(fm||(fm={}));const ste=429496.7296;function _ct(t,e){rte(t/ste*.5+.5,e)}function vct(t,e){switch(e.componentData){case fm.Varying:return wct(t,e);case fm.Uniform:return bct(t,e);case fm.COUNT:return;default:e.componentData}}function wct(t,e){const{vertex:i,fragment:r}=t;i.include(t1),i.uniforms.add(new $m("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(k.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===J.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(ROe),i.constants.add("stride","float",_d()?3:2),i.code.add(C`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(C`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${C.float(ste)};
  }

  ${n?C`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:C`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(C`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?C`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function bct(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new c3("externalColor",s=>s.componentParameters.externalColor)),r.uniforms.add(new yct("externalColorMixMode",s=>s.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),i.code.add(C`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const n=e.output===J.ObjectAndLayerIdColor;r.code.add(C`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${n?C`fragColor = vec4(0, 0, 0, 0);`:""}
 }
`)}function lM(t,e){switch(e.normalType){case an.Compressed:t.attributes.add(k.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(C`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case an.Attribute:t.attributes.add(k.NORMAL,"vec3"),t.vertex.code.add(C`vec3 normalModel() {
return normal;
}`);break;case an.ScreenDerivative:t.fragment.code.add(C`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case an.COUNT:}}var an;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.ScreenDerivative=2]="ScreenDerivative",t[t.COUNT=3]="COUNT"})(an||(an={}));function ote({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(C`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(C`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let wk=class extends Mn{constructor(e,i){super(e,"mat3",Fi.Draw,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}};function qkt(t,e){const i=t.vertex;i.include(t1),t.include(lM,e),i.uniforms.add(new rt("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(C`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new $m("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(k.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.code.add(C`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?C`decompressNormal(normal2Compressed)`:C`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = uninterpolatedRGBAToFloat(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) * ${C.float(ste)};

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(C`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new wk("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(C`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(k.NORMAL2COMPRESSED,"vec2"),i.code.add(C`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(C`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?i.code.add(C`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(ote,e),i.uniforms.add(new xd("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new wk("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Uu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Uu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new fi("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new fi("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(C`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?C`normalize(transformWorldFromModelTL + rotatedModelPosition);`:C`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Bs("transformProjFromView",(r,n)=>n.camera.projectionMatrix)),i.code.add(C`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(C`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Wkt(t){return t===_C.Sketch||t===_C.Mixed}var _C,lde;(function(t){t[t.Solid=0]="Solid",t[t.Sketch=1]="Sketch",t[t.Mixed=2]="Mixed",t[t.COUNT=3]="COUNT"})(_C||(_C={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(lde||(lde={}));function xct(t){return t&&t.enabled&&(cct(t)||lct(t))&&t.edges!=null}function Sct(t){return t&&t.enabled&&t.edges||null}function Zkt(t,e){return Tct(Sct(t),e)}function Tct(t,e){if(t==null)return null;const i=t.color!=null?VQ(mt.toUnitRGBA(t.color)):Ri(0,0,0,0),r=qb(t.size),n=qb(t.extensionLength);switch(t.type){case"solid":return Ect({color:i,size:r,extensionLength:n,...e});case"sketch":return Cct({color:i,size:r,extensionLength:n,...e});default:return}}function Ect(t){return{...Mct,...t,type:_C.Solid}}function Cct(t){return{...$ct,...t,type:_C.Sketch}}const Mct={color:Ri(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:qh.OPAQUE,hasSlicePlane:!1},$ct={color:Ri(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:qh.OPAQUE,hasSlicePlane:!1};function Oct(t,e){const i=t.fragment;switch(i.code.add(C`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case eo.None:i.code.add(C`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case eo.View:i.code.add(C`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case eo.WindingOrder:i.code.add(C`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case eo.COUNT:}}var eo;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(eo||(eo={}));function Ykt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||Qs(s,ws))&&o==null&&(r==null||r===1)&&(i==null||i===1)}function Xkt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||Qs(s,ws))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const IOe=xm(1,1,.5),Act=xm(0,.6,.2),Jkt=xm(0,1,.2);var Ut;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Ut||(Ut={}));function ate(t,e){const i=e.pbrMode,r=t.fragment;if(i!==Ut.Schematic&&i!==Ut.Disabled&&i!==Ut.Normal)return void r.code.add(C`void applyPBRFactors() {}`);if(i===Ut.Disabled)return void r.code.add(C`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(i===Ut.Schematic)return void r.code.add(C`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:n,hasMetallicRoughnessTextureTransform:s,hasOcclusionTexture:o,hasOcclusionTextureTransform:a,bindType:l}=e;(n||o)&&t.include(Yz,e),r.code.add(C`vec3 mrr;
float occlusion;`),n&&r.uniforms.add(l===Fi.Pass?new ht("texMetallicRoughness",c=>c.textureMetallicRoughness):new $m("texMetallicRoughness",c=>c.textureMetallicRoughness)),o&&r.uniforms.add(l===Fi.Pass?new ht("texOcclusion",c=>c.textureOcclusion):new $m("texOcclusion",c=>c.textureOcclusion)),r.uniforms.add(l===Fi.Pass?new fi("mrrFactors",c=>c.mrrFactors):new Uu("mrrFactors",c=>c.mrrFactors)),r.code.add(C`
    ${Ge(n,C`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${Ge(o,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${o?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${Ge(n,`applyMetallicRoughness(${s?"metallicRoughnessUV":"vuv0"});`)}
      ${Ge(o,`applyOcclusion(${a?"occlusionUV":"vuv0"});`)}
    }
  `)}let Qz=class{constructor(e=!1,i=!0){this.isVerticalRay=e,this.normalRequired=i}};const lD=bd();function Rct(t,e,i,r,n,s){if(!t.visible)return;const o=nr(FOe,r,i),a=(c,h,p)=>{s(c,p,h,!1)},l=new Qz(!1,e.options.normalRequired);if(t.boundingInfo){St(t.type===Fo.Mesh);const c=e.tolerance;POe(t.boundingInfo,i,o,c,n,l,a)}else{const c=t.attributes.get(k.POSITION),h=c.indices;DOe(i,o,0,h.length/3,h,c.data,c.stride,n,l,a)}}const Ict=A();function POe(t,e,i,r,n,s,o){if(t==null)return;const a=Vct(i,Ict);if(tEe(lD,t.bbMin),iEe(lD,t.bbMax),n!=null&&n.applyToAabb(lD),NOe(lD,e,a,r)){const{primitiveIndices:l,position:c}=t,h=l?l.length:c.indices.length/3;if(h>Bct){const p=t.getChildren();if(p!==void 0){for(const g of p)POe(g,e,i,r,n,s,o);return}}Dct(e,i,0,h,c.indices,c.data,c.stride,l,n,s,o)}}const mb=A();function Pct(t,e,i,r,n,s,o,a,l){const{data:c,stride:h}=s;DOe(t,nr(FOe,e,t),i,r,n,c,h,o,a,l)}function LOe(t,e,i,r,n,s,o,a,l,c=null,h=0){const p=t[0],g=t[1],y=t[2],w=e[0],b=e[1],x=e[2];for(let T=i;T<r;++T){const M=h+(c?c[T]:T),$=3*M,R=o*n[$],I=s[R],P=s[R+1],N=s[R+2],V=o*n[$+1],U=s[V],B=s[V+1],W=s[V+2],j=o*n[$+2],Q=U-I,Z=B-P,X=W-N,ge=s[j]-I,ae=s[j+1]-P,z=s[j+2]-N,he=b*z-ae*x,ce=x*ge-z*w,G=w*ae-ge*b,K=Q*he+Z*ce+X*G;if(Math.abs(K)<=ute)continue;const Se=p-I,Ee=g-P,Ce=y-N,Le=Se*he+Ee*ce+Ce*G;if(K>0){if(Le<0||Le>K)continue}else if(Le>0||Le<K)continue;const Ke=Ee*X-Z*Ce,Re=Ce*Q-X*Se,ze=Se*Z-Q*Ee,vt=w*Ke+b*Re+x*ze;if(K>0){if(vt<0||Le+vt>K)continue}else if(vt>0||Le+vt<K)continue;const Xt=(ge*Ke+ae*Re+z*ze)/K;Xt>=0&&l(Xt,M,a?lte(Q,Z,X,ge,ae,z,mb):null)}}function Lct(t,e,i,r,n,s,o,a,l,c,h,p=null,g=0){const y=t[0],w=t[1],b=t[2],x=e[0],T=e[1],M=e[2];for(let $=i;$<r;++$){const R=g+(p?p[$]:$),I=3*R,P=o*n[I],N=s[P],V=s[P+1],U=s[P+2],B=o*n[I+1],W=s[B],j=s[B+1],Q=s[B+2],Z=o*n[I+2],X=s[Z],ge=s[Z+1],ae=s[Z+2],z=U-l,he=a/Math.sqrt(N*N+V*V+z*z),ce=N+N*he,G=V+V*he,K=U+z*he,Se=Q-l,Ee=a/Math.sqrt(W*W+j*j+Se*Se),Ce=W+W*Ee,Le=j+j*Ee,Ke=Q+Se*Ee,Re=ae-l,ze=a/Math.sqrt(X*X+ge*ge+Re*Re),vt=Ce-ce,Xt=Le-G,li=Ke-K,ti=X+X*ze-ce,zi=ge+ge*ze-G,He=ae+Re*ze-K,Oi=T*He-zi*M,Be=M*ti-He*x,tt=x*zi-ti*T,dt=vt*Oi+Xt*Be+li*tt;if(Math.abs(dt)<=ute)continue;const Rt=y-ce,Je=w-G,Et=b-K,De=Rt*Oi+Je*Be+Et*tt;if(dt>0){if(De<0||De>dt)continue}else if(De>0||De<dt)continue;const at=Je*li-Xt*Et,It=Et*vt-li*Rt,Ki=Rt*Xt-vt*Je,Yi=x*at+T*It+M*Ki;if(dt>0){if(Yi<0||De+Yi>dt)continue}else if(Yi>0||De+Yi<dt)continue;const er=(ti*at+zi*It+He*Ki)/dt;er>=0&&h(er,R,c?lte(vt,Xt,li,ti,zi,He,mb):null)}}function Dct(t,e,i,r,n,s,o,a,l,c,h){const p=t[0],g=t[1],y=t[2],w=e[0],b=e[1],x=e[2],{normalRequired:T}=c;for(let M=i;M<r;++M){const $=a[M],R=3*$,I=o*n[R];let P=s[I],N=s[I+1],V=s[I+2];const U=o*n[R+1];let B=s[U],W=s[U+1],j=s[U+2];const Q=o*n[R+2];let Z=s[Q],X=s[Q+1],ge=s[Q+2];l!=null&&([P,N,V]=l.applyToVertex(P,N,V,M),[B,W,j]=l.applyToVertex(B,W,j,M),[Z,X,ge]=l.applyToVertex(Z,X,ge,M));const ae=B-P,z=W-N,he=j-V,ce=Z-P,G=X-N,K=ge-V,Se=b*K-G*x,Ee=x*ce-K*w,Ce=w*G-ce*b,Le=ae*Se+z*Ee+he*Ce;if(Math.abs(Le)<=ute)continue;const Ke=p-P,Re=g-N,ze=y-V,vt=Ke*Se+Re*Ee+ze*Ce;if(Le>0){if(vt<0||vt>Le)continue}else if(vt>0||vt<Le)continue;const Xt=Re*he-z*ze,li=ze*ae-he*Ke,ti=Ke*z-ae*Re,zi=w*Xt+b*li+x*ti;if(Le>0){if(zi<0||vt+zi>Le)continue}else if(zi>0||vt+zi<Le)continue;const He=(ce*Xt+G*li+K*ti)/Le;He>=0&&h(He,$,T?lte(ae,z,he,ce,G,K,mb):null)}}function DOe(t,e,i,r,n,s,o,a,l,c){const h=e,p=jct,g=Math.abs(h[0]),y=Math.abs(h[1]),w=Math.abs(h[2]),b=g>=y?g>=w?0:2:y>=w?1:2,x=b,T=h[x]<0?2:1,M=(b+T)%3,$=(b+(3-T))%3,R=h[M]/h[x],I=h[$]/h[x],P=1/h[x],N=Nct,V=Fct,U=kct,{normalRequired:B}=l;for(let W=i;W<r;++W){const j=3*W,Q=o*n[j];ve(p[0],s[Q+0],s[Q+1],s[Q+2]);const Z=o*n[j+1];ve(p[1],s[Z+0],s[Z+1],s[Z+2]);const X=o*n[j+2];ve(p[2],s[X+0],s[X+1],s[X+2]),a&&(ye(p[0],a.applyToVertex(p[0][0],p[0][1],p[0][2],W)),ye(p[1],a.applyToVertex(p[1][0],p[1][1],p[1][2],W)),ye(p[2],a.applyToVertex(p[2][0],p[2][1],p[2][2],W))),nr(N,p[0],t),nr(V,p[1],t),nr(U,p[2],t);const ge=N[M]-R*N[x],ae=N[$]-I*N[x],z=V[M]-R*V[x],he=V[$]-I*V[x],ce=U[M]-R*U[x],G=U[$]-I*U[x],K=ce*he-G*z,Se=ge*G-ae*ce,Ee=z*ae-he*ge;if((K<0||Se<0||Ee<0)&&(K>0||Se>0||Ee>0))continue;const Ce=K+Se+Ee;if(Ce===0)continue;const Le=K*(P*N[x])+Se*(P*V[x])+Ee*(P*U[x]);if(Le*Math.sign(Ce)<0)continue;const Ke=Le/Ce;Ke>=0&&c(Ke,W,B?Uct(p):null)}}const Nct=A(),Fct=A(),kct=A();function lte(t,e,i,r,n,s,o){return ve(bk,t,e,i),ve(xk,r,n,s),Ot(o,bk,xk),Me(o,o),o}function Uct(t){return nr(bk,t[1],t[0]),nr(xk,t[2],t[0]),Ot(mb,bk,xk),Me(mb,mb),mb}const bk=A(),xk=A();function zct(t,e,i){return ve(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Vct(t,e){return ve(e,1/t[0],1/t[1],1/t[2])}function NOe(t,e,i,r){return cte(t,e,i,r,1/0)}function cte(t,e,i,r,n){const s=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-r-e[1])*i[1],h=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(t[2]-r-e[2])*i[2],g=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(p,g)),!(l<0)&&(a=Math.max(a,Math.min(p,g)),!(a>l)&&a<n)}const Bct=1e3,ute=1e-7,FOe=A(),jct=[A(),A(),A()];let Gct=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.get(k.POSITION).indices.length}write(e,i,r,n,s,o){Lot(r,n,this.vertexBufferLayout,e,i,s,o)}};function Kz(t){t.attributes.add(k.POSITION,"vec3"),t.vertex.code.add(C`vec3 positionModel() { return position; }`)}function nR(t,e){t.include(Kz);const i=t.vertex;i.include(ote,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new fi("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new fi("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new xd("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Bs("transformProjFromView",r=>r.transformProjFromView),new wk("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Uu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Uu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(C`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(C`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?C`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:C`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new fi("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(C`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(C`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let Hct=class extends Ar{constructor(){super(...arguments),this.transformWorldFromViewTH=A(),this.transformWorldFromViewTL=A(),this.transformViewFromCameraRelativeRS=In(),this.transformProjFromView=ut()}},qct=class extends Ar{constructor(){super(...arguments),this.transformWorldFromModelRS=In(),this.transformWorldFromModelTH=A(),this.transformWorldFromModelTL=A()}};function eV(t,e){switch(e.normalType){case an.Attribute:case an.Compressed:t.include(lM,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new wk("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new xd("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(C`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case an.ScreenDerivative:t.vertex.code.add(C`void forwardNormal() {}`);break;default:e.normalType;case an.COUNT:}}let kOe=class extends Hct{constructor(){super(...arguments),this.transformNormalViewFromGlobal=In()}},UOe=class extends qct{constructor(){super(...arguments),this.transformNormalGlobalFromModel=In(),this.toMapSpace=Ti()}};const Wct={func:gr.LESS},cde={func:gr.ALWAYS},Sk={mask:255},Zct={mask:0},Yct=t=>({function:{func:gr.NOTEQUAL,ref:t,mask:t},operation:{fail:wn.KEEP,zFail:wn.KEEP,zPass:wn.KEEP}}),Xct=t=>({function:{func:gr.ALWAYS,ref:t,mask:t},operation:{fail:wn.KEEP,zFail:wn.KEEP,zPass:wn.REPLACE}}),hte={function:{func:gr.ALWAYS,ref:Hu.OutlineVisualElementMask,mask:Hu.OutlineVisualElementMask},operation:{fail:wn.KEEP,zFail:wn.KEEP,zPass:wn.ZERO}},GZ={function:{func:gr.ALWAYS,ref:Hu.OutlineVisualElementMask,mask:Hu.OutlineVisualElementMask},operation:{fail:wn.KEEP,zFail:wn.KEEP,zPass:wn.REPLACE}},Jct={function:{func:gr.EQUAL,ref:Hu.OutlineVisualElementMask,mask:Hu.OutlineVisualElementMask},operation:{fail:wn.KEEP,zFail:wn.KEEP,zPass:wn.KEEP}},Qct={function:{func:gr.NOTEQUAL,ref:Hu.OutlineVisualElementMask,mask:Hu.OutlineVisualElementMask},operation:{fail:wn.KEEP,zFail:wn.KEEP,zPass:wn.KEEP}};function HZ(t){t.varyings.add("linearDepth","float")}function dte(t){t.vertex.uniforms.add(new rs("nearFar",(e,i)=>i.camera.nearFar))}function zOe(t){t.vertex.code.add(C`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function tV(t,e){const{vertex:i}=t;switch(e.output){case J.Color:case J.ColorEmission:if(e.receiveShadows)return HZ(t),void i.code.add(C`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case J.Shadow:case J.ShadowHighlight:case J.ShadowExcludeHighlight:case J.ViewshedShadow:return t.include(nR,e),HZ(t),dte(t),zOe(t),void i.code.add(C`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(C`void forwardLinearDepth() {}`)}function VOe(t){t.vertex.code.add(C`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function tv(t){zOe(t),t.vertex.code.add(C`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(C`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}function qZ(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function Kct(t,e){const i=t.length;for(let r=0;r<i;++r)P2[0]=t[r],e[r]=P2[0];return e}function eut(t,e){const i=t.length;for(let r=0;r<i;++r)P2[0]=t[r],P2[1]=t[r]-P2[0],e[r]=P2[1];return e}const P2=new Float32Array(2),ude=In();function BOe(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new Bs("model",s=>s.modelTransformation??Js)),t.vertex.uniforms.add(new xd("normalLocalOriginFromModel",s=>(_Se(ude,s.modelTransformation??Js),ude)))),e.instanced&&r&&(t.attributes.add(k.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(k.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(k.INSTANCEMODEL,"mat3"),t.attributes.add(k.INSTANCEMODELNORMAL,"mat3"));const n=t.vertex;r&&(n.include(ote,e),n.uniforms.add(new Uu("viewOriginHi",(s,o)=>Kct(ve(cD,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),cD)),new Uu("viewOriginLo",(s,o)=>eut(ve(cD,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),cD)))),n.code.add(C`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?C`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),n.code.add(C`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===J.Normal&&(mk(n),n.code.add(C`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&n.code.add(C`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const cD=A();function jOe(t,e){e.hasSymbolColors?(t.include(ROe),t.attributes.add(k.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(C`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new Mm("colorMixMode",i=>k$e[i.colorMixMode])),t.vertex.code.add(C`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function iV(t,e){e.hasVertexColors?(t.attributes.add(k.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(C`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(C`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(C`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function GOe(t){t.code.add(C`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function pte(t,e){switch(e.output){case J.Shadow:case J.ShadowHighlight:case J.ShadowExcludeHighlight:case J.ViewshedShadow:t.fragment.include(GOe),t.fragment.code.add(C`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}let HOe=class extends Mn{constructor(e,i){super(e,"float",Fi.Draw,(r,n,s)=>r.setUniform1f(e,i(n,s)))}};function L2(t,e){qOe(t,e,new rt("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function tut(t,e){qOe(t,e,new HOe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function qOe(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode){case Ks.Blend:t.fragment.code.add(C`
        #define discardOrAdjustAlpha(color) { if (color.a < ${C.float(fn)}) { discard; } }
      `);break;case Ks.Opaque:r.code.add(C`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Ks.Mask:r.uniforms.add(i).code.add(C`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Ks.MaskBlend:r.uniforms.add(i).code.add(C`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function WOe(t,e){const{vertex:i,fragment:r}=t,n=e.hasColorTexture&&e.alphaDiscardMode!==Ks.Opaque,{output:s,normalType:o,hasColorTextureTransform:a}=e;switch(s){case J.Depth:sy(i,e),t.include(tv,e),t.include(lm,e),t.include(oy,e),n&&r.uniforms.add(new ht("tex",l=>l.texture)),i.main.add(C`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),t.include(L2,e),r.main.add(C`
          discardBySlice(vpos);
          ${Ge(n,C`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}`);break;case J.Shadow:case J.ShadowHighlight:case J.ShadowExcludeHighlight:case J.ViewshedShadow:case J.ObjectAndLayerIdColor:sy(i,e),t.include(tv,e),t.include(oy,e),t.include(Pb,e),t.include(pte,e),t.include(lm,e),t.include(jee,e),dte(t),t.varyings.add("depth","float"),n&&r.uniforms.add(new ht("tex",l=>l.texture)),i.main.add(C`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),t.include(L2,e),r.main.add(C`
          discardBySlice(vpos);
          ${Ge(n,C`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}
          ${s===J.ObjectAndLayerIdColor?C`outputObjectAndLayerIdColor();`:C`outputDepth(depth);`}`);break;case J.Normal:{sy(i,e),t.include(tv,e),t.include(lM,e),t.include(eV,e),t.include(oy,e),t.include(Pb,e),n&&r.uniforms.add(new ht("tex",c=>c.texture)),o===an.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const l=o===an.Attribute||o===an.Compressed;i.main.add(C`
          vpos = getVertexInLocalOriginSpace();
          ${l?C`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:C`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
          vpos = subtractOrigin(vpos);
          vpos = addVerticalOffset(vpos, localOrigin);
          gl_Position = transformPosition(proj, view, vpos);
          forwardTextureCoordinates();`),t.include(lm,e),t.include(L2,e),r.main.add(C`
          discardBySlice(vpos);
          ${Ge(n,C`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}

          ${o===an.ScreenDerivative?C`vec3 normal = screenDerivativeNormal(vPositionView);`:C`vec3 normal = normalize(vNormalWorld);
                     if (gl_FrontFacing == false){
                       normal = -normal;
                     }`}
          fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case J.Highlight:sy(i,e),t.include(tv,e),t.include(oy,e),t.include(Pb,e),n&&r.uniforms.add(new ht("tex",l=>l.texture)),i.main.add(C`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),t.include(lm,e),t.include(L2,e),t.include(dI,e),r.main.add(C`
          discardBySlice(vpos);
          ${Ge(n,C`vec4 texColor = texture(tex, ${a?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}
          calculateOcclusionAndOutputHighlight();`)}}function ZOe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(k.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===eo.WindingOrder?i.code.add(C`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(C`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(C`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==ts.None&&(t.include(Yz,e),i.uniforms.add(e.bindType===Fi.Pass?new ht("normalTexture",r=>r.textureNormal):new $m("normalTexture",r=>r.textureNormal)),e.hasNormalTextureTransform&&(i.uniforms.add(new rs("scale",r=>r.scale??Yxe)),i.uniforms.add(new xd("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??vx))),i.code.add(C`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&i.code.add(C`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(C`return tangentSpace * rawNormal;
}`))}var Vr,Ro;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(Vr||(Vr={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(Ro||(Ro={}));const YOe=3e5,Tk=5e5;let fte=class extends Mn{constructor(e,i){super(e,"vec2",Fi.Draw,(r,n,s,o)=>r.setUniform2fv(e,i(n,s,o)))}};const OG=4;function XOe(){const t=new or,e=t.fragment;t.include(xa);const i=(OG+1)/2,r=1/(2*i*i);return e.include(qy),e.uniforms.add(new ht("depthMap",n=>n.depthTexture),new $m("tex",n=>n.colorTexture),new fte("blurSize",n=>n.blurSize),new rt("projScale",(n,s)=>{const o=s.camera.distance;return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale})),e.code.add(C`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${C.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.main.add(C`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${C.int(OG)}; r <= ${C.int(OG)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),t}const iut=Object.freeze(Object.defineProperty({__proto__:null,build:XOe},Symbol.toStringTag,{value:"Module"}));let hde=class extends hr{constructor(e,i,r){super(e,i,new ar(iut,()=>fe(()=>Promise.resolve().then(()=>eAt),void 0)),r)}initializePipeline(){return Pi({colorWrite:Qi})}};const rut="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let nut=class extends Ar{constructor(){super(...arguments),this.projScale=1}},sut=class extends nut{constructor(){super(...arguments),this.intensity=1}},out=class extends Ar{},aut=class extends out{constructor(){super(...arguments),this.blurSize=Yt()}};function rV(t){t.fragment.uniforms.add(new Yr("projInfo",(e,i)=>lut(i.camera))),t.fragment.uniforms.add(new rs("zScale",(e,i)=>cut(i.camera))),t.fragment.code.add(C`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function lut(t){const e=t.projectionMatrix;return e[11]===0?_n(dde,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):_n(dde,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const dde=Ti();function cut(t){return t.projectionMatrix[11]===0?ln(pde,0,1):ln(pde,1,0)}const pde=Yt(),fde=16;function JOe(){const t=new or,e=t.fragment;return t.include(xa),t.include(rV),e.include(qy),e.uniforms.add(new rt("radius",(i,r)=>nV(r.camera))).code.add(C`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(C`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new ht("normalMap",i=>i.normalTexture),new ht("depthMap",i=>i.depthTexture),new rt("projScale",i=>i.projScale),new ht("rnm",i=>i.noiseTexture),new rs("rnmScale",(i,r)=>ln(mde,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new rt("intensity",i=>i.intensity),new rs("screenSize",(i,r)=>ln(mde,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.main.add(C`
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${C.int(fde)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${C.int(fde)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

      fragOcclusion = A;`),t}function nV(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const mde=Yt(),uut=Object.freeze(Object.defineProperty({__proto__:null,build:JOe,getRadius:nV},Symbol.toStringTag,{value:"Module"}));let gde=class extends hr{constructor(e,i,r){super(e,i,new ar(uut,()=>fe(()=>Promise.resolve().then(()=>tAt),void 0)),r)}initializePipeline(){return Pi({colorWrite:Qi})}};const KO=2;let $w=class extends Hy{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=ii.SSAO,this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new sut,this._drawParameters=new aut}initialize(){const e=Uint8Array.from(atob(rut),r=>r.charCodeAt(0)),i=new jr;i.wrapMode=Tr.CLAMP_TO_EDGE,i.pixelFormat=kt.RGB,i.wrapMode=Tr.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new fr(this.renderingContext,i,e),this.techniques.precompile(gde),this.techniques.precompile(hde),this.addHandles(oe(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=Ht(this._passParameters.noiseTexture)}render(e){const i=this.bindParameters,r=e.find(({name:N})=>N==="normals"),n=r==null?void 0:r.getTexture(),s=r==null?void 0:r.getTexture(rx),o=this.fboCache,a=i.camera,l=a.fullViewport[2],c=a.fullViewport[3],h=Math.round(l/KO),p=Math.round(c/KO),g=this.techniques.acquire(gde),y=this.techniques.acquire(hde);if(!g.compiled||!y.compiled)return this._enableTime=performance.now(),this.requestRender(Gt.UPDATE),g.release(),y.release(),o.acquire(h,p,ii.SSAO,Vr.RED);this._enableTime===0&&(this._enableTime=performance.now());const w=this.renderingContext,b=this.view.qualitySettings.fadeDuration,x=a.relativeElevation,T=Oe((Tk-x)/(Tk-YOe),0,1),M=b>0?Math.min(b,performance.now()-this._enableTime)/b:1,$=M*T;this._passParameters.normalTexture=n,this._passParameters.depthTexture=s,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*hut/nV(a)**6*$;const R=o.acquire(l,c,"ssao input",Vr.RG);w.bindFramebuffer(R.fbo),w.setViewport(0,0,l,c),w.bindTechnique(g,i,this._passParameters,this._drawParameters),w.screen.draw(),g.release();const I=o.acquire(h,p,"ssao blur",Vr.RED);w.bindFramebuffer(I.fbo),this._drawParameters.colorTexture=R.getTexture(),ln(this._drawParameters.blurSize,0,KO/c),w.bindTechnique(y,i,this._passParameters,this._drawParameters),w.setViewport(0,0,h,p),w.screen.draw(),R.release();const P=o.acquire(h,p,ii.SSAO,Vr.RED);return w.bindFramebuffer(P.fbo),w.setViewport(0,0,l,c),w.setClearColor(1,1,1,0),w.clear(Xi.COLOR),this._drawParameters.colorTexture=I.getTexture(),ln(this._drawParameters.blurSize,KO/l,0),w.bindTechnique(y,i,this._passParameters,this._drawParameters),w.setViewport(0,0,h,p),w.screen.draw(),y.release(),w.setViewport4fv(a.fullViewport),I.release(),M<1&&this.requestRender(Gt.UPDATE),P}};u([f()],$w.prototype,"consumes",void 0),u([f()],$w.prototype,"produces",void 0),u([f({constructOnly:!0})],$w.prototype,"techniques",void 0),u([f({constructOnly:!0})],$w.prototype,"isEnabled",void 0),$w=u([L("esri.views.3d.webgl-engine.effects.ssao.SSAO")],$w);const hut=.5;function sV(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new ht("ssaoTex",(r,n)=>{var s;return(s=n.ssao)==null?void 0:s.getTexture()})),i.constants.add("blurSizePixelsInverse","float",1/KO),i.code.add(C`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(C`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function QOe(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new fi("lightingAmbientSH0",(n,s)=>ve(yde,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),i.code.add(C`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new Yr("lightingAmbientSH_R",(n,s)=>_n(Km,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new Yr("lightingAmbientSH_G",(n,s)=>_n(Km,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new Yr("lightingAmbientSH_B",(n,s)=>_n(Km,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),i.code.add(C`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new fi("lightingAmbientSH0",(n,s)=>ve(yde,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new Yr("lightingAmbientSH_R1",(n,s)=>_n(Km,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new Yr("lightingAmbientSH_G1",(n,s)=>_n(Km,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new Yr("lightingAmbientSH_B1",(n,s)=>_n(Km,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new Yr("lightingAmbientSH_R2",(n,s)=>_n(Km,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new Yr("lightingAmbientSH_G2",(n,s)=>_n(Km,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new Yr("lightingAmbientSH_B2",(n,s)=>_n(Km,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),i.code.add(C`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Ut.Normal&&e.pbrMode!==Ut.Schematic||i.code.add(C`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const yde=A(),Km=Ti();function Om(t){t.uniforms.add(new fi("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function Iy(t){t.uniforms.add(new fi("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function dut(t){Om(t.fragment),Iy(t.fragment),t.fragment.code.add(C`vec3 applyShading(vec3 shadingNormalWorld, float shadow) {
float dotVal = clamp(dot(shadingNormalWorld, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}function put(t){const e=t.fragment.code;e.add(C`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(C`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(C`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function fI(t){const e=3.141592653589793,i=.3183098861837907;t.vertex.constants.add("PI","float",e),t.fragment.constants.add("PI","float",e),t.fragment.constants.add("LIGHT_NORMALIZATION","float",i),t.fragment.constants.add("INV_PI","float",i),t.fragment.constants.add("HALF_PI","float",1.570796326794897),t.fragment.constants.add("TWO_PI","float",6.28318530717958)}function mte(t,e){const i=t.fragment.code;t.include(fI),e.pbrMode!==Ut.Normal&&e.pbrMode!==Ut.Schematic&&e.pbrMode!==Ut.Simplified&&e.pbrMode!==Ut.TerrainWithWater||(i.add(C`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(C`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Ut.Normal&&e.pbrMode!==Ut.Schematic||(t.include(put),i.add(C`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(C`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(C`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(C`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function fut(t,e){const i=t.fragment.code;t.include(fI),i.add(C`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(C`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(C`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(C`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(C`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}function mut(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function AG(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function _E(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function KOe(t){return(t+1)*(t+1)}function gut(t){return Oe(Math.floor(Math.sqrt(t)-1),0,2)}function eAe(t,e,i){const r=t[0],n=t[1],s=t[2],o=i||[];return o.length=KOe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*r*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*r*s,o[8]=.54627421529*(r*r-n*n)),o}function yut(t,e){const i=KOe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0;return r}function _ut(t,e){const i=gut(e.r.length);for(const r of t)od(WZ,r.direction),eAe(WZ,i,iy),mut(iy,BF),AG(iy,r.intensity[0],DS),_E(e.r,DS),AG(iy,r.intensity[1],DS),_E(e.g,DS),AG(iy,r.intensity[2],DS),_E(e.b,DS);return e}function vut(t,e){eAe(WZ,0,iy);for(const i of t)e.r[0]+=iy[0]*BF[0]*i.intensity[0]*4*Math.PI,e.g[0]+=iy[0]*BF[0]*i.intensity[1]*4*Math.PI,e.b[0]+=iy[0]*BF[0]*i.intensity[2]*4*Math.PI;return e}function wut(t,e,i,r){yut(e,r),ve(i.intensity,0,0,0);let n=!1;const s=but,o=xut,a=Sut;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof X5&&!n?(ye(i.direction,l.direction),ye(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,n=!0):l instanceof X5||l instanceof JCe?s.push(l):l instanceof lee?o.push(l):l instanceof QCe&&a.push(l);_ut(s,r),vut(o,r);for(const l of a)_E(r.r,l.r),_E(r.g,l.g),_E(r.b,l.b)}const but=[],xut=[],Sut=[],iy=[0],DS=[0],WZ=A(),BF=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let _de=class{constructor(){this.color=A(),this.intensity=1}},Tut=class{constructor(){this.direction=A(),this.ambient=new _de,this.diffuse=new _de}};const tAe=.4;let RG=class{constructor(){this._shOrder=2,this._legacy=new Tut,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new QCe,this._mainLight=new X5(A(),Qe(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){wut(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ye(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,ue(this._legacy.diffuse.color,this._mainLight.intensity,i),ye(uD,this._legacy.diffuse.color),ue(uD,uD,tAe*this.globalFactor),xe(this._legacy.ambient.color,this._legacy.ambient.color,uD)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ye(this._mainLight.direction,e.mainLight.direction),ye(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(br(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Bt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Bt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ye(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Bt(e.globalFactor,i.globalFactor,r),this.noonFactor=Bt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=Bt(e.sh.r[n],i.sh.r[n],r),this._sphericalHarmonics.g[n]=Bt(e.sh.g[n],i.sh.g[n],r),this._sphericalHarmonics.b[n]=Bt(e.sh.b[n],i.sh.b[n],r);else for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=i.sh.r[n],this._sphericalHarmonics.g[n]=i.sh.g[n],this._sphericalHarmonics.b[n]=i.sh.b[n]}};const uD=A();function oV(t){t.constants.add("ambientBoostFactor","float",tAe)}function vC(t){t.uniforms.add(new rt("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function wC(t,e){const i=t.fragment;switch(t.include(sV,e),e.pbrMode!==Ut.Disabled&&t.include(mte,e),t.include(QOe,e),t.include(fI),i.code.add(C`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Ut.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),oV(i),vC(i),Om(i),i.code.add(C`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?C`normalize(vPosWorld)`:C`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Iy(i),i.code.add(C`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Ut.Disabled:case Ut.WaterOnIntegratedMesh:case Ut.Water:t.include(dut),i.code.add(C`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Ut.Normal:case Ut.Schematic:i.code.add(C`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec4 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(C`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new Ay("hasFillLights",(r,n)=>n.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(C`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new rt("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new rt("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)).code.add(C`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(C`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : pow(_emission.rgb, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==Ut.Schematic||e.hasColorTexture?C`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:C`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Ut.Simplified:case Ut.TerrainWithWater:Om(i),Iy(i),i.code.add(C`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Ut.COUNT:}}let Eut=class extends Mn{constructor(e,i,r){super(e,"mat4",Fi.Draw,(n,s,o,a)=>n.setUniformMatrix4fv(e,i(s,o,a)),r)}},Cut=class extends Mn{constructor(e,i,r){super(e,"mat4",Fi.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,i(s,o)),r)}},Mut=class extends Ar{constructor(){super(...arguments),this.modelTransformation=Js}},gte=class extends Mut{constructor(){super(...arguments),this.origin=A()}};function mI(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Cut("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),iAe(t))}function yte(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Eut("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),iAe(t))}function iAe(t){const e=t.fragment;e.include(GOe),e.uniforms.add(new ht("shadowMap",(i,r)=>r.shadowMap.depthTexture),new Mm("numCascades",(i,r)=>r.shadowMap.numCascades),new Yr("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)).code.add(C`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function $ut(t,e){e.hasColorTextureTransform?(t.varyings.add("colorUV","vec2"),t.vertex.uniforms.add(new xd("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??vx)).code.add(C`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(C`void forwardColorUV(){}`)}function Out(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==ts.None?(t.varyings.add("normalUV","vec2"),t.vertex.uniforms.add(new xd("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??vx)).code.add(C`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(C`void forwardNormalUV(){}`)}function Aut(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==ts.None?(t.varyings.add("emissiveUV","vec2"),t.vertex.uniforms.add(new xd("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??vx)).code.add(C`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(C`void forwardEmissiveUV(){}`)}function Rut(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==ts.None?(t.varyings.add("occlusionUV","vec2"),t.vertex.uniforms.add(new xd("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??vx)).code.add(C`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(C`void forwardOcclusionUV(){}`)}function Iut(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==ts.None?(t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.uniforms.add(new xd("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??vx)).code.add(C`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(C`void forwardMetallicRoughnessUV(){}`)}function _te(t){t.include(aM),t.code.add(C`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${C.int(Vs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${C.int(Vs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${C.int(Vs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${C.int(Vs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${C.int(Vs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function aV(t,e){t.include(dI,e),t.include(Qot,e),t.fragment.include(aM);const i=e.output===J.ObjectAndLayerIdColor,r=nee(e.output),n=yd(e.output)&&e.oitPass===qi.ColorAlpha,s=yd(e.output)&&e.oitPass!==qi.ColorAlpha,o=e.discardInvisibleFragments;let a=0;(s||r||n)&&t.outputs.add("fragColor","vec4",a++),r&&t.outputs.add("fragEmission","vec4",a++),n&&t.outputs.add("fragAlpha","float",a++),t.fragment.code.add(C`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${Ge(i,C`finalColor.a = 1.0;`)}

      ${Ge(o,C`if (finalColor.a < ${C.float(fn)}){
              discard;
              return;
            }`)}

      finalColor = highlightSlice(finalColor, vWorldPosition);
      ${Ge(n,C`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${Ge(s,"fragColor = finalColor;")}
      ${Ge(r,"fragEmission = getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${Ge(i,"outputObjectAndLayerIdColor();")}
    }
  `)}function rAe(t){const e=new or,{vertex:i,fragment:r,varyings:n}=e,{output:s,normalType:o,offsetBackfaces:a,instancedColor:l,spherical:c,receiveShadows:h,snowCover:p,pbrMode:g,textureAlphaPremultiplied:y,instancedDoublePrecision:w,hasVertexColors:b,hasVertexTangents:x,hasColorTexture:T,hasNormalTexture:M,hasNormalTextureTransform:$,hasColorTextureTransform:R}=t;if(sy(i,t),e.include(Kz),n.add("vpos","vec3"),e.include(Pb,t),e.include(BOe,t),e.include(R$e,t),e.include($ut,t),!yd(s))return e.include(WOe,t),e;e.include(Out,t),e.include(Aut,t),e.include(Rut,t),e.include(Iut,t),Uv(i,t),e.include(lM,t),e.include(tv,t);const I=o===an.Attribute||o===an.Compressed;return I&&a&&e.include(VOe),e.include(ZOe,t),e.include(eV,t),l&&e.attributes.add(k.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(oy,t),e.include(tV,t),e.include(jOe,t),e.include(iV,t),i.uniforms.add(new Yr("externalColor",P=>P.externalColor)),n.add("vcolorExt","vec4"),t.terrainDepthTest&&n.add("depth","float"),i.main.add(C`
    forwardNormalizedVertexColor();
    vcolorExt = externalColor;
    ${Ge(l,"vcolorExt *= instanceColor * 0.003921568627451;")}
    vcolorExt *= vvColor();
    vcolorExt *= getSymbolColor();
    forwardColorMixMode();

    if (vcolorExt.a < ${C.float(fn)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    } else {
      vpos = getVertexInLocalOriginSpace();
      vPositionLocal = vpos - view[3].xyz;
      vpos = subtractOrigin(vpos);
      ${Ge(I,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
      vpos = addVerticalOffset(vpos, localOrigin);
      ${Ge(x,"vTangent = dpTransformVertexTangent(tangent);")}
      gl_Position = transformPosition(proj, view, vpos);
      ${Ge(I&&a,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}
    }

    ${Ge(t.terrainDepthTest,"depth = (view * vec4(vpos, 1.0)).z;")}
    forwardLinearDepth();
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();
  `),e.include(wC,t),e.include(sV,t),e.include(L2,t),e.include(w?mI:yte,t),e.include(hI,t),e.include(lm,t),e.include(aV,t),Uv(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new fi("ambient",P=>P.ambient),new fi("diffuse",P=>P.diffuse),new rt("opacity",P=>P.opacity),new rt("layerOpacity",P=>P.layerOpacity)),T&&r.uniforms.add(new ht("tex",P=>P.texture)),e.include(ate,t),e.include(mte,t),r.include(_te),e.include(Oct,t),oV(r),vC(r),Iy(r),r.main.add(C`
      discardBySlice(vpos);
      ${Ge(t.terrainDepthTest,"terrainDepthTest(depth);")}
      ${T?C`
              vec4 texColor = texture(tex, ${R?"colorUV":"vuv0"});
              ${Ge(y,"texColor.rgb /= texColor.a;")}
              discardOrAdjustAlpha(texColor);`:C`vec4 texColor = vec4(1.0);`}
      shadingParams.viewDirection = normalize(vpos - cameraPosition);
      ${o===an.ScreenDerivative?C`vec3 normal = screenDerivativeNormal(vPositionLocal);`:C`shadingParams.normalView = vNormalWorld;
                 vec3 normal = shadingNormal(shadingParams);`}
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

      vec3 posWorld = vpos + localOrigin;

      float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
      float shadow = ${h?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":Ge(c,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};

      vec3 matColor = max(ambient, diffuse);
      vec3 albedo = mixExternalColor(${Ge(b,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
      float opacity_ = layerOpacity * mixExternalOpacity(${Ge(b,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, int(colorMixMode));
      ${M?`mat3 tangentSpace = computeTangentSpace(${x?"normal":"normal, vpos, vuv0"});
             vec3 shadingNormal = computeTextureNormal(tangentSpace, ${$?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
      vec3 normalGround = ${c?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

      ${Ge(p,C`
            float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
            albedo = mix(albedo, vec3(1), snow);
            shadingNormal = mix(shadingNormal, normal, snow);
            ssao = mix(ssao, 1.0, snow);`)}

      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

      ${g===Ut.Normal||g===Ut.Schematic?C`
              float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
              ${Ge(p,C`mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);`)}
              vec4 emission = ${p?"mix(getEmissions(), vec4(0.0), snow)":"getEmissions()"};
              vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:C`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);
  `),e}const Put=Object.freeze(Object.defineProperty({__proto__:null,build:rAe},Symbol.toStringTag,{value:"Module"}));let Lut=class extends kOe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=IOe,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=ic.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=ws,this.instancedDoublePrecision=!1,this.normalType=an.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=xm(.2,.2,.2),this.diffuse=xm(.8,.8,.8),this.externalColor=Ri(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=A(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=dC.Less,this.textureAlphaMode=Ks.Blend,this.textureAlphaCutoff=fn,this.textureAlphaPremultiplied=!1,this.renderOccluded=Dr.Occlude,this.isDecoration=!1}},Dut=class extends UOe{constructor(){super(...arguments),this.origin=A(),this.slicePlaneLocalOrigin=this.origin}},nAe=class extends hr{constructor(e,i,r,n=new ar(Put,()=>fe(()=>Promise.resolve().then(()=>iAt),void 0))){super(e,i,n,r),this.type="DefaultMaterialTechnique"}_makePipeline(e,i){const{oitPass:r,output:n,transparent:s,cullFace:o,customDepthTest:a,hasOccludees:l,enableOffset:c}=e,h=r===qi.NONE,p=r===qi.FrontFace;return Pi({blending:yd(n)&&s?Hee(r):null,culling:Fut(e)?ZEe(o):null,depthTest:{func:Wee(r,Nut(a))},depthWrite:Q$e(e),drawBuffers:n===J.Depth?{buffers:[Fa.NONE]}:Zz(r,n),colorWrite:Qi,stencilWrite:l?Sk:null,stencilTest:l?i?GZ:hte:null,polygonOffset:h||p?null:Zot(c)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Nut(t){return t===dC.Lequal?gr.LEQUAL:gr.LESS}function Fut(t){return t.cullFace!==ic.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}let ir=class extends Ry{constructor(e,i){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=i,this.alphaDiscardMode=Ks.Opaque,this.doubleSidedMode=eo.None,this.pbrMode=Ut.Disabled,this.cullFace=ic.None,this.normalType=an.Attribute,this.customDepthTest=dC.Less,this.emissionSource=ko.None,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0}get textureCoordinateType(){return this.hasColorTexture||this.hasMetallicRoughnessTexture||this.emissionSource===ko.Texture||this.hasOcclusionTexture||this.hasNormalTexture?ts.Default:ts.None}get objectAndLayerIdColorInstanced(){return this.instanced}get discardInvisibleFragments(){return this.transparent}};u([le({count:Ks.COUNT})],ir.prototype,"alphaDiscardMode",void 0),u([le({count:eo.COUNT})],ir.prototype,"doubleSidedMode",void 0),u([le({count:Ut.COUNT})],ir.prototype,"pbrMode",void 0),u([le({count:ic.COUNT})],ir.prototype,"cullFace",void 0),u([le({count:an.COUNT})],ir.prototype,"normalType",void 0),u([le({count:dC.COUNT})],ir.prototype,"customDepthTest",void 0),u([le({count:ko.COUNT})],ir.prototype,"emissionSource",void 0),u([le()],ir.prototype,"hasVertexColors",void 0),u([le()],ir.prototype,"hasSymbolColors",void 0),u([le()],ir.prototype,"hasVerticalOffset",void 0),u([le()],ir.prototype,"hasSlicePlane",void 0),u([le()],ir.prototype,"hasSliceHighlight",void 0),u([le()],ir.prototype,"hasColorTexture",void 0),u([le()],ir.prototype,"hasMetallicRoughnessTexture",void 0),u([le()],ir.prototype,"hasOcclusionTexture",void 0),u([le()],ir.prototype,"hasNormalTexture",void 0),u([le()],ir.prototype,"hasScreenSizePerspective",void 0),u([le()],ir.prototype,"hasVertexTangents",void 0),u([le()],ir.prototype,"hasOccludees",void 0),u([le()],ir.prototype,"hasModelTransformation",void 0),u([le()],ir.prototype,"offsetBackfaces",void 0),u([le()],ir.prototype,"vvSize",void 0),u([le()],ir.prototype,"vvColor",void 0),u([le()],ir.prototype,"receiveShadows",void 0),u([le()],ir.prototype,"receiveAmbientOcclusion",void 0),u([le()],ir.prototype,"textureAlphaPremultiplied",void 0),u([le()],ir.prototype,"instanced",void 0),u([le()],ir.prototype,"instancedColor",void 0),u([le()],ir.prototype,"writeDepth",void 0),u([le()],ir.prototype,"transparent",void 0),u([le()],ir.prototype,"enableOffset",void 0),u([le()],ir.prototype,"terrainDepthTest",void 0),u([le()],ir.prototype,"cullAboveTerrain",void 0),u([le()],ir.prototype,"snowCover",void 0),u([le()],ir.prototype,"hasColorTextureTransform",void 0),u([le()],ir.prototype,"hasEmissionTextureTransform",void 0),u([le()],ir.prototype,"hasNormalTextureTransform",void 0),u([le()],ir.prototype,"hasOcclusionTextureTransform",void 0),u([le()],ir.prototype,"hasMetallicRoughnessTextureTransform",void 0);function sAe(t){const e=new or,{vertex:i,fragment:r,varyings:n}=e,{output:s,offsetBackfaces:o,instancedColor:a,pbrMode:l,snowCover:c,spherical:h}=t,p=l===Ut.Normal||l===Ut.Schematic;if(sy(i,t),e.include(Kz),n.add("vpos","vec3"),e.include(Pb,t),e.include(BOe,t),e.include(R$e,t),s===J.Color&&(Uv(e.vertex,t),e.include(lM,t),e.include(tv,t),o&&e.include(VOe),a&&e.attributes.add(k.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.terrainDepthTest&&n.add("depth","float"),e.include(oy,t),e.include(tV,t),e.include(jOe,t),e.include(iV,t),i.uniforms.add(new Yr("externalColor",g=>g.externalColor)),n.add("vcolorExt","vec4"),i.main.add(C`
      forwardNormalizedVertexColor();
      vcolorExt = externalColor;
      ${Ge(a,"vcolorExt *= instanceColor * 0.003921568627451;")}
      vcolorExt *= vvColor();
      vcolorExt *= getSymbolColor();
      forwardColorMixMode();

      if (vcolorExt.a < ${C.float(fn)}) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      } else {
        vpos = getVertexInLocalOriginSpace();
        localvpos = vpos - view[3].xyz;
        vpos = subtractOrigin(vpos);
        vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        ${Ge(o,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}
      }
      ${Ge(t.terrainDepthTest,"depth = (view * vec4(vpos, 1.0)).z;")}
      forwardLinearDepth();
      forwardTextureCoordinates();`)),s===J.Color){const{hasColorTexture:g,hasColorTextureTransform:y,receiveShadows:w}=t;e.include(wC,t),e.include(sV,t),e.include(L2,t),e.include(t.instancedDoublePrecision?mI:yte,t),e.include(hI,t),e.include(lm,t),e.include(aV,t),Uv(e.fragment,t),Om(r),oV(r),vC(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new fi("ambient",b=>b.ambient),new fi("diffuse",b=>b.diffuse),new rt("opacity",b=>b.opacity),new rt("layerOpacity",b=>b.layerOpacity)),g&&r.uniforms.add(new ht("tex",b=>b.texture)),e.include(ate,t),e.include(mte,t),r.include(_te),Iy(r),r.main.add(C`
      discardBySlice(vpos);
      ${Ge(t.terrainDepthTest,"terrainDepthTest(depth);")}
      vec4 texColor = ${g?`texture(tex, ${y?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${Ge(g,`${Ge(t.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}
        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = ${w?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":h?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};
      vec3 matColor = max(ambient, diffuse);
      ${t.hasVertexColors?C`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:C`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
      ${Ge(c,"albedo = mix(albedo, vec3(1), 0.9);")}
      ${C`vec3 shadingNormal = normalize(vNormalWorld);
             albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}
      ${Ge(p,`vec3 normalGround = ${h?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};`)}
      ${p?C`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                 ${Ge(c,C`mrr = vec3(0.0, 1.0, 0.04);`)}
            vec4 emission = ${c?"vec4(0.0)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:C`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);`)}return e.include(WOe,t),e}const kut=Object.freeze(Object.defineProperty({__proto__:null,build:sAe},Symbol.toStringTag,{value:"Module"}));let Uut=class extends nAe{constructor(e,i,r){super(e,i,r,new ar(kut,()=>fe(()=>Promise.resolve().then(()=>rAt),void 0))),this.type="RealisticTreeTechnique"}},vte=class extends qz{constructor(e,i){super(e,Vut),this.materialType="default",this.supportsEdges=!0,this.produces=new Map([[Ie.OPAQUE_MATERIAL,r=>(hue(r)||Aj(r))&&!this.parameters.transparent],[Ie.TRANSPARENT_MATERIAL,r=>(hue(r)||Aj(r))&&this.parameters.transparent&&this.parameters.writeDepth],[Ie.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,r=>(vet(r)||Aj(r))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._vertexBufferLayout=jut(this.parameters),this._configuration=new ir(i.spherical,i.doublePrecisionRequiresObfuscation)}isVisibleForOutput(e){return e!==J.Shadow&&e!==J.ShadowExcludeHighlight&&e!==J.ShadowHighlight||this.parameters.castShadows}get visible(){const e=this.parameters;if(e.layerOpacity<fn)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:n,vvColor:s}=e,o=i||s||n,a=e.colorMixMode==="replace",l=e.opacity>=fn;if(r&&o)return a||l;const c=e.externalColor&&e.externalColor[3]>=fn;return r?a?c:l:o?a||l:a?c:l}get hasEmissions(){return!!this.parameters.emissiveTextureId||!Qs(this.parameters.emissiveFactor,ws)}getConfiguration(e,i){const r=this.parameters,{treeRendering:n,doubleSided:s,doubleSidedType:o}=r;return this._configuration.output=e,this._configuration.hasNormalTexture=!n&&!!r.normalTextureId,this._configuration.hasColorTexture=!!r.textureId,this._configuration.hasVertexTangents=!n&&r.hasVertexTangents,this._configuration.instanced=r.isInstanced,this._configuration.instancedDoublePrecision=r.instancedDoublePrecision,this._configuration.vvSize=!!r.vvSize,this._configuration.hasVerticalOffset=r.verticalOffset!=null,this._configuration.hasScreenSizePerspective=r.screenSizePerspective!=null,this._configuration.hasSlicePlane=r.hasSlicePlane,this._configuration.hasSliceHighlight=r.hasSliceHighlight,this._configuration.alphaDiscardMode=r.textureAlphaMode,this._configuration.normalType=n?an.Attribute:r.normalType,this._configuration.transparent=r.transparent,this._configuration.writeDepth=r.writeDepth,r.customDepthTest!=null&&(this._configuration.customDepthTest=r.customDepthTest),this._configuration.hasOccludees=i.hasOccludees,this._configuration.cullFace=r.hasSlicePlane?ic.None:r.cullFace,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.hasModelTransformation=!n&&r.modelTransformation!=null,this._configuration.hasVertexColors=r.hasVertexColors,this._configuration.hasSymbolColors=r.hasSymbolColors,this._configuration.doubleSidedMode=n?eo.WindingOrder:s&&o==="normal"?eo.View:s&&o==="winding-order"?eo.WindingOrder:eo.None,this._configuration.instancedColor=r.hasInstancedColor,this._configuration.receiveShadows=r.receiveShadows&&r.receiveShadows,this._configuration.receiveAmbientOcclusion=r.receiveAmbientOcclusion&&i.ssao!=null,this._configuration.vvColor=!!r.vvColor,this._configuration.textureAlphaPremultiplied=!!r.textureAlphaPremultiplied,this._configuration.pbrMode=r.usePBR?r.isSchematic?Ut.Schematic:Ut.Normal:Ut.Disabled,this._configuration.hasMetallicRoughnessTexture=!n&&!!r.metallicRoughnessTextureId,this._configuration.emissionSource=n?ko.None:r.emissiveTextureId!=null?ko.Texture:r.usePBR?ko.Value:ko.None,this._configuration.hasOcclusionTexture=!n&&!!r.occlusionTextureId,this._configuration.offsetBackfaces=!(!r.transparent||!r.offsetTransparentBackfaces),this._configuration.oitPass=i.oitPass,this._configuration.enableOffset=i.camera.relativeElevation<Wot,this._configuration.snowCover=But(i),this._configuration.hasColorTextureTransform=!!r.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!r.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!r.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!r.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!r.metallicRoughnessTextureTransformMatrix,this._configuration}intersect(e,i,r,n,s,o){if(this.parameters.verticalOffset!=null){const a=r.camera;ve(PG,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case ct.Global:l=Me(vde,PG);break;case ct.Local:l=ye(vde,qut)}let c=0;const h=Ae(Wut,PG,a.eye),p=Fe(h),g=ue(h,h,1/p);let y=null;this.parameters.screenSizePerspective&&(y=Te(l,g)),c+=F$e(a,p,this.parameters.verticalOffset,y??0,this.parameters.screenSizePerspective),ue(l,l,c),Zl(IG,l,r.transform.inverseRotation),n=Ae(Gut,n,IG),s=Ae(Hut,s,IG)}Rct(e,r,n,s,U7(r.verticalOffset),o)}createGLMaterial(e){return new zut(e)}createBufferWriter(){return new Gct(this._vertexBufferLayout)}},zut=class extends D$e{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return ve(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(i.treeRendering?Uut:nAe,e)}},Vut=class extends Lut{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};function But(t){return t.weather!=null&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}function jut(t){const e=Zc().vec3f(k.POSITION);return t.normalType===an.Compressed?e.vec2i16(k.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(k.NORMAL),t.hasVertexTangents&&e.vec4f(k.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(k.UV0),t.hasVertexColors&&e.vec4u8(k.COLOR),t.hasSymbolColors&&e.vec4u8(k.SYMBOLCOLOR),_d()&&e.vec4u8(k.OBJECTANDLAYERIDCOLOR),e}const Gut=A(),Hut=A(),qut=Qe(0,0,1),vde=A(),IG=A(),PG=A(),Wut=A(),oAe=new ite({});function $Ut(t){return t.type==="web-style"?oAe:wte(t.symbolLayers.toArray().map(e=>aAe(t,e)))}function wte(t){let e=0,i=0,r=0,n=!1,s=0;const o=new AOe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++s);return n?new act(s,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new oct(s,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function OUt(t){const e=wte(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const LG={};function aAe(t,e){var n,s;const i=Zut(t,e),r=xct(e)?2:0;switch(e.type){case"extrude":return new _p({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new _p({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new _p({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new _p({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new _p({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return(n=e.resource)!=null&&n.href?new ite({verticesPerFeature:100,memory:i}):{...Yut(((s=e.resource)==null?void 0:s.primitive)??RJe),memory:i};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=Flt;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":a=Dlt;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,h=c+l;let p=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":p+=2*(o-1);break;case"round":p+=2*(o*(Nlt-1)*2+o);break;default:return}return new _p({verticesPerFeature:p,verticesPerCoordinate:h,memory:i})}case"text":case"icon":return new _p({verticesPerFeature:6,memory:i});default:return}}function Zut(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Ml.EXTRUDE_EDGES:Ml.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?Ml.FILL_OUTLINE:Ml.FILL;case"water":return Ml.FILL;case"line":return e.join==="round"?Ml.LINE_ROUND:Ml.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Ml.PATH_ROUND_CIRCLE;case"quad":return Ml.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Ml.PATH_MITER_CIRCLE;case"quad":return Ml.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?Ml.OBJECT_POINT:Ml.OBJECT_POLYGON;case"icon":case"text":return i?Ml.ICON_POINT:Ml.ICON_POLYGON;default:return}}function Yut(t){const e=LG[t];if(e)return e;const i=Xut(sct(t,new vte({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return LG[t]=new _p({verticesPerFeature:i}),LG[t]}function Xut(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const Ml={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}};var Lb;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Lb||(Lb={}));let bte=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Uh.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Uh.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Uh.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Uh.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Uh.FAILED,!Bn(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=jc(this._abortController):this._loadStatus===Uh.LOADING&&(this._loadStatus=Uh.FAILED),this._loader=null}};var Uh;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Uh||(Uh={}));const z0=()=>de.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Jut=class extends bte{constructor(e,i,r,n){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.usedMemory=0,this.logger=z0(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new VZ,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=wde(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=wde(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size||r.rotation!==i.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;s?!this._logGeometryValidationWarnings(i,r,n)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&z0().warnOncePerTick(`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):z0().warnOncePerTick(`${a} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,i,r){const n=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(z0().warnOncePerTick(`${n} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(z0().warnOncePerTick(`${n} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const n=e;if(!isFinite(n.x)||!isFinite(n.y))return z0().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":Jze(e)&&z0().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return Qut}_defaultElevationInfoZ(){return Kut}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new VZ){const r=e.geometry,n=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,i.mode=this.getGeometryElevationMode(r,n),i.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";s&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=s?blt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=bde){const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?r:e?r*e.a:i.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,i=bde){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return SG(null,r);const n=e!=null?mt.toUnitRGB(e):kR;return SG(n,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=SG(r,n);return i&&(s[0]*=i,s[1]*=i,s[2]*=i,s[3]*=i),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return aAe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,n)!==pm.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let n=pm.UPDATE;return e.forEach(s=>{const o=i(s);if(o!=null){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else n=pm.RECREATE}),n}applyRendererDiff(e,i){return Lb.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?uG(i.size.field,e):0,n=i.color?uG(i.color.field,e):0,s=i.opacity?uG(i.opacity.field,e):0;return Ri(r,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&z0().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,n,s,o,a,l,c;return{size:((r=(i=this._fastUpdates)==null?void 0:i.visualVariables.size)==null?void 0:r.field)??null,color:((s=(n=this._fastUpdates)==null?void 0:n.visualVariables.color)==null?void 0:s.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function wde(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const n=i.stops[r].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0;break;case"rotation":e.rotation=!0}}),e}const Qut={mode:"on-the-ground",offset:0,unit:"meters"},Kut={mode:"absolute-height",offset:0,unit:"meters"},bde={hasIntrinsicColor:!1};function eht(t,e){return t==null&&(t=[]),t.push(e),t}function tht(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function iht(t,e,i,r,n){hD[0]=t.get(e,0),hD[1]=t.get(e,1),hD[2]=t.get(e,2),qZ(hD,R1,3),i.set(n,0,R1[0]),r.set(n,0,R1[1]),i.set(n,1,R1[2]),r.set(n,1,R1[3]),i.set(n,2,R1[4]),r.set(n,2,R1[5])}const hD=A(),R1=new Float32Array(6);let lAe=class extends Cm{get geometries(){return this._geometries}get transformation(){return this._transformation??Js}set transformation(e){this._transformation=ps(this._transformation??ut(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?ps(this._shaderTransformation??ut(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Fo.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new cAe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){St(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),eKe(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new ult;for(const i of this._geometries)i.occludees=eht(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=tht(i.occludees,e);this._emit("occlusionChanged",this)}highlight(e){const i=new dOe(e);for(const r of this._geometries)r.addHighlight(i);return this._emit("highlightChanged",this),i}removeHighlight(e){for(const i of this._geometries)i.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===nx.Highlight?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,i){return fs(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=ut()){return fs(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new xde,this._validateBoundingVolume(this._bvWorldSpace,sR.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new xde,this._validateBoundingVolume(this._bvObjectSpace,sR.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===sR.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&rht(s,e,r?n.transformation:this.getCombinedShaderTransformation(n))}br(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const o=r?n.transformation:this.getCombinedShaderTransformation(n),a=eC(o);Mt(Sde,s.center,o);const l=Nr(Sde,e.bounds),c=s.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var i;const e=(i=this._bvWorldSpace)==null?void 0:i.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){}},cAe=class{constructor(){this.min=Qe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Qe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},xde=class extends cAe{constructor(){super(...arguments),this.bounds=Pn()}};function rht(t,e,i){const r=t.bbMin,n=t.bbMax;if(TU(i)){const s=ve(nht,i[12],i[13],i[14]);xe(cu,r,s),xe(Vd,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],cu[o]),e.max[o]=Math.max(e.max[o],Vd[o])}else if(Mt(cu,r,i),Qs(r,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],cu[s]),e.max[s]=Math.max(e.max[s],cu[s]);else{Mt(Vd,n,i);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],cu[s],Vd[s]),e.max[s]=Math.max(e.max[s],cu[s],Vd[s]);for(let s=0;s<3;++s){ye(cu,r),ye(Vd,n),cu[s]=n[s],Vd[s]=r[s],Mt(cu,cu,i),Mt(Vd,Vd,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],cu[o],Vd[o]),e.max[o]=Math.max(e.max[o],cu[o],Vd[o])}}}const nht=A(),cu=A(),Vd=A(),Sde=A();var sR;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(sR||(sR={}));function sht(t,e,i,r,n){if(uAe(t,e))return null;i.localOrigin=aht(t,e);const s=new lAe({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:s,sampledElevation:sOe(s,e,t.elevationProvider,t.renderCoordsHelper,r)}}function DUt(t,e,i,r){return uAe(e,i)?null:sOe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function uAe(t,e){const i=t.clippingExtent;return!!i&&(ec(e,iv,t.elevationProvider.spatialReference),!dJe(i,iv))}function oht(t,e,i){const r=t.elevationContext,n=i.spatialReference;ec(e,iv,n),r.centerPointInElevationSR=Sx(iv[0],iv[1],e.hasZ?iv[2]:0,n??null)}function NUt(t){switch(t.type){case"point":return t;case"polygon":case"extent":return SOe(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=nwe(e,rwe(e)/2);return Sx(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.extent.center}return null}function aht(t,e){return ec(e,iv,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(iv)}const iv=A();function hAe(){return new Float32Array(2)}function lht(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function tm(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function cht(t,e){return new Float32Array(t,e,2)}function dAe(){return hAe()}function pAe(){return tm(1,1)}function fAe(){return tm(1,0)}function mAe(){return tm(0,1)}const uht=dAe(),hht=pAe(),dht=fAe(),pht=mAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:hht,UNIT_X:dht,UNIT_Y:pht,ZEROS:uht,clone:lht,create:hAe,createView:cht,fromValues:tm,ones:pAe,unitX:fAe,unitY:mAe,zeros:dAe},Symbol.toStringTag,{value:"Module"}));function fht(t){t.include(qy),t.uniforms.add(new ht("geometryDepthTexture",(e,i)=>{var r;return(r=i.geometryDepth)==null?void 0:r.attachment})),t.code.add(C`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}function gAe(t){const e=new or,{vertex:i,fragment:r}=e,{terrainDepthTest:n}=t;return i.include(Wz),e.include(L$e,t),e.include(lm,t),e.attributes.add(k.UV0,"vec2"),i.uniforms.add(new Yr("viewport",(s,o)=>o.camera.fullViewport),new rt("lineSize",(s,o)=>s.size>0?Math.max(1,s.size)*o.camera.pixelRatio:0),new rs("pixelToNDC",(s,o)=>ln(Tde,2/o.camera.fullViewport[2],2/o.camera.fullViewport[3])),new rt("borderSize",(s,o)=>s.borderColor?o.camera.pixelRatio:0),new rs("screenOffset",(s,o)=>ln(Tde,s.horizontalScreenOffset*o.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),n&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(Z$e),t.hasScreenSizePerspective&&Hz(i),i.main.add(C`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${Ge(t.occlusionTestEnabled,C`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${t.hasScreenSizePerspective?C`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${Ge(n,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${Ge(t.hudDepth,t.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?C`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:C`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),r.uniforms.add(new Yr("uColor",s=>s.color??hs),new Yr("borderColor",s=>s.borderColor??hs)),n&&(r.include(fht,t),r.uniforms.add(new rs("inverseViewport",(s,o)=>o.inverseViewport))),r.main.add(C`
    ${Ge(n,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${Ge(!t.hudDepth,C`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),e}const Tde=Yt(),mht=Object.freeze(Object.defineProperty({__proto__:null,build:gAe},Symbol.toStringTag,{value:"Module"}));let ght=class extends hr{constructor(e,i,r){super(e,i,new ar(mht,()=>fe(()=>Promise.resolve().then(()=>nAt),void 0)),r)}initializePipeline(e){const i={func:e.terrainDepthTest?gr.ALWAYS:gr.LESS};return Pi(e.hudDepth?{depthTest:i,depthWrite:tI}:{blending:e1(ei.ONE,ei.SRC_ALPHA,ei.ONE_MINUS_SRC_ALPHA,ei.ONE_MINUS_SRC_ALPHA),depthTest:i,colorWrite:Qi})}},Tg=class extends Ry{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.hasSlicePlane=!1,this.terrainDepthTest=!1,this.hasSliceInVertexProgram=!0,this.draped=!1}};u([le()],Tg.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([le()],Tg.prototype,"occlusionTestEnabled",void 0),u([le()],Tg.prototype,"hasVerticalOffset",void 0),u([le()],Tg.prototype,"hasScreenSizePerspective",void 0),u([le()],Tg.prototype,"hudDepth",void 0),u([le()],Tg.prototype,"hudDepthAlignStart",void 0),u([le()],Tg.prototype,"hasSlicePlane",void 0),u([le()],Tg.prototype,"terrainDepthTest",void 0);let DG=class extends qz{constructor(e,i){super(e,yAe),this.produces=new Map([[Ie.LINE_CALLOUTS,r=>r===J.Color],[Ie.LINE_CALLOUTS_HUD_DEPTH,r=>r===J.Color]]),this._configuration=new Tg(i),this._uniqueMaterialIdentifier=ZZ(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){const r=i.slot===Ie.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration}get visible(){var e;return this.parameters.color[3]>=fn||(((e=this.parameters.borderColor)==null?void 0:e[3])??0)>=fn}intersect(){}createGLMaterial(e){return new yht(e)}createBufferWriter(){return new vht}validateParameters(e){this._uniqueMaterialIdentifier=ZZ(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}};function ZZ({renderOccluded:t,isDecoration:e,horizontalScreenOffset:i,color:r,size:n,occlusionTest:s,shaderPolygonOffset:o,hudDepthAlignStart:a,centerOffsetUnits:l,hasSlicePlane:c,screenSizePerspective:h,verticalOffset:p,borderColor:g}){return jNe`${t}:${e}:${i}:[${r}]:${n}:${s}:${o}:${a}:${l}:${c}:${h!=null}:{${p.screenLength}:${p.minWorldLength}:${p.maxWorldLength}}:[${g}]`}let yht=class extends zee{beginSlot(e){return this.acquireTechnique(ght,e)}},yAe=class extends Aot{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=Ri(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const _ht=Zc().vec3f(k.POSITION).vec3f(k.NORMAL).vec2f(k.UV0).vec4f(k.CENTEROFFSETANDDISTANCE),Ede=[tm(0,0),tm(1,0),tm(0,1),tm(1,0),tm(1,1),tm(0,1)];let vht=class{constructor(){this.vertexBufferLayout=_ht}elementCount(e){return 6*e.get(k.POSITION).indices.length}write(e,i,r,n,s,o){Vee(r.get(k.POSITION),e,s.position,o,6),Bee(r.get(k.NORMAL),i,s.normal,o,6),l3(r.get(k.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,o,6);for(let a=0;a<Ede.length;++a)s.uv0.setVec(o+a,Ede[a])}},_Ae=class vAe extends Jut{constructor(e,i){super(e,null,i,xht),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new DG(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){var o;const e=new yAe,i=this.symbol,r=i.callout;if(r.color){const a=mt.toUnitRGBA(r.color);a[3]*=this._getLayerOpacity(),e.color=a}else e.color=hs;if(e.size=qb(r.size||0),i.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=i.verticalOffset;e.verticalOffset={screenLength:qb(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=r.border)==null?void 0:o.color)!=null?mt.toUnitRGBA(r.border.color):null;const n=i.symbolLayers.at(0).type==="object",s=i.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.hudDepthAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return bht}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new VZ,i.elevationOffset||0),s=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!DJe(l)))return null;const a=SOe(r.geometry);return a==null?null:this._createAs3DShape(a,n,i,r.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=Yat(vAe.elevationModeChangeTypes,r,n);return s!==pm.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=Khe(i.elevationContext.mode)}computeComplexity(){return new _p({verticesPerFeature:6})}_getOrCreateMaterial(e){var n;const i=this._perInstanceMaterialParameters(e),r=ZZ(i);if(r===((n=this._materials[0])==null?void 0:n.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(r);return s==null&&(s=new DG(i,this._context.spherical),e.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new DG(i,this._context.spherical),isUnique:!0}}_createAs3DShape(e,i,r,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(r),l=new rc(a.material,wht(r),null,Fo.Point,o),c=sht(this._context,e,l,i,n);if(c==null)return null;const h=new TOe(this,c.object,[l],a.isUnique?[a.material]:null,null,dlt,i);return h.metadata=new Llt(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Khe(i.mode),oht(h,e,this._context.elevationProvider),h}};function wht(t){const{translation:e,centerOffset:i}=t,r=new Ji(e?[e[0],e[1],e[2]]:[0,0,0],NG,3,!0),n=new Ji(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],NG,4,!0);return[[k.POSITION,r],[k.NORMAL,new Ji([0,0,1],NG,3,!0)],[k.CENTEROFFSETANDDISTANCE,n]]}_Ae.elevationModeChangeTypes={definedChanged:pm.UPDATE,staysOnTheGround:pm.UPDATE,onTheGroundChanged:pm.RECREATE};const NG=[0],bht={mode:"relative-to-ground",offset:0},xht={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let Sht=class{constructor(e,i,r=A(),n=Ti(),s=0,o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=n,this.horizontalScreenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},Tht=class extends xlt{};const Cde=()=>de.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Eht(t,e){if(!gEe(t))return Cde().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=Cht[t.callout.type];return i?new i(t,e):(Cde().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Cht={line:_Ae};function HUt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function Mht(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function gI(t){if(Mht(t))return t;const{originPosition:e,scale:i,translate:r}=t,n=i[0]??1,s=i[1]??1;return{originPosition:"lowerLeft",scale:[n,e==="lowerLeft"?s:-s,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function $ht({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function Oht({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function Aht({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function Rht({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function yI({scale:t,translate:e},i){return i*t[0]+e[0]}function _I({scale:t,translate:e},i){return i*t[1]+e[1]}function h3({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function d3({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function xte(t,e){return t&&e?Dht:t&&!e?Pht:!t&&e?Lht:Iht}const Iht=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let n=yI(t,r[0]),s=_I(t,r[1]);i[0]=[n,s];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[p,g]=e[h];n+=l*p,s+=c*g,i[h]=[n,s]}return i},Pht=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let n=yI(t,r[0]),s=_I(t,r[1]);i[0]=[n,s,h3(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[p,g,y]=e[h];n+=l*p,s+=c*g,i[h]=[n,s,h3(t,y)]}return i},Lht=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let n=yI(t,r[0]),s=_I(t,r[1]);i[0]=[n,s,d3(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[p,g,y]=e[h];n+=l*p,s+=c*g,i[h]=[n,s,d3(t,y)]}return i},Dht=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let n=yI(t,r[0]),s=_I(t,r[1]);i[0]=[n,s,h3(t,r[2]),d3(t,r[3])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let h=1;h<e.length;h++){const[p,g,y,w]=e[h];n+=l*p,s+=c*g,i[h]=[n,s,h3(t,y),d3(t,w)]}return i};function wAe(t,e,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=e(t,i[n]);return r}function qUt(t,e,i){const r=gI(t);return e.x=$ht(r,i.x),e.y=Oht(r,i.y),i.z!=null&&(e.z=Aht(r,i.z)),i.m!=null&&(e.m=Rht(r,i.m)),e}function bAe(t,e,i,r=(i==null?void 0:i.hasZ)??!1,n=(i==null?void 0:i.hasM)??!1){if(i!=null){const s=gI(t);e.points=xte(r,n)(s,i.points),e.hasZ=r,e.hasM=n}return e}function xAe(t,e,i,r=(i==null?void 0:i.z)!=null,n=(i==null?void 0:i.m)!=null){if(i==null)return e;const s=gI(t);return e.x=yI(s,i.x),e.y=_I(s,i.y),r&&(e.z=h3(s,i.z)),n&&(e.m=d3(s,i.m)),e}function SAe(t,e,i,r=(i==null?void 0:i.hasZ)??!1,n=(i==null?void 0:i.hasM)??!1){if(i!=null){const s=gI(t);e.rings=wAe(s,xte(r,n),i.rings),e.hasZ=r,e.hasM=n}return e}function TAe(t,e,i,r=(i==null?void 0:i.hasZ)??!1,n=(i==null?void 0:i.hasM)??!1){if(i!=null){const s=gI(t);e.paths=wAe(s,xte(r,n),i.paths),e.hasZ=r,e.hasM=n}return e}let WUt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function YUt(t){return t.geometry!=null}let XUt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function QUt(t,e){var h;const i=Twe.fromJSON(t.geometryType),r=nt.fromJSON(t.spatialReference),n=t.transform,s=t.objectIdFieldName,o=e==null?void 0:e.maxStringAttributeLength,a=e==null?void 0:e.maxStringAttributeFields;let l;const c=t.features.map(p=>{const g=Nht(p,i,r,t.objectIdFieldName),y=g.geometry;if(Vht(g.attributes,a,o,w=>{l??(l=[]);const b=zht(g,s);b!=null&&l.push({objectId:b,attribute:w})}),y!=null&&n)switch(y.type){case"point":g.geometry=xAe(n,y,y);break;case"multipoint":g.geometry=bAe(n,y,y);break;case"polygon":g.geometry=SAe(n,y,y);break;case"polyline":g.geometry=TAe(n,y,y);break;case"extent":case"mesh":g.geometry=y}return g});return{geometryType:i,features:c,spatialReference:r,fields:((h=t.fields)==null?void 0:h.map(p=>Mz.fromJSON(p)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function Nht(t,e,i,r){return{uid:rd(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:Fht(t.geometry,e,i),visible:!0}}function Fht(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function kht(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)i+=s.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(n.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=FNe(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function KUt(t){let e=32;return e+=s_e(t.attributes),e+=3,e+=8+kht(t.geometry),e}function ezt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function tzt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function izt(t,e){switch(fd(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)gj(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)gj(e,t.rings[i],!!t.hasZ);break;case"multipoint":gj(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function Uht(t,e){switch(wy(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)P6(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)P6(e,t.rings[i]);break;case"multipoint":P6(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function zht(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function Vht(t,e,i,r){if(e!=null&&e.size&&i!=null&&t)for(const n in t){if(!e.has(n))continue;const s=t[n];typeof s=="string"&&s.length>i&&(r(n),t[n]="")}}const FG=2;let sf=class kT{constructor(e=[],i=[]){this.lengths=e??[],this.coords=i??[]}static fromJSON(e){return new kT(e.lengths,e.coords)}static fromRect(e){const[i,r,n,s]=e,o=n-i,a=s-r;return new kT([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let s=0;s<n;s++)e(this.coords[FG*(s+i)],this.coords[FG*(s+i)+1]);i+=n}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let n=0;for(const s of r){for(let o=1;o<s;o++)i[2*(n+o)]+=i[2*(n+o)-2],i[2*(n+o)+1]+=i[2*(n+o)-1];n+=s}return e}clone(e){if(this.lengths.length===0)return new kT([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((n,s)=>n+s))*FG,r=this.coords.slice(0,i);return e?(e.set(r),new kT(this.lengths,e)):new kT(Array.from(this.lengths),Array.from(r))}},bC=class jF{constructor(e=null,i={},r,n){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,i){const r=e.geometry?sf.fromJSON(e.geometry):null,n=e.centroid?sf.fromJSON(e.centroid):null,s=e.attributes[i];return new jF(r,e.attributes,n,s)}weakClone(){const e=new jF(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){var r,n;const e=(r=this.geometry)==null?void 0:r.clone(),i=new jF(e,{...this.attributes},(n=this.centroid)==null?void 0:n.clone(),this.objectId);return i.displayId=this.displayId,i.geohashX=this.geohashX,i.geohashY=this.geohashY,i}};function rzt(t){var e,i;return!!((i=(e=t.geometry)==null?void 0:e.coords)!=null&&i.length)}let Bht=class EAe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new EAe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function Wa(t,e){return t?e?4:3:e?3:2}const vI=()=>de.getLogger("esri.layers.graphics.featureConversionUtils"),CAe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},jht=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s},Mde=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2]},Ght=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+3]},Hht=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2],t[i+3]=e[r+3]};function Ste(t,e,i,r){if(t){if(i)return e&&r?Hht:Mde;if(e&&r)return Ght}else if(e&&r)return Mde;return jht}function kG({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function UG({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function zG({scale:t,translate:e},i,r){return i*t[r]+e[r]}function nzt(t,e,i){return t?e?i?Cte(t):Tte(t):i?Ete(t):lV(t):null}function lV(t){const e=t.coords;return{x:e[0],y:e[1]}}function MAe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function Tte(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function qht(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function Ete(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Wht(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function Cte(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Zht(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Yht(t,e,i,r){let n=lV;i&&r?n=Cte:i?n=Tte:r&&(n=Ete);for(const s of e){const{geometry:o,attributes:a}=s,l=o!=null?n(o):null;t.push({attributes:a,geometry:l})}return t}function Mte(t,e){return t&&e?Zht:t?qht:e?Wht:MAe}function Xht(t,e,i,r,n){const s=Mte(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?s(new sf,o):null;t.push(new bC(l,a,null,n?a[n]:void 0))}return t}function Jht(t,e,i=Mte(e.z!=null,e.m!=null)){return i(t,e)}function Qht(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?$Ae(n,i,r):null});return t}function $Ae(t,e,i){if(t==null)return null;const r=Wa(e,i),n=[];for(let s=0;s<t.coords.length;s+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[s+a]);n.push(o)}return e?i?{points:n,hasZ:e,hasM:i}:{points:n,hasZ:e}:i?{points:n,hasM:i}:{points:n}}function Kht(t,e,i,r,n){const s=Wa(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?OAe(new sf,o,s):null;t.push(new bC(l,a,null,n?a[n]:void 0))}return t}function OAe(t,e,i=Wa(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let n=0;for(const s of e.points)for(let o=0;o<i;o++)r[n++]=s[o];return t}function edt(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?AAe(n,i,r):null});return t}function AAe(t,e,i){if(!t)return null;const r=Wa(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let h=0;h<l;h++){const p=[];for(let g=0;g<r;g++)p.push(n[a++]);c.push(p)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function tdt(t,e,i,r,n){const s=Wa(i,r);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?RAe(new sf,o,s):null,h=l!=null?Jht(new sf,l):null;t.push(new bC(c,a,h,n?a[n]:void 0))}return t}function RAe(t,e,i=Wa(e.hasZ,e.hasM)){const{lengths:r,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)n[s++]=a[l];r.push(o.length)}return t}function idt(t,e,i,r){for(const{geometry:n,attributes:s,centroid:o}of e){const a=n!=null?IAe(n,i,r):null;if(o!=null){const l=lV(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function IAe(t,e,i){if(!t)return null;const r=Wa(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let h=0;h<l;h++){const p=[];for(let g=0;g<r;g++)p.push(n[a++]);c.push(p)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function rdt(t,e,i,r,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=s!=null?PAe(new sf,s,i,r):null,c=n?a[n]:void 0;o!=null?t.push(new bC(l,a,MAe(new sf,o),c)):t.push(new bC(l,a,null,c))}return t}function PAe(t,e,i=e.hasZ,r=e.hasM){return ndt(t,e.rings,i,r)}function ndt(t,e,i,r){const n=Wa(i,r),{lengths:s,coords:o}=t;let a=0;fy(t);for(const l of e){for(const c of l)for(let h=0;h<n;h++)o[a++]=c[h];s.push(l.length)}return t}const vE=[],oR=[];function szt(t,e,i,r,n){vE[0]=t;const[s]=LAe(oR,vE,e,i,r,n);return of(vE),of(oR),s}function LAe(t,e,i,r,n,s){if(of(t),!i){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new bC(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return Xht(t,e,r,n,s);case"esriGeometryMultipoint":return Kht(t,e,r,n,s);case"esriGeometryPolyline":return tdt(t,e,r,n,s);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return rdt(t,e,r,n,s);default:vI().error("convertToFeatureSet:unknown-geometry",new Y(`Unable to parse unknown geometry type '${i}'`)),of(t)}return t}function ozt(t,e,i,r){oR[0]=t,DAe(vE,oR,e,i,r);const n=vE[0];return of(vE),of(oR),n}function sdt(t,e,i){if(t==null)return null;const r=new sf;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),pQ(t)?Mte(e??t.z!=null,i??t.m!=null)(r,t):bb(t)?PAe(r,t,e,i):AU(t)?RAe(r,t,Wa(e,i)):dQ(t)?OAe(r,t,Wa(e,i)):void vI().error("convertFromGeometry:unknown-geometry",new Y(`Unable to parse unknown geometry type '${t}'`))}function odt(t,e,i,r){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=lV;return i&&r?s=Cte:i?s=Tte:r&&(s=Ete),s(n)}case"esriGeometryMultipoint":return $Ae(n,i,r);case"esriGeometryPolyline":return AAe(n,i,r);case"esriGeometryPolygon":return IAe(n,i,r);default:return vI().error("convertToGeometry:unknown-geometry",new Y(`Unable to parse unknown geometry type '${e}'`)),null}}function adt(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function DAe(t,e,i,r,n){if(of(t),i==null)return adt(t,e);switch(i){case"esriGeometryPoint":return Yht(t,e,r,n);case"esriGeometryMultipoint":return Qht(t,e,r,n);case"esriGeometryPolyline":return edt(t,e,r,n);case"esriGeometryPolygon":return idt(t,e,r,n);default:vI().error("convertToFeatureSet:unknown-geometry",new Y(`Unable to parse unknown geometry type '${i}'`))}return t}function azt(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:g}=t,y={features:DAe([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:h,queryGeometry:odt(p,g,!1,!1)};return r&&(y.transform=r),c&&(y.exceededTransferLimit=c),s&&(y.hasM=s),o&&(y.hasZ=o),y}function lzt(t,e){const i=new Bht,{hasM:r,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=t;return p&&(i.fields=p),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(s&&LAe(i.features,s,l,n,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),n&&(i.hasZ=n),h&&(i.transform=h),i):(vI().error(new Y("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function czt(t){const{transform:e,features:i,hasM:r,hasZ:n}=t;if(!e)return t;for(const s of i)s.geometry!=null&&Ode(s.geometry,s.geometry,r,n,e),s.centroid!=null&&Ode(s.centroid,s.centroid,r,n,e);return t.transform=null,t}function uzt(t,e){const{geometryType:i,features:r,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new sf,$de(l.geometry,a.geometry,n,s,i,t),a.centroid&&(l.centroid=new sf,$de(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function $de(t,e,i,r,n,s,o=i,a=r){if(fy(t),!(e!=null&&e.coords.length))return null;const l=CAe[n],{coords:c,lengths:h}=e,p=Wa(i,r),g=Wa(i&&o,r&&a),y=Ste(i,r,o,a);if(!h.length)return y(t.coords,c,0,0,kG(s,c[0]),UG(s,c[1])),fy(t,p,0),t;let w,b,x,T,M=0,$=0,R=$;for(const I of h){if(I<l)continue;let P=0;$=R,x=w=kG(s,c[M]),T=b=UG(s,c[M+1]),y(t.coords,c,$,M,x,T),P++,M+=p,$+=g;for(let N=1;N<I;N++,M+=p)x=kG(s,c[M]),T=UG(s,c[M+1]),x===w&&T===b||(y(t.coords,c,$,M,x-w,T-b),$+=g,P++,w=x,b=T);P>=l&&(t.lengths.push(P),R=$)}return of(t.coords,R),t.coords.length?t:null}function hzt(t,e,i,r,n,s,o=i,a=r){if(fy(t),!(e!=null&&e.coords.length))return null;const l=CAe[n],{coords:c,lengths:h}=e,p=Wa(i,r),g=Wa(i&&o,r&&a),y=Ste(i,r,o,a);if(!h.length)return y(t.coords,c,0,0,c[0],c[1]),fy(t,p,0),t;let w=0;const b=s*s;for(const x of h){if(x<l){w+=x*p;continue}const T=t.coords.length/g,M=w,$=w+(x-1)*p;y(t.coords,c,t.coords.length,M,c[M],c[M+1]),YZ(t.coords,c,p,b,y,M,$),y(t.coords,c,t.coords.length,$,c[$],c[$+1]);const R=t.coords.length/g-T;R>=l?t.lengths.push(R):of(t.coords,T*g),w+=x*p}return t.coords.length?t:null}function ldt(t,e,i,r){const n=t[e],s=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let h=o,p=a,g=l-h,y=c-p;if(g!==0||y!==0){const w=((n-h)*g+(s-p)*y)/(g*g+y*y);w>1?(h=l,p=c):w>0&&(h+=g*w,p+=y*w)}return g=n-h,y=s-p,g*g+y*y}function YZ(t,e,i,r,n,s,o){let a,l=r,c=0;for(let h=s+i;h<o;h+=i)a=ldt(e,h,s,o),a>l&&(c=h,l=a);l>r&&(c-s>i&&YZ(t,e,i,r,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>i&&YZ(t,e,i,r,n,c,o))}function dzt(t,e,i,r){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const n=Wa(i,r);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const h=e.coords;for(let p=0;p<h.length;p+=n){const g=h[p],y=h[p+1];s=Math.min(s,g),a=Math.max(a,g),o=Math.min(o,y),l=Math.max(l,y)}}return Eq(t)?mJe(t,s,o,a,l):lQ(s,o,a,l,t),t}function Ode(t,e,i,r,n){const{coords:s,lengths:o}=e,a=Wa(i,r);if(!s.length)return t!==e&&fy(t),t;nU(n);const{originPosition:l,scale:c,translate:h}=n,p=udt;p.originPosition=l;const g=p.scale;g[0]=c[0]??1,g[1]=-(c[1]??1),g[2]=c[2]??1,g[3]=c[3]??1;const y=p.translate;if(y[0]=h[0]??0,y[1]=h[1]??0,y[2]=h[2]??0,y[3]=h[3]??0,!o.length){for(let b=0;b<a;++b)t.coords[b]=zG(p,s[b],b);return t!==e&&fy(t,a,0),t}let w=0;for(let b=0;b<o.length;b++){const x=o[b];t.lengths[b]=x;for(let $=0;$<a;++$)t.coords[w+$]=zG(p,s[w+$],$);let T=t.coords[w],M=t.coords[w+1];w+=a;for(let $=1;$<x;$++,w+=a){T+=s[w]*g[0],M+=s[w+1]*g[1],t.coords[w]=T,t.coords[w+1]=M;for(let R=2;R<a;++R)t.coords[w+R]=zG(p,s[w+R],R)}}return t!==e&&fy(t,s.length,o.length),t}function pzt(t,e,i,r,n,s){if(fy(t),t.lengths.push(...e.lengths),i===n&&r===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Wa(i,r),a=Ste(i,r,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function cdt(t,e,i,r){let n=0,s=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=s+t[r*(e+a)],c=o+t[r*(e+a)+1],h=(l-s)*(c+o);s=l,o=c,n+=h}return .5*n}function fzt(t,e){const{coords:i,lengths:r}=t;let n=0,s=0;for(let o=0;o<r.length;o++){const a=r[o];s+=cdt(i,n,a,e),n+=a}return Math.abs(s)}function fy(t,e=0,i=0){of(t.lengths,i),of(t.coords,e)}function of(t,e=0){t.length!==e&&(t.length=e)}const udt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Ade=new xl(Array,t=>wz(t,sEe),null,10,5),hdt=Zi();let ddt=class{get labelLayers(){return this._labelLayers||LNe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,i,r,n,s){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=ga.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=s?_Oe(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(go.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=go.GRAPHIC,i){const r=i?this._visibleFlags|i|go.LABEL*i:this._visibleFlags;return e===go.GRAPHIC?(r&ga.ALL_GRAPHIC)===ga.ALL_GRAPHIC:(r&ga.ALL_LABEL)===ga.ALL_LABEL}setVisibilityFlag(e,i,r){const n=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const s=this.isVisible(e);if(n===s)return!1;if(e===go.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(go.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return!!(this._visibleFlags&e*i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=Zi(),Uht(i,this._extent);const r=i.spatialReference;if(!xs(r,e)&&!FQ(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=Qp.fromExtent(n.type==="mesh"?n.extent:n)),sdt(n,i,r)}get usedMemory(){let e=s_e(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:A(),num:0},draped:{origin:Yt(),num:0}};for(const i of this.layers)i!=null&&i.computeAttachmentOrigin(e);return e.render.num>1&&ue(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&U_(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?fd(s.boundingBox):s.boundingBox=fd(),s.requiresDrapedElevation=!1,await IJ(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=Ade.acquire(),c=await o.getProjectedBoundingBox(a,r,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&K2e(s.boundingBox,l),Ade.release(l)}),hJe(s.boundingBox)||v9(rEe(s.boundingBox,hdt))?s:null}needsElevationUpdates(){var e;for(const i of this.layers)if(i!=null&&(i.type==="object3d"||i.type==="lod-instance")&&i.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(i=>(i==null?void 0:i.needsElevationUpdates)??!1))??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e==null||e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},gzt=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===ct.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}},pdt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}},fdt=class extends bte{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const n=this.symbolLayers[r];n!=null&&(n.symbol=e,n.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const n=[],{make:s}=await fe(async()=>{const{make:o}=await import("./Graphics3DSymbolLayerFactory-9oBgVetI.js");return{make:o}},__vite__mapDeps([250,173,69,37,166,144,47,64,65,63,66,67,98,218,251,237,221,140,141,49,50,252,137,253,107,254,126,106,229,127]));for(let o=0;o<r;o++){const a=i.at(o);if(a.enabled===!1)continue;dD.renderPriority=1-(1+o)/r,dD.renderPriorityStep=1/r,dD.ignoreDrivers=a.ignoreDrivers;const l=s(this.symbol,a,this._context,dD),c=R3(e,()=>{this.symbolLayers[o]=null,l.destroy()});c&&n.push(c),this.symbolLayers[o]=l}if(await IJ(this.symbolLayers,async(o,a)=>{if(o!=null)try{await o.load(),this._extentPadding+=Math.max(this._extentPadding,o.extentPadding)}catch{this.symbolLayers[a]=null}}),n.forEach(o=>o.remove()),zt(e),this.symbolLayers.length&&!this.symbolLayers.some(o=>!!o))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,i){var o,a;const r=e.graphic,n=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),s=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new ddt(r,i||this,n,e.layer,s)}get complexity(){return wte(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let n=0;n<r;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof TOe?l:null};if(s!=null&&!s.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Uh.LOADED?Lb.RecreateSymbol:this.symbolLayers.reduce((r,n)=>r!==Lb.RecreateSymbol&&n!=null?Math.min(r,n.applyRendererDiff(e,i)):r,Lb.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Uh.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const o=r[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[s];h!=null&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,n)=>r.updateGeometry(n,i))}updateTransform(e,i,r,n){return this._updateGeometryOrTransform(e,(s,o)=>s.updateTransform(o,i,r,n))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const n=this.symbolLayers[r];if(n==null)continue;const s=e.layers[r];if(!s||!i(n,s))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const n=e.layers[i];n!=null&&r.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===Uh.LOADING?e++:n.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,n){const s=this.symbolLayers.filter(Bv).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,n)),o=await Promise.all(s);return zt(n),o.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const dD=new pdt;let mdt=class extends bte{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:oAe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):Lb.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,n){var s;return((s=this.graphics3DSymbol)==null?void 0:s.updateTransform(e,i,r,n))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function $te(t){return t instanceof mdt?t.graphics3DSymbol:t instanceof fdt?t:null}let gdt=class{constructor(e,i="center",r=!1,n=Yt(),s=Ri(0,0,0,-1),o="world",a=A(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=n,this.centerOffset=s,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},ydt=class{constructor(e,i="center",r="center",n=null,s=Yt()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=n,this.displaySize=s}};const Szt=1.2,Tzt=hs,_dt=4;function XZ(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function vdt(t){const{size:e}=t.definition,i=t.fontString(e);let r=Rde.get(i);if(!r){const n=XZ(bdt,0,0).getContext("2d");t.setFontProperties(n,e);const s=n.measureText(xdt);r=new wdt(s.actualBoundingBoxAscent,s.actualBoundingBoxDescent),Rde.set(i,r)}return r}const Rde=new Map;let wdt=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const bdt={canvas:null},xdt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),Ek=1;let Sdt=class{constructor(e,i,r,n){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=XZ(Ide,pD,pD).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let n=2*this._haloSize;const s=this._parameters.definition.font;s.style!=="italic"&&s.style!=="oblique"&&s.weight!=="bold"&&s.weight!=="bolder"||(n+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,h=0;this._lines.forEach((T,M)=>{const $=e.measureText(T),R=$.width/i,I=R+n;this._textWidths.push(R),this._lineWidths.push(I),o=Math.max(o,I),c=Math.max(c,$.actualBoundingBoxAscent/i),h=Math.max(h,$.actualBoundingBoxDescent/i),M===0&&(a=$.actualBoundingBoxAscent/i),M===this._lines.length-1&&(l=$.actualBoundingBoxDescent/i)});const p=vdt(this._parameters),g=Math.max(c,p.maxAscent),y=Math.max(h,p.maxDescent),w=a,b=this._parameters.definition.font.decoration==="underline"?y:l,x=o;this._metricsCached=new Edt(w,b,g,y,x)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*Tdt}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,Ek)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case gv.Left:return this._horizontalPadding;case gv.Center:return(this.displayWidth-this._lineWidths[e])/2;case gv.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const n=i/=this.renderPixelRatio,s=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,i+p,r),this._renderLineDecoration(e,i+p,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+p,r,this._textWidths[c]),r+=this._lineSpacing}if(Cn.TEXT_SHOW_BASELINE){e.strokeStyle=Pde,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let h=0;h<this._lines.length;++h)this._drawLine(e,[n,c],[n+this.displayWidth,c]),c+=this._lineSpacing}if(Cn.TEXT_SHOW_BORDER&&(e.strokeStyle=Pde,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+n+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,n){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=Oe(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+n),e.arcTo(i,r,i+n,r,n),e.lineTo(i+s-n,r),e.arcTo(i+s,r,i+s,r+n,n),e.lineTo(i+s,r+o-n),e.arcTo(i+s,r+o,i+s-n,r+o,n),e.lineTo(i+n,r+o),e.arcTo(i,r+o,i,r+o-n,n),e.closePath()):e.rect(i,r,s,o)}_renderHalo(e,i,r,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=XZ(Ide,Math.max(o,pD),Math.max(a,pD)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let p=s;for(let g=0;g<this._lines.length;++g){const y=this._getLineXOffset(g);this._renderLineDecoration(c,n+y,p,this._textWidths[g],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of NAe)this._fillText(e,s,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const n=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(p*n),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,n){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_strokeText(e,i,r,n){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const n=this._toRenderUnit(i[0]),s=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,h=Math.floor(s)+.5,p=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,h),e.stroke()}};const NAe=[];for(let e=0;e<360;e+=360/16)NAe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var gv;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(gv||(gv={}));const Ide={canvas:null},Tdt=.2,pD=512,Pde="rgb(255, 0, 255, 0.5)";let Edt=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,n,s){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=n,this.displayWidth=s}};const p3=()=>de.getLogger("esri.views.3d.layers.graphics.labelPlacement");let Cdt=class{constructor(e,i,r,n=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=n}};function Lde(t){const e=Ndt(t);if(e==null)return null;const i=Mdt(t,e);if(i==null)return null;const r=i.anchor,n=!!e.hasLabelVerticalOffset,s=e.verticalOffset;return Odt(new gdt(s,r,n),i,t)}function Mdt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=Fp[i],n=r||Ck(t);return i&&!r&&p3().warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),$dt(n,t)}function cV(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=$te(e);return i!=null?i.symbol.symbolLayers.at(0):null}function $dt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(p3().warnOncePerTick(Dde(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),Ck(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return p3().warnOncePerTick(Dde(t==null?void 0:t.placement,`'${r}' geometries`)),Ck(e);break;case"point":case"mesh":return t}return t}function Dde(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function Ck(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:ws,anchor:"center"};case"polygon":{const i=cV(t);return i!=null&&i.type==="extrude"?Fp["above-center"]:{placement:"center-center",normalizedOffset:ws,anchor:"center"}}case"point":case"mesh":return Fp["above-center"];default:return}}function Odt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":Rdt(t,e,i);break;case"mesh":Idt(t,e,i);break;case"polygon":Adt(t,e,i)}const n=_dt-Ek;return t.screenOffset[0]+=n*e.normalizedOffset[0],t.screenOffset[1]+=n*e.normalizedOffset[1],t}function Adt(t,e,i){const r=cV(i);if(r!=null)switch(r.type){case"extrude":{const n=i.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(aR),vz(aR,t.translation),t.translation[2]=Qv(aR)/2):ve(t.translation,0,0,0),Ote(t,e,n);break}}}function Rdt(t,e,i){const r=cV(i);if(r==null)return;const n=i.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):ve(t.translation,0,0,0),r.type){case"icon":case"text":Pdt(t,e,i,n);break;case"object":Ote(t,e,n)}}function Idt(t,e,i){const r=cV(i);if(r==null)return;const n=i.graphics3DGraphic.layers[0];r.type==="fill"&&Ote(t,e,n)}function Pdt(t,e,i,r){const{graphics3DGraphic:n}=i,s=r!=null?r.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Fp[i.labelClass.labelPlacement]&&p3().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=Ldt(i);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-o[0]);const a=s[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function Ldt(t,e=Fdt){const{graphics3DGraphic:i}=t,r=i.layers[0],n=(r==null?void 0:r.stageObject.geometries[0].material)??null;if(n&&n instanceof Xz){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function Ote(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(aR):aR,n=Qe(r[3]-r[0],r[4]-r[1],r[5]-r[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Fe(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function Ddt(t){return t==="above-center"}function Ndt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,n=$te(r.graphics3DSymbol),s=(n==null?void 0:n.symbol.type)==="point-3d"?n.symbol:null,o=Fp[e]||Ck(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:s.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&Ddt(o.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(p3().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}const Fp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Nde={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Nde){const e=Nde[t],i=Fp[t];e.forEach(r=>{Fp[r]=i})}Object.freeze&&(Object.freeze(Fp),Object.keys(Fp).forEach(t=>{var e;Object.freeze(Fp[t]),Object.freeze((e=Fp[t])==null?void 0:e.normalizedOffset)}));const Fdt=[0,0],aR=bd(),Ozt=Object.freeze({left:0,center:.5,right:1}),kdt=Object.freeze({"bottom-left":ks(0,0),bottom:ks(.5,0),"bottom-right":ks(1,0),left:ks(0,.5),center:ks(.5,.5),right:ks(1,.5),"top-left":ks(0,1),top:ks(.5,1),"top-right":ks(1,1)});function Udt(t){switch(t){case"left":return gv.Left;case"right":return gv.Right;default:return gv.Center}}function Fde(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function zdt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Azt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Rzt(t){return t==="middle"?"center":t}function Izt(t,e){switch(t){case"top":return ln(e,0,Ek);case"bottom":return ln(e,0,-Ek);default:return Ha(e,Jb)}}let Ate=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){const n=this._material.produces.get(i);if(!(n!=null&&n(r)))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const s=this._map.get(r);if(s!=null){if(s.ensureResources(e)===Nv.LOADED)return s;this._repository.requestRender()}return null}},Rte=class extends UOe{constructor(e=A()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}};var On,Po;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(On||(On={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Po||(Po={}));let Ite=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function kde(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const n=t.data[r],s=e.get(n.to);if(!s)return;n.to=s.to,e.delete(s.from),t.removeUnordered(s),i=!0}}}let Ude=class extends Ite{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}foreachHighlightGroup(e){this.isVisible&&this.geometry.foreachHighlightGroup(e)}get hasOccludees(){return this.geometry.occludees!=null}},Vdt=class{constructor(){this.first=0,this.count=0}},Bdt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new mi({allocator:e=>e||new Ite,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightGroups=new Set,this.drawCommandsDefault=fD(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=fD(),this.drawCommandsShadowHighlightRest=fD()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightGroups.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightGroups.clear()}updateIfDrawCommandsDirty(e){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const i of this.instances.values())this.updateDrawState(i);this.updateDrawCommands(e)}}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=i,n.to=r,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.foreachHighlightGroup(i=>this.highlightGroups.add(i)),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const n=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(n.first=0,void(n.count=s.from)):(n.first=1/0,n.count=0,this._instances.forEach(o=>{n.first=Math.min(n.first,o.from),n.count=Math.max(n.count,o.to)}),void(n.count-=n.first))}const i=Array.from(this._instances.values()).sort((n,s)=>n.from===s.from?n.to-s.to:n.from-s.from),{drawCommandsHighlights:r}=this;for(const n of i)n.isVisible&&(VG(n.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,n),n.hasHighlights?n.foreachHighlightGroup(s=>{let o=r.get(s);o||(o=fD(),r.set(s,o)),VG(o,n)}):VG(this.drawCommandsShadowHighlightRest,n))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function jdt(t){return t.vao!=null}function fD(){return new mi({allocator:t=>t||new Vdt,deallocator:t=>t})}function VG(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(Gdt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function Gdt(t,e){return t.first+t.count>=e.from}let Hdt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}},lR=class extends nM{get _hasAnyHighlight(){return this._highlightGroups.size>0}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new Rte,this._highlightGroups=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=Ht(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==J.Highlight&&r!==J.ShadowHighlight||this._hasAnyHighlight))&&e(r))})}initializeRenderContext(e,i){this._glMaterials=new Ate(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,Sd(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(({geometry:n})=>e(n))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i==null)return;const r=i.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,o=this._dataByOrigin.get(s.localOrigin.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)return;const l=a.instances.get(s.id);if(n.updateType&(Po.GEOMETRY|Po.TRANSFORMATION)){const c=yD(i.elementCount(l.geometry.geometry.attributes)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,h,0),a.vao.vertexBuffers.get("geometry").setSubData(c,l.from*r,0,l.numElements*r)}n.updateType&(Po.HIGHLIGHT|Po.OCCLUDEE|Po.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new Oy;for(const n of e){const s=n.localOrigin;if(s==null)continue;let o=r.get(s.id,null);o==null&&(o=new zde(s.vec3),r.set(s.id,null,o)),o.changes.push(n)}for(const n of i){const s=n.localOrigin;if(s==null)continue;const o=this._dataByOrigin.get(s.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)continue;let l=r.get(s.id,a);l==null&&(l=new zde(s.vec3),r.set(s.id,a,l)),l.changes.push(n)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter==null||this._vaoCache==null)return;const{_bufferWriter:r,_dataByOrigin:n}=this,s=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),h=(c==null?void 0:c.changes)??[];o.delete(l,null);let p=n.get(l);if(a.forEach((g,y)=>{if(o.delete(l,y),y==null)return void St(!1,"No VAO for removed geometries");if(y.instances.size===g.changes.length)return this._vaoCache.deleteVao(y.vao),wR(p.buffers,y),void(p.buffers.length===0&&h.length===0&&n.delete(l));const w=y.numElements,b=y.vao.byteSize/4,x=h.reduce((R,I)=>R+r.elementCount(I.geometry.attributes),0),T=g.changes.reduce((R,I)=>R+r.elementCount(I.geometry.attributes),0),M=Math.min((w+x-T)*s,gD),$=M>b;M>Mk&&M<b/2?(g.changes.forEach(({id:R})=>y.deleteInstance(R)),y.instances.forEach(({geometry:R})=>h.push(R)),this._vaoCache.deleteVao(y.vao),wR(p.buffers,y)):$?this._applyAndRebuild(y,h,g):this._applyRemoves(y,g)}),h.length>0)for(p==null&&(p=new Hdt(c.origin),n.set(l,p)),p.buffers.forEach(g=>this._applyAdds(g,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new Bdt,h,null))})}_updateDrawCommands(){this._highlightGroups.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.updateIfDrawCommandsDirty(this._bufferWriter.vertexBufferLayout.stride),i.hasHighlights&&xR(this._highlightGroups,i.highlightGroups),this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r)for(const w of r.changes)e.deleteInstance(w.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(gD/o);let l=e.numElements;for(;i.length>0;){const w=i.pop(),b=n.elementCount(w.geometry.attributes);if(l+b>a&&l>0){i.push(w);break}l+=b;const x=new Ude(w,0,0);St(e.instances.get(w.id)==null),e.addInstance(w.id,x)}const c=l*o,h=yD(c),p=n.vertexBufferLayout.createView(h.buffer);let g=0;e.resetInstanceSummary(),e.instances.forEach((w,b)=>{this._writeGeometry(w.geometry,p,g);const x=g;g+=n.elementCount(w.geometry.geometry.attributes),e.updateInstance(b,x,g),e.updateDrawState(w)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(JZ(c)),e.vao.vertexBuffers.get("geometry").setSubData(h,0,0,g*o),e.holes.clear();const y=e.holes.pushNew();return y.from=g,y.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter==null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=wf.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=wf.pushNew();p.from=c.from,p.to=c.to}kde(wf);const r=this._bufferWriter.vertexBufferLayout.stride/4,n=wf.reduce((a,l)=>Math.max(a,l.numElements),0)*r,s=yD(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.get("geometry");wf.forAll(a=>o.setSubData(s,a.from*r,0,a.numElements*r)),e.holes.pushArray(wf.data,wf.length),wf.forAll((a,l)=>wf.data[l]=null),wf.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter==null)return;if(!jdt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,s=e.numElements,o=i.reduce((T,M)=>T+r.elementCount(M.geometry.attributes),0),a=Math.min((s+o)*n,gD),l=4*a;if(e.vao.byteSize<JZ(gD-Mk)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);kde(e.holes);const c=new Array;for(const T of i){const M=r.elementCount(T.geometry.attributes),$=qdt(e.holes,M);c.push($)}const h=e.vao.vertexBuffers.get("geometry");let p=0,g=0,y=0;const w=yD(a),b=r.vertexBufferLayout.createView(w.buffer);i.forEach((T,M)=>{const $=c[M];if($==null)return;if(y!==$){const P=y-g;P>0&&h.setSubData(w,g*n,0,P*n),g=$,p=0}const R=r.elementCount(T.geometry.attributes);this._writeGeometry(T,b,p),p+=R,y=$+R;const I=new Ude(T,$,$+R);St(e.instances.get(T.id)==null),e.addInstance(T.id,I),e.drawCommandsDirty=!0});const x=y-g;x>0&&h.setSubData(w,g*n,0,x*n),PNe(i,(T,M)=>c[M]==null)}_writeGeometry(e,i,r){this._bufferWriter!=null&&(ps(NS,e.transformation),NS[12]-=e.localOrigin.vec3[0],NS[13]-=e.localOrigin.vec3[1],NS[14]-=e.localOrigin.vec3[2],Yl(mD,NS),Gc(mD,mD),this._bufferWriter.write(NS,mD,e.geometry.attributes,e.geometry.objectAndLayerIdColor,i,r))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){var y;if(!this.material.shouldRender(e))return null;const{output:i,bind:r}=e,n=this.material.produces.get(r.slot);if(!(n!=null&&n(i)))return null;const{highlightGroupName:s,slot:o}=r,a=i===J.ShadowHighlight,l=i===J.Highlight,c=l||a,h=w=>c&&(this._highlightGroups.size===0||l&&!!s&&!w.has(s));if(h(this._highlightGroups))return null;const p=i===J.ShadowExcludeHighlight,g=!(c||p);for(const{buffers:w}of this._dataByOrigin.values())for(const b of w){if(h(b.highlightGroups))continue;const x=a?b.drawCommandsHighlights.size>0:c?s?b.drawCommandsHighlights.get(s):b.drawCommandsHighlights.size>0:((y=(p&&b.needsMultipleCommands()?b.drawCommandsShadowHighlightRest:b.drawCommandsDefault)||null)==null?void 0:y.length)??!1,T=g&&b.drawCommandsOccludees||null;if(x||T!=null&&T.length){const M=this._glMaterials.load(e.rctx,o,i),$=M==null?void 0:M.beginSlot(r);if($)return $}}return null}render(e,i){const{output:r,bind:n}=e,{slot:s,highlightGroupName:o}=n,a=r===J.Highlight;if(a&&!o)return;const l=r===J.ShadowHighlight,c=a||l,h=r===J.ShadowExcludeHighlight,p=!(c||h),g=s===Ie.OCCLUDER_MATERIAL||s===Ie.TRANSPARENT_OCCLUDER_MATERIAL?s:null,{rctx:y}=e;y.runAppleAmdDriverHelper();const w=y.bindTechnique(i,n,this.material.parameters);for(const b of this._dataByOrigin.values())for(const x of b.buffers){if(a&&(!x.hasHighlights||!x.drawCommandsHighlights.has(o))||l&&!x.hasHighlights)continue;const T=()=>{const P=[];for(const N of x.drawCommandsHighlights.values())P.push(N);return P},M=c&&!l?x.drawCommandsHighlights.get(o)??null:null,$=l?T():c?M?[M]:Bde:(h&&x.needsMultipleCommands()?[x.drawCommandsShadowHighlightRest]:[x.drawCommandsDefault])||Bde,R=$.some(P=>P.length>0),I=p&&x.drawCommandsOccludees||null;if(R||I!=null&&I.length){if(this._drawParameters.origin=b.origin,w.bindDraw(n,this.material.parameters,this._drawParameters),i.ensureAttributeLocations(x.vao),y.bindVAO(x.vao),R)for(const P of $)y.setPipelineState(i.getPipeline(!1,g)),P.forAll(N=>y.drawArrays(i.primitiveType,N.first,N.count));I!=null&&I.length&&(y.setPipelineState(i.getPipeline(!0,g)),I.forAll(P=>y.drawArrays(i.primitiveType,P.first,P.count)))}}}get test(){}};u([f({constructOnly:!0})],lR.prototype,"material",void 0),lR=u([L("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],lR);let zde=class{constructor(e){this.origin=e,this.changes=new Array}};function qdt(t,e){const i=t.find(n=>n.numElements>=e);if(i==null)return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const NS=ut(),mD=ut(),wf=new mi({allocator:t=>t||new Ite,deallocator:null}),Mk=65536,BG=4*Mk,Vde=1024,FAe=16777216,gD=FAe/4;let jG=new Float32Array(Mk);function yD(t){return jG.length<t&&(jG=new Float32Array(t)),jG}function JZ(t){const e=4*t;return e<=Vde?Vde:e<BG?FUe(e):Math.max(Math.min(Math.ceil(1.5*e/BG)*BG,FAe),e)}const Bde=[];let GF=class extends nM{constructor(e){super(e),this._hasHighlights=!1,this._glMaterials=null,this._produces=new Map,this._renderGeometries=new Map,this._vaoCache=null,this._drawParameters=new Rte,this._bufferWriter=null}get produces(){return this._produces}initialize(){this._bufferWriter=this.material.createBufferWriter(),this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!!(r!==J.Highlight&&r!==J.ShadowHighlight||this._hasHighlights)&&e(r))})}destroy(){this._glMaterials.dispose();const e=this._renderGeometries.keys();for(const i of e)this.removeRenderGeometry(i)}acquireTechniques(e){const i=this.material;if(!i.shouldRender(e))return null;const{output:r,bind:n}=e,s=i.produces.get(n.slot);if(!(s!=null&&s(r))||(r===J.Highlight||r===J.ShadowHighlight)&&!this._hasHighlights)return null;const o=this._glMaterials.load(e.rctx,n.slot,r);return o==null?void 0:o.beginSlot(n)}render(e,i){const r=this._renderGeometries;if(r.size===0)return;const{bind:n}=e,s=n.slot===Ie.OCCLUDER_MATERIAL||n.slot===Ie.TRANSPARENT_OCCLUDER_MATERIAL?n.slot:null,o=e.rctx;o.runAppleAmdDriverHelper(),o.bindTechnique(i,n,this.material.parameters);const a=i.program;for(const[l,c]of r)this._drawParameters.origin=c.localOrigin,a.bindDraw(n,this.material.parameters,this._drawParameters),i.ensureAttributeLocations(c.vao),o.bindVAO(c.vao),o.setPipelineState(i.getPipeline(!1,s)),o.drawArrays(i.primitiveType,0,c.numElements)}initializeRenderContext(e,i){this._glMaterials=new Ate(this.material,e.materials);const r=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,Sd(this._bufferWriter.vertexBufferLayout));this._vaoCache=r}uninitializeRenderContext(){}addRenderGeometry(e,i,r){this.removeRenderGeometry(e);const n=this._bufferWriter.vertexBufferLayout.stride,s=this._vaoCache.newVao(JZ(i.data.byteLength));s.vertexBuffers.get("geometry").setSubData(new Uint8Array(i.data),0,0,i.elementCount*n);const o={localOrigin:r,vao:s,numElements:i.elementCount};return this._renderGeometries.set(e,o),o}removeRenderGeometry(e){const i=this._renderGeometries.get(e);i!=null&&(this._vaoCache.deleteVao(i.vao),this._renderGeometries.delete(e))}};u([f({constructOnly:!0})],GF.prototype,"material",void 0),GF=u([L("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],GF);let $k=class QZ{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ho,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),ho.clearPool(),KZ[0]=null,Ow.prune(),Aw.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=ho.acquire();for(let n=0;n<i;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(r.init(this._root),this._add(s,r))}ho.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=ho.acquire();for(const n of e){const s=i??Kb(this.objectToBoundingSphere(n),tpt);eA(s[3])?(r.init(this._root),Wdt(n,s,r)):this._degenerateObjects.delete(n)}ho.release(r),this._shrink()}update(e,i){if(!eA(i[3])&&this._isDegenerate(e))return;const r=ept(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const n=rf(e,i);I1(this._root,s=>{if(!Ydt(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,n){const s=rf(e,i);I1(this._root,o=>{if(!Xdt(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),!0})}forEach(e){I1(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=GG(e,i),h=p=>{if(--s,!n(p))return;const g=this.objectToBoundingSphere(p);if(!J_(r,g))return;const y=D_(e,i,g),w=y-g[3],b=y+g[3];w<o&&(o=w,a=b,l=p)};return jde(this._root,p=>{if(s<=0||!J_(r,p.bounds)||(ue(hh,c,p.halfSize),xe(hh,hh,p.bounds),D_(e,i,hh)>a))return!1;const g=p.node;return g.terminals.forAll(y=>h(y)),g.residents!==null&&g.residents.forAll(y=>h(y)),!0},e,i),l}forEachInDepthRange(e,i,r,n,s,o,a){let l=-1/0,c=1/0;const h={setRange:b=>{r===QZ.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,b.near),c=Math.min(c,b.far)):(l=Math.max(l,-b.far),c=Math.min(c,-b.near))}};h.setRange(n);const p=D_(i,r,e),g=GG(i,r),y=GG(i,-r),w=b=>{if(!a(b))return;const x=this.objectToBoundingSphere(b),T=x,M=D_(i,r,T)-p,$=M-x[3],R=M+x[3];$>c||R<l||!J_(o,x)||s(b,h)};jde(this._root,b=>{if(!J_(o,b.bounds)||(ue(hh,g,b.halfSize),xe(hh,hh,b.bounds),D_(i,r,hh)-p>c)||(ue(hh,y,b.halfSize),xe(hh,hh,b.bounds),D_(i,r,hh)-p<l))return!1;const x=b.node;return x.terminals.forAll(T=>w(T)),x.residents!==null&&x.residents.forAll(T=>w(T)),!0},i,r)}forEachNode(e){I1(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=uy(i),n=i,s=l=>{const c=this.objectToBoundingSphere(l),h=uy(c),p=r+h;return!(to(c,n)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};I1(this._root,l=>{const c=uy(l.bounds),h=r+c;if(to(l.bounds,n)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||M7(r,e)}_intersectsObjectWithOffset(e,i,r){const n=this.objectToBoundingSphere(i);return!(n[3]>0)||M7(r.applyToBoundingSphere(n),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const n=ho.acquire().init(e);this._add(i.at(r),n),ho.release(n)}}_grow(e,i){if(i!==0&&(Gde(e,i,r=>this.objectToBoundingSphere(r),eg),eA(eg[3])&&!this._fitsInsideTree(eg)))if(kAe(this._root.node))Kb(eg,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(eg);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(eg,r):this._growRootAsSubNode(r),ho.release(r)}}_rebuildTree(e,i){ye(qG,i.bounds),qG[3]=i.halfSize,Gde([e,qG],2,n=>n,WG);const r=ho.acquire().init(this._root);this._root.initFrom(null,WG,WG[3]),this._root.increaseHalfSize(1.25),I1(r,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),ho.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return I1(this._root,n=>(r=Math.max(r,n.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(r[l]-i),h=r[l]+i-(s[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),g=Math.max(0,Math.ceil(h/(2*o)))+1,y=2**Math.ceil(Math.log(p+g)*Math.LOG2E);n=Math.max(n,y),_D[l].min=p,_D[l].max=g}for(let l=0;l<3;l++){let c=_D[l].min,h=_D[l].max;const p=(n-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const g=s[l]-o-c*o*2;HG[l]=g+(h+c)*o}const a=n*o;return HG[3]=a*zAe,ho.acquire().initFrom(null,HG,a,0)}_growRootAsSubNode(e){const i=this._root.node;ye(eg,this._root.bounds),eg[3]=this._root.halfSize,this._root.init(e),e.advanceTo(eg,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,n=0;for(;n<i.length&&e==null;)r=n++,e=i[r];for(;n<i.length;)if(i[n++])return-1;return r}_isDegenerate(e){return!eA(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){var s,o;const i=e.children.map(a=>a?this._nodeToJSON(a):null),r=(s=e.residents)==null?void 0:s.map(a=>this.objectToBoundingSphere(a)),n=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:i,residents:r,terminals:n}}static fromJSON(e){const i=new QZ(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},ho=class UT{constructor(){this.bounds=Pn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,n=this.depth){return this.node=e??UT.createEmptyNode(),i&&Kb(i,this.bounds),this.halfSize=r,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*zAe}advance(e){let i=this.node.children[e];i||(i=UT.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=UAe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);i&&i(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new mi({shrink:!0}),residents:new mi({shrink:!0})}}static acquire(){return UT._pool.acquire()}static release(e){UT._pool.release(e)}static clearPool(){UT._pool.prune()}};function I1(t,e){let i=ho.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&r.push(ho.acquire().init(i).advance(n));ho.release(i)}}function jde(t,e,i,r=$k.DepthOrder.FRONT_TO_BACK){let n=ho.acquire().init(t);const s=[n];for(Kdt(i,r,qde);s.length!==0;){if(n=s.pop(),e(n)&&!n.isLeaf())for(let o=7;o>=0;--o){const a=qde[o];n.node.children[a]&&s.push(ho.acquire().init(n).advance(a))}ho.release(n)}}function Wdt(t,e,i){Ow.clear();const r=i.advanceTo(e,(n,s)=>{Ow.push(n.node),Ow.push(s)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let n=Ow.length-2;n>=0&&Zdt(Ow.data[n],Ow.data[n+1]);n-=2);}function Zdt(t,e){return e>=0&&(t.children[e]=null),!!kAe(t)&&(t.residents===null&&(t.residents=new mi({shrink:!0})),!0)}function Ydt(t,e){return Ok(e.bounds,2*-e.halfSize,Cu),Ok(e.bounds,2*e.halfSize,Mu),HEe(t.origin,t.direction,Cu,Mu)}function Xdt(t,e,i){return Ok(e.bounds,2*-e.halfSize,Cu),Ok(e.bounds,2*e.halfSize,Mu),i.applyToMinMax(Cu,Mu),HEe(t.origin,t.direction,Cu,Mu)}function kAe(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function Jdt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Qdt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function Ok(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Gde(t,e,i,r){if(e===1){const n=i(t[0]);Kb(n,r)}else{Cu[0]=1/0,Cu[1]=1/0,Cu[2]=1/0,Mu[0]=-1/0,Mu[1]=-1/0,Mu[2]=-1/0;for(let n=0;n<e;n++){const s=i(t[n]);eA(s[3])&&(Jdt(Cu,s),Qdt(Mu,s))}br(r,Cu,Mu,.5),r[3]=Math.max(Mu[0]-Cu[0],Mu[1]-Cu[1],Mu[2]-Cu[2])/2}}function Kdt(t,e,i){if(!Aw.length)for(let r=0;r<8;++r)Aw.push({index:0,distance:0});for(let r=0;r<8;++r){const n=UAe[r];Aw.data[r].index=r,Aw.data[r].distance=D_(t,e,n)}Aw.sort((r,n)=>r.distance-n.distance);for(let r=0;r<8;++r)i[r]=Aw.data[r].index}function GG(t,e){let i,r=1/0;for(let n=0;n<8;++n){const s=D_(t,e,Hde[n]);s<r&&(r=s,i=Hde[n])}return i}function D_(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function eA(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}ho._pool=new xl(ho),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}($k||($k={}));const UAe=[Qe(-1,-1,-1),Qe(1,-1,-1),Qe(-1,1,-1),Qe(1,1,-1),Qe(-1,-1,1),Qe(1,-1,1),Qe(-1,1,1),Qe(1,1,1)],Hde=[Qe(-1,-1,-1),Qe(-1,-1,1),Qe(-1,1,-1),Qe(-1,1,1),Qe(1,-1,-1),Qe(1,-1,1),Qe(1,1,-1),Qe(1,1,1)],zAe=Math.sqrt(3),KZ=[null];function ept(t){return KZ[0]=t,KZ}const HG=Pn(),hh=A(),Cu=A(),Mu=A(),Ow=new mi,tpt=Pn(),eg=Pn(),qG=Pn(),WG=Pn(),_D=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Aw=new mi,qde=[0,0,0,0,0,0,0,0],kp=$k;let ipt=class{constructor(e,i,r){this._elementSize=i,this._buffer=bs.createVertex(e,Vn.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,i,r,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,n=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,n)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},rpt=class{constructor(e){this.modelOriginHi=e.getField(k.INSTANCEMODELORIGINHI,Fv),this.modelOriginLo=e.getField(k.INSTANCEMODELORIGINLO,Fv),this.model=e.getField(k.INSTANCEMODEL,ox),this.modelNormal=e.getField(k.INSTANCEMODELNORMAL,ox),this.featureAttribute=e.getField(k.INSTANCEFEATUREATTRIBUTE,sx),this.color=e.getField(k.INSTANCECOLOR,Wc),this.objectAndLayerIdColor=e.getField(k.INSTANCEOBJECTANDLAYERIDCOLOR,Wc)}},npt=class{constructor(e,i){this._rctx=e,this._instanceBufferLayout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var e;return((e=this._buffer)==null?void 0:e.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){St(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){St(this._updating,"not updating"),this.size<ONe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){St(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),St(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){St(this._updating,"not updating"),St(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(Ak,Math.floor(this._capacity*Qk));this._resize(e)}_shrink(){const e=Math.max(Ak,Math.floor(this._capacity*$Ne));this._resize(e)}_resize(e){if(St(this._updating,"not updating"),e===this._capacity)return;const i=new ipt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,n=this._compactInstances(i);St(n===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new rpt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const Ak=64;var rn;function spt(t){let e=Zc().mat4f64(k.LOCALTRANSFORM).mat4f64(k.GLOBALTRANSFORM).vec4f64(k.BOUNDINGSPHERE).vec3f64(k.MODELORIGIN).mat3f(k.INSTANCEMODEL).mat3f(k.INSTANCEMODELNORMAL).vec2f(k.MODELSCALEFACTORS);return t.includes(k.FEATUREATTRIBUTE)&&(e=e.vec4f(k.FEATUREATTRIBUTE)),t.includes(k.COLOR)&&(e=e.vec4u8(k.COLOR)),t.includes(k.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(k.OBJECTANDLAYERIDCOLOR)),e=e.u8(k.STATE).u8(k.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(rn||(rn={}));let Wde=class{constructor(e){this.localTransform=e.getField(k.LOCALTRANSFORM,QR),this.globalTransform=e.getField(k.GLOBALTRANSFORM,QR),this.modelOrigin=e.getField(k.MODELORIGIN,Az),this.model=e.getField(k.INSTANCEMODEL,ox),this.modelNormal=e.getField(k.INSTANCEMODELNORMAL,ox),this.modelScaleFactors=e.getField(k.MODELSCALEFACTORS,iI),this.boundingSphere=e.getField(k.BOUNDINGSPHERE,Rz),this.featureAttribute=e.getField(k.FEATUREATTRIBUTE,sx),this.color=e.getField(k.COLOR,Wc),this.objectAndLayerIdColor=e.getField(k.OBJECTANDLAYERIDCOLOR,Wc),this.state=e.getField(k.STATE,KR),this.lodLevel=e.getField(k.LODLEVEL,KR)}},zT=class extends Ne{constructor(e,i){super(e),this.events=new ns,this._capacity=0,this._size=0,this._next=0,this._highlightGroupMap=new Map,this._highlightGroupMapPrev=new Map,this._layout=spt(i),this._capacity=Ak,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Wde(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,rn.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;St(e>=0&&e<this._capacity&&!!(i.get(e)&rn.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,rn.ACTIVE)?this._setStateFlags(e,rn.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;St(e>=0&&e<this._capacity&&!!(i.get(e)&rn.ALLOCATED),"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=dc,n=Bd;i.localTransform.getMat(e,Zde),i.globalTransform.getMat(e,ZG);const s=fs(ZG,ZG,Zde);ve(r,s[12],s[13],s[14]),i.modelOrigin.setVec(e,r),qv(n,s),i.model.setMat(e,n);const o=CHe(dc,s);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),YC(n,n),wx(n,n),i.modelNormal.setMat(e,n),this._setStateFlags(e,rn.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,Bd),r.modelOrigin.getVec(e,dc),i[0]=Bd[0],i[1]=Bd[1],i[2]=Bd[2],i[3]=0,i[4]=Bd[3],i[5]=Bd[4],i[6]=Bd[5],i[7]=0,i[8]=Bd[6],i[9]=Bd[7],i[10]=Bd[8],i[11]=0,i[12]=dc[0],i[13]=dc[1],i[14]=dc[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(dc,this,e),i*=Math.max(dc[0],dc[1],dc[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(dc,this,e),i*=opt(dc[0],dc[1],dc[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,rn.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,rn.VISIBLE)}setHighlight(e,i,r){let n=this._highlightGroupMap.get(e);i?(n||(n=new Set,this._highlightGroupMap.set(e,n)),n.add(r)&&(this._setStateFlag(e,rn.HIGHLIGHT,!0),this.events.emit("instance-highlight-changed"))):n!=null&&n.delete(r)&&(n.size===0&&(this._highlightGroupMap.delete(e),this._setStateFlag(e,rn.HIGHLIGHT,!1)),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,rn.HIGHLIGHT)}foreachHighlightGroupPrev(e,i){var r;(r=this._highlightGroupMapPrev.get(e))==null||r.forEach(i),this._highlightGroupMapPrev.delete(e)}foreachHighlightGroup(e,i){const r=this._highlightGroupMap.get(e);r==null||r.forEach(i),r?this._highlightGroupMapPrev.set(e,new Set(r)):this._highlightGroupMapPrev.delete(e)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(Ak,Math.floor(this._capacity*Qk)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Wde(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&rn.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function opt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}u([f({constructOnly:!0})],zT.prototype,"shaderTransformation",void 0),u([f()],zT.prototype,"_size",void 0),u([f({readOnly:!0})],zT.prototype,"size",null),zT=u([L("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],zT);const dc=A(),Bd=In(),Zde=ut(),ZG=ut();let apt=class extends kp{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=Pn(),this._tmpMat4=ut()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Mt(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*eC(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},lpt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const n=r.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*i/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},cpt=class extends Y3{constructor(e,i,r,n,s,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function Pte(t){return wd(t)&&t.intersector===on.LOD&&!!t.target}function upt(t,e,i,r=null){const n=t.createBufferWriter(),s=n.vertexBufferLayout,o=n.elementCount(e),a=s.createBuffer(o);return n.write(null,null,e,r,a,0),{material:t,vertexBufferLayout:s,buffer:a.buffer,elementCount:o,boundingInfo:i}}let hpt=class{constructor(e,i){const r=e.renderContext.rctx,n=i.geometry;let s=null;s=n instanceof Cm?upt(n.material,n.attributes,n.boundingInfo):n;const o=s.material;this._materials=e.materials,o.setParameters({instancedDoublePrecision:!0}),this.geometry=n,this.material=o,this.glMaterials=new Ate(o,this._materials),this.vertexBufferLayout=s.vertexBufferLayout,this.vbo=bs.createVertex(r,Vn.STATIC_DRAW,s.buffer),this.vao=new km(r,md,new Map([["geometry",Sd(s.vertexBufferLayout)]]),new Map([["geometry",this.vbo]])),this.vertexCount=s.elementCount}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,n,s,o,a,l){if(!(this.geometry instanceof Cm))return;const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,n,(h,p,g,y,w)=>{if(h>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,h))return;const b=new cpt(o.layerUid,o.graphicUid(s),c,g,a,l);if((e.results.min.drapedLayerOrder==null||w>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(on.LOD,b,h,p,e.transform.transform,w),e.options.store!==Go.MIN&&(e.results.max.drapedLayerOrder==null||w>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(on.LOD,b,h,p,e.transform.transform,w),e.options.store===Go.ALL){const x=pK(e.results.min.ray);x.set(on.LOD,b,h,p,e.transform.transform,w),e.results.all.push(x)}}})}},dpt=class VAe{static async create(e,i,r){const n=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new hpt(e,o),r))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(Bv);if(zo(r)||s.length!==n.length){s.forEach(o=>o.destroy()),zt(r);for(const o of n)if(o.status==="rejected")throw o.reason}return new VAe(i.minScreenSpaceRadius,s)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,n,s,o,a){this.components.forEach(l=>l.intersect(e,i,r,n,s,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=fd();this.components.forEach(i=>{i.boundingInfo!=null&&(ix(e,i.boundingInfo.bbMin),ix(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=A();vz(e,i),this._boundingSphere={center:i,radius:.5*eEe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const ppt=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new lpt(e,i)};let Sh=class extends Cet{constructor(e,i){super(e),this.type=on.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=new Array,this._highlightRenderInstanceDataMap=new Map,this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Jr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[Ie.OPAQUE_MATERIAL,r=>this._produces(r)],[Ie.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new zT({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(xt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=mpt(this.optionalFields),this._glInstanceBufferLayout=Sd(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _allRenderInstanceData(){const e=[this._defaultRenderInstanceData];for(const i of this._highlightRenderInstanceDataMap)e.push(i[1]);return e}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get hasEmissions(){return this.baseMaterial.hasEmissions}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,n)=>r+n.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,o=r.triangleCount;i.push({renderedInstances:s,renderedTriangles:s*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,n)=>r+n.renderedInstances,0),renderedTriangles:i.reduce((r,n)=>r+n.renderedTriangles,0),levels:i}}_createRenderInstanceDataArray(e=[]){const{rctx:i}=this._context.renderContext;return this.symbol.levels.map(r=>{e.push(new npt(i,this._instanceBufferLayout))}),e}async initializeRenderContext(e,i){this._context=e,this._createRenderInstanceDataArray(this._defaultRenderInstanceData);const r=await Promise.allSettled(this.symbol.levels.map(s=>dpt.create(e,s,i))),n=r.map(s=>s.status==="fulfilled"?s.value:null).filter(Bv);if(zo(i)||n.length!==r.length){n.forEach(s=>s.destroy()),zt(i);for(const s of r)if(s.status==="rejected")throw s.reason}this._levels=n,this._levelSelector=ppt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceDataMap.forEach(e=>e.forEach(i=>i.destroy()))}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>{const r=i.material.produces.get(Ie.TRANSPARENT_MATERIAL);return r==null?void 0:r(J.Color)}))}hasHighlights(){return ny(this._highlightRenderInstanceDataMap,e=>e.some(i=>i.size>0))}_produces(e){return e!==J.Highlight&&e!==J.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!Cn.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bind.contentCamera.equals(this._camera);this._camera.copyFrom(e.bind.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(kc),this._needFullCycle=!1)}}acquireTechniques(e){if(!this.baseMaterial.visible||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e);if(!i)return null;const r=new Array,n=this.levels;return i.forEach(s=>n.forEach(({components:o},a)=>o.forEach(l=>r.push(this._beginComponent(e,s[a],l))))),r}render(e,i){const r=this._getInstanceDatas(e);if(!r||i==null)return;let n=0;e.rctx.bindVAO();const s=this.levels;r.forEach(o=>s.forEach(({components:a},l)=>a.forEach(c=>this._renderComponent(e,i[n++],o[l],c,l))))}_getInstanceDatas(e){const{output:i,bind:r}=e,n=i===J.Highlight,s=!n&&i!==J.ShadowHighlight,o=i!==J.ShadowExcludeHighlight;if(s)return o?this._allRenderInstanceData:[this._defaultRenderInstanceData];if(o){if(n){const{highlightGroupName:l}=r;if(!l)return null;const c=this._highlightRenderInstanceDataMap.get(l);return c?[c]:null}const a=[];for(const l of this._highlightRenderInstanceDataMap)a.push(l[1]);return a}return null}intersect(e,i,r,n){if(!this.baseMaterial.visible||this._octree==null)return;const s=A();Ae(s,n,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,Jde),e.transform.set(Jde),Mt(Qde,r,e.transform.inverse),Mt(Kde,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;St(!!(l&rn.ACTIVE),"invalid instance state"),St(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,i,Qde,Kde,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,s,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const i=this._instanceData,r=(e=i.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new apt(i,this.baseBoundingSphere);for(let n=0;n<i.capacity;++n)r.get(n)&rn.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Ye(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,kp.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(i,kp.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,bf),Ae(bf,bf,s);const a=Te(bf,i)-bf[3];o.boundingSphere.getVec(n,bf),Ae(bf,bf,s);const l=Te(bf,i)+bf[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:n}=this;this._allRenderInstanceData.forEach(p=>p.forEach(g=>g.beginUpdate()));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;const h=Math.ceil(l/500);for(let p=0;p<a&&!e.done;++p){c===this._cycleStartIndex&&this._startUpdateCycle();const g=o.state.get(c);let y=0;if(!(g&rn.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const w=o.lodLevel.get(c);if(g&rn.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[w].freeTail(),g&rn.HIGHLIGHT_ACTIVE&&s.foreachHighlightGroupPrev(c,b=>{const x=this._highlightRenderInstanceDataMap.get(b);if(!x)throw new Y("Internal error in lodRenderer");x[w].freeTail()}),g&rn.REMOVE)s.freeInstance(c);else if(g&rn.VISIBLE){let b=0;i&&(o.modelOrigin.getVec(c,Xde),b=n.selectLevel(Xde,s.getCombinedMedianScaleFactor(c),r)),y=g&~(rn.ACTIVE|rn.TRANSFORM_CHANGED),b>=0&&(g&rn.HIGHLIGHT?(s.foreachHighlightGroup(c,x=>{let T=this._highlightRenderInstanceDataMap.get(x);if(T||(T=this._createRenderInstanceDataArray(),T.forEach(M=>M.beginUpdate()),this._highlightRenderInstanceDataMap.set(x,T)),b>=T.length)throw new Y(`LodRenderer internal error - missing lodLevel ${b}`);Yde(T[b],o,c)}),y|=rn.HIGHLIGHT_ACTIVE):(Yde(this._defaultRenderInstanceData[b],o,c),y|=rn.DEFAULT_ACTIVE)),o.state.set(c,y),o.lodLevel.set(c,b)}else y=g&~(rn.ACTIVE|rn.TRANSFORM_CHANGED),o.state.set(c,y);if(this._octreeCached!=null){const b=!!(g&rn.ACTIVE),x=!!(y&rn.ACTIVE);!b&&x?this._octreeCached.addInstance(c):b&&!x?this._octreeCached.removeInstance(c):b&&x&&g&rn.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%h==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(p=>p.forEach(g=>g.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const n=r.glMaterials.load(e.rctx,e.bind.slot,e.output);return n==null?void 0:n.beginSlot(e.bind)}_renderComponent(e,i,r,n,s){if(!i)return;const{bind:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(i,o,n.material.parameters,gpt);a.bindVAO(n.vao),i.ensureAttributeLocations(n.vao),Cn.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===J.Color&&(l.setUniform4fv("externalColor",epe[Math.min(s,epe.length-1)]),l.setUniform1i("colorMixMode",k$e.replace));const c=r.capacity,h=r.headIndex,p=r.tailIndex,g=r.firstIndex,y=this._glInstanceBufferLayout,w=(b,x)=>{GK(a,md,r.buffer,y,b),a.drawArraysInstanced(i.primitiveType,0,n.vertexCount,x-b),aCe(a,md,r.buffer,y)};n.material.parameters.transparent&&g!=null?h>p?(St(g>=p&&g<=h,"invalid firstIndex"),w(g,h),w(p,g)):h<p&&(g<=h?(St(g>=0&&g<=h,"invalid firstIndex"),w(g,h),w(p,c),w(0,g)):(St(g>=p&&g<=c,"invalid firstIndex"),w(g,c),w(0,h),w(p,g))):h>p?w(p,h):h<p&&(w(0,h),w(p,c)),a.bindVAO(null)}};function Yde(t,e,i){const r=t.allocateHead();fpt(e,i,t.view,r)}function fpt(t,e,i,r){iht(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function mpt(t){let e=Zc().vec3f(k.INSTANCEMODELORIGINHI).vec3f(k.INSTANCEMODELORIGINLO).mat3f(k.INSTANCEMODEL).mat3f(k.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(k.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(k.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(k.INSTANCEOBJECTANDLAYERIDCOLOR)),e}u([f({constructOnly:!0})],Sh.prototype,"symbol",void 0),u([f({constructOnly:!0})],Sh.prototype,"optionalFields",void 0),u([f({constructOnly:!0})],Sh.prototype,"metadata",void 0),u([f({constructOnly:!0})],Sh.prototype,"shaderTransformation",void 0),u([f()],Sh.prototype,"_instanceData",void 0),u([f()],Sh.prototype,"_cycleStartIndex",void 0),u([f({readOnly:!0})],Sh.prototype,"_enableLevelSelection",null),u([f()],Sh.prototype,"_updateCyclesWithStaticCamera",void 0),u([f({readOnly:!0})],Sh.prototype,"running",null),Sh=u([L("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Sh);const Xde=A(),bf=Ti(),Jde=ut(),Qde=A(),Kde=A(),epe=[Ri(1,0,1,1),Ri(0,0,1,1),Ri(0,1,0,1),Ri(1,1,0,1),Ri(1,0,0,1)],gpt=new Dut;let eY=class{constructor(e){this._optionalFields=new Array,this._instanceIndexToFeatureId=new Map,this._featureIdToInstanceIndex=new Map,this._disposeResourceHandles=new Array,this._lodRendererResources=null,this.layerUid=e.layerUid,this.view=e.view,this.sharedResources=this.view.sharedSymbolResources,this.scheduler=this.view.resourceController.scheduler}async doLoad(e,i,r){pe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(k.OBJECTANDLAYERIDCOLOR);const n=ypt(c=>i(c),e),s=this.view._stage,o=rct(n);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o));const a=nct(n);s.addMany(a),this._addDisposeResource(()=>{a.forEach(c=>c.unload()),s.removeMany(a)}),await Promise.all(a.map(c=>this.view._stage.schedule(()=>c.load(s.renderView.renderingContext),r))),zt(r);const l=await this._createLodRenderer(n,r);this._lodRendererResources={lodRenderer:l,materials:o,textures:a}}addInstances(e){const i=this._lodRendererResources;if(i==null)return;const{featureIds:r,localTransforms:n,globalTransforms:s}=e,o=i.lodRenderer;if(o==null)return;const a=o.instanceData,l=r.length;for(let c=0;c<l;++c){const h=r[c],p=a.addInstance(),g=a.view,y=16*c;g.localTransform.copyFromTypedBuffer(p,n,y),g.globalTransform.copyFromTypedBuffer(p,s,y),a.updateModelTransform(p),a.setVisible(p,!0),this._instanceIndexToFeatureId.set(p,h),this._featureIdToInstanceIndex.set(h,p)}}removeInstances(e){const i=this._lodRendererResources;if(i==null)return;const r=i==null?void 0:i.lodRenderer,n=r.instanceData,s=this._instanceIndexToFeatureId,o=this._featureIdToInstanceIndex,a=e.length;for(let l=0;l<a;++l){const c=e[l],h=o.get(c);h!=null&&(n.removeInstance(h),s.delete(h),o.delete(c))}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createLodRenderer(e,i){const r=this.view._stage,n={layerUid:this.layerUid,graphicUid:o=>1,notifyGraphicGeometryChanged:o=>1,notifyGraphicVisibilityChanged:o=>1},s=new Sh({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:null},this.scheduler);return s.slicePlaneEnabled=!1,this._addDisposeResource(()=>{r.removeRenderPlugin(s),s.destroy()}),await r.addRenderPlugin(s,i),s}};function ypt(t,e){const i=e.levels.map(r=>{const n=r.components.map(s=>{const o=t(s.materialId);if(!_pt(o))throw new Error("LodRenderer only supports DefaultMaterial");const a=o.createBufferWriter(),l={material:o,vertexBufferLayout:a.vertexBufferLayout,buffer:s.renderGeometryBuffer.data,elementCount:s.renderGeometryBuffer.elementCount,boundingInfo:s.boundingInfo};return new MOe(l)});return new $Oe(n,r.minScreenSpaceRadius)});return new OOe(i)}function _pt(t){return t!=null&&"materialType"in t&&t.materialType==="default"}eY=u([L("esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer")],eY);async function Py(t,e){const{data:i}=await Br(t,{responseType:"image",...e});return i}function vpt(){return tpe??(tpe=(async()=>{const t=await fe(()=>import("./basis_transcoder-B40h2JNH.js"),[]),e=await t.default({locateFile:i=>vr(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})()),tpe}let tpe;var tb;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(tb||(tb={}));let qp=null,vD=null;async function BAe(){return vD==null&&(vD=vpt(),qp=await vD),vD}function wpt(t,e){if(qp==null)return t.byteLength;const i=new qp.BasisFile(new Uint8Array(t)),r=GAe(i)?jAe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function bpt(t,e){if(qp==null)return t.byteLength;const i=new qp.KTX2File(new Uint8Array(t)),r=HAe(i)?jAe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function jAe(t,e,i,r,n){const s=HK(e?Fn.COMPRESSED_RGBA8_ETC2_EAC:Fn.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*s*o)}function GAe(t){return t.getNumImages()>=1&&!t.isUASTC()}function HAe(t){return t.getFaces()>=1&&t.isETC1S()}async function xpt(t,e,i){qp==null&&(qp=await BAe());const r=new qp.BasisFile(new Uint8Array(i));if(!GAe(r))return null;r.startTranscoding();const n=qAe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(s,o)=>r.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>r.transcodeImage(a,0,s,o,0,0));return r.close(),r.delete(),n}async function Spt(t,e,i){qp==null&&(qp=await BAe());const r=new qp.KTX2File(new Uint8Array(i));if(!HAe(r))return null;r.startTranscoding();const n=qAe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(s,o)=>r.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>r.transcodeImage(a,s,0,0,o,0,-1,-1));return r.close(),r.delete(),n}function qAe(t,e,i,r,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,p]=l?r?[tb.ETC2_RGBA,Fn.COMPRESSED_RGBA8_ETC2_EAC]:[tb.ETC1_RGB,Fn.COMPRESSED_RGB8_ETC2]:c?r?[tb.BC3_RGBA,Fn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[tb.BC1_RGB,Fn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[tb.RGBA32,kt.RGBA],g=e.hasMipmap?i:Math.min(1,i),y=[];for(let w=0;w<g;w++)y.push(new Uint8Array(o(w,h))),a(w,h,y[w]);return e.internalFormat=p,e.hasMipmap=y.length>1,e.samplingMode=e.hasMipmap?Mi.LINEAR_MIPMAP_LINEAR:Mi.LINEAR,e.width=n,e.height=s,new fr(t,e,{type:"compressed",levels:y})}const wD=()=>de.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Tpt=542327876,Ept=131072,Cpt=4;function Lte(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Mpt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const $pt=Lte("DXT1"),Opt=Lte("DXT3"),Apt=Lte("DXT5"),Rpt=31,Ipt=0,Ppt=1,Lpt=2,Dpt=3,Npt=4,Fpt=7,kpt=20,Upt=21;function zpt(t,e,i){const r=Vpt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=r;return e.samplingMode=n.levels.length>1?Mi.LINEAR_MIPMAP_LINEAR:Mi.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=o,e.height=a,new fr(t,e,n)}function Vpt(t,e){const i=new Int32Array(t.buffer,t.byteOffset,Rpt);if(i[Ipt]!==Tpt)return wD().error("Invalid magic number in DDS header"),null;if(!(i[kpt]&Cpt))return wD().error("Unsupported format, must contain a FourCC code"),null;const r=i[Upt];let n,s;switch(r){case $pt:n=8,s=Fn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Opt:n=16,s=Fn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Apt:n=16,s=Fn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return wD().error("Unsupported FourCC code:",Mpt(r)),null}let o=1,a=i[Npt],l=i[Dpt];(3&a||3&l)&&(wD().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,g;i[Lpt]&Ept&&e!==!1&&(o=Math.max(1,i[Fpt]));let y=t.byteOffset+i[Ppt]+4;const w=[];for(let b=0;b<o;++b)g=(a+3>>2)*(l+3>>2)*n,p=new Uint8Array(t.buffer,y,g),w.push(p),y+=g,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:w},internalFormat:s,width:c,height:h}}const Rk=16;function my(t){return Math.ceil(t/Rk)*Rk}function Bpt(t){return Math.floor(t/Rk)*Rk}function jpt(t,e){let s=t.width*t.height;if(s<4096)return t instanceof ImageData?WAe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),s=o*a;while(s>1048576||e!=null&&(o>e||a>e));return Dte(t,o,a)}function Gpt(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return Dte(t,Math.round(t.width*r),Math.round(t.height*r))}function Dte(t,e,i){if(t instanceof ImageData)return Dte(WAe(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function WAe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new Y("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}let Nte=class extends Cm{get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=Fo.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new ns,this._parameters={...qpt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(AE(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){Rm(e.src)||AE(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new jr;return i.wrapMode=this._parameters.wrap??Tr.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?Mi.LINEAR_MIPMAP_LINEAR:Mi.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.usedMemory)||Hpt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new fr(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):q_(i)&&this._parameters.encoding===ev.DDS_ENCODING?this._loadFromDDSData(e,i):K$(i)&&this._parameters.encoding===ev.DDS_ENCODING?this._loadFromDDSData(e,new Uint8Array(i)):(K$(i)||q_(i))&&this._parameters.encoding===ev.KTX2_ENCODING?this._loadFromKTX2(e,i):(K$(i)||q_(i))&&this._parameters.encoding===ev.BASIS_ENCODING?this._loadFromBasis(e,i):q_(i)?this._loadFromPixelData(e,i):K$(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<cR.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=zpt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>Spt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>xpt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){St(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?kt.LUMINANCE:this._parameters.components===3?kt.RGB:kt.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new fr(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const n=await Py(i,{signal:r});return zt(r),this._loadFromImage(e,n)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const n=await kve(i,i.src,!1,r);return zt(r),this._loadFromImage(e,n)})}_loadFromVideoElement(e,i){return i.readyState>=cR.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((n,s)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),Sr(c)},a=()=>{i.readyState>=cR.HAVE_CURRENT_DATA&&(o(),n(this._loadFromImage(e,i)))},l=h=>{o(),s(h||new Y("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=_a(r,()=>l(ki()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?jpt(r,o):Gpt(r,o)}const n=ZAe(r);this._parameters.width=n.width,this._parameters.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this._parameters.components===3?kt.RGB:kt.RGBA,s.width=n.width,s.height=n.height,this._glTexture=new fr(e,s,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const n=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(n,n),r}unload(){if(this._glTexture=Ht(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function Hpt(t,e){if(t==null)return 0;if(K$(t)||q_(t))return e.encoding===ev.KTX2_ENCODING?bpt(t,!!e.mipmap):e.encoding===ev.BASIS_ENCODING?wpt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?ZAe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function ZAe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var cR;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(cR||(cR={}));const qpt={wrap:{s:Tr.REPEAT,t:Tr.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},YAe=128,D2=.5;function Wpt(t){return t==="cross"||t==="x"}function Zpt(t,e=YAe,i=e*D2,r=0){const n=XAe(t,e,i,r);return new Nte(n,{mipmap:!1,wrap:{s:Tr.CLAMP_TO_EDGE,t:Tr.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function XAe(t,e=YAe,i=e*D2,r=0){switch(t){case"circle":default:return Ypt(e,i);case"square":return Xpt(e,i);case"cross":return Qpt(e,i,r);case"x":return Kpt(e,i,r);case"kite":return Jpt(e,i);case"triangle":return eft(e,i);case"arrow":return tft(e,i)}}function Ypt(t,e){const i=t/2-.5;return wI(t,KAe(i,i,e/2))}function Xpt(t,e){return JAe(t,e,!1)}function Jpt(t,e){return JAe(t,e,!0)}function Qpt(t,e,i=0){return QAe(t,e,!1,i)}function Kpt(t,e,i=0){return QAe(t,e,!0,i)}function eft(t,e){return wI(t,eRe(t/2,e,e/2))}function tft(t,e){const i=e,r=e/2,n=t/2,s=.8*i,o=KAe(n,(t-e)/2-s,Math.sqrt(s*s+r*r)),a=eRe(n,i,r);return wI(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function JAe(t,e,i){return i&&(e/=Math.SQRT2),wI(t,(r,n)=>{let s=r-.5*t+.25,o=.5*t-n-.75;if(i){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function QAe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const n=.5*e;return wI(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=r/2,a})}function KAe(t,e,i){return(r,n)=>{const s=r-t,o=n-e;return Math.sqrt(s*s+o*o)-i}}function eRe(t,e,i){const r=Math.sqrt(e*e+i*i);return(n,s)=>{const o=Math.abs(n-t)-i,a=s-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function wI(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let n=0;n<t;n++){const s=n+t*r;let o=e(n,r);o=o/t+.5,rte(o,i,4*s)}return i}let ipe=class extends Ne{constructor(e){super(),this.view=null,this.layerUid=null,this._renderGeometries=new Map,this._materials=new Map,this._directRenderers=new Map,this._lodRenderers=new Map,this.view=e.view,this.layerUid=e.layerUid}initialize(){}destroy(){}async executeRenderCommands(e){for(const i of e)switch(i.id){case"create-material":await this._createMaterial(i);break;case"create-direct-renderer":await this._createDirectRenderer(i);break;case"add-direct-renderer-geometry":await this._addDirectRendererGeometry(i);break;case"remove-direct-renderer-geometry":await this._removeDirectRendererGeometry(i);break;case"create-lod-renderer":await this._createLodRenderer(i);break;case"add-lod-instances":await this._addLodInstances(i);break;case"remove-lod-instances":await this._removeLodInstances(i)}}async _createMaterial(e){const{view:i}=this,{sharedSymbolResources:r}=i;if(r==null)throw new Error("No shared symbol resources found!");const{textures:n}=r,s=i.state.viewingMode===ct.Global;let o=null;switch(e.type){case"default":o=rft(r,{physicalBasedRenderingEnabled:!0,slicePlaneEnabled:!1,castShadows:!0,isPrimitive:!0,screenSizePerspectiveEnabled:!0,doublePrecisionRequiresObfuscation:i._stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result},s);break;case"hud":{const[a,l]=ift(n,s);this.addHandles([Ui(()=>Lr(l))]),o=a}break;default:throw new Error(`unable to create unknown material type ${e.type}`)}this._materials.set(e.materialId,o)}_getMaterial(e){return this._materials.get(e)}async _createDirectRenderer(e){const i=e.materialId,r=this._getMaterial(i);if(r==null)throw new Error(`material not found ${i}`);const{view:n}=this,s=new GF({material:r});this._directRenderers.set(i,s),n._stage.addRenderPlugin(s),n._stage.renderView.renderer.updateHasFlags()}async _addDirectRendererGeometry(e){const i=e.renderGeometryId,r=e.materialId;this._renderGeometries.get(i)!=null&&await this._removeDirectRendererGeometry({renderGeometryId:i});const n=this._directRenderers.get(r);if(n==null)return void console.error("no renderer assigned to provided material");const s=n.addRenderGeometry(i,e.renderGeometryBuffer,e.localOrigin);this._renderGeometries.set(i,{renderGeometry:s,materialId:r}),this.view._stage.renderView.requestRender()}async _removeDirectRendererGeometry(e){const i=e.renderGeometryId,r=this._renderGeometries.get(i);if(r==null)return;const n=r.materialId,s=this._directRenderers.get(n);s!=null?s.removeRenderGeometry(e.renderGeometryId):console.error("no renderer assigned to provided material")}async _createLodRenderer(e){const i=new eY({view:this.view,layerUid:this.layerUid}),r=new AbortController,n=s=>this._getMaterial(s);await i.doLoad(e.lodRenderGeometry,n,r.signal),this._lodRenderers.set(e.lodRendererId,i)}async _addLodInstances(e){const i=this._lodRenderers.get(e.lodRendererId);if(i==null)throw new Error("no lod renderer assigned to provided lod renderer Id");i.addInstances(e.data)}async _removeLodInstances(e){const i=this._lodRenderers.get(e.lodRendererId);if(i==null)throw new Error("no lod renderer assigned to provided lod renderer Id");i.removeInstances(e.featureIds)}};function ift(t,e){const i={anchorPosition:kdt.center,occlusionTest:!0,hasSlicePlane:!1},r=i,n=1;r.color=[1,0,0,1],r.outlineColor=[0,0,0,1],r.outlineSize=n;const s=null;if(t!=null){const o=t.fromData("circle-icon",()=>Zpt("circle"));r.textureId=o.texture.id,r.textureIsSignedDistanceField=!0,r.sampleSignedDistanceFieldTexelCenter=Wpt("circle")}return r.distanceFieldBoundingBox=sft,[new Xz(i,e),s]}function rft(t,e,i){const r={usePBR:e.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:Act,ambient:kR,diffuse:kR,hasSlicePlane:e.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:e.castShadows,offsetTransparentBackfaces:!e.isPrimitive};return nft(r),r.screenSizePerspective=t.screenSizePerspectiveSettings,r.externalColor=WU,r.isInstanced=!0,new vte(r,{spherical:i,doublePrecisionRequiresObfuscation:!0})}function nft(t){const e=t.opacity??1,i=e<1;return t.transparent=i,t.opacity=e,t.cullFace=i?ic.None:ic.Back,t}ipe=u([L("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderManager")],ipe);const sft=[D2/2,D2/2,1-D2/2,1-D2/2];let rpe=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const tRe="arial-unicode-ms",npe="woff2",spe=new Map,iRe=new Set;let oft=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function aft(t){const e=hft(t),i=uft(t),r=spe.get(e);if(r)return r.promise;const n=new FontFace(t.family,`url('${Qr.fontsUrl}/woff2/${i}.${npe}') format('${npe}')`,{style:t.style,weight:t.weight}),s=document.fonts;if(s.has(n)&&n.status==="loading")return n.loaded;const o=n.load().then(()=>(s.add(n),n));return spe.set(e,new oft(n,o)),iRe.add(n),o}function lft(t){return iRe.has(t)}function cft(t){if(!t)return tRe;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function uft(t){const e=rRe(t)+nRe(t);return cft(t.family)+(e.length>0?e:"-regular")}function hft(t){const e=rRe(t)+nRe(t);return(t.family||tRe)+(e.length>0?e:"-regular")}function rRe(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function nRe(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let dft=class sRe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=ope(e.color),this.haloStyle=pft(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?ope(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){var g,y,w,b,x;const r=(g=e==null?void 0:e.material)==null?void 0:g.color,n=mt.toUnitRGBA(r)??hs,s=e.size!=null?qb(e.size):12,o=e.lineHeight,a=e.background!=null?mt.toUnitRGBA(e.background.color):hs,l={family:((y=e.font)==null?void 0:y.family)??"sans-serif",decoration:((w=e.font)==null?void 0:w.decoration)??"none",weight:((b=e.font)==null?void 0:b.weight)??"normal",style:((x=e.font)==null?void 0:x.style)??"normal"},c=e.halo,h=(c==null?void 0:c.color)!=null&&c.size>0?{size:qb(c.size),color:mt.toUnitRGBA(c.color)}:{size:0,color:hs},p=new sRe({color:n,size:s,background:{color:a,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i});if(e.font){let T=!1;const M=p.fontString(s);try{T=(await document.fonts.load(M)).some($=>!lft($))}catch{de.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${M}'. Some text symbology may be rendered using the default browser font.`)}if(!T&&!fft.has(e.font.family))try{await aft(e.font)}catch{}}return p}};function pft(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function ope(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const fft=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),V0=4096;let N2=class extends Ne{constructor(e){super(e),this.type=Fo.Texture,this.id=rd(),this.events=new ns,this._glTexture=null,this._atlas=new gft(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=Ht(this._glTexture),this._frameWorker=Sr(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return uR=0,[V0-B0-uR,V0-B0-uR-ape]}load(e){if(this._glTexture)return this._glTexture;const i=new jr;return i.wrapMode=Tr.CLAMP_TO_EDGE,i.samplingMode=Mi.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new fr(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(xt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Sr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Ht(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.width=e.width,this._canvas.height=e.height}_resizeAtlas(e,i){var s,o;const{width:r,height:n}=this._atlas;r===e&&n===i||(this._atlas.width=e,this._atlas.height=i,(s=this._glTexture)==null||s.resize(e,i),(o=this._glTexture)==null||o.updateData(0,0,0,r,n,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{var l;return(l=this._uvCallbacks.get(a.textRenderer.key))==null?void 0:l.forEach(c=>c(a.uv))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,n){const s=this._atlas;if(s.width<r||s.height<n)return!1;let o=s.cursors.get(n);if(!o){if(s.height<s.nextY+n)return!1;o=[new lpe(s.nextY)],s.cursors.set(n,o),s.nextY+=n}let a=o.find(l=>s.width>=l.x+r);if(a==null){if(s.height<s.nextY+n)return!1;a=new lpe(s.nextY),s.nextY+=n,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureCallbacks(e){const i=this._uvCallbacks.get(e);if(i)return i;const r=new Set;return this._uvCallbacks.set(e,r),r}_addCallback(e,i){this._ensureCallbacks(e).add(i)}_removeCallback(e,i){const r=this._uvCallbacks.get(e);return!(!(r!=null&&r.delete(i))||r.size!==0)&&(this._uvCallbacks.delete(e),!0)}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,n=e.textRenderer.renderedWidth,s=e.textRenderer.renderedHeight,o=n+B0,a=s+B0+ape;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(my(Math.max(o,1.5*r.width)),V0);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(my(Math.max(l,1.5*r.height)),V0);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<V0){const h=Math.min(my(1.5*r.width),V0);this._resizeAtlas(h,r.height)}}this._elements.set(i,e)}}_renderElement(e){var n;const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-B0,i[1]-B0,r.renderedWidth+2*B0,r.renderedHeight+2*B0),r.render(this._ctx,i[0],i[1]),(n=this._uvCallbacks.get(r.key))==null||n.forEach(s=>s(e.uv))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return jo;for(;this._needsRepack&&(this._canRepack||this._atlas.height<V0&&this._atlas.height<V0);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(e,i){const r=e.key;this._addCallback(r,i);let n=this._elements.get(r);return n?Ob(n.uv,hs)||i(n.uv):(n=new mft(this._atlas,e),this._processAddition(n),this.setDirty()),{remove:()=>this._removeText(e,i)}}_removeText(e,i){const r=e.key;this._elements.get(r)&&this._removeCallback(r,i)&&(this._elements.delete(r),this._elementsToRender.delete(r),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};u([f({constructOnly:!0})],N2.prototype,"view",void 0),u([f({type:Boolean})],N2.prototype,"updating",void 0),N2=u([L("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],N2);const B0=2,ape=2;let mft=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=Ti(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return hs;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return _n(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},gft=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=uR}},lpe=class{constructor(e){this.y=e,this.x=uR}},uR=0;const yft=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var yv;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(yv||(yv={}));let oRe=class extends Cm{constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=Fo.Layer,this.events=new ns,this.visible=!0,this.sliceable=!1,this._objectsAdded=new mi,this._handles=new Dy,this._objects=new mi,this._pickable=!0,this.visible=(i==null?void 0:i.visible)??!0,this._pickable=(i==null?void 0:i.pickable)??!0,this.updatePolicy=(i==null?void 0:i.updatePolicy)??yv.ASYNC,this._disableOctree=(i==null?void 0:i.disableOctree)??!1,e.add(this);for(const n of yft)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==yv.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new kp(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Ye(this._octree),this._objectsAdded.clear()}};function Ik(t){return t!=null&&t.type===Fo.Layer}let cpe=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.textureAtlasHandles=[],this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},_ft=class{constructor(e,i,r,n,s){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},vft=class{constructor(e,i,r,n,s,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new oRe(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},Rw=class extends Ne{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([oe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),oe(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(xt.LABELER,this)]),this._textTextureAtlas=new N2({view:this.view}),this._hudMaterialCollection=new rpe(this.view._stage),this._calloutMaterialCollection=new rpe(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=Ht(this._textTextureAtlas),this._hudMaterialCollection=Ht(this._hudMaterialCollection),this._calloutMaterialCollection=Ht(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),jd.graphic=null,jd.renderingInfo=null,jd.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const n=new cpe(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n),i.setVisibilityFlag(go.LABEL,ga.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(go.LABEL,ga.USER,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(e.textureAtlasHandles.push(this._textTextureAtlas.addText(r,n=>bft(i.stageObject,n))),wft(i.stageObject,r))}}_removeLabelTextureFromAtlas(e){e.textureAtlasHandles.forEach(i=>i.remove()),e.textureAtlasHandles.length=0}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),jo}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(YG(i))this._dirty=!0;else if(XG(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else for(const[r,n]of i.labelsToInitialize)if(this._ensureGraphics3DResources(n)&&(this._labels.set(r,n),this.deconflictor.setDirty(),e.madeProgress()),(n.visible&&n.textInitialized||!n.visible&&n.hasGraphics3DResources)&&(i.labelsToInitialize.delete(r),e.madeProgress()),e.done){this._dirty=!0;break}}this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),zt(i),(a=e.scaleVisibility)==null||a.updateScaleRangeActive();const r=e.graphics3DCore,n=r.layer,s=(l=n.labelingInfo)==null?void 0:l.filter(c=>!!c.symbol);!s||s.length===0||(await IJ(s,async(c,h)=>{const p=c.symbol,g=$te(r.getOrCreateGraphics3DSymbol(p));if(g==null)return void de.getLogger(this).error("Failed to create Graphics3DSymbol for label");await g.load(),zt(i);let y=null;gEe(p)&&p.hasVisibleCallout()&&(y=Eht(p,r.symbolCreationContext),await y.load(),zt(i));const w=await Xp(Wat(c,e.layer.fieldsIndex,this.view.spatialReference));if(zt(i),w.ok===!0){const b=await this._createTextRenderParameters(g.symbol);zt(i),e.labelClassContexts[h]=new _ft(c,g,y,b,w.value)}else de.getLogger(this).error(`Label expression failed to evaluate: ${w.error}`)}),zt(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(Bn(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return(i==null?void 0:i.type)!=="text"?null:dft.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,jc(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,n,s,o){const a=new ydt(r,Fde(r.anchor),zdt(r.anchor),e.text,ks(e.displayWidth,e.displayHeight));return jd.graphic=i,jd.renderingInfo=null,jd.layer=n,s.createLabel(jd,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=Lde(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,n,s){jd.graphic=e,jd.layer=s;const o=n.screenOffset[0];return jd.renderingInfo=new Sht(null,i,n.translation,n.centerOffset,o,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(jd)}_ensureGraphics3DResources(e){var c,h;if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,n=r.labelClassContexts;if(XG(n)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let s=!1;const o=i.graphic,a=r.layer,l=bD(r.layer);for(let p=0;p<n.length;p++){const g=e.textRenderers[p],y=e.textLabelPlacements[p];if(g==null||y==null)continue;const w=n[p],b=w.graphics3DSymbol,x=b.symbol&&b.symbol.type==="label-3d"?b.symbol:null,T=b.symbolLayers[0];if(!T)continue;T.setElevationInfoOverride(r.elevationInfoOverride);const M=new Cdt(i,x,w.labelClass),$=this._createTextSymbolGraphic(g,o,y,a,T,M);if($==null)return!1;$._labelClass=w.labelClass,$._labelIndex=p,i.addLabelGraphic($,r.stageLayer),i.deconflictionPriority=((c=w.textRenderParameters)==null?void 0:c.definition.size)??0,i.setVisibilityFlag(go.LABEL,ga.USER,l),i.setVisibilityFlag(go.LABEL,ga.SCALE_RANGE,!0),i.setVisibilityFlag(go.LABEL,ga.DECONFLICTION,!1),s=!0;const R=w.graphics3DCalloutSymbolLayer;if(R&&y.hasLabelVerticalOffset){R.setElevationInfoOverride(r.elevationInfoOverride);const I=this._createLineCalloutGraphic(o,x,R,y,a);I!=null&&(w.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(I,r.stageLayer))}break}return s&&((h=r.scaleVisibility)==null||h.updateGraphicLabelScaleVisibility(i)),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const n=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];n==null||n.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(XG(r))return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const M=l.needsHydrationToEvaluate()?Oat(n,i.layer):n;c=l.evaluate(M)}catch{c=null}else c=l.evaluate(n);if(c==null||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol,p=((s=h.symbol)==null?void 0:s.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const g=e.graphics3DGraphic,y=a.labelClass,w=i.disablePlacement,b=Lde({graphics3DGraphic:g,labelSymbol:p,labelClass:y,disablePlacement:w});if(b==null)continue;const x=Fde(b.anchor),T=Udt(x);e.textRenderers[o]=new Sdt(c,T,a.textRenderParameters,N2.maxSize),e.textLabelPlacements[o]=b}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const n=new cpe(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,n=this._labels.get(r);if(!n)return!0;for(const s of n.graphics3DGraphic.labelLayers)if(s._labelClass!=null&&!e.labelClassContexts[s._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(s,i.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,n=this._labels.get(r);e.graphics.delete(r),n&&(this._destroyGraphic(n,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const n=e.graphics.get(r);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const n=new Map;i.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const i=bD(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const n=this._labels.get(r);n&&(this._destroyGraphic(n,r),n.visible=!1,e.labelsToInitialize.set(r,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const n=(r==null?void 0:r.emptySymbolLabelSupported)||!1,s=(r==null?void 0:r.elevationInfoOverride)||null,o=(r==null?void 0:r.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new vft(this.view._stage,a,e,i,n,s,o,bD(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>bD(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(n=>this._removeGraphic(i,n)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,n=this._labels.get(r);n&&n.visible!==i&&(i&&!n.textureAtlasHandles.length?(this._addLabelTextureToAtlas(n),n.textInitialized||n.labelingContext.labelsToInitialize.set(r,n)):!i&&n.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(n),n.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>YG(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(YG(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function wft(t,e){t.geometries[0].setAttributeData(k.SIZE,[e.displayWidth,e.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],k.SIZE)}function bft(t,e){t.geometries[0].setAttributeData(k.UV0,e),t.geometryVertexAttributeUpdated(t.geometries[0],k.UV0,!0)}function YG(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function XG(t){return!t||t.length===0}function bD(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}u([f({constructOnly:!0})],Rw.prototype,"view",void 0),u([f({constructOnly:!0})],Rw.prototype,"deconflictor",void 0),u([f()],Rw.prototype,"_textTextureAtlas",void 0),u([f({type:Boolean,readOnly:!0})],Rw.prototype,"updating",null),Rw=u([L("esri.views.3d.layers.graphics.Labeler")],Rw);const jd=new Tht(null,null,null);let xft=class VT{constructor(e,i,r,n){this.lij=[0,0,0],this.extent=Zi(),this.resolution=0,this.loadPriority=0,this.measures=new Sft,this.used=!1,this.acquire(e,i,r,n)}get planetRadius(){return xr(this.tilingScheme.spatialReference).radius}acquire(e,i,r,n){this.tilingScheme=n,this.id=VT.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,n.getExtent(e,i,r,this.extent),this.measures.effectiveLevelForLod=e,this.updateResolution()}updateResolution(){this.resolution=this.tilingScheme.resolutionAtLevel(this.measures.effectiveLevelForLod)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],n=2*this.lij[2];return e?e.acquire(i,r,n,this.tilingScheme):[new VT(i,r,n,this.tilingScheme),new VT(i,r+1,n,this.tilingScheme),new VT(i,r,n+1,this.tilingScheme),new VT(i,r+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.copyFrom(e.measures),this.updateResolution()}static id(e,i,r){return`${e}/${i}/${r}`}};var cx;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE=1]="VISIBLE"})(cx||(cx={}));let Sft=class{constructor(){this.visibility=cx.VISIBLE,this.distance=0,this.shouldSplit=!1,this.effectiveLevelForLod=0}copyFrom(e){return this.visibility=e.visibility,this.distance=e.distance,this.shouldSplit=e.shouldSplit,this.effectiveLevelForLod=e.effectiveLevelForLod,this}};function Tft(t,e,i,r,n,s,o=1){const a=Mv(e,n,zU);if(a==null)return!1;if(a===An){if(t===r&&i===s)return!0;const c=i+o;for(let h=i,p=s;h<c;++h,++p)ye(r[p],t[h]);return!0}const l=i+o;for(let c=i,h=s;c<l;++c,++h)a(t[c],0,r[h],0);return!0}let Eft=class{constructor(e,i){this._renderCoordsHelper=e,this._getIsGroundOpaque=i,this._isGroundOpaque=!1,this._cache=new Map,this._cameraForward=A(),this._cameraEye=A(),this._cameraFovY=55*Math.PI/180,this._frustumBoundingSphereCenter=A(),this._frustumBoundingSphereRadius=0,this._frustum=new B5(e),this._renderSR=e.spatialReference;const r=Iv(this._renderSR);this._renderSREllipsoidRadius=xr(r).radius}begin(e){this._aboveGround=e.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(e),Me(this._cameraForward,e.viewForward),ye(this._cameraEye,e.eye),this._cameraFovY=e.fovY,this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){return this._getOrCalculateSingleTileVisibility(e)}_getOrCalculateSingleTileVisibility(e){const i=this._cache.get(e.id);if(i!=null)return i;const r=this._calculateSingleTileVisibility(e);return this._cache.set(e.id,r),r}_calculateSingleTileVisibility(e){return this._calculateSingleTileVisibilitySided(e)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===ct.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,i=e.origin,r=Lft;Me(r,e.direction);const n=e.points,s=Dft;nr(s,n[4],i);const o=.5*Te(s,s)/Te(r,s),a=this._frustumBoundingSphereCenter;Us(a,i,r,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const i=e.tilingScheme.spatialReference,r=e.extent,n=this._renderSR,s=Oft;if(s[0]=r[0],s[1]=r[1],s[2]=0,s[3]=r[2],s[4]=r[3],s[5]=0,!io(s,i,0,s,n,0))return!1;const o=dpe;ve(o[0],s[0],s[1],0),ve(o[1],s[3],s[1],0),ve(o[2],s[3],s[4],0),ve(o[3],s[0],s[4],0);const a=ppe;ve(a,.5*(s[0]+s[3]),.5*(s[1]+s[4]),.5*(s[2]+s[5]));const l=gpe,c=.5*Na(o[0],o[2]),h=this._frustum,p=this._frustumBoundingSphereRadius,g=this._frustumBoundingSphereCenter,y=Fft;nr(y,g,a);const w=Te(l,y),b=Nft;if(Us(b,a,l,w),Na(b,g)>c+p)return!1;const x=this._cameraForward,T=Te(x,gpe),M=this._cameraFovY,$=this._cameraEye;if(Math.abs(T)<Math.abs(Math.cos(.5*M))){let U=!0;const B=ve(umt,x[0],x[1],0),W=Te($,B);for(let j=0;j<4;++j){const Q=o[j];if(Te(Q,B)-W>0){U=!1;break}}if(U)return!1}{const U=o[0],B=o[2];if(U[0]<=$[0]&&$[0]<=B[0]&&U[1]<=$[1]&&$[1]<=B[1])return!0}const R=$ft,I=this._isGroundOpaque&&this._aboveGround,P=this._isGroundOpaque&&!this._aboveGround,N=Math.min(P?D$:1/0,w+p),V=Math.max(I?-D$:-1/0,w-p);for(let U=0;U<4;++U)Us(R[U],o[U],l,N),Us(R[U+4],o[U],l,V);if(hpe(h.planes,R,8))return!1;if(JG(h.planes,R,8))return!0;for(let U=0;U<4;++U){const B=R[U],W=R[U+4];if(e8(h.planes,B,W))return!0;const j=R[(U+1)%4];if(e8(h.planes,B,j))return!0;const Q=R[4+(U+1)%4];if(e8(h.planes,W,Q))return!0}if(xf[0][3]=+o[0][0],xf[1][3]=-o[2][0],xf[2][3]=+o[0][1],xf[3][3]=-o[2][1],xf[4][3]=+V,xf[5][3]=-N,JG(xf,h.points)||JG(xf,h.points))return!0;for(let U=0;U<4;++U){const B=$,W=h.points[U+4];if(ype(xf,B,W))return!0;const j=h.points[4+(U+1)%4];if(ype(xf,W,j))return!0}return!1}_isTileVisibleInFrustumGlobal(e){if(e.lij[0]<lRe)return!0;const i=e.tilingScheme.spatialReference,r=e.extent,n=this._isGroundOpaque&&this._aboveGround,s=this._isGroundOpaque&&!this._aboveGround,o=dpe,a=.5*(r[0]+r[2]);if(ve(o[0],r[0],r[1],0),ve(o[1],r[2],r[1],0),ve(o[2],r[2],r[3],0),ve(o[3],r[0],r[3],0),ve(o[4],a,r[1],0),ve(o[5],a,r[3],0),!Tft(o,i,0,o,this._renderSR,0,6))return!1;const l=o[0][2]>0,c=o[3][2]<0,h=l||c,p=this._renderSREllipsoidRadius;if(h){const K=Qe(0,0,1),Se=Aft;g_(Se,K,o[0]);const Ee=Rft;if(g_(Ee,K,o[1]),l){const Ce=fpe,Le=o[4],Ke=mpe;g_(Ke,Le,K),g_(Ce,Ke,Le);const Re=o[0];Ot(Re,Se,Ce),L$(Re,p);const ze=o[1];Ot(ze,Ee,Ce),L$(ze,p)}else if(c){const Ce=fpe,Le=o[5],Ke=mpe;g_(Ke,Le,K),g_(Ce,Le,Ke);const Re=o[3];Ot(Re,Ce,Se),L$(Re,p);const ze=o[2];Ot(ze,Ce,Ee),L$(ze,p)}}const g=ppe;{const K=nr(Vft,o[3],o[0]);Me(K,K);const Se=xe(Bft,o[0],o[3]);ue(Se,Se,.5);const Ee=-Te(Se,K),Ce=xe(jft,o[0],o[1]);ue(Ce,Ce,.5);const Le=xe(Gft,o[2],o[3]);ue(Le,Le,.5);const Ke=nr(Hft,Le,Ce);Me(Ke,Ke);const Re=-(Ee+Te(K,Ce))/Te(K,Ke);Us(g,Ce,Ke,Re),L$(g,p)}const y=this._frustumBoundingSphereRadius,w=this._frustumBoundingSphereCenter,b=this._frustum,x=b.planes,T=Ift;Me(T,g);const M=Te(o[0],T)/ua(o[0]),$=b.origin,R=b.points;let I=!1;if(n){{I=!0;const Se=Me(A(),$);for(let Ee=0;Ee<4;++Ee){const Ce=R[4+Ee],Le=nr(A(),Ce,$);Me(Le,Le);const Ke=Ot(A(),Se,Le);Me(Ke,Ke);const Re=Ot(A(),Le,Ke);if(Me(Re,Re),Te($,Re)>p){I=!1;break}}}if(I&&Te($,T)<p*M-D$)return!1;const K=Me(amt,b.origin);if(Te(K,T)<0)return!1;{const Se=Me(lmt,b.direction);if(Te(Se,T)>cmt)return!1}}const P=Math.sqrt(1-M*M);if(P>.9)return!0;let N=!1;{const K=Te(T,w),Se=ua(w);if(Se<=y&&!x.some(Le=>us(Le,QG)>0)){if(!n)return!0;N=!0}const Ee=K/Se;if(!N&&K<=0&&-K>y)return!1;const Ce=y/Se;if(Math.sqrt(1-Ee*Ee)*Math.sqrt(1-Ce*Ce)-Ce*Ee>P)return!1}if(!I&&(o.some(K=>b.intersectsPoint(K))||b.intersectsPoint(g)))return!0;const V=kft;nr(V,w,QG);const U=Te(V,T),B=Pft;ue(B,T,U);const W=Na(B,w),j=i.isWGS84,Q=e.lij,Z=j&&Q[2]===2**Q[0]-1,X=j&&Q[2]===0,ge=X?tmt:Z?Kft:Jft,ae=X?imt:Z?emt:Qft;if(!N){const K=o,Se=rmt,Ee=qft,Ce=Wft,Le=QG;for(const Ke of ge){const Re=K[Ke];if(upe(Ee,K[(Ke+1)%4],Re),upe(Ce,Le,Re),g_(Se,Ce,Ee),Mft(Se,R,1))return!1}}let z=null;if(!n&&U<1.01*y){const K=2.5*y;if(W>M*K+y)return!1;const Se=zft,Ee=K/M;for(let Ce=0;Ce<4;++Ce)ue(Se[Ce],o[Ce],Ee/p);ve(Se[4],0,0,0),z=Se}else{const K=(s?p+D$:U+y)/M,Se=n?p-D$:(U-y)/M,Ee=Uft;for(let Ce=0;Ce<4;++Ce){const Le=o[Ce];ue(Ee[Ce],Le,Se/p),ue(Ee[Ce+4],Le,K/p)}z=Ee}if(hpe(x,z,z.length))return!1;const he=b.lines,ce=Zft,G=Yft;for(const K of he){Me(G,K.direction);for(const Se of ae){const Ee=z[Se];if(Me(ce,Ee),KG(G,ce,z,R))return!1;const Ce=(Se+1)%4;if(n){const Le=z[Ce];if(nr(ce,Le,Ee),Me(ce,ce),KG(G,ce,z,R))return!1}if(s){const Le=z[4+Se],Ke=z[4+Ce];if(nr(ce,Ke,Le),Me(ce,ce),KG(G,ce,z,R))return!1}}}return!0}_calculateSingleTileVisibilitySided(e){return this._isTileVisibleInFrustum(e)?cx.VISIBLE:cx.INVISIBLE}};function g_(t,e,i){return Ot(t,e,i),Me(t,t),t}function upe(t,e,i){return nr(t,e,i),Me(t,t),t}function L$(t,e){return ue(t,t,e/ua(t)),t}const aRe=[mo.LEFT,mo.RIGHT,mo.BOTTOM,mo.TOP,mo.FAR];function Cft(t,e,i){for(let r=0;r<i;++r)if(us(t,e[r])<=0)return!1;return!0}function hpe(t,e,i){for(const r of aRe)if(Cft(t[r],e,i))return!0;return!1}function JG(t,e,i=e.length){for(let r=0;r<i;++r){const n=e[r];let s=!0;for(const o of t)if(us(o,n)>0){s=!1;break}if(s)return!0}return!1}const lRe=2;function Mft(t,e,i){for(const r of e)if(Te(r,t)<i)return!1;return!0}const $ft=[A(),A(),A(),A(),A(),A(),A(),A()],Oft=[0,0,0,0,0,0],dpe=[A(),A(),A(),A(),A(),A()],ppe=A(),fpe=A(),Aft=A(),Rft=A(),mpe=A(),Ift=A(),Pft=A(),Lft=A(),Dft=A(),Nft=A(),Fft=A(),QG=xm(0,0,0),kft=A(),Uft=[A(),A(),A(),A(),A(),A(),A(),A()],zft=[A(),A(),A(),A(),A()],Vft=A(),Bft=A(),jft=A(),Gft=A(),Hft=A(),qft=A(),Wft=A(),Zft=A(),Yft=A(),Xft=A(),Jft=[0,1,2,3],Qft=[0,1,2,3],Kft=[0,1,3],emt=[0,1,3],tmt=[1,2,3],imt=[1,2,3],rmt=A();function nmt(t,e,i){let r=1/0,n=-1/0;for(const s of i){const o=Te(e,s);r=Math.min(r,o),n=Math.max(n,o)}t[0]=r,t[1]=n}function smt(t,e,i,r){let n=1/0,s=-1/0;for(const o of r){const a=Te(i,o);if(n=Math.min(n,a),s=Math.max(s,a),n<=e&&s>=t)return!1}return!0}const omt=[0,0];function KG(t,e,i,r){if(i.length===0||r.length===0)return!0;const n=Xft;g_(n,t,e);const s=r[0]<i[0],o=s?i:r,a=omt;return nmt(a,n,s?r:i),smt(a[0],a[1],n,o)}const D$=430,amt=A(),lmt=A(),cmt=Math.cos(.25*Math.PI),gpe=Qe(0,0,1),umt=A();function e8(t,e,i){const r={t0:0,t1:1};for(const n of aRe)if(!cRe(t[n],e,i,r))return!1;return r.t0<r.t1}function ype(t,e,i){const r={t0:0,t1:1};for(const n of t)if(!cRe(n,e,i,r))return!1;return r.t0<r.t1}function cRe(t,e,i,r){let{t0:n,t1:s}=r;const o=us(t,e),a=us(t,i);if(o>=0&&a>=0)return!1;if(o<0&&a>=0){const l=-o/(a-o);if(l<n)return!1;l<s&&(s=l)}else if(o>=0&&a<0){const l=o/(o-a);if(l>s)return!1;l>n&&(n=l)}return r.t0=n,r.t1=s,!0}const xf=[Yg(-1,0,0,1),Yg(1,0,0,-1),Yg(0,-1,0,1),Yg(0,1,0,-1),Yg(0,0,-1,1),Yg(0,0,1,-1)];let hmt=class{constructor(e){this._camera=new Jr,this._focusOnMap=[0,0],this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new Eft(e.renderCoordsHelper,e.getIsGroundOpaque)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,this._visibility.begin(this._camera)}end(){this._visibility.end()}updateTile(e){const{measures:i}=e;i.visibility=this._visibility.calculate(e),i.distance=cVe(e.extent,this._focusOnMap),i.visibility!==cx.INVISIBLE&&this._updateSplitDecisionAndLod(e)}_calculateTileShouldSplitGlobal(e){const i=this._camera,{eye:r}=i,n=ua(r),s=this._renderCoordsHelper,o=s.referenceEllipsoid.radius;if(n>2*o)return e.measures.effectiveLevelForLod=0,!1;const a=e.lij[0];if(a<=lRe)return e.measures.effectiveLevelForLod=a,!0;const l=_pe,{extent:c}=e,{_surfaceElevation:h}=this;ve(l[0],c[0],c[1],h),ve(l[1],c[2],c[1],h),ve(l[2],c[2],c[3],h),ve(l[3],c[0],c[3],h);const p=ve(vpe,.5*(c[0]+c[2]),.5*(c[1]+c[3]),h),g=this._tilingScheme.spatialReference;for(let T=0;T<4;++T)s.toRenderCoords(l[T],g,l[T]);s.toRenderCoords(p,g,p);const y=Me(wpe,p),w=Te(r,y),b=ue(bpe,y,w),x=ua(r)-o;return ye(FS.origin,pmt),ye(FS.direction,y),this._calculateTileShouldSplitCommon(e,l,p,FS,x,b)}_calculateTileShouldSplitLocal(e){const i=_pe,{extent:r}=e,{_surfaceElevation:n}=this;ve(i[0],r[0],r[1],n),ve(i[1],r[2],r[1],n),ve(i[2],r[2],r[3],n),ve(i[3],r[0],r[3],n);const s=this._tilingScheme.spatialReference;for(let y=0;y<4;++y)this._renderCoordsHelper.toRenderCoords(i[y],s,i[y]);const o=ve(vpe,.5*(i[0][0]+i[2][0]),.5*(i[0][1]+i[2][1]),.25*(i[0][2]+i[1][2]+i[2][2]+i[3][2])),a=ve(wpe,o[0],o[1],0),{eye:l,far:c}=this._camera,h=ve(bpe,a[0],a[1],l[2]),p=l[2];ve(FS.origin,a[0],a[1],l[2]-2*c),ye(FS.direction,F2);const g=l[2]-2*c;return this._calculateTileShouldSplitCommon(e,i,o,FS,p,h,dmt,g)}_calculateTileShouldSplitCommon(e,i,r,n,s,o,a,l){const c=Math.max(Na(i[0],i[2]),Na(i[1],i[3]),Na(i[0],r)+Na(r,i[2])),h=this._camera,{eye:p,near:g,far:y,fovY:w,viewForward:b}=h,x=Oe(Te(n.direction,b),.1,1),T=Te(p,b),M=Te(r,b)-T,$=2*Math.tan(.5*w),R=Re=>Re<=g?1:1/(Re*$),I=Math.abs(s)/c,P=R(M),N=e.lij[0],V=Na(p,r);let U=0,B=1/0;for(const Re of i){const ze=Na(p,Re);B=Math.min(B,ze),U=Math.max(U,ze)}const{perScreenPixelRatio:W}=h,j=Re=>Math.max(0,N-2,N+Math.ceil(Math.log2(.002*Re/W))),Q=1,Z=300*Oe(x,.1,1),X=.8,ge=.7,ae=Na(o,p)>ge*c,z=M<g,he=Re=>Q*c/Re,ce=j(ae?he(V):z?Z*c/Math.abs(s):X*P*c),G=ce+(B-g>.33*(y-g)?-1:0);if(e.measures.effectiveLevelForLod=G,N+2<G)return!0;if(N>=G)return!1;const{frustum:K}=h,Se=I<fmt;if(Na(o,p)<g)return Se;const Ee=V7(K,n);if(ae){const Re=j(he(B)),ze=j(he(U));if(Math.abs(Re-ze)>2||Math.abs(ce-ze)>2||Math.abs(ce-Re)>2)return!0}else{const Re=Na(p,r),ze=.5*c/Math.SQRT2;if(N<=G+3||Re/ze>.6)return!0}if(!this.isGlobalMode&&ae&&a&&l!==void 0){let Re=0;for(let ze=0;ze<4;++ze){const vt=a[ze],Xt=l,li=A();Us(li,i[ze],vt,Xt);const ti=tz(li,vt);V7(K,ti)&&++Re}if(Re>=3||Re>=2&&Ee)return!1;if(Re<=2&&!Ee&&N<ce+1)return!0}const Ce=z5(K,r);let Le=0;for(let Re=0;Re<4;++Re){const ze=i[Re];Le+=z5(K,ze)?1:0}if(Ce&&Le>=2)return!1;if(!Ce&&!Ee&&Le<=1&&N<G)return Se;let Ke=M;for(let Re=0;Re<4;++Re){const ze=i[Re],vt=Te(ze,b)-T;Ke=Math.min(Ke,vt)}return Ke<=g?Se:!(R(Ke)*c<.3)&&N<G&&P*c>mmt&&Le<=2&&!Ce&&!Ee}_updateSplitDecisionAndLod(e){e.measures.shouldSplit=this.isGlobalMode?this._calculateTileShouldSplitGlobal(e):this._calculateTileShouldSplitLocal(e),e.updateResolution()}get isGlobalMode(){return this._renderCoordsHelper.viewingMode===ct.Global}};const _pe=[A(),A(),A(),A()],vpe=A(),wpe=A(),bpe=A(),F2=xm(0,0,1),dmt=[F2,F2,F2,F2],pmt=ws,FS=tz(ws,F2),fmt=1,mmt=.9;function gVt(t,e,i){if(t==null||i==null)return!1;let r=!0;return Ns[0]=t.xmin!=null?t.xmin:0,Ns[1]=t.ymin!=null?t.ymin:0,Ns[2]=t.zmin!=null?t.zmin:0,r=r&&io(Ns,t.spatialReference,0,e,i,0),Ns[0]=t.xmax!=null?t.xmax:0,Ns[1]=t.ymax!=null?t.ymax:0,Ns[2]=t.zmax!=null?t.zmax:0,r=r&&io(Ns,t.spatialReference,0,e,i,3),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function uRe(t,e,i){if(t==null||i==null)return!1;let r=!0;return Ns[0]=t.xmin!=null?t.xmin:0,Ns[1]=t.ymin!=null?t.ymin:0,Ns[2]=t.zmin!=null?t.zmin:0,r=r&&io(Ns,t.spatialReference,0,Ns,i,0),e[0]=Ns[0],e[1]=Ns[1],Ns[0]=t.xmax!=null?t.xmax:0,Ns[1]=t.ymax!=null?t.ymax:0,Ns[2]=t.zmax!=null?t.zmax:0,r=r&&io(Ns,t.spatialReference,0,Ns,i,0),e[2]=Ns[0],e[3]=Ns[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Ns=A();let Oo=class extends Ne{constructor(e){super(e),this.tiles=new ot,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new mi,this.tileBudget=100}initialize(){var r;const e=()=>this._setDirty(),i=()=>this._reset();this.addHandles([oe(()=>this.tilingScheme,i,hi),oe(()=>this.tileSize,i,hi),oe(()=>{var n;return(n=this.cameraOnSurface)==null?void 0:n.location},e,hi),oe(()=>{var n;return(n=this.viewState)==null?void 0:n.contentCamera},e,hi),oe(()=>{var n;return(n=this.focus)==null?void 0:n.location},e,hi),oe(()=>{var n;return((n=this.terrain)==null?void 0:n.baseOpacity)??1},e)]),this._frameWorker=(r=this.scheduler)==null?void 0:r.registerTask(xt.FEATURE_TILE_TREE,this)}destroy(){this._frameWorker=Sr(this._frameWorker)}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void de.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Zi();return uRe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}addClient(){const e=rd();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Ui(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(kc))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=xt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=xt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new hmt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,getIsGroundOpaque:()=>{var i;return(((i=this.terrain)==null?void 0:i.baseOpacity)??1)===1}}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const e=this.tilingScheme;return this._rootTileIds.map(i=>new xft(i[0],i[1],i[2],e))}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.shift();if(e.madeProgress(),this._filterExtentRect&&!$U(this._filterExtentRect,r.extent))continue;this._tileMeasurements.updateTile(r);const{measures:n}=r;if(n.visibility===cx.INVISIBLE)continue;const s=this._newTiles.length+this._pendingTiles.length+1;n.shouldSplit&&s<this.tileBudget?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)}this._pendingTiles.length===0&&(this._updateTiles(this._newTiles.toArray()),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const i=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),r=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles(),this.tiles.emit("change")}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};u([f({constructOnly:!0})],Oo.prototype,"scheduler",void 0),u([f({constructOnly:!0})],Oo.prototype,"renderCoordsHelper",void 0),u([f({constructOnly:!0})],Oo.prototype,"tilingSchemeOwner",void 0),u([f({constructOnly:!0})],Oo.prototype,"cameraOnSurface",void 0),u([f({constructOnly:!0})],Oo.prototype,"focus",void 0),u([f({constructOnly:!0})],Oo.prototype,"viewState",void 0),u([f({constructOnly:!0})],Oo.prototype,"terrain",void 0),u([f()],Oo.prototype,"tiles",void 0),u([f()],Oo.prototype,"tileSize",void 0),u([f({readOnly:!0})],Oo.prototype,"tilingScheme",null),u([f()],Oo.prototype,"filterExtent",null),u([f({readOnly:!0})],Oo.prototype,"_filterExtentRect",null),u([f({readOnly:!0})],Oo.prototype,"_rootTileIds",null),u([f({value:!1})],Oo.prototype,"suspended",null),u([f({readOnly:!0})],Oo.prototype,"updating",null),Oo=u([L("esri.views.3d.layers.support.FeatureTileTree3D")],Oo);let Nn=class extends Ne{constructor(e){super(e),this._propertiesPool=new Sy({camera:Jr},this),this._lastSeenCameraProjectionValues=new Jr,this.mode=Di.ANIMATING,this._cssCamera=new Jr,this._camera=new Jr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.constraints=new xg({state:this}),this.events=new ns,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}reset(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Sy({camera:Jr},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===ct.Global){const e=xr(this.spatialReference).radius;this.camera=new Jr({eye:Qe(4*e,0,0),center:Qe(e,0,0),up:Qe(0,0,1)})}else this.camera=new Jr({eye:Qe(0,0,100),center:Qe(0,0,0),up:Qe(0,1,0)})}get animation(){return this.cameraController instanceof i3&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/n),e.width=Math.round(r/n),e}get camera(){return this._camera}set camera(e){e!==dh&&dh.copyFrom(e),dh.computeUp(this.viewingMode),this.events.emit("before-camera-change",dh);const i=this._camera;if(ymt(this._lastSeenCameraProjectionValues,dh)&&(this._lastSeenCameraProjectionValues.copyFrom(dh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(dh)&&(this._camera=this._propertiesPool.get("camera").copyFrom(dh),this._cameraChanged=!i.almostEquals(dh),this._cameraChanged)){const r=Z_e(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Di.IDLE}get updating(){return this.mode!==Di.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===ct.Global}get isLocal(){return this.viewingMode===ct.Local}get viewingMode(){return G9(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get navigating(){var e;return!!((e=this.cameraController)!=null&&e.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var i;this.stopActiveCameraController()?((i=this.cameraController)==null||i.destroy(),e&&(this.removeHandles(xpe),this.addHandles(Kl(()=>e.state===sn.Finished||e.state===sn.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),xpe),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=sn.Rejected)}switchCameraController(e){this.cameraController=e}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();dh.copyFrom(this._get("camera")),e(dh),this.camera=dh,this._processingUpdates=!1,this._processUpdateQueue()}};u([f({constructOnly:!0})],Nn.prototype,"view",void 0),u([f()],Nn.prototype,"mode",void 0),u([f({readOnly:!0,type:uC})],Nn.prototype,"animation",null),u([f({type:Jr})],Nn.prototype,"cssCamera",null),u([f()],Nn.prototype,"_cssCamera",void 0),u([f({type:Jr})],Nn.prototype,"camera",null),u([f()],Nn.prototype,"_camera",void 0),u([f({readOnly:!0})],Nn.prototype,"pixelRatio",null),u([f()],Nn.prototype,"rasterPixelRatio",void 0),u([f()],Nn.prototype,"contentPixelRatio",void 0),u([f({readOnly:!0})],Nn.prototype,"alignPixelEnabled",null),u([f({readOnly:!0})],Nn.prototype,"updating",null),u([f({})],Nn.prototype,"_contentCamera",void 0),u([f({type:Jr})],Nn.prototype,"contentCamera",null),u([f({readOnly:!0})],Nn.prototype,"fixedContentCamera",null),u([f({readOnly:!0})],Nn.prototype,"events",void 0),u([f({readOnly:!0})],Nn.prototype,"isGlobal",null),u([f({readOnly:!0})],Nn.prototype,"isLocal",null),u([f({readOnly:!0})],Nn.prototype,"viewingMode",null),u([f()],Nn.prototype,"navigating",null),u([f()],Nn.prototype,"stationary",null),u([f()],Nn.prototype,"_cameraChanged",void 0),u([f()],Nn.prototype,"cameraController",null),Nn=u([L("esri.views.3d.state.ViewState")],Nn);const gmt=Nn;function ymt(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[yi.TOP]!==e.padding[yi.TOP]||t.padding[yi.RIGHT]!==e.padding[yi.RIGHT]||t.padding[yi.BOTTOM]!==e.padding[yi.BOTTOM]||t.padding[yi.LEFT]!==e.padding[yi.LEFT]}const dh=new Jr,xpe="ViewStateHandles";function hRe(t){return t?Tmt:Emt}function _mt(t,e){return e!=null&&e.mode?e.mode:hRe(t).mode}function vmt(t,e){return e??hRe(t)}function dRe(t,e){return _mt(t==null||(t.hasZ??!1),e)}function vVt(t,e){return vmt(t==null||(t.hasZ??!1),e)}function wVt(t){const e=pRe(t);return dRe(t.geometry,e)}function bVt(t){const e=pRe(t),i=dRe(t.geometry,e),r=e!=null&&i!=="on-the-ground"?mRe(e):0,n=e==null?void 0:e.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:n}}function xVt(t){return bmt(t)||wmt(t)}function wmt(t){var e;return((e=t==null?void 0:t.featureExpressionInfo)==null?void 0:e.expression)==="0"}function bmt(t){if(!t||t.mode==="on-the-ground")return!1;const e=t!=null&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function pRe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function Fte(t,e){if(!(t!=null&&t.offset))return 0;const{offset:i,unit:r}=t;if(r==="decimal-degrees")return 0;const n=r!=="unknown"&&r?r:"meters",s=vke(e);return s?Zr(i,n,s):0}function SVt(t,e,i){if(!(i!=null&&i.mode))return;const r=t.hasZ?t.z:0,n=Fte(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-n;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+n);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+n)}}function TVt(t,e,i,r=null){return fRe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function EVt(t,e,i,r,n=null){return fRe(t,e[0],e[1],e.length>2?e[2]:0,i,r,n)}function fRe(t,e,i,r,n,s,o=null){if(s==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=xmt(e,i,r,n,t,s);return Smt(l,e,i,r,n,t,o,a)}function xmt(t,e,i,r,n,s){const o=Fte(s,r);switch(s.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=n.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=n.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=n.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+a+o,elevation:a}}}}function Smt(t,e,i,r,n,s,o,a){const l=Fte(o,n);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((s.elevationProvider.getElevation(e,i,r,n,"ground")??0)+l);case"relative-to-scene":return t-((s.elevationProvider.getElevation(e,i,r,n,"scene")??0)+l)}}function CVt(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function MVt(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function $Vt(t,e,i){return(i==null?void 0:i.mode)===e?`${t} do not support ${e} elevation mode`:null}function OVt(t,e){return(e==null?void 0:e.featureExpressionInfo)!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function AVt(t,e){e&&t.warn(".elevationInfo=",e)}function mRe(t){return((t==null?void 0:t.offset)??0)*yOe(t==null?void 0:t.unit)}const Tmt={mode:"absolute-height",offset:0},Emt={mode:"on-the-ground",offset:null},Cmt="OBJECTID";let RVt=class extends Y3{constructor(e,i,r,n){super(i,r),this.point=e,this.createGraphic=n}};function gRe(t){return wd(t)&&t.intersector===on.PCL&&!!t.target}let PVt=class extends dTe{constructor(e,i,r,n,s){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=n,this.triangleNr=s}},DVt=class extends Y3{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},FVt=class extends Y3{constructor(e,i){super(e,null),this.createTiles3DGraphic=i}};function uV(t){return wd(t)&&t.intersector===on.I3S&&!!t.target}function yRe(t){return wd(t)&&t.intersector===on.VOXEL&&!!t.target}function Mmt(t){return wd(t)&&t.intersector===on.TILES3D&&!!t.target}function $mt(t){return wd(t)&&t.intersector===on.TERRAIN&&!!t.target}let Omt=class extends Y3{constructor(e,i,r){super(e,i),this.triangleNr=r}};function _Re(t){return wd(t)&&t.intersector===on.OVERLAY&&!!t.target}function vRe(t,e){var i,r;return lz(t)||cz(t)?f3((i=t.target)==null?void 0:i.object,e):$mt(t)?(r=e.map)==null?void 0:r.ground:gRe(t)||uV(t)||_Re(t)||yRe(t)?f3(t.target,e):null}function zVt(t,e){const i=kte(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function kte(t,e){var i;if(t==null)return null;if(lz(t)||cz(t))return Spe((i=t.target)==null?void 0:i.object,e);if(gRe(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(yRe(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(Mmt(t)){const r=t.target.createTiles3DGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return _Re(t)||Pte(t)?Spe(t.target,e):uV(t)?Amt(t.target,e):null}function Spe(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const i=f3(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(n=>n.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function Amt(t,e){const i=f3(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?Imt(r.getGraphicFromIntersectorTarget(t)):null}function Rmt(t,e){const i=f3(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function Imt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function f3(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(i=>i.uid===t.layerUid)}function VVt(t,e){if(lz(t)||cz(t))return uy(t.target.object.boundingVolumeWorldSpace.bounds);if(Pte(t)){F1e(xD,t.transformation);const i=Math.max(xD[0],xD[1],xD[2]);return t.target.baseBoundingSphere.radius*i}if(uV(t)){const i=Rmt(t.target,e);return i?.5*eEe(i):null}return null}function BVt(t){return!lz(t)&&!cz(t)&&(Pte(t)?t.target.numLodLevels>1:!!uV(t))}const xD=A();async function Pmt(t,e,i,r){const n=i?xRe(t,i):r,s=ds(e.x,e.y);n.requiresGroundFeedback=!0,n.enableDraped=!0;const o=pd(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=Go.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(s,o,n);const a=Dmt(t,o.results.all,n.graphics),l=o.results.ground,c=vRe(l,t),h=c!=null&&"type"in c&&IR(c.type)?c:null,p={screenPoint:e,results:a,ground:{mapPoint:k2(t,l),distance:wd(l)?l.distanceInRenderSpace:0,layer:h}};return Cn.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(p.intersector=o),p}function Lmt(t,e,i,r){var h,p,g,y,w;const n=i?xRe(t,i):r,s=!(!((h=n.graphics)!=null&&h.include)&&!((p=n.graphics)!=null&&p.exclude)),o=!(!((g=n.mediaElements)!=null&&g.include)&&!((y=n.mediaElements)!=null&&y.exclude)),a=Mp(e);n.enableDraped=n.include&&!n.include.has(Pv)||((w=n.exclude)==null?void 0:w.has(Pv));const l=t.sceneIntersectionHelper,c=pd(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=s||o?Go.ALL:Go.MIN,c.options.excludeLabels=(i==null?void 0:i.excludeLabels)??!1,l.intersectIntersectorScreen(a,c,n),s||o){for(const b of c.results.all){const x=kte(b,t);if(x==null||s&&(x.type!=="graphic"||wRe(n.graphics,x.graphic))||o&&(x.type!=="media"||bRe(n.mediaElements,x.element)))return k2(t,b)}return null}return k2(t,c.results.min)}function Dmt(t,e,i){const r=new Array;let n=null;for(let s=0;s<e.length;s++){const o=e[s],a=vRe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&IR(a.type)))break;const l=kte(o,t);if(l==null)continue;if(l.type==="graphic"){if(n==null&&s!==e.length-1&&(n=new Set),n!=null){const p=Ute(l.graphic);if(n.has(p))continue;n.add(p)}if(!wRe(i,l.graphic))continue}const c=k2(t,o),h=o.distanceInRenderSpace;if(l.type==="media"){const p=l.element.toSource(c);r.push({...l,mapPoint:c,distance:h,sourcePoint:p})}else r.push({...l,mapPoint:c,distance:h})}return r}function k2(t,e,i){return e.getIntersectionPoint(U2)?(i=tY(t,U2,i),e.intersector===on.TERRAIN&&t.basemapTerrain&&(i.z=am(t.basemapTerrain,i)??0),i):null}function Ute(t){var n;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const s=r.objectIdField??Cmt,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}function wRe(t,e){return bRe(t,Ute(e))}function bRe(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function tY(t,e,i){let r=t.spatialReference||nt.WGS84;return tc(e,t.renderSpatialReference,U2,r)?e=U2:(r=nt.WGS84,tc(e,t.renderSpatialReference,U2,r)&&(e=U2)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new wt(e,r),i}function xRe(t,e){const i=iY(t,e.include,xC.INCLUDE),r=iY(t,e.exclude,xC.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function iY(t,e,i,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!e)return r;if(e instanceof qc)Nmt(r,Ute(e)),i===xC.INCLUDE&&(t.graphicsView!=null&&e.layer===t?kS(r,t.graphicsView.processor.layer.id):e.layer&&kS(r,e.layer.uid));else if("layer"in e&&"element"in e)Fmt(r,e.element),i===xC.INCLUDE&&kS(r,e.layer.uid);else if(TH(e))for(const n of e)n===t.graphics&&t.graphicsView!=null?kS(r,t.graphicsView.processor.layer.id):n===t.map.ground?kS(r,Pv):iY(t,n,i,r);else"uid"in e&&kS(r,e.uid);return r}function kS(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function Nmt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function Fmt(t,e){t.mediaElements||(t.mediaElements=new Set),t.mediaElements.add(e)}const U2=A();var xC;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(xC||(xC={}));let kmt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new mi,this._tolerance=nC,this._tmpRay=zs(),this._tmpRegion=Zi(),this._validateHUDIntersector=pd(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),Tpe(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,Tpe(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,n){return i.options.selectionMode=!1,i.options.store=Go.MIN,this.computeIntersection(e,i,n),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,n=.5){return e.getRenderCenter(TD,r,n),TD[0]+=.0466,TD[1]-=.0123,xee(e,TD,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const n=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||wd(n)&&n.intersector!==on.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=nC){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===on.TERRAIN?1:r.type===on.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===on.TERRAIN?1:r.type===on.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return bee(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==ct.Local||e==null||xe(i,e.origin,Me(et.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,n)}_intersectElevation(e,i,r=0,n=null){if(e==null)return null;const s=this._view,{renderCoordsHelper:o}=s,a=AR(s.spatialReference),l=i!=null?i.mode:"absolute-height",c=mRe(i)/a,h=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:p}=s.state;if(l==="absolute-height"){const R=o==null?void 0:o.getAltitude(p.eye),I=Te(Me(N$,e.direction),o.worldUpAtPosition(p.eye,Vmt));if(R<h&&I<0||R>=h&&I>0)return null;if(o.intersectInfiniteManifold(e,h,N$)){const P=tY(s,N$);return P.z??(P.z=0),P.z-=c,P}return null}const g=et.get();p.projectToRenderScreen(e.origin,g);const y=new Epe(null,this._forEachLayer),{slicePlane:w}=s,b=w!=null?Ule(w):null,x=pd(this.viewingMode);x.options.store=Go.MIN,x.options.verticalOffset=h,x.options.normalRequired=!1;const T=e.origin,M=xe(et.get(),T,e.direction);x.reset(T,M,p),x.point=g;const $=n?"type"in n&&n.type==="graphics"?R=>R.layerUid!==n.uid:R=>R.graphicUid!==n.uid:null;switch(l){case"relative-to-scene":{const R=I=>(!$||$(I))&&!!I.lastValidElevationBB;x.intersect(y.layers,g,this._tolerance,null,R),this._externalIntersectionHandlers.forAll(I=>{if(I.type===on.I3S||I.type===on.TERRAIN||I.type===on.TILES3D){const P=I.slicePlaneEnabled?b:null;I.intersect(x,P,x.rayBegin,x.rayEnd,g)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(R=>{if(R.isGround){const I=R.slicePlaneEnabled?b:null;R.intersect(x,I,x.rayBegin,x.rayEnd,g)}})}if(x.results.min.getIntersectionPoint(N$)){const R=tY(s,N$);return R.z=r,R}return null}computeIntersection(e,i,r,n){var b;if(e==null)return;const s=this._view.state.camera,o=et.get();s.projectToRenderScreen(e.origin,o);const a=new Epe(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=e.origin,c=xe(et.get(),e.origin,e.direction);i.reset(l,c,s),i.intersect(a.layers,o,this._tolerance);const h=this._view.slicePlane,p=h!=null?Ule(h):null;i.intersect(a.sliceableLayers,o,this._tolerance,p);const g=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(x=>{const T=x.layerUid,M=Array.isArray(T),$=M?T:[T];M&&(i.options.filteredLayerUids=[]);let R=!1;for(const I of $)a.filterLayerUid(I)?R=!0:M&&i.options.filteredLayerUids.push(I);if(i.options.isFiltered=!R,x.isGround&&g||!i.options.isFiltered){const I=x.slicePlaneEnabled?p:null;x.intersect(i,I,l,c,o,n)}});const y=et.get(),w=this._view.basemapTerrain;if(r&&r.enableDraped&&w.spatialReference!=null&&i.results.ground.getIntersectionPoint(y)){const x=w.overlayManager.renderer,T=this._view.renderCoordsHelper.spatialReference,M=et.get();this._view.renderCoordsHelper.fromRenderCoords(y,M,w.spatialReference),M[2]=((b=this._view.elevationProvider)==null?void 0:b.getElevation(y[0],y[1],y[2],T,"ground"))??0,x.intersect(i,M,i.results.ground,$=>a.filterRenderGeometry($))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;xv(this._tmpRegion,x9);const r=this._view.state.camera,n=[],s=this._tmpRegion,o=T=>{const M=new zmt(T),$=M.result.target.object.geometries.every(R=>R.material instanceof Xz&&R.material.parameters.occlusionTest);n.push({item:M,occlusionTest:$}),$&&(r.projectToRenderScreen(T.target.center,M.screenPoint),M.screenPoint[0]=Math.floor(M.screenPoint[0]),M.screenPoint[1]=Math.floor(M.screenPoint[1]),aVe(s,M.screenPoint))};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const T of i.all)i.min.target.object!==T.target.object&&i.max.target.object!==T.target.object&&o(T);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,s[0]-tA),h=Math.max(0,s[1]-tA),p=Math.min(Va(s)+2*tA,a-c),g=Math.min(Uc(s)+2*tA,l-h),y=p>0&&g>0?new Uint8Array(p*g*4):null;y&&this._view._stage.renderer.readHUDVisibility(c,h,p,g,y);let w=!0;const b=e.results.max.dist==null;let x=0;for(const{item:T,occlusionTest:M}of n){let $=!M;if(M&&y)for(const R of Umt){const I=4*(Math.min(T.screenPoint[0]+R[0],a)-s[0]+(Math.min(T.screenPoint[1]+R[1],l)-s[1])*p);if(I>=0&&I<y.length&&y[I]){$=!0;break}}$&&(w&&(e.results.min.copy(T.result),w=!1),b&&e.results.max.copy(T.result),e.options.store===Go.ALL&&e.results.all.splice(x++,0,T.result))}}};const tA=1,Umt=(()=>{const t=[],e=tA;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let zmt=class{constructor(e){this.result=e,this.screenPoint=Ip()}},SD;function Tpe(t){return SD&&SD.viewingMode===t||(SD=pd(t)),SD}let Epe=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Cpe(t){return typeof t=="object"&&"intersect"in t}const N$=A(),Vmt=A(),TD=Ip();let qVt=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,n,s){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,s,r,n)}},Bmt=class{constructor(e,i,r,n){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(xt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(kc);else for(const i of this._queries)i.result.reject(ki())}queryElevation(e,i,r,n=0){const s=Ho(),o={x:e,y:i,minDemResolution:n,result:s,signal:r};return this._queries.push(o),_a(r,()=>{eU(this._queries,o),s.reject(ki())}),s.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void e.madeProgress();const n=i.map(h=>[h.x,h.y]),s=i.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new kC({points:n,spatialReference:this.spatialReference}),a=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let h=0;i.forEach(p=>_a(p.signal,()=>{h++,p.result.reject(ki()),h===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};r.queryElevation(o,c).then(h=>{i.forEach((p,g)=>{p.signal!=null&&p.signal.aborted?p.result.reject(ki()):p.result.resolve(h.geometry.points[g][2])})}).catch(h=>{i.forEach(p=>p.result.reject(h))}),e.madeProgress()}get test(){}},Pk=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},iA=class extends ns.EventedMixin(Ne){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=Ye(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,i,r,n,s){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&xs(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=ED(o,this._im,e,i,r,n,s),o==null&&(o=ED(o,this._ground,e,i,r,n,s)),s==="scene"&&(o=ED(o,this._scene,e,i,r,n,s)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:n,queryContext:s,result:o}),o}getSphereElevationBounds(e,i,r){const n=new Pk;function s(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,i,r);l!=null&&n.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return s(this._ground),s(this._im),r==="scene"&&s(this._scene),n}getRootElevationBounds(){const e=new Pk;for(const i of[this._im,this._ground,this._scene])i.forEach(r=>{if(r.getRootElevationBounds){const n=r.getRootElevationBounds();n!=null&&e.expandElevationRangeValues(n.elevationRangeMin,n.elevationRangeMax)}});return e}async queryElevation(e,i,r,n,s,o=null,a=0){const l=this._getElevationQuery(n);try{const c=await l.queryElevation(e,i,o,a);return s==="scene"?ED(c,this._scene,e,i,r,n,s):c}catch(c){return Pc(c),this.getElevation(e,i,r,n,s)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&xs(e,i.spatialReference))return i;i==null||i.destroy({completeTasks:!0});const{wkid:r,wkt:n,wkt2:s,latestWkid:o}=e,a=new Bmt(this.view.resourceController.scheduler,new nt({wkid:r,wkt:n,wkt2:s,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function ED(t,e,i,r,n,s,o){for(const a of e){const l=a.getElevation(i,r,n,s,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([f({constructOnly:!0})],iA.prototype,"view",void 0),u([f()],iA.prototype,"spatialReference",null),iA=u([L("esri.views.3d.support.CombinedElevationProvider")],iA);let m3=class rY{static isValidProfile(e){return e in rY.profiles}static getDefaultProfile(){return pe("esri-iPhone")?"low":"medium"}static apply(e,i){const r=rY.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const n=i.sceneService.object,s=r.sceneService.object;n.lodFactor=s.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};m3.test={reset(){const t=SRe();for(const e of Object.keys(t))m3.profiles[e]=t[e]}};const F$={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function SRe(){const t=!!pe("esri-mobile"),e=!!pe("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+F$.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!pe("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+F$.GalaxyS20:750+F$.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!pe("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+F$.SurfacePro7:1500+F$.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=SRe()})(m3||(m3={}));const HF=m3,jmt=new mt("cyan"),Gmt=1,Hmt=.25,TRe=new mt("black"),ERe=.4,CRe=.2,qmt=.25,Lk="default",Wmt="temporary",Zmt=new mt("yellow"),rv=8;let Iw=class extends Ne{constructor(e){super(e),this.color=jmt.clone(),this.haloOpacity=Gmt,this.fillOpacity=Hmt}equals(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity}};u([f({type:mt})],Iw.prototype,"color",void 0),u([f({type:mt})],Iw.prototype,"haloColor",void 0),u([f()],Iw.prototype,"haloOpacity",void 0),u([f()],Iw.prototype,"fillOpacity",void 0),Iw=u([L("esri.views.support.HighlightOptions")],Iw);const Ymt=Iw;var nY;let BT=nY=class extends Ymt{constructor(t){super(t),this.shadowColor=TRe.clone(),this.shadowOpacity=ERe,this.shadowDifference=CRe}equals(t){return this===t||super.equals(t)&&this.shadowColor.equals(t.shadowColor)&&this.shadowOpacity===t.shadowOpacity&&this.shadowDifference===t.shadowDifference}clone(){var t;return new nY({...this,color:this.color.clone(),haloColor:(t=this.haloColor)==null?void 0:t.clone(),shadowColor:this.shadowColor.clone()})}};u([f({type:mt})],BT.prototype,"shadowColor",void 0),u([f()],BT.prototype,"shadowOpacity",void 0),u([f()],BT.prototype,"shadowDifference",void 0),BT=nY=u([L("esri.views.3d.support.HighlightOptions")],BT);const wE=BT;var sY;let ay=sY=class extends Ne{constructor(t){super(t)}clone(){return new sY({name:this.name,options:this.options.clone()})}};u([f({type:String,constructOnly:!0})],ay.prototype,"name",void 0),u([f({type:wE})],ay.prototype,"options",void 0),ay=sY=u([L("esri.views.3d.support.HighlightGroup")],ay);const Mpe=ot.ofType(ay);function Xmt(){return pe("enable-feature:multiple-highlights")?new Mpe([new ay({name:Lk,options:new wE}),new ay({name:Wmt,options:new wE({color:Zmt})})]):new Mpe([new ay({name:Lk,options:new wE})])}var Qt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Qt||(Qt={}));const jT=[Qt.ELEVATION,Qt.MAP];async function Jmt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],n=(r.distance??0)*(1+Qmt),s=i.results.findIndex(o=>(o.distance??0)>n);return s!==-1&&(i.results=i.results.slice(0,s)),r&&i.ground.distance>n&&(i.ground.mapPoint=null),i}const Qmt=.05;async function Kmt(t,e){var g,y,w,b,x;const{results:i,ground:r}=await Jmt(t,e),n=(!r.layer||!IR(r.layer.type))&&r.mapPoint,s=[],o=igt(t),a=n?egt(t,o):tgt;let l=0,c=0;const h=()=>{const T=a.layerViews[c];n&&T&&"fetchPopupFeaturesAtLocation"in T&&s.push({mapPoint:r.mapPoint,layerView:T}),++c};let p=null;for(;l<i.length||c<a.layerViews.length;){const T=i[l];if(T&&T.type!=="graphic")++l;else if(((g=T==null?void 0:T.layer)==null?void 0:g.type)!=="scene"||((y=T==null?void 0:T.layer)==null?void 0:y.parent)!==((w=t==null?void 0:t.map)==null?void 0:w.basemap))if(T){const M=(b=T.layer)==null?void 0:b.uid,$=a.layerUids.has(M)&&T.distance===r.distance,R=o.get((x=T.layer)==null?void 0:x.uid);if(p??(p=T.mapPoint),c<a.layerViews.length&&($||(T.distance??0)>r.distance)&&a.layerViews[c]!==R){h();continue}s.push({graphic:T.graphic,layerView:R}),++l}else h();else++l}return p??(p=r.mapPoint),{hits:s,location:p}}function egt(t,e){const i=new Set,r=[];for(let s=t.basemapTerrain.numLayers(Qt.MAP)-1;s>=0;s--){const o=t.basemapTerrain.layerViewByIndex(s,Qt.MAP);i.add(o.layer.uid),r.push(o)}const n=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:s}of n){const o=e.get(s);o&&(i.add(s),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}const tgt={layerUids:new Set,layerViews:[]};function igt(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let wu=class extends Ne{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};u([f()],wu.prototype,"minTotalNumberOfFeatures",void 0),u([f()],wu.prototype,"maxTotalNumberOfFeatures",void 0),u([f()],wu.prototype,"maxNumberOfDrawCalls",void 0),u([f()],wu.prototype,"maxTotalNumberOfVertices",void 0),u([f()],wu.prototype,"snapshotAvailable",void 0),u([f()],wu.prototype,"polygonLodFactor",void 0),u([f()],wu.prototype,"polylineLodFactor",void 0),u([f()],wu.prototype,"skipHighSymbolLods",void 0),u([f()],wu.prototype,"uncompressedTextureDownsamplingEnabled",void 0),wu=u([L("esri.views.3d.support.QualitySettings.Graphics3DSettings")],wu);let Up=class extends Ne{constructor(){super(...arguments),this.lodFactor=1}};u([f()],Up.prototype,"lodFactor",void 0),Up=u([L("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Up);let jg=class extends Ne{constructor(){super(...arguments),this.object=new Up,this.point=new Up,this.integratedMesh=new Up,this.pointCloud=new Up,this.uncompressedTextureDownsamplingEnabled=!1}};u([f({type:Up})],jg.prototype,"object",void 0),u([f({type:Up})],jg.prototype,"point",void 0),u([f({type:Up})],jg.prototype,"integratedMesh",void 0),u([f({type:Up})],jg.prototype,"pointCloud",void 0),u([f()],jg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),jg=u([L("esri.views.3d.support.QualitySettings.SceneServiceSettings")],jg);let Gg=class extends Ne{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};u([f()],Gg.prototype,"lodBias",void 0),u([f()],Gg.prototype,"angledSplitBias",void 0),u([f()],Gg.prototype,"vtlContentZoom",void 0),u([f()],Gg.prototype,"elevationLevelDelta",void 0),u([f()],Gg.prototype,"reduceTileLevelDifferences",void 0),Gg=u([L("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Gg);let z2=class extends Ne{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([f()],z2.prototype,"pixelRatio",void 0),u([f()],z2.prototype,"maxTotalNumberOfFeatures",void 0),z2=u([L("esri.views.3d.support.QualitySettings.HeatmapSettings")],z2);let Ko=class extends Ne{constructor(){super(...arguments),this.graphics3D=new wu,this.sceneService=new jg,this.tiledSurface=new Gg,this.heatmap=new z2,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([f({type:wu})],Ko.prototype,"graphics3D",void 0),u([f({type:jg})],Ko.prototype,"sceneService",void 0),u([f({type:Gg})],Ko.prototype,"tiledSurface",void 0),u([f({type:z2})],Ko.prototype,"heatmap",void 0),u([f()],Ko.prototype,"fadeDuration",void 0),u([f()],Ko.prototype,"antialiasingEnabled",void 0),u([f()],Ko.prototype,"physicallyBasedRenderingEnabled",void 0),u([f()],Ko.prototype,"highQualityTransparency",void 0),u([f()],Ko.prototype,"highResolutionAtmosphere",void 0),u([f()],Ko.prototype,"reflections",void 0),u([f()],Ko.prototype,"ambientOcclusion",void 0),u([f()],Ko.prototype,"memoryLimit",void 0),u([f()],Ko.prototype,"additionalCacheMemory",void 0),u([f()],Ko.prototype,"frameRate",void 0),u([f()],Ko.prototype,"maximumPixelRatio",void 0),Ko=u([L("esri.views.3d.support.QualitySettings")],Ko);const $pe=Ko;let rgt=class oY{constructor(e,i,r,n){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=n,this._tmpCoordinateSystem=j9e(n),this.referenceEllipsoid=xr(i),this.sphericalPCPF=Iv(i)}set extent(e){e&&G9e(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return H9e(this._coordinateSystem,Zi())}getAltitude(e){return K9e(this._coordinateSystem,e)}setAltitude(e,i,r=e){return BSe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){e7e(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return Y9e(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return X9e(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,wl.X,et.get()),n=this.worldBasisAtPosition(e,wl.Y,et.get()),s=this.worldBasisAtPosition(e,wl.Z,et.get());return Im(i,r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,et.get()),n=this.worldBasisAtPosition(e,wl.Y,et.get()),s=dSe(i,n,r);return vo(s)}intersectManifoldClosestSilhouette(e,i,r){return tj(this._coordinateSystem,i,this._tmpCoordinateSystem),Q9e(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){tj(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=et.get();return J9e(this._tmpCoordinateSystem,e,n)?ye(r,n):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===ct.Global)return this.intersectManifold(e,i,r);tj(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=et.get();return ZC(n.plane,e,s)?ye(r,s):null}toRenderCoords(e,i,r){return j5(e)?ec(e,i,this.spatialReference):tc(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return j5(i)?(r!=null&&(i.spatialReference=r),Tx(e,this.spatialReference,i)?i:null):tc(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case ct.Local:return new oY(ct.Local,i,Ql(i),Z9e());case ct.Global:return new oY(ct.Global,i,1,W9e(i))}}static renderUnitScaleFactor(e,i){return xoe(e)/xoe(i)}};var nm;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(nm||(nm={}));const ngt=(()=>{const t=new Array;return t[nm.ELEVATION]=10,t[nm.BASEMAP]=10,t[nm.I3S_INDEX]=10,t[nm.I3S_DATA]=10,t[nm.SYMBOLOGY]=5,t})(),sgt=30,aY=-3,MRe=aY-1;var vp;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(vp||(vp={}));let ogt=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=agt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r,n=0){this._storage.put(this,e,i,r,n)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},$Re=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new mi,this._users=new mi}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){const r=this._db.get(e.id+i);return(r==null?void 0:r.size)??0}put(e,i,r,n,s){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,o.size,vp.ALL)),n>this._maxSize)return void this._notifyRemove(i,r,n,vp.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${i}`),void this._notifyRemove(i,r,0,vp.ALL);const a=1+Math.max(s,MRe)-aY;this._db.set(i,new lgt(r,n,a)),this._size+=n,e.size+=n,this._checkSize()}updateSize(e,i,r,n){i=e.id+i;const s=this._db.get(i);if(s&&s.entry===r){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const o=this._notifyRemove(i,r,n,vp.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);n=o}s.size=n,this._size+=n,e.size+=n,this._checkSize()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r==null?void 0:r.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:p}=c;if(a.startsWith(h)){const g=i[p]||0;i[p]=g+o.size}})});const n={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(i);s.sort((o,a)=>i[a]-i[o]),s.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+n[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+aY-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,n)=>{n.startsWith(i)&&(this._size-=r.size,this._db.delete(n),this._notifyRemove(n,r.entry,r.size,vp.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,vp.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,n){let s;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](i,n,r);return typeof a=="number"&&(s=a),!0}return!1}),s}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const i=e??this;if(i.maxSize<0||i.size<=i.maxSize)return;const r=e==null?void 0:e.id;let n=!0;for(;n;){n=!1;for(const[s,o]of this._db)if(o.lifetime===0&&(!r||s.startsWith(r))){if(this._purgeItem(s,o,e),i.size<=.9*i.maxSize)return;n||(n=this._db.has(s))}}for(const[s,o]of this._db)if((!r||s.startsWith(r))&&(this._purgeItem(s,o,e),i.size<=.9*i.maxSize))return}_purgeItem(e,i,r=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const n=this._notifyRemove(e,i.entry,i.size,vp.SOME);n!=null&&n>0&&(this._size+=n,r&&(r.size+=n),i.lives=i.lifetime,i.size=n,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},agt=0,lgt=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}};function cgt(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function ugt(t){return new cl({view:t})}const Ope=.1,CD=1,t8=1,hgt=.75,dgt=.6,Ape=1.3;let cl=class extends Ne{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new $Re,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(Ub({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(CD),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new ogt(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<dgt&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(CD)):e?(this._memoryPredicted>1.1*t8||this._usedMemory>t8)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>Ope&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Ape),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>t8?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Ape),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<hgt&&this._quality<CD?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,Ope),CD))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l,c,h,p;if(!this.view)return;(l=(a=this.view._stage)==null?void 0:a.renderer)==null||l.tick();const e=(h=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:h.usedMemory;let i=(((p=this.view.basemapTerrain)==null?void 0:p.usedMemory)??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(g=>{if(cgt(g)){const y=g.ignoresMemoryFactor?this._quality:1;i+=g.usedMemory*y,r+=g.unloadedMemory*y}});const n=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(i>s&&n){this._warnMemoryUsage=i;const g=w=>(w/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",y=Math.round(100*this._quality);de.getLogger(this).warn(`Memory Limit exceeded! Limit: ${g(s)} Current: ${g(i)} Projected: ${g(i+r)} Quality: ${y}%`)}this._usedMemory=i/s,this._memoryPredicted=(i+r)/s;const o=s-i;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};u([f({constructOnly:!0})],cl.prototype,"view",void 0),u([f()],cl.prototype,"maxMemory",null),u([f()],cl.prototype,"additionalCacheMemory",null),u([f({readOnly:!0})],cl.prototype,"memoryFactor",null),u([f({readOnly:!0})],cl.prototype,"updating",null),u([f({readOnly:!0})],cl.prototype,"usedMemory",null),u([f({readOnly:!0})],cl.prototype,"usedCacheMemory",null),u([f()],cl.prototype,"_quality",void 0),u([f()],cl.prototype,"_usedMemory",void 0),u([f()],cl.prototype,"_updating",void 0),u([f()],cl.prototype,"_stableQuality",void 0),u([f()],cl.prototype,"_maxMemory",void 0),u([f()],cl.prototype,"_additionalCacheMemory",void 0),cl=u([L("esri.views.3d.support.MemoryController")],cl);let pgt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},fgt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new mgt}},mgt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},ggt=class{constructor(e,i,r,n){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=n.map(s=>new fgt(s))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,n)=>this._taskCallback(r,n))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,St(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},ygt=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function GT(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function ORe(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function ARe(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function hV(t){return t!=null&&"type"in t&&t.type==="image+type"}let qF=class extends Ne{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new ggt((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,i),r&&(this._frameTask=r.registerTask(xt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Sr(this._frameTask),this._tasks.forEach(e=>jc(e.abortController)),this._loadQueue=Ye(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,n={}){const s=Ho();s.__signal=n!=null?n.signal:null;const o=this._createOrUpdateTask(e,i,r,n,s);return _a(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,i,r,n,s,o){const a=new wgt(e,i,r,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;wR(e.resolvers,i),i.reject(ki()),e.resolvers.length===0&&(e.status===Rh.DOWNLOADING&&(e.status=Rh.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=Rh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,n,s){const o=bgt((n==null?void 0:n.uid)||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,i,r,o,s)}_doneLoadingCB(e,i){this._loadQueue&&(St(e.status===Rh.DOWNLOADING),e.status=Rh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();zt(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Rh.DOWNLOADED&&(i.err=i.err||ki()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!Bn(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=hV(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(i)Bn(i)?n.reject(i):n.reject(new Y("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const s=r>0?te(e.result):e.result;n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Rh.CANCELLED)return!1;let r,n;switch(e.startTime=performance.now(),e.status=Rh.DOWNLOADING,e.docType){case"binary":n="array-buffer",r=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Br(e.url,{...e.options,responseType:n,timeout:r,signal:s});const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},a=l=>{e.status===Rh.DOWNLOADING&&i(e,l)};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=vgt(c);if(n="image",e.size=c.byteLength,h==="unknown")return e.request=Br(e.url,{responseType:n,timeout:r,signal:s}),void e.request.then(y=>o(y.data),a);const p=new Blob([c],{type:h}),g=window.URL.createObjectURL(p);e.request=Br(g,{responseType:n,timeout:r,signal:s}),e.request.then(y=>o(new ygt(y.data,h)),a).finally(()=>window.URL.revokeObjectURL(g))},a),!0)}get test(){}};u([f({readOnly:!0})],qF.prototype,"updating",void 0),qF=u([L("esri.views.3d.support.StreamDataLoader")],qF);const _gt={numRetries:0};function vgt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let wgt=class extends pgt{constructor(e,i,r,n,s){super(n),this.url=e,this.options=i,this.docType=r,this.key=s,this.result=null,this.status=Rh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=_gt.numRetries}};function bgt(t,e,i){return`${t}:${e}:${i}`}var Rh;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Rh||(Rh={}));let WF=class extends Ne{constructor(){super(...arguments),this.updating=!1}};function xgt(t){return new np({view:t})}u([f({readOnly:!0})],WF.prototype,"updating",void 0),WF=u([L("esri.views.3d.support.ResourceController.ResourceControllerMain")],WF);let np=class extends WF{constructor(){super(...arguments),this._immediateTask=QE,this._normalTask=QE,this._updatingObjects=Xl([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=KGe(),this._memoryController=ugt(this.view),this._streamDataLoader=new qF,this._streamDataLoader.setup(sgt,ngt,this._scheduler),this.addHandles([oe(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},xi),oe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Ub({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(xt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(xt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Sr(this._frameTask),this._streamDataLoader=Ye(this._streamDataLoader),this._memoryController=Ye(this._memoryController),this._scheduler=Ye(this._scheduler),this.view=null}get updating(){var e,i,r,n;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)||((n=this._updatingObjects)==null?void 0:n.value.some(s=>s.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,n,s)=>i.request(r,n,e,s),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Ui(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(U_e(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};u([f()],np.prototype,"view",void 0),u([f()],np.prototype,"_scheduler",void 0),u([f()],np.prototype,"_memoryController",void 0),u([f()],np.prototype,"_streamDataLoader",void 0),u([f()],np.prototype,"_immediateTask",void 0),u([f()],np.prototype,"_normalTask",void 0),u([f()],np.prototype,"_updatingObjects",void 0),u([f({readOnly:!0})],np.prototype,"updating",null),np=u([L("esri.views.3d.support.ResourceController")],np);let yBt=class{constructor(e,i=0,r=0,n=0,s=0,o=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=n,this.nodes=s,this.core=o}};function Sgt(t){return"performanceInfo"in t}let Tgt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},Egt=class{constructor(e){var i,r,n,s;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const o=e.resourceController.memoryController;this.totalMemory=(o.maxMemory??0)*o3.MEGABYTES,this.usedMemory=Math.round(o.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=o.usedCacheMemory}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0,this.edgesMemory=((r=e._stage)==null?void 0:r.renderer.usedMemory.edges)??0,this.fboMemory=((n=e._stage)==null?void 0:n.renderer.usedMemory.fbos)??0,(s=e.allLayerViews)==null||s.items.forEach(o=>{Sgt(o)&&this.layerPerformanceInfos.push(new Tgt(o))}),this.layerPerformanceInfos.sort((o,a)=>a.memory-o.memory)}},Cgt=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return Rm(e)?(zt(i),Cve(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await Br(i,{responseType:Mgt[e]})).data;const n=await Xp(this._streamDataRequester.request(i,e,r));if(n.ok===!0)return n.value;throw Pc(n.error),new Y("glt-loader-request-error",`Request for resource failed: ${n.error}`)}};const Mgt={image:"image",binary:"array-buffer",json:"json","image+type":void 0},Eg=()=>de.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function $gt(t,e){const i=await Ogt(t,e),r=await Pgt(i.textureDefinitions??{},e);let n=0;for(const s in r)if(r.hasOwnProperty(s)){const o=r[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:n+o_e(i)}}async function Ogt(t,e){const i=e==null?void 0:e.streamDataRequester;if(i)return Agt(t,i,e);const r=await Xp(Br(t,e));if(r.ok===!0)return r.value.data;Pc(r.error),RRe(r.error)}async function Agt(t,e,i){const r=await Xp(e.request(t,"json",i));if(r.ok===!0)return r.value;Pc(r.error),RRe(r.error.details.url)}function RRe(t){throw new Y("",`Request for object resource failed: ${t}`)}function Rgt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(Eg().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Eg().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Eg().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(Eg().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else Eg().warn("Indexed geometries must specify faces"),r=!1;break}default:Eg().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(Eg().warn("Geometry requires material"),r=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(Eg().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function xBt(t,e){var w,b;const i=new Array,r=new Array,n=new Array,s=new Oy,o=t.resource,a=GU.parse(o.version||"1.0","wosr");Dgt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},p=t.textures;let g=0;const y=new Map;for(let x=0;x<c.length;x++){const T=c[x];if(!Rgt(T))continue;const M=Lgt(T),$=T.params.vertexAttributes,R=[],I=X=>{if(T.params.topology==="PerAttributeArray")return null;const ge=T.params.faces;for(const ae in ge)if(ae===X)return ge[ae].values;return null},P=$[k.POSITION],N=P.values.length/P.valuesPerElement;for(const X in $){const ge=$[X],ae=ge.values,z=I(X)??pI(N);R.push([X,new Ji(ae,z,ge.valuesPerElement,!0)])}const V=M.texture,U=p&&p[V];if(U&&!y.has(V)){const{image:X,parameters:ge}=U,ae=new Nte(X,ge);r.push(ae),y.set(V,ae)}const B=y.get(V),W=B?B.id:void 0,j=M.material;let Q=s.get(j,V);if(Q==null){const X=h[j.slice(j.lastIndexOf("/")+1)].params;X.transparency===1&&(X.transparency=0);const ge=U&&U.alphaChannelUsage,ae=X.transparency>0||ge==="transparency"||ge==="maskAndTransparency",z=U?IRe(U.alphaChannelUsage):void 0,he={ambient:FR(X.diffuse),diffuse:FR(X.diffuse),opacity:1-(X.transparency||0),transparent:ae,textureAlphaMode:z,textureAlphaCutoff:.33,textureId:W,initTextureTransparent:!0,doubleSided:!0,cullFace:ic.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:(U==null?void 0:U.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(he,e.materialParameters),Q=new vte(he,e),s.set(j,V,Q)}n.push(Q);const Z=new rc(Q,R);g+=((b=(w=R.find(X=>X[0]===k.POSITION))==null?void 0:w[1])==null?void 0:b.indices.length)??0,i.push(Z)}return{engineResources:[{name:l,stageResources:{textures:r,materials:n,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:g,lodThreshold:null}],referenceBoundingBox:Igt(i)}}function Igt(t){const e=fd();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(ix(e,r.bbMin),ix(e,r.bbMax))}),e}async function Pgt(t,e){const i=new Array;for(const s in t){const o=t[s],a=o.images[0].data;if(!a){Eg().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:Tr.REPEAT,t:Tr.REPEAT},preMultiplyAlpha:IRe(h)!==Ks.Opaque},g=e!=null&&e.disableTextures?Promise.resolve(null):Py(l,e);i.push(g.then(y=>({refId:c,image:y,parameters:p,alphaChannelUsage:h})))}const r=await Promise.all(i),n={};for(const s of r)n[s.refId]=s;return n}function IRe(t){switch(t){case"mask":return Ks.Mask;case"maskAndTransparency":return Ks.MaskBlend;case"none":return Ks.Opaque;default:return Ks.Blend}}function Lgt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const Dgt=new GU(1,2,"wosr");let Ngt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const n=r?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):Rpe(this._gltfLoading,this._gltfMemCache,n,async o=>{const{loadGLTF:a}=await fe(()=>import("./loader-9esXmYfu.js"),__vite__mapDeps([255,137]));return a(new Cgt(o.streamDataRequester),e,o,r)},i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,n=this._wosrMemCache.get(r);return n!=null?Promise.resolve(n):Rpe(this._wosrLoading,this._wosrMemCache,r,s=>$gt(e,s),i)}};async function Rpe(t,e,i,r,n){zt(n);const s=_a(n,()=>Fgt(t,i));let o=t.get(i);if(o)o.refCount++;else{const a=new AbortController;o={refCount:1,abortController:a,promise:r({...n,signal:a.signal})},t.set(i,o)}try{const a=await o.promise;return e.put(i,a,a.size),t.delete(i),zt(n),a}finally{Sr(s)}}function Fgt(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i!=null&&i.abortController.abort())}let V2=class extends Ne{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(xt.TEXTURE_UNLOAD))??QE}normalizeCtorArgs(){return{}}destroy(){var e,i,r;super.destroy(),(e=this._frameTask)==null||e.remove(),(i=this._textureRequests)==null||i.forEach(n=>this._releaseTextureRequest(n)),(r=this._textureRequests)==null||r.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let n=this._textureRequests.get(r);if(!n){const s=new LRe;s.texture=i(),this._stage&&(s.texture.load(this._stage.renderView.renderingContext),this._stage.add(s.texture)),this._textureRequests.set(r,s),n=s}return n.referenceCount++,new PRe(r,n.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){var r;if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||((r=i.texture)==null||r.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};u([f()],V2.prototype,"_frameTask",void 0),u([f()],V2.prototype,"updating",null),V2=u([L("esri.views.3d.support.TextureCollection")],V2);let PRe=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},LRe=class{constructor(){this.referenceCount=0}},kgt=class extends V2{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){zt(r);const n=r==null?void 0:r.signal,s=this.makeUid(e,i);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o=new LRe,o.abortController=a;const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(e,h,i);return c.texture=p,c.abortController=null,await p.load(this._stage.renderView.renderingContext),this._stage.add(p),new PRe(s,p,()=>this._release(s))},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await F_e(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,i,r){var s;const n={width:i.width,height:i.height,wrap:{s:Tr.CLAMP_TO_EDGE,t:Tr.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(Ave(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new Nte(i,n)}},Ugt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(nm.SYMBOLOGY),this.objectResourceCache=new Ngt((r,n)=>e.resourceController.memoryController.newCache(r,n)),this.textures=new kgt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=xr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=v$e(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=sot(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Ui();this._graphicsOwners.push(e);const i=oe(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Ui(()=>{i.remove(),wR(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Dy;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([oe(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,xi),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Ye(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;MD.distance=e.centerOnSurfaceInfrequent.distance,MD.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(MD),this.screenSizePerspectiveSettingsLabels.update(MD),this._view._stage.renderView.requestRender()}get test(){}};const MD={distance:0,fovY:0};let HT=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new td({symbolLayers:new ot([new Q_({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Ox({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new wt({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new qc({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},V_=class extends Ne{constructor(e){super(e)}};u([f({constructOnly:!0})],V_.prototype,"renderCoordsHelper",void 0),u([f({constructOnly:!0})],V_.prototype,"surface",void 0),u([f({constructOnly:!0})],V_.prototype,"state",void 0),V_=u([L("esri.views.3d.support.pointsOfInterest.PointOfInterest")],V_);const zgt=Array;let sp=class extends V_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Sy({location:wt,renderLocation:zgt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=A(),this._tmpPoint=new wt}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Vo(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Ye(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=Nr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return ex(r,i)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var n;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((n=this.map)!=null&&n.ground))return this._updateSurfaceAltitude(0),jo;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>Vgt&&this.renderCoordsHelper.viewingMode===ct.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?Bgt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{Bn(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,jo}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(i8,this._estimatedSurfaceAltitude,this._camera.eye),Qs(this._get("renderLocation"),i8)||(this._set("renderLocation",ye(this._propertiesPool.get("renderLocation"),i8)),this.notifyChange("renderLocation"))}};u([f({constructOnly:!0})],sp.prototype,"scheduler",void 0),u([f({constructOnly:!0})],sp.prototype,"cache",void 0),u([f({constructOnly:!0})],sp.prototype,"task",void 0),u([f()],sp.prototype,"location",null),u([f({constructOnly:!0})],sp.prototype,"map",void 0),u([f()],sp.prototype,"renderLocation",void 0),u([f()],sp.prototype,"scale",null),u([f()],sp.prototype,"updating",null),sp=u([L("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],sp);const i8=A(),Vgt=1e5,Bgt=1e6,jgt=Array;let Ih=class extends V_{constructor(e){super(e),this._propertiesPool=new Sy({location:wt,renderLocation:jgt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=A(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Sr(this._frameWorker),this._propertiesPool=Ye(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,jo}_updateRenderLocation(){const e=Hgt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=qgt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(ye(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Nr(this._camera.eye,e):(ue(e,this._camera.viewForward,this._get("distance")),xe(e,e,this._camera.eye)),Qs(this._get("renderLocation"),e)||this._set("renderLocation",ye(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var n,s;const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=xr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=No(r.eye),c=l<a*a,h=Nr(r.eye,i);if(c&&h>o/4){const p=a-Math.sqrt(l);return ue(i,r.viewForward,p),xe(i,i,r.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;o!=null&&FQ(o,(s=this.surface)==null?void 0:s.spatialReference,k$,this.renderCoordsHelper.spatialReference)&&(i[0]=Oe(i[0],k$[0],k$[2]),i[1]=Oe(i[1],k$[1],k$[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(Cn.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,n=Nr(r,e),s=Nr(r,i);if(Math.abs(s-n)/n>Ggt)return!0}return!1}};u([f({constructOnly:!0})],Ih.prototype,"scheduler",void 0),u([f({constructOnly:!0})],Ih.prototype,"task",void 0),u([f()],Ih.prototype,"distance",void 0),u([f({constructOnly:!0})],Ih.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([f({readOnly:!0})],Ih.prototype,"location",null),u([f({readOnly:!0})],Ih.prototype,"renderLocation",void 0),u([f()],Ih.prototype,"updating",void 0),Ih=u([L("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Ih);const Ggt=.05,Hgt=A(),qgt=A(),k$=Zi();let Wgt=class{constructor(e){this._handles=new Dy,this.events=new ns,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Ye(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Zgt)}};const Zgt={},Ygt=Array;let op=class extends V_{constructor(e){super(e),this._propertiesPool=new Sy({location:wt,renderLocation:Ygt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([oe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),oe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(xt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Ye(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,Ipe);const s=Math.max(0,(Math.acos(Te(Ipe,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!JE(e,i)){const c=this._propertiesPool.get("renderLocation");ye(c,i),this._set("renderLocation",c)}return jo}const o=1-Oe(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Ppe);const l=this._propertiesPool.get("renderLocation");return br(l,i,Ppe,a),e&&JE(e,l)||this._set("renderLocation",l),jo}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(Ip());if(r[1]=i.aboveGround?i.padding[yi.BOTTOM]:i.fullHeight-i.padding[yi.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,U$)){Ae(U$,U$,i.eye);const s=Me(U$,U$);if(this.renderCoordsHelper.intersectInfiniteManifold(rf(i.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,i.eye)}updateRenderLocation(){this._dirty=!0}};u([f()],op.prototype,"_dirty",void 0),u([f({constructOnly:!0})],op.prototype,"scheduler",void 0),u([f({constructOnly:!0})],op.prototype,"centerOnSurface",void 0),u([f({constructOnly:!0})],op.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([f()],op.prototype,"updating",null),u([f()],op.prototype,"location",null),u([f()],op.prototype,"renderLocation",void 0),u([f()],op.prototype,"worldUnitsPerContentPixel",null),op=u([L("esri.views.3d.support.pointsOfInterest.Focus")],op);const Ipe=A(),U$=A(),Ppe=A();let Cg=class extends Ne{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=A();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([oe(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),Vo(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var r;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((r=this.surfaceView)==null?void 0:r.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=cwe(this.surfaceView.extent),i=new wt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(n=>{this._updateController=null,this._set("location",n.geometry)}).catch(n=>{})):this._set("location",i)}};u([f({constructOnly:!0})],Cg.prototype,"view",void 0),u([f({constructOnly:!0})],Cg.prototype,"cache",void 0),u([f()],Cg.prototype,"surface",null),u([f()],Cg.prototype,"surfaceView",null),u([f({readOnly:!0})],Cg.prototype,"location",void 0),u([f({readOnly:!0})],Cg.prototype,"renderLocation",null),Cg=u([L("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],Cg);let Mg=class extends Ne{constructor(e){super(e),this._tileGeometryUpdateExtent=wy(),this._tileGeometryUpdateSpatialReference=null,this.events=new ns,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(xt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Xgt),wy(this._tileGeometryUpdateExtent),this._set("updating",!1)),jo}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Q2(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,n=Jgt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,P1,i),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,L1,i),P1[0]<L1[0]?(n[0]=P1[0],n[2]=L1[0]):(n[0]=L1[0],n[2]=P1[0]),P1[1]<L1[1]?(n[1]=P1[1],n[3]=L1[1]):(n[1]=L1[1],n[3]=P1[1]),$U(n,e)}};u([f({constructOnly:!0})],Mg.prototype,"state",void 0),u([f({constructOnly:!0})],Mg.prototype,"centerOnSurfaces",void 0),u([f({constructOnly:!0})],Mg.prototype,"renderCoordsHelper",void 0),u([f({constructOnly:!0})],Mg.prototype,"scheduler",void 0),u([f({constructOnly:!0})],Mg.prototype,"surface",void 0),u([f({readOnly:!0})],Mg.prototype,"updating",void 0),Mg=u([L("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],Mg);const Xgt={},P1=A(),L1=A(),Jgt=wy();let kl=class extends Ne{constructor(e){super(e),this.renderPointOfView=A(),this._pois=new Array,this._debugCenters=null,this._tmpRay=zs(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Sy({renderPointOfView:Qgt},this)}initialize(){var c;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:n}=this.view;this._surfaceIntersector=pd(e.viewingMode),this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Go.MIN,this._contentIntersector=pd(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Ih({...l,task:xt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Ih({...l,task:xt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Ih({...l,task:xt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new sp({...l,cache:a,task:xt.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new Mg({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Wgt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Cg({cache:a,view:this.view})),this._set("focus",new op({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus),this.addHandles([oe(()=>e.contentCamera,h=>this._cameraChanged(h),xi),oe(()=>i.extent,()=>this._updateCenterPointsOfInterest()),oe(()=>{var h,p,g;return(g=(p=(h=this.view.map)==null?void 0:h.ground)==null?void 0:p.navigationConstraint)==null?void 0:g.type},h=>{this._surfaceIntersector.options.backfacesTerrain=h==="none"},Si),Kl(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),xi),Vo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Vo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),oe(()=>Cn.SHOW_POI,h=>this._setDebug(h),Si)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,US,eyt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(US):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=xe(US,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(US)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(US)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const n=xee(i,e,Kgt);if(n==null)return null;const s=n.origin,o=xe(US,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;Qs(this.renderPointOfView,i)||this._set("renderPointOfView",ye(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){var i;if(!e)return(i=this._debugCenters)==null||i.forEach(r=>r.hide()),void this.removeHandles("debug");if(!this._debugCenters){this._debugCenters=new Map;const r=this.view.graphics;this._debugCenters.set(this.centerOnContent,new HT(r,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new HT(r,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new HT(r,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new HT(r,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new HT(r,"green","Focus"))}for(const r of this._pois)this.addHandles(oe(()=>r.renderLocation,n=>{var s,o;return(o=(s=this._debugCenters)==null?void 0:s.get(r))==null?void 0:o.show(n,r.renderCoordsHelper.spatialReference)},Si),"debug")}get test(){}};u([f()],kl.prototype,"centerOnContent",void 0),u([f()],kl.prototype,"centerOnSurfaceFrequent",void 0),u([f()],kl.prototype,"centerOnSurfaceInfrequent",void 0),u([f()],kl.prototype,"cameraOnSurface",void 0),u([f()],kl.prototype,"focus",void 0),u([f()],kl.prototype,"renderPointOfView",void 0),u([f()],kl.prototype,"surfaceOrigin",void 0),u([f()],kl.prototype,"contentGeometryUpdates",void 0),u([f()],kl.prototype,"surfaceGeometryUpdates",void 0),u([f({constructOnly:!0})],kl.prototype,"view",void 0),u([f()],kl.prototype,"updating",null),kl=u([L("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],kl);const Qgt=Array,US=A(),Kgt=zs(),eyt={exclude:new Set([Pv])};let bI=class{constructor(e,i){this._cache=e(i,(r,n,s)=>{switch(n){case vp.ALL:return r.forEach(o=>o.dispose()),0;case vp.SOME:{const o=r.shift();return o&&(s-=Math.round(o.usedMemory),o.dispose()),s}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){if(r){const n=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,i,n)}}else this._cache.pop(e);return r}put(e,i,r=MRe){const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[i],i.usedMemory,r);n.push(i);const s=this._cache.getSize(e)+Math.round(i.usedMemory);this._cache.updateSize(e,n,s)}},tyt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}},iyt=class{constructor(e="scene"){this.context=e,this.extent=wy()}};const VBt={value:.5,readOnly:!0},ryt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let B2=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},nyt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},syt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new nyt(r,i)}computeMinMaxValue(e,i,r,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*wK;let g=(c-1)/o,y=(r-this.j*o)*g,w=(i-this.i*o)*g;if(g<1){const b=Math.floor(y),x=Math.floor(w),T=b+x*c,M=h[T],$=h[T+1],R=h[T+c],I=h[T+c+1];if(M+$+R+I<p){const P=y-b,N=w-x,V=nL(M,$,R,I,P,N),U=nL(M,$,R,I,P+g,N),B=nL(M,$,R,I,P,N+g),W=nL(M,$,R,I,P+g,N+g);return n.min=Math.min(V,U,B,W),n.max=Math.max(V,U,B,W),n}y=b,w=x,g=1}else y=Math.floor(y),w=Math.floor(w),g=Math.ceil(g);for(let b=y;b<=y+g;b++)for(let x=w;x<=w+g;x++){const T=h[b+x*c];T<p?(a=Math.min(a,T),l=Math.max(l,T)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const oyt=.5*wK;function Tn(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const n=r.safeWidth;let s=Oe(r.dy*(r.y1-e),0,n),o=Oe(r.dx*(t-r.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=r.data.width,h=a*c+l,p=r.data.values,g=p[h],y=p[h+1],w=h+c,b=p[w],x=p[w+1];if(g+b+y+x<oyt){s-=a,o-=l;const T=g+(y-g)*o;return T+(b+(x-b)*o-T)*s}}return null}var Tt;(function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"})(Tt||(Tt={}));function DRe(t){return zte(t)||LC(t)||DC(t)}function zte(t){return wv(t)||r5(t)}const zS=A(),ayt=A(),tg=A(),ig=A();function lyt(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return uwe(r,e);const n=Math.min(r[2]-r[0],r[3]-r[1]);return lVe(r,e,i*n)}function $D(t,e,i,r){ye(zS,i),zS[r]=e[r];const n=Ae(zS,zS,e),s=Ae(ayt,t,e),o=Te(s,n),a=Te(n,n);let l;l=o<=0?e:a<=o?i:xe(zS,e,ue(n,n,o/a));const c=Ae(zS,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function cyt(t,e,i){const r=t.extent;if(r==null)return 0;tg[0]=r[0],tg[1]=r[1],tg[2]=i,ig[0]=r[2],ig[1]=r[3],ig[2]=i;let n=1/0,s=1/0;return e[0]<tg[0]?n=$D(e,tg,ig,0):e[0]>ig[0]&&(n=$D(e,ig,tg,0)),e[1]<tg[1]?s=$D(e,tg,ig,1):e[1]>ig[1]&&(s=$D(e,ig,tg,1)),Math.min(n,s)}function uyt(t,e,i,r){if(t==null)return vK();const n=t.spatialReference;if(n.isGeographic&&!zte(n))return new Y("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const s=Lc.checkUnsupported(t);return s??(i==null?new Y("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):hyt(t,i)||(e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new Y("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function hyt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,n=[r*t.size[0],r*t.size[1]],s=[t.origin.x,t.origin.y],o=lwe(e),a=Zi();Lc.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>T2){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new Y("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:T2})}return null}const dyt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:uyt,isInsideExtent:lyt,tiltToExtentEdge:cyt},Symbol.toStringTag,{value:"Module"}));function pyt(){return!0}function fyt(){return 0}function myt(t,e,i,r){if(t==null)return vK();const n=(t==null?void 0:t.lods.length)-1,s=t.spatialReference;if(s.isWebMercator){if(!Lc.makeWebMercatorAuxiliarySphere(n).compatibleWith(t,r))return new Y("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!DRe(s))return new Y("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Lc.makeGCSWithTileSize(t.spatialReference,t.size[0],n).compatibleWith(t,r))return t.spatialReference.isWGS84?new Y("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new Y("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new Y("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const gyt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:myt,isInsideExtent:pyt,tiltToExtentEdge:fyt},Symbol.toStringTag,{value:"Module"})),yyt={[ct.Global]:gyt,[ct.Local]:dyt};function qs(t,e){t||console.warn("Terrain: "+e)}let Xs=!1,Dk=!1;function _yt(t){Dk=t,Xs=Xs||t}function vyt(t){Xs=t}function qe(t,e){var i;if(Xs&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function Nk(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function dV(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function NRe(t){return(t==null?void 0:t.type)==="tile-3d"}function SC(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function FRe(t){return(t==null?void 0:t.type)==="wmts-3d"}function lY(t){return(t==null?void 0:t.type)==="elevation-3d"}function z$(t){return(t==null?void 0:t.type)==="group"}function g3(t){return t&&(NRe(t)||FRe(t)||dV(t)||SC(t))}function cY(t){return t&&(NRe(t)||dV(t)||SC(t)||FRe(t))}function uY(t){return cY(t)||lY(t)}function wyt(t){var e;return ORe((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function byt(t){return kRe(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function xyt(t){var e;return ARe((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function Syt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return hV(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function kRe(t){return GT(t==null?void 0:t.data)}function bE(t){return t!=null&&"release"in t&&t.release(),null}function HBt(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Vte(t,e,i,r,n){return yyt[r].checkIfTileInfoSupportedForViewSR(t,i,e,n)}function pV(t,e,i){var o;let r=null,n=null;if((t==null?void 0:t.type)==="wmts"){const a=Tyt(t,e,i);r=a.tileInfo,n=a.fullExtent}else{n=Nk(t)?t.getCompatibleFullExtent(e):t.fullExtent;const a=i===ct.Local;Nk(t)?r=t.getCompatibleTileInfo(e,n,a):(t==null?void 0:t.type)==="vector-tile"?r=a&&!Eyt(e)||Cyt.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const s="tilemapCache"in t?(o=t.tilemapCache)==null?void 0:o.effectiveMaxLOD:void 0;return r!=null&&n!=null&&Vte(r,n,e,i,s)==null?{tileInfo:r,fullExtent:n}:null}function Tyt(t,e,i){const r=wUe(t);if(r!=null){if(!ot.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const n=r.find(s=>Vte(s.tileInfo,s.fullExtent,e,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Eyt(t){return t.isWGS84||t.isWebMercator||r5(t)||!mU(t)}const Cyt={force512VTL:!1};function Lpe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function rg(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Wh(t,e,i=Oyt){return Math.abs(t-e)<i}function Fk(t){return t===Tt.NORTH_EAST?Tt.SOUTH_WEST:t===Tt.NORTH_WEST?Tt.SOUTH_EAST:t===Tt.SOUTH_WEST?Tt.NORTH_EAST:Tt.NORTH_WEST}function Bte(t){return t===Tt.NORTH?Tt.SOUTH:t===Tt.EAST?Tt.WEST:t===Tt.SOUTH?Tt.NORTH:Tt.EAST}function Myt(t){return t===Tt.NORTH_WEST||t===Tt.SOUTH_WEST}function $yt(t){return t===Tt.NORTH_WEST||t===Tt.NORTH_EAST}function Dpe(t){return t===Tt.NORTH_WEST||t===Tt.WEST||t===Tt.SOUTH_WEST}function Npe(t){return t===Tt.NORTH_EAST||t===Tt.EAST||t===Tt.SOUTH_EAST}function Fpe(t){return t===Tt.SOUTH_EAST||t===Tt.SOUTH||t===Tt.SOUTH_WEST}function kpe(t){return t===Tt.NORTH_EAST||t===Tt.NORTH||t===Tt.NORTH_WEST}const zp=[Tt.NORTH,Tt.EAST,Tt.SOUTH,Tt.WEST],kk=[Tt.NORTH_EAST,Tt.SOUTH_EAST,Tt.SOUTH_WEST,Tt.NORTH_WEST],Oyt=1e-5;let Oh=class extends Ne{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if("operationalLayerType"in r&&vUe(r.operationalLayerType)&&this.viewSpatialReference!=null){const n=URe(r.fullExtent,this.viewSpatialReference);n!=null&&e.push(lwe(n))}}),e}};function Ayt(t,e){return t===ct.Global?new hY(e):new dY(e)}u([f({readOnly:!0})],Oh.prototype,"layerViewsExtent",null),u([f({readOnly:!0})],Oh.prototype,"tiledLayersExtent",null),u([f({readOnly:!0})],Oh.prototype,"stencilEnabledExtents",null),u([f()],Oh.prototype,"viewSpatialReference",void 0),u([f()],Oh.prototype,"tilingScheme",void 0),u([f()],Oh.prototype,"defaultTiledLayersExtent",void 0),u([f({constructOnly:!0})],Oh.prototype,"layers",void 0),u([f({constructOnly:!0})],Oh.prototype,"layerViews",void 0),Oh=u([L("esri.views.3d.terrain.ExtentHelper")],Oh);let hY=class extends Oh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?w2e:bYe}};hY=u([L("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],hY);let dY=class extends Oh{_computeLayerViewsExtent(){const e=wy(),i=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=URe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,i);Q2(e,a,e)}});const r=v9(e)?e:null,n=this._get("layerViewsExtent");return wb(r,n)?n:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=wy();this.layers.forEach(o=>{var a;if(o.loaded&&kA(o)){const l=pV(o,i,ct.Local);if(l==null)return;const{tileInfo:c,fullExtent:h}=l,p="tilemapCache"in o?(a=o.tilemapCache)==null?void 0:a.effectiveMaxLOD:void 0;c!=null&&h!=null&&(Nk(o)||e.compatibleWith(c,p)&&h.spatialReference.equals(e.spatialReference))&&Q2(r,h,r)}}),Q2(r,this.defaultTiledLayersExtent,r);const n=v9(r)?r:null,s=this._get("tiledLayersExtent");return wb(n,s)?s:n}};function URe(t,e){return t==null||t.spatialReference.equals(e)?t:jA(t,t.spatialReference,e)}dY=u([L("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],dY);var cs,Zh,Un;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(cs||(cs={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Zh||(Zh={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Un||(Un={}));var j2,Uk,pY;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(j2||(j2={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(Uk||(Uk={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(pY||(pY={}));let Ryt=class{constructor(e,i){this.vec3=e,this.id=i}};function zk(t,e,i,r){return new Ryt(Qe(t,e,i),r)}let Upe=class{constructor(){this._extent=Zi(),this.resolution=0,this.renderLocalOrigin=zk(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Iyt}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryView();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];c5(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];c5(this._extent,-e.range,0,r)}}setupGeometryView(){this.canvasGeometries.numViews=1,xv(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},Iyt=class{constructor(){this.extents=[Zi(),Zi(),Zi()],this.numViews=0}};var dr;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(dr||(dr={}));let Pyt=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=Lr(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,i,r){var n,s,o,a;this._handle&&((n=this._handle.fbo)==null?void 0:n.width)===i&&((s=this._handle.fbo)==null?void 0:s.height)===r||((o=this._handle)==null||o.release(),this._handle=this._fbos.acquire(i,r,this._name,this._format)),e.bindFramebuffer((a=this._handle)==null?void 0:a.fbo)}generateMipMap(){var e,i,r,n,s;(r=(i=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:i.descriptor)!=null&&r.hasMipmap&&((s=(n=this._handle)==null?void 0:n.getTexture())==null||s.generateMipmap())}},VS=class{constructor(e,i,r,n,s=Vr.RGBA_MIPMAP){this.output=r,this.content=n,this.fbo=new Pyt(e,s,i)}get valid(){return this.fbo.valid}},Lyt=class{constructor(e){this.targets=[new VS(e,"overlay color",J.Color,dr.Color),new VS(e,"overlay IM color",J.Color,dr.ColorNoRasterImage),new VS(e,"overlay highlight",J.Highlight,dr.Highlight,Vr.RG),new VS(e,"overlay water",J.Normal,dr.WaterNormal),new VS(e,"overlay occluded",J.Color,dr.Occluded)],_d()&&this.targets.push(new VS(e,"overlay olid",J.ObjectAndLayerIdColor,dr.ObjectAndLayerIdColor,Vr.RGBA))}getTexture(e){var i;return(i=this.targets[e])==null?void 0:i.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},fV=class extends kOe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=A(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var za;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})(za||(za={}));let Dyt=class extends fV{constructor(){super(...arguments),this.identifier=za.Material,this.output=J.Color,this.transparent=!1}},Nyt=class extends fV{constructor(){super(...arguments),this.identifier=za.ShadowMap}},Fyt=class extends fV{constructor(){super(...arguments),this.identifier=za.Highlight}},kyt=class extends fV{constructor(){super(...arguments),this.identifier=za.ViewshedShadowMap}};function o6t(t){t.fragment.code.add(C`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Uyt(t){t.fragment.code.add(C`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function xI(t){t.fragment.code.add(C`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}function zyt(t,e){if(!e.screenSpaceReflections)return;const i=t.fragment;i.include(qy),i.uniforms.add(new rs("nearFar",(r,n)=>n.camera.nearFar),new ht("depthMap",(r,n)=>{var s;return(s=n.depth)==null?void 0:s.attachment}),new Bs("proj",(r,n)=>n.camera.projectionMatrix),new rt("invResolutionHeight",(r,n)=>1/n.camera.height),new Bs("reprojectionMatrix",(r,n)=>n.ssr.reprojectionMatrix)).code.add(C`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function Wy(t=Vyt){return[t[0],t[1],t[2],t[3]]}function r8(t,e,i=Wy()){return ye(i,t),i[3]=e,i}function zpe(t,e,i){return Ot(i,t,e),Me(i,i),i[3]=-Axe(t,e),i}function a6t(t,e=Wy()){const i=k1e(rA,t);return zRe(e,vo(uK(e,i))),e}function Vpe(t,e,i=Wy()){return F5(rA,t,Bpe(t)),F5(jpe,e,Bpe(e)),uz(rA,jpe,rA),zRe(i,vo(uK(i,rA)))}function l6t(t,e,i,r=Wy()){return r8(QJ,t,OD),r8(KJ,e,Gpe),r8(UE,i,Hpe),Vpe(OD,Gpe,OD),Vpe(OD,Hpe,r),r}function c6t(t){return t}function u6t(t){return t[3]}function Bpe(t){return Wt(t[3])}function zRe(t,e){return t[3]=e,t}const Vyt=[0,0,1,0],rA=vd(),jpe=vd();Wy();const OD=Wy(),Gpe=Wy(),Hpe=Wy();let Byt=class{constructor(){this.startTime=0,this._data=Xl(null),this._readChannels=Ey.RG,this.parallax=new qpe,this.parallaxNew=new qpe,this._anchorPoint=A(),this._fadeState=Xl(Hr.HIDE),this._fadeFactor=Xl(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case Hr.HIDE:return 0;case Hr.FADE_OUT:return 1-this.fadeFactor;case Hr.FADE_IN:return this.fadeFactor;case Hr.SHOW:case Hr.CROSS_FADE:return 1}}fade(e,i,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?Oe((i-this.startTime)/(Gyt*r),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(e,i),this._updateParallax(e)}_evaluateState(e,i){const r=e.relativeElevation,n=this._updateAnchorPoint(e);(r>1.7*ob||r<-ob||n>Zpe)&&this.opacity>0?this._startFade(Hr.HIDE,i):this.isFading||(r>ob||r<-.35*ob||n>Hyt*Zpe?this.opacity>0&&this._startFade(Hr.FADE_OUT,i):BQe(this.data)&&(this.opacity===0?this._startFade(Hr.FADE_IN,i):this.data.state===Au.Ready&&(this.fadeState===Hr.SHOW?this._startFade(Hr.CROSS_FADE,i):this._startFade(Hr.SHOW,i))))}_updateParallax(e){const i=No(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(i-Ii.radius*Ii.radius,0))/Math.sqrt(i),zpe(Wpe,this.parallax.anchorPoint,BS),Lu(this.parallax.transform,Js,BS[3],BS),zpe(Wpe,this.parallaxNew.anchorPoint,BS),Lu(this.parallaxNew.transform,Js,BS[3],BS)}_updateAnchorPoint(e){var i;return Me(this._anchorPoint,e.eye),ue(this._anchorPoint,this._anchorPoint,Ii.radius),this.fadeState===Hr.HIDE&&((i=this.data)==null?void 0:i.state)===Au.Ready?(ye(this.parallax.anchorPoint,this._anchorPoint),0):Fe(Ae(jyt,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,i){switch(this._fadeState.value=e,this.startTime=i,e){case Hr.CROSS_FADE:this.requestFade(),this._switchReadChannels(),ye(this.parallaxNew.anchorPoint,this._anchorPoint);break;case Hr.FADE_IN:this.requestFade(),this._switchReadChannels(),ye(this.parallax.anchorPoint,this._anchorPoint),ye(this.parallaxNew.anchorPoint,this._anchorPoint);break;case Hr.FADE_OUT:this.requestFade();break;case Hr.SHOW:this._switchReadChannels(),ye(this.parallax.anchorPoint,this._anchorPoint),ye(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case Hr.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==Au.Ready&&(this.data.state=Au.Idle),this.fadeState){case Hr.CROSS_FADE:ye(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=Hr.SHOW;break;case Hr.FADE_IN:this._fadeState.value=Hr.SHOW;break;case Hr.FADE_OUT:this._fadeState.value=Hr.HIDE;break;case Hr.SHOW:case Hr.HIDE:break;default:this.fadeState}}_switchReadChannels(){var e;((e=this.data)==null?void 0:e.state)===Au.Ready&&(this._readChannels=1-this._readChannels,this.data.state=Au.Fading)}get isFading(){return this.fadeState===Hr.FADE_OUT||this.fadeState===Hr.FADE_IN||this.fadeState===Hr.CROSS_FADE}};var Hr;(function(t){t[t.HIDE=0]="HIDE",t[t.FADE_IN=1]="FADE_IN",t[t.SHOW=2]="SHOW",t[t.CROSS_FADE=3]="CROSS_FADE",t[t.FADE_OUT=4]="FADE_OUT"})(Hr||(Hr={}));let qpe=class{constructor(){this.anchorPoint=A(),this.radiusCurvatureCorrection=0,this.transform=ut()}};const Wpe=Qe(0,0,1),BS=Wy(),jyt=A(),Gyt=1.25,Hyt=.5,Zpe=2e5;let qyt=class extends Mn{constructor(e,i){super(e,"samplerCube",Fi.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function VRe(t){const e=t.fragment;e.constants.add("radiusCloudsSquared","float",Wyt).code.add(C`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),e.uniforms.add(new rt("radiusCurvatureCorrection",(l,c)=>c.clouds.parallax.radiusCurvatureCorrection)).code.add(C`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),e.code.add(C`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Om(e),Iy(e);const i=Qe(.28,.175,.035);e.constants.add("RIM_COLOR","vec3",i),e.code.add(C`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${C.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${C.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${C.float(.2)} * pow(dirDotLight, ${C.float(10)}) * (1. - pow(sunsetTransition, ${C.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),e.uniforms.add(new Ay("readChannelsRG",(l,c)=>c.clouds.readChannels===Ey.RG),new qyt("cubeMap",(l,c)=>{var h,p;return((p=(h=c.clouds.data)==null?void 0:h.cubeMap)==null?void 0:p.colorTexture)??null})).code.add(C`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),e.uniforms.add(new fi("anchorPoint",(l,c)=>c.clouds.parallax.anchorPoint),new fi("anchorPointNew",(l,c)=>c.clouds.parallaxNew.anchorPoint),new Bs("rotationClouds",(l,c)=>c.clouds.parallax.transform),new Bs("rotationCloudsNew",(l,c)=>c.clouds.parallaxNew.transform),new rt("cloudsOpacity",(l,c)=>c.clouds.opacity),new rt("fadeFactor",(l,c)=>c.clouds.fadeFactor),new Ay("crossFade",(l,c)=>c.clouds.fadeState===Hr.CROSS_FADE)).code.add(C`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const Wyt=(Ii.radius+AGe)**2;function mV(t){t.code.add(C`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}function Zyt(t,e){t.include(fut,e),t.include(xI),t.include(Uyt),e.cloudReflections&&t.include(VRe),t.include(zyt,e);const i=t.fragment;i.include(mV),i.constants.add("fresnelSky","vec3",[.02,1,15]),i.constants.add("fresnelMaterial","vec2",[.02,.1]),i.constants.add("roughness","float",.015),i.constants.add("foamIntensityExternal","float",1.7),i.constants.add("ssrIntensity","float",.65),i.constants.add("ssrHeightFadeStart","float",YOe),i.constants.add("ssrHeightFadeEnd","float",Tk),i.constants.add("waterDiffusion","float",.92),i.constants.add("waterSeaColorMod","float",.8),i.constants.add("correctionViewingPowerFactor","float",.4),i.constants.add("skyZenitColor","vec3",[.52,.68,.9]),i.constants.add("skyColor","vec3",[.67,.79,.9]),i.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(C`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new rt("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new rt("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(C`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.cloudReflections&&i.uniforms.add(new rt("cloudsOpacity",(r,n)=>n.clouds.opacity)).code.add(C`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),e.screenSpaceReflections?i.uniforms.add(new Bs("view",(r,n)=>n.camera.viewMatrix),new ht("lastFrameColorTexture",(r,n)=>{var s;return(s=n.ssr.lastFrameColor)==null?void 0:s.getTexture()}),new rt("fadeFactorSSR",(r,n)=>n.ssr.fadeFactor)).code.add(C`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):i.code.add(C`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.cloudReflections?e.screenSpaceReflections?i.code.add(C`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(C`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(C`return waterRenderedColor;
}`)}var cm;function Yyt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new c3("overlayTexOffset",(n,s)=>Xyt(n,s)),new c3("overlayTexScale",(n,s)=>Jyt(n,s))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new ht("ovColorTex",(n,s)=>jRe(n,s))),BRe(t,e)}function V$(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new Ype("overlayTexOffset"),new Ype("overlayTexScale")),r.uniforms.add(new rt("overlayOpacity",n=>n.overlayOpacity),new ht("ovColorTex",(n,s)=>{var o;return(o=s.overlay)==null?void 0:o.getTexture(n.overlayContent)})),BRe(t,e)}function BRe(t,e){const i=e.pbrMode===Ut.Water||e.pbrMode===Ut.WaterOnIntegratedMesh||e.pbrMode===Ut.TerrainWithWater;i&&t.include(Zyt,e);const{vertex:r,fragment:n}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(C`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),n.code.add(C`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),n.code.add(C`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),n.code.add(C`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),n.code.add(C`vec2 getAllOverlayHighlightValuesEncoded() {
vec4 texCoords = vtcOverlay;
vec2 uvInner = texCoords.xy;
vec2 uvOuter = texCoords.zw;
bool isValidInner = isValid(uvInner, fwidth(uvInner));
bool isValidOuter = isValid(uvOuter, vec2(0.0, 0.0));
vec2 texelCoordInner = vec2(uvInner.x * 0.5,       uvInner.y);
vec2 texelCoordOuter = vec2(uvOuter.x * 0.5 + 0.5, uvOuter.y);
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec2 texelValueInner = texelFetch(ovColorTex, ivec2(texelCoordInner * texDim), 0).rg;
vec2 texelValueOuter = texelFetch(ovColorTex, ivec2(texelCoordOuter * texDim), 0).rg;
return
isValidInner ? texelValueInner :
isValidOuter ? texelValueOuter :
vec2(0.0);
}`),i&&(Om(n),Iy(n),n.code.add(C`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function jRe(t,e){var i,r,n;return t.identifier===za.Material&&t.output===J.Color?(i=e.overlay)==null?void 0:i.getTexture(dr.ColorNoRasterImage):t.identifier===za.Material&&t.output===J.ObjectAndLayerIdColor?(r=e.overlay)==null?void 0:r.getTexture(dr.ObjectAndLayerIdColor):t.identifier===za.Highlight?(n=e.overlay)==null?void 0:n.getTexture(dr.Highlight):null}function Xyt(t,e){var n,s,o,a;const i=(s=(n=e.overlay)==null?void 0:n.overlays[cs.INNER])==null?void 0:s.extent;l5(i)&&(sm[0]=t.toMapSpace[0]/Va(i)-i[0]/Va(i),sm[1]=t.toMapSpace[1]/Uc(i)-i[1]/Uc(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[cs.OUTER])==null?void 0:a.extent;return l5(r)&&(sm[2]=t.toMapSpace[0]/Va(r)-r[0]/Va(r),sm[3]=t.toMapSpace[1]/Uc(r)-r[1]/Uc(r)),sm}function Jyt(t,e){var n,s,o,a;const i=(s=(n=e.overlay)==null?void 0:n.overlays[cs.INNER])==null?void 0:s.extent;l5(i)&&(sm[0]=t.toMapSpace[2]/Va(i),sm[1]=t.toMapSpace[3]/Uc(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[cs.OUTER])==null?void 0:a.extent;return l5(r)&&(sm[2]=t.toMapSpace[2]/Va(r),sm[3]=t.toMapSpace[3]/Uc(r)),sm}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(cm||(cm={}));const sm=Ti();let Ype=class extends Mn{constructor(e){super(e,"vec4")}},jte=class extends Ar{constructor(){super(...arguments),this.color=Qe(1,1,1)}};function GRe(){const t=new or;return t.include(xa),t.fragment.uniforms.add(new ht("tex",e=>e.texture),new fi("uColor",e=>e.color)),t.fragment.main.add(C`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),t}const Qyt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:jte,build:GRe},Symbol.toStringTag,{value:"Module"}));let Gte=class extends Ar{};function HRe(){const t=new or,{outputs:e,fragment:i}=t;return t.include(xa),i.uniforms.add(new $m("textureInput",r=>r.input)),i.constants.add("outlineWidth","int",Math.ceil(y3)),i.constants.add("cellSize","int",nv),e.add("fragGrid","vec2"),i.main.add(C`vec2 inputTextureSize = vec2(textureSize(textureInput, 0));
vec2 cellBottomLeftCornerInput = floor(gl_FragCoord.xy) * vec2(cellSize);
vec2 coordMid =  (cellBottomLeftCornerInput + 0.5 * vec2(cellSize)) / inputTextureSize;
vec2 commonValue = texture(textureInput, coordMid).rg;
int margin = outlineWidth;
float marginSquare = float(margin*margin);
for(int y = -margin; y <= cellSize + margin; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : margin;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
vec2 coord = (cellBottomLeftCornerInput + vec2(x, y)) / inputTextureSize;
vec2 value = texture(textureInput, coord).rg;
if (value != commonValue){
fragGrid = vec2(1.0, 1.0);
return;
}
}
}
bool hasAny = commonValue != vec2(0.0);
fragGrid = vec2(hasAny ? 1.0 : 0.0, 0.0);`),t}const nv=32,y3=9,Hte=.4,Kyt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Gte,blurSize:Hte,build:HRe,gridCellPixelSize:nv,outlineSize:y3},Symbol.toStringTag,{value:"Module"}));function gV(t){const{vertex:e}=t;e.uniforms.add(new ht("coverageTexture",i=>i.coverageTexture),new FZ("highlightRenderCellCount",i=>[i.horizontalCellCount,i.verticalCellCount]),new FZ("highlightTextureResolution",i=>[i.highlightTexture.descriptor.width,i.highlightTexture.descriptor.height])),e.constants.add("cellSize","int",nv),t.varyings.add("sUV","vec2"),t.varyings.add("vOutlinePossible","float"),e.code.add(C`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),e.main.add(C`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
vec4 cov = texelFetch(coverageTexture, cellPos, 0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = cov.g;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}function Vk(t){const{fragment:e}=t;e.code.add(C`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}function qRe(){const t=new or;t.include(gV);const{fragment:e}=t;return e.uniforms.add(new ht("highlightTexture",i=>i.highlightTexture),new ht("highlightOptionsTexture",i=>i.highlightOptionsTexture),new rt("pixelRatio",i=>i.pixelRatio),new rt("occludedIntensityFactor",i=>i.occludedFactor),new Mm("maxHighlightLevel",i=>i.maxHighlightLevel)),e.constants.add("pixelSampleScale","float",1),t.include(Vk),e.code.add(C`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),e.main.add(C`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),t}const e0t=Object.freeze(Object.defineProperty({__proto__:null,build:qRe},Symbol.toStringTag,{value:"Module"}));let Xpe=class extends hr{constructor(e,i,r){super(e,i,new ar(e0t,()=>fe(()=>Promise.resolve().then(()=>sAt),void 0)),r)}initializePipeline(){return Pi({blending:gd,colorWrite:Qi})}},Jpe=class extends hr{constructor(e,i,r){super(e,i,new ar(Kyt,()=>fe(()=>Promise.resolve().then(()=>oAt),void 0)),r)}initializePipeline(){return Pi({colorWrite:Qi})}},t0t=class extends Ar{constructor(){super(...arguments),this.occludedFactor=qmt,this.maxHighlightLevel=1,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function WRe(){const t=new or;t.include(gV),t.include(Vk);const{fragment:e}=t;return t.outputs.add("fragSingleHighlight","vec2",0),e.uniforms.add(new ht("highlightTexture",i=>i.highlightTexture),new Mm("maxHighlightLevel",i=>i.maxHighlightLevel),new Mm("highlightLevel",i=>i.highlightLevel)),t.include(Vk),e.main.add(C`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),t}const i0t=Object.freeze(Object.defineProperty({__proto__:null,build:WRe},Symbol.toStringTag,{value:"Module"}));let Qpe=class extends hr{constructor(e,i,r){super(e,i,new ar(i0t,()=>fe(()=>Promise.resolve().then(()=>aAt),void 0)),r)}initializePipeline(){return Pi({colorWrite:Qi})}};function ZRe(){const t=new or;t.include(gV);const{fragment:e}=t;return e.uniforms.add(new ht("blurInput",i=>i.singleHighlightBlurTexture),new fte("blurSize",i=>i.blurSize),new ht("highlightTexture",i=>i.highlightTexture),new ht("highlightOptionsTexture",i=>i.highlightOptionsTexture),new Mm("highlightLevel",i=>i.highlightLevel),new rt("occludedIntensityFactor",i=>i.occludedFactor)),e.constants.add("inner","float",1-(y3-Hte)/y3),t.include(Vk),e.main.add(C`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),t}const r0t=Object.freeze(Object.defineProperty({__proto__:null,build:ZRe},Symbol.toStringTag,{value:"Module"}));let Kpe=class extends hr{constructor(e,i,r){super(e,i,new ar(r0t,()=>fe(()=>Promise.resolve().then(()=>lAt),void 0)),r)}initializePipeline(){return Pi({blending:gd,colorWrite:Qi})}},qte=class extends Ar{constructor(){super(...arguments),this.blurSize=Yt()}};function YRe(){const t=new or;return t.include(gV),t.fragment.uniforms.add(new fte("blurSize",e=>e.blurSize),new $m("blurInput",e=>e.blurInput)),t.outputs.add("fragSingleHighlight","vec2",0),t.fragment.main.add(C`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),t}const n0t=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:qte,build:YRe},Symbol.toStringTag,{value:"Module"}));let efe=class extends hr{constructor(e,i,r){super(e,i,new ar(n0t,()=>fe(()=>Promise.resolve().then(()=>cAt),void 0)),r)}initializePipeline(){return Pi({colorWrite:Qi})}};const s0t=[],T6t=[new nf(k.POSITION,3,Hi.FLOAT,0,12)],XRe=[new nf(k.POSITION,2,Hi.FLOAT,0,8)],o0t=[new nf(k.POSITION,2,Hi.FLOAT,0,16),new nf(k.UV0,2,Hi.FLOAT,8,16)];let qT=class extends Hy{constructor(e){super(e),this.produces=ii.HIGHLIGHTS,this.consumes={required:[ii.HIGHLIGHTS,"highlights"]},this.useMultipleHighlights=!!pe("enable-feature:multiple-highlights"),this._optionsTexture=null,this._downsampleDrawParameters=new Gte,this._passParameters=new t0t,this._singleHighlightBlurDrawParameters=new qte,this._grid=new a0t,e.techniques.precompile(Jpe),this.useMultipleHighlights?e.techniques.precompile(Xpe):(e.techniques.precompile(Qpe),e.techniques.precompile(efe),e.techniques.precompile(Kpe))}initialize(){this.addHandles([oe(()=>QRe(this.view.highlights),()=>{this._optionsTexture=Ht(this._optionsTexture),this.requestRender(Gt.UPDATE)},Si)])}destroy(){this._passParameters&&(this._passParameters.highlightOptionsTexture=null),this._grid.coverage=Lr(this._grid.coverage),this._grid.vao=Ht(this._grid.vao),this._optionsTexture=Lr(this._optionsTexture)}_updateOptionsTexture(e){const i=this.renderingContext;let r=this._optionsTexture;if(r==null){const n=new jr(16,2);n.internalFormat=kt.RGBA,n.samplingMode=Mi.NEAREST,r=new fr(i,n,null),this._optionsTexture=r}r.setData(e),this._passParameters.highlightOptionsTexture=r}render(e){const i=e.find(({name:y})=>y===ii.HIGHLIGHTS),{techniques:r,bindParameters:n,_passParameters:s,renderingContext:o}=this;if(!n.decorations)return i;const a=r.acquire(Jpe);if(!a.compiled)return a.release(),this.requestRender(Gt.UPDATE),i;const l=e.find(({name:y})=>y==="highlights").getTexture(),c=()=>{var T;const{highlights:y}=this.view;this._optionsTexture||this._updateOptionsTexture(l0t(y)),s.highlightOptionsTexture=this._optionsTexture,this._gridUpdateResources(l);const w=this._gridComputeCoverage(a,l,n);a.release();const{horizontalCellCount:b,verticalCellCount:x}=w;return s.horizontalCellCount=b,s.verticalCellCount=x,s.coverageTexture=(T=w.coverage)==null?void 0:T.getTexture(),w},h=y=>{const w=y.verticalCellCount*y.horizontalCellCount;o.bindVAO(y.vao),o.drawElementsInstanced(ur.TRIANGLES,6,Hi.UNSIGNED_BYTE,0,w)},{camera:p}=n,g=()=>{o.bindFramebuffer(i.fbo),o.setViewport4fv(p.fullViewport)};return this.useMultipleHighlights?this._renderMultiple(l,c,h,g):this._renderSingle(l,c,h,g),s.highlightTexture=null,s.coverageTexture=null,i}_renderMultiple(e,i,r,n){const{techniques:s,bindParameters:o,_passParameters:a,renderingContext:l}=this,c=s.acquire(Xpe);if(!c.compiled)return c.release(),void this.requestRender(Gt.UPDATE);const h=i();a.highlightTexture=e,a.pixelRatio=o.camera.pixelRatio,a.maxHighlightLevel=rfe(this.view.highlights)-1,l.bindTechnique(c,o,a),n(),r(h),c.release()}_renderSingle(e,i,r,n){var N;const{fboCache:s,techniques:o,bindParameters:a,_passParameters:l,renderingContext:c}=this,h=o.acquire(Qpe),p=o.acquire(efe),g=o.acquire(Kpe);if(!g.compiled||!p.compiled||!h.compiled)return g.release(),p.release(),h.release(),void this.requestRender(Gt.UPDATE);const y=i(),{width:w,height:b}=e.descriptor;l.maxHighlightLevel=rfe(this.view.highlights)-1,l.highlightTexture=e;const{camera:x}=a,{fullWidth:T,fullHeight:M,pixelRatio:$}=x,R=Math.ceil(T/$),I=Math.ceil(M/$),{_singleHighlightBlurDrawParameters:P}=this;for(let V=0;V<=l.maxHighlightLevel;++V){l.highlightLevel=V,c.setClearColor(0,0,0,0);const U=s.acquire(w,b,"single highlight",Vr.RG);c.bindFramebuffer(U.fbo),c.setViewport(0,0,w,b),c.clear(Xi.COLOR),c.bindTechnique(h,a,l),r(y),P.blurInput=U.getTexture(),ln(P.blurSize,1/R,0);const B=s.acquire(R,I,"single highlight blur h",Vr.RG);c.unbindTexture((N=B.fbo)==null?void 0:N.colorTexture),c.bindFramebuffer(B.fbo),c.setViewport(0,0,R,I),c.clear(Xi.COLOR),P.blurInput=U.getTexture(),ln(P.blurSize,1/R,0),c.bindTechnique(p,a,l,P),r(y),U.release(),ln(P.blurSize,0,1/I),l.singleHighlightBlurTexture=B.getTexture(),n(),c.bindTechnique(g,a,l,P),r(y),B.release()}h.release(),p.release(),g.release()}_gridUpdateResources(e){const i=this.renderingContext,r=this._grid,{width:n,height:s}=e.descriptor;if(r.horizontalCellCount=Math.ceil(n/nv),r.verticalCellCount=Math.ceil(s/nv),r.vao)return;const o=bs.createIndex(i,Vn.STATIC_DRAW,u0t);r.vao=new km(i,md,new Map([["geometry",s0t]]),new Map([["geometry",bs.createVertex(i,Vn.STATIC_DRAW)]]),o)}_gridComputeCoverage(e,i,r){var h;const n=this.renderingContext,s=this._grid,o=i.descriptor,a=Math.ceil(o.width/nv),l=Math.ceil(o.height/nv);this._downsampleDrawParameters.input=i,(h=s.coverage)==null||h.release();const c=this.fboCache.acquire(a,l,"highlight coverage",Vr.RG);return s.coverage=c,n.bindFramebuffer(c.fbo),n.bindTechnique(e,r,this._passParameters,this._downsampleDrawParameters),n.setViewport(0,0,a,l),n.screen.draw(),s}get test(){}};u([f()],qT.prototype,"produces",void 0),u([f()],qT.prototype,"consumes",void 0),u([f({constructOnly:!0})],qT.prototype,"techniques",void 0),qT=u([L("esri.views.3d.webgl-engine.effects.highlight.Highlight")],qT);let a0t=class{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}};function l0t(t){const e=new Uint8Array(128),i=(n,s)=>{e[n]=s},r=(n,s)=>{const o=4*n,a=4*n+64,{color:l}=s,c=s.haloColor??l;i(o+0,l.r),i(o+1,l.g),i(o+2,l.b),i(o+3,s.fillOpacity*l.a*255),i(a+0,c.r),i(a+1,c.g),i(a+2,c.b),i(a+3,s.haloOpacity*c.a*255)};return JRe(t,(n,s)=>{r(s,n.options)}),e}const tfe=new Array(rv),ife=new Array(rv);function JRe(t,e){const i=Math.min(t.length,rv);let r=rv;for(let s=i-1;s>=0;--s){const o=t.at(s);if(o){const a=o.name;tfe.includes(a,r)||(--r,tfe[r]=a,ife[r]=s)}}const n=rv-r;for(let s=0;s<n;++s){const o=ife[rv-n+s];e(t.at(o),s)}}let c0t=0;function QRe(t){let e=0;const i=Math.min(rv,t.length);for(let r=0;r<i;++r){const n=t.at(r);if(n){const{name:s,options:o}=n;e+=s.length;const{color:a,fillOpacity:l,haloColor:c,haloOpacity:h}=o;e+=a.r+((c==null?void 0:c.r)??1)+l+h}}{const r=t.at(0);if(r){const{shadowOpacity:n,shadowDifference:s,shadowColor:o}=r.options;e+=n+s+o.r}}return c0t+++(e>=0?0:1)}const u0t=new Uint8Array([0,1,2,2,1,3]);function KRe(t,e,i,r,n,s,o=0,a){const{highlightGroupIndices:l}=n;l.clear();const c=[];JRe(r,w=>{const{name:b}=w;l.set(b,c.length),c.push(b)});const h=l.size,{gl:p}=t;ln(n.highlightMixOrigin,o,0);let g=null;h>1&&(g=e.acquire(i.width,i.height,"highlight mix",Vr.RG),t.bindFramebuffer(g.fbo),t.clearFramebuffer(hs));const y=(g==null?void 0:g.getTexture())??null;n.highlightMixTexture=y,a();for(let w=0;w<h;++w)w>0&&(t.bindTexture(y,0),p.copyTexSubImage2D(vn.TEXTURE_2D,0,0,0,o,0,i.width,i.height),t.bindTexture(null,0)),t.clear(Xi.DEPTH),n.highlightLevel=w,n.highlightGroupName=c[w],s();g==null||g.release()}function rfe(t){var i;const e=new Set;for(let r=0;r<rv;++r){const n=(i=t.at(r))==null?void 0:i.name;n&&e.add(n)}return e.size}let e3e=class{constructor(e,i,r,n){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=n,this._id2glMaterialRef=new Oy}dispose(){this._textures.destroy()}acquire(e,i,r){this._ownMaterial(e);const n=e.produces.get(i);if(!(n!=null&&n(r)))return null;let s=this._id2glMaterialRef.get(r,e.id);if(s==null){const o=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});s=new h0t(o),this._id2glMaterialRef.set(r,e.id,s)}return s.ref(),s.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(Ht(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&de.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},h0t=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,St(this._refCnt>=0)}get referenced(){return this._refCnt>0}};var ux,_3;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(ux||(ux={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(_3||(_3={}));let pc=class extends Ry{constructor(){super(...arguments),this.space=ux.Screen,this.anchor=_3.Center,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.hideOnShortSegments=!1,this.hasCap=!1,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=ts.None,this.emissionSource=ko.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0,this.objectAndLayerIdColorInstanced=!1}get draped(){return this.space===ux.Draped}};u([le({count:ux.COUNT})],pc.prototype,"space",void 0),u([le({count:_3.COUNT})],pc.prototype,"anchor",void 0),u([le()],pc.prototype,"occluder",void 0),u([le()],pc.prototype,"hasSlicePlane",void 0),u([le()],pc.prototype,"writeDepth",void 0),u([le()],pc.prototype,"hideOnShortSegments",void 0),u([le()],pc.prototype,"hasCap",void 0),u([le()],pc.prototype,"hasTip",void 0),u([le()],pc.prototype,"vvSize",void 0),u([le()],pc.prototype,"vvColor",void 0),u([le()],pc.prototype,"vvOpacity",void 0),u([le()],pc.prototype,"hasOccludees",void 0),u([le()],pc.prototype,"terrainDepthTest",void 0),u([le()],pc.prototype,"cullAboveTerrain",void 0);const nfe=8;function d0t(t,e){const i=t.vertex;i.uniforms.add(new rt("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(k.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new fi("vvSizeMinSize",r=>r.vvSize.minSize),new fi("vvSizeMaxSize",r=>r.vvSize.maxSize),new fi("vvSizeOffset",r=>r.vvSize.offset),new fi("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(C`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(k.SIZE,"float"),i.code.add(C`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(k.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new Xh("vvOpacityValues",r=>r.vvOpacity.values,nfe),new Xh("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,nfe)),i.code.add(C`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(C`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(Pb,e),t.attributes.add(k.COLORFEATUREATTRIBUTE,"float"),i.code.add(C`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(k.COLOR,"vec4"),i.code.add(C`vec4 getColor(){
return applyOpacity(color);
}`))}let t3e=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${rd()}`,n=>n.dispose())}destroy(){for(const{texture:e}of this._repository.values())e.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:n}=r,s=n.usedMemory;this._orphanCache.put(i,n,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const n=this._orphanCache.pop(i)??this._createTexture(e),s=new p0t(n);return this._repository.set(i,s),n}},p0t=class{constructor(e){this.texture=e,this.refCount=1}};function f0t(t,e){return new t3e(i=>{const{encodedData:r,textureSize:n}=m0t(i),s=new jr;return s.internalFormat=kt.RGBA,s.width=n,s.height=1,s.wrapMode=Tr.REPEAT,new fr(t,s,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function m0t(t){const e=Wte(t),i=1/t.pixelRatio,r=i3e(t),n=r3e(t),s=(Math.floor(.5*(n-1))+.5)*i,o=[];let a=1;for(const g of e){for(let y=0;y<g;y++){const w=a*(Math.min(y,g-1-y)+.5)*i/s*.5+.5;o.push(w)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=new Uint8Array(4*r);let p=0;for(const g of c)rte(g,h,p),p+=4;return{encodedData:h,textureSize:r}}function Wte(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function i3e(t){if(t==null)return 1;const e=Wte(t);return Math.floor(e.reduce((i,r)=>i+r))}function r3e(t){return Wte(t).reduce((e,i)=>Math.max(e,i))}function g0t(t){return t==null?hs:t.length===4?t:_n(y0t,t[0],t[1],t[2],1)}const y0t=Ti();function _0t(t,e){e.stippleEnabled?v0t(t,e):w0t(t)}function v0t(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:n}=t;n.include(t1),e.draped||(Uv(r,e),r.uniforms.add(new rt("worldToScreenPerDistanceRatio",(s,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(C`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(C`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${x0t};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(C`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(C`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),uI(r),r.code.add(C`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),n.uniforms.add(new ht("stipplePatternTexture",s=>s.stippleTexture),new rt("stipplePatternSDFNormalizer",s=>b0t(s.stipplePattern)),new rt("stipplePatternPixelSizeInv",s=>1/n3e(s))),n.code.add(C`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(n.uniforms.add(new Yr("stippleOffColor",s=>g0t(s.stippleOffColor))),n.code.add(C`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(C`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function w0t(t){t.fragment.code.add(C`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function b0t(t){return t?(Math.floor(.5*(r3e(t)-1))+.5)/t.pixelRatio:1}function n3e(t){const e=t.stipplePattern;return e?i3e(t.stipplePattern)/e.pixelRatio:1}const x0t=C.float(.4),hR=64,s3e=hR/2,o3e=s3e/5,S0t=hR/o3e,I6t=.25;function T0t(t,e){const i=XAe(t,hR,s3e,o3e),r=new jr;return r.internalFormat=kt.RGBA,r.width=hR,r.height=hR,r.wrapMode=Tr.CLAMP_TO_EDGE,new fr(e,r,i)}function E0t(t,e){const i=t.vertex;uI(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.constants.add("markerSizePerLineWidth","float",S0t).code.add(C`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===ux.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new rt("perRenderPixelRatio",(r,n)=>n.camera.perRenderPixelRatio)),i.code.add(C`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var hx;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(hx||(hx={}));let ys=class extends Ry{constructor(){super(...arguments),this.capType=hx.BUTT,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.occluder=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.wireframe=!1,this.discardInvisibleFragments=!1,this.objectAndLayerIdColorInstanced=!1,this.textureCoordinateType=ts.None,this.emissionSource=ko.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0}};u([le({count:hx.COUNT})],ys.prototype,"capType",void 0),u([le()],ys.prototype,"hasSlicePlane",void 0),u([le()],ys.prototype,"hasPolygonOffset",void 0),u([le()],ys.prototype,"writeDepth",void 0),u([le()],ys.prototype,"draped",void 0),u([le()],ys.prototype,"stippleEnabled",void 0),u([le()],ys.prototype,"stippleOffColorEnabled",void 0),u([le()],ys.prototype,"stipplePreferContinuous",void 0),u([le()],ys.prototype,"roundJoins",void 0),u([le()],ys.prototype,"applyMarkerOffset",void 0),u([le()],ys.prototype,"vvSize",void 0),u([le()],ys.prototype,"vvColor",void 0),u([le()],ys.prototype,"vvOpacity",void 0),u([le()],ys.prototype,"falloffEnabled",void 0),u([le()],ys.prototype,"innerColorEnabled",void 0),u([le()],ys.prototype,"hasOccludees",void 0),u([le()],ys.prototype,"occluder",void 0),u([le()],ys.prototype,"terrainDepthTest",void 0),u([le()],ys.prototype,"cullAboveTerrain",void 0),u([le()],ys.prototype,"wireframe",void 0),u([le()],ys.prototype,"discardInvisibleFragments",void 0),u([le()],ys.prototype,"objectAndLayerIdColorInstanced",void 0);const v3=1;function a3e(t){const e=new or,{attributes:i,varyings:r,vertex:n,fragment:s}=e,{applyMarkerOffset:o,draped:a,output:l,capType:c,stippleEnabled:h,falloffEnabled:p,roundJoins:g,wireframe:y,innerColorEnabled:w}=t;e.include(fI),e.include(d0t,t),e.include(_0t,t),e.include(jee,t);const b=o&&!a;b&&(n.uniforms.add(new rt("markerScale",P=>P.markerScale)),e.include(E0t,{space:ux.World})),sy(n,t),n.uniforms.add(new Bs("inverseProjectionMatrix",(P,N)=>N.camera.inverseProjectionMatrix),new rs("nearFar",(P,N)=>N.camera.nearFar),new rt("miterLimit",P=>P.join!=="miter"?0:P.miterLimit),new Yr("viewport",(P,N)=>N.camera.fullViewport)),n.constants.add("LARGE_HALF_FLOAT","float",65500),i.add(k.POSITION,"vec3"),i.add(k.PREVPOSITION,"vec3"),i.add(k.NEXTPOSITION,"vec3"),i.add(k.SUBDIVISIONFACTOR,"float"),i.add(k.UV0,"vec2"),r.add("vColor","vec4"),r.add("vpos","vec3"),r.add("vLineDistance","float"),r.add("vLineWidth","float");const x=t.terrainDepthTest&&l===J.Color;x&&r.add("depth","float");const T=h;T&&r.add("vLineSizeInv","float");const M=c===hx.ROUND,$=h&&M,R=p||$;R&&r.add("vLineDistanceNorm","float"),M&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),n.code.add(C`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),n.code.add(C`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(C`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${x?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),uI(n),n.constants.add("aaWidth","float",h?0:1).main.add(C`
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${T?C`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),b&&n.main.add(C`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),n.main.add(C`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(h||M)&&n.main.add(C`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${M?C`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),n.main.add(C`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),g?n.main.add(C`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${h?C`min(1.0, subdivisionFactor * ${C.float((v3+2)/(v3+1))})`:C`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):n.main.add(C`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const I=c!==hx.BUTT;return n.main.add(C`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${I?C`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),n.main.add(C`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${R?C`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),M&&n.main.add(C`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),h&&(a?n.uniforms.add(new rt("worldToScreenRatio",(P,N)=>1/N.screenToPCSRatio)):n.main.add(C`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),n.main.add(C`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),a?n.main.add(C`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):n.main.add(C`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),n.uniforms.add(new rt("stipplePatternPixelSize",P=>n3e(P))),n.main.add(C`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),n.main.add(C`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${y&&!a?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }`),x&&e.include(hI,t),e.include(lm,t),e.include(aV,t),s.include(aM),s.main.add(C`
    discardBySlice(vpos);
    ${x?"terrainDepthTest(depth);":""}
  `),y?s.main.add(C`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(M&&s.main.add(C`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${C.float(fn)}) {
          discard;
        }
      `),$?s.main.add(C`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${C.float(fn)}, stippleCoverage);
      `):s.main.add(C`float stippleAlpha = getStippleAlpha();`),l!==J.ObjectAndLayerIdColor&&s.main.add(C`discardByStippleAlpha(stippleAlpha, ${C.float(fn)});`),s.uniforms.add(new Yr("intrinsicColor",P=>P.color)),s.main.add(C`vec4 color = intrinsicColor * vColor;`),w&&(s.uniforms.add(new Yr("innerColor",P=>P.innerColor??P.color),new rt("innerWidth",(P,N)=>P.innerWidth*N.camera.pixelRatio)),s.main.add(C`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),s.main.add(C`vec4 finalColor = blendStipple(color, stippleAlpha);`),p&&(s.uniforms.add(new rt("falloff",P=>P.falloff)),s.main.add(C`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),h||s.main.add(C`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),s.main.add(C`outputColorHighlightOID(finalColor, vpos);`),e}const C0t=Object.freeze(Object.defineProperty({__proto__:null,build:a3e,ribbonlineNumRoundJoinSubdivisions:v3},Symbol.toStringTag,{value:"Module"}));let M0t=class extends hr{constructor(e,i,r){super(e,i,new ar(C0t,()=>fe(()=>Promise.resolve().then(()=>uAt),void 0)),r,l3e),this.primitiveType=i.wireframe?ur.LINES:ur.TRIANGLE_STRIP}_makePipelineState(e,i){const{oitPass:r,output:n,hasOccludees:s,hasPolygonOffset:o}=e,a=r===qi.NONE,l=r===qi.FrontFace;return Pi({blending:e.output===J.Color?Hee(r):null,depthTest:{func:Wee(r)},depthWrite:Q$e(e),drawBuffers:n===J.Depth?{buffers:[Fa.NONE]}:Zz(r,n),colorWrite:Qi,stencilWrite:s?Sk:null,stencilTest:s?i?GZ:hte:null,polygonOffset:a||l?o?sfe:null:qee})}initializePipeline(e){if(e.occluder){const i=e.hasPolygonOffset?sfe:null;this._occluderPipelineTransparent=Pi({blending:gd,polygonOffset:i,depthTest:cde,depthWrite:null,colorWrite:Qi,stencilWrite:null,stencilTest:Qct,drawBuffers:e.output===J.Depth?{buffers:[Fa.NONE]}:null}),this._occluderPipelineOpaque=Pi({blending:gd,polygonOffset:i,depthTest:cde,depthWrite:null,colorWrite:Qi,stencilWrite:Zct,stencilTest:Jct,drawBuffers:e.output===J.Depth?{buffers:[Fa.NONE]}:null}),this._occluderPipelineMaskWrite=Pi({blending:null,polygonOffset:i,depthTest:Wct,depthWrite:null,colorWrite:null,stencilWrite:Sk,stencilTest:GZ,drawBuffers:e.output===J.Depth?{buffers:[Fa.NONE]}:null})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,i){if(e)return this._occludeePipeline;switch(i){case Ie.TRANSPARENT_OCCLUDER_MATERIAL:return this._occluderPipelineTransparent??super.getPipeline();case Ie.OCCLUDER_MATERIAL:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}};const sfe={factor:0,units:-4},l3e=new Map([[k.POSITION,0],[k.PREVPOSITION,1],[k.NEXTPOSITION,2],[k.SUBDIVISIONFACTOR,3],[k.UV0,4],[k.COLOR,5],[k.COLORFEATUREATTRIBUTE,5],[k.SIZE,6],[k.SIZEFEATUREATTRIBUTE,6],[k.OPACITYFEATUREATTRIBUTE,7],[k.OBJECTANDLAYERIDCOLOR,8]]);var Tc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Tc||(Tc={}));let $0t=class extends qz{constructor(e){super(e,A0t),this._configuration=new ys,this.vertexAttributeLocations=l3e,this.produces=new Map([[Ie.OPAQUE_MATERIAL,i=>Pz(i)||rM(i)&&this.parameters.renderOccluded===Dr.OccludeAndTransparentStencil],[Ie.OPAQUE_MATERIAL_WITHOUT_NORMALS,i=>Lz(i)],[Ie.OCCLUDER_MATERIAL,i=>aZ(i)&&this.parameters.renderOccluded===Dr.OccludeAndTransparentStencil],[Ie.TRANSPARENT_OCCLUDER_MATERIAL,i=>aZ(i)&&this.parameters.renderOccluded===Dr.OccludeAndTransparentStencil],[Ie.TRANSPARENT_MATERIAL,i=>i===J.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==Dr.OccludeAndTransparentStencil],[Ie.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,i=>i===J.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==Dr.OccludeAndTransparentStencil],[Ie.DRAPED_MATERIAL,i=>wet(i)]])}getConfiguration(e,i){this._configuration.output=e,this._configuration.oitPass=i.oitPass,this._configuration.draped=i.slot===Ie.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==J.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&I0t(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=i.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===Dr.OccludeAndTransparentStencil,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration}get visible(){var e;return this.parameters.color[3]>=fn||this.parameters.stipplePattern!=null&&(((e=this.parameters.stippleOffColor)==null?void 0:e[3])??0)>fn}intersectDraped({attributes:e,screenToWorldRatio:i},r,n,s,o,a){if(!n.options.selectionMode)return;const l=e.get(k.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const T=e.get(k.SIZEFEATUREATTRIBUTE).data[0];c*=Oe(this.parameters.vvSize.offset[0]+T*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=s[0],p=s[1],g=(c/2+4)*i;let y=Number.MAX_VALUE,w=0;const b=e.get(k.POSITION).data,x=fY(this.parameters,e)?b.length-2:b.length-5;for(let T=0;T<x;T+=3){const M=b[T],$=b[T+1],R=(T+3)%b.length,I=h-M,P=p-$,N=b[R]-M,V=b[R+1]-$,U=Oe((N*I+V*P)/(N*N+V*V),0,1),B=N*U-I,W=V*U-P,j=B*B+W*W;j<y&&(y=j,w=T/3)}y<g*g&&o(a.dist,a.normal,w,!1)}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!rKe(i))return void de.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(k.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const M=a.get(k.SIZEFEATUREATTRIBUTE).data[0];c*=Oe(this.parameters.vvSize.offset[0]+M*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(k.SIZE)&&(c*=a.get(k.SIZE).data[0]);const h=r.camera,p=P0t;Ha(p,r.point);const g=c*h.pixelRatio/2+4*h.pixelRatio;ve(B$[0],p[0]-g,p[1]+g,0),ve(B$[1],p[0]+g,p[1]+g,0),ve(B$[2],p[0]+g,p[1]-g,0),ve(B$[3],p[0]-g,p[1]-g,0);for(let M=0;M<4;M++)if(!h.unprojectFromRenderScreen(B$[M],ng[M]))return;bp(h.eye,ng[0],ng[1],s8),bp(h.eye,ng[1],ng[2],o8),bp(h.eye,ng[2],ng[3],a8),bp(h.eye,ng[3],ng[0],l8);let y=Number.MAX_VALUE,w=0;const b=fY(this.parameters,a)?l.length-2:l.length-5;for(let M=0;M<b;M+=3){$l[0]=l[M]+i[12],$l[1]=l[M+1]+i[13],$l[2]=l[M+2]+i[14];const $=(M+3)%l.length;if(Ol[0]=l[$]+i[12],Ol[1]=l[$+1]+i[13],Ol[2]=l[$+2]+i[14],us(s8,$l)<0&&us(s8,Ol)<0||us(o8,$l)<0&&us(o8,Ol)<0||us(a8,$l)<0&&us(a8,Ol)<0||us(l8,$l)<0&&us(l8,Ol)<0)continue;if(h.projectToRenderScreen($l,N1),h.projectToRenderScreen(Ol,F1),N1[2]<0&&F1[2]>0){Ae(Sf,$l,Ol);const I=h.frustum,P=-us(I[mo.NEAR],$l)/Te(Sf,I[mo.NEAR]);ue(Sf,Sf,P),xe($l,$l,Sf),h.projectToRenderScreen($l,N1)}else if(N1[2]>0&&F1[2]<0){Ae(Sf,Ol,$l);const I=h.frustum,P=-us(I[mo.NEAR],Ol)/Te(Sf,I[mo.NEAR]);ue(Sf,Sf,P),xe(Ol,Ol,Sf),h.projectToRenderScreen(Ol,F1)}else if(N1[2]<0&&F1[2]<0)continue;N1[2]=0,F1[2]=0;const R=rSe(GN(N1,F1,lfe),p);R<y&&(y=R,ye(ofe,$l),ye(afe,Ol),w=M/3)}const x=r.rayBegin,T=r.rayEnd;if(y<g*g){let M=Number.MAX_VALUE;if(sHe(GN(ofe,afe,lfe),GN(x,T,L0t),D1)){Ae(D1,D1,x);const $=Fe(D1);ue(D1,D1,1/$),M=$/Nr(x,T)}o(M,D1,w,!1)}}get _layout(){const e=Zc().vec3f(k.POSITION).vec3f(k.PREVPOSITION).vec3f(k.NEXTPOSITION).f32(k.SUBDIVISIONFACTOR).vec2f(k.UV0);return this.parameters.vvSize?e.f32(k.SIZEFEATUREATTRIBUTE):e.f32(k.SIZE),this.parameters.vvColor?e.f32(k.COLORFEATUREATTRIBUTE):e.vec4f(k.COLOR),this.parameters.vvOpacity&&e.f32(k.OPACITYFEATUREATTRIBUTE),_d()&&e.vec4u8(k.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new R0t(this._layout,this.parameters)}createGLMaterial(e){return new O0t(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},O0t=class extends zee{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.acquireTechnique(M0t,e)}},A0t=class extends jot{constructor(){super(...arguments),this.width=0,this.color=WU,this.join="miter",this.cap=hx.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1}get transparent(){var e;return this.color[3]<1||this.stipplePattern!=null&&(((e=this.stippleOffColor)==null?void 0:e[3])??0)<1}},R0t=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=v3+r}}_isClosed(e){return fY(this._parameters,e)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.get(k.POSITION).indices.length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?r:r-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,i,r,n,s,o){var X,ge,ae;const a=D0t,l=N0t,c=F0t,h=r.get(k.POSITION),p=h.indices,g=h.data.length/3,y=(X=r.get(k.DISTANCETOSTART))==null?void 0:X.data;p&&p.length!==2*(g-1)&&console.warn("RibbonLineMaterial does not support indices");const w=((ge=r.get(k.SIZEFEATUREATTRIBUTE))==null?void 0:ge.data[0])??((ae=r.get(k.SIZE))==null?void 0:ae.data[0])??1;let b=[1,1,1,1],x=0;const T=this.vertexBufferLayout.fields.has(k.COLORFEATUREATTRIBUTE);T?x=r.get(k.COLORFEATUREATTRIBUTE).data[0]:r.has(k.COLOR)&&(b=r.get(k.COLOR).data);const M=this.vertexBufferLayout.fields.has(k.OPACITYFEATUREATTRIBUTE),$=M?r.get(k.OPACITYFEATUREATTRIBUTE).data[0]:0,R=new Float32Array(s.buffer),I=_d()?new Uint8Array(s.buffer):null,P=this.vertexBufferLayout.stride/4;let N=o*P;const V=N;let U=0;const B=y?(z,he,ce)=>U=y[ce]:(z,he,ce)=>U+=Nr(z,he),W=(z,he,ce,G,K,Se,Ee)=>{if(R[N++]=he[0],R[N++]=he[1],R[N++]=he[2],R[N++]=z[0],R[N++]=z[1],R[N++]=z[2],R[N++]=ce[0],R[N++]=ce[1],R[N++]=ce[2],R[N++]=G,R[N++]=Ee,R[N++]=K,R[N++]=w,T)R[N++]=x;else{const Ce=Math.min(4*Se,b.length-4);R[N++]=b[Ce],R[N++]=b[Ce+1],R[N++]=b[Ce+2],R[N++]=b[Ce+3]}M&&(R[N++]=$),_d()&&(n&&(I[4*N]=n[0],I[4*N+1]=n[1],I[4*N+2]=n[2],I[4*N+3]=n[3]),N++)};N+=P,ve(l,h.data[0],h.data[1],h.data[2]),e&&Mt(l,l,e);const j=this._isClosed(r);if(j){const z=h.data.length-3;ve(a,h.data[z],h.data[z+1],h.data[z+2]),e&&Mt(a,a,e)}else ve(c,h.data[3],h.data[4],h.data[5]),e&&Mt(c,c,e),W(l,l,c,1,Tc.LEFT_CAP_START,0,0),W(l,l,c,1,Tc.RIGHT_CAP_START,0,0),ye(a,l),ye(l,c);const Q=j?0:1,Z=j?g:g-1;for(let z=Q;z<Z;z++){const he=(z+1)%g*3;ve(c,h.data[he],h.data[he+1],h.data[he+2]),e&&Mt(c,c,e),B(a,l,z),W(a,l,c,0,Tc.LEFT_JOIN_END,z,U),W(a,l,c,0,Tc.RIGHT_JOIN_END,z,U);const ce=this.numJoinSubdivisions;for(let G=0;G<ce;++G){const K=(G+1)/(ce+1);W(a,l,c,K,Tc.LEFT_JOIN_END,z,U),W(a,l,c,K,Tc.RIGHT_JOIN_END,z,U)}W(a,l,c,1,Tc.LEFT_JOIN_START,z,U),W(a,l,c,1,Tc.RIGHT_JOIN_START,z,U),ye(a,l),ye(l,c)}j?(ve(c,h.data[3],h.data[4],h.data[5]),e&&Mt(c,c,e),U=B(a,l,Z),W(a,l,c,0,Tc.LEFT_JOIN_END,Q,U),W(a,l,c,0,Tc.RIGHT_JOIN_END,Q,U)):(U=B(a,l,Z),W(a,l,l,0,Tc.LEFT_CAP_END,Z,U),W(a,l,l,0,Tc.RIGHT_CAP_END,Z,U)),n8(R,V+P,R,V,P),N=n8(R,N-P,R,N,P),this._parameters.wireframe&&this._addWireframeVertices(s,V,N,P)}_addWireframeVertices(e,i,r,n){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=n8(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function n8(t,e,i,r,n){for(let s=0;s<n;s++)i[r++]=t[e++];return r}function fY(t,e){return t.isClosed?e.get(k.POSITION).indices.length>2:!1}function I0t(t){return t.anchor===_3.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const $l=A(),Ol=A(),Sf=A(),D1=A(),P0t=A(),N1=Ip(),F1=Ip(),ofe=A(),afe=A(),lfe=Uy(),L0t=Uy(),D0t=A(),N0t=A(),F0t=A(),B$=[Ip(),Ip(),Ip(),Ip()],ng=[A(),A(),A(),A()],s8=dn(),o8=dn(),a8=dn(),l8=dn();let c3e=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+rd(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const h=zk(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const r=this._gridSize,n=Math.round(e[0]/r),s=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*r;if(Ae(To,e,i.vec3),To[0]=Math.abs(To[0]),To[1]=Math.abs(To[1]),To[2]=Math.abs(To[2]),To[0]<c&&To[1]<c&&To[2]<c){if(l){const h=Math.max(...To);if(Ae(To,e,l.vec3),To[0]=Math.abs(To[0]),To[1]=Math.abs(To[1]),To[2]=Math.abs(To[2]),Math.max(...To)<h)return l}return i}return l||(l=zk(n*r,s*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=Ri(1,1,0,1)){const r=window.view,n=r._stage,s=i.toString();if(!this._objects.has(s)){this._material=new $0t({width:2,color:i}),n.add(this._material);const y=new oRe(n,{pickable:!1}),w=new lAe({castShadow:!1});n.add(w),y.add(w),this._objects.set(s,w)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let y=0;y<l;y++)c[3*y]=e[0]+(1&a[y]?p:-p),c[3*y+1]=e[1]+(2&a[y]?p:-p),c[3*y+2]=e[2]+(4&a[y]?p:-p),y>0&&h.push(y-1,y);io(c,this._originSR,0,c,r.renderSpatialReference,0,l);const g=new rc(this._material,[[k.POSITION,new Ji(c,h,3,!0)]],null,Fo.Line);n.add(g),o.addGeometry(g)}get test(){}};const To=A();let k0t=class{constructor(e,i){this.width=e,this.height=i}},Zte=class{constructor(e){this.shadowMap=e,this.slot=Ie.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=qi.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new Jr,this._inverseViewport=Yt(),this._oldLighting=new RG,this._newLighting=new RG,this._fadedLighting=new RG,this._lighting=this._newLighting,this.ssr=new U0t,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlightMixTexture=null,this.highlightGroupName=null,this.highlightGroupIndices=new Map,this.highlightLevel=0,this.highlightMixOrigin=Yt(),this.hudRenderStyle=pl.Occluded,this.clouds=new Byt,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,i,r,n){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=i,this._newLighting.globalFactor=r,this._newLighting.set(e),n===Rb.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}},U0t=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=ut()}},u3e=class{constructor(e,i){this.rctx=e,this.lastFrameCamera=new Jr,this.output=J.Color,this.renderOccludedMask=xE,this.bind=new Zte(i),this.bind.alignPixelEnabled=!0}},z0t=class extends u3e{constructor(e,i,r){super(e,i),this.techniques=r,this.time=0}};const xE=Dr.Occlude|Dr.OccludeAndTransparent|Dr.OccludeAndTransparentStencil;let nA=class extends Jr{constructor(){super(...arguments),this._projectionMatrix=ut()}get projectionMatrix(){return this._projectionMatrix}};u([f()],nA.prototype,"_projectionMatrix",void 0),u([f({readOnly:!0})],nA.prototype,"projectionMatrix",null),nA=u([L("esri.views.3d.webgl-engine.lib.CascadeCamera")],nA);var dx;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(dx||(dx={}));let AD=class{constructor(){this.camera=new nA,this.lightMat=ut()}},V0t=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},Yte=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new V0t,this._projectionView=ut(),this._projectionViewInverse=ut(),this._modelViewLight=ut(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Ti(),this._cascades=[new AD,new AD,new AD,new AD],this._lastOrigin=null,this._maxTextureWidth=Math.min(pe("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return _n(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=Lr(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Oe(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)u8[e]=this._cascades[e];return u8.length=this._numCascades,u8}start(e,i,r,n,s){St(this.enabled);const{near:o,far:a}=W0t(r);this._computeCascadeDistances(o,a,n),this._textureHeight=this._computeTextureHeight(e,s,n),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,i);this._lastOrigin=null,this.clear()}finish(){var e;St(this.enabled),(e=this._handle)==null||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!Qs(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||A(),ye(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){hd(ffe,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)mfe[16*i+r]=ffe[r]}}return mfe}moveSnapshot(e){var i,r;St(this.enabled),(i=this._handle)==null||i.detachDepth(),(r=this._snapshots[e])==null||r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var l,c,h,p;const i=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!i)return;(h=this._snapshots[e])==null||h.release();const{width:r,height:n}=i,s=e===dx.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,n,s,Vr.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture((p=this._snapshots[e])==null?void 0:p.getTexture(),fr.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(vn.TEXTURE_2D,0,0,0,0,0,r,n),o.bindTexture(a,fr.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var i;return this.enabled?(i=this._snapshots[e])==null?void 0:i.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(Xi.COLOR|Xi.DEPTH)}_computeTextureHeight(e,i,r){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,s=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=my(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*s)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return Bpt(a/this._numCascades)}_ensureFbo(){var e,i,r,n,s;((i=(e=this._handle)==null?void 0:e.fbo)==null?void 0:i.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((n=this._handle)==null||n.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",Vr.RGBA4)),(s=this._handle)==null||s.acquireDepth(Ro.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=Lr(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var e;this._fbos.rctx.bindFramebuffer((e=this._handle)==null?void 0:e.fbo)}_constructCascade(e,i,r,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);St(l<c);for(let y=0;y<8;++y){_n(cfe,y%4==0||y%4==3?-1:1,y%4==0||y%4==1?-1:1,y<4?l:c,1);const w=Dh[y];zc(w,cfe,this._projectionViewInverse),w[0]/=w[3],w[1]/=w[3],w[2]/=w[3]}od(c8,Dh[0]),s.camera.viewMatrix=hd(B0t,this._modelViewLight,c8);for(let y=0;y<8;++y)Mt(Dh[y],Dh[y],s.camera.viewMatrix);let h=Dh[0][2],p=Dh[0][2];for(let y=1;y<8;++y)h=Math.min(h,Dh[y][2]),p=Math.max(p,Dh[y][2]);h-=200,p+=200,s.camera.near=-p,s.camera.far=-h,q0t(r,n,h,p,s.camera),fs(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const g=this._textureHeight;s.camera.viewport=[e*g,0,g,g]}_setupMatrices(e,i){fs(this._projectionView,e.projectionMatrix,e.viewMatrix),Yl(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===ct.Global?e.eye:ve(c8,0,0,1);SU(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const n=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(iKe(i/e,4)),n);const s=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Bt(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get test(){}};const B0t=ut(),cfe=Ti(),Dh=[];for(let t=0;t<8;++t)Dh.push(Ti());const ufe=Yt(),hfe=Yt(),j0t=Yt(),dfe=Yt(),pfe=Yt(),c8=A(),u8=[],ffe=ut(),mfe=Js.concat(Js,Js,Js,Js),uu=Yt(),jS=Yt(),k1=[Yt(),Yt(),Yt(),Yt()],Hs=Yt(),h8=Yt(),j0=Yt(),j$=Yt(),GS=Yt(),HS=Yt(),RD=Yt();function G0t(t,e,i,r,n,s,o,a){ln(uu,0,0);for(let I=0;I<4;++I)i_(uu,uu,t[I]);U_(uu,uu,.25),ln(jS,0,0);for(let I=4;I<8;++I)i_(jS,jS,t[I]);U_(jS,jS,.25),jh(k1[0],t[4],t[5],.5),jh(k1[1],t[5],t[6],.5),jh(k1[2],t[6],t[7],.5),jh(k1[3],t[7],t[4],.5);let l=0,c=V5(k1[0],uu);for(let I=1;I<4;++I){const P=V5(k1[I],uu);P<c&&(c=P,l=I)}ey(Hs,k1[l],t[l+4]);const h=Hs[0];let p,g;Hs[0]=-Hs[1],Hs[1]=h,ey(h8,jS,uu),aa(h8,Hs)<0&&FTe(Hs,Hs),jh(Hs,Hs,h8,i),B7(Hs,Hs),p=g=aa(ey(j0,t[0],uu),Hs);for(let I=1;I<8;++I){const P=aa(ey(j0,t[I],uu),Hs);P<p?p=P:P>g&&(g=P)}Ha(r,uu),U_(j0,Hs,p-e),i_(r,r,j0);let y=-1,w=1,b=0,x=0;for(let I=0;I<8;++I){ey(j$,t[I],r),B7(j$,j$);const P=Hs[0]*j$[1]-Hs[1]*j$[0];P>0?P>y&&(y=P,b=I):P<w&&(w=P,x=I)}xS(y>0,"leftArea"),xS(w<0,"rightArea"),U_(GS,Hs,p),i_(GS,GS,uu),U_(HS,Hs,g),i_(HS,HS,uu),RD[0]=-Hs[1],RD[1]=Hs[0];const T=CL(r,t[x],HS,i_(j0,HS,RD),1,n),M=CL(r,t[b],HS,j0,1,s),$=CL(r,t[b],GS,i_(j0,GS,RD),1,o),R=CL(r,t[x],GS,j0,1,a);xS(T,"rayRay"),xS(M,"rayRay"),xS($,"rayRay"),xS(R,"rayRay")}function ji(t,e){return 3*e+t}const gfe=Yt();function fc(t,e){return ln(gfe,t[e],t[e+3]),gfe}const Al=Yt(),ft=In();function H0t(t,e,i,r,n){ey(Al,i,r),U_(Al,Al,.5),ft[0]=Al[0],ft[1]=Al[1],ft[2]=0,ft[3]=Al[1],ft[4]=-Al[0],ft[5]=0,ft[6]=Al[0]*Al[0]+Al[1]*Al[1],ft[7]=Al[0]*Al[1]-Al[1]*Al[0],ft[8]=1,ft[ji(0,2)]=-aa(fc(ft,0),t),ft[ji(1,2)]=-aa(fc(ft,1),t);let s=aa(fc(ft,0),i)+ft[ji(0,2)],o=aa(fc(ft,1),i)+ft[ji(1,2)],a=aa(fc(ft,0),r)+ft[ji(0,2)],l=aa(fc(ft,1),r)+ft[ji(1,2)];s=-(s+a)/(o+l),ft[ji(0,0)]+=ft[ji(1,0)]*s,ft[ji(0,1)]+=ft[ji(1,1)]*s,ft[ji(0,2)]+=ft[ji(1,2)]*s,s=1/(aa(fc(ft,0),i)+ft[ji(0,2)]),o=1/(aa(fc(ft,1),i)+ft[ji(1,2)]),ft[ji(0,0)]*=s,ft[ji(0,1)]*=s,ft[ji(0,2)]*=s,ft[ji(1,0)]*=o,ft[ji(1,1)]*=o,ft[ji(1,2)]*=o,ft[ji(2,0)]=ft[ji(1,0)],ft[ji(2,1)]=ft[ji(1,1)],ft[ji(2,2)]=ft[ji(1,2)],ft[ji(1,2)]+=1,s=aa(fc(ft,1),e)+ft[ji(1,2)],o=aa(fc(ft,2),e)+ft[ji(2,2)],a=aa(fc(ft,1),i)+ft[ji(1,2)],l=aa(fc(ft,2),i)+ft[ji(2,2)],s=-.5*(s/o+a/l),ft[ji(1,0)]+=ft[ji(2,0)]*s,ft[ji(1,1)]+=ft[ji(2,1)]*s,ft[ji(1,2)]+=ft[ji(2,2)]*s,s=aa(fc(ft,1),e)+ft[ji(1,2)],o=aa(fc(ft,2),e)+ft[ji(2,2)],a=-o/s,ft[ji(1,0)]*=a,ft[ji(1,1)]*=a,ft[ji(1,2)]*=a,n[0]=ft[0],n[1]=ft[1],n[2]=0,n[3]=ft[2],n[4]=ft[3],n[5]=ft[4],n[6]=0,n[7]=ft[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=ft[6],n[13]=ft[7],n[14]=0,n[15]=ft[8]}function q0t(t,e,i,r,n){const s=1/Dh[0][3],o=1/Dh[4][3];St(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(Ga(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,G0t(Dh,a,l,ufe,hfe,j0t,dfe,pfe),H0t(ufe,hfe,dfe,pfe,n.projectionMatrix),n.projectionMatrix[10]=2/(i-r),n.projectionMatrix[14]=-(i+r)/(i-r)}function W0t(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}let bu=class extends Ne{constructor(e){super(e),this._pending=new Z0t,this._changes=new gZ,this._renderers=new Map,this._sortedRenderers=new mi,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._sortedRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const e of this._renderers.values())if(e.numGeometries!==0&&!e.queryRenderOccludedState(Dr.Occlude))return!0;return!1}get isEmpty(){return!this.updating&&this._renderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._renderers.get(e)}get sortedRenderers(){return this._sortedRenderers}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=cMe(this._changes);let i=!1;return e.forEach((r,n)=>{let s=this._renderers.get(n);!s&&r.adds.length>0&&(s=new lR({material:n}),s.initializeRenderContext(this.rendererContext.pluginContext,this._materials),this._renderers.set(n,s),i=!0),s&&(s.modify(r),s.numGeometries===0&&(this._renderers.delete(n),s.destroy(),i=!0))}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),this._hasHighlights=ny(this._renderers,r=>{const n=r.produces.get(Ie.DRAPED_MATERIAL);return!!n&&n(J.Highlight)}),this._hasWater=ny(this._renderers,r=>{const n=r.produces.get(Ie.DRAPED_WATER);return!!n&&n(J.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of r)this._pending.adds.add(s);n&&this.notifyChange("updating"),i===On.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===On.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Po.TRANSFORMATION:case Po.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Po.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}precompile(e){return this._sortedRenderers.reduce((i,r)=>r.precompile(e)||i,!1)}render(e){this._sortedRenderers.forAll(i=>{const r=i.acquireTechniques(e);r&&(i.render(e,r),Dz(r))})}intersect(e,i,r,n,s){for(const o of this._geometries.values()){if(!n(o))continue;this._intersectRenderGeometry(o,r,i,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,s)),s++}return s}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let e=0;for(const i of this._renderers.values())i.drapedPriority=e++,this._sortedRenderers.push(i);this._sortedRenderers.sort((i,r)=>{var n,s,o,a;return((n=r.material)==null?void 0:n.renderPriority)===((s=i.material)==null?void 0:s.renderPriority)?i.drapedPriority-r.drapedPriority:(((o=r.material)==null?void 0:o.renderPriority)||0)-(((a=i.material)==null?void 0:a.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes)),this._changes.updates.filterInPlace(({renderGeometry:e})=>!this._pending.has(e)),this._pending.clear()}_intersectRenderGeometry(e,i,r,n,s,o){if(!e.visible||!e.material.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],d8[0]=r[0]-n,d8[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,d8,(l,c,h)=>{Y0t(i,h,o,e.material.renderPriority,s,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicGeometryChanged(r),i=r)}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(r),i=r)}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){}};u([f()],bu.prototype,"drapeSource",void 0),u([f()],bu.prototype,"updating",null),u([f()],bu.prototype,"rctx",null),u([f({constructOnly:!0})],bu.prototype,"rendererContext",void 0),u([f()],bu.prototype,"_materials",null),u([f()],bu.prototype,"_localOriginFactory",null),u([f({readOnly:!0})],bu.prototype,"isEmpty",null),u([f()],bu.prototype,"_renderers",void 0),u([f()],bu.prototype,"_geometries",void 0),bu=u([L("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],bu);let Z0t=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function Y0t(t,e,i,r,n,s,o){const a=new Omt(s,o,e),l=c=>{c.set(on.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((n.results.min.drapedLayerOrder==null||i>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Go.MIN&&(n.results.max.drapedLayerOrder==null||i<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Go.ALL){const c=pK(n.ray);l(c),n.results.all.push(c)}}const d8=Yt();let mY=class extends hr{constructor(e,i,r){super(e,i,new ar(Qyt,()=>fe(()=>Promise.resolve().then(()=>hAt),void 0)),r)}initializePipeline(e){return e.hasAlpha?Pi({blending:gd,colorWrite:Qi}):Pi({colorWrite:Qi})}},Xte=class extends Zu{constructor(){super(...arguments),this.hasAlpha=!1}};u([le()],Xte.prototype,"hasAlpha",void 0);let Jte=class extends Ar{constructor(){super(...arguments),this.overlayIndex=cs.INNER,this.opacity=1}};function h3e(){const t=new or;return t.include(xa),t.fragment.uniforms.add(new ht("tex",e=>e.texture)),t.fragment.uniforms.add(new Mm("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new rt("opacity",e=>e.opacity)),t.fragment.main.add(C`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),t}const X0t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Jte,build:h3e},Symbol.toStringTag,{value:"Module"}));let yfe=class extends hr{constructor(e,i,r){super(e,i,new ar(X0t,()=>fe(()=>Promise.resolve().then(()=>dAt),void 0)),r)}},Th=class extends nM{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Jte,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new mi,this._passParameters=new jte,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new Jr,this.worldToPCSRatio=1,this.events=new ns,this.longitudeCyclical=null,this.produces=new Map([[Ie.DRAPED_MATERIAL,i=>i!==J.Highlight||this.hasHighlights],[Ie.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const{view:e}=this,{_stage:i}=e,r=i.renderer.fboCache,n=i.renderView,{waterTextures:s,textures:o}=n;this._renderContext=new u3e(this._rctx,new Yte(r,e.state.viewingMode)),this.addHandles([oe(()=>s.updating,()=>this.events.emit("content-changed"),hi),oe(()=>this.spatialReference,c=>this._localOriginFactory=new c3e(c),hi),Vo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),oe(()=>QRe(this.view.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,hi)]),this._materials=new e3e(o,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));const{_bindParameters:a,_camera:l}=this;a.slot=Ie.DRAPED_MATERIAL,a.mainDepth=null,l.near=1,l.far=1e4,l.relativeElevation=null,a.camera=this._camera,a.oitPass=qi.NONE,a.updateLighting([new lee(XJ())],0,0,Rb.Immediate),this.addHandles(this.view.resourceController.scheduler.registerTask(xt.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=Ht(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this.view._stage.renderView.renderingContext}get _techniques(){return this.view._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(yfe)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||ny(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,bu)}createDrapeSourceRenderer(e,i,r){const n=this._renderers.get(e);n!=null&&n.destroy();const s=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(oe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&PA(e,i=>i.drapeTargetType===pY.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=PA(e,i=>i.drapeSourceType===j2.Features),this._hasDrapedRasterSource=PA(e,i=>i.drapeSourceType===j2.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new Lyt(this.view._stage.renderer.fboCache),this._overlays=[new Upe,new Upe]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Ht(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var i,r;if(e!=null)return e===dr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(i=this._renderTargets)==null?void 0:i.getTexture(dr.Color):(r=this._renderTargets)==null?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||i(n))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=ny(this._renderers,n=>n.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(kc,e=>e.updatePolicy===yv.SYNC)}get isEmpty(){return!Cn.OVERLAY_DRAW_DEBUG_TEXTURE&&!ny(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=dR,++this._techniques.precompiling;const i=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,i}renders(e){if(Cn.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==dr.Occluded&&e!==dr.Highlight)return!0;++this._techniques.precompiling;const i=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,i}get mode(){var e,i;return this.isEmpty?cm.Disabled:(e=this._renderTargets)!=null&&e.getTexture(dr.WaterNormal)?cm.EnabledWithWater:(i=this._renderTargets)!=null&&i.getTexture(dr.Color)?cm.Enabled:cm.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,this._bindParameters.highlightGroupName=null,++this._techniques.precompiling;for(const i of this._renderTargets.targets){if(i.content===dr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=i.output;this._renderContext.output=r,this._bindParameters.slot=r===J.Normal?Ie.DRAPED_WATER:Ie.DRAPED_MATERIAL,i.content===dr.Occluded&&(this._renderContext.renderOccludedMask=dR),this._sortedRenderers.forAll(({drapeSource:n,renderer:s})=>{i.content===dr.ColorNoRasterImage&&n.drapeSourceType===j2.RasterImage||s.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=xE}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const i of this._renderTargets.targets){if(i.content===dr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(cs.INNER,i,e),n=this._drawTarget(cs.OUTER,i,e);(r||n)&&i.fbo.generateMipMap()}}}_drawTarget(e,i,r){const n=this._overlays[e],s=n.canvasGeometries;if(s.numViews===0)return!1;const{contentPixelRatio:o}=r;this._screenToWorldRatio=o*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=i.output;if(this.isEmpty||a===J.Normal&&!this.hasWater||!n.hasSomeSizedView())return!1;const{_rctx:l,_bindParameters:c}=this;if(this._camera.pixelRatio=n.pixelRatio*o,this._renderContext.output=a,c.screenToWorldRatio=this._screenToWorldRatio,c.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,c.slot=a===J.Normal?Ie.DRAPED_WATER:Ie.DRAPED_MATERIAL,i.content===dr.Occluded&&(this._renderContext.renderOccludedMask=dR),c.highlightGroupName=null,!this.renders(i.content))return this._renderContext.renderOccludedMask=xE,!1;const{resolution:h}=n,p=e===cs.INNER?0:h;if(l.setViewport(p,0,h,h),this._bindTargetFBO(i),e===cs.INNER&&(l.setClearColor(0,0,0,0),l.clear(Xi.COLOR)),Cn.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==dr.Occluded&&i.content!==dr.Highlight){this._techniques.precompile(mY,gY);const g=this._techniques.acquire(mY,gY);for(let y=0;y<s.numViews;y++)this._setViewParameters(s.extents[y],n),this._ensureDebugPatternResources(n.resolution,Q0t[e]),l.bindTechnique(g,c,this._passParameters),l.screen.draw();g.release()}if(i.output===J.Highlight){const{fboCache:g}=this.view._stage.renderer,y=this._resolution;KRe(l,g,{width:y,height:y},this.view.highlights,c,()=>this._renderAllGeometry(e,i),p,()=>this._bindTargetFBO(i))}else this._renderAllGeometry(e,i);return l.bindFramebuffer(null),this._renderContext.renderOccludedMask=xE,!0}_renderAllGeometry(e,i){const r=this._overlays[e],n=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:s,renderer:o})=>{if(i.content===dr.ColorNoRasterImage&&s.drapeSourceType===j2.RasterImage)return;const{fullOpacity:a}=s,l=a!=null&&a<1&&i.output===J.Color&&this._bindTemporaryFBO();for(let c=0;c<n.numViews;c++)this._setViewParameters(n.extents[c],r),o.render(this._renderContext);if(l){this._bindTargetFBO(i),this._overlayParameters.texture=l.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=e;const c=this._techniques.acquire(yfe);this._rctx.bindTechnique(c,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),c.release(),l.release()}})}_bindTargetFBO(e){const i=this._resolution,r=2*i;e.fbo.bind(this._rctx,r,i)}_bindTemporaryFBO(){const e=this._resolution,i=2*e,r=this.view._stage.renderer.fboCache,n=r.acquire(i,e,"overlay tmp");return r.rctx.bindFramebuffer(n.fbo),r.rctx.clear(Xi.COLOR),n}get _resolution(){var e;return((e=this._overlays)==null?void 0:e[cs.INNER].resolution)??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,n){var o;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let s=0;for(const{renderer:a}of this._sortedRenderers)s=((o=a.intersect)==null?void 0:o.call(a,e,i,r,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,i=e.length;this._renderers.forEach((r,n)=>{const s=e.indexOf(n.layer),o=s>=0,a=n.renderGroup??(o?Uk.MapLayer:Uk.ViewLayer),l=i*a+(o?s:0);this._sortedRenderers.push(new J0t(n,r,l))}),this._sortedRenderers.sort((r,n)=>r.index-n.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],z1e(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),rQ(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=ny(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water"))}_ensureDebugPatternResources(e,i){if(ve(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let n=0;for(let o=0;o<e;o++)for(let a=0;a<e;a++){const l=Math.floor(a/10),c=Math.floor(o/10);l<2||c<2||10*l>e-20||10*c>e-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&l&&1&c?1&a^1&o?0:255:1&l^1&c?0:128)}const s=new jr(e);s.samplingMode=Mi.NEAREST,this._passParameters.texture=new fr(this._rctx,s,r)}get test(){}};u([f()],Th.prototype,"hasHighlights",void 0),u([f()],Th.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([f({constructOnly:!0})],Th.prototype,"view",void 0),u([f({readOnly:!0})],Th.prototype,"_techniques",null),u([f()],Th.prototype,"worldToPCSRatio",void 0),u([f()],Th.prototype,"spatialReference",void 0),u([f({type:Boolean,readOnly:!0})],Th.prototype,"updating",null),u([f()],Th.prototype,"isEmpty",null),u([f({readOnly:!0})],Th.prototype,"rendersOccludedDraped",null),Th=u([L("esri.views.3d.terrain.OverlayRenderer")],Th);let J0t=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const Q0t=[[1,.5,.5],[.5,.5,1]],rjt=-2,dR=Dr.OccludeAndTransparent,gY=new Xte;gY.hasAlpha=!0;function d3e(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.includes(".glsl")&&delete t[r]}}let _fe=class{constructor(e,i){this.screen=e,this.olid=i}};const p3e=1.3,K0t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let G0,Dl=class extends Ne{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=pe("esri-mobile")?2048:4096}initialize(){const e=this.view;this.renderer=new Th({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=pd(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([oe(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",()=>{var r;return(r=e._stage)==null?void 0:r.renderer.updateHasFlags()}),this.renderer.events.on("content-changed",i),oe(()=>e.state.camera.pixelRatio,i),oe(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),oe(()=>{var r,n,s;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(s=(n=e.pointsOfInterest)==null?void 0:n.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),oe(()=>{var r,n;return[(r=e.state)==null?void 0:r.pixelRatio,(n=e.state)==null?void 0:n.contentPixelRatio]},()=>this.setPlacementDirty(),xi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(xt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(kc,r.camera,Gt.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Gt.BACKGROUND,r)})]),e._stage.renderer.overlay=this}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.overlay=null),G0&&(G0.hide(),G0=null),this.renderer=Ye(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Cn.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?xr(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return p3e/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}render(){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._precompileShaders()?this._drawOverlays(Gt.UPDATE):null}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Ev(-20037508342787e-6,20037508342787e-6):new Ev(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,bu)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Gt.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return jo;const n=this._computeOverlayResolution(i);this._computeOverlayExtents(i,n,Tf),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Tf.stretch);const s=this._updateOverlay(cs.INNER,Tf.inner,n,1*Tf.pixelRatioAdjustment,Tf.mapUnitsPerPixel),o=Va(Tf.inner)/Va(Tf.outer),a=this._updateOverlay(cs.OUTER,Tf.outer,n,o*Tf.pixelRatioAdjustment,Tf.mapUnitsPerPixel);s!==Xf.EXTENT&&a!==Xf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),s===Xf.NONE&&a===Xf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,n=e.fullHeight/e.pixelRatio*i,s=Math.ceil(1.5*Math.max(r,n));return Math.min(my(s),this._maxResolution)}_updateOverlay(e,i,r,n,s){if(this.renderer.overlays.length===0)return Xf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,e_t(i,o.extent)&&r===o.resolution)return a===s?Xf.NONE:Xf.RERENDER_ONLY;xv(o.extent,i),o.resolution=r;const l=cwe(o.extent);return o.renderLocalOrigin=zk(l[0],l[1],0,"OV_"+this._latestOriginId++),Xf.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[cs.INNER],n=this.renderer.overlays[cs.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,cs.INNER,i),this._setTileOverlayData(s,cs.OUTER,i)):(this._clearTileOverlayData(cs.INNER,i),this._clearTileOverlayData(cs.OUTER,i))}else this._clearTileOverlayData(cs.INNER,i),this._clearTileOverlayData(cs.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[cs.INNER],n=this.renderer.overlays[cs.OUTER],s=this._pointIsInExtent(e,r.extent)?r:n;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[i].extent,s=Va(n),o=Uc(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,Va(e)/s,Uc(e)/o),r.setOffset(i,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}reloadShaders(){d3e(),this.setDrawTexturesDirty(),this.runTask(kc)}updateAnimation(e){return this.renderer.updateAnimation(e)&&(this._drawTexturesAnimateDirty=!0),this._drawTexturesAnimateDirty}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,n_t,i,r);if(s==null)return!1;const o=s.origin,a=xe(ID,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=Oe(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=ID;JC(XC(nz,xr(this.view.spatialReference).radius+l),rf(e.eye,e.viewForward),h),Ae(h,h,e.eye);const p=Cv.normalize(dSe(e.viewForward,h,e.viewRight))/e.fovY+.5,g=p<=0||p>=1?.5:n;r=c?g*p:p+g*(1-p)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(h),g=Ri(0,p,1,0),y=zc(g,g,e.projectionMatrix)[1],w=Oe(.5+.5*y,0,1);r=w===1||w===0?.5:c?w*n:1-(1-w)*n}return!!this._intersectGroundFromView(e,.5,r,i)&&Xb(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){var U;const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=A();this._findHorizonBasedPointOfInterest(e,s)||ye(s,n),Cn.OVERLAY_SHOW_CENTER?(G0==null&&(G0=new HT(this.view.graphics,"red")),G0.show(s,this._renderSR)):G0!=null&&G0.hide();const o=Math.max(.1,Nr(e.eye,s)),a=xy(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||tc(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&((U=this._spatialReference)==null?void 0:U.isGeographic),h=c&&this._spatialReference?1/xr(this._spatialReference).metersPerDegree:1,p=this.view.state.contentPixelRatio,g=e.perScreenPixelRatio/p*o*h;r.mapUnitsPerPixel=g/this._worldToPCSRatio,r.stretch=this._overlayStretch;let y=i*g/2*r.stretch,w=!1,b=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(y/=Math.cos(r9(s[1])),b=l[3]):(w=!0,y/=xr(this._spatialReference).metersPerDegree,b=90),y>=b&&(y=b,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let x=1;w&&(x=1/Math.max(.2,Math.cos(Math.abs(Wt(s[1])))),y*x>180&&(x=180/y),r.mapUnitsPerPixel*=x);const T=Math.log(2)/12;y=Math.exp(Math.round(Math.log(y)/T)*T);const M=y*x,$=32,R=.5*i/($*M),I=.5*i/($*y);s[0]=Math.round(s[0]*R)/R,s[1]=Math.round(s[1]*I)/I;const P=r.inner;P[0]=s[0]-M,P[1]=s[1]-y,P[2]=s[0]+M,P[3]=s[1]+y,this._isSpherical&&this._shiftExtentToFitBounds(P,1/0,b);const N=r.outer;if(6*M>Va(l))xv(N,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)N[0]=P[0]-M,N[1]=P[1]-y,N[2]=P[2]+M,N[3]=P[3]+y;else{tc(e.eye,this._renderSR,ID,this._spatialReference),ey(U1,s,ID);let B=-Math.atan2(U1[1],U1[0])+.125*Math.PI;B<0&&(B+=2*Math.PI);const W=Math.floor(B/(.25*Math.PI));KE(U1,K0t[W],2*y),U1[0]*=x,U1[2]*=x,GQ(N,P,U1)}if(this._isSpherical)N[0]=this._longitudeCyclical.clamp(N[0]),N[2]=this._longitudeCyclical.clamp(N[2]),N[1]=Math.max(N[1],-b),N[3]=Math.min(N[3],b);else{const B=w9(P,l,i_t),W=w9(N,l,r_t);Yoe(B,W)&&(N[2]=N[0],N[3]=N[1])}const V=Math.abs(P[2]-P[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,V),r.pixelRatioAdjustment=r.mapUnitsPerPixel/V}_precompileShaders(){return!!this.renderer.hasOverlays&&(this.renderer.precompileShaders(this.view.state),!0)}_drawOverlays(e,i=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const n=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),n!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(Gt.UPDATE),r?(this.surface.requestRender(e),e===Gt.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Gt.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):$U(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:Yoe(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,n=e.y;return r>i[0]&&r<i[2]&&n>i[1]&&n<i[3]}_shiftExtentToFitBounds(e,i,r){let n=0,s=0;e[0]<-i?n=e[0]+i:e[2]>i&&(n=i-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),c5(e,n,s)}get test(){}};function e_t(t,e){const r=Cn.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}u([f()],Dl.prototype,"_spatialReference",void 0),u([f({readOnly:!0})],Dl.prototype,"running",null),u([f()],Dl.prototype,"_placementDirty",void 0),u([f()],Dl.prototype,"_contentUpdated",void 0),u([f()],Dl.prototype,"_isSpherical",null),u([f()],Dl.prototype,"_worldToPCSRatio",null),u([f()],Dl.prototype,"renderer",void 0),u([f({constructOnly:!0})],Dl.prototype,"view",void 0),u([f({constructOnly:!0})],Dl.prototype,"surface",void 0),u([f()],Dl.prototype,"suspended",null),u([f()],Dl.prototype,"updating",null),u([f({type:Boolean})],Dl.prototype,"rendersOccludedDraped",null),Dl=u([L("esri.views.3d.terrain.OverlayManager")],Dl);let t_t=class{constructor(){this.inner=Zi(),this.outer=Zi(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=p3e}};const U1=Ti(),ID=A(),Tf=new t_t,i_t=Zi(),r_t=Zi(),n_t=zs();var Xf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Xf||(Xf={}));function px(t,e,i,r,n,s=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(n)),a=i*o,l=r*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,p=e*s;t[p]=vfe(c),t[p+1]=vfe(h)}function ajt(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let n=0;n<e;++n)px(i,n,t[r++],t[r++],t[r++]);return i}function ljt(t,e){const i=t.length/3,r=new Int16Array(2*i);let n=0;const s=A();for(let o=0;o<i;++o)s[0]=t[n++],s[1]=t[n++],s[2]=t[n++],Zl(s,s,e),px(r,o,s[0],s[1],s[2]);return r}function s_t(t,e,i,r=2){const n=i*r,s=wfe(e[n]),o=wfe(e[n+1]),a=1-Math.abs(s)-Math.abs(o);t[2]=a,a<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=o),Me(t,t)}function vfe(t){return Oe(Math.round(32767*t),-32767,32767)}function wfe(t){return Oe(t/32767,-1,1)}let o_t=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=fd(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=Lr(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,fd(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,n){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,n),i),xe(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:n,typedBufferStride:s}=this.vertexAttributes.normalCompressed;s_t(i,n,this.getEdgeAttributeIndex(e,r),s)}setEdgeNormalFromValues(e,i,r,n,s){this._setNormal(this.getEdgeAttributeIndex(e,i),r,n,s)}setEdgeVertexFromValuesRawPositionUV(e,i,r,n,s,o,a){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,n,s),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,n,s,o,a,l,c,h){const p=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(p,r,n,s),this._setUV(p,o,a),this._setNormal(p,l,c,h)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,n){const{typedBuffer:s,typedBufferStride:o}=this.vertexAttributes.normalCompressed;px(s,e,i,r,n,o)}_setUV(e,i,r){Wp(this.vertexAttributes.uv0,e,i,r)}getEdgeAttributeIndex(e,i){return qe(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};const bfe=16384;function Wp(t,e,i,r){t.setValues(e,i*bfe,r*bfe)}let a_t=class{constructor(){this.sinLonLUT=new Array(bO+1),this.cosLonLUT=new Array(bO+1),this.sinLatLUT=new Array(bO+1),this.cosLatLUT=new Array(bO+1)}update(e,i,r){const n=i[0],s=i[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},l_t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},f3e=class ZF{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Ye(this._current),this._next=Ye(this._next),this._waiting=Ye(this._waiting),this._delayed=Ye(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=ZF.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,_v.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==Un.FADING,s=e-this._fadeStart>=i;(r||n||s)&&(Ye(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=ZF.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=_v.Immediate){this._delayed=Ye(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=ZF.test.fadeMoment||performance.now();return i!==_v.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Ye(this._waiting),this._waiting=e))}get _fadeDuration(){const e=this._getFadeDuration();return this._waiting?.5*e:e}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var _v;f3e.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(_v||(_v={}));let Bk=class{constructor(e,i,r,n,s,o){this.texture=e,this.type=i,this.offsetAndScale=r,e.retain(),this.opacities=Qe(n,s,o)}destroy(){this.texture.release()}},c_t=class{constructor(){this._scales=Ri(-1,-1,-1,-1),this._offsets=Ri(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};var TC;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(TC||(TC={}));let m3e=class{constructor(){this._queue=new mi,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.leaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},u_t=class{constructor(){this._q=new mi}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.leaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function Db(t,e){if(e==null)return!1;const i=h_t(e);if((i==null?void 0:i.fullExtent)==null)return!1;const r=i.fullExtent,n=t.extent;if(r.xmin>n[2]||r.ymin>n[3]||r.xmax<n[0]||r.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=i.minScale;if(o>0&&s>1.00000001*o)return!1;const a=i.maxScale;return!(a>0&&s<.99999999*a)}function h_t(t){return dV(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale}:t.layer}function d_t(t){return!dV(t)&&t.layer&&"tilemapCache"in t.layer?t.layer.tilemapCache:null}function um(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function p_t(t,e,i=null){i==null||i.length===0?t===TC.BACK_TO_FRONT?e.sort(f_t):e.sort(m_t):e.sort((r,n)=>g_t(r,n,t,i))}function f_t(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function m_t(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function g3e(t,e,i){const r=t.screenDepth,n=e.screenDepth;return r<n?-i:r>n?i:um(t,e)}function g_t(t,e,i,r){return xfe(t,r)===xfe(e,r)?g3e(t,e,i):t?i:-i}function xfe(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function y_t(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function __t(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(y_t)}function v_t(t,e,i){let r=1,n=0,s=0;for(;t!==e;)if(r*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),1&t.lij[1]||(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,n,s,r)}function w_t(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let n=0;n<4;n++){const s=r.children[n];if(s&&s!==i)return!0}}return!1}function gjt(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,n=i?e:t,s=1<<n[0]-r[0];return Math.floor(n[1]/s)===r[1]&&Math.floor(n[2]/s)===r[2]}var pa;(function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.InvisibleWithDraped=2]="InvisibleWithDraped",t[t.Invisible=3]="Invisible",t[t.COUNT=4]="COUNT"})(pa||(pa={}));function b_t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(C`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(C`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(C`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function x_t(t,e){e.spherical?t.vertex.code.add(C`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(C`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(C`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(C`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function Qte(t){t.code.add(C`
    float lineFactorAtPosition(float value) {
      float pos = value * ${C.float(257)};
      if(pos < 0.5 || pos > ${C.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var hm;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(hm||(hm={}));let S_t=class extends gte{constructor(){super(...arguments),this.overlayOpacity=1}};function T_t(t,e){const{vertex:i,fragment:r,varyings:n}=t;n.add("vtc","vec2"),i.uniforms.add(new Sfe("texOffsetAndScale")),r.uniforms.add(new Tfe("tex")),r.uniforms.add(new p8("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(i.uniforms.add(new Sfe("nextTexOffsetAndScale")),n.add("nvtc","vec2"),r.uniforms.add(new Tfe("texNext")),r.uniforms.add(new p8("nextTexOpacities")),r.uniforms.add(new E_t("fadeFactor")));const o=e.tileBlendInput===hm.ColorComposite,a=e.tileBlendInput===hm.GridComposite;a&&r.include(Qte),o&&r.uniforms.add(new p8("backgroundColor")),i.code.add(C`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?C`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:C``}
  }`),r.code.add(C`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?C`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?C`backgroundColor`:C`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:C`return color;`}
    }`),s?r.code.add(C`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(C`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let E_t=class extends Mn{constructor(e){super(e,"float")}},p8=class extends Mn{constructor(e){super(e,"vec3")}},Sfe=class extends Mn{constructor(e){super(e,"vec4")}},Tfe=class extends Mn{constructor(e){super(e,"sampler2D")}},Kte=class extends S_t{};function y3e(t){const e=new or,{vertex:i,fragment:r,varyings:n}=e,{output:s,pbrMode:o,overlayMode:a,tileBorders:l,spherical:c,transparencyMode:h,screenSizePerspective:p}=t;e.include(Kz),e.include(lM,t),e.include(oy,t);const g=()=>{e.include(x_t,t),i.code.add(C`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};sy(i,t),e.include(tv,t);const y=h===pa.InvisibleWithDraped||h===pa.Invisible,w=a!==cm.Disabled,b=w&&y;switch(s){case J.ColorEmission:case J.Color:{e.include(T_t,t),e.include(wC,t),w&&(t.pbrMode=o===Ut.Simplified?Ut.TerrainWithWater:Ut.Water,e.include(V$,t),t.pbrMode=o);const x=a===cm.EnabledWithWater;x&&e.include(b_t,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),g(),p&&mk(i);const T=t.receiveShadows&&!t.renderOccluded;T&&e.include(tV,t),p&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),i.main.add(C`
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);
          vnormal = getNormal();
          vup = getLocalUp(position, localOrigin);
          ${Ge(x,C`forwardVertexTangent(vnormal);`)}

          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${Ge(w,"setOverlayVTC(uv);")}
          ${Ge(l,"forwardTextureCoordinates();")}
          ${Ge(p,C`vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
                 screenSizeDistanceToCamera = length(viewPos);
                 vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
                 screenSizeCosAngle = abs(viewSpaceNormal.z);`)}
          ${Ge(T,"forwardLinearDepth();")}`),e.include(lm,t),e.include(wC,t),e.include(sV,t),e.include(yte,t),Uv(r,t),oV(r),vC(r),r.uniforms.add(i.uniforms.get("localOrigin"),new fi("viewDirection",($,R)=>Me(Efe,ve(Efe,R.camera.viewMatrix[12],R.camera.viewMatrix[13],R.camera.viewMatrix[14])))),x&&r.uniforms.add(new ht("ovWaterTex",($,R)=>{var I;return(I=R.overlay)==null?void 0:I.getTexture(dr.WaterNormal)}),new O$e("view",($,R)=>hd(C_t,R.camera.viewMatrix,$.origin)));const M=.2;r.code.add(C`float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Om(r),Iy(r),r.main.add(C`
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${T?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":c?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${Ge(w,C`vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
                   vec4 overlayColor = overlayOpacity * overlayColorOpaque;
                   ${Ge(y,`if (overlayColor.a < ${C.float(fn)}) { discard; }`)}
                   vec4 groundColor = tileColor;
                   tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`)}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a < ${C.float(fn)}) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= ${C.float(M)};
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${o===Ut.Simplified||o===Ut.TerrainWithWater?C`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:C`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${Ge(x,C`vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
                   float waterNormalLength = length(overlayWaterMask);
                   if (waterNormalLength > 0.95) {
                     mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                     vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                     vec4 viewPosition = view*vec4(vpos, 1.0);
                     vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                     vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                     float opacity = sliced ? ${C.float(M)} : 1.0;
                     // un-gamma the ground color to mix in linear space
                     fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
                   }`)}
          ${Ge(p,C`float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0));
                   if (perspectiveScale <= 0.25) {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
                   } else if (perspectiveScale <= 0.5) {
                     fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
                   } else if (perspectiveScale >= 0.99) {
                     fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
                   } else {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
                   }`)}
          ${Ge(t.visualizeNormals,c?C`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`:C`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`)}
          ${Ge(l,C`vec2 dVuv = fwidth(vuv0);
                 vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
                 float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
                 fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`)}
          fragColor = highlightSlice(fragColor, vpos);`)}break;case J.Depth:b&&e.include(V$,t),i.main.add(C`
        ${Ge(b,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),r.main.add(`${Ge(b,`if (getCombinedOverlayColor().a < ${C.float(fn)}) discard;`)}`);break;case J.Shadow:case J.ShadowHighlight:case J.ShadowExcludeHighlight:case J.ViewshedShadow:e.include(pte,t),HZ(e),dte(e),i.main.add(C`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);`),r.main.add(C`outputDepth(linearDepth);`);break;case J.Normal:b&&e.include(V$,t),n.add("vnormal","vec3"),mk(i),g(),i.main.add(C`
        ${Ge(b,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);
        vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);`),r.main.add(C`
        ${Ge(b,`if (getCombinedOverlayColor().a < ${C.float(fn)}) discard;`)}
        vec3 normal = normalize(vnormal);
        if (gl_FrontFacing == false) {
          normal = -normal;
        }
        fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case J.Highlight:w&&e.include(V$,t),i.main.add(C`
        ${Ge(w,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),e.include(dI,t),r.main.add(C`
        ${Ge(w,C`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           outputAllHighlights(overlayHighlightTexel);`,"calculateOcclusionAndOutputHighlight();")}
      `)}if(s===J.ObjectAndLayerIdColor)if(w)t.pbrMode=Ut.Disabled,e.include(V$,t),t.pbrMode=o,i.main.add(C`gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());`),r.main.add(C`fragColor = getOverlayColorTexel(vtcOverlay);`);else{const x=h===pa.Opaque;i.main.add(C`${Ge(x,"gl_Position = transformPosition(proj, view, position);")}`),r.main.add(C`fragColor = vec4(0.0);`)}return e}const C_t=ut(),Efe=A(),M_t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Kte,build:y3e},Symbol.toStringTag,{value:"Module"}));let $_t=class extends hr{constructor(e,i,r){super(e,i,new ar(M_t,()=>fe(()=>Promise.resolve().then(()=>pAt),void 0)),r,_3e),this.type="TerrainTechnique",this.useStencil=!1}initializePipeline(e){return this._stencilPipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}_createPipeline(e,i){const{renderOccluded:r,output:n}=e,s=e.backfaceCullingEnabled&&!r;return Pi({blending:r?iM:null,culling:s?BK:null,depthTest:r?null:{func:gr.LESS},depthWrite:r?null:tI,colorWrite:Qi,stencilTest:i?Yct(Hu.IntegratedMeshMaskExcluded):null,drawBuffers:n===J.Depth?{buffers:[Fa.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};const _3e=new Map([[k.POSITION,0],[k.UV0,1],[k.NORMALCOMPRESSED,2]]);let O_t=class{constructor(){this.geometry=new o_t,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureOpacity=1,this._textureRef=new f3e(()=>this._tile.surface.fadeDuration),this.overlay=new c_t,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new l_t,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Xs&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)qe(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(c!=null&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return n}const s=r.level,o=zp[e];if(!i)return qe(((l=r.surface)==null?void 0:l.rootTiles)==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),n;if(i.loaded){const c=i,h=c.renderData.geometryState,p=s-c.level;if(qe(p>=0),p===0){const w=h.numVerticesPerSide-1;return Math.max(w,n)}const g=2**p,y=h.edgeResolutions[(e+2)%4]/g;return Math.max(1,y)}qe(!i.leaf);let a=n;return i.forAllSubtreeOnSide(Bte(o),c=>c===r||(c.loaded?(a=Math.max(a,2**(c.level-s)),!0):(qe(!c.leaf),!1))),a}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=a=>(a.loaded||a.level===e.level)&&(a==null?void 0:a.intersectsClippingArea),n=i.edgePeerNeighbors,s=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(zp[a],r),c=ib(e,l),h=((o=c==null?void 0:c.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,p=n[a],g=c!==ib(e,p),y=s[a]!==h;Xs&&l&&(qe(e.level>=l.level),qe(e.level-l.level<=Ds)),n[a]=l,(g||y)&&(s[a]=h,this._markEdgeDirty(a));const w=i.edgeResolutions[a],b=this._calculateEdgeResolution(a,l);qe(PR(b)),qe(b>=1),i.edgeResolutions[a]=b,w!==b&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const l=e.findNeighborTile(kk[a],r);i.cornerPeerNeighbors[a]=l;const c=ib(e,n[a]),h=ib(e,n[(a+1)%4]),p=ib(e,l);Gd[a]=p,Gd[(a+1)%4]=h,Gd[(a+2)%4]=e,Gd[(a+3)%4]=c,qe(Gd.some(b=>(b==null?void 0:b.loaded)||b===e));const g=Gd.reduce((b,x)=>Math.min(b,(x==null?void 0:x.level)??1/0),1/0);Gd.forEach((b,x)=>{b&&(b==null?void 0:b.level)>g&&(Gd[x]=null)}),qe(Gd.some(b=>(b==null?void 0:b.loaded)||b===e));const y=i.cornerNeighborCornerTiles,w=i.cornerNeighborCornerTileSamplerVersions;for(let b=0;b<4;++b){const x=Gd[b],T=(x==null?void 0:x.renderData.geometryState.samplerDataVersion)??-1,M=4*a+b,$=y[M]!==x,R=!$&&w[M]!==T;($||R)&&(y[M]=x,w[M]=T,this._markCornerDirty(a))}Xs&&qe(eie.some(b=>{var x;return((x=y[4*a+b])==null?void 0:x.loaded)||y[4*a+b]===e}))}Xs&&qe(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)Gd[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Xs&&qe(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(y=>y>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:n,geometryState:s}=this,o=!r||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=s.edgeResolutions.reduce((y,w)=>y+w+1,0),c=o||a&&l>((n==null?void 0:n.maxEdgeVertexCount)??0),h=!c&&a,p=!h&&(this.dirtyEdges!==0||a),g=!p&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):h?i.updateEdgeElevationsAndResolutions():p||g?i.updateEdgeElevations():g?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Ht(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r,n){const s=i?kt.RGBA:kt.RGB;return this._texture!=null&&(r===Un.FADING&&this._tile.surface.fadeDuration>0&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==e||this._texture.descriptor.pixelFormat!==s)&&this.releaseTexture(),this._texture==null&&(this._texture=n(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}reuseTexture(e,i){return!(!e||!this._texture)&&(e.setTextureReference(new Bk(this._texture,Un.FADING,i,this._textureOpacity,0,1)),!0)}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&R_t)}get samplerDataChanged(){return!!(this._modifiedFlags&I_t)}get clippingAreaChanged(){return!!(this._modifiedFlags&P_t)}get wireframeChanged(){return!!(this._modifiedFlags&L_t)}get dirtyEdges(){return this._modifiedFlags>>f8&15}get dirtyCorners(){return this._modifiedFlags>>m8&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>g8&15}_markCornerDirty(e){const i=1<<e<<m8;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<f8;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<g8;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<m8|15<<f8|15<<g8}updateGeometryState(){const e=this._elevationInfo,i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.minimumVerticesPerSide,n=Math.max(r,5);let s=i.clippingArea;i.intersectsClippingArea&&!i.withinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._modifiedFlags|=1,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),ym(o.clippingArea,s)||(this._modifiedFlags=4,o.clippingArea=s,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,n=e.gl;this._vao=new km(e,_3e,new Map([["geometry",Sd(i.layout)]]),new Map([["geometry",bs.createVertex(e,n.STATIC_DRAW,i.buffer)]]),bs.createIndex(e,n.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=_v.Immediate){(e==null?void 0:e.texture)===this._texture?this._textureOpacity=e.opacities[0]:this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(e){var i,r;return((i=this._textureRef.current)==null?void 0:i.texture)===e||((r=this._textureRef.next)==null?void 0:r.texture)===e&&this._textureRef.fadeFactor<1}get _elevationInfo(){var h;const e=this.geometryState.samplerData,i=this.tile.layerInfo[Qt.ELEVATION],r=i.length,n=new Array(r);let s=0,o=0,a=!1;for(let p=0;p<r;p++){const g=i[p],y=(h=g.upsampleInfo)==null?void 0:h.tile;if(y){const w=y.layerInfo[Qt.ELEVATION][p].data,b=w&&w.samplerData;e&&e[s]===b||(a=!0),n[s++]=b,o=Math.max(o,y.lij[0])}else if(g.data){const w=this.tile.surface.layerViewByIndex(p,Qt.ELEVATION);if(Db(this.tile,w)){const b=g.data;e&&e[s]===b.samplerData||(a=!0),n[s++]=b.samplerData,o=this.tile.level}}}e!=null&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r,n;const e=((i=this.intersectionData)==null?void 0:i.estimatedMemoryUsage)??0;return(((r=this.geometry.indices)==null?void 0:r.byteLength)??0)+(((n=this.geometry.vertexAttributes)==null?void 0:n.byteLength)??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Xs)return;const e=this.tile;if(!e.loaded||!e.intersectsClippingArea||e.level===0)return void qe(e==null?void 0:e.loaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=zp.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),n=e.level;qe(this.dirtyCorners===0),qe(this.dirtyEdges===0),qe(this.dirtyEdgeResolutions===0),qe(!this.numVerticesPerSideChanged),qe(!this.samplerDataChanged),qe(!this.clippingAreaChanged),qe(!this.wireframeChanged);const s=kk.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.loaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=s[a];qe(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}zp.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,G=>(G.level===n||(G==null?void 0:G.loaded))&&(G==null?void 0:G.intersectsClippingArea));if(!c){const G=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void qe(!G)}qe(c.loaded||c.level===e.level),qe(c===this.geometryState.edgePeerNeighbors[l]);const h=n-c.level;if(!c.loaded)return qe(!c.leaf),void qe(h===0);const p=c.renderData;qe(e.isEdgeNeighbor(c,a)),qe(h>=0);const g=2**h;if(h<0)return void qe(!1);const y=e.renderData,w=y.geometry,b=y.localOrigin,x=w.getEdgeCount(l),T=w.numVerticesPerSide-1,M=p.geometry;if(!M)return void qe(!1);const $=p.localOrigin,R=this.geometryState.edgePeerNeighbors[l];if(R!=null&&R.loaded){const G=R.renderData;qe(y.geometryState.edgePeerNeighborSamplerVersions[l]===G.geometryState.samplerDataVersion),qe(this.geometryState.edgePeerNeighborSamplerVersions[l]===G.geometryState.samplerDataVersion)}const I=(l+2)%4,P=M.getEdgeCount(I),N=x-1,V=P-1;qe(N*g===V,`Tile[${e.lij}]:e${l},res=${N} edgeRes mismatch with Neighbor[${c.lij}]:e${I},res=${V} (expected:${N*g})`);const U=e.extent,B=a===Tt.NORTH||a===Tt.SOUTH,W=P-1,j=W>>h,Q=x-1;if(j<1)return void qe(Q===1);qe(j===Q),qe(PR(j));const Z=M.numVerticesPerSide-1;qe(h>0||j===Math.max(Z,T));const X=e.getNeighborEdgeStartVertexIndex(l,c);qe(0<=X&&X<g);const ge=X*j;qe(0<=ge&&ge<=W-j);let ae=0,z=ge;w.getEdgeVertexPosition(l,Ef,b,0),w.getEdgeVertexPosition(l,Cf,b,x-1);const he=Nr(Ef,Cf),ce=Math.max(A_t,1e-4*he);for(let G=0;G<=j;++G){w.getEdgeVertexPosition(l,Ef,b,ae),M.getEdgeVertexPosition(I,Cf,$,z);const K=G/j,Se=B?U[0]+K*(U[2]-U[0]):a===Tt.WEST?U[0]:U[2],Ee=B?a===Tt.SOUTH?U[1]:U[3]:U[1]+K*(U[3]-U[1]),Ce=e.surface.extent;if(Ce==null||MU(Ce,Se,Ee)){const Le=Na(Ef,Cf),Ke=ua(Ef)-Ii.radius,Re=ua(Cf)-Ii.radius,ze=Le<ce;if(!ze){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${ae}/${x}] and [${c.lij}].edge${I}[${z}/${P}]`),Ce!=null&&console.warn("  surface extent= ",Ce," x,y=",Se,",",Ee);const li=A();Ae(li,y.localOrigin,p.localOrigin),ua(li)>0&&console.warn(`   localOrigins: ${y.localOrigin} vs ${p.localOrigin} d=${ua(li)} [${li}]`),(()=>{const He=En(Ef),Oi=En(Cf);e.updateEdgeElevations(),c.updateEdgeElevations(),w.getEdgeVertexPosition(l,Ef,b,ae),M.getEdgeVertexPosition(I,Cf,$,z);const Be=A();nr(Be,Ef,He),ua(Be)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${He} vs ${Ef} d=${ua(Be)} [${Be}]`),nr(Be,Cf,Oi),ua(Be)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Oi} vs ${Cf} d=${ua(Be)} [${Be}]`)})();const ti=w.getEdgeCount(l),zi=M.getEdgeCount(P);qe(ze,`Mismatch in tile [${e.lij}].edge[${l}][${ae}/${ti}] vs neighbor [${c.lij}].edge[${I}][${z}/${zi}] ${rg(Ef)} vs ${rg(Cf)}  dist=${Le} h(t|n|d)=${Ke}|${Re}|${Re-Ke}`)}w.getEdgeNormal(l,qS,ae),M.getEdgeNormal(I,WS,z),Me(Cfe,qS),Me(Mfe,WS);const vt=Te(Cfe,Mfe),Xt=1-vt<.01||!1||e===c;if(!Xt){const li=A();nr(li,qS,WS);const ti=()=>`Mismatch in tile edge normal ${Lpe(e.lij)} (${ae}/${x-1}) edge ${l} vs neighbor ${Lpe(c.lij)}  (${z}/${P-1}) nedge ${I} :${rg(qS)} vs ${rg(WS)}  dot = ${vt} : ${rg(li)}`;console.warn("Mismatch in tile edge normal: ",ti());{e.updateEdgeElevations(),c.updateEdgeElevations();const zi=A(),He=A();w.getEdgeNormal(l,zi,ae),M.getEdgeNormal(I,He,z),JE(qS,zi)||console.warn("Missing update in tile normal: ",rg(qS)," => ",rg(zi)),JE(WS,He)||console.warn("Missing update in neighbor normal: ",rg(WS)," => ",rg(He))}qe(Xt,ti())}}ae+=1,z+=1}})}};const Ef=A(),Cf=A(),qS=A(),WS=A(),Cfe=A(),Mfe=A(),A_t=1,Gd=[null,null,null,null];function ib(t,e){return e!=null&&e.loaded||e===t?e:null}const R_t=1,I_t=2,P_t=4,L_t=8,f8=4,m8=8,g8=12,eie=[0,1,2,3];let tie=class{get updating(){return!!this._tileRequested}init(e,i,r,n){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Un.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){var T;const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),{minLevel:n,maxLevel:s}=r.dataLevelRange,o=this._desiredMinLevelDelta,a=this._progressiveLevelModulo+o,l=this._scaleRangeEnabled?Db:()=>!0;let c=this.tile;const h=c.level;let p;const g=this._tileLayerInfo.upsampleInfo,y=((T=g==null?void 0:g.tile)==null?void 0:T.level)??-1,w=g!=null&&y-h>=o,b=d_t(r),x=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;c&&l(c,r)&&c.level>=n;){const M=c.level,$=h-M,R=c.layerInfo[i][e];if(R.data&&$>=o){(!w||M>y)&&this._setUpsampleTile(c),R.dataInvalidated&&(p=c);break}const I=(x==null?void 0:x.getLevelRowColumn(c.lij))??c.lij;if((b==null?void 0:b.getAvailability(I[0],I[1],I[2]))!=="unavailable"&&M<=s&&!R.data&&!R.dataMissing&&((!p||c.level===n||M%v2e==0||h-p.level<o)&&(p=c),$>=a))break;c=c.parent}if(p!=null&&h-p.level<o)if(g)p=null;else{const M=this._findAncestorWithData();M!=null&&(this._setUpsampleTile(M),p=M.layerInfo[i][e].dataInvalidated?M:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=i)return n;r=n}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Un.FADING,i)}get test(){}},D_t=class extends tie{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw $fe}get _progressiveLevelModulo(){throw $fe}dispose(){}};const $fe=new Error("Abstract method called on TileAgent"),mc=new D_t;let N_t=class extends tie{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function F_t(t){return t.type==="elevation"}let k_t=class extends tie{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return v2e}};function U_t(t){return t.type==="map"}var ka;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(ka||(ka={}));let YF=class{constructor(){this.waitingAgents=new mi,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}get upsampleInfo(){return this._upsampleInfo}static acquire(e){const i=y8.acquire();return i._init(e),i}release(){this.dispose(),XF.delete(this),y8.release(this)}dispose(){this.loadingAgent=Ht(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=bE(this._data)}static prune(){y8.prune(0)}_init(e){this.waitingAgents.clear(),this._data=bE(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=jc(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){var e;this._upsampleInfo&&((e=this._upsampleInfo.tile)==null||e.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){var r;if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;(r=this._upsampleInfo.tile)==null||r.unrefMapData()}i.refMapData(),v_t(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){bE(this._data),this._data=e}};const y8=new xl(YF,null,()=>{}),XF=new Map;function z_t(){XF.size>0&&(console.log(`${XF.size} live TilePerLayerInfo allocations:`),XF.forEach(t=>console.log(t,`
`)))}var yt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(yt||(yt={}));const V_t=.1;let iie=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Zi(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=Zi(),this.centerAtSeaLevel=A(),this._center=[A(),Pn(),A()],this.up=JJ(),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=0,this._rasterTileMemory=0,this._vectorTileMemory=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=A(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){rie.prune(0),nie.prune(0),YF.prune()}get _cached(){return!this.leaf&&this._mapDataRefCount<=0}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[ls.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=(e==null?void 0:e.frustumVisibility)??ka.INTERSECTS;this._frustumVisibility=i===ka.INSIDE?ka.INSIDE:i===ka.OUTSIDE?ka.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==ka.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,n,s){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=xr(s.tilingScheme.spatialReference),s.tilingScheme.getExtent(e,i,r,this.extent),s.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,s.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[ls.MIDDLE][3]=0,this.elevationLevel=e,n&&!Number.isNaN(n.elevationBoundsMin)?(this._elevationBoundsMin=n.elevationBoundsMin,this._elevationBoundsMax=n.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=n,this.clearChildren(),this._surface=s,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of jT){const a=s.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=YF.acquire(this._surface.upsampleInfoPool),o===Qt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(s.tilingScheme.pixelSize,bO)}dispose(){qs(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key),this.layerInfo.forEach(e=>{e.forEach(i=>i.release()),e.length=0}),this._parent=null,this.clearChildren(),this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._cached){const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this._mapTileMemory)}get _cachedMemory(){return this._ensureUsedMemory(),this._cached?this._mapTileMemory:0}get _mapTileMemory(){return this._rasterTileMemory+this._vectorTileMemory}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){var i;if(this._usedMemory>0)return this._vectorTileMemory=this.layerInfo[Qt.MAP].reduce((r,{data:n})=>r+(GT(n)?n.usedMemoryPerReference:0),0),this._usedMemory;this._usedMemory=this._baseUsedMemory,this._rasterTileMemory=0,this._vectorTileMemory=0;for(const{data:r}of this.layerInfo[Qt.MAP])GT(r)?this._vectorTileMemory+=r.usedMemoryPerReference:this._rasterTileMemory+=this._getTerrainDataMemory(r);const e=this._cpuImageMemorySize;for(const r of this.layerInfo[Qt.ELEVATION])this._usedMemory+=r.data?e:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=((i=this.renderData.texture)==null?void 0:i.usedMemory)??0),this._cached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===Qt.MAP?this._cached?0:this._getTerrainDataMemory(r.data):e===Qt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return ARe(e)?e.texture.usedMemory:ORe(e)?e.memoryUsage:GT(e)?e.usedMemoryPerReference:hV(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[ls.MIDDLE],r=e,n=i[0],s=i[1],o=i[2],a=r[2]*n+r[6]*s+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*n+r[7]*s+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===ka.OUTSIDE))return yt.NONE;const n=this.level;Ae(LD,this._center[ls.MIDDLE],i);let s=No(LD),o=LD,a=this._center[ls.MIDDLE];Ae(_8,this._center[ls.TOP],i);const l=No(_8);l<s&&(s=l,o=_8,a=this._center[ls.TOP]),Ae(v8,this._center[ls.BOTTOM],i);const c=No(v8);if(c<s&&(s=c,o=v8,a=this._center[ls.BOTTOM]),this._edgeLen2>s&&n<e.maxLod)return yt.SPLIT;const h=Math.sqrt(s),p=e.fovX*h*2,g=this._edgeLen/p,y=()=>{if(n<e.maxLod)return this.elevationLevel=n,yt.NONE;const N=n+Math.ceil(-Math.log2(e.relativeWidthLimit/g));return N!==this.elevationLevel?(this.elevationLevel=N,yt.ELEVATION):yt.NONE},w=r!=null?r-n:1/0;if(w<=.5)return y();const b=Te(this.up,LD),x=this._elevationBoundsMax-this._elevationBoundsMin,T=x/this.edgeLen;if(e.aboveGround&&b>0&&T<.001&&b/h-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-T>0)return yt.NONE;const M=r!=null?3-Math.min(w,2):1;if(g*M<e.relativeWidthLimit||n>=e.maxLod)return y();if(n<7)return yt.SPLIT;ue(Eo,this.up,b),Ae(Eo,Eo,o);const $=No(Eo);if($<=this.radius*this.radius)return yt.SPLIT;ue(Eo,Eo,this.radius/Math.sqrt($)),xe(Eo,Eo,a),Ae(Eo,i,Eo);const R=Math.min(1,(Math.abs(Te(Eo,this.up))+.5*x+this._curvatureHeight)/Fe(Eo)),I=V_t/e.angledSplitBias,P=e.fovY*h*2;return R*(this._edgeLen/P*M)<I*e.relativeHeightLimit?yt.NONE:yt.SPLIT}createChildren(){const e=this._children,i=this.lij[0]+1,r=2*this.lij[1],n=2*this.lij[2];return e[0]=this.surface.createTile(i,r,n,this),e[1]=this.surface.createTile(i,r,n+1,this),e[2]=this.surface.createTile(i,r+1,n,this),e[3]=this.surface.createTile(i,r+1,n+1,this),e}clearChildren(){this._children[0]=this._children[1]=this._children[2]=this._children[3]=null}get loaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of jT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){this.renderData&&this.unrefMapData(),e.unloadTile(this);for(const i of jT){const r=this.layerInfo[i];for(const n of r)n.loadingAgent&&n.loadingAgent!==mc&&(PD(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(yt.GEOMETRY),this.resetPendingUpdate(yt.TEXTURE_NOFADING),this.resetPendingUpdate(yt.TEXTURE_FADING)}unloadMapData(){const e=this.layerInfo[Qt.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==mc&&(PD(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0,i.invalidateSourceData();this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(wb(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._withinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._withinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._withinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=r&&this._withinClippingArea,s=!(r||i||this._withinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(yt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!(r!=null&&r.data)||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of jT){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==mc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(yt.SPLIT)||e!==Qt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===yt.SPLIT||e===yt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const n=this.layerInfo[i][e];if(n.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(n.waitingAgents.push(r),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const a=GT(n.data);return r.dataArrived(this,a),!0}if(n.requestPromise)return!0;jc(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,i,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get leaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return No(Ae(Eo,this._center[ls.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const n=this.layerInfo[i][e],s=n.waitingAgents,o=s.removeUnordered(r)!=null;qs(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const n=GT(r),s=this.layerInfo[i][e];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(n=>n.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,i)),e){case Qt.MAP:return this._updateTexture(i);case Qt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Un.FADING?yt.TEXTURE_NOFADING:yt.TEXTURE_FADING),this.setPendingUpdate(e===Un.FADING?yt.TEXTURE_FADING:yt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(yt.GEOMETRY);for(const e of this.layerInfo[Qt.ELEVATION])e.pendingUpdates|=yt.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,n=-1/0;const s=this.layerInfo[Qt.ELEVATION];let o=!0;for(const a of s)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),n=Math.max(n,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),n=Math.max(n,0)),e===r&&i===n||(this._elevationBoundsMin=r,this._elevationBoundsMax=n,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),n=this._center;ue(Eo,this.up,r),xe(n[ls.MIDDLE],this.centerAtSeaLevel,Eo),ue(Eo,this.up,e),xe(n[ls.TOP],this.centerAtSeaLevel,Eo),ue(Eo,this.up,i),xe(n[ls.BOTTOM],this.centerAtSeaLevel,Eo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[Qt.ELEVATION][e],n=this.elevationLevelDelta,s=Math.max(this.elevationLevel-n,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,Qt.ELEVATION);if(!Db(this,a))return;const l=j_t;let c=!1;const h=r.data;if(h&&h.level<=s){const p=r.data;l.min=p.samplerData.data.minValue,l.max=p.samplerData.data.maxValue,l.hasNoDataValues=p.samplerData.data.hasNoDataValues,l.level=this.level,c=!0}else{let p,g,y=0;for(let w=this._parent;w&&(!g||y<n)&&(y=this.elevationLevel-w.level,p=g||p,g=w.layerInfo[Qt.ELEVATION][e].data,!(!g&&p&&w.level<=s));w=w.parent);g=g||p,g&&(g.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],l),l.min!==1/0&&(l.level=g.level,c=!0))}c&&(r.elevationBounds==null&&(r.elevationBounds=new B2),r.elevationBounds.copyFrom(l))}modifyLayers(e,i,r){const n=this.layerInfo[r];for(const a of n)a.loadingAgent&&a.loadingAgent!==mc&&(PD(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=i.length;n.length=o;for(let a=0;a<o;a++){const l=i[a];n[a]=l>-1?s[l]:YF.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Un.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===mc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of jT){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==mc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===mc&&this.updateRenderData(e,Un.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==mc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=mc,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||NE(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var n,s,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(g3(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||NE((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const n=this._isSuspended(i);for(let s=e;s<r.length;++s){const o=r[s],a=this._surface.layerViewByIndex(s,i);let l=!1;if(o.loadingAgent?Db(this,a)?(o.loadingAgent!==mc&&o.loadingAgent.setSuspension(n),o.loadingAgent!==mc&&(l=o.loadingAgent.update())):o.dispose():Db(this,a)&&(o.loadingAgent=B_t(this,s,i,n),l=o.loadingAgent.startLoading(),l?o.loadingAgent===mc&&this.setPendingUpdate(yt.GEOMETRY):(PD(o.loadingAgent),o.loadingAgent=mc)),o.loadingAgent===mc&&this.updateRenderData(i,Un.FADING),!this._hasBlendModes(e,r.length,i)&&l&&a.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),n=Oe(1+(this._maxTesselation>>r),2,this._maxTesselation+1),s=this.minimumVerticesPerSide;return Math.max(n,s)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const n of r)if(G_t(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.leaf&&!i(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return i(s)?s:null}}return null}findNeighborTile(e,i){const r=this._lij,n=this._getNeighborLIJ(r,e);return n?JF(r,n)?i(this)?this:null:this._findLIJ(n,i):null}findCorner(e,i){const r=e===Tt.NORTH_EAST?1:e===Tt.NORTH_WEST?0:e===Tt.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!i||!i(n));)n=n.children[r];return n}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,n=>i(n)||n.level===this.level))==null?void 0:r.findCorner(Fk(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===Tt.NORTH?[0,1]:e===Tt.NORTH_EAST?[1]:e===Tt.EAST?[1,3]:e===Tt.SOUTH_EAST?[3]:e===Tt.SOUTH?[2,3]:e===Tt.SOUTH_WEST?[2]:e===Tt.WEST?[0,2]:[0],n=s=>{const o=s.children;!i(s)&&o[0]&&r.forEach(a=>n(o[a]))};n(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(qe(!Xs||r>=0),r===0)return 0;const n=2**r,s=!(1&~e),o=s?0:1,a=i.lij[o+1]*n,l=this._lij[o+1],c=l-a,h=s?n-1-c:c;return Xs&&(qe(a<=l&&l<a+n),qe(0<=h&&h<n)),h}forEachLoadedNeighbor(e){const i=this.level,r=n=>n.level===i||n.loaded;zp.forEach(n=>{const s=this.findNeighborTile(n,r);s!=null&&s!==this&&s.forAllSubtreeOnSide(Bte(n),o=>!!o.loaded&&(e(o,n),!0))}),kk.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,r))==null?void 0:o.findCorner(Fk(n),a=>a.loaded);qe(!s||yY(this,s,n)),s!=null&&s.loaded&&e(s,n)})}_getNeighborLIJ(e,i){const r=kpe(i)?-1:Fpe(i)?1:0,n=Dpe(i)?-1:Npe(i)?1:0,s=[e[0],e[1]+r,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this._wrapLIJ(s):s[2]<0?null:s}_wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}isEdgeNeighbor(e,i){if(e==null)return!1;if(this.level===0&&e.level===0&&(this._eastEnd&&e._westEnd&&i===Tt.EAST||this._westEnd&&e._eastEnd&&i===Tt.WEST))return!0;const r=Math.max(1e-6*(this.extent[2]-this.extent[0]),1);switch(i){case Tt.NORTH:return Wh(this.extent[3],e.extent[1],r);case Tt.SOUTH:return Wh(this.extent[1],e.extent[3],r);case Tt.EAST:return Wh(this.extent[2],e.extent[0],r)||Wh(this.extent[2],-e.extent[0],r);case Tt.WEST:return Wh(this.extent[0],e.extent[2],r)||Wh(this.extent[0],-e.extent[2],r)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return this._lij[2]===0}checkGeometryWaterproofness(){var e;Dk&&(qe(this.loaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,n=.25*(i[2]-i[0]);if(kpe(e)&&i[3]+n>=r[3]||Fpe(e)&&i[1]-n<=r[1])return!1;const s=this.surface.isGlobal;return!(!s&&Dpe(e)&&i[0]-n<=r[0])&&!(!s&&Npe(e)&&i[2]+n>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ye(this._lastPOI,e);const r=this._center[ls.MIDDLE],n=e[0]-r[0],s=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=n*n+s*s+o*o}};function B_t(t,e,i,r){const n=i===Qt.ELEVATION?nie.acquire():rie.acquire();return n.init(t,e,i,r),n}function PD(t){t.dispose(),F_t(t)?nie.release(t):U_t(t)&&rie.release(t)}const rie=new xl(k_t),nie=new xl(N_t),j_t=new B2;var ls;function G_t(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function JF(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function yY(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Ofe(t,e,i):Ofe(e,t,Fk(i)))}function Ofe(t,e,i){qe(t.level>=e.level);const r=Myt(i),n=$yt(i),s=t.extent,o=e.extent,a=[r?s[0]:s[2],n?s[3]:s[1]],l=[r?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),h=Wh(a[0],l[0],c)||t.surface.isGlobal&&Wh(a[0],-l[0],c),p=Wh(a[1],l[1],c);if(h&&p)return!0;if(t.level===e.level||!h&&!p)return qe(!1),!1;const g=h?Afe(o[1],o[3],s[1],s[3],c):Afe(o[0],o[2],s[0],s[2],c);return qe(g),g}function Afe(t,e,i,r,n){return t-n<=i&&i<=r&&r<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(ls||(ls={}));const LD=A(),_8=A(),v8=A(),Eo=A(),H_t=65536;function q_t(t,e){const{tile:i,geometry:r,geometryState:n}=t,{extentInRadians:s,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:h}=n,p=c-1,g=(c-2)**2,y=a&&(e===Zh.HAS_SOUTH_POLE||e===Zh.HAS_BOTH_POLES),w=a&&(e===Zh.HAS_NORTH_POLE||e===Zh.HAS_BOTH_POLES),b=((y?1:0)+(w?1:0))*QF*c,x=P3e(n),T=g+b+4*x,M=l.tileGeometryCache.acquire(T);r.numVerticesPerSide=c,r.vertexAttributes=M,r.maxEdgeVertexCount=x;const{boundingBox:$}=r;fd($);const R=oie(t);Ao.update(p,s,R),Z_t(t),r.poleVerticesStartIndex=g;const I=W_t(t,y,w);r.edgeVerticesStartIndex=g+b,lie(t),sie(t),E3e(r,I,h),t.intersectionData=null}function W_t(t,e,i){const{tile:r,localOrigin:n,geometry:s}=t,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:h,poleVerticesStartIndex:p}=s,g=c-1,y=n[0],w=n[1],b=n[2],x=a.radius,T=o[1],M=o[3],$=[];let R=p;const I=(P,N)=>{const V=N*c;ad(-y,-w,P*x-b,l),$.push(new dvt(P===1,V,P===1?0:2,R,QF));const U=b3e(P===-1?T:M,x),B=P*Math.PI/2-U,W=.99*(P===1?1:-1),j=x+0,{position:Q,uv0:Z}=h,{typedBuffer:X,typedBufferStride:ge}=h.normalCompressed;for(let ae=1;ae<=QF;++ae){const z=U+B*(ae/QF),he=Math.cos(z),ce=Math.sin(z);for(let G=0;G<=g;G++){const K=G/g,Se=Ao.sinLonLUT[G],Ee=Ao.cosLonLUT[G]*he,Ce=Se*he,Le=ce,Ke=Ee*j-y,Re=Ce*j-w,ze=Le*j-b;ad(Ke,Re,ze,l),Q.setValues(R,Ke,Re,ze),Wp(Z,R,K,W),px(X,R,Ee,Ce,Le,ge),++R}}};return e&&I(-1,0),i&&I(1,g),$}function Z_t(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:n}=t,{numVerticesPerSide:s,samplerData:o}=r,a=s-2,l=s-1,{vertexAttributes:c,boundingBox:h}=i,p=c.position,g=c.uv0,{typedBuffer:y,typedBufferStride:w}=c.normalCompressed,{extent:b}=e,x=b[0],T=b[2],M=b[1],$=b[3],R=e.ellipsoid.radius,I=n[0],P=n[1],N=n[2],V=p.typedBuffer,U=p.typedBufferStride,B=1/l;let W=0;if(1<=a){const j=B,Q=M*(1-j)+$*j,Z=Ao.sinLatLUT[1],X=Ao.cosLatLUT[1];for(let ge=1;ge<=a;ge++){const ae=ge*B,z=x*(1-ae)+T*ae,he=Ao.sinLonLUT[ge],ce=Ao.cosLonLUT[ge],G=R+Tn(z,Q,o),K=G*ce*X-I,Se=G*he*X-P,Ee=G*Z-N;ad(K,Se,Ee,h);const Ce=(ge-1)*U;V[Ce]=K,V[Ce+1]=Se,V[Ce+2]=Ee,Wp(g,ge-1,ae,j)}}for(let j=1;j<=a;j++){const Q=j*B,Z=M*(1-Q)+$*Q,X=Ao.sinLatLUT[j],ge=Ao.cosLatLUT[j],ae=j+1,z=ae*B,he=M*(1-z)+$*z,ce=Ao.sinLatLUT[ae],G=Ao.cosLatLUT[ae],K=Ao.sinLonLUT[0],Se=Ao.cosLonLUT[0],Ee=R+Tn(x,Z,o);let Ce=Se*ge*Ee-I,Le=K*ge*Ee-P,Ke=X*Ee-N;const Re=W*U;let ze=V[Re],vt=V[Re+1],Xt=V[Re+2];for(let li=1;li<=a;li++){const ti=li*B,zi=x*(1-ti)+T*ti,He=Ao.sinLonLUT[li],Oi=Ao.cosLonLUT[li];let Be=0,tt=0,dt=0;if(li<a){const di=(W+1)*U;Be=V[di],tt=V[di+1],dt=V[di+2]}else{const di=Ao.sinLonLUT[l],lr=Ao.cosLonLUT[l],Fr=R+Tn(T,Z,o);Be=lr*ge*Fr-I,tt=di*ge*Fr-P,dt=X*Fr-N}const Rt=Ce,Je=Le,Et=Ke;Ce=ze,Le=vt,Ke=Xt,ze=Be,vt=tt,Xt=dt;const De=Be-Rt,at=tt-Je,It=dt-Et;let Ki=0,Yi=0,er=0;if(j>1){const di=(W-a)*U;Ki=V[di],Yi=V[di+1],er=V[di+2]}else{const di=Ao.sinLatLUT[0],lr=Ao.cosLatLUT[0],Fr=R+Tn(zi,M,o);Ki=Oi*lr*Fr-I,Yi=He*lr*Fr-P,er=di*Fr-N}const Li=R+Tn(zi,he,o),Ai=Oi*G*Li-I,ci=He*G*Li-P,Vi=ce*Li-N;if(j<a){const di=W+a,lr=di*U;V[lr]=Ai,V[lr+1]=ci,V[lr+2]=Vi,ad(Ai,ci,Vi,h),Wp(g,di,ti,z)}const Ei=Ki-Ai,tr=Yi-ci,Lt=er-Vi;let ui=Oi*ge,_i=He*ge,rr=X;rr*rr<.999&&(ui=It*tr-at*Lt,_i=De*Lt-It*Ei,rr=at*Ei-De*tr);const bn=1/Math.sqrt(ui*ui+_i*_i+rr*rr);px(y,W,ui*bn,_i*bn,rr*bn,w),++W}}}function Y_t(t){t.tile.intersectsClippingArea&&(sie(t),cM(t),t.intersectionData=null)}function X_t(t){t.tile.intersectsClippingArea&&($3e(t),sie(t),cM(t),R3e(t),t.intersectionData=null)}function J_t(t){t.tile.intersectsClippingArea&&(w3e(t),v3e(t,!0),cM(t),t.intersectionData=null)}function sie(t){t.tile.intersectsClippingArea&&(w3e(t),v3e(t))}function v3e(t,e=!1){const{geometry:i,geometryState:r,tile:n,localOrigin:s}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=n,h=c.radius,p=l[0],g=l[2],y=l[1],w=l[3],{samplerData:b}=r,x=a[0],T=a[2],M=a[1],$=a[3],R=oie(t),{boundingBox:I,vertexAttributes:P}=i,N=s[0],V=s[1],U=s[2],B=P.position,W=B.typedBuffer,j=B.typedBufferStride,Q=P.uv0;for(let Z=0;Z<4;++Z){const X=Z===1||Z===3,ge=r.edgeResolutions[Z];qe(PR(ge));const ae=ge+1,z=ib(n,r.edgePeerNeighbors[Z]);if(I3e(n,z,Z)){O3e(t,Z,z);continue}const he=z!=null;qe(!he||z.level===n.level),qe(!he||um(n,z)<=0);const ce=z==null?void 0:z.renderData,G=ce==null?void 0:ce.geometryState;if(Xs){const De=n.surface;if(!z&&De&&!De.updatingRootTiles){const at=zp[Z],It=n.findNeighborTile(at,Ki=>Ki.loaded||Ki.leaf||Ki.level===n.level);It?It.intersectsClippingArea&&(qe(!It.loaded),qe(!It.leaf),qe(It.level===o)):qe((De==null?void 0:De.rootTiles)==null||!n.shouldHaveNeighbor(at))}}const K=Z===1?a[2]:a[0],Se=z==null?void 0:z.extent,Ee=Se&&X?Z===1?Se[0]:Se[2]:K,Ce=Z===0?a[3]:a[1],Le=Z===1?1:0,Ke=Z===0?1:0,Re=Z===1?g:p,ze=Z===0?w:y,vt=Math.sin(Re),Xt=Math.cos(Re),li=Math.sin(ze),ti=Math.cos(ze),zi=G==null?void 0:G.samplerData,He=he?(De,at,It)=>.5*(Tn(De,at,b)+Tn(It,at,zi)):(De,at,It)=>Tn(De,at,b),Oi=i.outerEdgesOffsetAndLength[2*Z+0],Be=e&&ae>3?ae-3:1,tt=b!=null&&b.some(De=>De!=null),dt=zi!=null&&zi.some(De=>De!=null),Rt=tt||dt,Je=1/ge,Et=Oi;qe(!Se||Wh(Se[2]-Se[0],a[2]-a[0])),(()=>{const De=Z===1?-1:Z===3?1:0,at=Z===0?-1:Z===2?1:0,It=(a[2]-a[0])*Je,Ki=De*It,Yi=at*It,er=X?De*((g-p)*Je):0,Li=X?0:at*Je,Ai=Ke,ci=X?Re+er:Re,Vi=X?Math.sin(ci):vt,Ei=X?Math.cos(ci):Xt,tr=X?Re-er:Re,Lt=X?Math.sin(tr):vt,ui=X?Math.cos(tr):Xt,_i=X?ze:R(Ai+Li),rr=X?li:Math.sin(_i),bn=X?ti:Math.cos(_i),di=X?ze:R(Ai-Li),lr=X?li:Math.sin(di),Fr=X?ti:Math.cos(di);let Ts=0,wo=0,bo=0;{const se=0*Je,jt=X?K:x*(1-se)+T*se,Kr=X?Ee:jt,yr=X?M*(1-se)+$*se:Ce,mn=X?Re:p*(1-se)+g*se,st=X?vt:Math.sin(mn),Xa=X?Xt:Math.cos(mn),kr=X?R(se):ze,Sa=X?Math.sin(kr):li,Yc=X?Math.cos(kr):ti,js=h+He(jt,yr,Kr);Ts=Xa*Yc*js,wo=st*Yc*js,bo=Sa*js}let Es=0,Ln=0,cn=0;{const se=1*Je,jt=X?K:x*(1-se)+T*se,Kr=X?Ee:jt,yr=X?M*(1-se)+$*se:Ce,mn=X?Re:p*(1-se)+g*se,st=X?vt:Math.sin(mn),Xa=X?Xt:Math.cos(mn),kr=X?R(se):ze,Sa=X?Math.sin(kr):li,Yc=X?Math.cos(kr):ti,js=h+He(jt,yr,Kr);Es=Xa*Yc*js,Ln=st*Yc*js,cn=Sa*js}for(let se=1;se<ae-1;se+=Be){let jt=0,Kr=0,yr=0;{const Er=(se+1)*Je,Rr=X?K:x*(1-Er)+T*Er,Jc=X?Ee:Rr,Cs=X?M*(1-Er)+$*Er:Ce,Qc=X?Re:p*(1-Er)+g*Er,Kc=X?vt:Math.sin(Qc),Xy=X?Xt:Math.cos(Qc),lf=X?R(Er):ze,Ms=X?Math.sin(lf):li,Wo=X?Math.cos(lf):ti,cf=h+He(Rr,Cs,Jc);jt=Xy*Wo*cf,Kr=Kc*Wo*cf,yr=Ms*cf}const mn=jt,st=Kr,Xa=yr,kr=Es,Sa=Ln,Yc=cn;Es=mn,Ln=st,cn=Xa;{const Er=Et+se,Rr=Er*j,Jc=kr-N,Cs=Sa-V,Qc=Yc-U;W[Rr]=Jc,W[Rr+1]=Cs,W[Rr+2]=Qc,ad(Jc,Cs,Qc,I);const Kc=se*Je;Wp(Q,Er,X?Le:Kc,X?Kc:Ke)}const js=Ts,Ux=wo,Xu=bo;Ts=kr,wo=Sa,bo=Yc;const Kt=kr,af=Sa,Cd=Yc,Um=1/Math.sqrt(Kt*Kt+af*af+Cd*Cd),n1=Cd*Um;let Xc=0,Md=0,Ju=0;if(Rt&&n1*n1<.999){let Er=0,Rr=0,Jc=0;{const Cs=Z===0?-1:1;Er=Cs*(mn-js),Rr=Cs*(st-Ux),Jc=Cs*(Xa-Xu)}{const Cs=se*Je,Qc=X?K:x*(1-Cs)+T*Cs,Kc=X?Ee:Qc,Xy=X?M*(1-Cs)+$*Cs:Ce,lf=X?Re:p*(1-Cs)+g*Cs,Ms=X?vt:Math.sin(lf),Wo=X?Xt:Math.cos(lf),cf=X?R(Cs):ze,H=X?Math.sin(cf):li,$e=X?Math.cos(cf):ti;let je=Kt,Jt=af,_r=Cd;if(he){const Cr=h+Tn(Kc-Ki,Xy-Yi,zi),en=X?$e:Fr;je=(X?ui:Wo)*en*Cr,Jt=(X?Lt:Ms)*en*Cr,_r=(X?H:lr)*Cr}{const Cr=h+Tn(Qc+Ki,Xy+Yi,b),en=X?$e:bn,$s=(X?Ei:Wo)*en*Cr,$I=(X?Vi:Ms)*en*Cr,OI=(X?H:rr)*Cr;he||(je=2*Kt-$s,Jt=2*af-$I,_r=2*Cd-OI);const s1=Z===3?-1:1,mM=s1*(je-$s),zx=s1*(Jt-$I),Jy=s1*(_r-OI);Xc=Jc*zx-Rr*Jy,Md=Er*Jy-Jc*mM,Ju=Rr*mM-Er*zx;const gM=1/Math.sqrt(Xc*Xc+Md*Md+Ju*Ju);Xc*=gM,Md*=gM,Ju*=gM}}}else Xc=Kt*Um,Md=af*Um,Ju=Cd*Um;i.setEdgeNormalFromValues(Z,se,Xc,Md,Ju)}})()}}function w3e(t){A3e(t)}function b3e(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function Q_t(t,e,i,r){return b3e(t*(1-r)+e*r,i)}function K_t(t,e,i){return t*(1-i)+e*i}function oie(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,n=e.ellipsoid.radius;return s=>Q_t(r[1],r[3],n,s)}const i=e.extentInRadians;return r=>K_t(i[1],i[3],r)}function evt(t,e){const{tile:i,geometryState:r,geometry:n}=t,{extent:s,surface:o}=i,{wireframe:a}=r,l=s[0],c=s[1],h=s[2]-l,p=s[3]-c,{numVerticesPerSide:g,clippingArea:y}=r,w=y!=null?Math.max(0,(y[0]-l)/h):0,b=y!=null?Math.max(0,(y[1]-c)/p):0,x=y!=null?Math.min(1,(y[2]-l)/h):1,T=y!=null?Math.min(1,(y[3]-c)/p):1,M=(g-2)**2,$=P3e(r),R=M+4*$,I=o.renderer.tileGeometryCache.acquire(R),{boundingBox:P}=n;fd(P),n.numVerticesPerSide=g,n.vertexAttributes=I,n.maxEdgeVertexCount=$,n.minu=w,n.minv=b,n.maxu=x,n.maxv=T,tvt(t),n.edgeVerticesStartIndex=M,lie(t),aie(t),E3e(n,[],a),t.intersectionData=null}function tvt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:n}=t,{samplerData:s,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:h}=e,{isWebMercatorOnPlateCarree:p}=l,g=o??cie,y=c[0],w=c[1],b=c[2],x=c[3],T=Math.max(y,g[0]),M=Math.min(b,g[2]),$=Math.max(w,g[1]),R=Math.min(x,g[3]),I=h.radius,P=e.horizontalScale,N=a-1,V=a-2,{minu:U,minv:B,maxu:W,maxv:j,boundingBox:Q,vertexAttributes:Z}=i,X=Z.position,ge=Z.uv0,{typedBuffer:ae,typedBufferStride:z}=Z.normalCompressed,he=n[0],ce=n[1],G=n[2],K=X.typedBuffer,Se=X.typedBufferStride;let Ee=0;const Ce=Oe(w,$,R),Le=p?(Math.PI/2-2*Math.atan(Math.exp(-Ce/I)))*I:Ce*P,Ke=1/N,Re=Oe(w*(1-Ke)+x*Ke,$,R);let ze=Le,vt=p?(Math.PI/2-2*Math.atan(Math.exp(-Re/I)))*I:Re*P;for(let Xt=1;Xt<=V;Xt++){const li=Xt/N,ti=Oe(w*(1-li)+x*li,$,R),zi=Oe(li,B,j),He=vt,Oi=(Xt-1)/N,Be=Oe(w*(1-Oi)+x*Oi,$,R),tt=ze,dt=(Xt+1)/N,Rt=Oe(w*(1-dt)+x*dt,$,R),Je=p?(Math.PI/2-2*Math.atan(Math.exp(-Rt/I)))*I:Rt*P,Et=Oe(dt,B,j);ze=vt,vt=Je;const De=Oe(y,T,M);let at=De*P,It=Tn(De,ti,s);const Ki=1/N,Yi=Oe(Ki,U,W),er=Oe(y*(1-Yi)+b*Yi,T,M);let Li=Yi,Ai=er,ci=er*P,Vi=Tn(er,ti,s);if(Xt===1){const Ei=ci-he,tr=ze-ce,Lt=Vi-G,ui=0*Se;K[ui]=Ei,K[ui+1]=tr,K[ui+2]=Lt,ad(Ei,tr,Lt,Q);const _i=Oe(Ki,U,W);Wp(ge,Ee,_i,zi)}for(let Ei=1;Ei<=V;Ei++){const tr=ci,Lt=Vi,ui=(Ei+1)/N,_i=Oe(ui,U,W),rr=Oe(y*(1-ui)+b*ui,T,M),bn=Ai;Ai=rr;{const Ln=Ee+1,cn=Ln*Se;if(Xt===1||Ei===V){const se=rr*P,jt=Tn(rr,ti,s);if(Xt===1&&Ei<V){const Kr=se-he,yr=He-ce,mn=jt-G;K[cn]=Kr,K[cn+1]=yr,K[cn+2]=mn,ad(Kr,yr,mn,Q),Wp(ge,Ln,_i,zi)}ci=se,Vi=jt}else ci=K[cn]+he,Vi=K[cn+2]+G}const di=ci,lr=Vi,Fr=at,Ts=It;at=tr,It=Lt;const wo=(Ee-V)*Se,bo=Xt===1?Tn(bn,Be,s):K[wo+2]+G,Es=Tn(bn,Rt,s);if(Xt<V){const Ln=Ee+V,cn=Ln*Se,se=tr-he,jt=Je-ce,Kr=Es-G;K[cn]=se,K[cn+1]=jt,K[cn+2]=Kr,ad(se,jt,Kr,Q);const yr=Li;Li=_i,Wp(ge,Ln,yr,Et)}{const Ln=di-Fr,cn=tt-Je,se=cn*(lr-Ts),jt=Ln*(bo-Es),Kr=-cn*Ln,yr=se*se+jt*jt+Kr*Kr;if(yr===0)px(ae,Ee,0,0,1,z);else{const mn=1/Math.sqrt(yr);px(ae,Ee,se*mn,jt*mn,Kr*mn,z)}}++Ee}}}function ivt(t,e){t.tile.intersectsClippingArea&&(S3e(t),x3e(t,!0),cM(t),t.intersectionData=null)}function rvt(t,e){t.tile.intersectsClippingArea&&($3e(t),aie(t),cM(t),R3e(t),t.intersectionData=null)}function nvt(t,e){t.tile.intersectsClippingArea&&(aie(t),cM(t),t.intersectionData=null)}function aie(t,e){t.tile.intersectsClippingArea&&(S3e(t),x3e(t,!1))}function x3e(t,e){const{geometry:i,geometryState:r,localOrigin:n}=t,s=t.tile,{surface:o,extent:a}=s,{clippingArea:l,samplerData:c}=r,h=l??cie,p=a[0],g=a[2],y=a[1],w=a[3],b=[w>h[3],g>h[2],y<h[1],p<h[0]],x=s.horizontalScale,T=T3e(o.isWebMercatorOnPlateCarree,s.ellipsoid.radius,x),{minu:M,minv:$,maxu:R,maxv:I,boundingBox:P}=i,N=Math.max(p,h[0]),V=Math.min(g,h[2]),U=Math.max(y,h[1]),B=Math.min(w,h[3]),W=n[0],j=n[1],Q=n[2];for(let Z=0;Z<4;++Z){const X=Z===1||Z===3,ge=r.edgeResolutions[Z];qe(PR(ge));const ae=ge+1,z=b[Z],he=ib(s,r.edgePeerNeighbors[Z]);if(!z&&I3e(s,he,Z)){O3e(t,Z,he);continue}const ce=he!=null&&!z,G=he==null?void 0:he.renderData,K=G==null?void 0:G.geometryState;if(Xs&&(qe(!ce||he.level===s.level),qe(!ce||um(s,he)<=0),s&&!he&&!o.updatingRootTiles)){const Je=zp[Z],Et=s.findNeighborTile(Je,De=>De.loaded||De.leaf||De.level===s.level);o.updatingRootTiles||(Et?Et.intersectsClippingArea&&(qe(!Et.loaded),qe(!Et.leaf),qe(Et.level===s.level)):qe((o==null?void 0:o.rootTiles)==null||!s.shouldHaveNeighbor(Je)))}const Se=Oe(Z===1?g:p,N,V),Ee=Oe(Z===0?w:y,U,B),Ce=K==null?void 0:K.samplerData,Le=e&&ae>3?ae-3:1,Ke=Oe(Z===1?1:0,M,R),Re=Oe(Z===0?1:0,$,I),ze=ce?(Je,Et)=>.5*(Tn(Je,Et,Ce)+Tn(Je,Et,c)):(Je,Et)=>Tn(Je,Et,c),vt=(g-p)/ge,Xt=X?Z===1?vt:-vt:0,li=X?0:Z===0?vt:-vt,ti=-Xt,zi=-li;let He=0,Oi=0,Be=0;{const Je=0/ge,Et=X?Se:Oe(p*(1-Je)+g*Je,N,V),De=X?Oe(y*(1-Je)+w*Je,U,B):Ee,at=ze(Et,De);He=Et*x,Oi=T(De),Be=at}let tt=0,dt=0,Rt=0;{const Je=1/ge,Et=X?Se:Oe(p*(1-Je)+g*Je,N,V),De=X?Oe(y*(1-Je)+w*Je,U,B):Ee,at=ze(Et,De);tt=Et*x,dt=T(De),Rt=at}for(let Je=1;Je<ae-1;Je+=Le){const Et=Je/ge,De=tt,at=dt,It=Rt;{const Lt=X?Ke:Oe(Et,M,R),ui=X?Oe(Et,$,I):Re,_i=De-W,rr=at-j,bn=It-Q;ad(De,rr,bn,P),i.setEdgeVertexFromValuesRawPositionUV(Z,Je,_i,rr,bn,Lt,ui)}{const Lt=(Je+1)/ge,ui=X?Se:Oe(p*(1-Lt)+g*Lt,N,V),_i=X?Oe(y*(1-Lt)+w*Lt,U,B):Ee,rr=ze(ui,_i);tt=ui*x,dt=T(_i),Rt=rr}const Ki=tt,Yi=Rt,er=He,Li=Oi,Ai=Be;He=De,Oi=at,Be=It;let ci=0,Vi=0,Ei=0;if(X){const Lt=dt-at,ui=Yi-It,_i=Li-at,rr=Ai-It,bn=Oe(y*(1-Et)+w*Et,U,B),di=Se+ti,lr=di*x-De,Fr=Tn(di,bn,c)-It,Ts=Z===3?-1:1;if(ci=Ts*(-_i+Lt)*Fr,Vi=Ts*lr*(-rr+ui),Ei=-Ts*lr*(-_i+Lt),ce){const wo=Se+Xt,bo=wo*x-De;ci=(-_i+Lt)*(Fr-(Tn(wo,bn,Ce)-It)),Vi=(lr-bo)*(-rr+ui),Ei=-(lr-bo)*(-_i+Lt)}}else{const Lt=Ki-De,ui=Yi-It,_i=er-De,rr=Ai-It,bn=Oe(p*(1-Et)+g*Et,N,V),di=Ee+zi,lr=Tn(bn,di,c)-It,Fr=T(di)-at,Ts=Z===2?-1:1;if(ci=Ts*Fr*(-rr+ui),Vi=Ts*(-_i+Lt)*lr,Ei=-Ts*Fr*(-_i+Lt),ce){const wo=bn,bo=Ee+li,Es=T(bo)-at;ci=(-Fr+Es)*(-rr+ui),Vi=(-_i+Lt)*(-lr+(Tn(wo,bo,Ce)-It)),Ei=-(-Fr+Es)*(-_i+Lt)}}const tr=1/Math.sqrt(ci*ci+Vi*Vi+Ei*Ei);i.setEdgeNormalFromValues(Z,Je,ci*tr,Vi*tr,Ei*tr)}}}function S3e(t,e){A3e(t)}function svt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function ovt(t,e){return t*e}function T3e(t,e,i){return t?r=>svt(r,e):r=>ovt(r,i)}function E3e(t,e,i){const{numVerticesPerSide:r,vertexAttributes:n,maxEdgeVertexCount:s}=t,o=r-1,a=n.count,l=2*(r-3)*(r-3),c=4*(o+s-3),h=eie.reduce((b,x)=>b+(o+t.getEdgeCount(x)-3),0),p=e.reduce((b,x)=>b+o*(2*(x.latitudeResolution-1)+1),0),g=3*(i?2:1),y=(l+c+p)*g,w=a>=H_t?new Uint32Array(y):new Uint16Array(y);for(let b=0;b<y;++b)w[b]=0;t.indices=w,t.indexCount=(l+h+p)*g,t.poleIndicesStartIndex=l*g,t.edgeIndicesStartIndex=(l+p)*g,i?(cvt(t),uvt(t,e),M3e(t)):(avt(t),lvt(t,e),C3e(t))}function avt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:n}=r,{typedBuffer:s,typedBufferStride:o}=n,a=e-2,l=e-3,c=0,h=e-3;let p=0;for(let g=0;g<l;++g){const y=g*a;for(let w=c;w<h;++w){const b=y+w,x=b+1,T=x+a,M=T-1;L3e(b,x,T,M,o,s)?(i[p]=b,i[p+1]=x,i[p+2]=T,i[p+3]=T,i[p+4]=M,i[p+5]=b):(i[p]=b,i[p+1]=x,i[p+2]=M,i[p+3]=M,i[p+4]=x,i[p+5]=T),p+=6}}}function lvt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:n}=t,s=i-1;let o=n;for(const a of e){const l=a.isNorth?1:2,c=a.isNorth?2:1,h=a.isNorth?3:4,p=a.isNorth?4:3;let g=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),y=1;for(let w=0;w<a.latitudeResolution;++w){const b=w===0?a.rowOffset:g+i;for(let x=0;x<s;x++){const T=b+x;r[o]=g,r[o+l]=g+1,r[o+c]=T,w<a.latitudeResolution-1?(r[o+h]=g+1,r[o+p]=T+1,r[o+5]=T,o+=6):o+=3,g+=y}g=b,y=1}}}function C3e(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,n=i-1,s=n-2;let o=r;for(let a=0;a<4;++a){const l=uie[a];let c=0,h=0;const p=t.getEdgeCount(a),g=l.count;qe(g===n-1);const y=a===1||a===2,w=y?1:2,b=y?2:1,x=t.getEdgeFirstVertexIndex(a),T=1,M=l.vertex0Index,$=l.stride;for(;c<p-1||h<g-1;){const R=M+h*$,I=x+c*T,P=c<p-1,N=h<g-1,V=P&&(!N||(P?0+n*(c+.5)/(p-1):0)<=(N?1+s*(h+.5)/(g-1):0));V?++c:++h;const U=V?I+T:R+$;e[o]=R,e[o+w]=I,e[o+b]=U,o+=3}}t.indexCount=o}function cvt(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:n}=r,{typedBuffer:s,typedBufferStride:o}=n,a=i-2;let l=0;for(let c=0;c<i-3;++c){const h=c*a;for(let p=0;p<i-3;++p){const g=c*a+p,y=g+1,w=y+a,b=w-1,x=h+p,T=x+1,M=T+a;L3e(x,T,M,M-1,o,s)?(G2(e,l,g,y,w),l+=6,G2(e,l,w,b,g)):(G2(e,l,g,y,b),l+=6,G2(e,l,b,w,y)),l+=6}}}function uvt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:n}=t,s=r-1;let o=n;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),h=1;for(let p=0;p<a.latitudeResolution;++p){const g=p===0?a.rowOffset:c+r;for(let y=0;y<s;y++)G2(i,o,c,c+1,g+y),o+=6,p<a.latitudeResolution-1&&(G2(i,o,c+1,g+y+1,g+y),o+=6),c+=h;c=g,h=1}}}function M3e(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,n=i-1,s=n-2;let o=r;for(let a=0;a<4;++a){const l=uie[a];let c=0,h=0;const p=t.getEdgeCount(a),g=l.count;qe(g===n-1);const y=a===1||a===2,w=y?1:3,b=y?3:1,x=t.getEdgeFirstVertexIndex(a),T=1,M=l.vertex0Index,$=l.stride;for(;c<p-1||h<g-1;){const R=M+h*$,I=x+c*T,P=c<p-1,N=h<g-1,V=P&&(!N||(P?0+n*(c+.5)/(p-1):0)<=(N?1+s*(h+.5)/(g-1):0));V?++c:++h;const U=V?I+T:R+$;e[o]=R,e[o+w]=I,e[o+w+1]=I,e[o+b]=U,e[o+b+1]=U,e[o+5]=R,o+=6}}t.indexCount=o}function lie(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:n,edgeVerticesStartIndex:s}=e,o=n-2;let a=s;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?o-1:0)*o+(l===1?o-1:0),p=(c?0:1)*o+(c?1:0),g=uie[l];g.vertex0Index=h,g.stride=p,g.count=o}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function $3e(t){lie(t),t.geometryState.wireframe?M3e(t.geometry):C3e(t.geometry)}function O3e(t,e,i){const{geometryState:r,geometry:n,tile:s,localOrigin:o}=t,a=e===1||e===3,l=r.edgeResolutions[e];qe(PR(l));const c=l+1,{boundingBox:h,minu:p,minv:g,maxu:y,maxv:w,vertexAttributes:b}=n,x=Oe(e===1?1:0,p,y),T=Oe(e===0?1:0,g,w),M=i.renderData,$=M.geometryState,R=M.geometry,I=(e+2)%4,P=R.getEdgeCount(I),N=s.getNeighborEdgeStartVertexIndex(e,i)*l,V=l*2**(s.level-i.level);qe($.edgeResolutions[I]===V),qe(P-1===V);const U=M.localOrigin[0]-o[0],B=M.localOrigin[1]-o[1],W=M.localOrigin[2]-o[2],j=n.getEdgeFirstVertexIndex(e),Q=b.position,Z=Q.typedBuffer,X=Q.typedBufferStride,ge=b.normalCompressed,ae=ge.typedBuffer,z=ge.typedBufferStride,he=b.uv0,ce=R.vertexAttributes,G=R.getEdgeFirstVertexIndex(I),K=ce.position.typedBuffer,Se=ce.position.typedBufferStride,Ee=ce.normalCompressed.typedBuffer,Ce=ce.normalCompressed.typedBufferStride;for(let Le=1;Le<c-1;++Le){const Ke=j+Le,Re=G+(N+Le),ze=Ke*X,vt=Re*Se,Xt=K[vt]+U,li=K[vt+1]+B,ti=K[vt+2]+W;Z[ze]=Xt,Z[ze+1]=li,Z[ze+2]=ti,ad(Xt,li,ti,h);const zi=Ke*z,He=Re*Ce;ae[zi]=Ee[He],ae[zi+1]=Ee[He+1];const Oi=Le/l,Be=a?x:Oe(Oi,p,y),tt=a?Oe(Oi,g,w):T;Wp(he,Ke,Be,tt)}}function A3e(t){var zi;const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:n,samplerData:s}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:h,vertexAttributes:p}=e,g=t.tile,{surface:y,ellipsoid:w,extent:b,extentInRadians:x,horizontalScale:T}=g,M=((zi=y.view)==null?void 0:zi.viewingMode)==="local",$=w.radius;let R=0,I=0,P=0;const N=(He,Oi,Be)=>{const tt=x[Oi===0?1:3],dt=x[He===0?0:2],Rt=Math.cos(tt),Je=Math.sin(tt),Et=Math.sin(dt),De=Math.cos(dt),at=$+Be;R=De*Rt*at,I=Et*Rt*at,P=Je*at},V=M?(()=>{const He=n,Oi=He!=null&&(b[3]>He[3]||b[2]>He[2]||b[1]<He[1]||b[0]<He[0]),Be=T3e(y.isWebMercatorOnPlateCarree,$,T);return(tt,dt,Rt)=>{const Je=tt===0?b[0]:b[2],Et=dt===0?b[1]:b[3],De=Oi?Oe(Je,He[0],He[2]):Je,at=Oi?Oe(Et,He[1],He[3]):Et,It=Rt;R=De*T,I=Be(at),P=It}})():N;let U=0,B=0,W=0,j=0,Q=0,Z=0,X=0,ge=0,ae=0;const z=M&&y.isWebMercatorOnPlateCarree,he=(He,Oi,Be,tt,dt)=>{let Rt=0,Je=0,Et=0;if(M){const De=Oi*T,at=z?(Math.PI/2-2*Math.atan(Math.exp(-Be/$)))*$:Be*T;Rt=De-R,Je=at-I,Et=tt-P}else{const De=oie(He),at=He.tile,It=at.extent,Ki=at.extentInRadians,Yi=(Oi-It[0])/(It[2]-It[0]),er=(Be-It[1])/(It[3]-It[1]),Li=Ki[0]*(1-Yi)+Ki[2]*Yi,Ai=De(er),ci=Math.cos(Ai),Vi=Math.sin(Ai),Ei=Math.sin(Li),tr=Math.cos(Li),Lt=$+tt;Rt=tr*ci*Lt-R,Je=Ei*ci*Lt-I,Et=Vi*Lt-P}switch(dt){case 0:X+=Rt,ge+=Je,ae+=Et;break;case 1:j-=Rt,Q-=Je,Z-=Et;break;case 2:X-=Rt,ge-=Je,ae-=Et;break;case 3:j+=Rt,Q+=Je,Z+=Et}},ce=n??cie,G=b[0],K=b[2],Se=b[1],Ee=b[3],Ce=[Ee>ce[3],K>ce[2],Se<ce[1],G<ce[0]],Le=Math.max(G,ce[0]),Ke=Math.min(K,ce[2]),Re=Math.max(Se,ce[1]),ze=Math.min(Ee,ce[3]),vt=He=>Math.max(ce[0],Math.min(ce[2],He)),Xt=He=>Math.max(ce[1],Math.min(ce[3],He)),li=He=>{const Oi=i.cornerNeighborCornerTiles;U=0,B=0,W=1,j=0,Q=0,Z=0,X=0,ge=0,ae=0;let Be=1/0;for(let De=0;De<4;++De){const at=Oi[4*He+De];Be=Math.min(Be,(at==null?void 0:at.level)??1/0)}for(let De=0;De<4;++De){const at=Oi[4*He+De];G$[De]=(at==null?void 0:at.level)===Be?at:null}let tt=1,dt=0;for(let De=0;De<4;++De){const at=G$[De];at&&(tt=Math.max(tt,at==null?void 0:at.renderData.geometryState.numVerticesPerSide),dt=at.extent[2]-at.extent[0])}const Rt=dt,Je=tt;qe(Je>1);const Et=Rt/Je;for(let De=0;De<4;++De){const at=G$[(De+3)%4],It=G$[De%4];if(!at&&!It)continue;const Ki=De===0?1:De===1?2:De===2?3:0,Yi=De===0?2:De===1?3:De===2?0:1;if(at&&It){const er=w8[De][0]*Et,Li=w8[De][1]*Et,Ai=at.extent,ci=vt(Ai[Ki===0||Ki===1?2:0]+er),Vi=Xt(Ai[Ki===0||Ki===3?3:1]+Li),Ei=It.extent,tr=vt(Ei[Yi===0||Yi===1?2:0]+er),Lt=Xt(Ei[Yi===0||Yi===3?3:1]+Li),ui=at.renderData,_i=It.renderData,rr=Tn(ci,Vi,ui.geometryState.samplerData),bn=Tn(tr,Lt,_i.geometryState.samplerData);he(ui,ci,Vi,.5*(rr+bn),De)}else{const er=at??It,Li=at?Ki:Yi,Ai=er.extent,ci=w8[De],Vi=vt(Ai[Li===0||Li===1?2:0]+ci[0]*Et),Ei=Xt(Ai[Li===0||Li===3?3:1]+ci[1]*Et),tr=er.renderData,Lt=Tn(Vi,Ei,tr.geometryState.samplerData);he(tr,Vi,Ei,Lt,De)}}if(!M){const De=Math.sqrt(R*R+I*I+P*P);U=R/De,B=I/De,W=P/De}if(M||W*W<.999){const De=Math.sqrt(j*j+Q*Q+Z*Z);j/=De,Q/=De,Z/=De;const at=Math.sqrt(X*X+ge*ge+ae*ae);X/=at,ge/=at,ae/=at,U=Z*ge-Q*ae,B=j*ae-Z*X,W=Q*X-j*ge;const It=1/Math.sqrt(U*U+B*B+W*W);U*=It,B*=It,W*=It}},ti=i.cornerNeighborCornerTiles;for(let He=0;He<4;++He){const Oi=He,Be=(He+1)%4,tt=He===0||He===1?1:0,dt=He===0||He===3?1:0,Rt=Oe(tt,o,l),Je=Oe(dt,a,c),Et=e.getEdgeFirstVertexIndex(Oi),De=e.getEdgeCount(Oi),at=He===0||He===3?De-1:0,It=e.getEdgeFirstVertexIndex(Be),Ki=e.getEdgeCount(Be),Yi=He===0||He===1?Ki-1:0;let er=-1;for(let ci=0;ci<4;++ci){const Vi=ti[4*He+ci],Ei=ti[4*He+er];Vi&&(er===-1||um(Ei,Vi)>0)&&(er=ci)}const Li=er,Ai=ti[4*He+Li];if(Ai!==g){const ci=g.level-Ai.level,Vi=2**ci,Ei=[Ai.lij[0]+ci,Ai.lij[1]*Vi,Ai.lij[2]*Vi],tr=[Ei[1]+Vi===g.lij[1],He===0&&(Li===1||Li===0&&Ai!==ti[4*He+3])||He===1&&(Li===0||Li===1&&Ai!==ti[4*He+2]),Ei[1]===g.lij[1]+1,He===2&&(Li===3||Li===2&&Ai!==ti[4*He+1])||He===3&&(Li===2||Li===3&&Ai!==ti[4*He+0])],Lt=tr.reduce((di,lr)=>di+(lr?1:0),0);qe(Lt===1||Lt===2);let ui=-1,_i=-1;const rr=Ai.renderData;if(Lt===1){const di=tr.findIndex(Fr=>Fr);qe(0<=di&&di<=3),ui=(di+2)%4;const lr=i.edgeResolutions[di];_i=g.getNeighborEdgeStartVertexIndex(di,Ai)*lr+lr*(di===0&&He===0||di===1&&He===0||di===2&&He===1||di===3&&He===3?1:0)}else{qe(tr[1]||tr[3]),ui=tr[1]?3:1;const di=rr.geometryState.edgeResolutions[ui];_i=He===0||He===3?0:di}const bn=rr.geometry;{const di=Et+at,lr=It+Yi,Fr=bn.getEdgeFirstVertexIndex(ui)+_i,Ts=bn.vertexAttributes,wo=rr.localOrigin;{const Es=Ts.position,Ln=Es.typedBuffer,cn=Fr*Es.typedBufferStride,se=Ln[cn]+wo[0]-r[0],jt=Ln[cn+1]+wo[1]-r[1],Kr=Ln[cn+2]+wo[2]-r[2];ad(se,jt,Kr,h);const yr=p.position,mn=yr.typedBuffer;{const st=di*yr.typedBufferStride;mn[st]=se,mn[st+1]=jt,mn[st+2]=Kr}{const st=lr*yr.typedBufferStride;mn[st]=se,mn[st+1]=jt,mn[st+2]=Kr}}const bo=p.uv0;Wp(bo,di,Rt,Je),Wp(bo,lr,Rt,Je);{const Es=Ts.normalCompressed.typedBuffer,Ln=Fr*Ts.normalCompressed.typedBufferStride,cn=p.normalCompressed,se=cn.typedBuffer;{const jt=di*cn.typedBufferStride;se[jt]=Es[Ln],se[jt+1]=Es[Ln+1]}{const jt=lr*cn.typedBufferStride;se[jt]=Es[Ln],se[jt+1]=Es[Ln+1]}}}}else{const ci=Ce[Oi],Vi=Ce[Be];let Ei;if(ci||Vi){const _i=Oe(G*(1-tt)+K*tt,Le,Ke),rr=Oe(Se*(1-dt)+Ee*dt,Re,ze);Ei=Tn(_i,rr,s)}else Ei=hvt(ti,He);V(tt,dt,Ei),li(He);const tr=R-r[0],Lt=I-r[1],ui=P-r[2];ad(tr,Lt,ui,h),e.setEdgeVertexFromValuesRawPositionUVNormal(Oi,at,tr,Lt,ui,Rt,Je,U,B,W),e.setEdgeVertexFromValuesRawPositionUVNormal(Be,Yi,tr,Lt,ui,Rt,Je,U,B,W)}}for(let He=0;He<4;++He)G$[He]=null}function hvt(t,e){var a,l;const i=4*e,r=eie.reduce((c,h)=>{var p;return Math.min(c,((p=t[i+h])==null?void 0:p.level)??1/0)},1/0);Xs&&(qe(!t[i+0]||!t[i+2]||yY(t[i+0],t[i+2],Tt.SOUTH_WEST)),qe(!t[i+1]||!t[i+3]||yY(t[i+1],t[i+3],Tt.NORTH_WEST)));let n=0,s=0;for(let c=0;c<4;++c){const h=t[i+c];if(h&&h.level===r){const p=c===0||c===1,g=c===0||c===3,y=h.extent,w=y[p?0:2],b=y[g?1:3],x=(l=(a=h.renderData)==null?void 0:a.geometryState)==null?void 0:l.samplerData;s+=Tn(w,b,x),n++}}const o=n?s/n:0;return qe(o!=null),o}function cM(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:n}=i,s=r.position.typedBuffer;e.vertexBuffers.get("geometry").setSubData(s,n,n,s.length)}function R3e(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:n,edgeIndicesStartIndex:s}=i;e.indexBuffer.setSubData(r,s,s,n)}let dvt=class{constructor(e,i,r,n,s){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=n,this.latitudeResolution=s}};const w8=[[0,1],[1,0],[0,-1],[-1,0]],Ao=new a_t,cie=lQ(-1/0,-1/0,1/0,1/0),G$=[null,null,null,null];function I3e(t,e,i){if(!e)return!1;const r=um(t,e);return r>0||r===0&&i>=2}let DD=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return qe(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const uie=[new DD,new DD,new DD,new DD];function ad(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function P3e(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function L3e(t,e,i,r,n,s){const o=t*n,a=s[o],l=s[o+1],c=s[o+2],h=e*n,p=s[h],g=s[h+1],y=s[h+2],w=i*n,b=s[w],x=s[w+1],T=s[w+2],M=r*n,$=s[M],R=s[M+1],I=s[M+2];return(p-$)*(p-$)+(g-R)*(g-R)+(y-I)*(y-I)>(a-b)*(a-b)+(l-x)*(l-x)+(c-T)*(c-T)}function G2(t,e,i,r,n){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=n,t[e+4]=n,t[e+5]=i}const QF=6;let pvt=class extends iie{constructor(e,i,r,n,s){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Zi(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,n,s)}init(e,i,r,n,s){super.init(e,i,r,n,s);const o=s.view.renderSpatialReference,a=s.spatialReference,l=o!=null&&$R(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=s,h=this._extentInRenderSR,p=this.extent;if(c){const g=Qe(p[0],p[1],0);tc(g,nt.WebMercator,g,nt.PlateCarree);const y=Qe(p[2],p[3],0);tc(y,nt.WebMercator,y,nt.PlateCarree),h[0]=g[0],h[1]=g[1],h[2]=y[0],h[3]=y[1]}else for(let g=0;g<4;++g)h[g]=p[g]*l;this.centerAtSeaLevel[0]=.5*(h[0]+h[2]),this.centerAtSeaLevel[1]=.5*(h[1]+h[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(h[2]-h[0],h[3]-h[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),n=Math.sqrt(i*i+r*r),s=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(n,s);this._center[ls.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const p=e[h],g=p[0],y=p[1],w=p[2],b=p[3];if(g*(g>0?r:o)+y*(y>0?n:a)+w*(w>0?s:l)+b>=0)return ka.OUTSIDE;c=c&&g*(g<0?r:o)+y*(y<0?n:a)+w*(w<0?s:l)+b<=0}return c?ka.INSIDE:ka.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return gJe(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,n){return ND[0]=1/i[0],ND[1]=1/i[1],ND[2]=1/i[2],cte(this._aabb(),e,ND,r,n)}createGeometry(){evt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let n=e,s=i;if(r){const o=r.geometry.boundingBox;n=o[2],s=o[5]}else if(!this.leaf){n=1/0,s=-1/0;for(const o of this.children){const a=o;n=Math.min(n,a._subtreeGeometryElevationBoundMin),s=Math.max(s,a._subtreeGeometryElevationBoundMax)}}if(n!==this._subtreeGeometryElevationBoundMin||s!==this._subtreeGeometryElevationBoundMax){this._subtreeGeometryElevationBoundMin=n,this._subtreeGeometryElevationBoundMax=s;const o=this.parent;o==null||o._updateSubtreeGeometryElevationsBounds()}}get minimumVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){ivt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){nvt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){rvt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const ND=A();let fvt=class{constructor(){this.extent=Ti(),this.minLevel=0,this.maxLevel=0,this.callback=null}},KF=class extends Ne{constructor(){super(...arguments),this._queries=new mi({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new mi({initialSize:30}),this._queryPool=new xl(fvt)}queryVisibleLevelRange(e,i,r,n){const s=this._queryPool.acquire();ed(s.extent,e),s.minLevel=i??-Number.MAX_VALUE,s.maxLevel=r??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const n=this._queries.data[r],s=n.extent;i>=n.minLevel&&i<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};u([f()],KF.prototype,"updating",null),KF=u([L("esri.views.3d.terrain.ScaleRangeQueries")],KF);function mvt(t,e,i,r){const n=Math.cos(i);t[0]=Math.cos(e)*n*r,t[1]=Math.sin(e)*n*r,t[2]=Math.sin(i)*r}let gvt=class extends iie{constructor(e,i,r,n,s){super(),this._convexHull=new Array(24),this._boundingSphere=Pn(),this._baseUsedMemory=1816,this.init(e,i,r,n,s)}init(e,i,r,n,s){super.init(e,i,r,n,s);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],h=this.extentInRadians[3],p=Bt(l,h,.5),g=Bt(a,c,.5),y=e===0?0:Math.min(Math.abs(l),Math.abs(h));this._edgeLen=(c-a)*Math.cos(y)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),mvt(this.centerAtSeaLevel,g,p,this.ellipsoid.radius),Me(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)ve(e[ls.MIDDLE],0,0,0),ve(e[ls.TOP],0,0,0),ve(e[ls.BOTTOM],0,0,0),e[ls.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[ls.MIDDLE],r=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,yvt(i,r,3*s));e[ls.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!J_(e,this._boundingSphere))return ka.OUTSIDE;if(this.lij[0]<10)return ka.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<QC;s++){const o=s===mo.NEAR,a=e[s],l=a[0],c=a[1],h=a[2],p=a[3]-(o?r:0);let g=!1;for(let y=0;y<8;++y){const w=3*y;if(l*i[w]+c*i[w+1]+h*i[w+2]+p<0){if(g=!0,!n)break}else n=!1}if(!g)return ka.OUTSIDE}return n?ka.INSIDE:ka.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){q_t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Xs&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBoundsMin,n=this.elevationBoundsMax,s=this.ellipsoid.radius,o=n;if(this.level===0)ve(i,0,0,0),e[3]=s+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],h=a[3];z1(Pfe,l,c,s),z1(Lfe,l,h,s),xe(i,Pfe,Lfe),ue(i,i,(s+.5*(r+n))/ua(i));const p=this.convexHull;let g=0;const y=(b,x)=>{const T=b[0]-p[3*x],M=b[1]-p[3*x+1],$=b[2]-p[3*x+2];return Math.sqrt(T*T+M*M+$*$)};for(let b=0;b<8;++b){const x=y(i,b);g=Math.max(g,x)}const w=g;e[3]=w+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,n=this.elevationBoundsMax,s=this._getPatchType(),o=this.surface.isWebMercator,a=o&&s===Zh.HAS_NORTH_POLE,l=o&&s===Zh.HAS_SOUTH_POLE,c=l||a,h=Math.PI/2,p=e[0],g=e[2],y=l?-h:e[1],w=a?h:e[3],b=.5*(p+g),x=r,T=i+(c?Math.min(0,x-1):x),M=(ae,z,he)=>z1(ae,z,he,T),$=A(),R=A(),I=A(),P=A();M($,p,y),M(R,p,w),M(I,g,w),M(P,g,y);const N=(ae,z)=>{for(let he=0;he<3;++he)this._convexHull[3*z+he]=ae[he]};N($,0),N(R,1),N(I,2),N(P,3);const V=n,U=i+(c?Math.max(0,V+1):V),B=A(),W=A(),j=A();z1(W,b,w,T),z1(j,b,y,T),xe(B,W,j),Me(B,B);const Q=A(),Z=A(),X=(ae,z)=>{nr(Z,ae,z),Me(Z,Z);const he=-Te(ae,Q)/Te(Z,Q);qe(he>=0),ue(Z,Z,he),xe(ae,ae,Z)};if(2**this.lij[0]>2*this.lij[1]){const ae=j,z=A();Ot(z,Ife,ae),Me(z,z),Ot(Q,ae,z),Me(Q,Q),qe(Wh(Te(Q,ae)/ua(ae),0)),X($,R),X(P,I),N($,0),N(P,3)}else if(2**this.lij[0]!==2*this.lij[1]){const ae=W,z=A();Ot(z,Ife,ae),Me(z,z),Ot(Q,z,ae),Me(Q,Q),X(R,$),X(I,P),N(R,1),N(I,2)}const ge=(ae,z)=>{const he=U/Te(z,B);for(let ce=0;ce<3;++ce)this._convexHull[3*ae+ce]=z[ce]*he};ge(4,$),ge(5,R),ge(6,I),ge(7,P)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?Zh.HAS_BOTH_POLES:Zh.HAS_NORTH_POLE:r?Zh.HAS_SOUTH_POLE:Zh.REGULAR}intersectsRay(e,i,r,n){const s=this._boundingSphere,o=s[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=s[0]-e[0],c=s[1]-e[1],h=s[2]-e[2],p=(l*i[0]+c*i[1]+h*i[2])/a,g=i[0]*p-l,y=i[1]*p-c,w=i[2]*p-h;return g*g+y*y+w*w<o*o}get minimumVerticesPerSide(){return this.level<Rfe.length?Rfe[this.level]+1:2}updateCornerElevations(){J_t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){Y_t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){X_t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var Oi;if(!Xs||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,n=A(),s=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=s+o,c=1,h=0,p=this._center[ls.MIDDLE][3],g=this.convexHull,y=(Be,tt)=>{for(let dt=0;dt<3;++dt)Be[dt]=g[3*tt+dt]};{const Be=A(),tt=A(),dt=A(),Rt=A(),Je=A(),Et=(De,at,It,Ki)=>{y(tt,De),y(dt,at),y(Rt,It),nr(tt,tt,dt),nr(Rt,Rt,dt),Ot(Be,tt,Rt),Me(Be,Be);const Yi=Te(Be,dt);y(Je,Ki);const er=Te(Be,Je),Li=Math.abs(er-Yi);qe(Wh(Li,0),`Non coplanar ${De},${at},${It},${Ki} diff = ${Li}`)};Et(0,1,2,3),Et(4,5,6,7),Et(0,1,4,5),Et(1,2,5,6),Et(2,3,6,7),Et(3,0,7,4)}const w=PK(24),b=(Be,tt,dt)=>{const Rt=4*Be;for(let Je=0;Je<3;++Je)w[Rt+Je]=tt[Je];w[Rt+3]=dt},x=A(),T=A(),M=A(),$=A(),R=(Be,tt,dt,Rt)=>{y(x,tt),y(T,dt),y(M,Rt),nr(x,x,T),Me(x,x),nr(M,M,T),Me(M,M),Ot($,x,M),Me($,$);const Je=Te($,T);b(Be,$,Je)};R(0,0,1,2),R(1,1,0,4),R(2,1,5,2),R(3,3,2,6),R(4,4,0,3),R(5,4,6,5);const I=1,P=(Be,tt,dt,Rt)=>{const Je=4*Be;return w[Je]*tt+w[Je+1]*dt+w[Je+2]*Rt-w[Je+3]},N=(Be,tt,dt,Rt)=>P(Be,tt,dt,Rt)>=-I,V=(Be,tt)=>N(Be,tt[0],tt[1],tt[2]),U=2**this.lij[0]>2*this.lij[1],B=(Be,tt,dt)=>Math.sqrt(D3e(Be,tt,dt,r[0],r[1],r[2]))<i,W=Be=>B(Be[0],Be[1],Be[2]),j=(Be,tt)=>B(Be[tt],Be[tt+1],Be[tt+2]),Q=this.extentInRadians,Z=.5*(Q[0]+Q[2]),X=Q[1],ge=Q[3],ae=A(),z=A();z1(ae,Z,ge,l),z1(z,Z,X,l);const he=U?"Upper":"Lower";let ce=!0;for(let Be=0;Be<6;++Be){for(let tt=0;tt<8;++tt){const dt=3*tt,Rt=N(Be,g[dt],g[dt+1],g[dt+2]);ce&&(ce=Rt),qe(Rt,`Tile[${this.lij}] Convex hull point ${tt} outside of plane ${Be}`)}qe(V(Be,z),`Tile[${this.lij}] (${he}) bottom mid outside of plane ${Be}`),qe(V(Be,ae),`Tile[${this.lij}] (${he}) top mid outside of plane ${Be}`)}qe(ce,"Not all convex hull points are inside  convex hull polyhedron"),qe(W(z),`Tile[${this.lij}] (${he}) bottom mid outside of bounding sphere`),qe(W(ae),`Tile[${this.lij}] (${he}) top mid outside of bounding sphere`);for(let Be=0;Be<8;++Be){const tt=j(g,3*Be);qe(tt,`Tile[${this.lij}] Convex hull point ${Be} outside of bounding sphere`)}for(let Be=0;Be<6;++Be)for(let tt=0;tt<8;++tt){const dt=3*tt;N(Be,g[dt],g[dt+1],g[dt+2])||console.error(`Tile[${this.lij}] Convex hull point ${tt} outside of plane ${Be}`)}const{extentInRadians:G}=this,K=Math.max(G[2]-G[0],G[3]-G[1]),Se=Math.round(K*s),{renderData:Ee}=this;if(!Ee)return;const{geometry:Ce,geometryState:Le,localOrigin:Ke}=Ee,Re=(Oi=Ce.vertexAttributes)==null?void 0:Oi.position;if(!Re)return;const ze=A(),vt=Ce.numVerticesPerSide-2,{indices:Xt,indexCount:li,edgeVerticesStartIndex:ti,poleVerticesStartIndex:zi}=Ce;if(!Xt)return;const He=new Set;for(let Be=0;Be<li;++Be){const tt=Xt[Be];if(He.has(tt))continue;He.add(tt);const dt=tt<zi,Rt=tt>=ti;let Je=!1,Et=-1;if(Rt){let Lt=ti;for(let ui=0;ui<4;++ui){const _i=Le.edgeResolutions[ui];if(tt===Lt||tt===Lt+_i-1){Je=!0;break}if(Lt+=_i,tt<Lt){Et=ui;break}}}const De=Rt?Le.edgePeerNeighbors[Et]:null,at=Rt&&De&&um(this,De)>0;Re.getVec(tt,n),xe(ze,n,Ke);const It=ua(ze)-s;let Ki=0,Yi=!1;const er=o-It,Li=It-a,Ai=er>c,ci=Li>c,Vi=Ai||ci,Ei=()=>{const Lt=dt?"internal":Rt&&!Je?"edge":Je?"corner":"pole";return`Tile[${this.lij}].vertex[${tt}]:${Lt}`+(Ai?"(below)":ci?"(above)":"")+(at?"(Neighbor)":"")},tr=Na(ze,r);if(tr>=i+h){const Lt=tr-i;Vi||(console.error(`${Ei()} is out of the bounding sphere by ${Lt.toFixed(0)} / ${i.toFixed(0)}[tol=${h}] h=${It.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Lt/i).toFixed(0)})`),Yi=!0)}for(let Lt=0;Lt<6;++Lt)if(!N(Lt,ze[0],ze[1],ze[2])){const ui=P(Lt,ze[0],ze[1],ze[2]),_i=tt%vt,rr=(tt-_i)/vt;Lt===0&&er||Lt===5&&Li||(console.error(`${Ei()} (${_i},${rr})|${vt}] is out of the bounding trapezoid plane ${Lt} h=${Math.round(It)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(ui)} radii = ${Math.round(i)}/${Math.round(p)}} : maxL = ${Se}`),++Ki)}if(Yi||Ki>0)break}}get convexHull(){return this._convexHull}};const Rfe=[128,64,64,32,16,8,8,4];function yvt(t,e,i){return D3e(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function D3e(t,e,i,r,n,s){const o=r-t,a=n-e,l=s-i;return o*o+a*a+l*l}const z1=(t,e,i,r)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*n,t[1]=r*o*s,t[2]=r*a},Ife=[0,0,1],Pfe=A(),Lfe=A();let ap=class extends Ne{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([f()],ap.prototype,"fovX",void 0),u([f()],ap.prototype,"fovY",void 0),u([f()],ap.prototype,"relativeWidthLimit",void 0),u([f()],ap.prototype,"relativeHeightLimit",void 0),u([f()],ap.prototype,"maxLod",void 0),u([f()],ap.prototype,"angledSplitBias",void 0),u([f()],ap.prototype,"aboveGround",void 0),u([f()],ap.prototype,"frustum",void 0),ap=u([L("esri.views.3d.terrain.SplitLimits")],ap);const _vt=Zc().vec3f(k.POSITION).vec2i16(k.UV0).vec2i16(k.NORMALCOMPRESSED,{glNormalized:!0});let vvt=class{constructor(e){this._storage=new bI((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,n=this._storage,s=wvt(r),o=n.pop(s);if(o)return o;const a=_vt.createBuffer(r);return a.release=()=>n.put(s,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function wvt(t){return t.toString()}let N3e=class extends Ar{constructor(){super(...arguments),this.scale=1,this.offset=Jb}};function F3e(t){t.attributes.add(k.POSITION,"vec2"),t.attributes.add(k.UV0,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new rt("scale",e=>e.scale),new rs("offset",e=>e.offset)),t.vertex.main.add(C`gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;`)}var vs;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(vs||(vs={}));var Xe;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Xe||(Xe={}));const _Y={normal:Xe.Normal,average:Xe.Average,lighten:Xe.Lighten,lighter:Xe.Lighter,screen:Xe.Screen,plus:Xe.Plus,"color-dodge":Xe.ColorDodge,darken:Xe.Darken,multiply:Xe.Multiply,"color-burn":Xe.ColorBurn,overlay:Xe.Overlay,"soft-light":Xe.SoftLight,"hard-light":Xe.HardLight,"vivid-light":Xe.VividLight,hue:Xe.Hue,saturation:Xe.Saturation,luminosity:Xe.Luminosity,color:Xe.Color,difference:Xe.Difference,exclusion:Xe.Exclusion,minus:Xe.Minus,invert:Xe.Invert,reflect:Xe.Reflect,"destination-over":Xe.DestinationOver,"destination-atop":Xe.DestinationAtop,"destination-in":Xe.DestinationIn,"destination-out":Xe.DestinationOut,"source-atop":Xe.SourceAtop,"source-in":Xe.SourceIn,"source-out":Xe.SourceOut,xor:Xe.Xor};function bvt(t){return t===Xe.DestinationOver||t===Xe.DestinationAtop||t===Xe.DestinationIn||t===Xe.DestinationOut||t===Xe.SourceAtop||t===Xe.SourceIn||t===Xe.SourceOut||t===Xe.Xor}var Pa;(function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"})(Pa||(Pa={}));var zh;(function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"})(zh||(zh={}));function xvt(t,e){const i=e.blendMode;i!==Xe.Normal&&(i===Xe.Reflect&&t.code.add(C`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Xe.ColorDodge&&i!==Xe.VividLight||t.code.add(C`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Xe.ColorBurn&&i!==Xe.VividLight||t.code.add(C`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Xe.Overlay&&t.code.add(C`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Xe.HardLight&&t.code.add(C`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Xe.SoftLight&&t.code.add(C`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Xe.VividLight&&t.code.add(C`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Xe.Hue&&i!==Xe.Saturation&&i!==Xe.Color&&i!==Xe.Luminosity||(t.code.add(C`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Xe.Hue&&i!==Xe.Saturation||t.code.add(C`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(C`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Xe.Multiply?C`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Average?C`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Lighten?C`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Darken?C`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Lighter?C`return vec4(cl * ol + cb * ob, ol + ob);`:i===Xe.Plus?C`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Xe.Minus?C`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Xe.Screen?C`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Difference?C`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Invert?C`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Xe.DestinationOver?C`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Xe.DestinationAtop?C`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Xe.DestinationOut?C`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Xe.SourceAtop?C`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Xe.SourceOut?C`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Xe.Xor?C`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Xe.DestinationIn?C`return vec4(cb * ob * ol, ol * ob);`:i===Xe.SourceIn?C`return vec4(cl * ol * ob, ol * ob);`:i===Xe.Hue?C`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Saturation?C`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Color?C`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Luminosity?C`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Exclusion?C`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Reflect?C`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.ColorDodge?C`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.ColorBurn?C`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.Overlay?C`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.SoftLight?C`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.HardLight?C`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Xe.VividLight?C`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:C``}
    }
  `))}function k3e(t,e){const i=e.output===vs.GridComposite,r=e.output===vs.ColorComposite,n=e.output===vs.GroupBackgroundComposite,s=e.output===vs.Composite,o=e.baseOpacityMode===Pa.Required,a=t.fragment;o&&a.uniforms.add(new rt("baseOpacity",p=>p.baseOpacity)),i?a.include(Qte):r?a.uniforms.add(new fi("backgroundColor",p=>p.backgroundColor)):s&&a.uniforms.add(new ht("fboColor",p=>p.fboTexture));const l=e.blendMode!==Xe.Normal,c=e.premultipliedSource===zh.On,h=!l&&!c&&(s&&!o||n);a.include(xvt,e),a.code.add(C`
    vec4 getBackground(vec2 uv) {
      return ${o?C`baseOpacity *`:""} ${n?C`vec4(0.0, 0.0, 0.0, 0.0)`:r?C`vec4(backgroundColor, 1.0)`:i?C`vec4(gridColor(uv), 1.0)`:C`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?C`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:C`
          float composeAlpha = colorLayer.a * opacity;
          ${h?C`return colorLayer * opacity;`:C`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var Ly;function U3e(t){const e=new or,i=e.fragment;if(e.include(F3e),t.background===Ly.Only){const r=t.output===vs.ColorComposite;return r?i.uniforms.add(new fi("backgroundColor",n=>n.backgroundColor)):i.include(Qte),i.main.add(C`fragColor = vec4(${r?C`backgroundColor`:C`gridColor(uv)`}, 1.0);`),e}return e.include(k3e,t),i.uniforms.add(new ht("tex",r=>r.texture),new rt("opacity",r=>r.opacity)),i.main.add(C`fragColor = blendLayers(uv, texture(tex, uv), opacity);`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Ly||(Ly={}));const Svt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Ly},build:U3e},Symbol.toStringTag,{value:"Module"}));let Tvt=class extends N3e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=ws}},Dfe=class extends hr{constructor(e,i,r){super(e,i,new ar(Svt,()=>fe(()=>Promise.resolve().then(()=>fAt),void 0)),r)}};var Nb,fx;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(Nb||(Nb={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(fx||(fx={}));let zv=class Pw{static getId(e,i,r,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${n}`}constructor(e,i,r,n){this.set(e,i,r,n)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,n){this.set(e,i,r,n)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new Pw(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Pw(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,i,r){const n=this.clone();return n.col+=e,n.row+=i,r.normalizeKey(n),n}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,n=this.world;return[new Pw(e,i,r,n),new Pw(e,i,r+1,n),new Pw(e,i+1,r,n),new Pw(e,i+1,r+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};zv.pool=new xl(zv,null,null,25,50);function ZS(t,e){return[t,e]}function V1(t,e,i){return t[0]=e,t[1]=i,t}function Evt(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}const Hd=new zv("0/0/0/0");let Cvt=class z3e{static create(e,i,r=null){const n=cy(e.spatialReference),s=i.origin||ZS(e.origin.x,e.origin.y),o=ZS(e.size[0]*i.resolution,e.size[1]*i.resolution),a=ZS(-1/0,-1/0),l=ZS(1/0,1/0),c=ZS(1/0,1/0);r!=null&&(V1(a,Math.max(0,Math.floor((r.xmin-s[0])/o[0])),Math.max(0,Math.floor((s[1]-r.ymax)/o[1]))),V1(l,Math.max(0,Math.floor((r.xmax-s[0])/o[0])),Math.max(0,Math.floor((s[1]-r.ymin)/o[1]))),V1(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:h,rows:p}=i;let g,y,w,b;return!r&&h&&p&&(V1(a,h[0],p[0]),V1(l,h[1],p[1]),V1(c,h[1]-h[0]+1,p[1]-p[0]+1)),e.isWrappable?(g=ZS(Math.ceil(Math.round((n.valid[1]-n.valid[0])/i.resolution)/e.size[0]),c[1]),y=!0,w=n.origin,b=n.valid):(g=c,y=!1),new z3e(i.level,i.resolution,i.scale,s,a,l,c,o,g,y,w,b)}constructor(e,i,r,n,s,o,a,l,c,h,p,g){this.level=e,this.resolution=i,this.scale=r,this.origin=n,this.first=s,this.last=o,this.size=a,this.norm=l,this.worldSize=c,this.wrap=h,this._spatialReferenceOrigin=p,this._spatialReferenceValid=g}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}normalizeKey(e){if(!this.wrap)return;const i=this.worldSize[0],r=e.col;r<0?(e.col=r+i,e.world-=1):r>=i&&(e.col=r-i,e.world+=1)}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const i=this.origin[0]+e*this.norm[0],r=this._spatialReferenceOrigin,n=this._spatialReferenceValid;return this.wrap&&r&&n?i===r[0]?n[0]:this.origin[0]===r[0]&&e===this.worldSize[0]?n[1]:i:i}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Hd.set(i);const n=r?Hd.col:this.denormalizeCol(Hd.col,Hd.world),s=Hd.row;return Evt(e,this.getXForColumn(n),this.getYForRow(s+1),this.getXForColumn(n+1),this.getYForRow(s)),e}getTileCoords(e,i,r=!1){Hd.set(i);const n=r?Hd.col:this.denormalizeCol(Hd.col,Hd.world);return Array.isArray(e)?V1(e,this.getXForColumn(n),this.getYForRow(Hd.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(Hd.row)),e}},vY=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:n}of this.spans)for(let s=r;s<=n;s++){const o=e.getWorldForColumn(s);yield new zv(e.level,i,e.normalizeCol(s),o)}}forEach(e,i){const{spans:r,lodInfo:n}=this,{level:s}=n;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,s,o,n.normalizeCol(c),n.getWorldForColumn(c))}};vY.pool=new xl(vY);let b8=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Hn=new zv("0/0/0/0");let Mvt=class V3e{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,n]=e,[s,o]=i,a=s-r,l=o-n,c=l!==0?a/l:0,h=(Math.ceil(n)-n)*c,p=(Math.floor(n)-n)*c;return new V3e(r,Math.floor(n),Math.ceil(o),c,a<0?h:p,a<0?p:h,a<0?s:r,a<0?r:s)}constructor(e,i,r,n,s,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=n,this.leftAdjust=s,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const hu=[[0,0],[0,0],[0,0],[0,0]],$vt=1e-6;let Gjt=class{constructor(e,i=null,r=e.lods[0].level,n=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const s=e.lods.filter(a=>a.level>=r&&a.level<=n);this.minScale=s[0].scale,this.maxScale=s[s.length-1].scale;const o=this._lodInfos=s.map(a=>Cvt.create(e,a,i));s.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Hn.set(i);const n=this._infoByLevel[Hn.level];return n?n.getTileBounds(e,Hn,r):e}getTileCoords(e,i,r=!1){Hn.set(i);const n=this._infoByLevel[Hn.level];return n?n.getTileCoords(e,Hn,r):e}getTileCoverage(e,i=192,r=!0,n="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const s=n==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=vY.pool.acquire(s),a=this._wrap;let l,c,h,p=1/0,g=-1/0;const y=o.spans;hu[0][0]=hu[0][1]=hu[1][1]=hu[3][0]=-i,hu[1][0]=hu[2][0]=e.size[0]+i,hu[2][1]=hu[3][1]=e.size[1]+i;for(const T of hu)e.toMap(T,T),T[0]=s.getColumnForX(T[0]),T[1]=s.getRowForY(T[1]);const w=[];let b=3;for(let T=0;T<4;T++){if(hu[T][1]===hu[b][1]){b=T;continue}const M=Mvt.create(hu[T],hu[b]);p=Math.min(M.ymin,p),g=Math.max(M.ymax,g),w[M.ymin]===void 0&&(w[M.ymin]=[]),w[M.ymin].push(M),b=T}if(p==null||g==null||g-p>100)return null;let x=[];for(l=p;l<g;){w[l]!=null&&(x=x.concat(w[l])),c=1/0,h=-1/0;for(let T=x.length-1;T>=0;T--){const M=x[T];c=Math.min(c,M.getLeftCol()),h=Math.max(h,M.getRightCol())}if(c=Math.floor(c),h=Math.floor(h),l>=s.first[1]&&l<=s.last[1])if(a)if(s.size[0]<s.worldSize[0]){const T=Math.floor(h/s.worldSize[0]);for(let M=Math.floor(c/s.worldSize[0]);M<=T;M++)y.push(new b8(l,Math.max(s.getFirstColumnForWorld(M),c),Math.min(s.getLastColumnForWorld(M),h)))}else y.push(new b8(l,c,h));else c>s.last[0]||h<s.first[0]||(c=Math.max(c,s.first[0]),h=Math.min(h,s.last[0]),y.push(new b8(l,c,h)));l+=1;for(let T=x.length-1;T>=0;T--){const M=x[T];M.ymax>=l?M.incrRow():x.splice(T,1)}}return o}getTileParentId(e){Hn.set(e);const i=this._infoByLevel[Hn.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Hn,this._lodInfos[r],Hn),Hn.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Hn.set(i);const r=this._infoByLevel[Hn.level],n=e.lodInfo;if(n.resolution>r.resolution){this._getTileIdAtLOD(Hn,n,Hn);const o=n.denormalizeCol(Hn.col,Hn.world);for(const a of e.spans)if(a.row===Hn.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(n.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((b,x)=>(b[0]=Math.min(b[0],x.row),b[1]=Math.max(b[1],x.row),b[2]=Math.min(b[2],x.colFrom),b[3]=Math.max(b[3],x.colTo),b),[1/0,-1/0,1/0,-1/0]),h=r.denormalizeCol(Hn.col,Hn.world),p=n.getColumnForX(r.getXForColumn(h)),g=n.getRowForY(r.getYForRow(Hn.row)),y=n.getColumnForX(r.getXForColumn(h+1))-1,w=n.getRowForY(r.getYForRow(Hn.row+1))-1;return!(p>c||y<l||g>a||w<o)}const s=n.denormalizeCol(Hn.col,Hn.world);return e.spans.some(o=>o.row===Hn.row&&o.colFrom<=s&&o.colTo>=s)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const n=cy(this.tileInfo.spatialReference),s=-r*(n.valid[1]-n.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+$vt)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,n)=>Math.abs(n-e)<Math.abs(r-e)?n:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const n=this._infoByLevel[r.level];return e.set(r),i.resolution<n.resolution?null:(i.resolution===n.resolution||(e.level=i.level,e.col=Math.floor(r.col*n.resolution/i.resolution+.01),e.row=Math.floor(r.row*n.resolution/i.resolution+.01)),e)}},Ovt=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},Avt=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new yF,this._controllers=new yF,this._processingItems=new yF,this._pausedSignal=Xl(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new S5(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Sr(this._schedule),this._task=Sr(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const n=new AbortController;let s=null;i&&(s=_a(i,()=>n.abort()));const o=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),a(),c.reject(ki())},a=()=>{l.remove(),s!=null&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=R3(n.signal,o),c=Ho();return this._deferreds.set(e,c),this._controllers.set(e,n),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var i;const e=this._queue.popLast();return e&&((i=this._deferreds.get(e))==null||i.reject(ki()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=AC(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,n=new Ovt(e,r);this._processingItems.set(e,n);try{i=this.process(e,r.signal)}catch(s){this._processError(n,s)}qu(i)?(n.promise=i,i.then(s=>this._processResult(n,s),s=>this._processError(n,s))):this._processResult(n,i)}get test(){}};const Nfe=[0,0];let H0=class extends Ne{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:i,scheduler:r,priority:n}=this;this._queue=new Avt({concurrency:e,scheduler:r,priority:n,process:(s,o)=>{const a=this._keyToItem.get(s);return i(a,{signal:o})},peeker:s=>this._peek(s)})}destroy(){this.clear(),this._queue=Ye(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),n=this.tileInfoView.getTileScale(e.key),s=hU(this._tilesByScale,n,()=>new Set),o=()=>{s.delete(e.key),s.size===0&&this._tilesByScale.delete(n),this._keyToItem.delete(i)};return s.add(e.key),this._keyToItem.set(i,e),r.then(o,o),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const i=new Set;for(const o of e)i.add(this._keyToItem.get(o).key);const r=this.state.scale;let n,s=Number.POSITIVE_INFINITY;for(const[o,a]of this._tilesByScale)if(PA(a,l=>i.has(l))){const l=Math.abs(o-r);l<s&&(n=a,s=l)}return this._getClosestTileKey(n,e).id}_getClosestTileKey(e,i){const r=this.tileInfoView,n=this.state.center;let s,o=Number.POSITIVE_INFINITY;for(const a of e)if(i.has(a.id)){r.getTileCoords(Nfe,a);const l=Lv(Nfe,n);l<o&&(o=l,s=a)}return s}};u([f({constructOnly:!0})],H0.prototype,"concurrency",void 0),u([f({constructOnly:!0})],H0.prototype,"priority",void 0),u([f({constructOnly:!0})],H0.prototype,"process",void 0),u([f({constructOnly:!0})],H0.prototype,"scheduler",void 0),u([f()],H0.prototype,"state",void 0),u([f({constructOnly:!0})],H0.prototype,"tileInfoView",void 0),H0=u([L("esri.views.2d.tiling.TileQueue")],H0);new zv(0,0,0,0);function jk(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function B3e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Rvt(t,e,i,r,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function Ivt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:B3e,create:jk,createView:Ivt,fromValues:Rvt},Symbol.toStringTag,{value:"Module"}));let Pvt=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},Lvt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};const Jjt=!0,Dvt=32,Nvt=200;var wY,Ffe,kfe;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(wY||(wY={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Ffe||(Ffe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(kfe||(kfe={}));const Fvt=512;var Hg,sa;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(Hg||(Hg={}));let Da=class e4{constructor(e,i){this.x=e,this.y=i}clone(){return new e4(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,n=this.y;return this.x=r*e-n*i,this.y=r*i+n*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,n=i.y-e.y;return Math.sqrt(r*r+n*n)}static add(e,i){return new e4(e.x+i.x,e.y+i.y)}static sub(e,i){return new e4(e.x-i.x,e.y-i.y)}},FD=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},Kjt=class{constructor(e,i,r,n=8,s=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=s,this._tileSize=Fvt*n,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new Da(e,i),this._firstPt=new Da(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),n=new Da(e,i),s=Da.distance(this._prevPt,n);let o,a,l,c,h,p,g,y;if(r)this._prevIsIn?this._lineTo(e,i,!0):(o=this._prevPt,a=n,l=this._intersect(a,o),this._start=this._dist+s*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=n,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const w=this._prevPt,b=n;if(w.x<=this._xmin&&b.x<=this._xmin||w.x>=this._xmax&&b.x>=this._xmax||w.y<=this._ymin&&b.y<=this._ymin||w.y>=this._ymax&&b.y>=this._ymax)this._lineTo(b.x,b.y,!1);else{const x=[];if((w.x<this._xmin&&b.x>this._xmin||w.x>this._xmin&&b.x<this._xmin)&&(c=(this._xmin-w.x)/(b.x-w.x),y=w.y+c*(b.y-w.y),y<=this._ymin?p=!1:y>=this._ymax?p=!0:x.push(new FD(c,this._xmin,y))),(w.x<this._xmax&&b.x>this._xmax||w.x>this._xmax&&b.x<this._xmax)&&(c=(this._xmax-w.x)/(b.x-w.x),y=w.y+c*(b.y-w.y),y<=this._ymin?p=!1:y>=this._ymax?p=!0:x.push(new FD(c,this._xmax,y))),(w.y<this._ymin&&b.y>this._ymin||w.y>this._ymin&&b.y<this._ymin)&&(c=(this._ymin-w.y)/(b.y-w.y),g=w.x+c*(b.x-w.x),g<=this._xmin?h=!1:g>=this._xmax?h=!0:x.push(new FD(c,g,this._ymin))),(w.y<this._ymax&&b.y>this._ymax||w.y>this._ymax&&b.y<this._ymax)&&(c=(this._ymax-w.y)/(b.y-w.y),g=w.x+c*(b.x-w.x),g<=this._xmin?h=!1:g>=this._xmax?h=!0:x.push(new FD(c,g,this._ymax))),x.length===0)h?p?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):p?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(x.length>1&&x[0].ratio>x[1].ratio)this._start=this._dist+s*x[1].ratio,this._lineTo(x[1].x,x[1].y,!0),this._lineTo(x[0].x,x[0].y,!0);else{this._start=this._dist+s*x[0].ratio;for(let T=0;T<x.length;T++)this._lineTo(x[T].x,x[T].y,!0)}this._lineTo(b.x,b.y,!1)}}this._dist+=s,this._prevIsIn=r,this._prevPt=n}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let n=r.length;for(;n>=4&&(r[0].x===r[1].x&&r[0].x===r[n-2].x||r[0].y===r[1].y&&r[0].y===r[n-2].y);)r.pop(),r[0].x=r[n-2].x,r[0].y=r[n-2].y,--n}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===Hg.Polygon&&e&&kvt.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Hg.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let n=0;n<i;n++)r.push({line:e[n],start:this._starts[n]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,n,s;if(i.x>=this._xmin&&i.x<=this._xmax)n=i.y<=this._ymin?this._ymin:this._ymax,s=(n-e.y)/(i.y-e.y),r=e.x+s*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,s=(r-e.x)/(i.x-e.x),n=e.y+s*(i.y-e.y);else{n=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const o=(r-e.x)/(i.x-e.x),a=(n-e.y)/(i.y-e.y);o<a?(s=o,n=e.y+o*(i.y-e.y)):(s=a,r=e.x+a*(i.x-e.x))}return this._r=s,new Da(r,n)}_pushLine(){this._line&&(this._type===Hg.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Hg.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Hg.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==Hg.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Da(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Da(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let n,s;if(this._type!==Hg.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(e,i)))return;this._line.push(new Da(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const o=n.x===e,a=n.y===i;if(o&&a)return;this._isH&&o||this._isV&&a?(n.x=e,n.y=i,s=this._line[this._line.length-2],s.x===e&&s.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(s=this._line[this._line.length-2],this._isH=s.x===e,this._isV=s.y===i)):(this._isH=s.x===e,this._isV=s.y===i)):(this._line.push(new Da(e,i)),this._isH=o,this._isV=a)}else this._line.push(new Da(e,i))}},tGt=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new Da(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new Da(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(sa||(sa={}));let kvt=class y_{static simplify(e,i,r){if(!r)return;const n=-i,s=e+i,o=-i,a=e+i,l=[],c=[],h=r.length;for(let g=0;g<h;++g){const y=r[g];if(!y||y.length<2)continue;let w,b=y[0];const x=y.length;for(let T=1;T<x;++T)w=y[T],b.x===w.x&&(b.x<=n&&(b.y>w.y?(l.push(g),l.push(T),l.push(sa.sideLeft),l.push(-1)):(c.push(g),c.push(T),c.push(sa.sideLeft),c.push(-1))),b.x>=s&&(b.y<w.y?(l.push(g),l.push(T),l.push(sa.sideRight),l.push(-1)):(c.push(g),c.push(T),c.push(sa.sideRight),c.push(-1)))),b.y===w.y&&(b.y<=o&&(b.x<w.x?(l.push(g),l.push(T),l.push(sa.sideTop),l.push(-1)):(c.push(g),c.push(T),c.push(sa.sideTop),c.push(-1))),b.y>=a&&(b.x>w.x?(l.push(g),l.push(T),l.push(sa.sideBottom),l.push(-1)):(c.push(g),c.push(T),c.push(sa.sideBottom),c.push(-1)))),b=w}if(l.length===0||c.length===0)return;y_.fillParent(r,c,l),y_.fillParent(r,l,c);const p=[];y_.calcDeltas(p,c,l),y_.calcDeltas(p,l,c),y_.addDeltas(p,r)}static fillParent(e,i,r){const n=r.length,s=i.length;for(let o=0;o<s;o+=4){const a=i[o],l=i[o+1],c=i[o+2],h=e[a][l-1],p=e[a][l];let g=8092,y=-1;for(let w=0;w<n;w+=4){if(r[w+2]!==c)continue;const b=r[w],x=r[w+1],T=e[b][x-1],M=e[b][x];switch(c){case sa.sideLeft:case sa.sideRight:if(kD(h.y,T.y,M.y)&&kD(p.y,T.y,M.y)){const $=Math.abs(M.y-T.y);$<g&&(g=$,y=w)}break;case sa.sideTop:case sa.sideBottom:if(kD(h.x,T.x,M.x)&&kD(p.x,T.x,M.x)){const $=Math.abs(M.x-T.x);$<g&&(g=$,y=w)}}}i[o+3]=y}}static calcDeltas(e,i,r){const n=i.length;for(let s=0;s<n;s+=4){const o=[],a=y_.calcDelta(s,i,r,o);e.push(i[s]),e.push(i[s+1]),e.push(i[s+2]),e.push(a)}}static calcDelta(e,i,r,n){const s=i[e+3];if(s===-1)return 0;const o=n.length;return o>1&&n[o-2]===s?0:(n.push(s),y_.calcDelta(s,r,i,n)+1)}static addDeltas(e,i){const r=e.length;let n=0;for(let s=0;s<r;s+=4){const o=e[s+3];o>n&&(n=o)}for(let s=0;s<r;s+=4){const o=i[e[s]],a=e[s+1],l=n-e[s+3];switch(e[s+2]){case sa.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case sa.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case sa.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case sa.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const kD=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,rGt=Number.POSITIVE_INFINITY,hie=Math.PI,nGt=2*hie,Uvt=128/hie,zvt=256/360,sGt=hie/180,Vvt=1/Math.LN2;function j3e(t,e){return(t%=e)>=0?t:t+e}function oGt(t){return j3e(t*Uvt,256)}function aGt(t){return j3e(t*zvt,256)}function lGt(t){return Math.log(t)*Vvt}function cGt(t,e,i){return t*(1-i)+e*i}const Bvt=8,jvt=14,Gvt=16;function uGt(t){return Bvt+Math.max((t-jvt)*Gvt,0)}function hGt(t,e,i){let r,n,s,o=0;for(const a of i){r=a.length;for(let l=1;l<r;++l)n=a[l-1],s=a[l],n.y>e!=s.y>e&&((s.x-n.x)*(e-n.y)-(s.y-n.y)*(t-n.x)>0?o++:o--)}return o!==0}function dGt(t,e,i,r){let n,s,o,a;const l=r*r;for(const c of i){const h=c.length;if(!(h<2)){n=c[0].x,s=c[0].y;for(let p=1;p<h;++p){if(o=c[p].x,a=c[p].y,Xze(t,e,n,s,o,a)<l)return!0;n=o,s=a}}}return!1}function Hvt(t,e,i,r,n,s,o){const a=Math.max(r,Math.min(e,s))-e,l=Math.max(n,Math.min(i,o))-i;return a*a+l*l<=t*t}function pGt(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new Da(0,0),n=new Da(0,0),s=new Da(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const h=a[c-1],p=a[c],g=a[c+1];c===0?r.setCoords(0,0):r.assignSub(p,h).normalize().rightPerpendicular(),c===a.length-1?n.setCoords(0,0):n.assignSub(g,p).normalize().rightPerpendicular(),s.assignAdd(r,n).normalize();const y=s.x*n.x+s.y*n.y;y!==0&&s.scale(1/y),l.push(Da.add(p,s.scale(e)))}i.push(l)}return i}function fGt(t,e,i,r){const n=new Da(t[0],t[1]);if(n.scale(r),e==="viewport"){const s=-i*(Math.PI/180),o=Math.cos(s),a=Math.sin(s);n.rotate(o,a)}return n}function Ufe(t,e,i,r,n,s){const o=i-n;if(o>=0)return(e>>o)+(r-(s<<o))*(t>>o);const a=-o;return e-(s-(r<<a))*(t>>a)<<a}let G3e=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][n]||null}getCellSpan(e,i,r,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function gGt(t,e,i,r,n,s,o){const a=e[r++];for(let l=0;l<a;l++){const c=new Pvt(s,o);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const h=e[r++];for(let y=0;y<h;y++){const w=e[r++],b=e[r++],x=e[r++],T=e[r++],M=!!e[r++],$=e[r++],R=i[r++],I=i[r++],P=e[r++],N=e[r++];c.colliders.push({xTile:w,yTile:b,dxPixels:x,dyPixels:T,hard:M,partIndex:$,width:P,height:N,minLod:R,maxLod:I})}const p=t[r++];for(let y=0;y<p;y++)c.textVertexRanges.push([t[r++],t[r++]]);const g=t[r++];for(let y=0;y<g;y++)c.iconVertexRanges.push([t[r++],t[r++]]);n.push(c)}return r}function qvt(t,e,i){for(const[r,n]of t.symbols)Wvt(t,e,i,n,r)}function Wvt(t,e,i,r,n){const s=t.layerData.get(n);if(s.type===wY.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0];c.startOpacity;const h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)s.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1];c.startOpacity;const h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)s.textOpacity[p/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}function Zvt(t,e,i,r){const n=t.colliders;let s,o,a,l;for(const c of n)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(s=c.xScreen-r[0]+c.dxScreen,o=c.yScreen-r[1]+c.dyScreen,a=s+c.width,l=o+c.height,Hvt(i,e.x,e.y,s,o,a,l)))return!0;return!1}var bY,xY,zfe,Vfe,Bfe,jfe,Gfe,Hfe,qfe,Wfe,SY,TY,Zfe,Yfe,Xfe,Jfe,Qfe,Kfe,eme,tme,ime,rme,nme,sme,ome,ame,lme,cme,ume,hme,dme,pme,fme,mme,gme,yme,_me,vme,wme,bme,xme,Sme,Tme,Eme,Cme,Mme,$me,Ome,Ame,Rme,Ime,Pme,Lme,Dme,Nme,Fme,kme,Ume,zme,Vme,Bme,jme;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(bY||(bY={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(xY||(xY={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(zfe||(zfe={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Vfe||(Vfe={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Bfe||(Bfe={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(jfe||(jfe={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(Gfe||(Gfe={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Hfe||(Hfe={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(qfe||(qfe={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Wfe||(Wfe={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(SY||(SY={})),function(t){t.Linear="Linear",t.EaseIn="EaseIn",t.EaseOut="EaseOut",t.EaseInOut="EaseInOut"}(TY||(TY={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Zfe||(Zfe={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Yfe||(Yfe={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Xfe||(Xfe={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Jfe||(Jfe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Qfe||(Qfe={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(Kfe||(Kfe={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(eme||(eme={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(tme||(tme={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(ime||(ime={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",t.ConcentricCircles="ConcentricCircles",t.DoubleJogArrow="DoubleJogArrow",t.LinkedChevrons="LinkedChevrons",t.SegmentThenHalfCircle="SegmentThenHalfCircle",t.LineWithStraightTicks="LineWithStraightTicks",t.DoubleCurve="DoubleCurve",t.ParallelWithTicksByWidth="ParallelWithTicksByWidth",t.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(rme||(rme={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(nme||(nme={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(sme||(sme={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(ome||(ome={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(ame||(ame={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(lme||(lme={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(cme||(cme={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(ume||(ume={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(hme||(hme={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(dme||(dme={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(pme||(pme={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(fme||(fme={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(mme||(mme={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(gme||(gme={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(yme||(yme={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(_me||(_me={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(vme||(vme={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(wme||(wme={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(bme||(bme={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(xme||(xme={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(Sme||(Sme={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Tme||(Tme={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Eme||(Eme={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Cme||(Cme={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(Mme||(Mme={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}($me||($me={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Ome||(Ome={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(Ame||(Ame={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Rme||(Rme={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Ime||(Ime={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Pme||(Pme={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Lme||(Lme={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Dme||(Dme={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Nme||(Nme={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Fme||(Fme={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(kme||(kme={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(Ume||(Ume={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(zme||(zme={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Vme||(Vme={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Bme||(Bme={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(jme||(jme={}));var EY,B_,Gk,Ep,CY,Hk,MY,j_,$Y;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(EY||(EY={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(B_||(B_={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(Gk||(Gk={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(Ep||(Ep={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(CY||(CY={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(Hk||(Hk={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(MY||(MY={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(j_||(j_={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}($Y||($Y={}));let qd=class{};qd.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B_.VISIBLE}},qd.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B_.VISIBLE}},qd.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B_.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:bY.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:xY.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},qd.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B_.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:Gk.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:Hk.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Ep.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:Hk.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:CY.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Ep.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:MY.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[$Y.HORIZONTAL]}},qd.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B_.VISIBLE}},qd.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},qd.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:j_.MAP}},qd.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:j_.MAP},"line-width":{type:"number",minimum:0,default:1}},qd.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:j_.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:j_.MAP}},qd.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},qd.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:j_.MAP}};function Yvt(t,e,i,r,n,s){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:h,textTranslateAnchor:p}=r;let g=0;for(const y of t.colliders){const[w,b]=y.partIndex===0?l:h,x=y.partIndex===0?c:p,T=y.minLod<=s&&s<=y.maxLod;g+=T?0:1,y.enabled=T,y.xScreen=y.xTile*n[0]+y.yTile*n[3]+n[6],y.yScreen=y.xTile*n[1]+y.yTile*n[4]+n[7],x===j_.MAP?(y.xScreen+=i*w-e*b,y.yScreen+=e*w+i*b):(y.xScreen+=w,y.yScreen+=b),Ep.VIEWPORT===(y.partIndex===0?o:a)?(y.dxScreen=y.dxPixels,y.dyScreen=y.dyPixels):(y.dxScreen=i*(y.dxPixels+y.width/2)-e*(y.dyPixels+y.height/2)-y.width/2,y.dyScreen=e*(y.dxPixels+y.width/2)+i*(y.dyPixels+y.height/2)-y.height/2)}t.colliders.length>0&&g===t.colliders.length&&(t.unique.show=!1)}let Xvt=class{constructor(e,i,r,n,s,o){this._symbols=e,this._styleRepository=n,this._zoom=s,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new G3e(i,r,Dvt),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const l of a.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,B3e(l.tile.transforms.tileUnitsToPixels))}work(e){const i=this._gridIndex;function r(s){const o=s.xScreen+s.dxScreen,a=s.yScreen+s.dyScreen,l=o+s.width,c=a+s.height,[h,p,g,y]=i.getCellSpan(o,a,l,c);for(let w=p;w<=y;w++)for(let b=h;b<=g;b++){const x=i.cells[w][b];for(const T of x){const M=T.xScreen+T.dxScreen,$=T.yScreen+T.dyScreen,R=M+T.width,I=$+T.height;if(!(l<M||o>R||c<$||a>I))return!0}}return!1}const n=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const s=this._symbols[this._currentLayerCursor],o=this._getProperties(s.styleLayerUID);for(;this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-n>e)return!1;const a=s.symbols[this._currentSymbolCursor];if(!a.unique.show)continue;Yvt(a,this._si,this._co,o,this._allNeededMatrices.get(a.tile),this._zoom);const l=a.unique;if(!l.show)continue;const{iconAllowOverlap:c,iconIgnorePlacement:h,textAllowOverlap:p,textIgnorePlacement:g}=o;for(const y of a.colliders){if(!y.enabled)continue;const w=l.parts[y.partIndex];w.show&&!(y.partIndex?p:c)&&r(y)&&(y.hard?l.show=!1:w.show=!1)}if(l.show)for(const y of a.colliders){if(!y.enabled||(y.partIndex?g:h)||!l.parts[y.partIndex].show)continue;const w=y.xScreen+y.dxScreen,b=y.yScreen+y.dyScreen,x=w+y.width,T=b+y.height,[M,$,R,I]=this._gridIndex.getCellSpan(w,b,x,T);for(let P=$;P<=I;P++)for(let N=M;N<=R;N++)this._gridIndex.cells[P][N].push(y)}}}return!0}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._zoom,n=this._styleRepository.getStyleLayerByUID(e),s=n.getLayoutValue("symbol-placement",r)!==Gk.POINT;let o=n.getLayoutValue("icon-rotation-alignment",r);o===Ep.AUTO&&(o=s?Ep.MAP:Ep.VIEWPORT);let a=n.getLayoutValue("text-rotation-alignment",r);a===Ep.AUTO&&(a=s?Ep.MAP:Ep.VIEWPORT);const l=n.getPaintValue("icon-translate",r),c=n.getPaintValue("icon-translate-anchor",r),h=n.getPaintValue("text-translate",r),p=n.getPaintValue("text-translate-anchor",r),g={iconAllowOverlap:n.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:n.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:n.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:n.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:p,textTranslate:h};return this._styleProps.set(e,g),g}};function Jvt(t,e){if(t.priority-e.priority)return t.priority-e.priority;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let Qvt=class{get running(){return this._running}constructor(e,i,r,n,s,o){this._visibleTiles=e,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=s,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let l=0;l<e.length;l++){const c=e[l];for(let h=0;h<c.uniqueSymbols.length;h++){const p=c.uniqueSymbols[h];for(const g of p.tileSymbols)g.selectedForRendering=!1}}const i=[];let r=0,n=0;const s=this._isLayerVisible;function o(l){let c;const h=performance.now();for(;n<e.length;n++,r=0){const p=e[n],g=p.styleLayerUID;if(!s(g)){i[n]||(i[n]={styleLayerUID:g,symbols:[]});continue}i[n]=i[n]||{styleLayerUID:g,symbols:[]};const y=i[n];for(;r<p.uniqueSymbols.length;r++){if(c=p.uniqueSymbols[r],r%100==99&&performance.now()-h>l)return!1;let w=null,b=!1,x=!1;for(const T of c.tileSymbols)if(!x||!b){const M=T.tile;(!w||M.isCoverage||M.neededForCoverage&&!b)&&(w=T,(M.neededForCoverage||M.isCoverage)&&(x=!0),M.isCoverage&&(b=!0))}if(w.selectedForRendering=!0,x){y.symbols.push(w),c.show=!0;for(const T of c.parts)T.show=!0}else c.show=!1}}for(const p of i)p.symbols.sort(Jvt);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return i.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function n(s,o){for(const a of s.symbols.values())Kvt(a,o);e(s,o);for(const a of s.childrenTiles)n(a,o)}return{work(s){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>s)return!1;const a=i[r];a.parentTile==null&&n(a,performance.now())}return!0}}}};function Kvt(t,e){for(const i of t){const r=i.unique;for(const n of r.parts){const s=n.targetOpacity>.5?1:-1;n.startOpacity+=s*((e-n.startTime)/Nvt),n.startOpacity=Math.min(Math.max(n.startOpacity,0),1),n.startTime=e,n.targetOpacity=r.show&&n.show?1:0}}}const e1t=32,t1t=8,i1t=64,r1t=20;let n1t=class{constructor(e,i,r){this.tileCoordRange=e,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,i){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const n=new Map;if(i)for(const a of i)r.symbols.has(a)&&(n.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(const[a,l]of e.layerData)r.symbols.has(a)&&(n.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(n);const s=e.symbols,o=new Map;for(const[a,l]of s){let c=l.length;if(c>=e1t){let h=this.tileCoordRange;do h/=2,c/=4;while(c>t1t&&h>i1t);const p=new G3e(this.tileCoordRange,this.tileCoordRange,h);o.set(a,{flat:l,index:p}),r.symbols.set(a,{flat:l,index:p});for(const g of l)p.getCell(g.xTile,g.yTile).push(g)}else o.set(a,{flat:l}),r.symbols.set(a,{flat:l})}this._addSymbols(e.key,s)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[i,r]of this._tiles){const n=new Map;for(const s of e)r.symbols.has(s)&&(n.set(s,r.symbols.get(s)),r.symbols.delete(s));this._removeSymbols(n),r.symbols.size===0&&this._tiles.delete(i)}}removeTile(e){this._uniqueSymbolLayerArray=null;const i=this._tiles.get(e.id);if(!i)return;const r=new Map;for(const[n,s]of e.symbols)i.symbols.has(n)&&(r.set(n,i.symbols.get(n)),i.symbols.delete(n));this._removeSymbols(r),i.symbols.size===0&&this._tiles.delete(e.id)}querySymbols(e,i,r,n){const s=[],o=this.uniqueSymbols;for(const a of o){const l=a.styleLayerUID,c=a.uniqueSymbols;for(const h of c){const p=h.tileSymbols.find(g=>g.selectedForRendering);p&&Zvt(p,e,i*(window.devicePixelRatio||1),r)&&s.push({vtlSymbol:p,styleLayerUID:l,tileKey:p.tile.key})}}return s}_removeSymbols(e){for(const[i,{flat:r}]of e)for(const n of r){const s=n.unique,o=s.tileSymbols,a=o.length-1;for(let l=0;l<a;l++)if(o[l]===n){o[l]=o[a];break}if(o.length=a,a===0){const l=this._uniqueSymbolsReferences.get(i);l.delete(s),l.size===0&&this._uniqueSymbolsReferences.delete(i)}n.unique=null}}_addSymbols(e,i){if(i.size===0)return;const r=this._visibleTiles;for(const n of r)n.parentTile||n.key.world!==e.world||n.key.level===e.level&&!n.key.equals(e)||this._matchSymbols(n,e,i);for(const[n,s]of i)for(const o of s)if(o.unique==null){const a=this._createUnique();o.unique=a,a.tileSymbols.push(o);let l=this._uniqueSymbolsReferences.get(n);l||(l=new Set,this._uniqueSymbolsReferences.set(n,l)),l.add(a)}}_matchSymbols(e,i,r){if(e.key.level>i.level){const s=e.key.level-i.level;if(e.key.row>>s!==i.row||e.key.col>>s!==i.col)return}if(i.level>e.key.level){const s=i.level-e.key.level;if(i.row>>s!==e.key.row||i.col>>s!==e.key.col)return}if(i.equals(e.key)){for(const s of e.childrenTiles)this._matchSymbols(s,i,r);return}const n=new Map;for(const[s,o]of r){const a=[];for(const p of o){const g=Ufe(this.tileCoordRange,p.xTile,i.level,i.col,e.key.level,e.key.col),y=Ufe(this.tileCoordRange,p.yTile,i.level,i.row,e.key.level,e.key.row);g>=0&&g<this.tileCoordRange&&y>=0&&y<this.tileCoordRange&&a.push({symbol:p,xTransformed:g,yTransformed:y})}const l=[],c=(e.key.level<i.level?1:1<<e.key.level-i.level)+r1t,h=this._tiles.get(e.id).symbols.get(s);if(h){const p=h.flat;for(const g of a){let y,w=!1;const b=g.xTransformed,x=g.yTransformed;y=h.index!=null?h.index.getCell(b,x):p;const T=g.symbol,M=T.hash;for(const $ of y)if(M===$.hash&&Math.abs(b-$.xTile)<=c&&Math.abs(x-$.yTile)<=c){const R=$.unique;T.unique=R,R.tileSymbols.push(T),w=!0;break}w||l.push(T)}}l.length>0&&n.set(s,l)}for(const s of e.childrenTiles)this._matchSymbols(s,i,n)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,i=new Array(e.size);let r,n=0;for(const[s,o]of e){const a=new Array(o.size);r=0;for(const l of o)a[r++]=l;i[n]={styleLayerUID:s,uniqueSymbols:a},n++}return i}};function s1t(t,e){const i=t.transforms.tileUnitsToPixels,r=tQ(e),n=Math.cos(r),s=Math.sin(r),o=Math.ceil(512*(Math.abs(s)+Math.abs(n)));ZQ(Mf),jR(Mf,Mf,[o/2,o/2]),YQ(Mf,Mf,r),jR(Mf,Mf,[-256,-256]),ez(Mf,Mf,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=Mf;const a=[],l=new n1t(4096,a,()=>new Lvt),c=new Qvt(a,l,(h,p,g)=>new Xvt(h,p,g,t.styleRepository,t.key.level,e),(h,p)=>{qvt(h,p,!1)},()=>0,h=>{const p=t.styleRepository.getStyleLayerByUID(h).getLayoutProperty("visibility");return!p||p.getValue()!==B_.NONE});a.push(t),l.add(t),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(t),t.transforms.tileUnitsToPixels=i}const Mf=jk();let Gf=class extends Ne{constructor(e){super(e),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){var e,i;(e=this._fadeInResolver)==null||e.call(this),(i=this._fadeOutResolver)==null||i.call(this),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){var e;return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,(e=this._fadeOutResolver)==null||e.call(this),this._fadeOutResolver=null,this._fadeInResolver=Ho()),this._fadeInResolver.promise}fadeOut(){var e;return this._fadeOutResolver||(this.opacity=0,(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,this._fadeOutResolver=Ho()),this._fadeOutResolver.promise}transitionStep(e,i){var s,o;const r=pe("mapview-transitions-duration"),n=r?1/r:0;if(n===0)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const a=this._fadeOutResolver||!this.visible?0:this.opacity,l=this.computedOpacity;if(l===a)this.computedVisible=this.visible;else{const c=e*n;this.computedOpacity=l>a?Math.max(a,l-c):Math.min(a,l+c),this.computedVisible=this.computedOpacity>0}}this.transitioning||((s=this._fadeInResolver)==null||s.call(this),(o=this._fadeOutResolver)==null||o.call(this),this._fadeOutResolver=this._fadeInResolver=null)}};u([f()],Gf.prototype,"computedOpacity",void 0),u([f()],Gf.prototype,"computedVisible",void 0),u([f()],Gf.prototype,"opacity",void 0),u([f()],Gf.prototype,"visible",void 0),u([f()],Gf.prototype,"transitioning",null),u([f()],Gf.prototype,"_fadeOutResolver",void 0),u([f()],Gf.prototype,"_fadeInResolver",void 0),Gf=u([L("esri.views.2d.engine.transitions.FadeTransition")],Gf);let o1t=class extends ns{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){var e;return((e=this._fadeTransition)==null?void 0:e.computedOpacity)??this.opacity}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get fadeTransitionEnabled(){return this._fadeTransition!==null}set fadeTransitionEnabled(e){!this._fadeTransition&&e?(this._fadeTransition=new Gf({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!e&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){var e;return((e=this._fadeTransition)==null?void 0:e.transitioning)??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(e){this._transitionables??(this._transitionables=[]),this._transitionables.push(e),this.requestRender()}removeTransitionable(e){e.endTransition(),this._transitionables&&eU(this._transitionables,e),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),e}fadeOut(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),e}endTransitions(){if(this._transitionables){for(const e of this._transitionables)e.endTransition();this.requestRender()}}beforeRender(e){this.transitionStep(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this.transitioning&&this.requestRender()}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){var i;this.stage&&(((i=this._fadeTransition)==null?void 0:i.computedVisible)??this.visible)&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){var e;return((e=this._transitionables)==null?void 0:e.some(i=>i.transitioning))??!1}transitionStep(e,i){if(this._transitionables)for(const r of this._transitionables)r.transitionStep(e,i)}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},a1t=class extends o1t{constructor(e,i,r,n,s,o,a=s,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new zv(e),this.resolution=i,this.x=r,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;QU(r,o,0,0,0,a,0,n,s,1),KU(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},l1t=class extends a1t{_createTransforms(){return{displayViewScreenMat3:jk(),tileMat3:jk()}}},c1t=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}};const u1t=.125;let h1t=class{constructor(){this._renderParams={reshuffleManager:new c1t,context:null,drawPhase:1,state:new d1t,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new l1t(new zv(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,n,s,o,a,l,c,h){const p=this._backgroundTile;this._updateRenderParameters(e,i,p,r,s,o,a,l,c,h),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,p,n)}renderContent(e,i,r,n,s,o,a,l,c,h,p,g){this._declutter(r),n.forAll(({sourceLayerInfo:{data:b}})=>this._declutter(b));const y=n.length>0;y&&this._stencilSymbols(e,i,r,n,s,o,a,l,c,h,p,g);let w=1;r.stencilRef=y?w:0,e.setStencilFunction(gr.EQUAL,r.stencilRef,255),this._render(e,i,r,s,o,a,l,c,h,p,g),n.forAll(({sourceLod:b,offset:x,sourceLayerInfo:{data:T}})=>{T.stencilRef=++w,this._renderSymbols(e,b,T,s,o,a,l,x,h,p,g)})}_stencilSymbols(e,i,r,n,s,o,a,l,c,h,p,g){let y=1;r.stencilRef=y,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(wn.KEEP,wn.KEEP,wn.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(gr.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,s,o,a,l,c,h,p,g),n.forAll(({sourceLod:w,offset:b,sourceLayerInfo:{data:x}})=>{x.stencilRef=++y,e.setStencilFunction(gr.ALWAYS,x.stencilRef,255),this._stencilTileSymbols(e,w,x,s,o,a,l,b,h,p,g)}),e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,n,s,o,a,l,c,h,p){e.setStencilFunction(gr.EQUAL,r.stencilRef,255),this._render(e,i,r,n,s,o,a,l,c,h,p,EY.SYMBOL)}_render(e,i,r,n,s,o,a,l,c,h,p,g){this._updateRenderParameters(e,i,r,n,o,a,l,c,h,p),this._renderParams.stencilSymbols=!1,n.drawTile(this._renderParams,r,s,g)}_stencilTileSymbols(e,i,r,n,s,o,a,l,c,h,p){this._updateRenderParameters(e,i,r,n,o,a,l,c,h,p),this._renderParams.stencilSymbols=!0,r.triangleCount=0,n.drawSymbols(this._renderParams,r,s)}_updateRenderParameters(e,i,r,n,s,o,a,l,c,h){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const p=i[0]-s.getLevelShift(i[0]),g=this._renderParams;g.context=e,g.painter=n,g.glyphMosaic=n.glyphMosaic,g.spriteMosaic=n.spriteMosaic,g.pixelRatio=c*h,g.displayLevel=p,g.requiredLevel=p;const y=s.getScale(i[0]),[w,b]=s.getOffset(i,o*y),x=u1t*o*y/l,T=r.transforms.displayViewScreenMat3;T[0]=x,T[4]=-x,T[6]=-1-w-a[0]*o*2,T[7]=1+b+(1-a[1])*o*2-2;const M=g.state,$=l/h;M.size[0]=$,M.size[1]=$,M.pixelRatio=h,M.rotation=(360-this._heading)%360;const R=2/$;QU(M.displayViewMat3,R,0,0,0,-R,0,-1,1,1);const I=ZQ(M.displayMat3),P=tQ(this._heading);jR(I,I,[$/2,$/2]),YQ(I,I,P),jR(I,I,[-$/2,-$/2]),KU(I,M.displayViewMat3,I)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(s1t(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},d1t=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=In(),this.displayViewMat3=In(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}},H3e=class extends Zu{constructor(){super(...arguments),this.blendMode=Xe.Normal}};u([le({count:Xe.COUNT})],H3e.prototype,"blendMode",void 0);let pR=class extends H3e{constructor(){super(...arguments),this.output=vs.Composite,this.baseOpacityMode=Pa.NotRequired,this.premultipliedSource=zh.Off}};u([le({count:vs.COUNT})],pR.prototype,"output",void 0),u([le({count:Pa.COUNT})],pR.prototype,"baseOpacityMode",void 0),u([le({count:zh.COUNT})],pR.prototype,"premultipliedSource",void 0);let q3e=class extends pR{constructor(){super(...arguments),this.background=Ly.BelowLayer}};u([le({count:Ly.COUNT})],q3e.prototype,"background",void 0);function p1t(t){t.fragment.uniforms.add(new ht("u_colormap",e=>e.u_colormap),new rt("u_colormapOffset",e=>e.colormap.u_colormapOffset),new rt("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new rt("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(C`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function f1t(t){t.fragment.uniforms.add(new ht("u_transformGrid",e=>e.u_transformGrid),new rs("u_transformSpacing",e=>e.common.u_transformSpacing),new rs("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(C`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let m1t=class extends N3e{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function g1t(t,e){t.include(f1t),t.fragment.uniforms.add(new ht("u_image",r=>r.u_image),new Ay("u_flipY",r=>r.common.u_flipY),new Ay("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new rs("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(C`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(C`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(C`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let yV=class extends m1t{constructor(e,i,r,n,s,o){super(e,n,s),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=ws,this.fboTexture=null,this.baseOpacity=1}},W3e=class extends yV{},Z3e=class extends yV{};function Y3e(t){const e=new or;return e.include(F3e),e.include(g1t,t),e.include(p1t,t),e.include(k3e,t),e.fragment.code.add(C`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===Nb.Stretch?_1t(e,t):t.colorizerType===Nb.Lut?y1t(e):t.colorizerType===Nb.Hillshade&&v1t(e,t),e}function y1t(t){t.fragment.main.add(C`vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));`)}function _1t(t,e){t.fragment.uniforms.add(new Mm("u_bandCount",r=>r.symbolizer.u_bandCount),new Xh("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Xh("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Xh("u_factor",r=>r.symbolizer.u_factor,3),new rt("u_minOutput",r=>r.symbolizer.u_minOutput),new rt("u_maxOutput",r=>r.symbolizer.u_maxOutput),new Ay("u_useGamma",r=>r.symbolizer.u_useGamma),new Xh("u_gamma",r=>r.symbolizer.u_gamma,3),new Xh("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new rt("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(C`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?C`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:C`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.main.add(C`
    vec2 pixelLocation = getPixelLocation(uv);
    if (isOutside(pixelLocation)) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }

    vec4 currentPixel = getPixel(pixelLocation);
    ${e.stretchType===fx.Noop?C`fragColor = applyBackgroundBlend(currentPixel);`:C`
    if (currentPixel.a == 0.0) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }
    if (u_bandCount == 1) {
      float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      ${i}
    } else {
      float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
      float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
      fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
    }`}`)}function v1t(t,e){const i=t.fragment;i.uniforms.add(new ht("u_image",n=>n.u_image),new Mm("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new Xh("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new Xh("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new Xh("u_cosZs",n=>n.symbolizer.u_cosZs,6),new Xh("u_weights",n=>n.symbolizer.u_weights,6),new rs("u_factor",n=>n.symbolizer.u_factor),new rt("u_minValue",n=>n.symbolizer.u_minValue),new rt("u_maxValue",n=>n.symbolizer.u_maxValue),new rs("u_srcImageSize",n=>n.common.u_srcImageSize)),i.include(aM),i.code.add(C`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(C`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?C`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:C`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.main.add(C`
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}`)}const w1t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Z3e,ColorizerStretchUniforms:W3e,ColorizerUniforms:yV,build:Y3e},Symbol.toStringTag,{value:"Module"}));let Gme=class extends hr{constructor(e,i,r){super(e,i,new ar(w1t,()=>fe(()=>Promise.resolve().then(()=>mAt),void 0)),r)}},sA=class extends pR{constructor(){super(...arguments),this.colorizerType=Nb.Stretch,this.stretchType=fx.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([le({count:Nb.COUNT})],sA.prototype,"colorizerType",void 0),u([le({count:fx.COUNT})],sA.prototype,"stretchType",void 0),u([le()],sA.prototype,"applyColormap",void 0),u([le()],sA.prototype,"requireBilinearWithNN",void 0);let Hme=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new Fm(this._rctx,new jr(e),new lCe(ha.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};function i1(t,e=Am.Pos2,i=md,r=-1,n=1){const s=e===Am.Pos2?new Float32Array([r,r,n,r,r,n,n,n]):new Float32Array([r,r,0,0,n,r,1,0,r,n,0,1,n,n,1,1]);return new km(t,i,new Map([["geometry",x1t.get(e)]]),new Map([["geometry",bs.createVertex(t,Vn.STATIC_DRAW,s)]]))}const b1t=4;function X3e(t){const e=new jr(b1t);return e.samplingMode=Mi.NEAREST,new fr(t,e)}var Am;(function(t){t[t.Pos2=0]="Pos2",t[t.Pos2Tex=1]="Pos2Tex"})(Am||(Am={}));const x1t=new Map([[Am.Pos2,XRe],[Am.Pos2Tex,o0t]]),S1t=()=>de.getLogger("esri.views.3d.terrain");let T1t=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new h1t,this._bindParameters=new Zte(null),this._blendLayersTechniqueConfig=new q3e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=i1(this._rctx,Am.Pos2Tex)}dispose(){this._fbos.forEach(Ht),this._fbos=null,this._vtFBO=Ht(this._vtFBO),this._vaoQuad=Ht(this._vaoQuad),this._vectorTileHelper=Ht(this._vectorTileHelper)}updateHeading(e){var i;(i=this._vectorTileHelper)==null||i.updateHeading(e)}_acquireBlendLayersTechnique(e,i,r,n=zh.Off,s=Ly.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._techniques.precompile(Dfe,this._blendLayersTechniqueConfig),this._techniques.acquire(Dfe,this._blendLayersTechniqueConfig)}drawBackground(e,i){const r=this._acquireBlendLayersTechnique(Xe.Normal,i?vs.ColorComposite:vs.GridComposite,Pa.NotRequired,zh.Off,Ly.Only),n=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(n),r.release()}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(ur.TRIANGLE_STRIP,0,pC(this._vaoQuad,"geometry"))}drawGroup(e,i,r,n,s=zh.On){i===vs.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=e.baseOpacity<1?Pa.Required:Pa.NotRequired,a=this._acquireBlendLayersTechnique(n,i,o,s),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l),a.release()}drawImageData(e,i,r,n,s=zh.Off){if(e.texture==null)return;const o=e.baseOpacity<1?Pa.Required:Pa.NotRequired;e.fboTexture=i===vs.GroupBackgroundComposite||n===Xe.Normal&&o===Pa.NotRequired&&s===zh.Off?null:this.switch(r).colorTexture;const a=this._acquireBlendLayersTechnique(n,i,o,s),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l),a.release()}drawRasterData(e,i,r,n,s){const o=s.sourceLayerInfo.data;if(!o.source||(s.tile.surface.layerViewByIndex(s.layerIndex,Qt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?Pa.Required:Pa.NotRequired;e.fboTexture=n===Xe.Normal&&a===Pa.NotRequired?null:this.switch(r).colorTexture;const l=this._acquireRasterColorizerTechnique(o,i,n,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=s.scale,c.offset=s.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,this._bindParameters,c);this._render(h),l.release()}_acquireRasterColorizerTechnique(e,i,r,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new sA,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?fx.Noop:fx.PerBand,this._techniques.precompile(Gme,this._rasterColorizerConfig),this._techniques.acquire(Gme,this._rasterColorizerConfig)}drawVectorData(e,i,r,n,s,o,a,l){const c=this._rctx,h=s.sourceLayerInfo.data,p=s.tile.surface.layerViewByIndex(s.layerIndex,Qt.MAP),g=e.baseOpacity<1?Pa.Required:Pa.NotRequired,y=g===Pa.Required||e.opacity<1||n!==Xe.Normal||i!==vs.Composite,w=y?zh.On:zh.Off,b=this._acquireBlendLayersTechnique(n,i,g,w);c.setPipelineState(b.getPipeline());let x=null,T=null;y?(T=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new Hme(this._rctx)),x=this._vtFBO.get(r),c.bindFramebuffer(x),this._clearCurrentFBO()):l&&c.clear(Xi.DEPTH);try{this._vectorTileHelper.renderBackground(c,s.sourceLod,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/s.scale),s.offset,a,o,p.contentZoom),h&&this._vectorTileHelper.renderContent(c,s.sourceLod,h,s.vtlNeighborInfos,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/s.scale),s.offset,a,o,p.contentZoom)}catch(M){S1t().warnOnce("A render call containing vector tiles did not resolve correctly.",M)}return b.release(),!x||(c.bindFramebuffer(T),e.texture=x.colorTexture,e.offset=Jb,e.scale=1,this.drawImageData(e,i,r,n,w),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,fr.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;i.gl.copyTexImage2D(vn.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),i.bindTexture(r,fr.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Xi.COLOR|Xi.DEPTH|Xi.STENCIL)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let n=this._fbos.length;n<=i;n++)this._fbos.push(new Hme(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},E1t=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new mi({allocator:e=>e||new C1t})}},C1t=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},qme=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}},M1t=class{constructor(e,i,r,n,s,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=n,this.output=s,this.baseOpacity=o}},$1t=class{constructor(e,i,r,n){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=n,this._passParameters=new Tvt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new T1t(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=Ht(this._compositor),this._backgroundTexture=Lr(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){var i;(i=this._compositor)==null||i.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,n=r.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1,c=!1;const h=r.view.state.contentPixelRatio;let p=!1;qk.clear(),YS.length=0;const g=e.layerInfo[Qt.MAP];let y=0,w=null;for(;y<g.length;y++){const T=r.layerViewByIndex(y,Qt.MAP),M=T.layer,$=!Db(e,T),R=M.opacity,I=T.fullOpacity;if(c=c||wN(M),g3(T)){let V=T.layer.blendMode!=="normal";if(NE(M.parent)){const U=M.parent.uid;U!=null&&U!==""&&(V=J3e(M.parent)||V)}V&&(p=V,l=!1)}if(($||R===0)&&!p){g[y].pendingUpdates&=~(yt.TEXTURE_NOFADING&yt.TEXTURE_FADING);continue}++o;const P=SC(T),N=x8(e,y,P);if(N){if(g[y].pendingUpdates&=~(yt.TEXTURE_NOFADING&yt.TEXTURE_FADING),NE(M.parent)){const V=M.parent.uid;V!=null&&V!==""&&Q3e(M.parent,y)}P?a=Math.max(a,this.tileSize*h):n===1&&I===1&&(T.isOpaque||this._dataToTexture(N)&&N.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s,w===null&&(w=y)}}const b=a/this.tileSize,x=this._ensureBackgroundTexture(this.tileSize);s!==0&&w!==null?s===1&&!p&&this._useLayerTexture(e,w)||this._composeLayers(e,i,y-1,c,a,b,!l||p,qk,p):A1t(e,o,x,i!==Un.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=Jb,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,Qt.MAP),n=wN(r.layer),s=n?e.surface.baseOpacity:1,o=n?1:e.surface.baseOpacity,a=r.fullOpacity,l=x8(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new Bk(l.sourceLayerInfo.data,Un.FADING,Ri(l.offset[0],l.offset[1],l.scale,l.scale),s,o,a)),!0)}_composeLayers(e,i,r,n,s,o,a,l,c){this._compositor.ensureBuffer(s);const h=e.surface.baseOpacity;let p=!1,g=Mi.LINEAR_MIPMAP_LINEAR,y=!1,w=0;for(let M=r;M>=0;M--){const $=e.surface.layerViewByIndex(M,Qt.MAP),R=$.layer,I=SC($),P=x8(e,M,I),N=R.opacity,V=!Db(e,$);if(!P||(N===0||V)&&!c)continue;const U=!wN(R)&&!p;U&&(p=!0);let B=!1;l.forEach(Z=>{Z.start===M&&(Z.output=n?vs.Composite:a&&U?this.backgroundIsGrid?vs.GridComposite:vs.ColorComposite:vs.Composite,Z.baseOpacity=U?h:1,YS.push(Z),this._compositor.openGroup(s),B=!0)});const W=w===0,j=B?vs.GroupBackgroundComposite:a&&W?this.backgroundIsGrid?vs.GridComposite:vs.ColorComposite:vs.Composite,Q=_Y[g3($)?$.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=U&&!B&&h<1?h:1,this._passParameters.opacity=N,byt(P)?y=this._compositor.drawVectorData(this._passParameters,j,s,Q,P,o,this.tileSize,y):wyt(P)?(this._compositor.drawRasterData(this._passParameters,j,s,Q,P),O1t(P)&&(g=Mi.NEAREST)):this._dataToTexture(P)&&(this._passParameters.texture=P.sourceLayerInfo.data.texture,this._passParameters.offset=P.offset,this._passParameters.scale=P.scale,this._compositor.drawImageData(this._passParameters,j,s,Q));YS.length>0&&YS[YS.length-1].end===M;){const Z=YS.pop();this._passParameters.baseOpacity=Z.baseOpacity,this._passParameters.opacity=Z.opacity,this._passParameters.offset=Jb,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,Z.output,s,_Y[Z.blendMode])}w++}const b=e.renderData,x=c||p&&h<1,T=b.ensureTexture(s,x,i,()=>this._buildTexture(s,x,g));this._compositor.copyFBOToTexture(T),this._compositor.unbind(),b.setTextureReference(new Bk(T,i,K3e,p?1:h,0,1))}_dataToTexture(e){if(Syt(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return xyt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=Mi.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const n=new jr;n.wrapMode=Tr.CLAMP_TO_EDGE,n.samplingMode=r,n.maxAnisotropy=this._maxAnisotropy,n.preMultiplyAlpha=!0,n.flipped=!0,n.hasMipmap=!0,i||(n.pixelFormat=kt.RGB);const s=this._rctx;let o;if(typeof e=="number")n.width=n.height=e,o=this._buildTileTexture(n,e);else if(hV(e))n.isOpaque=e.isOpaque,n.isOpaque&&(n.pixelFormat=kt.RGB),o=this._buildTileTexture(n,e.element.width,e.element);else try{n.width=e.width,n.height=e.height,o=this._buildTileTexture(n,e.width,e)}catch{o=new qme(X3e(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=s.bindTexture(o.texture,fr.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),s.bindTexture(a,fr.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(e,i,r){const n=`${i} ${e.pixelFormat}`,s=this._cache.pop(n);return s?(s.retain(),s.texture.setData(r),s):new qme(new fr(this._rctx,e,r),this._cache)}get test(){}};function x8(t,e,i){var o;$a.layerIndex=e,$a.vtlNeighborInfos.clear();const r=t.layerInfo[Qt.MAP][e];if(ln($a.offset,0,0),$a.tile=t,$a.scale=1,$a.sourceLod=t.lij,$a.sourceLayerInfo=r,$a.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((a,l)=>{if(a.level!==t.level)return;const c=a.layerInfo[Qt.MAP][e];if(!kRe(c)||r.data===c.data)return;const h=$a.vtlNeighborInfos.pushNew();h.offset=$g[l],h.sourceLod=a.lij,h.sourceLayerInfo=c}),$a;const n=r.upsampleInfo,s=(o=n==null?void 0:n.tile)==null?void 0:o.layerInfo[Qt.MAP][e];return s?($a.tile=n.tile,Ha($a.offset,n.offset),$a.scale=n.scale,$a.sourceLod=n.tile.lij,$a.sourceLayerInfo=s,$a):i?$a:null}function O1t(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function J3e(t){let e=t.blendMode!=="normal";return NE(t.parent)&&(e=J3e(t.parent)||e),e}function Q3e(t,e){NE(t.parent)&&Q3e(t.parent,e);const i=t.uid;if(i!=null&&i!==""){const r=qk.get(i);r?r.start=e:qk.set(i,new M1t(e,e,t.blendMode,t.opacity,vs.Composite,1))}}function A1t(t,e,i,r){const n=t.renderData,s=!r&&n.textureReference!=null&&(t.surface.view.layerViewManager.updating||e>0)?_v.Delayed:_v.Immediate;n.setTextureReference(new Bk(i,Un.FADING,K3e,t.surface.baseOpacity,0,1),s)}const qk=new Map,YS=new Array,$a=new E1t,K3e=Ri(0,0,1,1),$g=new Array;$g[Tt.NORTH]=[0,-1],$g[Tt.NORTH_EAST]=[-1,-1],$g[Tt.EAST]=[-1,0],$g[Tt.SOUTH_EAST]=[-1,1],$g[Tt.SOUTH]=[0,1],$g[Tt.SOUTH_WEST]=[1,1],$g[Tt.WEST]=[1,0],$g[Tt.NORTH_WEST]=[1,-1];const R1t=200,S8=40,I1t=.8,P1t=10,oA=1e-6;function L1t(t,e,i){const r=e,n=i;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(n[a]<=oA)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-oA){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(r[a]>l){if(n[a]>=-oA)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]>=oA){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let Wme=class{constructor(e,i,r,n,s){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=n,this.rightStartIndex=s}},eIe=class OY{constructor(e,i,r,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=n,this._rayDirection=A(),this._callback=Yme,this._intersectionOptions=Zme,this.bspNodeTree=new Array;const s=r-i,o=new(s<U1t?Uint8Array:s<z1t?Uint16Array:Uint32Array)(s);this.triangleIndexMap=o;for(let a=0;a<s;++a)o[a]=a;{const a=k1t(e,i,r,n.data,n.stride),l=Oe(Math.log2(s/S8),2,P1t),c=(h,p,g)=>{const y=N1t(o,a,h,p),w=p-h;if(w<=S8){const R=new Wme(y,void 0,0,h,p);return this.bspNodeTree.push(R),R}const{axis:b,midValue:x}=F1t(y),T=D1t(o,a,h,p,b,x),M=(R,I)=>{if(g>l)return;const P=I-R;return P<S8||P>=I1t*w?void 0:c(R,I,g+1)},$=new Wme(y,b,x,T.next,T.mid);return this.bspNodeTree.push($),$.leftNode=M(h,T.next),$.rightNode=M(T.mid,p),$};c(0,s,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;LOe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),OY.numFacesTested+=i-e}intersectRay(e,i,r,n){OY.numFacesTested=0;const s=e,o=i,a=o[0]-s[0],l=o[1]-s[1],c=o[2]-s[2];if(a*a+l*l+c*c<oA)return;this._rayFrom=s;const h=this._rayDirection;h[0]=a,h[1]=l,h[2]=c;const p=this.triangleIndexMap.length;this._callback=n,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,p),this._callback=Yme,this._intersectionOptions=Zme}intersectRayBSP(e,i,r){const n=this._rayFrom,s=this._rayDirection;if(!L1t(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=i,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};eIe.numFacesTested=0;const XS=[1/0,1/0,1/0],JS=[-1/0,-1/0,-1/0];function D1t(t,e,i,r,n,s){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function N1t(t,e,i,r){if(r<=i)return cC(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[i];for(let s=0;s<3;++s)XS[s]=e[n+0+s],JS[s]=e[n+3+s]}for(let n=i+1;n<r;++n){const s=6*t[n];for(let o=0;o<3;++o)XS[o]=Math.min(XS[o],e[s+0+o]),JS[o]=Math.max(JS[o],e[s+3+o])}return cC(XS[0],XS[1],XS[2],JS[0],JS[1],JS[2])}function F1t(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],n=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function k1t(t,e,i,r,n){const s=i-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l]*n,h=t[l+1]*n,p=t[l+2]*n;for(let g=0;g<3;++g){const y=r[c+g],w=r[h+g],b=r[p+g];o[6*a+g]=Math.min(y,w,b),o[6*a+3+g]=Math.max(y,w,b)}}return o}const U1t=255,z1t=65535,Zme=new Qz,Yme=()=>{};let Ra=class extends Ry{constructor(e){super(),this.spherical=e,this.overlayMode=cm.Disabled,this.tileBlendInput=hm.LayerOnly,this.transparencyMode=pa.Opaque,this.pbrMode=Ut.Simplified,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.normalType=an.Compressed,this.textureCoordinateType=ts.Compressed,this.highStepCount=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!0,this.canHaveOverlay=!0}};u([le({count:cm.COUNT})],Ra.prototype,"overlayMode",void 0),u([le({count:hm.COUNT})],Ra.prototype,"tileBlendInput",void 0),u([le({count:pa.COUNT})],Ra.prototype,"transparencyMode",void 0),u([le({count:Ut.COUNT})],Ra.prototype,"pbrMode",void 0),u([le()],Ra.prototype,"doublePrecisionRequiresObfuscation",void 0),u([le()],Ra.prototype,"receiveShadows",void 0),u([le()],Ra.prototype,"hasSlicePlane",void 0),u([le()],Ra.prototype,"backfaceCullingEnabled",void 0),u([le()],Ra.prototype,"textureFadingEnabled",void 0),u([le()],Ra.prototype,"renderOccluded",void 0),u([le()],Ra.prototype,"screenSpaceReflections",void 0),u([le()],Ra.prototype,"cloudReflections",void 0),u([le()],Ra.prototype,"tileBorders",void 0),u([le()],Ra.prototype,"visualizeNormals",void 0),u([le()],Ra.prototype,"screenSizePerspective",void 0),u([le()],Ra.prototype,"receiveAmbientOcclusion",void 0);const T8=7,V1t=10,E8=bd();let Eh=class extends nM{get _isGlobal(){return this._stage.viewingMode===ct.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(t,e,i,r,n){super({}),this._overlayRenderer=t,this._stage=e,this._allTiles=i,this._ellipsoidRadius=r,this.type=on.TERRAIN,this.isGround=!0,this._tileSize=256,this._passParameters=new Kte,this._drawParameters=new Rte,this._renderDataPool=new xl(O_t),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new m3e,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Dr.Occlude,this.produces=new Map([[Ie.OPAQUE_TERRAIN,()=>this._produces()&&this.transparency===pa.Opaque],[Ie.TRANSPARENT_TERRAIN,()=>this._produces()&&(this.transparency===pa.Transparent||this.transparency===pa.InvisibleWithDraped)],[Ie.OCCLUDED_TERRAIN,()=>this._produces()]]),this._configuration=new Ra(e.viewingMode===ct.Global),this._tileTextureCache=new bI((s,o)=>n.newCache(s,o),"TileTexture"),this.tileGeometryCache=new vvt(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(oe(()=>this._overlayRenderer.rendersOccludedDraped,t=>{this.renderOccludedFlags=t?dR:Dr.Occlude,this.setNeedsRender()},xi))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?Eet:PCe}set renderingDisabled(t){this._set("renderingDisabled",!!t),this.setDirty()}set visible(t){this._set("visible",!!t),this.setDirty()}updateHeading(t){var e;(e=this._tileRenderer)==null||e.updateHeading(t)}set transparency(t){this._configuration.transparencyMode!==t&&(this._configuration.transparencyMode=t,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(t){this._configuration.tileBorders!==t&&(this._configuration.tileBorders=t,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(t){this._configuration.visualizeNormals!==t&&(this._configuration.visualizeNormals=t,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(t){this._configuration.backfaceCullingEnabled!==t&&(this._configuration.backfaceCullingEnabled=t,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(t){this._set("renderOrder",t),this._setSortingDirty()}get layerUid(){return Pv}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(t){this._configuration.hasSlicePlane!==t&&(this._configuration.hasSlicePlane=t,this.setNeedsRender())}set textureFadingEnabled(t){this._configuration.textureFadingEnabled!==t&&(this._configuration.textureFadingEnabled=t,this.setNeedsRender())}set pbrMode(t){this._configuration.pbrMode!==t&&(this._configuration.pbrMode=t,this.setNeedsRender())}setDebugScreenSizePerspective(t){this._configuration.screenSizePerspective!==t&&(this._configuration.screenSizePerspective=t,this.setNeedsRender())}setRootTiles(t){this._rootTiles=t,this.setDirty()}setStencilEnabledLayerExtents(t){this._stencilEnabledLayerExtents=t,this._setSortingDirty()}setTileSize(t){this._tileSize=t,this._tileRenderer!=null&&(this._tileRenderer.tileSize=t),this.setDirty()}_ensureRenderData(t){t.renderData||(t.renderData=this._renderDataPool.acquire(),t.renderData.init(t,this._getLocalOriginOfTile(t)))}loadTile(t){this._ensureRenderData(t),this.updateTileGeometryState(t),this.reuseTextureFromParent(t)||this.updateTileTexture(t,yt.TEXTURE_FADING)}reuseTextureFromParent(t){var r;const e=t.parent;if(!e)return!1;const i=Ri(1&t.lij[2]?.5:0,1&t.lij[1]?0:.5,.5,.5);return((r=e.renderData)==null?void 0:r.reuseTexture(t.renderData,i))??!1}updateTileTexture(t,e){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(t,e===yt.TEXTURE_FADING?Un.FADING:Un.UNFADED),this.setNeedsRender(),t.resetPendingUpdate(e))}updateTileGeometryState(t){for(const i of t.layerInfo[Qt.ELEVATION])i.pendingUpdates&=~yt.GEOMETRY;t.resetPendingUpdate(yt.GEOMETRY);const e=t.renderData.updateGeometryState();return e&&this.setDirty(),e}updateGeometryIfNeeded(t){t.loaded&&t.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(t){const e=t.renderData;e&&(e.releaseGeometry(),this._renderDataPool.release(e),e.clear(),t.renderData=null,t.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(t){const e=V1t-T8,i=Math.max(0,Math.floor((t.level-e)/T8)*T8);if(this._isGlobal&&i===0)return ws;for(;t.parent&&t.level>i;)t=t.parent;return t.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(t){this._get("wireframe")!==t&&(this._set("wireframe",t),this.setNeedsRender())}setDirty(t=Gt.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(t)}_setSortingDirty(t=Gt.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(t)}setNeedsRender(t=Gt.UPDATE){this._context.requestRender(t)}initializeRenderContext(t){this._context=t,this._tileRenderer=new $1t(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=X3e(this._rctx)}uninitializeRenderContext(){this._emptyTex=Ht(this._emptyTex),this._tileRenderer=Ht(this._tileRenderer)}intersect(t,e,i,r){if(!this._rootTiles||t.options.selectOpaqueTerrainOnly&&t.options.selectionMode&&this.transparency!==pa.Opaque)return;const n=B1t,s=j1t;Ae(n,r,i),ve(s,1/n[0],1/n[1],1/n[2]);const o=t.results.min,a=t.results.max,l=t.results.ground,c=t.options.store===Go.MIN,h=!!t.results.ground.target,p=CWe(t.verticalOffset),g=t.tolerance;let y,w=c&&o.dist!=null?o.dist:1/0;const b=t.options,x=b.normalRequired||!b.backfacesTerrain,T=new Qz(!1,x),M=R=>{const I=R.renderData;if(!(I!=null&&I.vao))return;const P=I.geometry;wz(E8,P.boundingBox);const N=I.localOrigin;p!=null&&(p.localOrigin=N,p.applyToAabb(E8));const V=E8;if(QS[0]=i[0]-N[0],QS[1]=i[1]-N[1],QS[2]=i[2]-N[2],!cte(V,QS,s,g,w))return;const U=(z,he,ce)=>{z.set(this.type,R,he,ce,Js),w=c&&o.dist!=null?o.dist:1/0},B=(z,he,ce)=>{if((!x||ce!=null)&&z>=0&&(b.backfacesTerrain||Te(ce,n)<0)&&(b.invisibleTerrain||!b.selectionMode||e==null||e(i,r,z))){if((l.dist==null||z<l.dist)&&U(l,z,ce),b.isFiltered)return;b.store===Go.ALL&&(y==null?(y=pK(t.ray),U(y,z,ce),t.results.all.push(y)):z<y.dist&&U(y,z,ce)),(o.dist==null||z<o.dist)&&U(o,z,ce),b.store!==Go.MIN&&(a.dist==null||z>a.dist)&&U(a,z,ce)}},W=G1t;Ae(W,r,N);const{indices:j,indexCount:Q}=P,Z=P.vertexAttributes,X=Z.getField(k.POSITION,Fv),ge=new hz(X.typedBuffer,3,Z.stride/4),ae=Q/3;if(!p&&ae>R1t){const z=R.renderData;z.intersectionData==null&&(z.intersectionData=new eIe(j,0,ae,ge)),z.intersectionData.intersectRay(QS,W,T,B)}else Pct(QS,W,0,ae,j,ge,p,T,B)},$=this._rootTiles;$!=null&&(()=>{const R=this._tileIterator;R.reset($);const I=t.options.invisibleTerrain;for(let P=R.next();P;P=R.next())!(P.visible||I&&P.intersectsClippingArea)||p==null&&!P.intersectsRay(i,n,g,w)||h&&this._useStencilForTile(P)?R.skipSubtree():M(P)})()}processScaleRangeQueries(t,e){var i;if(!e.done)for(this._updatePatchGroups();t.updating&&!e.done;){t.prepare();for(const r of this._visiblePatchesByOrigin.values())for(const n of r)((i=n.renderData)==null?void 0:i.textureReference)!=null&&t.queriesForTile(n);t.process(),e.madeProgress()}}acquireTechniques(t){const e=!!pe("enable-feature:terrain-shadows")&&t.bind.shadowMap.enabled;e!==this._castShadows&&(this._castShadows=e,this._patchesByOriginDirty=!0);const i=t.bind.viewshedEnabled;if(this._inViewshed!==i&&(this._inViewshed=i,this._patchesByOriginDirty=!0),t.bind.slot===Ie.OCCLUDED_TERRAIN){if(!(t.renderOccludedMask&dR))return null}else{const r=this.transparency===pa.Opaque?Ie.OPAQUE_TERRAIN:Ie.TRANSPARENT_TERRAIN;if(t.bind.slot!==r)return null}if(this.transparency===pa.Invisible)return null;switch(this._configuration.screenSpaceReflections=this._configuration.cloudReflections=this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1,this._configuration.overlayMode=this._overlayRenderer.mode,t.output){case J.Color:case J.ColorEmission:return this._configuration.screenSpaceReflections=t.bind.ssr.lastFrameColor!=null,this._configuration.cloudReflections=t.bind.clouds.data!=null,this._configuration.receiveShadows=t.bind.shadowMap.ready,this._configuration.receiveAmbientOcclusion=t.bind.ssao!=null,this._acquireTechnique(t.output,t.bind.slot===Ie.OCCLUDED_TERRAIN);case J.Shadow:case J.ShadowExcludeHighlight:return this._castShadows?this._acquireTechnique(J.Shadow,!1):null;case J.ViewshedShadow:return this._inViewshed?this._acquireTechnique(J.ViewshedShadow,!1):null;case J.Depth:case J.Normal:return this._acquireTechnique(t.output,!1);case J.ObjectAndLayerIdColor:return this._acquireTechnique(J.ObjectAndLayerIdColor,!1);case J.Highlight:return this._overlayRenderer.hasHighlights?this._acquireTechnique(J.Highlight,!1):null}return null}render(t,e){switch(this._updatePatchGroups(),e.useStencil=!1,t.output){case J.Color:case J.ColorEmission:{const i=t.bind.slot===Ie.OCCLUDED_TERRAIN?dr.Occluded:dr.Color;this._renderMaterialPass(t,e,i);break}case J.Depth:case J.Normal:this._renderAuxiliaryPass(t,e,dr.Color,this._visiblePatchesByOrigin);break;case J.Highlight:this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(dr.Highlight)&&this._renderAuxiliaryPass(t,e,dr.Highlight,this._visiblePatchesByOrigin);break;case J.Shadow:case J.ShadowExcludeHighlight:case J.ViewshedShadow:this._renderAuxiliaryPass(t,e,null,this._allPatchesByOrigin);break;case J.ObjectAndLayerIdColor:this._renderAuxiliaryPass(t,e,dr.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(t){if(this._tileRenderer==null)return;const e=this._tileRenderer;let i;if(t!=null){const r=mt.toUnitRGBA(t);i=Qe(r[0]||0,r[1]||0,r[2]||0)}e.setBackground(i),this._allTiles.forAll(r=>e.updateTileTexture(r,Un.FADING)),this._configuration.tileBlendInput=e.backgroundIsGrid?hm.GridComposite:e.backgroundColor!=null?hm.ColorComposite:hm.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==TC.NONE){const t=Array.from(this._visiblePatchesByOrigin.values()),e=this._stencilEnabledLayerExtents;for(const i of t)p_t(this.renderOrder,i,e);t.sort((i,r)=>g3e(i[0],r[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(t.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var e;const t=this._rootTiles;if(t!=null){(e=t[0])==null||e.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of t)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(t){const e=this._tileIterator;for(e.resetOne(t);!e.done;){const i=e.next(),r=i.renderData;if(!r){this._numTilesCulled++;continue}const n=r.localOrigin;if(this._castShadows||this._inViewshed){let o=this._allPatchesByOrigin.get(n);o||(o=[],this._allPatchesByOrigin.set(n,o)),o.push(i)}if(!i.visible){this._numTilesCulled++,e.skipSubtree();continue}let s=this._visiblePatchesByOrigin.get(n);s||(s=[],this._visiblePatchesByOrigin.set(n,s)),s.push(i),e.skipSubtree()}}_useStencilForTile(t){for(const e of this._stencilEnabledLayerExtents)if(t.intersectsExtent(e))return!0;return!1}_renderAuxiliaryPass(t,e,i,r){const n=t.rctx;this._passParameters.overlayContent=i,n.bindTechnique(e,t.bind,this._passParameters);const s=this._stencilEnabledLayerExtents.length>0;r.forEach(o=>{this._drawParameters.origin=o[0].renderData.localOrigin,e.program.bindDraw(t.bind,this._passParameters,this._drawParameters);for(let a=0;a<o.length;a++)this._renderPatch(t,e,o[a],ur.TRIANGLES,s,i)}),t.rctx.bindVAO(null)}_renderMaterialPass(t,e,i){var p;const{rctx:r}=t;this._passParameters.overlayContent=i,r.bindTechnique(e,t.bind,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=t.bind.camera,s=e.program;if(this._configuration.screenSizePerspective&&this.pointsOfInterest){const g=v$e(this._stage.viewingMode,this._ellipsoidRadius),y=this.pointsOfInterest.centerOnSurfaceFrequent.distance;g.update({distance:y,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===dr.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",ws),s.setUniform4fv("texOffsetAndScale",hs));const l=((p=this._tileRenderer)==null?void 0:p.backgroundColor)!=null?this._tileRenderer.backgroundColor:ws;this._configuration.tileBlendInput===hm.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?ur.LINES:ur.TRIANGLES;this._configuration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const h=this._visiblePatchesByOrigin;for(const g of h.values()){const y=g[0].renderData.localOrigin;this._drawParameters.origin=y,e.program.bindDraw(t.bind,this._passParameters,this._drawParameters),this._numOriginsRendered++;for(const w of g){const b=w.renderData,x=b.textureReference;if(x!=null){if(!a){s.setUniform4fv("texOffsetAndScale",x.offsetAndScale),s.bindTexture("tex",x.texture.texture);const T=b.textureFadeFactor,M=T<1?b.nextTextureReference:null;this._configuration.textureFadingEnabled&&M!=null&&T<1?(s.setUniform1f("fadeFactor",T),s.setUniform4fv("nextTexOffsetAndScale",M.offsetAndScale),s.setUniform3fv("nextTexOpacities",M.opacities),s.bindTexture("texNext",M.texture.texture)):s.setUniform1f("fadeFactor",1),b.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",x.opacities)}this._renderPatch(t,e,w,c,o,i),w.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}t.rctx.bindVAO(null)}_renderPatch(t,e,i,r,n,s){const o=i.renderData,a=o.vao,l=a==null?void 0:a.indexBuffer;if(!a||l==null)return void(Xs&&console.error("Rendered tile with no indices: ",i.lij," : ",o));const c=e.program;s==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),n&&(e.useStencil=this._useStencilForTile(i),t.rctx.setPipelineState(e.getPipeline()));const h=o.geometry.indexCount;t.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),t.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(t,e){t.setUniform4fv("overlayTexOffset",e.offsets),t.setUniform4fv("overlayTexScale",e.scales)}_acquireTechnique(t,e){return this._configuration.output=t,this._configuration.renderOccluded=e,this._techniques.acquire($_t,this._configuration)}get test(){}};u([f({readOnly:!0})],Eh.prototype,"_isGlobal",null),u([f()],Eh.prototype,"renderOccludedFlags",void 0),u([f({value:!1})],Eh.prototype,"renderingDisabled",null),u([f({value:!0})],Eh.prototype,"visible",null),u([f()],Eh.prototype,"renderPatchBorders",null),u([f()],Eh.prototype,"visualizeNormals",null),u([f()],Eh.prototype,"cullBackFaces",null),u([f({value:TC.FRONT_TO_BACK})],Eh.prototype,"renderOrder",null),u([f()],Eh.prototype,"wireframe",null),Eh=u([L("esri.views.3d.terrain.TerrainRenderer")],Eh);const B1t=A(),j1t=A(),QS=A(),G1t=A();let H1t=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Hf=class extends Ne{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),oe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!kA(i)||i.isRejected())&&!(i.isFulfilled()&&!q1t(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||Nk(i)))),e)if(e.isResolved()){const i=pV(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new Lc(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===ct.Global){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=Lc.makeWebMercatorAuxiliarySphere(i):zte(r)&&(e=Lc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(oe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===ct.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=Lc.WebMercatorAuxiliarySphere:DRe(e)&&(this.tilingScheme=Lc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||wb(e,this.extent)||(this.tilingScheme=Lc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function q1t(t,e,i){return pV(t,e,i)!=null}u([f()],Hf.prototype,"tilingScheme",void 0),u([f({readOnly:!0})],Hf.prototype,"extent",void 0),u([f({value:!1})],Hf.prototype,"tilingSchemeLocked",void 0),u([f({constructOnly:!0})],Hf.prototype,"viewSpatialReference",void 0),u([f({constructOnly:!0})],Hf.prototype,"layers",void 0),u([f({constructOnly:!0})],Hf.prototype,"extentHelper",void 0),u([f({constructOnly:!0})],Hf.prototype,"viewingMode",void 0),Hf=u([L("esri.views.3d.terrain.TilingSchemeLogic")],Hf);let W1t=class{constructor(){this._offset=Yt(),this.scale=0}get offset(){return this._offset}init(e,i,r,n){this.tile=e,this._offset[0]=i,this._offset[1]=r,this.scale=n}dispose(){this.tile=null,this._offset[0]=0,this._offset[1]=0,this.scale=0}};var t4;let si=t4=class extends ns.EventedMixin(Ne){constructor(t){var e,i,r;super(t),this._scaleRangeQueries=new KF,this._iteratorPool=new xl(m3e,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new u_t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new H1t,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=A(),this._eyePosSurfaceSR=A(),this._splitLimits=new ap,this._frustum=HR(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new hv,this._frameTask=QE,this._allTiles=new mi,this._upsampleInfoPool=new xl(W1t),this._shouldEmitChangeEvent=!1,this._destroying=!1,this._rootTilesExtent=Zi(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=nt.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new B2(1/0,-1/0),this.rootTileElevationBounds=new B2(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=$Q(),this._tilingSchemeSpatialReference=null,this._radiusModifier=Math.cos(Math.PI/16/16),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new Dl({...t,surface:this}),this._isGlobal=!((i=(e=t.view)==null?void 0:e.state)!=null&&i.isLocal),this._isGeographic=((r=this._spatialReference)==null?void 0:r.isGeographic)??!1,this._tileConstructor=this._isGlobal?gvt:pvt,this._ellipsoid=xr(t.view.spatialReference)}initialize(){const t=this.view,e=t.resourceController,i=e.memoryController;this._tileCache=new bI((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new tyt(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new Eh(r.renderer,t._stage,this._allTiles,this._ellipsoid.radius,i),this.addHandles([oe(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),oe(()=>this.renderer.visible,l=>this.suspended=!l),oe(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(Un.FADING)}),oe(()=>{var l,c;return{heading:(l=t.camera)==null?void 0:l.heading,state:(c=t.state)==null?void 0:c.mode}},({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);const h=Math.round(l)%360,p=Math.abs(h-this.heading);(c===Di.IDLE||Math.min(p,360-p)>=30)&&(this.heading=h)})],"overlayManager"),this.addHandles([oe(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Un.UNFADED:Un.IMMEDIATE)},hi),oe(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Un.UNFADED:Un.IMMEDIATE),hi),oe(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},xi),oe(()=>this.snapLevel,()=>this._viewChanged=!0,xi),oe(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),oe(()=>Cn.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?fe(()=>import("./TerrainTileTree3DDebugger-BHlGMl3I.js"),__vite__mapDeps([256,257])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&Cn.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Ye(this._treeDebugger))},Si)]);const{spatialReference:n}=t;this._extentHelper=Ayt(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:n});const s=new NR({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:h})=>h)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new Hf({layers:s,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(nm.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(nm.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(xt.TERRAIN_SURFACE,this),this.addHandles([oe(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),Si),oe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),xi),oe(()=>this.extent,()=>this._updateRootTiles(),Si),t.on("resize",()=>this._viewChangeUpdate()),oe(()=>{const l=t.state;return[this._lodBias,this.lodSnappingEnabled,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),hi),oe(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.fadeDuration},l=>this._renderer.textureFadingEnabled=l>0,Si),oe(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?Ut.Simplified:Ut.Disabled,Si),oe(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.tiledSurface.elevationLevelDelta},()=>this._updateAllTileGeometries()),oe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),xi)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._destroying=!0,this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",Ye(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Ye(this.overlayManager)),this._tileCache=Ye(this._tileCache),iie.prune(),this._treeDebugger=Ye(this._treeDebugger),this._renderer=Ye(this._renderer),this._iteratorPool=Ye(this._iteratorPool),this._upsampleMapCache=Ye(this._upsampleMapCache),this._elevationQueryCache=Ye(this._elevationQueryCache),this._set("view",null),this._extentHelper=Ye(this._extentHelper),this._upsampleInfoPool=Ye(this._upsampleInfoPool),z_t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnappingEnabled){const{view:t,tilingScheme:e}=this,i=t.scale;if(e&&i){const r=e.levelAtScale(i)+t.qualitySettings.tiledSurface.lodBias,n=e.getMaxLod();return r<=0?null:Math.min(r,n||1/0)}}return null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return this._extentHelper.stencilEnabledExtents.length>0}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=Zi(),r=uRe(e,i,t)?i:null,n=this._get("extent");return wb(r,n)?n:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=w9(this.groundExtent,this._userClippingExtent,Zi()),e=this._get("extent");return wb(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,i;return((i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,i;return(i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===pa.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevationLevelDelta(t){return t<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(t,e,i,r){const n=this._rootTiles;if(!(n!=null&&n.length)||n[0].layerInfo[Qt.ELEVATION].length===0)return null;let s=this._elevationProjectorCache.get(r);if(s===void 0&&(s=Mv(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,s)),s==null)return de.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=ve(H$,t,e,i);return s(o,0,o,0),Xme(n,o[0],o[1])}getElevations(t,e,i){const r=this._rootTiles,n=r?r[0].layerInfo[Qt.ELEVATION].length:0;if(r!=null&&r.length&&n!==0)for(let s=0;s<e;++s){const o=3*s;i(s,Xme(r,t[o],t[o+1]))}else for(let s=0;s<e;++s)i(s,null)}getScale(t){if(!this.tilingScheme)return null;if(!ec(t,H$,this.spatialReference))return de.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i!=null&&i.containsPoint(H$)){let r=i;for(;r.children[0]&&!r.rendered;){const n=r.children[0].extent;let s=0;H$[0]>n[2]&&(s+=1),H$[1]<n[1]&&(s+=2),r=r.children[s]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const i=Mv(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,i),i}getSphereElevationBounds(t,e){const i=this._ensureSEBProject(e);if(i==null)return de.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;Kb(t,KS);const r=KS;i(r,0,r,0);const n=new Pk,s=this._rootTiles;if(s!=null){const o=[];for(const l of s)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!Zoe(l.extent,KS))continue;const c=l.children;if(c[0]==null||l.rendered)n.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const h of c)o.push(h)}}return n}getRootElevationBounds(){return new Pk(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getLowerBoundRadius(){const t=(this._ellipsoid.radius+this.visibleElevationBounds.min)*this._radiusModifier;return Math.min(t,this._ellipsoid.radius)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!ec(t,KS,this.spatialReference))return de.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;KS[3]=e;let i=null;const r=s=>{if(s&&Zoe(s.extent,KS)){const o=s.children;if(o[0]&&!s.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(s.level);i=i==null?a:Math.min(i,a)}}},n=this._rootTiles;if(n!=null)for(const s of n)r(s);return i}queryVisibleScaleRange(t,e,i,r){const n=e?this.tilingScheme.levelAtScale(e):0,s=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,n+o,s+o,r)}_evaluateTransparency(){const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?pa.Invisible:pa.InvisibleWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?pa.Opaque:pa.Transparent;return this._renderer.transparency=r,i!==r}_updateTilingScheme(){var i,r,n,s;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;qs(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(i=this.view)==null?void 0:i.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??nt.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&$R((n=this.view)==null?void 0:n.renderSpatialReference),this._isGeographic=(e==null?void 0:e.isGeographic)??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=(s=this.tilingScheme)==null?void 0:s.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const n=this._tileCache.pop(t4._tileMemcacheKey);return n?(n.init(t,e,i,r,this),n):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=Y1t;let r=e.rootTilesInExtent(t,i,5*T2);if(this._rootTiles!=null){if(r.length>T2)return void de.getLogger(this).warn(xYe);const n=this._rootTiles.map(o=>o.lij),s=bH(n,r,JF);if(this._updatingRootTiles=!0,s.removed.length>0||s.added.length>0){const o=this._rootTiles.filter(a=>!(s.removed.findIndex(l=>JF(l,a.lij))>-1)||(this._purgeTile(a),!1));s.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>T2&&(de.getLogger(this).warn(SYe),r=e.rootTilesInExtent(t,i,T2)),this._setRootTiles(r.map(n=>this._newRootTile(n)));wb(i,this._rootTilesExtent)||(this._rootTilesExtent=Zi(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.loaded&&e.intersectsClippingArea);t.sort(um),t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(um);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===yt.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(yt.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(yt.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=w_t(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,n=e?i.max:-1/0;const s=this.extent,o=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(s)&&l.resetPendingUpdate(yt.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),n=Math.max(l.elevationBoundsMax,n))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(n)&&(i.min!==r||i.max!==n)&&(this.visibleElevationBounds=new B2(r,n))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBoundsMin:n,elevationBoundsMax:s})=>{t=Math.min(t,n),e=Math.max(e,s)});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new B2(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=n/t.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/t.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=U5(this._splitLimits.frustum??HR(),e.frustum):this._splitLimits.frustum=null,U5(this._frustum,t.frustum),ye(this._eyePosRenderSR,e.eye),tc(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[Qt.MAP].some(SC)&&e.setPendingUpdate(yt.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const i=t.resetPendingUpdate(yt.TEXTURE_FADING)?yt.TEXTURE_FADING:!!t.resetPendingUpdate(yt.TEXTURE_NOFADING)&&yt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=C8.extent;wy(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>Q2(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),C8.spatialReference=this.spatialReference,this.emit("elevation-change",C8),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Xs&&this._checkTileInvariant(),!t.hasProgressed)return jo}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{var i;if(qs(e.rendered===e.leaf,` rendered ${e.rendered} != ${e.leaf} leaf`),!e.leaf){const r=s=>s.unmergableChildCount===0&&s.maxLevelDeltaNeighborCount===0,n=e.children.reduce((s,o)=>s+(r(o)?0:1),0);if(qs(e.unmergableChildCount===n,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${n}`),e.hasPendingUpdate(yt.MERGE)){qs(!e.hasPendingUpdate(yt.SPLIT),"Tile can be both split and merge at the same time");for(const s of e.children)qs(s.leaf||s.hasPendingUpdate(yt.MERGE),"Child of tile to merge must also merge")}}for(let r=0;r<4;++r){if(e.rendered){const a=(i=e.renderData)==null?void 0:i.geometryState.edgePeerNeighbors[r];if(a!=null){{const l=e.level-a.level<=Ds;l||(console.log(`tile level delta [${e.lij.toString()}] vs [${a.lij.toString()}] > ${Ds}  (edge[${r}])`),qs(l,`tile level delta [${e.level}] vs [${a.level}] > ${Ds}`))}qs(e.level-a.level<=Ds,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${a.lij.toString()}]`)}}const n=e.level-Ds,s=a=>a.leaf||a.level===e.level,o=e.findNeighborTile(zp[r],s);if(o!=null){if(e.leaf&&e.level>=Ds){let a=o;for(;e.level-a.level<Ds;)a=a.parent;const l=[n,e.lij[1]>>Ds,e.lij[2]>>Ds];if(!JF(l,a.lij)){const c=t.get(a);qs(!c.has(e),"Cannot already have neighbor"),c.add(e)}}qs(o.rendered||o.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),qs(e.level-o.level<=Ds,`Tile level delta [${e.level}] vs [${o.level}] > ${Ds}`)}}}),this._allTiles.forAll(e=>{const i=e.maxLevelDeltaNeighborCount,r=t.get(e);qs(i===r.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new X1t(this._allTiles.length);e.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,n=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const s=this.view.state.contentCamera.viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(yt.MERGE),c=l?yt.MERGE:o.shouldSplit(r,n,i),h=c===yt.SPLIT;o.leaf?M8(o,h):e.pushAll(o.children),l?(o.resetPendingUpdate(yt.SPLIT),o.leaf||o.setPendingUpdate(yt.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(s)):h?(o.resetPendingUpdate(yt.MERGE),o.leaf&&o.setPendingUpdate(yt.SPLIT)):(o.resetPendingUpdate(yt.SPLIT)&&o.updateAgentSuspension(),c===yt.ELEVATION&&o.updateAgents(Qt.ELEVATION),o.leaf||(o.setPendingUpdate(yt.MERGE),o.resetPendingUpdate(yt.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(__t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){qe(t.loaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(n=>n.loaded&&n.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(n,s)=>{!(s!=null&&s.loaded)||!s.intersectsClippingArea||s.level<n.level||t.has(s)||(t.add(s),e.push(s),s.renderData.updateNeighborData())};e.sort(um);const r=e.length;for(let n=0;n<r;++n){const s=e[n];qe(s.loaded),qe(s.intersectsClippingArea);const o=s.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=h=>{var g;const p=kk[h];i(s,(g=l.cornerPeerNeighbors[h])==null?void 0:g.findCorner(Fk(p),y=>y.loaded))};for(let h=0;h<4;++h)if(a&1<<h){const p=o.geometryState.edgePeerNeighbors[h];p&&(p==null?void 0:p.level)>=s.level&&p.forAllSubtreeOnSide(Bte(zp[h]),g=>!(!g.loaded||!g.intersectsClippingArea)&&(qe(t.has(g)||um(s,g)<0),i(s,g),!0)),c((h+1)%4),c(h)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Xs&&Dk&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let n=!1;for(;!t.done;){n=!0;let s=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(yt.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(yt.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(yt.MERGE);)l=l.parent;this._mergeTile(l),s=!0,t.madeProgress()}else if(a.resetPendingUpdate(yt.SPLIT)){let c=!0;const h=a.level;if(h>=Ds){const p=g=>g.leaf||h-g.level<Ds;for(let g=0;g<4;++g){const y=a.findNeighborTile(zp[g],p);y!=null&&h-y.level===Ds&&(c=!1,Xs&&(qe(y.leaf),qe(y.hasPendingUpdate(yt.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),s=!0):a.setPendingUpdate(yt.SPLIT)}return t.done});if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(yt.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Gt.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*wYe}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=Oe(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeSubtree(t){const e=t.children;e[0]&&(this._purgeTile(e[0]),this._purgeTile(e[1]),this._purgeTile(e[2]),this._purgeTile(e[3]),t.clearChildren())}_purgeTile(t){t.leaf?Jme(t):this._purgeSubtree(t),this._allTiles.removeUnordered(t),this._unloadTile(t),t.dispose(),this._tileCache.put(t4._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){qs(t.leaf,"Tile that is already split should not be split again!"),qs(t.rendered,"Tile marked to split is not rendered"),Jme(t);const e=t.createChildren();this._allTiles.pushArray(e),t.updateAgentSuspension(),qs(t.rendered,"parent should be rendered"),e.forEach(i=>this._loadTile(i)),e.forEach(i=>this._pendingTilesToUpdate.add(i)),this._unloadTile(t),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),e.forEach(i=>M8(i,i.hasPendingUpdate(yt.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){UD.spatialReference=this.spatialReference,UD.extent=t.extent,UD.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",UD)}createTile(t,e,i,r){qs(!!r,"createTile sanity check");const n=this._acquireTile(t,e,i,r);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(yt.SPLIT),n}get _shortBatches(){return this.view.state.mode!==Di.IDLE}_mergeTile(t){qs(!t.hasPendingUpdate(yt.SPLIT),"_mergeTile sanity check"),qs(!t.leaf,"Cannot merge a leaf"),t.leaf||(this._purgeSubtree(t),qs(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),M8(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_handleLayerViewChanges(t=kc){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(let n=this.view.allLayerViews.length-1;n>=0;n--){const s=this.view.allLayerViews.items[n];if(i.add(s.uid),uY(s)||z$(s))if(this._basemapLayerViewHandles.has(s.uid)&&!z$(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((n,s)=>{i.has(s)||(this._unregisterTiledLayerView(s),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,i;let t=((i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(cY(r)&&!wN(r.layer)&&r.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((g3(t)||z$(t))&&bvt(_Y[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return lY(t)?Qt.ELEVATION:Qt.MAP}_registerTiledLayerView(t){const e=[];if((g3(t)||z$(t))&&e.push(oe(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Un.UNFADED)})),!z$(t)){const i=this._layerClassFromLayerView(t);e.push(oe(()=>t.suspended,()=>this._updateTiledLayers())),e.push(oe(()=>t.fullOpacity,()=>this._updateTileTextures(Un.UNFADED))),e.push(oe(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!uY(r)||!r.fullExtent)return;const n=this._layerClassFromLayerView(r);if(n===Qt.MAP){const s=r.displayLevelRange.maxLevel;s!==1/0&&(i===null||s>i)&&(i=s)}e[n].push(r)});for(const r of jT){const n=this._layerViews[r],s=e[r];s.reverse();const o=s.length;let a=n.length!==o;const l=new Array(o),c=new Array(n.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const p=s[h].uid;this._layerIndexByUid[r].set(p,h);const g=n.indexOf(s[h]);l[h]=g,h!==g&&(a=!0),g>-1&&(c[g]=h)}if(a){const h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=s,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===Qt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Qt.MAP),t===Un.IMMEDIATE?this.renderer.updateTileTexture(e,yt.TEXTURE_NOFADING):e.updateRenderData(Qt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=Gt.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const n=this.layerViewByIndex(e,i),s=n.layer;return!s.tilemapCache||SC(n)?this._requestTileData(t,i,n,r):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,zt(r),Bn(o)||this._dataMissing(t,i,n),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,n,r),r.signal)))}_requestTileData(t,e,i,r){if(this._destroying)return Promise.resolve();const n=e===Qt.ELEVATION;return r.requester??(r.requester=n?this._elevationDataRequester:this._mapDataRequester),n?lY(i)?this._requestElevationTileData(t,i,r):Promise.reject():cY(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=s=>{!zo(i)&&s&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,e,s))},n=s=>{Bn(s)||(de.getLogger(this).error(`Tile ${t.lij.toString()} layer ${Qt.ELEVATION}/${e.uid} error ${s}`),this._dataMissing(t,Qt.ELEVATION,e),this.requestUpdate())};return e.fetchTile(t.lij,i).then(s=>this._frameTask.schedule(()=>r(s)),n).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(t,e,i){const r=this._layerIndexByUid[Qt.ELEVATION].get(e.uid);if(r==null)return void de.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Qt.ELEVATION,t.lij.toString());const n=new syt(t.lij,t.extent,i);t.dataArrived(r,Qt.ELEVATION,n);const s=[t],o=t.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(a,l)=>{bE(l),zo(i)||(console.error(`Tile ${t.lij.toString()} layer ${Qt.MAP}/${e.uid} error ${a}`),this._dataMissing(t,Qt.MAP,e),this.requestUpdate())},n=a=>l=>r(l,a),s=a=>this._frameTask.schedule(()=>{this.requestUpdate(),zo(i)?bE(a):this._mapTileDataArrived(t,e,a)},i.signal,n(a)).catch(n(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return e.fetchTile(t.lij,i).then(s,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(Qt.MAP,e.uid);if(r==null)return bE(i),void de.getLogger(this).warn("TerrainSurface: received data from unknown layer");t.dataArrived(r,Qt.MAP,i)}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i){const r=this._getLayerIdxByUID(e,i.uid);r!=null?t.dataMissing(r,e):de.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.leaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(n=>e+=n.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const i=e[0],r=e[1]>>i,n=e[2]>>i;let s;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===n&&(s=o,!0)),s){let o=1<<e[0]-1;for(;s.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!s.children[a])return null;s=s.children[a],o>>=1}return qs(s.lij[0]===e[0]&&s.lij[1]===e[1]&&s.lij[2]===e[2],"not the right tile?"),s}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){}checkAllTilesWaterproofness(){if(!Dk)return;const t=this._rootTiles;if(t==null)return;const e=s=>{var o,a,l;return((l=(a=(o=s==null?void 0:s.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},i=(s,o)=>{e(s)&&console.error("Tile[",s.lij,"] has geometry although parent[",o.lij,"] has geom")},r=s=>{var o,a;if(s.intersectsClippingArea)if(s.renderData&&!s.renderData.geometryState&&console.error("Tile[",s.lij,"] has renderData but not geometryState"),s.renderData&&!s.renderData.geometry&&console.error("Tile[",s.lij,"] has renderData but not geometryInfo"),!((o=s.renderData)!=null&&o.geometry)||(((a=s.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",s.lij,"] has renderData but no indices - geometryInfo: ",s.renderData.geometry),e(s)){s.checkGeometryWaterproofness();for(const l of s.children)i(l,s)}else if(s.leaf)console.error("Tile[",s.lij,"] has no geometry and no children, from root to leaf");else for(const l of s.children)r(l)},n=s=>{var c;const o=((c=s.parent)==null?void 0:c.visible)??!0,a=s.visible;s.computeVisibility();const l=s.visible;if(a!==l&&o&&console.error(" Tile[",s.lij,"] has out of date visibility: ",a," instead of ",l),!s.leaf)for(const h of s.children)n(h)};for(const s of t)r(s),n(s)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this._isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){vyt(t)}enableWaterproofnessChecks(t){_yt(t)}};si._tileMemcacheKey="TerrainTileMemcache",u([f()],si.prototype,"_renderer",void 0),u([f({constructOnly:!0})],si.prototype,"_scaleRangeQueries",void 0),u([f({constructOnly:!0})],si.prototype,"view",void 0),u([f({constructOnly:!0})],si.prototype,"overlayManager",void 0),u([f()],si.prototype,"_hasPendingUpdates",void 0),u([f()],si.prototype,"_asyncWorkItems",void 0),u([f()],si.prototype,"_allTilesDirty",void 0),u([f()],si.prototype,"_allTilesSorted",void 0),u([f()],si.prototype,"_viewChanged",void 0),u([f({type:Number})],si.prototype,"heading",void 0),u([f()],si.prototype,"_splitLimits",void 0),u([f({readOnly:!0})],si.prototype,"_watchUpdatingTracking",void 0),u([f()],si.prototype,"_frameTask",void 0),u([f({readOnly:!0})],si.prototype,"snapLevel",null),u([f({readOnly:!0})],si.prototype,"lodSnappingEnabled",null),u([f()],si.prototype,"_userClippingExtent",null),u([f()],si.prototype,"_rootTilesExtent",void 0),u([f({readOnly:!0})],si.prototype,"extent",null),u([f({readOnly:!0})],si.prototype,"groundExtent",null),u([f({readOnly:!0})],si.prototype,"_tilingSchemeExtent",null),u([f({readOnly:!0})],si.prototype,"updating",null),u([f({readOnly:!0})],si.prototype,"running",null),u([f(ryt)],si.prototype,"updatingProgress",void 0),u([f({readOnly:!0})],si.prototype,"updatingProgressValue",null),u([f()],si.prototype,"_maxNumUpdating",void 0),u([f()],si.prototype,"baseOpacity",null),u([f()],si.prototype,"hasCompositeBlendMode",void 0),u([f({readOnly:!0})],si.prototype,"viewingMode",null),u([f()],si.prototype,"maxTextureScale",void 0),u([f({readOnly:!0})],si.prototype,"ready",null),u([f({value:TC.FRONT_TO_BACK})],si.prototype,"renderOrder",null),u([f({readOnly:!0})],si.prototype,"rootTiles",null),u([f()],si.prototype,"_rootTiles",void 0),u([f({readOnly:!0})],si.prototype,"spatialReference",null),u([f({type:mt})],si.prototype,"backgroundColor",null),u([f({value:!1})],si.prototype,"slicePlaneEnabled",null),u([f({readOnly:!0})],si.prototype,"tilingScheme",void 0),u([f({readOnly:!0})],si.prototype,"tilingSchemeLocked",null),u([f({readOnly:!0})],si.prototype,"tilingSchemeLogic",void 0),u([f()],si.prototype,"wireframe",null),u([f({value:!1})],si.prototype,"suspended",null),u([f()],si.prototype,"fadeDuration",null),u([f()],si.prototype,"visibleElevationBounds",void 0),u([f()],si.prototype,"rootTileElevationBounds",void 0),u([f()],si.prototype,"_layerViewsDirty",void 0),u([f()],si.prototype,"renderPatchBorders",null),u([f()],si.prototype,"visualizeNormals",null),u([f()],si.prototype,"renderingDisabled",null),si=t4=u([L("esri.views.3d.terrain.TerrainSurface")],si);const Z1t=si,H$=A(),KS=Pn(),Y1t=Zi();new mi;const C8=new iyt("ground"),UD={spatialReference:null,extent:null,scale:0};function Xme(t,e,i){var r;for(const n of t){if(!n.containsPointXY(e,i))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[a]}const o=((r=s==null?void 0:s.renderData)==null?void 0:r.geometryState.samplerData)??null;return Tn(e,i,o)}return null}class X1t{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let n=0;n<i;++n)this._data[r+n]=e[n];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function M8(t,e){!t.leaf||t.level<Ds||die(t,i=>{e&&tIe(i);const r=AY(i);if(i.maxLevelDeltaNeighborCount++,r){let n=i.parent;for(;n;){const s=AY(n);if(n.unmergableChildCount++,!s)break;n=n.parent}}})}function tIe(t){if(t.hasPendingUpdate(yt.SPLIT))return;let e=t.parent;for(;e!=null&&e.resetPendingUpdate(yt.MERGE);)e=e.parent;t.resetPendingUpdate(yt.MERGE),t.leaf&&t.setPendingUpdate(yt.SPLIT),t.level<Ds||die(t,i=>{tIe(i)})}function Jme(t){t.level<Ds||die(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,AY(i));)i=i.parent}})}function AY(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function die(t,e){if(t.level<Ds)return;const i=t.level-Ds,r=t.lij[1]>>Ds,n=t.lij[2]>>Ds,s=o=>o.leaf||o.level===i;for(let o=0;o<4;++o){const a=t.findNeighborTile(zp[o],s);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===n||e(a)}}let J1t=class{constructor(e,i,r,n){this.operation=e,this.geometry=i,this.states=r,this.sync=n}},aA=class extends Ne{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyRecordCount=0}get dirty(){return this._dirtyRecordCount>0}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);if(!r)return;let n=0;r.forEach((s,o)=>{const a=this._ensureGeomRecord(e,o);n+=s.size,s.forEach(({geometry:l,operation:c,states:h},p)=>{let g=!1;if(c===On.UPDATE){const y=a.get(p);if(y){if(h&Po.TRANSFORMATION){const w=this.model.getObject(o);this.model.updateRenderGeometryTransformation(w,l,y)&&(g=!0)}g||i.updates.push({renderGeometry:y,updateType:h})}else St(!1,"ModelDirtySet.commitLayer: invalid update")}if(c===On.REMOVE||g){const y=a.get(p);y?(i.removes.push(y),a.delete(p)):c===On.REMOVE&&St(!1,"ModelDirtySet.commitLayer: invalid remove")}if(c===On.ADD||g){const y=this.model.getObject(o);if(y!=null){const w=this.model.getRenderGeometry(y,l);i.adds.push(w),a.set(p,w)}}}),a.size===0&&this._residentGeomRecords.get(e).delete(o)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this._dirtyRecordCount-=n}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c,sync:h},p)=>{let g=!1;if(l===On.UPDATE&&h){const y=o.get(p);if(y){if(c&Po.TRANSFORMATION){const w=this.model.getObject(s);this.model.updateRenderGeometryTransformation(w,a,y)&&(g=!0)}g||i.updates.push({renderGeometry:y,updateType:c})}else St(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(n=>n.forEach(s=>i.push(s)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,On.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Po.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Po.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Po.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,On.UPDATE,Po.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const n of i.geometries)this._geometryAdded(i,n,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const n of i.geometries)this._geometryRemoved(i,n,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,i,On.UPDATE,Po.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{n.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,On.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,On.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,n,s=Po.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),h=c.get(l);if(h){const p=h.operation;p===On.REMOVE&&n===On.ADD&&h.states!==Po.NONE?h.operation=On.UPDATE:p===On.REMOVE&&n===On.ADD||p===On.ADD&&n===On.REMOVE?(c.delete(l),this._dirtyRecordCount--):p!==On.UPDATE||n!==On.REMOVE&&n!==On.UPDATE?(St((p===On.REMOVE||p===On.ADD)&&n===On.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),h.states|=s):(h.operation=n,h.states|=s),h.sync=h.sync||o}else c.set(l,new J1t(n,i,s,o)),this._dirtyRecordCount++}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:HFe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,n)=>{r.forEach((s,o)=>{i.length>0&&(i+=`
`),i+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){}};u([f()],aA.prototype,"_dirtyRecordCount",void 0),u([f({constructOnly:!0})],aA.prototype,"model",void 0),aA=u([L("esri.views.3d.webgl-engine.lib.ModelDirtySet")],aA);const Q1t=aA;let K1t=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=ut(),this._shaderTransformation=null,this._boundingSphere=null,this.id=rd(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){ps(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=ut()),fs(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Pn()),Mt(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*eC(this.shaderTransformation)),this._boundingSphere):PSe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightGroup(e){this.geometry.foreachHighlightGroup(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}},i4=class extends Ne{constructor(){super(...arguments),this.dirtySet=new Q1t({model:this}),this._content=new Map,this._originFactory=new c3e(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;St(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),Ik(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),Ik(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(St(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(St(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new K1t(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,Qme);const{localOrigin:n}=i;return r.localOrigin=n??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,Qme);const n=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==n}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<Fo.COUNT;++r)e[r]=i.filter(n=>n.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};u([f({constructOnly:!0})],i4.prototype,"dirtySet",void 0),i4=u([L("esri.views.3d.webgl-engine.parts.Model")],i4);const Qme=ut();function iIe(t){return"r"in t&&"g"in t&&"b"in t}function rIe(t){return"h"in t&&"s"in t&&"v"in t}function nIe(t){return"l"in t&&"a"in t&&"b"in t}function sIe(t){return"l"in t&&"c"in t&&"h"in t}function ewt(t){return"x"in t&&"y"in t&&"z"in t}const twt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],iwt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function oIe(t,e){const i=[];let r,n;if(t[0].length!==e.length)throw new Error("dimensions do not match");const s=t.length,o=t[0].length;let a=0;for(r=0;r<s;r++){for(a=0,n=0;n<o;n++)a+=t[r][n]*e[n];i.push(a)}return i}function aIe(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=oIe(twt,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function pie(t){const e=oIe(iwt,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function lIe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function cIe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function rwt(t){const e=t.l,i=t.a,r=t.b,n=Math.sqrt(i*i+r*r);let s=Math.atan2(r,i);return s=s>0?s:s+2*Math.PI,{l:e,c:n,h:s}}function nwt(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function swt(t){return lIe(aIe(t))}function owt(t){return pie(cIe(t))}function awt(t){return rwt(lIe(aIe(t)))}function lwt(t){return pie(cIe(nwt(t)))}function cwt(t){const e=t.r,i=t.g,r=t.b,n=Math.max(e,i,r),s=n-Math.min(e,i,r);let o=n,a=s===0?0:n===e?(i-r)/s%6:n===i?(r-e)/s+2:(e-i)/s+4,l=s===0?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function uwt(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,n=r*i,s=n*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-n),o.g=Math.round(o.g+r-n),o.b=Math.round(o.b+r-n),o}function SI(t){return iIe(t)?t:sIe(t)?lwt(t):nIe(t)?owt(t):ewt(t)?pie(t):rIe(t)?uwt(t):t}function hwt(t){return rIe(t)?t:cwt(SI(t))}function dwt(t){return nIe(t)?t:swt(SI(t))}function KGt(t){return sIe(t)?t:awt(SI(t))}function pwt(t,e){const{r:i,g:r,b:n}=t;return .2126*i+.7152*r+.0722*n}var RY;function e8t(t,e=RY.High){return pwt(t)>e?new mt([0,0,0,t.a]):new mt([255,255,255,t.a])}function t8t(t,e){const i=dwt(t);i.l*=1-e;const r=SI(i),n=t.clone();return n.setColor(r),n.a=t.a,n}function i8t(t,e){const i=t.clone();return i.a*=e,i}function r8t(t,e){const i=hwt(t);i.s*=e;const r=SI(i),n=t.clone();return n.setColor(r),n.a=t.a,n}function fie(t){return mt.toUnitRGBA(t)}function n8t(t,e){return t===e||t!=null&&e!=null&&Qb(t,e)}function s8t(t){return Ri(t[0],t[1],t[2],t.length>3?t[3]:1)}function o8t(t,e){const i=mt.toUnitRGBA(t);return i[3]*=e,i}function a8t(t,e,i={}){if(t.length===0||e<=0)return[];if((t=t.map(r=>typeof r=="string"?new mt(r):r)).length===1||e===1){const r=[],n=t[0];for(let s=0;s<e;s++)r.push(n.clone());return r}if(i.shuffle&&(t=r_e(te(t),i.seed)),t.length>=e){const r=[],n=(t.length-1)/(e-1);for(let s=0;s<e;s++){const o=Math.round(s*n);r.push(t[o].clone())}return r}return fwt(t,e,i)}function fwt(t,e,i={}){const r=[],n=t.length-1,s=Math.ceil((e-t.length)/n);e:for(let o=0;o<n;o++){const a=t[o],l=t[o+1];for(let c=1;c<=s;c++){const h=c/(s+1);if(r.push(mwt(a,l,h,i)),r.length+t.length===e)break e}}return[...t.map(o=>o.clone()),...r_e(r,i.seed??1)]}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(RY||(RY={}));const $8=(t,e)=>{const i=Math.floor(10*e())-5;return Math.min(255,Math.max(0,t+i))};function mwt(t,e,i,r={}){const n=t.r,s=t.g,o=t.b,a=e.r,l=e.g,c=e.b,h=Math.round(n+(a-n)*i),p=Math.round(s+(l-s)*i),g=Math.round(o+(c-o)*i);if(!r.offset)return new mt([h,p,g]);const y=i_e(r.seed);return new mt([$8(h,y),$8(p,y),$8(g,y)])}let uIe=class extends Ar{constructor(){super(...arguments),this.radii=Yt(),this.heightParameters=Ti()}};function gwt(t){t.uniforms.add(new rs("radii",e=>e.radii),new Yr("heightParameters",e=>e.heightParameters)),t.constants.add("scaleHeight","float",Ii.scaleHeight*Ii.atmosphereHeight),t.code.add(C`float chapmanApproximation(float thickness, float height, float cosZenith) {
float c = sqrt(thickness + height);
float cExpH = c * exp(-height);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (thickness + height);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(thickness - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),t.code.add(C`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),t.code.add(C`vec4 planetIntersect(vec3 cameraPos, vec3 rayDir) {
float reducedPlanetRadius = radii[0] - 20000.0;
float rayPlanetDistance = heightParameters[1] - reducedPlanetRadius * reducedPlanetRadius;
vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, rayPlanetDistance);
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, heightParameters[2]);
bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
bool insideAtmosphere = heightParameters[0] < radii[1];
if (!(hitsAtmosphere || insideAtmosphere)) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;
if (heightParameters[0] < reducedPlanetRadius) {
if (dot(rayDir, normalize(cameraPos)) < -0.025) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
start = rayPlanetIntersect.y;
}
float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
return vec4(0.0, hitsPlanet ? 1.0 : 0.0, start, end);
}`)}function hIe(t,e){t.include(gwt);const i=6;t.uniforms.add(new fi("cameraPosition",(r,n)=>n.camera.eye)),t.constants.add("betaRayleigh","vec3",PF),t.constants.add("betaCombined","vec3",Qit),t.constants.add("betaMie","float",Jit),t.code.add(C`
    vec3 raymarchAtmosphere(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      vec4 ray = planetIntersect(cameraPos, rayDir);
      if(ray.x == 1.0) {
        return vec3(0);
      }
      ${Ge(e,"if (terrainDepth != -1.0) { ray.w = terrainDepth; }")}

      vec3 samplePoint = cameraPos + rayDir * ray.w;
      float multiplier = ray.y == 1.0 ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (ray.w - ray.z) / ${C.float(i)};

      for (int i = 0; i < ${C.int(i)}; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
          ${Ge(!e,"scattering *= mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0))")};
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {
          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);
          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${Ge(!e,"scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);")}
        }
        lastOpticalDepth = opticalDepth;
      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;
      ${e?"return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;":C`const float g = 0.8;
             const float gg = g * g;
             float phaseMie = 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg));
             phaseMie = clamp(phaseMie, 0.0, 128.0);
             return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }`)}function _V(t,e={needUVs:!0,needEyeDirection:!0}){t.attributes.add(k.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{needUVs:i,needEyeDirection:r}=e;i&&t.varyings.add("uv","vec2"),r&&t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add(new Bs("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new Bs("inverseViewMatrix",(n,s)=>iQ(ywt,s.camera.viewMatrix))),t.vertex.main.add(C`
    vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
    ${Ge(r,"eyeDir = posViewNear;")}
    worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
    ${Ge(i,"uv = position * 0.5 + vec2(0.5);")}
    gl_Position = vec4(position, 1, 1);
  `)}const ywt=ut();function dIe(t){const e=new or;e.include(_V);const{reduced:i}=t,{fragment:r}=e;return r.uniforms.add(new fi("backgroundColor",n=>n.backgroundColor),new rt("innerFadeDistance",n=>n.innerFadeDistance),new rt("altitudeFade",n=>n.altitudeFade),new ht("depthTexture",(n,s)=>s.mainDepth)),Om(r),e.include(xI),r.include($z),r.include(mV),r.include(hIe,!1),r.code.add(C`vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
float rayPlanetDistance = heightParameters[1] - radii[0] * radii[0];
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, rayPlanetDistance);
if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
return fragColor;
}
float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
if (relDist > 1.0) {
return surfaceColor;
}
return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
}
float getGlow(float dist, float radius, float intensity) {
return pow(radius / max(dist, 1e-6), intensity);
}
vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){
float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));
vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));
float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));
return normalize(sunTransmittance) * sunDisc;
}`),r.main.add(C`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${Ge(!i,C`float depthSample = texture(depthTexture, uv).r;
             if (depthSample != 1.0) {
                fragColor = vec4(0);
                return;
             }`)}

      vec3 col = linearizeGamma(backgroundColor);
      col += raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      col += getSun(cameraPosition, rayDir, mainLightDirection);
      float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);
  `),e}const _wt=Object.freeze(Object.defineProperty({__proto__:null,build:dIe},Symbol.toStringTag,{value:"Module"}));let vwt=class extends uIe{constructor(){super(...arguments),this.innerFadeDistance=0,this.altitudeFade=0,this.backgroundColor=A()}},O8=class extends hr{constructor(e,i,r){super(e,i,new ar(_wt,()=>fe(()=>Promise.resolve().then(()=>gAt),void 0)),r)}initializePipeline(e){return Pi({blending:e.reduced?VK:Lx(ei.SRC_ALPHA,ei.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.reduced?gr.ALWAYS:gr.LEQUAL},colorWrite:Qi})}},pIe=class extends Zu{constructor(){super(...arguments),this.reduced=!1}};u([le()],pIe.prototype,"reduced",void 0);let Ap=class extends Hy{constructor(e){super(e),this.produces="disabled",this.consumes={required:[ii.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=ii.OPAQUE_ENVIRONMENT,this.requestRender(Gt.UPDATE)}_disable(){this.produces="disabled",this.requestRender(Gt.UPDATE)}};u([f()],Ap.prototype,"produces",void 0),u([f()],Ap.prototype,"consumes",void 0),u([f({constructOnly:!0})],Ap.prototype,"techniques",void 0),Ap=u([L("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],Ap);let mie=class extends Ar{};function fIe(){const t=new or;return t.include(xa),t.fragment.uniforms.add(new ht("colorTexture",e=>e.color),new ht("depthTexture",(e,i)=>i.mainDepth)),t.fragment.main.add(C`float depthSample = texture(depthTexture, uv).r;
if (depthSample != 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const wwt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:mie,build:fIe},Symbol.toStringTag,{value:"Module"}));let Kme=class extends hr{constructor(e,i,r){super(e,i,new ar(wwt,()=>fe(()=>Promise.resolve().then(()=>yAt),void 0)),r)}initializePipeline(){return Pi({blending:Lx(ei.SRC_ALPHA,ei.ONE_MINUS_SRC_ALPHA),depthTest:{func:gr.ALWAYS},colorWrite:Qi})}},IY=class extends Ap{constructor(e){super(e),this.requireGeometryDepth=!0,this._compositingPassParameters=new mie,this._vao=null,this._passParameters=new vwt,this._configuration=new pIe;const{techniques:i}=e;i.precompile(O8,this._configuration),i.precompile(Kme),this._configuration.reduced=!0,i.precompile(O8,this._configuration),this._configuration.reduced=!1}initialize(){this.addHandles([oe(()=>this.view.environment.background,e=>{const i=e instanceof Sxe?fie(e.color):hs;ve(this._passParameters.backgroundColor,i[0]*i[3],i[1]*i[3],i[2]*i[3])},hi),oe(()=>{var e,i;return(i=(e=this.view._stage)==null?void 0:e.renderer)==null?void 0:i.fullResolutionAtmosphere},e=>this._configuration.reduced=!e,hi),oe(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),hi)])}destroy(){this._vao=Ht(this._vao)}render(e){const i=e.find(({name:b})=>b===ii.OPAQUE_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext;this._vao??(this._vao=i1(r,Am.Pos2Tex));const n=i.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);this._update();const s=this.techniques.acquire(O8,this._configuration);if(!s.compiled)return s.release(),this.requestRender(Gt.UPDATE),i;if(!this._configuration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(ur.TRIANGLE_STRIP,0,4),i.attachDepth(n),s.release(),i;const o=this.techniques.acquire(Kme);if(!o.compiled)return s.release(),o.release(),this.requestRender(Gt.UPDATE),i;const a=r.getViewport(),l=this.bindParameters.camera,c=Fe(l.eye)-Ii.radius;let h;const p=Ii.atmosphereHeight;if(c<p){const b=Math.min(1,Math.max(0,c/p));h=Bt(.2,.3,b)}else{const b=Math.min(1,Math.max(0,(c-p)/(15*p)));h=Bt(.3,.6,b)}const g=my(Math.round(h*l.fullViewport[2])),y=my(Math.round(h*l.fullViewport[3]));r.setViewport(0,0,g,y);const w=this.fboCache.acquire(g,y,"chapman",Vr.RGBA);return r.bindFramebuffer(w.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(ur.TRIANGLE_STRIP,0,4),r.setViewport(a.x,a.y,a.width,a.height),this._compositingPassParameters.color=w.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(o,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(n),s.release(),o.release(),w.release(),i}_update(){const e=this.bindParameters.camera,i=No(e.eye),r=Math.sqrt(i),n=i-this._passParameters.radii[1]**2,s=Oe((r-this._passParameters.radii[0])/Ii.atmosphereHeight,0,1);_n(this._passParameters.heightParameters,r,i,n,s);const o=this.view.basemapTerrain.getLowerBoundRadius();ln(this._passParameters.radii,o,o+Ii.atmosphereHeight),this._passParameters.innerFadeDistance=2*Math.sqrt((2*o-wZ)*wZ),this._passParameters.altitudeFade=$ee(r-o)}};IY=u([L("esri.views.3d.environment.ChapmanAtmosphere")],IY);function mIe(){const t=new or,{fragment:e}=t;return t.include(_V,{needUVs:!1,needEyeDirection:!1}),e.include(aM),e.include(t1),t.include(QOe,{pbrMode:Ut.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(fI),t.include(xI),t.include(VRe),e.uniforms.add(new fi("cameraPosition",(i,r)=>r.camera.eye),new rt("cloudsOpacity",(i,r)=>r.clouds.opacity)).main.add(C`vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4(cloudsOpacity * cloudsColor.rgb, cloudsColor.a);`),t}const bwt=Object.freeze(Object.defineProperty({__proto__:null,build:mIe},Symbol.toStringTag,{value:"Module"}));let ege=class extends hr{constructor(e,i,r){super(e,i,new ar(bwt,()=>fe(()=>Promise.resolve().then(()=>_At),void 0)),r)}initializePipeline(){return Pi({blending:e1(ei.ONE,ei.ZERO,ei.SRC_ALPHA,ei.ONE),depthTest:{func:gr.LEQUAL},colorWrite:Qi})}},PY=class extends Ap{constructor(e){super(e),e.techniques.precompile(ege),this._planetRadius=xr(e.view.spatialReference).radius}initialize(){this.addHandles([oe(()=>this.view.environment.weather!=null&&this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Si)])}destroy(){this._vao=Ht(this._vao)}render(e){const i=e.find(({name:a})=>a===ii.OPAQUE_ENVIRONMENT),r=this.bindParameters.clouds;if(!r.data)return i;const n=this.techniques.acquire(ege);if(!n.compiled)return this.requestRender(Gt.UPDATE),n.release(),i;const s=this.renderingContext;this._vao??(this._vao=i1(s));const o=s.bindTechnique(n,this.bindParameters,xwt);return s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(ur.TRIANGLE_STRIP,0,4),n.release(),r.isFading&&this.requestRender(Gt.UPDATE),i}};PY=u([L("esri.views.3d.environment.CloudsComposition")],PY);const xwt=new Ar;let gie=class extends Ar{constructor(){super(...arguments),this.color=A(),this.strength=4e-6,this.atmosphereC=1,this.amount=0}};function gIe(){const t=new or;t.include(_V,{needUVs:!0,needEyeDirection:!0});const e=t.fragment;return e.uniforms.add(new rt("atmosphereC",i=>i.atmosphereC),new fi("cameraPosition",(i,r)=>r.camera.eye),new rs("nearFar",(i,r)=>r.camera.nearFar),new ht("depthTexture",(i,r)=>r.mainDepth),new rt("fogStrength",i=>i.strength),new rt("fogAmount",i=>i.amount),new fi("fogColor",i=>i.color)),t.include(xI),e.include($z),e.include(mV),e.code.add(C`float getFogAmount(float dist, vec3 rayDir) {
if(dist == -1.0){
dist = 0.055 * sphereIntersect(cameraPosition, rayDir, atmosphereC).y;
}
return fogAmount * (1.0 - exp(-dist * fogStrength));
}`),e.main.add(C`vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, uv).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
float fogAmount = getFogAmount(terrainDepth, rayDir);
vec4 fog = vec4(fogColor, 1.0) * fogAmount;
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));`),t}const Swt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:gie,build:gIe},Symbol.toStringTag,{value:"Module"}));let tge=class extends hr{constructor(e,i,r){super(e,i,new ar(Swt,()=>fe(()=>Promise.resolve().then(()=>vAt),void 0)),r)}initializePipeline(){return Pi({blending:e1(ei.SRC_ALPHA,ei.ZERO,ei.ONE_MINUS_SRC_ALPHA,ei.ONE),colorWrite:Qi})}},fR=class extends Ap{constructor(e){super(e),this.consumes={required:[ii.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=ii.TRANSPARENT_ENVIRONMENT,this.requestRender(Gt.UPDATE)}};u([f()],fR.prototype,"consumes",void 0),fR=u([L("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],fR);const Twt=.95,Ewt=1;let LY=class extends fR{constructor(e){super(e),this.requireGeometryDepth=!0,this._newParameters=new A8,this._oldParameters=new A8,this._fadedParameters=new A8,this._parameters=this._newParameters,this._passParameters=new gie;const{view:i,techniques:r}=e,n=xr(i.spatialReference);this._planetRadius=n.radius,this._atmosphereRadius=n.radius+n.atmosphereHeight,r.precompile(tge)}toogle(){this.view.environment.atmosphereEnabled&&this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([oe(()=>this.view.environment.atmosphereEnabled,()=>this.toogle(),hi),oe(()=>this.view.environment.weather,()=>this.toogle(),hi),oe(()=>this._updateFogParameters(),()=>{},hi)]),this.addHandles(oe(()=>this._fadeFactor,e=>this._fade(e),hi))}get _fadeFactor(){var e;return((e=this.view._stage)==null?void 0:e.renderer.renderContext.bind.clouds.fadeFactor)??1}_fade(e){const{_newParameters:i,_oldParameters:r}=this;e>=1?(this._parameters=i,this._oldParameters.copyFrom(this._newParameters)):e<=0?this._parameters=r:(this._fadedParameters.lerp(r,i,e),this._parameters=this._fadedParameters)}_updateFogParameters(){const e=this.view.environment.weather,i=e.type==="foggy"||e.type==="snowy"||e.type==="rainy";this._newParameters.strength=e.type==="foggy"?Bt(3e-5,.005,e.fogStrength**3):e.type==="snowy"||e.type==="rainy"?Bt(4e-6,2e-4,(e.precipitation??0)**3):0,this._newParameters.amount=i?1:0,e.type!=="foggy"&&e.type!=="snowy"||ye(this._newParameters.color,Mwt),e.type==="rainy"&&ye(this._newParameters.color,Cwt),this._fadeFactor>=1&&this._oldParameters.copyFrom(this._newParameters),this.requestRender(Gt.UPDATE)}render(e){const i=e.find(({name:o})=>o===ii.TRANSPARENT_ENVIRONMENT);if(this._parameters.amount===0||(this._update(),this._passParameters.amount<=0))return i;const r=this.techniques.acquire(tge);if(!r.compiled)return this.requestRender(Gt.UPDATE),r.release(),i;const n=this.renderingContext,s=i.getAttachment(n.gl.DEPTH_STENCIL_ATTACHMENT);return i.attachDepth(null),n.bindFramebuffer(i.fbo),n.bindTechnique(r,this.bindParameters,this._passParameters),n.screen.draw(),i.attachDepth(s),r.release(),i}_update(){const e=this.bindParameters.camera;Me(ige,e.eye);const i=Math.max(0,Te(ige,this.bindParameters.lighting.mainLight.direction)),r=this._parameters.color;ue(rge,r,.1),br(this._passParameters.color,rge,r,i);const n=Fe(e.eye);this._passParameters.atmosphereC=n**2-this._atmosphereRadius**2,this._passParameters.amount=(1-LR(Twt*ob,Ewt*ob,Math.abs(n-this._planetRadius)))*this._parameters.amount,this._passParameters.strength=this._parameters.strength}};LY=u([L("esri.views.3d.environment.Fog")],LY);let A8=class{constructor(){this.color=A(),this.strength=0,this.amount=0}copyFrom(e){this.amount=e.amount,this.strength=e.strength,ye(this.color,e.color)}lerp(e,i,r){this.amount=Bt(e.amount,i.amount,r),this.strength=Bt(e.strength,i.strength,r),br(this.color,e.color,i.color,r)}};const ige=A(),rge=A(),Cwt=Qe(.5,.5,.5),Mwt=Qe(1.5,1.5,1.5);var Zp;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Zp||(Zp={}));let yie=class extends Ry{constructor(){super(...arguments),this.geometry=Zp.Cone}};u([le({count:Zp.COUNT})],yie.prototype,"geometry",void 0);let vV=class extends Ar{constructor(){super(...arguments),this.texV=Yt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new _ie}},_ie=class{constructor(){this.center=A(),this.v1=A(),this.v2=A()}};function yIe(t){const e=new or,{vertex:i,fragment:r}=e;if(Om(i),t.geometry===Zp.Underground)e.attributes.add(k.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new fi("cameraPosition",(n,s)=>s.camera.eye),new rt("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),i.main.add(C`float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);`),r.main.add(C`fragColor = color;`);else{e.include(tv,t),e.attributes.add(k.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===Zp.Cylinder;i.uniforms.add(new Bs("proj",(a,l)=>l.camera.projectionMatrix),new Bs("view",(a,l)=>l.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),i.uniforms.add(new fi("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new fi("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new fi("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new rs("texV",a=>a.texV)),i.uniforms.add(new rt("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;i.main.add(C`
      ${n?C`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:C`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${C.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${C.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
	  `),r.uniforms.add(new ht("tex",a=>a.texture)),n||r.uniforms.add(new rt("altitudeFade",a=>a.altitudeFade)),r.main.add(C`
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?C`fragColor = atmosphereColor;`:C`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));`}`)}return e}const $wt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:_ie,SimpleAtmospherePassParameters:vV,build:yIe},Symbol.toStringTag,{value:"Module"}));let H2=class extends hr{constructor(e,i,r){super(e,i,new ar($wt,()=>fe(()=>Promise.resolve().then(()=>wAt),void 0)),r)}initializePipeline(e){const i=e.geometry===Zp.Cylinder;return Pi({blending:gd,culling:i?BK:void 0,depthTest:{func:gr.LEQUAL},colorWrite:Qi})}};const Owt=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);let DY=class extends Ap{constructor(e){super(e),this._configuration=new yie,this._passParameters=new vV,this._vao=null,this._vaoCount=0;const{techniques:i}=e;this._configuration.geometry=Zp.Cylinder,i.precompile(H2,this._configuration)}initialize(){this.addHandles([oe(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Si)])}destroy(){this._passParameters.texture=Ht(this._passParameters.texture),this._vao=Ht(this._vao)}render(e){const i=e.find(({name:o})=>o===ii.OPAQUE_ENVIRONMENT),r=this.techniques.acquire(H2,this._configuration);if(!r.compiled)return r.release(),this.requestRender(Gt.UPDATE),i;const n=this.renderingContext;if(this._vao||(this._vao=Awt(n),this._vaoCount=pC(this._vao,"geometry")),!this._passParameters.texture){const o=new jr;o.wrapMode=Tr.CLAMP_TO_EDGE,o.flipped=!0,o.width=1,o.height=512,this._passParameters.texture=new fr(n,o,Owt)}const s=n.bindTechnique(r,this.bindParameters,this._passParameters);return Rwt(nge,this.bindParameters.camera.viewMatrix),s.setUniformMatrix4fv("view",nge),n.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),n.drawArrays(ur.TRIANGLES,0,this._vaoCount),r.release(),i}};function Awt(t){const e=COe(1,2,!1),{data:i,indices:r}=e[0][1],n=sge.createBuffer(r.length),s=n.position;for(let o=0;o<r.length;++o){const a=3*r[o%3==0?o+2:o%3==2?o-2:o];s.set(o,0,i[a]),s.set(o,1,i[a+1]),s.set(o,2,i[a+2])}return new km(t,md,new Map([["geometry",Sd(sge)]]),new Map([["geometry",bs.createVertex(t,Vn.STATIC_DRAW,n.buffer)]]))}function Rwt(t,e){ps(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}DY=u([L("esri.views.3d.environment.LocalAtmosphere")],DY);const nge=ut(),sge=Zc().vec3f(k.POSITION),Iwt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),zD=128,oge=-wZ,age=0,R8=50,Pwt=()=>1-511/512,Lwt=HN([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let NY=class extends Ap{constructor(e){super(e),this._passParameters=new vV,this._configuration=new yie,this._vao=null,this._vaoCount=0,this._fadeVao=null,this._fadeVaoCount=0,this._texV1=1;const{view:i,techniques:r}=e,n=xr(i.spatialReference),{outerAtmosphereRimWidth:s,radius:o}=n;this._planetRadius=o,this._innerRimFactor=1+oge/o,this._middleRimFactor=1+age/o,this._outerRimFactor=1+s/o,this._texV0=age/s,this._texVScale=this._texV1-this._texV0,r.precompile(H2,this._configuration),this._configuration.geometry=Zp.Underground,r.precompile(H2,this._configuration)}initialize(){this.addHandles(oe(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Si))}destroy(){this._passParameters.texture=Ht(this._passParameters.texture),this._fadeVao=Ht(this._fadeVao),this._vao=Ht(this._vao)}render(e){const i=e.find(({name:n})=>n===ii.OPAQUE_ENVIRONMENT);this._update();const r=this.renderingContext;if(!this._passParameters.texture){const n=new jr;n.wrapMode=Tr.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new fr(r,n,Iwt)}if(this._passParameters.undergroundFadeAlpha<1){this._vao||(this._vao=this._createRibbon(r),this._vaoCount=pC(this._vao,"geometry")),this._configuration.geometry=Zp.Cone;const n=this.techniques.acquire(H2,this._configuration);if(!n.compiled)return n.release(),this.requestRender(Gt.UPDATE),i;r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(ur.TRIANGLES,0,this._vaoCount),n.release()}if(this._passParameters.undergroundFadeAlpha>0){this._fadeVao||(this._fadeVao=i1(r),this._fadeVaoCount=pC(this._fadeVao,"geometry")),this._configuration.geometry=Zp.Underground;const n=this.techniques.acquire(H2,this._configuration);if(!n.compiled)return n.release(),this.requestRender(Gt.UPDATE),i;r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(ur.TRIANGLE_STRIP,0,this._fadeVaoCount),n.release()}return i}_update(){const e=this.bindParameters.camera,i=A(),r=this._planetRadius,n=Fe(e.eye),s=n-r;if(s<0){const y=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=y}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(R8,s),a=r+oge;this._passParameters.innerScale=Dwt(r+o,r,a)-1,this._passParameters.altitudeFade=$ee(s),ue(i,e.eye,(r+R8)/n),lge(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=Pwt(),h=Lwt(s);let p=this._texV0+c*this._texVScale,g=this._texV0+l*h*this._texVScale;if(s>R8){lge(e.eye,e.center,e.up,r,this._passParameters.silhouette);const y=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),w=Oe((y-1.5)/(l-1.5),0,1);p=this._texV0+w*c*this._texVScale,g=this._texV0+Bt(this._texV1,l*h,w)*this._texVScale}ln(this._passParameters.texV,p,g)}_createRibbon(e){const i=zu(3+3*zD*3),r=new Uint32Array(3*zD*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<zD;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===zD-1?1:l+3,h=15*o;r[h]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const n=cge.createBuffer(r.length),s=n.position;for(let o=0;o<r.length;++o){const a=3*r[o];s.set(o,0,i[a]),s.set(o,1,i[a+1]),s.set(o,2,i[a+2])}return new km(e,md,new Map([["geometry",Sd(cge)]]),new Map([["geometry",bs.createVertex(e,Vn.STATIC_DRAW,n.buffer)]]))}_computeScreenRimWidth(e,i,r,n){return xe(eT,n.center,n.v2),ue(VD,eT,this._outerRimFactor),SU(I8,i,eT,r),qce(eT,I8,e.projectionMatrix,e.viewport,eT),qce(VD,I8,e.projectionMatrix,e.viewport,VD),Nr(eT,VD)/e.height}};function lge(t,e,i,r,n){const s=Fe(t),o=r*Math.sqrt(s*s-r*r)/s,a=Math.sqrt(r*r-o*o),l=n.v1,c=n.v2;return ue(n.center,t,a/s),Ot(l,t,e),No(l)<1&&Ot(l,t,i),ue(l,l,o/Fe(l)),Ot(c,l,t),ue(c,c,o/Fe(c)),o}NY=u([L("esri.views.3d.environment.MarsAtmosphere")],NY);const I8=ut(),eT=A(),VD=A();function Dwt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const cge=Zc().vec3f(k.POSITION),Nwt=NY;function Fwt(t,e,i){_Ie(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function _Ie(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return t;const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],h=i[5],p=i[6],g=i[8],y=i[9],w=i[10],b=i[12],x=i[13],T=i[14];let M=0,$=0;for(let R=0;R<s;R++){const I=e[M],P=e[M+1],N=e[M+2];t[$]=o*I+c*P+g*N+b,t[$+1]=a*I+h*P+y*N+x,t[$+2]=l*I+p*P+w*N+T,M+=n,$+=r}return t}function vIe(t,e,i){wIe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function wIe(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return;const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],h=i[4],p=i[5],g=i[6],y=i[7],w=i[8];let b=0,x=0;for(let T=0;T<s;T++){const M=e[b],$=e[b+1],R=e[b+2];t[x]=o*M+c*$+g*R,t[x+1]=a*M+h*$+y*R,t[x+2]=l*M+p*$+w*R,b+=n,x+=r}}function kwt(t,e,i){bIe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function bIe(t,e,i,r=3,n=r){const s=Math.min(t.length/r,e.length/n);let o=0,a=0;for(let l=0;l<s;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=n,a+=r;return t}function Uwt(t,e,i,r=3,n=r){const s=t.length/r;if(s!==Math.ceil(e.length/n))return t;let o=0,a=0;for(let l=0;l<s;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=n,a+=r;return t}function zwt(t,e){xIe(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function xIe(t,e,i=3,r=i){const n=Math.min(t.length/i,e.length/r);let s=0,o=0;for(let a=0;a<n;a++){const l=e[s],c=e[s+1],h=e[s+2],p=l*l+c*c+h*h;if(p>0){const g=1/Math.sqrt(p);t[o]=g*l,t[o+1]=g*c,t[o+2]=g*h}s+=r,o+=i}}function Vwt(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<r;h++)n[c]=o[l]>>i,n[c+1]=o[l+1]>>i,n[c+2]=o[l+2]>>i,l+=a,c+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:xIe,normalizeView:zwt,scale:bIe,scaleView:kwt,shiftRight:Vwt,transformMat3:wIe,transformMat3View:vIe,transformMat4:_Ie,transformMat4View:Fwt,translate:Uwt},Symbol.toStringTag,{value:"Module"}));function Bwt(t,e){vie(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function vie(t,e,i=3,r=i){const n=e.length/r;let s=0,o=0;for(let a=0;a<n;++a)t[s]=e[o],t[s+1]=e[o+1],t[s+2]=e[o+2],s+=i,o+=r}function jwt(t,e,i,r,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=i,s[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:vie,copyView:Bwt,fill:jwt},Symbol.toStringTag,{value:"Module"}));let Gwt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const i=this._indexRanges;let r=0,n=i.length/2;if(e<i[2*r]||e>i[2*n]+i[2*n+1])return!1;for(;n-r>0;){const s=Math.floor(.5*(r+n)),o=i[2*s];if(e<o){if(n-r==1)return!1;n=s;continue}if(e<o+i[2*s+1])return!0;if(n-r==1)return!1;r=s+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Hwt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r],s=n+i[r+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r];if(!e(n,n+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let n=0;n<r.length;n+=2){const s=r[n],o=s+r[n+1],a=e[s],l=e[o];i[n]=a,i[n+1]=l-a}return i}};function Hwt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let n=1;n<t.length;n++){const s=t[n];i+r===s?r+=1:(e.push(i),e.push(r),i=s,r=1)}return e.push(i),e.push(r),e}let qwt=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.highlightGroups=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRangesMap=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new Gwt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let n=0;n<r;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRangesMap)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRangesMap=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRangesMap==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null&&this.highlightGroups!=null){const{highlightRangesMap:e,defaultRanges:i}=Wwt(this.highlightCounts,this.highlightGroups,this.visibility,this.offsets);this.cachedHighlightRangesMap=e,this.cachedDefaultRanges=i}}};function Wwt(t,e,i,r){const n=new Map,s=[];let o=r.length;return i.forEachComponent(a=>{if(t[a]>0){const l=e[a];let c=n.get(l);c===void 0&&(c=[],n.set(l,c));const h=r[a],p=r[a+1];c.push(h),c.push(p-h)}else o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a;return!0}),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRangesMap:n,defaultRanges:s}}let Zwt=class{constructor(e,i,r,n,s,o){this.transform=e,this.toMapSpace=i,this.obb=r,this.components=n,this.renderable=s,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=Ye(this.intersectionGeometry),this.renderable=Ye(this.renderable),this.components=Ye(this.components)}};function Ywt(t,e,i,r,n,s,o){const a=s-o,l=e-t,c=new Float64Array(4*l);for(let h=0;h<l;++h){const p=3*(h+t),g=n*i[p+0],y=r[g+0],w=r[g+1],b=a/(r[g+2]-o),x=y*b,T=w*b,M=n*i[p+1],$=r[M+0],R=r[M+1],I=a/(r[M+2]-o),P=$*I,N=R*I,V=n*i[p+2],U=r[V+0],B=r[V+1],W=a/(r[V+2]-o),j=U*W,Q=B*W,Z=4*h;c[Z+0]=Math.min(x,P,j),c[Z+1]=Math.min(T,N,Q),c[Z+2]=Math.max(x,P,j),c[Z+3]=Math.max(T,N,Q)}return c}function Xwt(t,e,i,r,n){const s=e-t,o=new Float64Array(4*s);for(let a=0;a<s;++a){const l=3*(a+t),c=n*i[l+0],h=r[c+0],p=r[c+1],g=n*i[l+1],y=r[g+0],w=r[g+1],b=n*i[l+2],x=r[b+0],T=r[b+1],M=4*a;o[M+0]=Math.min(h,y,x),o[M+1]=Math.min(p,w,T),o[M+2]=Math.max(h,y,x),o[M+3]=Math.max(p,w,T)}return o}function Jwt(t,e){return new(Qwt(t))(e)}function Qwt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}let SIe=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=Qe(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(e[2]-a);i=e[0]*l,r=e[1]*l}const{_bspNodes:n}=this;let s=0;for(;s>=0;){const o=n[s],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:h,maxMidIndexIndex:p,maxIndexIndex:g,aabb2D:y}=o;if(i<y[0]||i>y[2]||r<y[1]||r>y[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,g);break}{this._intersectRange(h,p);const w=(l===0?i:r)-a;if(w<0){if(o.child0===-1){this._intersectRange(c,h);break}s=o.child0}else{if(!(w>0))break;if(o.child1===-1){this._intersectRange(p,g);break}s=o.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],n=e[1],s=i[0],o=i[1];const{geometryMinZ:a}=this;if(!this.localMode){let w=0,b=1;const x=Math.min(.5*this.planetCenterZ,a),T=e[2],M=i[2];if(T<x&&M<x||(T<x&&(w=(x-T)/(M-T)),M<x&&(b=(x-T)/(M-T)),w>b))return;const $=(1-w)*e[0]+w*i[0],R=(1-w)*e[1]+w*i[1],I=(1-w)*e[2]+w*i[2],P=(1-b)*e[0]+b*i[0],N=(1-b)*e[1]+b*i[1],V=(1-b)*e[2]+b*i[2],{planetCenterZ:U}=this,B=a-U,W=B/(I-U);r=$*W,n=R*W;const j=B/(V-U);s=P*j,o=N*j}const l=s-r,c=o-n,h=this._bspNodes;let p=1;{const{aabb2D:w}=h[0],b=(M,$,R,I)=>{if(Math.abs($)<1e-5*Math.max(I-R,1))return!1;const P=$>0,N=P?I:R,V=M+p*$;return(P?V<N:V>N)&&(p=Math.max((N-M)/$,p),!0)},x=()=>b(r,l,w[0],w[2]),T=()=>b(n,c,w[1],w[3]);Math.abs(l)>=Math.abs(c)?x()||T():T()||x()}const g=[0,0,p];let y=0;for(;y<g.length;){const w=g[y];let b=g[y+1],x=g[y+2];if(y+=3,b>x)continue;const T=h[w],{minIndexIndex:M,maxIndexIndex:$}=T,{child0:R,child1:I,minMidIndexIndex:P,maxMidIndexIndex:N,aabb2D:V,d:U,dim:B}=T;{const W=r+b*l,j=r+x*l,Q=Math.min(W,j),Z=Math.max(W,j),X=V[0],ge=V[2];if(Z<X||ge<Q)continue;if(Q<X){const ae=(X-r)/l;l>0?b=Math.max(b,ae):x=Math.min(x,ae)}if(ge<Z){const ae=(ge-r)/l;l>0?x=Math.min(x,ae):b=Math.max(b,ae)}}{const W=n+b*c,j=n+x*c,Q=Math.min(W,j),Z=Math.max(W,j),X=V[1],ge=V[3];if(Z<X||ge<Q)continue;if(Q<X){const ae=(X-n)/c;c>0?b=Math.max(b,ae):x=Math.min(x,ae)}if(ge<Z){const ae=(ge-n)/c;c>0?x=Math.min(x,ae):b=Math.max(b,ae)}}if(R===-1&&I===-1)this._intersectRange(M,$);else{const W=B===0?r:n,j=B===0?l:c,Q=W+b*j,Z=W+x*j,X=Math.min(Q,Z),ge=Math.max(Q,Z),ae=Oe((U-W)/j,0,p);M<P&&X<=U&&(R!==-1?(g.push(R),g.push(j>=0?b:Math.max(b,ae)),g.push(j>=0?Math.min(x,ae):x)):this._intersectRange(M,P)),this._intersectRange(P,N),N<$&&U<=ge&&(I!==-1?(g.push(I),g.push(j>=0?Math.max(b,ae):b),g.push(j>=0?x:Math.min(x,ae))):this._intersectRange(N,$))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=Jwt(e,e);this._elementIndexMap=i;for(let y=0;y<e;++y)i[y]=y;const r=this.model.getAabbs2D();let n=0;const s=this._bspNodes;s.length=0;const{localMode:o}=this;let a=!1;if(!o){const{planetCenterZ:y,geometryMinZ:w}=this;a=y>=0||w<.5*y}const l=[],c=(y,w,b,x,T)=>{l.push(y),l.push(w),l.push(b),l.push(x<0?-1:(T?0:1)+2*x)},{maxBspNodeDepth:h,minBspNodeElementCount:p}=this,g=(y,w,b,x,T)=>{const M=s.length;if(M>0&&(a||b>=h||w-y<p))return;const $=[0,0,0,0];ibt($,y,w,i,r);const{d:R,dim:I}=o?Kwt($):ebt($),{rangeMidStart:P,rangeMidEnd:N}=tbt(y,w,I,R,i,r),V=b===h-1,U=!V&&P>=y+p,B=!V&&w>=N+p;if(U||B||M===0){const W=new rbt(y,P,N,w,I,R,$);if(U&&c(y,P,b+1,M,!0),B&&c(N,w,b+1,M,!1),s.push(W),x!==-1){const j=s[x];T?j.child0=M:j.child1=M}}};for(c(0,e,0,-1,!1);n<l.length;){const y=l[n],w=l[n+1],b=l[n+2],x=l[n+3];n+=4;const T=x>>1;g(y,w,b,T,x-(T<<1)==0)}this._generatedBVH=!0}};function Kwt(t){const e=t[0],i=t[1],r=t[2],n=t[3];let s,o;return r-e>=n-i?(o=.5*(e+r),s=0):(o=.5*(i+n),s=1),{d:o,dim:s}}function ebt(t){const e=t[0],i=t[1],r=t[2],n=t[3];let s,o;return r-e>=n-i?(s=0,o=.5*(e+r)):(s=1,o=.5*(i+n)),{dim:s,d:o}}function tbt(t,e,i,r,n,s){let o=t;{let h=e;for(;o<h;){const p=n[o];uge(p,i,r,s)<0?++o:(--h,n[o]=n[h],n[h]=p)}}const a=o;let l=o,c=e;for(;l<c;){const h=n[c-1];uge(h,i,r,s)>0?--c:(n[c-1]=n[l],n[l]=h,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function uge(t,e,i,r){const n=4*t,s=r[n+0+e];return r[n+2+e]<i?-1:s>i?1:0}function ibt(t,e,i,r,n){let s=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=e;c<i;++c){const h=4*r[c];s=Math.min(s,n[h+0]),o=Math.min(o,n[h+1]),a=Math.max(a,n[h+2]),l=Math.max(l,n[h+3])}t[0]=s,t[1]=o,t[2]=a,t[3]=l}let rbt=class{constructor(e,i,r,n,s,o,a){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=n,this.dim=s,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}},nbt=class{constructor(e,i,r,n,s,o,a,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=n,this.startTriangleNumber=s,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=A(),this.ray0=A(),this.isVerticalRay=!1,this._triangleHitCallback=hge,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new SIe(o-s,this)}getAabbs2D(){return this.localMode?Xwt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):Ywt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,n,s,o){ye(this.ray0,e),nr(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=n,this.normalRequired=o,this._triangleHitCallback=s,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=hge}intersectRange(e,i){const r=this._bvh.elementIndexMap;TIe(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function TIe(t,e,i,r,n,s,o,a,l,c,h,p=null,g=0){a!==0?Lct(t,e,i,r,n,s,o,a,l,c,h,p,g):LOe(t,e,i,r,n,s,o,c,h,p,g)}function hge(){}function sbt(t,e,i,r){if(i>=e)return t;t==null&&(t=obt());const n=t.isVisibleBit;let s=t.data;const o=EIe(s),a=i/o|0,l=i-o*a,c=(e-1)/o|0,h=s,p=r===n;if(!(i<h.length*o)&&p){const g=a+1,y=Math.ceil(h.length*Qk),w=c+1;let b=Math.max(g,y);b=Math.min(b,w),s=new Uint32Array(b),s.set(h)}return a<s.length&&(s[a]=lbt(s[a],l,p)),t.data=s,t}function FY(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,n=EIe(r);return e<r.length*n?abt(i,r,e,n):!t.isVisibleBit}function obt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function abt(t,e,i,r){const n=i/r|0,s=i-n*r;return cbt(e[n],s)===t}function EIe(t){return t.BYTES_PER_ELEMENT*8}function lbt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function cbt(t,e){return!!(t&1<<e)}let ubt=class{constructor(e,i,r,n,s,o,a,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=n,this._componentAabbs3D=s,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=fbt,this._ray1=mbt,this._invDir=A(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=gbt,this._callback=dge,this.rayDirectionC=A(),this._componentIndexMap=null,this._bvh=new SIe(n.count,this),this.componentIntersectionData=new Array(n.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,n=new Float64Array(4*e),s=this._componentAabbs3D;for(let o=0;o<e;++o){const a=6*o,l=s[a+0],c=s[a+1],h=s[a+2],p=s[a+3],g=s[a+4],y=r/(h-i),w=r/(s[a+5]-i),b=Math.min(l*y,l*w),x=Math.min(c*y,c*w),T=Math.max(p*y,p*w),M=Math.max(g*y,g*w),$=4*o;n[$+0]=b,n[$+1]=x,n[$+2]=T,n[$+3]=M}return n}getAabbs2DLocal(){const{numComponents:e}=this,i=new Float64Array(4*e),r=this._componentAabbs3D;for(let n=0;n<e;++n){const s=6*n,o=r[s+0],a=r[s+1],l=r[s+3],c=r[s+4],h=4*n;i[h+0]=o,i[h+1]=a,i[h+2]=l,i[h+3]=c}return i}intersectRay(e,i,r,n,s,o,a){const{isVerticalRay:l}=a;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=n,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,zct(e,i,this._invDir),this._callback=s,this._bvh.intersectRay(e,i,l),this._callback=dge}intersectRange(e,i){const r=this._componentIndexMap,n=this._components,s=n.pickability,o=n.visibility;for(let a=e;a<i;++a){const l=r?r[a]:a;FY(s,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,n=6*e;return i[0]=r[n],i[1]=r[n+1],i[2]=r[n+2],i[3]=r[n+3],i[4]=r[n+4],i[5]=r[n+5],i}_intersectComponent(e){if(!FY(this._components.pickability,e))return;const i=this.getComponentAabb3D(e,hbt);let r=!1;const{localMode:n,_componentVerticalOffsets:s,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:h,_tolerance:p,rayDirectionC:g,componentIntersectionData:y}=this,{isVerticalRay:w}=this._intersectionOptions,b=this._components.offsets,x=ye(dbt,a),T=ye(pbt,l),M=(s==null?void 0:s[e])??0,$=M+((o==null?void 0:o.offset)??0);if($!==0&&(n?(x[2]=a[2]-$,T[2]=l[2]-$,r=!0):o!=null&&(o.componentOffset=M)),o==null||r||$===0||o.applyToAabb(i),!NOe(i,x,c,p))return;nr(g,T,x);const R=b[e]/3,I=b[e+1]/3,P=I-R,N=(Q,Z,X)=>{this._callback(Q,Z,e,X)},{vertexData:V,vertexStride:U,indexData:B,_intersectionOptions:W}=this,{normalRequired:j}=W;if(P>ybt){let Q=y[e];Q==null&&(Q=new nbt(e,V,U,B,R,I,this.geometryMinZ,h,n),y[e]=Q),Q.intersectRay(x,T,w,r?0:$,N,j)}else TIe(x,g,R,I,B,V,U,r?0:$,h,j,N)}};const hbt=bd(),dbt=A(),pbt=A(),fbt=A(),mbt=A(),dge=()=>{},gbt=new Qz,ybt=40;let _bt=class{constructor(e,i,r){this.viewingMode=e,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=A(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?Qee(i.indices):pI(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),n=6*e;return i[0]=r[n],i[1]=r[n+1],i[2]=r[n+2],i[3]=r[n+3],i[4]=r[n+4],i[5]=r[n+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,n,s,o,a,l){this.verticalOffset=n,this.componentVerticalOffsets=s;const{position:c}=o,h=nr(vbt,e,c),p=nr(wbt,i,c),g=YC(bbt,o.rotationScale);Zl(h,h,g),Zl(p,p,g);const y=wx(Sbt,g);if(this.viewingMode===ct.Global){const b=this._planetCenter;od(b,c),Zl(b,b,g)}const w=(b,x,T,M)=>{l(T,b,M?Zl(xbt,M,y):null,x)};this._intersectComponents(h,p,s,n,w,r,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),n=.5*(e[2]+e[5]),s=this._components.count,o=zu(6*s),a=this._indices,l=this._positions,c=this._components.offsets;let h=0,p=1/0,g=1/0,y=1/0,w=-1/0,b=-1/0,x=-1/0;for(let T=0;T<s;T++){const M=c[T],$=c[T+1];let R=1/0,I=1/0,P=1/0,N=-1/0,V=-1/0,U=-1/0;if(M<$)for(let B=M;B<$;B++){const W=3*a[B],j=l[W],Q=l[W+1],Z=l[W+2];R=Math.min(R,j),I=Math.min(I,Q),P=Math.min(P,Z),N=Math.max(N,j),V=Math.max(V,Q),U=Math.max(U,Z)}else R=i,I=r,P=n,N=i,V=r,U=n;o[h++]=R,o[h++]=I,o[h++]=P,o[h++]=N,o[h++]=V,o[h++]=U,p=Math.min(p,R),g=Math.min(g,I),y=Math.min(y,P),w=Math.max(w,N),b=Math.max(b,V),x=Math.max(x,U)}return this._aabb[0]=p,this._aabb[1]=g,this._aabb[2]=y,this._aabb[3]=w,this._aabb[4]=b,this._aabb[5]=x,o}_intersectComponents(e,i,r,n,s,o,a){let l=this._componentBvh;l==null&&(l=new ubt(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(e,i,r,n,s,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===ct.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const vbt=A(),wbt=A(),bbt=In(),xbt=A(),Sbt=In();let Tbt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},Ebt=class{constructor(e,i,r,n){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=n}dispose(){this.vao.dispose()}},wie=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function Cbt(t,e){return{near:t,far:e}}function TI(t){return Cbt(1/0,-1/0)}function Wk(t,e,i){return t.near=e,t.far=i,t}function EC(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function BD(t,e){return t.near<=e&&e<=t.far}const kY={near:0,far:0};function Mbt(t,e){const i=TI(),{eye:r,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=Te(nr(yu,a.center,r),s),c=a.projectedRadius(s);if(BD(i,l-c)&&BD(i,l+c))return;const h=Ibt(a,n);if(h===-1)return;if(h===0)return sg.far=l+c,sg.near=l-c,void EC(i,sg);const p=jD.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<jD.length;o++){const a=jD.data[o];if(BD(i,a.near)&&BD(i,a.far))continue;sg.far=a.far,sg.near=1/0,Rbt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,$bt,c=>{let h=Obt;for(let p=0;p<CIe&&c.length>0;p++){if(!(a.mask&1<<p))continue;Abt(n[p],c,h);const g=c;c=h,h=g}for(let p=0;p<c.length;p+=3){ve(Ul,c.data[p],c.data[p+1],c.data[p+2]);const g=Te(nr(Ul,Ul,r),s);sg.near=Math.min(sg.near,g)}})===0&&(sg.near=0),EC(i,sg)}return jD.length=0,i}const jD=new mi({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),sg=TI(),Ul=A(),B1=A(),$bt=new mi({deallocator:null}),Obt=new mi({deallocator:null});function Abt(t,e,i){i.length=0;const r=e.length-3;P8(Ul,e,r);const n=us(t,Ul);n<=0&&(i.push(Ul[0]),i.push(Ul[1]),i.push(Ul[2]));let s=0,o=n;for(;s<r;s+=3){P8(B1,e,s);const a=us(t,B1);o*a<0&&(br(Ul,B1,Ul,a/(a-o)),zl(i,Ul)),a<=0&&zl(i,B1),o=a,ye(Ul,B1)}o*n<0&&(P8(B1,e,r),br(Ul,B1,Ul,n/(n-o)),zl(i,Ul))}function P8(t,e,i){return ve(t,e.data[i],e.data[i+1],e.data[i+2])}function zl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function Rbt(t,e,i,r){dv(fge,t.quaternion),nr(yu,e,t.center),Ac(yu,yu,fge);const n=t.halfSize,s=8*((yu[0]<-n[0]?-1:yu[0]>n[0]?1:0)+3*(yu[1]<-n[1]?-1:yu[1]>n[1]?1:0)+9*(yu[2]<-n[2]?-1:yu[2]>n[2]?1:0)+13),o=pge[s];if(o===0)return o;GR(GD,t.quaternion),ez(GD,GD,t.halfSize);const a=(l,c)=>{const h=pge[s+c+1];return ve(l,((1&h)<<1)-1,(2&h)-1,((4&h)>>1)-1),Zl(l,l,GD),xe(l,t.center,l)};return i.length=0,zl(i,a(L8,0)),zl(i,a(mge,1)),zl(i,a(yu,2)),zl(i,a(gge,3)),r(i),o===1||(i.length=0,zl(i,L8),zl(i,gge),zl(i,a(yu,4)),zl(i,a(yge,5)),r(i),o===2||(i.length=0,zl(i,L8),zl(i,yge),zl(i,a(yu,6)),zl(i,mge),r(i))),o}const pge=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),CIe=4;function Ibt(t,e){let i=0;for(let r=0;r<CIe;r++){const n=t.intersectPlane(e[r]);if(n>0)return-1;n===0&&(i|=1<<r)}return i}const GD=In(),fge=vd(),yu=A(),L8=A(),mge=A(),gge=A(),yge=A();let Pbt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?Mbt(e,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some(e=>e.renderable.material.hasEmissions)}},V8t=class extends Ar{constructor(e,i,r,n,s){super(),this.colors=e,this.textureCoordinates=i,this.hasNormals=r,this.shadeNormals=n,this.applySSAO=s}};function Lbt(t){const e=Zc().vec3f(k.POSITION);return t.hasNormals&&e.vec2i16(k.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===ts.Default?e.vec2f(k.UV0):t.textureCoordinates===ts.Atlas&&(e.vec2f(k.UV0),e.vec4u16(k.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(k.COLOR,{glNormalized:!0}),e}let Dbt=class{constructor(){this.externalColor=Ti(),this.externalColorMixMode=Vs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var Nc;function Nbt(t,e){const i=t.vertex;switch(i.code.add(C`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Nc.None:i.code.add(C`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Nc.Opaque:i.code.add(C`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Nc.Transparent:i.code.add(C`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Nc.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Nc||(Nc={}));var mm;function G8t(t){return t&&LC(t)?mm.Mars:t&&DC(t)?mm.Moon:mm.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(mm||(mm={}));var Jh;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Jh||(Jh={}));let Ir=class extends Zu{constructor(e,i){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=i,this.output=J.Color,this.textureCoordinateType=ts.None,this.componentData=fm.Uniform,this.cullFace=ic.Back,this.vertexDiscardMode=Nc.None,this.doubleSidedMode=eo.WindingOrder,this.alphaDiscardMode=Ks.Opaque,this.integratedMeshMode=Jh.None,this.oitPass=qi.NONE,this.ellipsoidMode=mm.Earth,this.pbrMode=Ut.Disabled,this.normalType=an.Attribute,this.emissionSource=ko.None,this.hasVertexColors=!1,this.hasNormals=!1,this.shadeNormals=!0,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.screenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasNormalTextureTransform=!1,this.cloudReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.discardInvisibleFragments=!1,this.occlusionPass=!1,this.bindType=Fi.Draw,this.hasSliceHighlight=!0,this.hasSliceInVertexProgram=!1,this.useCustomDTRExponentForWater=!1,this.hasVertexTangents=!1,this.highStepCount=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.useFillLights=!0,this.objectAndLayerIdColorInstanced=!1,this.canHaveOverlay=!0}};u([le({count:J.COUNT})],Ir.prototype,"output",void 0),u([le({count:ts.COUNT})],Ir.prototype,"textureCoordinateType",void 0),u([le({count:fm.COUNT})],Ir.prototype,"componentData",void 0),u([le({count:ic.COUNT})],Ir.prototype,"cullFace",void 0),u([le({count:Nc.COUNT})],Ir.prototype,"vertexDiscardMode",void 0),u([le({count:eo.COUNT})],Ir.prototype,"doubleSidedMode",void 0),u([le({count:Ks.COUNT})],Ir.prototype,"alphaDiscardMode",void 0),u([le({count:Jh.COUNT})],Ir.prototype,"integratedMeshMode",void 0),u([le({count:qi.COUNT})],Ir.prototype,"oitPass",void 0),u([le({count:mm.COUNT})],Ir.prototype,"ellipsoidMode",void 0),u([le({count:Ut.COUNT})],Ir.prototype,"pbrMode",void 0),u([le({count:an.COUNT})],Ir.prototype,"normalType",void 0),u([le({count:ko.COUNT})],Ir.prototype,"emissionSource",void 0),u([le()],Ir.prototype,"hasVertexColors",void 0),u([le()],Ir.prototype,"hasNormals",void 0),u([le()],Ir.prototype,"shadeNormals",void 0),u([le()],Ir.prototype,"hasSlicePlane",void 0),u([le()],Ir.prototype,"hasColorTexture",void 0),u([le()],Ir.prototype,"receiveAmbientOcclusion",void 0),u([le()],Ir.prototype,"receiveShadows",void 0),u([le()],Ir.prototype,"blendingEnabled",void 0),u([le()],Ir.prototype,"screenSpaceReflections",void 0),u([le()],Ir.prototype,"hasPolygonOffset",void 0),u([le()],Ir.prototype,"hasMetallicRoughnessTexture",void 0),u([le()],Ir.prototype,"hasOcclusionTexture",void 0),u([le()],Ir.prototype,"hasNormalTexture",void 0),u([le()],Ir.prototype,"hasOccludees",void 0),u([le()],Ir.prototype,"terrainDepthTest",void 0),u([le()],Ir.prototype,"cullAboveTerrain",void 0),u([le()],Ir.prototype,"hasNormalTextureTransform",void 0),u([le()],Ir.prototype,"cloudReflections",void 0),u([le()],Ir.prototype,"snowCover",void 0),u([le()],Ir.prototype,"objectAndLayerIdColor",void 0);function _ge(t,e){const i=t.fragment;switch(e.doubleSidedMode){case eo.None:i.code.add(C`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case eo.View:t.include(nR,e),i.code.add(C`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case eo.WindingOrder:i.code.add(C`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case eo.COUNT:}switch(e.normalType){case an.Attribute:case an.Compressed:t.include(eV,e),i.main.add(C`vec3 fragmentFaceNormal = _adjustDoublesided(normalize(vNormalWorld));
vec3 fragmentFaceNormalView = gl_FrontFacing ? normalize(vNormalView) : -normalize(vNormalView);`);break;case an.ScreenDerivative:t.include(nR,e),i.main.add(C`vec3 fragmentFaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
vec3 fragmentFaceNormalView = normalize(cross(dFdx(vPosition_view), dFdy(vPosition_view)));`);default:case an.COUNT:}e.shadeNormals?i.main.add(C`vec3 fragmentShadingNormal = fragmentFaceNormal;`):e.spherical?(t.include(nR,e),i.main.add(C`vec3 fragmentShadingNormal = normalize(positionWorld());`)):i.main.add(C`vec3 fragmentShadingNormal = vec3(0.0, 0.0, 1.0);`)}function Fbt(t,e){t.include(iV,e),t.fragment.include(_te);const i=t.fragment;i.uniforms.add(new c3("baseColor",r=>r.baseColor)),i.uniforms.add(new HOe("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(C`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(C`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(C`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function kbt(t,e){const i=e.hasColorTexture&&(yd(e.output)||e.alphaDiscardMode!==Ks.Opaque);i&&(t.include(Yz,e),t.fragment.uniforms.add(new $m("baseColorTexture",r=>r.texture))),t.fragment.code.add(C`
    vec4 readBaseColorTexture() {
      return ${i?"textureLookup(baseColorTexture, vuv0)":"vec4(1.0)"};
    }
  `)}function MIe(t){const e=new or;e.include(nR,t),e.include(eV,t),e.include(iV,t),e.include(oy,t),e.include(tV,t),e.include(vct,t),e.include(tut,t),e.include(Not,t),e.include(kbt,t),e.include(Nbt,t);const{vertex:i,fragment:r}=e,{output:n,pbrMode:s,hasNormalTexture:o,snowCover:a,receiveShadows:l,spherical:c,ellipsoidMode:h}=t,p=s===Ut.Normal||s===Ut.Schematic;p&&(e.include(ate,t),o&&e.include(ZOe,t));const g=n===J.Shadow||n===J.ShadowHighlight||n===J.ShadowExcludeHighlight,y=g&&t.componentData===fm.Varying;i.code.add(`#define discardShadows(castShadows) { ${Ge(y,"if(!castShadows) { gl_Position = vec4(vec3(1e38), 1.0); return; }")} }`);const w=t.integratedMeshMode===Jh.ColorOverlay||t.integratedMeshMode===Jh.ColorOverlayWithWater;if(w){e.include(wC,t),e.include(Yyt,t);const R=h===mm.Earth,I=h===mm.Earth,P=R?Ii.radius:I?Bp.radius:vy.radius;i.code.add(`
      ${Ge(c,`const float invRadius = ${C.float(1/P)};`)}
      vec2 projectOverlay(vec3 pos) { return pos.xy ${Ge(c,"/ (1.0 + invRadius * pos.z);")}; }`)}const b=w&&yd(n)&&s===Ut.WaterOnIntegratedMesh;if(b&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.main.add(C`
    bool castShadows;
    vec4 externalColor = forwardExternalColor(castShadows);
    discardShadows(castShadows);

    vertexDiscardByOpacity(externalColor.a);

    ${n===J.ObjectAndLayerIdColor?C`externalColor.a = 1.0;`:""}

    if (externalColor.a < ${C.float(fn)}) {
      // Discard this vertex
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }

    forwardPosition(readElevationOffset());
    forwardNormal();
    forwardTextureCoordinates();
    forwardVertexColor();
    forwardLinearDepth();
    forwardObjectAndLayerIdColor();
    ${b?c?C`
              groundNormal = normalize(positionWorld());
              tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
              tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:C`
              groundNormal = vec3(0.0, 0.0, 1.0);
              tbnTangent = vec3(1.0, 0.0, 0.0);
              tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
    ${w?C`setOverlayVTC(projectOverlay(position));`:""}
  `),yd(n))return e.include(hI,t),e.include(Fbt,t),e.include(_ge,t),e.include(wC,t),e.include(aV,t),l&&e.include(mI,t),r.code.add(C`
      float evaluateShadow() {
        return ${l?"readShadowMap(vPositionWorldCameraRelative, linearDepth)":"0.0"};
      }`),w&&r.uniforms.add(new ht("ovColorTex",(R,I)=>jRe(R,I))),r.main.add(C`
      discardBySlice(vPositionWorldCameraRelative);
      terrainDepthTest(vPosition_view.z);

      vec4 textureColor = readBaseColorTexture();
      discardOrAdjustAlpha(textureColor);

      vec4 externalColor;
      int externalColorMixMode;
      readExternalColor(externalColor, externalColorMixMode);

      vec4 materialColor = computeMaterialColor(textureColor, externalColor, externalColorMixMode);
      ${w?C`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),p?(Iy(r),c&&vC(r),r.main.add(C`
        applyPBRFactors();
        ${Ge(s===Ut.Normal,C`if (externalColorMixMode == 3) {
              mrr = vec3(0.0, 0.6, 0.2);
            }`)}
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
        ${Ge(o,"mat3 tangentSpace = computeTangentSpace(fragmentShadingNormal, vPositionWorldCameraRelative, vuv0);")}
        vec3 shadingNormal = ${o?"computeTextureNormal(tangentSpace, vuv0)":"fragmentShadingNormal"};
        vec3 normalGround = ${c?C`normalize(positionWorld())`:C`vec3(0.0, 0.0, 1.0)`};

        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${Ge(a,C`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
                 materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                 ssao = mix(ssao, 0.5 * ssao, snow);
                 shadingNormal = mix(shadingNormal, fragmentFaceNormal, snow);`)}
        ${Ge(w,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 emission = getEmissions();
        ${Ge(c,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        ${c?C`float shadow = max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow());`:"float shadow = evaluateShadow();"}
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, shadow, ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(c&&vC(r),b&&r.uniforms.add(new ht("ovNormalTex",(R,I)=>{var P;return(P=I.overlay)==null?void 0:P.getTexture(dr.WaterNormal)})),r.main.add(C`
        ${Ge(c,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        float shadow = ${l?c?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow())":"evaluateShadow()":c?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        ${Ge(a,C`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
               materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)}

        // At global scale we create some additional ambient light based on the main light to simulate global illumination
        float ssao = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());

        ${w?C` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(fragmentShadingNormal, materialColor.rgb, shadow, ssao, additionalLight), materialColor.a);
        ${Ge(b,C`vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
                 float waterNormalLength = length(overlayWaterMask);
                 if (waterNormalLength > 0.95) {
                   mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                   vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                   vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                   // un-gamma the ground color to mix in linear space
                   shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
                 }`)}
      `)),r.main.add(C`outputColorHighlightOID(shadedColor, vPositionWorldCameraRelative);`),e;const x=n===J.Normal,T=n===J.ObjectAndLayerIdColor,M=n===J.Highlight,$=g||n===J.ViewshedShadow;return $&&e.include(pte,t),x&&e.include(_ge,t),e.include(dI,t),r.main.add(C`
    discardBySlice(vPositionWorldCameraRelative);

    vec4 textureColor = readBaseColorTexture();
    discardOrAdjustAlpha(textureColor);

    ${Ge($,"outputDepth(linearDepth);")}
    ${Ge(x,C`fragColor = vec4(vec3(0.5) + 0.5 * fragmentFaceNormalView, 1.0);`)}
    ${Ge(T,w?"fragColor = getOverlayColorTexel(vtcOverlay);":"outputObjectAndLayerIdColor();")}
    ${Ge(M,C`${Ge(w,C`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           outputAllHighlights(overlayHighlightTexel);`,C`calculateOcclusionAndOutputHighlight();`)}`)}`),e}const Ubt=Object.freeze(Object.defineProperty({__proto__:null,build:MIe},Symbol.toStringTag,{value:"Module"}));let zbt=class extends hr{constructor(e,i,r){super(e,i,new ar(Ubt,()=>fe(()=>Promise.resolve().then(()=>bAt),void 0)),r,$Ie)}initializePipeline(e){const{integratedMeshMode:i,output:r,blendingEnabled:n,cullFace:s,hasOccludees:o,hasPolygonOffset:a,oitPass:l}=e,c=i!==Jh.None,h=l===qi.NONE,p=l===qi.FrontFace;return Pi({blending:yd(r)&&n?Hee(l):null,culling:ZEe(s),depthTest:{func:Wee(l)},depthWrite:h||p?tI:null,drawBuffers:r===J.Depth?{buffers:[Fa.NONE]}:Zz(l,r),colorWrite:Qi,stencilWrite:c||o?Sk:null,stencilTest:c?Xct(Hu.IntegratedMeshMaskExcluded):o?hte:null,polygonOffset:h||p?a?{factor:2,units:2}:null:qee})}};const $Ie=new Map([[k.POSITION,0],[k.NORMAL,1],[k.NORMALCOMPRESSED,1],[k.COLOR,2],[k.UV0,3],[k.UVREGION,4],[k.COMPONENTINDEX,5]]);let Vbt=class extends Ar{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},bie=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Rn(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(s){const o=this[r];if(o==null)this[r]=[...s];else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(n){this[r]!==n&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function vge(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let OIe=class{constructor(e){this._low=A(),this._high=A(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ye(this._low,ye(wge,e));const i=nr(wge,e,this._low);ye(this._high,i)}get(e){return xe(e,this._low,this._high)}getLowScaled(e){return ue(e,this._low,1)}};const wge=Dc();let lo=class extends Vbt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=M5(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=IOe,this.emissiveFactor=xm(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new r4,this.componentParameters=new mR,this.textureAlphaCutoff=fn,this.alphaDiscardMode=Ks.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=mm.Earth,this.hasOccludees=!1;const r=new OIe(e.position),n=Gxe(e.rotationScale);YC(n,n),wx(n,n),this.transformNormalGlobalFromModel=n,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){var e;return(e=this.baseColorTexture)==null?void 0:e.glTexture}get textureMetallicRoughness(){var e;return(e=this.metallicRoughnessTexture)==null?void 0:e.glTexture}get textureEmissive(){var e;return(e=this.emissionTexture)==null?void 0:e.glTexture}get hasEmissions(){return this.emissionTexture!=null||!Qs(this.emissiveFactor,ws)}get textureOcclusion(){var e;return(e=this.occlusionTexture)==null?void 0:e.glTexture}get textureNormal(){var e;return(e=this.normalTexture)==null?void 0:e.glTexture}acquireTechnique(e,i,r,n){const s=new Ir(e.context.spherical,e.context.doublePrecisionRequiresObfuscation);s.hasVertexColors=n.colors,s.hasNormals=n.hasNormals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.oitPass=i.identifier===za.Material&&r.oitPass!=null?r.oitPass:qi.NONE,s.terrainDepthTest=i.identifier===za.Material&&r.terrainDepthTest,s.cullAboveTerrain=i.identifier===za.Material&&r.cullAboveTerrain,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?eo.View:eo.None,s.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(s.blendingEnabled=o===hl.Transparent||o===hl.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?Gbt(r)?jbt(r)?Jh.ColorOverlayWithWater:Jh.ColorOverlay:Jh.NoOverlay:Jh.None,s.hasPolygonOffset=this.polygonOffsetEnabled,s.pbrMode=s.integratedMeshMode===Jh.ColorOverlayWithWater?Ut.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?n.shadeNormals&&this.isIntegratedMesh?Ut.Disabled:Ut.Schematic:Ut.Normal:Ut.Disabled,s.emissionSource=this.emissionTexture!=null?ko.Texture:s.pbrMode===Ut.Normal?ko.Value:ko.None,s.shadeNormals=n.shadeNormals,s.normalType=s.hasNormals?an.Compressed:an.ScreenDerivative,s.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===za.ShadowMap)s.output=J.Shadow,s.vertexDiscardMode=Nc.None;else if(i.identifier===za.ViewshedShadowMap)s.output=J.ViewshedShadow,s.vertexDiscardMode=Nc.None;else if(i.identifier===za.Highlight)s.output=J.Highlight,s.vertexDiscardMode=Nc.None;else{switch(o===hl.OpaqueAndTransparent?s.vertexDiscardMode=i.transparent?Nc.Opaque:Nc.Transparent:s.vertexDiscardMode=Nc.None,s.output=i.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,i.output){case J.Color:case J.ColorEmission:s.receiveAmbientOcclusion=n.applySSAO&&r.ssao!=null,s.hasOccludees=r.hasOccludees,s.receiveShadows=r.shadowMap.ready,s.screenSpaceReflections=r.ssr.lastFrameColor!=null,s.cloudReflections=r.clouds.data!=null;break;case J.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(r)}const a=e.acquire(zbt,s);return this._setClean(),a}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const{components:n,renderable:s}=r,{geometry:o}=s,a=s.meta.cameraDepthSquared,{geometryRanges:l,highlightRanges:c,defaultShadowMapRanges:h}=n;switch(this._computeWhichMaterialPass()){case hl.Opaque:e.materialOpaque.submitDraw(this,o,l,a);break;case hl.Transparent:e.materialTransparent.submitDraw(this,o,l,a);break;case hl.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,o,l,a),e.materialTransparent.submitDraw(this,o,l,a);break;case hl.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,o,l,a),Bbt(i)&&e.highlightIntegratedMesh.submitDraw(this,o,l,a)}const p=this.componentParameters.castShadows!==Ys.None;if(p&&e.shadowMap.submitDraw(this,o,l,a),c!=null)for(const g of c)e.highlight.submitDraw(this,o,g[1],a,g[0]),p&&e.highlightShadowMap.submitDraw(this,o,g[1],a,g[0]);i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,o,l,a),p&&h!=null&&e.defaultShadowMap.submitDraw(this,o,h,a)}_computeWhichMaterialPass(){return this.isIntegratedMesh?hl.IntegratedMesh:this.objectOpacity<1?hl.Transparent:this.componentParameters.opaqueOverride===Ys.All?hl.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Ks.Blend||this.alphaDiscardMode===Ks.MaskBlend?hl.Transparent:this.componentParameters.transparent===Ys.None?hl.Opaque:this.componentParameters.transparent===Ys.All?hl.Transparent:hl.OpaqueAndTransparent}};var hl,Ys;u([Rn({vectorOps:hSe})],lo.prototype,"baseColor",void 0),u([Rn()],lo.prototype,"usePBR",void 0),u([Rn()],lo.prototype,"hasParametersFromSource",void 0),u([Rn({vectorOps:Zae})],lo.prototype,"mrrFactors",void 0),u([Rn({vectorOps:Zae})],lo.prototype,"emissiveFactor",void 0),u([Rn({dispose:!0})],lo.prototype,"baseColorTexture",void 0),u([Rn({dispose:!0})],lo.prototype,"metallicRoughnessTexture",void 0),u([Rn({dispose:!0})],lo.prototype,"emissionTexture",void 0),u([Rn({dispose:!0})],lo.prototype,"occlusionTexture",void 0),u([Rn({dispose:!0})],lo.prototype,"normalTexture",void 0),u([Rn()],lo.prototype,"objectOpacity",void 0),u([vge()],lo.prototype,"commonMaterialParameters",void 0),u([vge()],lo.prototype,"componentParameters",void 0),u([Rn()],lo.prototype,"textureAlphaCutoff",void 0),u([Rn()],lo.prototype,"alphaDiscardMode",void 0),u([Rn()],lo.prototype,"isIntegratedMesh",void 0),u([Rn()],lo.prototype,"polygonOffsetEnabled",void 0),u([Rn()],lo.prototype,"ellipsoidMode",void 0),u([Rn()],lo.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(hl||(hl={}));let r4=class extends bie{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=ic.Back,this.hasSlicePlane=!0}};u([Rn()],r4.prototype,"doubleSided",void 0),u([Rn()],r4.prototype,"cullFace",void 0),u([Rn()],r4.prototype,"hasSlicePlane",void 0);let mR=class extends bie{constructor(){super(...arguments),this.externalColor=Ri(1,1,1,1),this.externalColorMixMode=Vs.Multiply,this.castShadows=Ys.All}get transparent(){return this.externalColor[3]<1?Ys.All:Ys.None}get opaqueOverride(){return this.externalColorMixMode===Vs.Replace&&this.externalColor[3]===1?Ys.All:Ys.None}get visible(){return this.externalColor[3]>0?Ys.All:Ys.None}get type(){return fm.Uniform}};u([Rn({vectorOps:hSe})],mR.prototype,"externalColor",void 0),u([Rn()],mR.prototype,"externalColorMixMode",void 0),u([Rn()],mR.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Ys||(Ys={}));let lA=class extends bie{constructor(){super(...arguments),this.texture=null,this.transparent=Ys.None,this.opaqueOverride=Ys.None,this.castShadows=Ys.None}get type(){return fm.Varying}};function Bbt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(dr.Highlight))!=null}function jbt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(dr.WaterNormal))!=null}function Gbt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(dr.ColorNoRasterImage))!=null}u([Rn()],lA.prototype,"texture",void 0),u([Rn()],lA.prototype,"transparent",void 0),u([Rn()],lA.prototype,"opaqueOverride",void 0),u([Rn()],lA.prototype,"castShadows",void 0);let Hbt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},qbt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new jr(this.textureWidth,1);r.samplingMode=Mi.NEAREST,r.wrapMode=Tr.CLAMP_TO_EDGE,this._texture=new fr(this._rctx,r),this._data=new Wc(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,n,s,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,i,r,n){const s=e*this._fieldCount+i;this._dirty=!0,this._data.set(s,r,n)}getDataElement(e,i,r){const n=e*this._fieldCount+i;return this._dirty=!0,this._data.get(n,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,n=new Wc(new ArrayBuffer(4*r));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const AIe=65536;let Wbt=class{constructor(e,i=1){this.textureBuffer=new qbt(e,i),this._indexManager=new Hbt(AIe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},Zbt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>AIe)return null;const i=new Wbt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const bge=()=>de.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let Ybt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new mi,this._hidden=new mi,this._renderSubmit=new Pbt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new Zbt(e.rctx,2+(_d()?1:0))}destroy(){St(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const i=e.geometry,r=new qwt(this._componentBufferManager,Qee(i.componentOffsets)),n=this._createRenderable(e,r),s=new _bt(this._viewingMode,i.positionData,r),o=new Zwt(e.transform,e.toMapSpace,e.obb.clone(),r,n,s);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=to(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount;return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,n=r.renderable.material,s=r.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new Dbt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let g=0,y=0,w=0,b=s.verticalOffsets,x=1/0,T=-1/0,M=!1,$=!1,R=0;for(let I=0;I<s.count;I++){i(I,l),g+=+(l.externalColor[3]<1),y+=+(l.externalColorMixMode===Vs.Replace&&l.externalColor[3]===1),w+=+l.castShadows,fct(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[I],0,h[0],h[1],h[2],h[3]),M||(M=I>0&&R!==p[0]),R=p[0],$||($=l.elevationOffset!==0),$&&b==null&&(b=new Array(I).fill(0)),b!=null&&(b[I]=l.elevationOffset),x=Math.min(x,l.elevationOffset),T=Math.max(T,l.elevationOffset),_ct(l.elevationOffset,h),c.setData(a[I],1,h[0],h[1],h[2],h[3]);const P=l.objectAndLayerIdColor;P!=null&&c.setData(a[I],2,P[0],P[1],P[2],P[3]),l.pickable!==FY(s.pickability,I)&&(s.pickability=sbt(s.pickability,s.count,I,l.pickable))}s.verticalOffsets=$?b:null,r.offsetObb=$?STe(r.obb,x,T,this._viewingMode,r.offsetObb??r.obb.clone()):null,M||$||_d()?(n.componentParameters=new lA,n.componentParameters.castShadows=D8(w,s.count),n.componentParameters.transparent=D8(g,s.count),n.componentParameters.opaqueOverride=D8(y,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new mR,n.componentParameters.castShadows=l.castShadows?Ys.All:Ys.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,n=!1){e.intersectionGeometry.getComponentAabb(i,r);const s=e,o=s.components.verticalOffsets;if(n||o==null)return r;const a=o[i];if(this._viewingMode===ct.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=Jle(a);return l.localOrigin=s.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,n){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||n.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const s=e,o=s.components,a=o.count,l=o.verticalOffsets,c=s.intersectionGeometry,h=this._viewingMode===ct.Local,p=c.getComponentAabbs(),g=Jbt;let y=1/0,w=-1/0;for(let b=0;b<a;b++){const x=6*b,T=(l==null?void 0:l[b])??0;let M=1/0,$=-1/0;if(h)M=p[x+2]+T+i,$=p[x+5]+T+i;else{if(g[0]=p[x],g[1]=p[x+1],g[2]=p[x+2],g[3]=p[x+3],g[4]=p[x+4],g[5]=p[x+5],T!==0){const N=Jle(T);N.localOrigin=s.transform.position,N.applyToAabb(g)}const R=Math.max(Math.abs(g[3]),Math.abs(g[0])),I=Math.max(Math.abs(g[4]),Math.abs(g[1])),P=i+g[5]+r;n.expandElevationRangeValues(i+g[2],Math.sqrt(R*R+I*I+P*P)-r)}n.expandElevationRangeValues(M,$),y=Math.min(y,M),w=Math.max(w,$)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=y,this._elevationRangeCacheMax=w}intersect(e,i,r,n,s,o,a){const l=e,{transform:c}=l,{position:h}=c;return s!=null&&(s.localOrigin=h),l.intersectionGeometry.intersect(i,r,n,s,l.components.verticalOffsets,c,o,a)}addEdges(e,i,r,n,s){const o=e,{indices:a,positions:l}=o.intersectionGeometry,c=o.components.offsets;return i.addComponentObject(o,l,a,c,r,n,s)}async extractEdgeInformation(e,i,r){const n=e,s=n.components.visibility;if(s.allInvisible()){const{extractComponentsEdgeLocationsLayout:y}=await fe(()=>import("./edgeProcessing-CNsgJECP.js").then(w=>w.e),__vite__mapDeps([46,47,45]));return{buffer:y.createBuffer(0),origin:[0,0,0]}}const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,{EdgeInputBufferLayout:c}=await fe(async()=>{const{EdgeInputBufferLayout:y}=await import("./bufferLayouts-ZAlmXeKt.js");return{EdgeInputBufferLayout:y}},[]),h=c.createBuffer(a.length/3);vie(h.position.typedBuffer,a,h.position.typedBufferStride,3),vIe(h.position,h.position,n.transform.rotationScale),this._setComponentIndices(h.componentIndex,o,l);const p=h.count,g=this._computeVisibilityIndices(o,s,l,p);return{origin:En(n.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:g,indicesLength:g.length,skipDeduplicate:!0,data:h,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let n=0;for(let s=0;s<r.length-1;s++){const o=r[s],a=r[s+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,i,r,n){if(e&&i.allVisible())return e;let s=0;i.forEachComponentRange((l,c)=>(s+=r[c]-r[l],!0));const o=yy(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let g=h;g<p;g++)o[a++]=e?e[g]:g;return!0}),o}addComponentHighlight(e,i,r){const n=e.components;let s=n.highlightCounts,o=n.highlightGroups;s!=null&&o!=null||(s=new Uint32Array(n.count+1),n.highlightCounts=s,o=new Array(n.count+1),n.highlightGroups=o),o[i]=r,s[i]++===0&&(n.highlightsDirty(),this._notifyDirty()),s[n.count]++}removeComponentHighlight(e,i){const r=e.components,n=r.highlightCounts;if(n==null)return void bge().warn("Removing non-existing highlight.");const s=n[i];if(s===0)return void bge().warn("Removing non-existing highlight.");const o=n[r.count];if(s>1)return n[i]=s-1,void(n[r.count]=o-1);n[i]=0,r.highlightsDirty(),this._notifyDirty(),o===1?(r.highlightCounts=null,r.highlightGroups=null):n[r.count]=o-1}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightGroups=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=bs.createVertex(r,Vn.STATIC_DRAW,n.vertices.data),a=n.indices?bs.createIndex(r,Vn.STATIC_DRAW,n.indices):null,l=Sd(Lbt(s)),c=new Uint16Array(n.vertices.count);for(let b=0;b<i.count;b++){const x=i.offsets[b],T=i.offsets[b+1],M=i.materialDataIndices[b];if(n.indices!=null)for(let $=x;$<T;$++)c[n.indices[$]]=M;else for(let $=x;$<T;$++)c[$]=M}const h=bs.createVertex(r,Vn.STATIC_DRAW,c.buffer),p=new lo(e.transform,e.toMapSpace),g=new rI(r,$Ie,new Map([["data",l],["componentIndices",Xbt]]),new Map([["data",o],["componentIndices",h]]),a),y=new Ebt(g,ur.TRIANGLES,s,a!=null),w={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+h.usedMemory+(a!=null?a.usedMemory:0)};return new Tbt(p,y,w)}_notifyDirty(){this._renderManager.notifyDirty()}};const Xbt=Sd(Zc().u16(k.COMPONENTINDEX));function D8(t,e){return t===e?Ys.All:t===0?Ys.None:Ys.Some}const Jbt=bd();let Qbt=class{constructor(e,i,r,n,s){this.rctx=e,this.viewingMode=i,this.stippleTextures=r,this.waterTextures=n,this.markerTextures=s}get spherical(){return this.viewingMode===ct.Global}get doublePrecisionRequiresObfuscation(){return this.rctx.driverTest.doublePrecisionRequiresObfuscation.result}},Kbt=class{constructor(e){this.context=e,this._debug=!1,this._precompiling=this._debug?0:1,this._cache=new Oy,this._frameCounter=0,this._keepAliveFrameCount=xge}get precompiling(){return this._precompiling}set precompiling(e){this._precompiling=e,e===0&&this.context.rctx.gl.flush()}get viewingMode(){return this.context.viewingMode}destroy(){this._debug&&this._cache.forEach((e,i)=>{e.forEach(r=>{r.refCount>0&&console.error(`Unreleased ${i} shader technique, refCount ${r.refCount}`)})}),this._cache.forAll(e=>e.technique.destroy()),this._cache.clear()}precompile(e,i=Sge){++this.precompiling,this.acquire(e,i).release(),--this.precompiling}acquire(e,i=Sge){const r=i.key.code;let n=this._cache.get(e,r);if(n==null){if(this._precompiling===0){let o=`Uncached shader compile in ${new Error().stack}
  for configuration
${i.decode()}`;const a=this._cache.getInner(e);throw a!=null&&a.size&&(o+=`

  cached configurations:
`,o+=Array.from(a.values()).map(l=>i.decode(l.technique.key)).sort().join(`

`)),console.log(o),new Y(o)}const s=new e(this.context,i,()=>this._release(s));n=new ext(s),this._cache.set(e,r,n)}return++n.refCount,n.technique}_release(e){if(e==null||this._cache.empty)return;const i=this._cache.get(e.constructor,e.key.code);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==xge&&this._cache.forEach((e,i)=>{e.forEach((r,n)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._cache.delete(i,n))})})}async reloadAll(){const e=new Array;this._cache.forEach(i=>e.push(txt(i))),await Promise.all(e)}},ext=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const xge=-1;async function txt(t){let e=!0;t.forEach(async i=>{await i.technique.reload(e),e=!1})}const Sge=new Zu;let cA=class extends Hy{constructor(e){super(e),this.consumes={required:["olid"]},this.produces="olid"}destroy(){}render(e){const i=e.find(({name:n})=>n==="olid"),r=this.renderingContext;return r.bindFramebuffer(i.fbo),r.clearFramebuffer(hs,!0,!0),this.view._stage.renderer.renderAllGeometry(J.ObjectAndLayerIdColor),r.clear(Xi.DEPTH|Xi.STENCIL),this.view._stage.renderer.renderHUD(pl.NotOccluded),i}};u([f()],cA.prototype,"consumes",void 0),u([f()],cA.prototype,"produces",void 0),cA=u([L("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],cA);var fa;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.Depth=3]="Depth",t[t.COUNT=4]="COUNT"})(fa||(fa={}));let Zk=class extends Zu{constructor(){super(...arguments),this.blitMode=fa.None,this.hasOpacityFactor=!1}};u([le({count:fa.COUNT})],Zk.prototype,"blitMode",void 0),u([le()],Zk.prototype,"hasOpacityFactor",void 0);let wV=class extends Ar{constructor(){super(...arguments),this.opacity=1}};function RIe(t){const e=new or;e.include(xa),e.fragment.uniforms.add(new ht("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new rt("opacity",r=>r.opacity));const i=t.blitMode===fa.Depth;return i&&(e.fragment.uniforms.add(new rs("nearFar",(r,n)=>n.camera.nearFar)),e.fragment.include(qy),e.fragment.include(t1)),e.fragment.main.add(C`
    ${i?C`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:C`
          fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};`}`),e}const ixt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:wV,build:RIe},Symbol.toStringTag,{value:"Module"}));let G_=class extends hr{constructor(e,i,r){super(e,i,new ar(ixt,()=>fe(()=>Promise.resolve().then(()=>xAt),void 0)),r)}initializePipeline(e){switch(e.blitMode){case fa.None:case fa.Depth:return Pi({colorWrite:Qi});case fa.Alpha:return Pi({blending:gd,colorWrite:Qi});default:e.blitMode;case fa.PremultipliedAlpha:case fa.COUNT:return Pi({blending:iM,colorWrite:Qi})}}},IIe=class{constructor(e,i=fa.None){this._techniques=e,this._parameters=new wV,this._configuration=new Zk,this._configuration.blitMode=i,e.precompile(G_,this._configuration)}blit(e,i,r,n){e.bindFramebuffer(r.fbo),e.setClearColor(0,0,0,1),e.clear(Xi.COLOR),this._parameters.texture=i.getTexture();const s=this._techniques.acquire(G_,this._configuration);e.bindTechnique(s,n,this._parameters),e.screen.draw(),s.release()}blend(e,i,r,n,s=1){this._configuration.hasOpacityFactor=s<1;const o=this._techniques.acquire(G_,this._configuration);return o.compiled?(e.bindFramebuffer(r.fbo),this._parameters.texture=i.getTexture(),this._parameters.opacity=s,e.bindTechnique(o,n,this._parameters),e.screen.draw(),o.release(),!0):(o.release(),!1)}},WT=class extends Hy{constructor(e){super(e),this.consumes={required:[ii.OCCLUDED]},this.produces=ii.OCCLUDED;const i=e.view._stage.renderView.techniques;this._blit=new IIe(i,fa.PremultipliedAlpha)}precompile(){const e=this.view._stage.renderer;e.plugins.plugins.forAll(i=>{e.precompileSlots(i,Ie.OCCLUDED_TERRAIN,Ie.TRANSPARENT_OCCLUDER_MATERIAL),i.material&&e.precompileOccludedSlots(i,Tge)})}render(e){const i=e.find(({name:s})=>s===ii.OCCLUDED),r=this.view._stage.renderer;let n=0;if(og.clear(),r.plugins.plugins.forAll(s=>{s.material&&s.queryRenderOccludedState(Dr.OccludeAndTransparentStencil)&&(n|=Dr.OccludeAndTransparentStencil,og.push(s))}),og.length>0&&(r.renderSlots(og,Ie.OCCLUDER_MATERIAL),n&Dr.OccludeAndTransparentStencil&&this._renderAndComposite(i,.5,()=>r.renderSlots(og,Ie.TRANSPARENT_OCCLUDER_MATERIAL),!1,!1)),og.clear(),r.plugins.plugins.forAll(s=>{if(!s.material)return;const o=s.queryRenderOccludedState(Dr.OccludeAndTransparent),a=s.queryRenderOccludedState(Dr.Transparent),l=s.queryRenderOccludedState(Dr.Opaque);(o||a||l)&&(n|=o?Dr.OccludeAndTransparent:a?Dr.Transparent:Dr.Opaque,og.push(s))}),n|=r.plugins.renderOccludedFlags,!n)return i;for(const s of Tge)n&s&&this._renderAndComposite(i,s===Dr.Opaque?1:.5,()=>r.renderOccludedSlots(og,s),!0,Hu.OutlineVisualElementMask);return og.clear(),i}_renderAndComposite(e,i,r,n,s){const o=this.renderingContext,{width:a,height:l}=e.fbo,c=this.fboCache.acquire(a,l,"tmp color"),h=n?this.fboCache.acquireDepth(Ro.DEPTH_STENCIL_TEXTURE,a,l,"tmp depth"):e.getAttachment(rx);c.attachDepth(h),o.bindFramebuffer(c.fbo),o.clearFramebuffer(hs,n,s),r(),c.detachDepth(),this._blit.blend(o,c,e,this.bindParameters,i),n&&h.release(),c.release()}};u([f()],WT.prototype,"consumes",void 0),u([f()],WT.prototype,"produces",void 0),u([f({constructOnly:!0})],WT.prototype,"techniques",void 0),WT=u([L("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],WT);const og=new mi,Tge=[Dr.OccludeAndTransparent,Dr.Transparent,Dr.Opaque];let xie=class extends Ar{};function PIe(){const t=new or;return t.include(xa),t.fragment.uniforms.add(new ht("colorTexture",e=>e.color),new ht("depthTexture",(e,i)=>i.mainDepth)),t.fragment.main.add(C`float depthSample = texture(depthTexture, uv).r;
if (depthSample == 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const rxt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:xie,build:PIe},Symbol.toStringTag,{value:"Module"}));let Ege=class extends hr{constructor(e,i,r){super(e,i,new ar(rxt,()=>fe(()=>Promise.resolve().then(()=>SAt),void 0)),r)}initializePipeline(){return Pi({blending:e1(ei.ONE,ei.ZERO,ei.ONE_MINUS_SRC_COLOR,ei.ONE),depthTest:{func:gr.ALWAYS},colorWrite:Qi})}};function LIe(t){const e=new or;e.include(_V);const{reduced:i}=t,{fragment:r}=e;return r.uniforms.add(new ht("depthTexture",(n,s)=>s.mainDepth),new rt("hazeStrength",n=>n.hazeStrength)),Om(r),e.include(xI),r.include(qy),r.include($z),r.include(mV),r.include(hIe,!0),i&&r.code.add(C`float getDepth(vec2 uv){
return linearDepthFromTexture(depthTexture, uv);
}
float textureBilinear(vec2 uv) {
vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
vec2 texelSize = 1.0 / depthTextureSize;
vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);
vec2 f = fract(depthUV);
vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;
float d0 = getDepth(snapUV);
float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
float d3 = getDepth(snapUV + texelSize);
return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
}`),r.main.add(C`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture(depthTexture, uv).r;
      if (depthSample != 1.0) {
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;

        cameraSpaceRay *= ${Ge(i,"-textureBilinear(uv)","-linearDepthFromTexture(depthTexture, uv)")};
        terrainDepth = max(0.0, length(cameraSpaceRay));
      } else {
        discard;
      }

      // Alpha is ignored for haze blending
      vec3 col = vec3(0);
      float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
      if(depthSample != 1.0){
        col = (1.0 - fadeOut) * hazeStrength * raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      }
      float alpha = 1.0;

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
  `),e}const nxt=Object.freeze(Object.defineProperty({__proto__:null,build:LIe},Symbol.toStringTag,{value:"Module"}));let sxt=class extends uIe{constructor(){super(...arguments),this.hazeStrength=1}},N8=class extends hr{constructor(e,i,r){super(e,i,new ar(nxt,()=>fe(()=>Promise.resolve().then(()=>TAt),void 0)),r)}initializePipeline(e){return e.reduced?Pi({blending:VK,depthTest:{func:gr.ALWAYS},colorWrite:Qi}):Pi({blending:e1(ei.ONE,ei.ZERO,ei.ONE_MINUS_SRC_COLOR,ei.ONE),colorWrite:Qi})}},DIe=class extends Zu{constructor(){super(...arguments),this.reduced=!1}};u([le()],DIe.prototype,"reduced",void 0);let UY=class extends fR{constructor(e){super(e),this._compositingPassParameters=new xie,this._passParameters=new sxt,this._hazeConfiguration=new DIe,this._vao=null,this.requireGeometryDepth=!0,this._oldAmount=1,this._newAmount=1,this._amount=this._newAmount;const{techniques:i}=e;i.precompile(N8,this._hazeConfiguration),i.precompile(Ege),this._hazeConfiguration.reduced=!0,i.precompile(N8,this._hazeConfiguration),this._hazeConfiguration.reduced=!1}initialize(){this.addHandles([oe(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),hi),oe(()=>{var e;return((e=this.view._stage)==null?void 0:e.renderer.renderContext.bind.clouds.fadeFactor)??1},e=>this._fade(e),hi),oe(()=>this.view.environment.weather.type,e=>this._newAmount=e==="rainy"?0:1,hi),oe(()=>{var e;return(e=this.view._stage.renderer)==null?void 0:e.fullResolutionAtmosphere},e=>this._hazeConfiguration.reduced=!e,hi)])}_fade(e){e>=1?(this._amount=this._newAmount,this._oldAmount=this._newAmount):this._amount=e<=0?this._oldAmount:Bt(this._oldAmount,this._newAmount,e)}destroy(){this._vao=Ht(this._vao)}render(e){const i=e.find(({name:b})=>b===ii.TRANSPARENT_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext;this._vao??(this._vao=i1(r,Am.Pos2Tex));const n=this.techniques.acquire(N8,this._hazeConfiguration);if(!n.compiled)return n.release(),i;const s=i.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);if(this._update(),!this._hazeConfiguration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(n,this.bindParameters,this._passParameters),this._renderCommon(r),i.attachDepth(s),n.release(),i;const o=this.techniques.acquire(Ege);if(!o.compiled)return n.release(),o.release(),i;const a=r.getViewport(),l=this.camera,c=Fe(l.eye)-Ii.radius;let h;const p=Ii.atmosphereHeight;if(c<p){const b=Math.min(1,Math.max(0,c/p));h=Bt(.4,.5,b)}else{const b=Math.min(1,Math.max(0,(c-p)/(15*p)));h=Bt(.5,1,b)}const g=my(Math.round(h*l.fullViewport[2])),y=my(Math.round(h*l.fullViewport[3]));r.setViewport(0,0,g,y);const w=this.fboCache.acquire(g,y,"haze",Vr.RGBA);return r.bindFramebuffer(w.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(n,this.bindParameters,this._passParameters),this._renderCommon(r),r.setViewport(a.x,a.y,a.width,a.height),this._compositingPassParameters.color=w.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(o,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(s),o.release(),n.release(),w.release(),i}_renderCommon(e){this._vao!=null&&(e.bindVAO(this._vao),e.drawArrays(ur.TRIANGLE_STRIP,0,4))}_update(){const e=this.bindParameters.camera,i=No(e.eye),r=Math.sqrt(i),n=i-this._passParameters.radii[1]*this._passParameters.radii[1],s=Oe((r-this._passParameters.radii[0])/Ii.atmosphereHeight,0,1);_n(this._passParameters.heightParameters,r,i,n,s);const o=this.view.basemapTerrain.getLowerBoundRadius();ln(this._passParameters.radii,o,o+Ii.atmosphereHeight),this._passParameters.hazeStrength=Bt(Bt(.6,1,LR(9500,10500,r-Ii.radius)),1,this._amount)}};UY=u([L("esri.views.3d.webgl-engine.effects.haze.Haze")],UY);function oxt(t){const e=t.fragment;t.include(rV),e.include(qy),e.code.add(C`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}let Sie=class extends Zu{constructor(){super(...arguments),this.receiveShadows=!0}};u([le()],Sie.prototype,"receiveShadows",void 0);const axt=.025;function NIe(){const t=new or;t.include(mI,lxt),t.include(xa),t.include(oxt);const e=t.fragment;return e.include(t1),e.uniforms.add(new ht("defaultDepthTex",(i,r)=>r.shadowMap.getSnapshot(dx.ExcludeHighlight)),new ht("highlightDepthTex",(i,r)=>r.shadowMap.getSnapshot(dx.Highlight)),new ht("depthMap",(i,r)=>{var n;return(n=r.depth)==null?void 0:n.attachment}),new ht("highlightTexture",i=>i.highlight),new Yr("uColor",i=>i.shadowColor),new rt("opacity",i=>i.shadowOpacity),new rt("occludedOpacity",i=>i.occludedShadowOpacity),new rt("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new fi("lightingMainDirectionView",(i,r)=>Me(Mge,Mt(Mge,r.lighting.mainLight.direction,r.camera.viewInverseTransposeMatrix))),new Bs("inverseViewMatrix",(i,r)=>Yl(Cge,hd(Cge,r.camera.viewMatrix,r.camera.center)))).main.add(C`
    ivec2 highlightTextureSize = textureSize(highlightTexture, 0);
    ivec2 highlightIUV = ivec2(uv * vec2(highlightTextureSize));
    vec4 highlightInfo = texelFetch(highlightTexture, highlightIUV, 0);

    fragColor = vec4(0.0);

    // Calculate bit mask to check if pixel is highlit unoccluded at any level
    int ored =
         (int(highlightInfo.r*255.0) << 0)
       | (int(highlightInfo.g*255.0) << 8)
       | (int(highlightInfo.b*255.0) << 16)
       | (int(highlightInfo.a*255.0) << 24);
    bool visiblyHighlighted = ((ored & ~(ored >> 1)) & (1+4+16+64)) != 0;
    if (visiblyHighlighted) {
      return;
    }

    // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
    float depth = depthFromTexture(depthMap, uv);
    if (depth >= 1.0 || depth <= 0.0) {
      return;
    }

    float currentPixelDepth = linearizeDepth(depth);
    vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
    vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

    mat4 shadowMatrix;
    float linearDepth = -currentPixelDepth;
    int i = chooseCascade(linearDepth, shadowMatrix);
    if (i >= numCascades) {
      return;
    }

    // vertex completely outside? -> no shadow
    vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
    if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
      return;
    }

    ivec2 texSize = textureSize(highlightDepthTex, 0);
    ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

    float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
    bool shadowHighlight = depthHighlight < lvpos.z;
    if (!shadowHighlight) {
      return;
    }

    float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
    bool shadowDefault = depthDefault < lvpos.z;

    vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
    bool shaded = dot(normal, lightingMainDirectionView) < ${C.float(axt)};

    float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
    fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
  `),t}const Cge=ut(),Mge=A(),lxt=new Sie,cxt=Object.freeze(Object.defineProperty({__proto__:null,build:NIe},Symbol.toStringTag,{value:"Module"}));let uxt=class extends gte{constructor(){super(...arguments),this.shadowColor=Ri(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},$ge=class extends hr{constructor(e,i,r){super(e,i,new ar(cxt,()=>fe(()=>Promise.resolve().then(()=>EAt),void 0)),r),this.primitiveType=ur.TRIANGLE_STRIP}initializePipeline(){return Pi({blending:gd,colorWrite:Qi,depthTest:null,depthWrite:null})}};const hxt=1/512,dxt=4e4,pxt=5e4;let Lw=class extends Hy{constructor(e){super(e),this.produces=Io.COMPOSITE,this.consumes={required:[Io.COMPOSITE,"highlights"]},this._passParameters=new uxt,this._maxOpacity=1,this._shadowDifference=.2,e.techniques.precompile($ge)}initialize(){this.addHandles([oe(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??ERe,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},hi),oe(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??CRe,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},hi),oe(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=fie(e??TRe),this._ensureMaxOpacity()},hi)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3],this.requestRender(Gt.UPDATE)}render(e){var s;const i=e.find(({name:o})=>o===Io.COMPOSITE),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;const n=this.techniques.acquire($ge);if(n.compiled){this._passParameters.highlight=(s=e.find(({name:a})=>a==="highlights"))==null?void 0:s.getTexture(),this._passParameters.origin=r.camera.center;const o=this.renderingContext;o.bindFramebuffer(i.fbo),o.bindTechnique(n,r,this._passParameters),o.screen.draw()}else this.requestRender(Gt.UPDATE);return n.release(),i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-LR(dxt,pxt,e.relativeElevation);const r=this.viewingMode===ct.Global?Me(Oge,e.center):ve(Oge,0,0,1),n=Te(r,i);return this._passParameters.dayNightTerminator=LR(0,1,Oe(30*n,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=hxt}};u([f()],Lw.prototype,"produces",void 0),u([f()],Lw.prototype,"consumes",void 0),u([f({constructOnly:!0})],Lw.prototype,"viewingMode",void 0),u([f({constructOnly:!0})],Lw.prototype,"techniques",void 0),Lw=u([L("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],Lw);const Oge=A();let Tie=class extends Ar{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function FIe(){const t=new or;return t.attributes.add(k.POSITION,"vec2"),t.vertex.uniforms.add(new Yr("drawPosition",(e,i)=>fxt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.main.add(C`vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);`),t.fragment.uniforms.add(new ht("textureInput",e=>e.input)),t.fragment.uniforms.add(new ht("textureMask",e=>e.mask)),t.fragment.uniforms.add(new ht("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new Ay("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Ay("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(C`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}`),t.fragment.main.add(C`float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;`),t}function fxt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,n=t.magnifier.offset.y*i;Mp(t.magnifier.position,Age);const s=e.camera.screenToRender(Age,mxt),o=Math.ceil(i*t.magnifier.size),{fullWidth:a,fullHeight:l}=e.camera;return _n(gxt,(s[0]+r)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const Age=ds(),mxt=R1e(),gxt=Ti(),yxt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:Tie,build:FIe},Symbol.toStringTag,{value:"Module"}));let Rge=class extends hr{constructor(e,i,r){super(e,i,new ar(yxt,()=>fe(()=>Promise.resolve().then(()=>CAt),void 0)),r)}initializePipeline(){return Pi({blending:iM,depthTest:null,depthWrite:null,colorWrite:Qi})}};async function _xt(t){const e=fe(()=>import("./mask-svg-cNit2NTT.js"),[]),i=fe(()=>import("./overlay-svg-DioSRl-7.js"),[]),r=Py((await e).default,{signal:t}),n=Py((await i).default,{signal:t}),s={mask:await r,overlay:await n};return zt(t),s}let __=class extends Hy{constructor(e){super(e),this.produces=ii.MAGNIFIER,this.consumes={required:[ii.MAGNIFIER]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new Tie,this._vao=null,this._magnifier=null,this._tmpScreenPoint=ds(),this._tmpRenderPoint=R1e()}initialize(){this.addHandles([oe(()=>this.view.magnifier,e=>this._update(e),hi)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces=ii.MAGNIFIER):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(oe(()=>{var r;return(r=this._magnifier)==null?void 0:r.version},i)),i()}get _validMagnifier(){var e,i,r;return(e=this._magnifier)!=null&&e.visible&&((i=this._magnifier)!=null&&i.position)&&((r=this._magnifier)==null?void 0:r.size)>0?this._magnifier:null}get _factor(){var e;return((e=this._magnifier)==null?void 0:e.factor)||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=Ht(this._vao)}_disposeTextures(){this._passParameters.mask=Ht(this._passParameters.mask),this._passParameters.overlay=Ht(this._passParameters.overlay),this._passParameters.input=Ht(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(Rge)}render(e){const i=this._validMagnifier,r=e.find(({name:T})=>T===ii.MAGNIFIER);if(i==null)return r;if(this._imageSources==null)return this.requestRender(Gt.UPDATE),r;const n=this.renderingContext,s=this.camera.pixelRatio,o=Math.ceil(s*i.size);this._vao??(this._vao=i1(n,Am.Pos2,md,0,1));const a=this.techniques.acquire(Rge);if(this._ensureTextureResources(n,o),!a.compiled||!this._passParameters.input)return a.release(),this.requestRender(Gt.UPDATE),r;const l=Math.ceil(1/this._factor*o),c=this._passParameters.input;c.resize(l,l),Mp(i.position,this._tmpScreenPoint);const h=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),p=this.camera.fullWidth,g=this.camera.fullHeight,y=.5*l,w=.5*l;h[0]=Oe(h[0],y,p-y-1),h[1]=Oe(h[1],w,g-w-1);const b=Math.floor(h[0]-y),x=Math.floor(h[1]-w);return n.bindFramebuffer(r.fbo),a.program.bindTexture("textureInput",c),n.gl.copyTexImage2D(c.descriptor.target,0,c.descriptor.pixelFormat,b,x,l,l,0),this._passParameters.magnifier=i,n.bindTechnique(a,this.bindParameters,this._passParameters),n.bindVAO(this._vao),n.drawArrays(ur.TRIANGLE_STRIP,0,4),a.release(),r}_loadResources(e){var n,s,o;const{maskUrl:i,overlayUrl:r}=e;((n=this._imageLoadTask)==null?void 0:n.maskUrl)===i&&((s=this._imageLoadTask)==null?void 0:s.overlayUrl)===r||((o=this._imageLoadTask)==null||o.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:Ny(async a=>{const l=i==null||r==null?_xt(a):null,c=i!=null?Py(i,{signal:a}):l.then(p=>p.mask),h=r!=null?Py(r,{signal:a}):l.then(p=>p.overlay);this._imageSources={mask:await c,overlay:await h}})})}_ensureTextureResources(e,i){if(this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i;const r=new jr;r.internalFormat=kt.RGBA,r.wrapMode=Tr.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!Ave(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new fr(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=kt.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new fr(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=kt.RGBA,r.flipped=!1,this._passParameters.input=new fr(e,r)}};u([f()],__.prototype,"produces",void 0),u([f()],__.prototype,"consumes",void 0),u([f()],__.prototype,"_imageSources",void 0),u([f()],__.prototype,"_imageLoadTask",void 0),u([f({constructOnly:!0})],__.prototype,"techniques",void 0),__=u([L("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],__);const q$=8,vxt=16;function kIe(){const t=new or;return t.include(xa),t.fragment.uniforms.add(new ht("edgesTexture",e=>e.inputTexture),new ht("areaTexture",e=>e.areaTexture),new ht("searchTexture",e=>e.searchTexture)),t.fragment.code.add(C`
    #define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
    #define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

    vec4 sampleLevelZeroOffset(vec2 coord, vec2 offset, vec2 resolution) {
      return texture(edgesTexture, coord + offset.x * resolution);
    }

    float searchLength(vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture(searchTexture, e).r;
    }

    float searchLeft(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${C.int(q$)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${C.int(q$)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength(e, 0.5, 0.5);
      return texcoord.x;
    }

    float searchUp(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${C.int(q$)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength(e.gr, 0.0, 0.5);
      return texcoord.y;
    }

    float searchDown(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${C.int(q$)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength(e.gr, 0.5, 0.5);
      return texcoord.y;
    }

    vec2 getArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
      vec2 texcoord = float(${C.int(vxt)}) * round(4.0 * vec2(e1, e2)) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture(areaTex, texcoord).rg;
    }`),t.fragment.main.add(C`
    vec2 size = vec2(textureSize(edgesTexture, 0));
    vec2 resolution = 1.0 / size;
    vec2 pixelCoord = uv * size;
    vec4 offsets[2];
    offsets[0] = uv.xyxy + resolution.xyxy * vec4(-0.25, 0.125, 1.25, 0.125);
    offsets[1] = uv.xyxy + resolution.xyxy * vec4(-0.125, 0.25, -0.125, -1.25);
    vec4 maxOffset = vec4(offsets[0].xz, offsets[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * resolution.xxyy * float(${C.int(q$)});
    ivec4 subsampleIndices = ivec4(0.0);
    vec4 weights = vec4(0.0);
    vec2 e = texture(edgesTexture, uv).rg;
    if (e.r > 0.0) {
      vec2 d;
      vec2 coords;
      coords.y = searchUp(offsets[1].xy, maxOffset.z, resolution);
      coords.x = offsets[0].x;
      d.x = coords.y;
      float e1 = texture(edgesTexture, coords).g;
      coords.y = searchDown(offsets[1].zw, maxOffset.w, resolution);
      d.y = coords.y;
      d = d * size.y - pixelCoord.y;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(0.0, 1.0), resolution).g;
      weights.ba = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.x));
      // for some reason the following lines are necessary to prevent
      // texture lookup precision issues on some Intel integrated graphics chips
      vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
      weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
    }
    if (e.g > 0.0) {
      vec2 d;
      vec2 coords;
      coords.x = searchLeft(offsets[0].xy, maxOffset.x, resolution);
      coords.y = offsets[1].y;
      d.x = coords.x;
      float e1 = texture(edgesTexture, coords).r;
      coords.x = searchRight(offsets[0].zw, maxOffset.y, resolution);
      d.y = coords.x;
      d = d * size.x - pixelCoord.x;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(1.0, 0.0), resolution).r;
      weights.rg = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.y));
    }
    fragColor = weights;
  `),t}const wxt=Object.freeze(Object.defineProperty({__proto__:null,build:kIe},Symbol.toStringTag,{value:"Module"}));let Ige=class extends hr{constructor(e,i,r){super(e,i,new ar(wxt,()=>fe(()=>Promise.resolve().then(()=>MAt),void 0)),r)}initializePipeline(){return Pi({colorWrite:Qi})}};function UIe(){const t=new or;return t.include(xa),t.fragment.uniforms.add(new ht("blendWeightsTexture",e=>e.inputTexture),new ht("colorTexture",e=>e.color)),t.fragment.main.add(C`vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}`),t}const bxt=Object.freeze(Object.defineProperty({__proto__:null,build:UIe},Symbol.toStringTag,{value:"Module"}));let Pge=class extends hr{constructor(e,i,r){super(e,i,new ar(bxt,()=>fe(()=>Promise.resolve().then(()=>$At),void 0)),r)}initializePipeline(){return Pi({colorWrite:Qi})}};const xxt=.05,Sxt=2;function zIe(){const t=new or;return t.include(xa),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(C`float absMax3(vec3 v) {
vec3 t = abs(v);
return max(max(t.r, t.g), t.b);
}`),t.fragment.uniforms.add(new ht("colorTexture",e=>e.color)).main.add(C`
    vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
    vec4 offsets[3];
    offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
    offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
    offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

    // Calculate color deltas:
    vec3 C = texture(colorTexture, uv).rgb;
    vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
    vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
    vec2 delta = vec2(absMax3(C - Cleft), absMax3(C - Ctop));
    vec2 edges = step(vec2(${C.float(xxt)}), delta);

    // discard if there is no edge:
    if (dot(edges, vec2(1.0)) == 0.0) {
      fragEdges = vec2(0.0);
    }
    else {
      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      float horizontal = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      float vertical = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), horizontal), vertical);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      horizontal = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      vertical = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, horizontal), vertical);

      // Local contrast adaptation in action:
      fragEdges = edges * step(maxDelta, float(${C.float(Sxt)}) * delta);
    }
  `),t}const Txt=Object.freeze(Object.defineProperty({__proto__:null,build:zIe},Symbol.toStringTag,{value:"Module"}));let Lge=class extends hr{constructor(e,i,r){super(e,i,new ar(Txt,()=>fe(()=>Promise.resolve().then(()=>OAt),void 0)),r)}initializePipeline(){return Pi({colorWrite:Qi})}},Ext=class extends Ar{},v_=class extends Hy{constructor(e){super(e),this.produces="disabled",this.consumes={required:[ii.ANTIALIASING],optional:[Io.COMPOSITE]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new Ext,e.techniques.precompile(Lge),e.techniques.precompile(Ige),e.techniques.precompile(Pge)}initialize(){this.addHandles([oe(()=>this.isEnabled(),e=>e?this.enable():this.disable(),hi)])}async enable(){if(this.produces=ii.ANTIALIASING,this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await fe(()=>import("./SMAAData-DCEZ61Cs.js"),[]);await this._loadTextures(i,e),this.requestRender(Gt.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,i){zt(i);const[r,n]=await Promise.allSettled([Py(e.areaTexture,{signal:i}),Py(e.searchTexure,{signal:i})]);if(zt(i),r.status!=="fulfilled"||n.status!=="fulfilled")return;const s=this.renderingContext;this._areaTexture=Dge(s,Mi.LINEAR,kt.RGB,r.value),this._searchTexture=Dge(s,Mi.NEAREST,kt.LUMINANCE,n.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=Ht(this._searchTexture),this._areaTexture=Ht(this._areaTexture)}render(e){const i=e.find(({name:y})=>y===ii.ANTIALIASING);if(!this._areaTexture||!this._searchTexture)return this.requestRender(Gt.UPDATE),i;const r=this.techniques.acquire(Lge),n=this.techniques.acquire(Ige),s=this.techniques.acquire(Pge);if(!r.compiled||!n.compiled||!s.compiled)return r.release(),n.release(),s.release(),this.requestRender(Gt.UPDATE),i;const o=e.find(({name:y})=>y===Io.COMPOSITE);if(!o)return i;const a=o.fbo.width,l=o.fbo.height,c=this.renderingContext;c.setViewport(0,0,a,l);const h=this.fboCache.acquire(a,l,"smaa edges",Vr.RG);c.bindFramebuffer(h.fbo),c.setClearColor(0,0,0,1),c.clear(Xi.COLOR),this._smaaParameters.color=o.getTexture();const p=this.bindParameters;c.bindTechnique(r,p,this._smaaParameters),c.screen.draw(),r.release();const g=this.fboCache.acquire(a,l,"smaa blend");return c.bindFramebuffer(g.fbo),c.setClearColor(0,0,1,1),c.clear(Xi.COLOR),this._smaaParameters.inputTexture=h.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(n,p,this._smaaParameters),c.screen.draw(),n.release(),h.release(),c.bindFramebuffer(i.fbo),c.setClearColor(0,1,0,1),c.clear(Xi.COLOR),this._smaaParameters.inputTexture=g.getTexture(),c.bindTechnique(s,p,this._smaaParameters),c.screen.draw(),s.release(),g.release(),i}};function Dge(t,e,i,r){const n=new jr;return n.pixelFormat=i,n.wrapMode=Tr.CLAMP_TO_EDGE,n.width=r.width,n.height=r.height,n.samplingMode=e,new fr(t,n,r)}u([f()],v_.prototype,"produces",void 0),u([f()],v_.prototype,"consumes",void 0),u([f({constructOnly:!0})],v_.prototype,"isEnabled",void 0),u([f({constructOnly:!0})],v_.prototype,"techniques",void 0),u([f()],v_.prototype,"_abortController",void 0),v_=u([L("esri.views.3d.webgl-engine.effects.smaa.SMAA")],v_);function VIe(){const t=new or;return t.attributes.add(k.POSITION,"vec3"),t.attributes.add(k.COLOR,"vec4"),t.attributes.add(k.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Bs("transform",(e,i)=>Cxt(e,i)),new Yr("viewport",(e,i)=>i.camera.fullViewport),new rt("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.main.add(C`gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;`),t.fragment.main.add(C`float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);`),t}function Cxt(t,e){return ps(q0,e.camera.projectionMatrix),q0[10]=24e-8-1,q0[11]=-1,q0[14]=(24e-8-2)*e.camera.near,fs(q0,q0,e.camera.viewMatrix),fs(q0,q0,t.modelMatrix)}const q0=ut(),Mxt=Object.freeze(Object.defineProperty({__proto__:null,build:VIe},Symbol.toStringTag,{value:"Module"}));let $xt=class extends Ar{constructor(){super(...arguments),this.modelMatrix=ut()}},Nge=class extends hr{constructor(e,i,r){super(e,i,new ar(Mxt,()=>fe(()=>Promise.resolve().then(()=>AAt),void 0)),r)}initializePipeline(){return Pi({blending:gd,depthTest:{func:gr.LEQUAL},colorWrite:Qi})}},zY=class extends Ap{constructor(e){super(e),this._starData=null,this._loadDataTask=null,this._numPoints=0,this._passParameters=new $xt,e.techniques.precompile(Nge)}initialize(){this.addHandles([oe(()=>this.view.environment.starsEnabled,e=>e?this._enable():this._disable(),Si),oe(()=>this.view.environment.lighting.type==="virtual"?null:this.view.environment.lighting.date,e=>this._update(e),hi)])}_enable(){super._enable(),this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=jc(this._loadDataTask),this._numPoints=0,this._vao=Ht(this._vao),this._starData=null}render(e){const i=e.find(({name:s})=>s===ii.OPAQUE_ENVIRONMENT),r=this.renderingContext;if(this.loading)return this.requestRender(Gt.UPDATE),i;if(!this._starData)return i;this._vao??(this._vao=this._ensureResources(this._starData,r));const n=this.techniques.acquire(Nge);return n.compiled?(r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(ur.POINTS,0,this._numPoints),n.release(),i):(this.requestRender(Gt.UPDATE),n.release(),i)}_ensureResources(e,i){return this._numPoints=e.byteLength/BIe,Oxt(i,new Float32Array(e,0,2*this._numPoints),new Uint8Array(e,2*this._numPoints*4,this._numPoints),this._numPoints)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*Axt(e),n=ps(this._passParameters.modelMatrix,Nxt);VE(n,n,-r*Math.PI),fs(n,Dxt,n),VE(n,n,-i*Math.PI),this.requestRender(Gt.UPDATE)}_createLoadDataTask(){if(this._starData)return null;const e=Ny(async i=>{const{data:r}=await Q5e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});Rxt(r),this._starData=r});return e.promise.catch(i=>{Bn(i)||de.getLogger(this).error(i)}).then(()=>{this.destroyed||this.requestRender(Gt.UPDATE)}),e}};function Oxt(t,e,i,r){const n=Fge.createBuffer(r),s=n.position,o=n.color,a=n.size;for(let l=0;l<r;l++){const c=e[2*l],h=e[2*l+1];s.set(l,0,-Math.cos(c)*Math.sin(h)),s.set(l,1,-Math.sin(c)*Math.sin(h)),s.set(l,2,-Math.cos(h));const p=Pxt(i[l]),g=Ixt(Lxt[p[1]]);o.set(l,0,255*g[0]),o.set(l,1,255*g[1]),o.set(l,2,255*g[2]),o.set(l,3,255),a.set(l,p[0])}return new km(t,md,new Map([["geometry",Sd(Fge)]]),new Map([["geometry",bs.createVertex(t,Vn.STATIC_DRAW,n.buffer)]]))}function Axt(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function Rxt(t){if(!t)throw new Y("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/BIe;if(e%1!=0||e>5e4||e<5e3)throw new Y("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function Ixt(t){return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function Pxt(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}zY=u([L("esri.views.3d.webgl-engine.effects.stars.Stars")],zY);const Lxt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Dxt=kQ(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Nxt=kQ(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),BIe=9,Fge=Zc().vec3f(k.POSITION).vec4u8(k.COLOR).f32(k.SIZE);let Eie=class extends Ar{};function jIe(){const t=new or;return t.include(xa),t.fragment.uniforms.add(new ht("tex",e=>e.texture)),t.fragment.main.add(C`fragColor = vec4(1.0 - texture(tex, uv).a);`),t}const Fxt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Eie,build:jIe},Symbol.toStringTag,{value:"Module"}));let kge=class extends hr{constructor(e,i,r){super(e,i,new ar(Fxt,()=>fe(()=>Promise.resolve().then(()=>RAt),void 0)),r)}initializePipeline(){return Pi({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}},kxt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new Zk,this._passParameters=new wV,this._hudParameters=new Eie,this._configuration.blitMode=fa.PremultipliedAlpha,this._techniques.precompile(G_,this._configuration),this._configuration.hasOpacityFactor=!0,this._techniques.precompile(G_,this._configuration),this._configuration.hasOpacityFactor=!1,this._configuration.blitMode=fa.Alpha,this._techniques.precompile(G_,this._configuration),this._configuration.blitMode=fa.Depth,this._techniques.precompile(G_,this._configuration),this._techniques.precompile(kge)}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.acquire(kge);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw(),r.release()}compositePreMultipliedAlpha(e,i,r=1){this._composite(e,i,fa.PremultipliedAlpha,r)}composite(e,i){this._composite(e,i,fa.Alpha,1)}blitDepthToLinearDepth(e,i){this._composite(e,i,fa.Depth,1)}_composite(e,i,r,n){this._configuration.blitMode=r,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=i,this._passParameters.opacity=n;const s=this._techniques.acquire(G_,this._configuration);this._rctx.bindTechnique(s,e,this._passParameters),this._rctx.screen.draw(),s.release()}},Uxt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Wc(new ArrayBuffer(4)),this._layerToOidToColor=new Oy,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Oy,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,n,s,o=null,a=null,l=null){e&&i&&r&&n&&(this._layerUidToId.set(n,r),this._layerUidToPopupEnabled.set(n,s),s&&this._layerUidToGraphicsUidToObjectId.set(n,i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return Ri(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){var o;if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=(o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid))==null?void 0:o.objectId;if(!r)return this.colorZero;let n=this._layerToOidToColor.get(e.layerUid,r);if(!n){if(pe("enable-feature:objectAndLayerId-screenshot-testing"))n=r;else for(;!n;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(n=a)}if(n>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new Wc(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),s=this._layerUidToId.get(r.layerUid);n&&s&&e.set(i,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:n.objectId,lid:s,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",olid:n.objectId,lid:s})}return e}},GIe=class{constructor(e,i){this.key=e,this.free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment "${this.name}" in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var CC;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(CC||(CC={}));let HIe=class extends GIe{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},zxt=class extends HIe{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=CC.COLOR}},Uge=class extends HIe{constructor(){super(...arguments),this.type=CC.DEPTH}};function Vxt(t){return(t==null?void 0:t.attachment.type)===My.Texture}let qIe=class extends GIe{constructor(e,i,r,n,s,o){super(e,o),this.type=CC.FBO,this._colors=new Map,this._name=Io.COMPOSITE,this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=n,this.acquireColor=s}dispose(){var e;(e=this.fbo)==null||e.dispose()}get usedMemory(){var e;return((e=this.fbo)==null?void 0:e.usedMemory)||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(e){this._name=e}getTexture(e=Sn.COLOR_ATTACHMENT0){var i,r;return e===rx?(i=this.fbo)==null?void 0:i.depthStencilTexture:(r=this.fbo)==null?void 0:r.getColorTexture(e)}getAttachment(e=Sn.COLOR_ATTACHMENT0){return e===rx?this._depth:this._colors.get(e)}hasAttachment(e){return ny(this._colors,i=>i.name===e)}attachDepth(e){var i;return e==null||e.retain(),this.detachDepth(),e&&((i=this.fbo)==null||i.attachDepthStencil(e.attachment)),this._depth=e,this}detachDepth(){var e,i;(e=this.fbo)==null||e.detachDepthStencilTexture(),(i=this.fbo)==null||i.detachDepthStencilBuffer(),this._depth=Lr(this._depth)}obtainDepthTexture(){var i;const e=this._depth;return Vxt(e)?((i=this.fbo)==null||i.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){var r;return e.retain(),this.detachColor(i),(r=this.fbo)==null||r.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){var r;(r=this.fbo)==null||r.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i==null||i.release()}detachAll(){this._colors.forEach((e,i)=>this.detachColor(i)),this.detachDepth()}},F8=class{constructor(e,i){this._last=new mi,this._incarnation=0,this._cache=new bI(e,i)}destroy(){var e;(e=this._last)==null||e.forAll(i=>i.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var i;e&&!this._last?this._last=new mi:e||((i=this._last)==null||i.forAll(r=>r.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(i=>!(i.incarnation<this._incarnation)||(this._cache.put(i.key,i),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((i,r)=>i+r.usedMemory,0))??0}},Bxt=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new F8(e.newCache,"FBOCache"),this._depthCache=new F8(e.newCache,"DepthAttachmentCache"),this._colorCache=new F8(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(i=>i.type===CC.FBO&&e(i.name,i.fbo,i.numberOfColorAttachments))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>{var r;return e+("getTexture"in i?((r=i.getTexture())==null?void 0:r.usedMemory)??0:i.usedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r,n=Vr.RGBA){const s=k8(n,e,i);let o=this._cache.pop(s);if(o){o.retain(),o.setName(r);const a=this.rctx.getBoundFramebufferObject();if(this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([Sn.COLOR_ATTACHMENT0]),!o.fbo)throw new Y("attempt to use a not existing framebuffer");this.rctx.unbindTexture(o.fbo.colorTexture),this.rctx.bindFramebuffer(a)}else o=new qIe(s,r,new Fm(this.rctx,{...zge[n],width:e,height:i}),a=>{a??(a=Ro.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l,c)=>{l??(l=Vr.RGBA);const h=this._acquireColor(l,e,i,c??`${o.name} color ${a}`);return this.rctx.unbindTexture(h.attachment),o.attachColor(h,a),h.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo,o.numberOfColorAttachments),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(e,i,r,n){return this._acquireDepth(e,i,r,n)}_acquireDepth(e,i,r,n){const s=k8(e,i,r),o=this._depthCache.pop(s);if(o)return o.retain(),o.name=n,this._trackHandle(o);const a=e===Ro.DEPTH_STENCIL_TEXTURE?new Uge(s,new fr(this.rctx,{...Vge[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new Uge(s,new cCe(this.rctx,{...Vge[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=n,this._trackHandle(a)}_acquireColor(e,i,r,n){const s=k8(e,i,r),o=this._colorCache.pop(s);if(o)return o.retain(),o.name=n,this._trackHandle(o);const a=new zxt(s,new fr(this.rctx,{...zge[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=n,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};const sv=new qIe("default","default",null,()=>sv,()=>sv,()=>{});function k8(t,e,i){return`${t}x${e}x${i}`}sv.release=()=>!1;const n4=new jr;n4.pixelFormat=kt.RED,n4.internalFormat=gt.R8,n4.wrapMode=Tr.CLAMP_TO_EDGE;const s4=new jr;s4.pixelFormat=kt.RG,s4.internalFormat=gt.RG8,s4.wrapMode=Tr.CLAMP_TO_EDGE;const o4=new jr;o4.internalFormat=gt.RGBA4,o4.dataType=qa.UNSIGNED_SHORT_4_4_4_4,o4.wrapMode=Tr.CLAMP_TO_EDGE;const WIe=new jr;WIe.wrapMode=Tr.CLAMP_TO_EDGE;const uA=new jr;uA.wrapMode=Tr.CLAMP_TO_EDGE,uA.samplingMode=Mi.LINEAR_MIPMAP_LINEAR,uA.hasMipmap=!0,uA.maxAnisotropy=8;const hA=new jr;hA.pixelFormat=kt.RED,hA.dataType=qa.HALF_FLOAT,hA.internalFormat=gt.R16F,hA.samplingMode=Mi.NEAREST;const a4=new jr;a4.dataType=qa.HALF_FLOAT,a4.internalFormat=gt.RGBA16F,a4.samplingMode=Mi.NEAREST;const zge={[Vr.RED]:n4,[Vr.RG]:s4,[Vr.RGBA4]:o4,[Vr.RGBA]:WIe,[Vr.RGBA_MIPMAP]:uA,[Vr.R16F]:hA,[Vr.RGBA16F]:a4},ZT=new jr;ZT.pixelFormat=kt.DEPTH_STENCIL,ZT.dataType=qa.UNSIGNED_INT_24_8,ZT.samplingMode=Mi.NEAREST,ZT.wrapMode=Tr.CLAMP_TO_EDGE,ZT.internalFormat=kt.DEPTH24_STENCIL8;const Vge={[Ro.DEPTH_STENCIL_TEXTURE]:ZT,[Ro.DEPTH16_BUFFER]:new lCe(ha.DEPTH_COMPONENT16,4)};var w3;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(w3||(w3={}));let ag=class{constructor(e,i,r=w3.FrontToBack){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new mi({initialSize:32,allocator:n=>n??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,n,s){const o=this._draws.pushNew();o.geometry=i,o.geometryRanges=r,o.material=e,o.depthSquaredHint=n,o.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0,o.highlightGroupName=s}acquire(e,i){return this._draws.map(r=>r.material.acquireTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=this._draws.data[a];if(e.identifier===za.Highlight){const{highlightGroupName:x}=l;if(x&&(i.highlightGroupIndices.get(x)??0)!==i.highlightLevel)continue}const c=r[a];c===s&&i.oitPass===qi.NONE||(n.bindTechnique(c,i,e),s=c);const{geometryRanges:h,indexType:p,geometry:g,material:y}=l;n.bindVAO(g.vao),this._previouslyBoundDraw.get(c)!==y&&(c.program.bindDraw(i,e,y),this._previouslyBoundDraw.set(c,y));const w=h.length,{primitiveType:b}=g;for(let x=0;x<w;x+=2){const T=h[x],M=h[x+1];if(p!==0){const $=l4.get(p);n.drawElements(b,M,p,T*$)}else n.drawArrays(b,T,M)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===w3.FrontToBack?1:-1;this._draws.sort((i,r)=>{const n=e*(i.depthSquaredHint-r.depthSquaredHint);return n!==0?n:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const l4=new Map;l4.set(Hi.UNSIGNED_BYTE,1),l4.set(Hi.UNSIGNED_SHORT,2),l4.set(Hi.UNSIGNED_INT,4);let VY=class extends nM{constructor(){super({}),this._passes=null,this.produces=new Map([[Ie.OPAQUE_MATERIAL,e=>this._produces(e)],[Ie.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[Ie.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new Dyt,this._shadowPassParameters=new Nyt,this._highlightPassParameters=new Fyt,this._viewshedPassParameters=new kyt,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniques;this._passes={materialOpaque:new ag(i,r),materialTransparent:new ag(i,r,w3.BackToFront),materialIntegratedMesh:new ag(i,r),shadowMap:new ag(i,r),highlight:new ag(i,r),highlightIntegratedMesh:new ag(i,r),highlightShadowMap:new ag(i,r),viewshedShadowMap:new ag(i,r),defaultShadowMap:new ag(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===J.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==J.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bind));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniques.frameUpdate()}}acquireTechniques(e){if(this._systems.size===0)return null;const i=e.output===J.Shadow||e.output===J.ShadowHighlight||e.output===J.ShadowExcludeHighlight?this._shadowPassParameters:e.output===J.ViewshedShadow?this._viewshedPassParameters:e.output===J.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bind;return this._updateParameters(r.camera,i,r.slot===Ie.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(n,s)=>n.acquire(s,e.bind))}render(e,i){this._invoke(e,(r,n)=>r.dispatch(n,e.bind,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bind.slot){case Ie.OPAQUE_MATERIAL:switch(e.output){case J.Color:case J.ColorEmission:case J.Depth:case J.Normal:case J.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case J.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case J.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case J.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case J.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters);case J.ViewshedShadow:return i(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case Ie.TRANSPARENT_MATERIAL:switch(e.output){case J.Color:case J.ColorEmission:case J.Depth:case J.Normal:case J.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case Ie.INTEGRATED_MESH:switch(e.output){case J.Color:case J.ColorEmission:case J.Depth:case J.Normal:case J.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case J.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new wie;return this._systems.forEach(r=>EC(i,r.queryShadowCasterDepthRange(e))),i}get hasEmissions(){let e=!1;return this._systems.forEach(i=>e=i.hasEmissions||e),e}_updateParameters(e,i,r){const n=e.viewInverseTransposeMatrix;ve(U8,n[3],n[7],n[11]),z8.set(U8),ye(i.transformWorldFromViewTH,z8.high),ye(i.transformWorldFromViewTL,z8.low),ye(i.slicePlaneLocalOrigin,U8),qv(i.transformViewFromCameraRelativeRS,e.viewMatrix),ps(i.transformProjFromView,e.projectionMatrix),i.identifier===za.Material&&(this._materialPassParameters.transparent=r,wx(Bge,i.transformViewFromCameraRelativeRS),YC(i.transformNormalViewFromGlobal,Bge))}};VY=u([L("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],VY);const U8=A(),Bge=In(),z8=new OIe;function jxt(t){return t.name}let Gxt=class{constructor(e){this._context=e,this._nodes=new mi}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),W5&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(e){this._nodes.remove(e),W5&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes,n=s=>r.reduce((o,{consumes:a,produces:l})=>o+(!a.required.includes(e)||s!=null&&l!==s?0:1),0);return i.length===0?n():i.reduce((s,o)=>s+n(o),0)}optional(e,...i){const r=this._nodes,n=s=>r.reduce((o,{consumes:a,produces:l})=>{var c;return o+(!((c=a.optional)!=null&&c.includes(e))||s!=null&&l!==s?0:1)},0);return i.length===0?n():i.reduce((s,o)=>s+n(o),0)}updateAnimation(e){return this._nodes.reduce((i,r)=>r.updateAnimation(e)||i,!1)}precompile(...e){++this._context.techniques.precompiling;for(const i of e)this._nodes.forEach(r=>{r.produces===i&&r.precompile()});--this._context.techniques.precompiling}render(e,i,r=()=>{}){const n=e.name,s=this._nodes.filter(({produces:o})=>o===n);return s.length===0?jxt(e)?e:sv:(s.forEach(o=>{var l;const a=[e];for(const c of o.consumes.required){if(c===n)continue;const h=i.get(c);if(h)a.push(h);else if(c!=="emissive"||!((l=i.get(n))!=null&&l.hasAttachment(c)))return void(r&&r(a))}if(o.consumes.optional)for(const c of o.consumes.optional){if(c===n)continue;const h=i.get(c);h&&a.push(h)}try{const c=o.doRender(a);c&&c!==e&&(n!==c.name&&(de.getLogger(o).errorOnce(`RenderNode produced ${c.name}, expected ${n}`),c.setName(n)),e.release(),e=c,i.set(n,e))}catch(c){de.getLogger(o).errorOnce(c)}r&&r(a)}),this._context.rctx.enforceState(),e)}requireGeometryDepth(){return this._nodes.some(e=>e.produces!=="disabled"&&e.requireGeometryDepth)}get test(){return{nodes:this._nodes}}},Hxt=class{constructor(e){this.context=e,this._renderPlugins=new mi,this._slots=new Array,this._version=Xl(0);for(let i=0;i<Ie.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i!=null&&i.aborted)throw e.uninitializeRenderContext(),ki();this._renderPlugins.push(e),e.produces.forEach((s,o)=>this._slots[o].push(e)),this.context.requestRender(),this._version.value++},n=e.initializeRenderContext(this.context,i);if(qu(n))return n.then(r);r()}remove(e){this._renderPlugins.removeUnordered(e),e.uninitializeRenderContext();for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{var n;return i=((n=r.updateAnimation)==null?void 0:n.call(r,e))||i}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}precompile(...e){++this.context.techniques.precompiling;const i=this.context.renderContext.bind.slot;for(const r of e)this.context.renderContext.bind.slot=r,this._slots[r].forEach(n=>{const s=n.produces.get(r);s!=null&&s(this.context.renderContext.output)&&n.precompile(this.context.renderContext)});this.context.renderContext.bind.slot=i,--this.context.techniques.precompiling}_acquireRenderables(){const e=this.context.renderContext.bind.slot,i=this.context.renderContext.output??J.Color,r=new Map;return this._slots[e].forEach(n=>{const s=n.produces.get(e);if(!(s!=null&&s(i))||n.isDecoration&&!this.context.renderContext.bind.decorations)return;const o=n.acquireTechniques(this.context.renderContext);o&&r.set(n,o)}),r}render(e,...i){for(const r of i)this.context.renderContext.bind.slot=r,this._acquireRenderables().forEach((n,s)=>{s.render(this.context.renderContext,n,e),Dz(n)})}queryDepthRange(e){const i=new wie;return this._renderPlugins.forAll(r=>{var s;const n=(s=r.queryDepthRange)==null?void 0:s.call(r,e);EC(i,n)}),i}get updating(){return this._version.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,...i){for(const r of i)if(this._slots[r].some(n=>{const s=n.produces.get(r);return!!s&&s(e)}))return!0;return!1}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get hasEmissions(){return this._renderPlugins.some(e=>e.hasEmissions)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,Dr.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.material?e:e+(i.usedMemory??0),0)}get test(){}},Cie=class extends Ar{};function ZIe(){const t=new or;return t.include(xa),t.fragment.uniforms.add(new ht("colorTexture",e=>e.colorTexture),new ht("alphaTexture",e=>e.alphaTexture),new ht("frontFaceTexture",e=>e.frontFaceTexture)).main.add(C`float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha == 0.0){
fragColor = vec4(0.0);
return;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);`),t}const qxt=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:Cie,build:ZIe},Symbol.toStringTag,{value:"Module"}));let jge=class extends hr{constructor(e,i,r){super(e,i,new ar(qxt,()=>fe(()=>Promise.resolve().then(()=>IAt),void 0)),r)}initializePipeline(){return Pi({blending:gd,colorWrite:Qi})}},Wxt=class{constructor(e){this._techniques=e,this._parameters=new Cie,e.precompile(jge)}blend(e,i,r,n){this._parameters.colorTexture=i.getTexture(),this._parameters.alphaTexture=i.getTexture(Sn.COLOR_ATTACHMENT1),this._parameters.frontFaceTexture=r.getTexture();const s=this._techniques.acquire(jge);e.bindTechnique(s,n,this._parameters),e.screen.draw(),s.release()}},Zxt=class{constructor(e,i){this._camera=e,this._dt=0,this._time=0,this._lastUpdate=0,this._lastUpdate=i,this._time=i}advance(e,i,r){const n=i-this._lastUpdate;this._dt=n/r,this._time=this._time+n,this._lastUpdate=i,this._camera=e}forceTime(e){this._lastUpdate=this._time=e,this._dt=0}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}},Yxt=class{constructor(){this._step=qge,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,pe("disable-feature:high-quality-idle"))this._dilation=1;else{const n=i?performance.now()-this._firstIdleTime:0;if(n>=Gge+Jxt)return this._step=1/0,void(this._dilation=1);this._dilation=n>=Gge?Qxt:1}const r=Oe(e/Xxt,qge,eSt);this._step===1/0?this._step=r:this._step=this._step*Hge+r*(1-Hge)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const Xxt=.5,Gge=12e4,Jxt=1e4,Qxt=10,Hge=.9,Kxt=30,qge=1e3/1,eSt=1e3/Kxt,tSt=1e4,BY=100,iSt=500,rSt=500,nSt=.1;function sSt(t,e,i){let r=0;if(!e.some(s=>!!s.material&&(r+=s.numGeometries,r>=tSt)))return fSt.compute(t,e);const n=TI();return i.forAll(s=>EC(n,oSt(t,s))),n}function oSt(t,e){if(!e.visible)return;const i=TI(),r=e.getSpatialQueryAccelerator();return r?aSt(i,t,r):lSt(i,t,e.objects),i}function aSt(t,e,i){const r=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<iSt)Wk(Nh,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,n,kp.DepthOrder.FRONT_TO_BACK,Nh,(l,c)=>{jY(t,e,l),Nh.far=t.near,c.setRange(Nh)},s,o),Wk(Nh,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,n,kp.DepthOrder.BACK_TO_FRONT,Nh,(l,c)=>{jY(t,e,l),Nh.near=t.far,c.setRange(Nh)},s,o);else{const l=Math.max(Math.min(a,rSt),Math.ceil(a*nSt)),c=i.findClosest(n,kp.DepthOrder.FRONT_TO_BACK,s,o,l),h=i.findClosest(n,kp.DepthOrder.BACK_TO_FRONT,s,o,l);c&&h&&(Wge(t,e,c.boundingVolumeWorldSpace.bounds),Wge(t,e,h.boundingVolumeWorldSpace.bounds))}}function lSt(t,e,i){tT.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&tT.add(r)}),tT.empty||(tT.sort(e),Wk(Nh,e.near,Math.min(t.near,e.far)),tT.forEachInDepthRange(Nh,kp.DepthOrder.FRONT_TO_BACK,(r,n)=>{n<t.near&&jY(t,e,r)}),Wk(Nh,Math.max(t.far,e.near),e.far),tT.forEachInDepthRange(Nh,kp.DepthOrder.BACK_TO_FRONT,(r,n,s)=>{t.far=Math.max(t.far,s)}))}function jY(t,e,i){if(!i.visible||!J_(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,n=pSt;i.geometries.forEach(s=>{fs(n,r,s.transformation);const o=eC(n);YIe(t,e,s.boundingInfo,n,o)})}function YIe(t,e,i,r,n){if(i==null)return;Mt(gl,i.center,r);const{eye:s,viewForward:o}=e,a=o[0]*(gl[0]-s[0])+o[1]*(gl[1]-s[1])+o[2]*(gl[2]-s[2]);if(gl[3]=i.radius*n,!(a-gl[3]>t.near&&a+gl[3]<t.far)&&J_(e.frustum,gl))if(i.radius>BY&&i.getChildren())for(const l of i.getChildren())YIe(t,e,l,r,n);else GY.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Wge(t,e,i){const r=e.eye,n=e.viewForward,s=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];t.near=Math.min(t.near,s-i[3]),t.far=Math.max(t.far,s+i[3])}let cSt=class{constructor(){this._items=new mi({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(n=>{const s=n.object.boundingVolumeWorldSpace.bounds,o=(s[0]-i[0])*r[0]+(s[1]-i[1])*r[1]+(s[2]-i[2])*r[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,i,r){if(i===kp.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.object,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.object,s.near,s.far)}}},uSt=class{constructor(){this._view=ut(),this._viewProj=ut(),this._frustum=HR(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),ps(this._view,e.viewMatrix),fs(this._viewProj,e.projectionMatrix,this._view),U5(this._frustum,e.frustum);const r=this._view,n=r[2],s=r[6],o=r[10],a=r[14];i.forAll(g=>{g.forEachGeometry(y=>{if(!y.visible||!y.castShadow)return;const w=y.boundingSphere,b=n*w[0]+s*w[1]+o*w[2]+a,x=b-w[3],T=b+w[3];this._geometries.push(y),this._near.push(-T),this._far.push(-x)})});const l=new wie;if(this._geometries.length===0)return l;for(let g=0;g<this._geometries.length;++g)this._near[g]>l.far&&(l.far=this._near[g]),this._near[g]>2&&this._far[g]<l.near&&(l.near=this._far[g]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let g=0;g<this._geometries.length;++g)this._near[g]<l.near&&(this._near[g]>=c.near?l.near=this._near[g]:this._nearCandidates[h++]=g),this._far[g]>l.far&&(this._far[g]<=c.far?l.far=this._far[g]:this._farCandidates[p++]=g);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((g,y)=>this._near[g]<this._near[y]?-1:this._near[g]>this._near[y]?1:0),this._farCandidates.sort((g,y)=>this._far[g]<this._far[y]?1:this._far[g]>this._far[y]?-1:0);for(let g=0;g<this._nearCandidates.length;++g){const y=this._nearCandidates[g];if(this._near[y]<l.near){const w=this._geometries[y],b=w.boundingInfo;this._includeNearBoundingInfoRec(b,w.shaderTransformation,l)}}for(let g=0;g<this._farCandidates.length;++g){const y=this._farCandidates[g];if(this._far[y]>l.far){const w=this._geometries[y],b=w.boundingInfo;this._includeFarBoundingInfoRec(b,w.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const n=e.center;Mt(gl,n,i);const s=eC(i),o=gl[0],a=gl[1],l=gl[2],c=e.radius*s,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],g=p+c;if(!(-(p-c)<2||-g>=r.near))if(-g>this._looseRange.near)r.near=-g;else{if(c>BY){const y=e.getChildren();if(y!==void 0){for(const w of y)this._includeNearBoundingInfoRec(w,i,r);return}}GY.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let n=e.radius;const s=e.center;Mt(gl,s,i);const o=eC(i),a=gl[0],l=gl[1],c=gl[2];n*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>n||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>n||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>n||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>n)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-p<=r.far))if(-p<this._looseRange.far)r.far=-p;else{if(n>BY){const g=e.getChildren();if(g!==void 0){for(const y of g)this._includeFarBoundingInfoRec(y,i,r);return}}GY.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},hSt=class{constructor(){this._modelViewProj=ut(),this._clipPosition=[Ti(),Ti(),Ti(),Ti(),Ti(),Ti(),Ti(),Ti()]}unionDepthRangeWithAABB(e,i,r,n,s){const o=this._modelViewProj;fs(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?n[0]:s[0],p=l===0||l===1||l===4||l===5?n[1]:s[1],g=l<4?n[2]:s[2];c[0]=o[0]*h+o[4]*p+o[8]*g+o[12],c[1]=o[1]*h+o[5]*p+o[9]*g+o[13],c[2]=o[2]*h+o[6]*p+o[10]*g+o[14],c[3]=o[3]*h+o[7]*p+o[11]*g+o[15]}for(let l=0;l<12;++l){const c=dSt(this._clipPosition[B8[l][0]],this._clipPosition[B8[l][1]],this._clipPosition[B8[l][2]]);let h=!0;for(let p=0;p<c.length;++p)if(c[p][3]>=2){h=!1;break}if(!h){a=!0;for(let p=0;p<c.length;++p){const g=c[p][3];Number.isFinite(g)&&(e.near=Math.min(g,e.near),e.far=Math.max(g,e.far))}}}return a}};function dSt(t,e,i){let r=[t,e,i];for(let n=0;n<4;++n){const s=r;r=[];for(let o=0;o<s.length;++o){const a=s[o],l=s[(o+1)%s.length];V8(l,n)?(V8(a,n)||r.push(Zge(a,l,n)),r.push(l)):V8(a,n)&&r.push(Zge(a,l,n))}}return r}function V8(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void St(!1)}function Zge(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),YU(Ti(),t,e,r)}const B8=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],gl=Pn(),pSt=ut(),Nh=TI(),tT=new cSt,fSt=new uSt,GY=new hSt;function XIe(){return new Float32Array(4)}function mSt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function uM(t,e,i,r){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function gSt(t,e){return new Float32Array(t,e,4)}function JIe(){return XIe()}function QIe(){return uM(1,1,1,1)}function KIe(){return uM(1,0,0,0)}function ePe(){return uM(0,1,0,0)}function tPe(){return uM(0,0,1,0)}function iPe(){return uM(0,0,0,1)}const rPe=JIe(),ySt=QIe(),_St=KIe(),vSt=ePe(),wSt=tPe(),bSt=iPe();Object.freeze(Object.defineProperty({__proto__:null,ONES:ySt,UNIT_W:bSt,UNIT_X:_St,UNIT_Y:vSt,UNIT_Z:wSt,ZEROS:rPe,clone:mSt,create:XIe,createView:gSt,fromValues:uM,ones:QIe,unitW:iPe,unitX:KIe,unitY:ePe,unitZ:tPe,zeros:JIe},Symbol.toStringTag,{value:"Module"}));let xSt=class{constructor(e){this._fbos=e,this._requiresEmission=!1,this._size=new k0t(0,0),this._clearColor=Ti()}dispose(){this._color=Lr(this._color),this.releaseDepth()}initialize(e,i,r,n){this._size.width=e,this._size.height=i,hb(this._size,this._fbos.rctx.parameters.maxTextureSize);const s=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=n,ed(this._clearColor,r),s}releaseDepth(){var e;(e=this._color)==null||e.detachDepth(),this._depth=Lr(this._depth)}update(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}bind(){const e=this._color==null;if(this.color.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(this.color.fbo),e){const i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(Xi.COLOR|Xi.DEPTH|Xi.STENCIL),this._requiresEmission&&i.gl.clearBufferfv(i.gl.COLOR,1,rPe)}}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"acquired-color").acquireColor(Sn.COLOR_ATTACHMENT1,Vr.RGBA,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"acquired-color")}_acquireDepth(){return this._fbos.acquireDepth(Ro.DEPTH_STENCIL_TEXTURE,this._size.width,this._size.height,"depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??(this._depth=this._acquireDepth()),this._depth}_ensureColor(){return this._color??(this._color=this._acquireColor()),this._color}},SSt=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){var i;(i=this._inputs.get(e))!=null&&i.release()&&this._inputs.delete(e)}};const EI=255,TSt=1/EI;function nPe(){const t=new or,e=t.fragment;return e.include(t1),e.include(qy),t.include(rV),t.include(xa),t.include(mI,ESt),e.uniforms.add(new ht("shadowMap",(i,r)=>r.shadowMap.depthTexture),new ht("depthMap",(i,r)=>{var n;return(n=r.depth)==null?void 0:n.attachment}),new Bs("inverseViewMatrix",(i,r)=>Yl(Yge,hd(Yge,r.camera.viewMatrix,r.camera.center)))),e.constants.add("sampleValue","float",TSt),t.outputs.add("sampleCount","float"),e.main.add(C`sampleCount = 0.0;
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
return;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
return;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (shadow) {
sampleCount = sampleValue;
}`),t}const Yge=ut(),ESt=new Sie,CSt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:EI,build:nPe},Symbol.toStringTag,{value:"Module"}));var MC;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(MC||(MC={}));let HY=class extends Zu{constructor(){super(...arguments),this.visualization=MC.Gradient,this.bandsEnabled=!1}};u([le({count:MC.COUNT})],HY.prototype,"visualization",void 0),u([le()],HY.prototype,"bandsEnabled",void 0);let Mie=class extends Ar{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=qU(MSt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const MSt=Ri(.01,0,.25,1);function sPe(t){const e=new or,i=e.fragment;e.include(rV),e.include(xa);const{visualization:r,bandsEnabled:n}=t;i.constants.add("inverseSampleValue","float",EI),i.uniforms.add(new ht("shadowCastMap",a=>a.shadowCastMap),new rt("sampleScale",a=>a.sampleScale),new rt("opacityFromElevation",a=>a.opacityFromElevation),new Yr("uColor",a=>a.color));const s=r===MC.Gradient,o=r===MC.Threshold;return s&&n?i.uniforms.add(new rt("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new rt("threshold",a=>a.threshold)),i.main.add(C`
    float record = texture(shadowCastMap, uv).r;
    float pixelSamples = record * inverseSampleValue;

    fragColor = vec4(0.0);
    if (pixelSamples < 1.0) {
      return;
    }

    float strength = pixelSamples * sampleScale;
    ${o?C`if (strength <= threshold) return;`:""}
    ${s&&n?C`strength = ceil(strength / bandSize) * bandSize;`:""}
    fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?"* strength":""});
  `),e}const $St=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Mie,build:sPe},Symbol.toStringTag,{value:"Module"}));let Xge=class extends hr{constructor(e,i,r){super(e,i,new ar($St,()=>fe(()=>Promise.resolve().then(()=>PAt),void 0)),r),this.primitiveType=ur.TRIANGLE_STRIP}initializePipeline(){return Pi({blending:gd,colorWrite:Qi,depthTest:null,depthWrite:null})}};const OSt=4e4,ASt=5e4,oPe=1/512;let c4=class extends Ne{constructor(e,i,r,n){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=n,this._passParameters=new Mie(this._data),this._configuration=new HY,this._enabled=!1,this._vao=i1(i)}dispose(){this._stop(),this._vao=Ht(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(Xge,this._configuration)}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._techniques.acquire(Xge,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,e,this._passParameters),this._rctx.drawArrays(i.primitiveType,0,pC(this._vao,"geometry")),i.release()}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>oPe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}get _bandsEnabled(){return this._configuration.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._configuration.bandsEnabled=e,this._requestRenderIfEnabled())}_setColor(e){const i=this._passParameters.color;Ob(e,i)||(ed(this._passParameters.color,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([f()],c4.prototype,"opacityFromElevation",null),c4=u([L("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],c4);let Jge=class extends hr{constructor(e,i,r){super(e,i,new ar(CSt,()=>fe(()=>Promise.resolve().then(()=>LAt),void 0)),r),this.primitiveType=ur.TRIANGLE_STRIP}initializePipeline(){return Pi({blending:_Ke,colorWrite:Qi,depthTest:null,depthWrite:null})}},Nl=class extends Ne{constructor(e,i,r,n,s,o){super({}),this.fbos=e,this._techniques=i,this._stage=r,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new gte,this._cachedLightDirections=[],this._depthRange=kY,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new Zte(new Yte(e,r.viewingMode)),this._bindParameters.shadowMap.enabled=!0,this._vao=i1(this._rctx),this._accumulationRenderer=new c4(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(xt.SHADOW_ACCUMULATOR,this),oe(()=>r.renderView,l=>{this.removeHandles(Qge),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Qge)},hi),oe(()=>this._previewing,()=>this._requestRenderIfEnabled(),xi)],this._shadowAccumulatorKey),i.precompile(Jge)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Ht(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ht(this._fbo),this._vao=Ht(this._vao),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==kY&&this._opacityFromElevation>oPe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(ym(i,e,JE))return;const r=Math.min(EI,e.length);i.length=r,this._sampleCount=r;for(let n=0;n<r;++n)i[n]=ye(i[n]??A(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,n){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=n,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(RSt,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),s>0}precompile(){this._accumulationRenderer.precompile()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,kt.RGBA,qa.UNSIGNED_BYTE,Kge),Kge[0]/this._progress)}_enable(){this._progress=0;const e=new jr;e.pixelFormat=kt.RED,e.internalFormat=gt.R8,e.wrapMode=Tr.CLAMP_TO_EDGE,this._fbo=new Fm(this._rctx,e),this._requestRender()}_disable(){this._fbo=Ht(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Xi.COLOR),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._techniques.acquire(Jge);this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,pC(this._vao,"geometry")),e.release()}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-LR(OSt,ASt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};u([f()],Nl.prototype,"_progress",void 0),u([f()],Nl.prototype,"_sampleCount",void 0),u([f()],Nl.prototype,"_fbo",void 0),u([f()],Nl.prototype,"_depthRange",void 0),u([f()],Nl.prototype,"_previewing",void 0),u([f()],Nl.prototype,"_accumulationRenderer",void 0),u([f()],Nl.prototype,"_isRefining",null),u([f()],Nl.prototype,"_isActive",null),u([f()],Nl.prototype,"canAccumulate",null),u([f()],Nl.prototype,"_isDoneAccumulating",null),u([f()],Nl.prototype,"_opacityFromElevation",null),u([f()],Nl.prototype,"running",null),Nl=u([L("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Nl);const RSt=6,Qge="renderView",Kge=new Uint8Array(4),ISt=Wv();let PSt=class{constructor(){this._plane=Wv()}get plane(){return this._plane}set plane(e){bx(e||ISt,this._plane)}},eye=class{constructor(e,i,r,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},Og=!1;function LSt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new eye(()=>t.createQuery(),r=>{t.deleteQuery(r),Og=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Og||(Og=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),Og=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new eye(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),Og=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Og||(Og=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),Og=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function DSt(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new NSt(i,e)}let NSt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(r,null)})}start(){Og||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Xn;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.DEPTH="depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.APPLY_ACCUMULATED_SHADOWS="apply accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.HIGHLIGHTS="highlights",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH="transparent material without depth",t.OPAQUE_ENVIRONMENT="opaque environment",t.TRANSPARENT_ENVIRONMENT="transparent environment",t.OCCLUDED="occluded",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Xn||(Xn={}));const j8=Object.values(Io).concat(Object.values(ii)).concat(Object.values(Xn)),tye="Total";let FSt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new ry(tye),this._cpuTimeSamplers=new Map(j8.map(i=>[i,new ry(i)])),this._enableGPUTimer=0,this._totalGPUTime=new ry("GPU"),this._gpuTimeSamplers=new Map(j8.map(i=>[i,new ry(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...j8,tye];this._gpuTimerPool=DSt(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Ht(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&(this._gpuTimeSamplers.forEach(e=>e.push(0)),this._gpuTimerPool.start())}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).push(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).set(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(Xn.FINISH);this._gpuTimeSamplers.get(Xn.FINISH).set(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.push(e),this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};class u4{constructor(e,i,r,n,s,o){this._stage=e,this._techniques=r,this._rctx=n,this._compositingHelper=s,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._renderers=new Map,this.renderPassManager=new VY,this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=Ri(0,0,0,1),this._sliceHelper=new PSt,this._blit=null,this._oitblend=null,this._state=Xl(Di.IDLE),this._highQualityTransparencyEnabled=!0,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Yxt,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=Xl(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new SSt,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new Bxt(n),this._renderStateFeatures=Xl(Wue(!pe("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._framebuffer=new xSt(this.fboCache),this.performanceInfo=new FSt(this._rctx),this._shadowMap=new Yte(this.fboCache,e.viewingMode),this._shadowAccumulator=new Nl(this.fboCache,r,e,a=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{const h=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,h),this._renderShadowCascades(J.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new z0t(this._rctx,this._shadowMap,r),this._nodes=new Gxt(this._renderContext),this._plugins=new Hxt({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:e,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this._plugins.add(this.renderPassManager),this._handles=[oe(()=>this._stage.view.state.camera,()=>o(),hi),oe(()=>Cn.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(qh.TRANSPARENT):()=>{},o()},Si),oe(()=>{var a;return(a=this._stage.view.environment.background)==null?void 0:a.color},a=>{const l=a?fie(a):hs;_n(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},hi),oe(()=>this._stage.view.state.camera.relativeElevation,a=>this._inGlobeView=(a??1/0)>=Tk,hi),oe(()=>this._bindParameters.clouds.fadeFactor,()=>this._bindParameters.fadeLighting(),xi),oe(()=>{var a;return(a=this._bindParameters.clouds.data)==null?void 0:a.state},()=>this._requestRender(Gt.UPDATE),xi)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=Sr(this._gpuTimerHandle),this._nodes.destroy(),this._framebuffer.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=jc(this._loadEdgeViewTask),this._edgeView=Ye(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),this._renderers.clear(),this._blit=null,this._oitblend=null,cOe.prune()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}updateRenderFeatures(e=null,i=!pe("disable-feature:high-quality-idle")){this._renderStateFeatures.value=Wue(i,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(n=>n.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Jn.HighQualityTransparency)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(Jn.WaterReflection))}get hasHighlights(){return this._plugins.produces(J.Highlight,Ie.OPAQUE_MATERIAL,Ie.TRANSPARENT_MATERIAL,Ie.DRAPED_MATERIAL,Ie.HUD_MATERIAL,Ie.LABEL_MATERIAL)}get hasHighlightsOnHUD(){return this._plugins.produces(J.Highlight,Ie.HUD_MATERIAL,Ie.LABEL_MATERIAL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(Jn.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(Jn.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Jn.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Lr(this._bindParameters.ssr.lastFrameColor),this._bindParameters.terrainDepth=Lr(this._bindParameters.terrainDepth),this._bindParameters.geometryDepth=Lr(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=Lr(this._bindParameters.depth),this._bindParameters.hudVisibility=Lr(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=Ny(async e=>{const{EdgeView:i}=await fe(()=>import("./EdgeView-CwC2TzLD.js"),__vite__mapDeps([258,45,46,47,259,9,44]));zt(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:zSt(this._stage.view.resourceController)});return this._handles.push(oe(()=>r.updating,()=>this._requestRender(),xi)),this._requestRender(),this._edgeViewCallbacks.forEach(n=>n(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&nQ(this._bindParameters.ssr.reprojectionMatrix,Js)}set _reprojectionMatrix(e){ANe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var n;const{_shadowMap:i,_bindParameters:r}=this;if(((n=e.qualitySettings)==null?void 0:n.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const s=e.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}set slicePlane(e){this._sliceHelper.plane!==e&&(this._sliceHelper.plane=e,this._requestRender())}get plugins(){return this._plugins}getMaterialRenderer(e){return this._renderers.get(e)}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:n,updates:s}=e;r.length===0&&n.length===0&&s.length===0||(cMe(e).forEach((o,a)=>{if(i.done)return;let l=this._renderers.get(a);l==null&&o.adds.length>0&&(l=new lR({material:a}),l.initializeRenderContext(this._plugins.context),this._plugins.add(l),this._renderers.set(a,l)),l&&(l.modify(o),l.numGeometries===0&&(this._renderers.delete(l.material),this._plugins.remove(l),l.destroy())),o.removes.forEach(c=>e.removes.removeUnordered(c)),o.adds.forEach(c=>e.adds.removeUnordered(c)),o.updates.forEach(c=>e.updates.removeUnordered(c)),i.madeProgress()}),this.updateHasFlags())}updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(J.Color,Ie.LINE_CALLOUTS_HUD_DEPTH,Ie.HUD_MATERIAL,Ie.LABEL_MATERIAL),e.water=this._plugins.produces(J.Normal,Ie.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees,this._requestRender()}updateAnimation(e,i){var n;this._animationTimer??(this._animationTimer=new Zxt(e.camera,i)),this._animationTimer.advance(e.camera,i,this._animationTimeDilation),e.forcedAnimationTime!=null&&this._animationTimer.forceTime(e.forcedAnimationTime);const r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(this._animationTimer),this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations=((n=this.overlay)==null?void 0:n.updateAnimation(this._animationTimer))||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Sr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r=Ph.Default,n=!1){try{return this._isRendering=!0,this._render(e,i,r,n)}catch(s){console.error(`Exception during rendering: ${s}`)}finally{this._isRendering=!1}return new _fe(this._pluginInput.get("final-color"),null)}_render(e,i,r=Ph.Default,n){var W,j,Q,Z,X,ge,ae,z;this.performanceInfo.startFrame(),this.fboCache.frameStart(),this.fboCache.interactive=r===Ph.Default,this._disposeBindBuffers();const s=this._framebuffer,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=(W=this.overlay)==null?void 0:W.render(i),this._bindParameters.overlay&&this.performanceInfo.advance(Xn.OVERLAY),this._renderContext.time=i,this._bindParameters.oitPass=qi.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=!n,this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._nodes.produces(ii.VIEWSHED);const h=this._nodes.produces("magnifier-color"),p=this._nodes.produces("final-color");this._bindParameters.slicePlane=this._sliceHelper.plane,o.setGLViewport(this._rctx);const g=this._nodes.require("emissive")>0&&this._plugins.hasEmissions,y=g?J.ColorEmission:J.Color,w=s.initialize(o.fullWidth,o.fullHeight,this._backgroundColor,g);this.hasReflections?(w==null||w.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=w):w==null||w.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!n;const b=this._highQualityTransparency&&this._needsTransparentTerrain,x=this._plugins.produces(J.Color,...W$);this._precompilePrepasses(),this.performanceInfo.advance(Xn.PREPARE);const T=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,T),this._ensureBindParametersCamera(o,a),this._pluginInput.set("normals",this._renderNormals()),this._renderRemainingGeometryDepth(),this._renderShadowAccumulation(T,o,a),this._ensureBindParametersSSR(i),this._precompileShaders(b,x,y),this._renderContext.output=y,s.bind(),this._bindParameters.mainDepth=s.depth.attachment;const M=this.plugins.produces(J.Color,...G8);M&&this._renderOpaqueGeometry(),s.update(he=>this._renderNodes(Io.OPAQUE,he,M)),(Q=(j=this.fboCache).debugCallback)==null||Q.call(j,"opaque-color",s.color.fbo),s.update(he=>this._renderNodes(ii.OPAQUE_ENVIRONMENT,he)),(X=(Z=this.fboCache).debugCallback)==null||X.call(Z,ii.OPAQUE_ENVIRONMENT,s.color.fbo),this._renderTerrainDepth(b),this._setMultipassTerrain(b),this._renderEdges(qh.OPAQUE),s.bind(),this._renderPlugins(Ie.VOXEL,Xn.VOXEL),this._renderHiddenTransparentEdges(),x&&(this._oitEnabled?this._renderOIT(q2.Geometry,y):this._renderTransparentGeometry()),s.update(he=>this._renderNodes(Io.TRANSPARENT,he,x)),(ae=(ge=this.fboCache).debugCallback)==null||ae.call(ge,"transparent-color",s.color.fbo),this._renderGeometryDepth(b),this._renderHUDVisibility(),b||this._plugins.render(this._pluginInput,Ie.LINE_CALLOUTS);const $=r===Ph.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(qh.TRANSPARENT);const R=this._needsTransparentTerrain?this._renderTransparentTerrain():null;R&&(this.performanceInfo.advance(Xn.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(b?this._renderLineCallouts(pl.Occluded):(this._rctx.bindFramebuffer((z=this._bindParameters.hudVisibility)==null?void 0:z.fbo),this._compositingHelper.compositeHUD(this._bindParameters,R.getTexture())),this._renderHUD(pl.Occluded,s.color,y))),this._cullAboveTerrain(!1),R&&(s.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,R.getTexture()),R.release(),b&&(this._renderEdges(qh.OPAQUE),x&&(this._oitEnabled?this._renderOIT(q2.Geometry,y):this._renderTransparentGeometry(),this.performanceInfo.advance(Xn.TRANSPARENT)),this._renderEdges(qh.TRANSPARENT))),this._bindParameters.ssao=Lr(this._bindParameters.ssao),b&&this._renderLineCallouts(pl.NotOccluded),this._setTerrainDepthTest(!1),this._renderTransparentEnvironment(),s.update(he=>this._renderNodes(ii.TRANSPARENT_ENVIRONMENT,he)),s.update(he=>this._renderNodes(ii.VIEWSHED,he)),s.update(he=>this._renderNodes(ii.LASERLINES,he)),s.update(he=>this._renderNodes(ii.OCCLUDED,he)),this._pluginInput.set("highlights",this._renderHighlightPrepass()),s.update(he=>this._renderNodes(Io.COMPOSITE,he));const I=!(r!==Ph.Default||p||h&&!n&&r===Ph.Default),P=this._pluginInput.get(Io.COMPOSITE),N=I?sv:this.fboCache.acquire(P.fbo.width,P.fbo.height,ii.ANTIALIASING),V=this._nodes.produces(ii.ANTIALIASING)?this._renderNodes(ii.ANTIALIASING,N):this._blitFBO(P,N,!1);let U;this._pluginInput.set(ii.ANTIALIASING,V),this.hasHighlightsOnHUD?(this._renderHUD(pl.NotOccluded,V,y),U=this._renderNodes(ii.HIGHLIGHTS,V)):(U=this._renderNodes(ii.HIGHLIGHTS,V),this._renderHUD(pl.NotOccluded,U,y));const B=this._renderNodes(ii.MAGNIFIER,U);return h&&!n&&r===Ph.Default&&!p&&this._blitFBO(B),p?(B.attachDepth(s.depth),this._blitFBO(this._renderNodes(Io.FINAL,B)),B.detachDepth()):this._pluginInput.set(Io.FINAL,B),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),s.releaseDepth(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==Ph.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),new _fe(this._pluginInput.get("final-color"),$)}_precompileShaders(e,i,r){++this._plugins.context.techniques.precompiling,this._renderContext.output=r,this._precompileOpaqueGeometry(),this._setMultipassTerrain(e),this._renderContext.output=J.Depth,this._plugins.precompile(Ie.TRANSPARENT_TERRAIN),e&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry()),this._renderContext.output=r,this._plugins.precompile(Ie.TRANSPARENT_TERRAIN),i&&(this._precompileTransparentGeometry(),this._needsTransparentTerrain&&(this._cullAboveTerrain(!1),this._precompileTransparentGeometry(),this._cullAboveTerrain(e))),this._needsHUDVisibility&&this._plugins.precompile(Ie.OCCLUSION_PIXELS),e&&!this._needsHUDVisibility||this._plugins.precompile(Ie.LINE_CALLOUTS),this._setMultipassTerrain(!1),this._nodes.precompile(ii.VIEWSHED,ii.LASERLINES,ii.OCCLUDED,Io.COMPOSITE,ii.MAGNIFIER),this._shadowAccumulator.precompile(),this._plugins.precompile(Ie.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),--this._plugins.context.techniques.precompiling}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;++this._techniques.precompiling;const e=this._framebufferSize;let i=this.fboCache.acquire(e.width,e.height,"olid");return i.acquireDepth(Ro.DEPTH_STENCIL_TEXTURE),i=this._nodes.render(i,this._pluginInput),--this._techniques.precompiling,this.performanceInfo.advance(Xn.OBJECT_AND_LAYER_ID_COLOR),i}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===Gt.BACKGROUND;if(r||i){const n=r?this.performanceInfo.elapsedTime:0;let s=0;i?s=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();const o=Math.max(n,s);this._animationTimestep.frame(o,r)}}readMainDepth(e,i){var o;const{mainDepth:r,camera:n}=this._bindParameters;if(!r)return;const s=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear-depth");this._rctx.bindFramebuffer(s.fbo),n.setGLViewport(this._rctx),this._rctx.setScissorRect(e[0],e[1],e[2],e[3]),this._rctx.setScissorTestEnabled(!0),this._rctx.clearFramebuffer(hs),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,r),this._rctx.setScissorTestEnabled(!1),this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width),(o=s.fbo)==null||o.readPixels(e[0],e[1],e[2],e[3],kt.RGBA,qa.UNSIGNED_BYTE,i),s.release()}readHUDVisibility(e,i,r,n,s){var o,a;(a=(o=this._bindParameters.hudVisibility)==null?void 0:o.fbo)==null||a.readPixels(e,i,r,n,kt.RGBA,qa.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setTerrainDepthTest(e),this._cullAboveTerrain(e)}_setTerrainDepthTest(e){this._bindParameters.terrainDepthTest=e}_cullAboveTerrain(e){this._bindParameters.cullAboveTerrain=e}_renderEdges(e){const i=this._edgeView;if(!(i!=null&&i.shouldRender()))return;const r=this._framebufferSize,n=this.fboCache.acquire(r.width,r.height,"edges"),s=()=>i.render(this._bindParameters,e),o=this._bindParameters.geometryDepth;this.renderToTargets(s,n,o??this._framebuffer.depth,hs),this._framebuffer.bind(),this._compositingHelper.composite(this._bindParameters,n.getTexture()),n.release(),this.performanceInfo.advance(e===qh.OPAQUE?Xn.OPAQUE_EDGES:Xn.TRANSPARENT_EDGES)}_renderShadowMap(e,i,r){if(!this.shadowsEnabled)return;const n=this._shadowMap;n.start(e,i,r,this.isFeatureEnabled(Jn.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(J.ShadowHighlight,this._shadowMap),n.moveSnapshot(dx.Highlight),this._renderShadowCascades(J.ShadowExcludeHighlight,this._shadowMap),n.copySnapshot(dx.ExcludeHighlight),this._renderShadowCascades(J.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(J.Shadow),n.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(Xn.SHADOW_MAP)}_precompileShadowCascades(e){for(const i of this._shadowMap.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._precompileAllGeometry(e)}_renderShadowCascades(e,i=this._shadowMap){for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this.renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(J.Depth)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._needsShadowAccumulation||this._debugNeedsDepth}_renderRemainingGeometryDepth(){const e=this._pluginInput.get("normals"),i=this._needsDepth;if(e){const r=i?e.getAttachment(rx):null;r==null||r.retain(),this._pluginInput.set(ii.SSAO,this._renderSSAO()),this._renderGeometryWithoutNormalsDepth(i,r)}else this._renderAllGeometryDepth(i)}_renderGeometryWithoutNormalsDepth(e,i){if(!e||!i)return void(this._bindParameters.depth=Lr(this._bindParameters.depth));const r=this._framebufferSize,n=this.fboCache.acquire(r.width,r.height,"depth");n.attachDepth(i),i.release(),this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(Xi.STENCIL),this._renderGeometryWithoutNormals(J.Depth),Lr(this._bindParameters.depth),this._bindParameters.depth=n.obtainDepthTexture(),n.release(),this.performanceInfo.advance(Xn.DEPTH)}_renderAllGeometryDepth(e){if(!e)return void(this._bindParameters.depth=Lr(this._bindParameters.depth));const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"depth").acquireDepth(Ro.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clear(Xi.DEPTH|Xi.STENCIL),this.renderAllGeometry(J.Depth),Lr(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(Xn.DEPTH)}_renderTerrainDepth(e){if(!e)return void(this._bindParameters.terrainDepth=Lr(this._bindParameters.terrainDepth));const i=this._renderContext.output;this._renderContext.output=J.Depth;const r=this._framebufferSize,n=this.fboCache.acquire(r.width,r.height,"terrain depth").acquireDepth(Ro.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(Xi.DEPTH|Xi.STENCIL),this._renderTransparentTerrain(),Lr(this._bindParameters.terrainDepth),this._bindParameters.terrainDepth=n.obtainDepthTexture(),this._renderContext.output=i,n.release()}_renderGeometryDepth(e){if(!e)return void(this._bindParameters.geometryDepth=Lr(this._bindParameters.geometryDepth));const i=this._renderContext.output,{width:r,height:n}=this._framebufferSize,s=this.fboCache.acquire(r,n,"geometry depth").acquireDepth(Ro.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(s.fbo),this._rctx.clear(Xi.DEPTH|Xi.STENCIL),this._renderOpaqueAndTransparentGeometry(J.Depth),this._renderContext.output=i,Lr(this._bindParameters.geometryDepth),this._bindParameters.geometryDepth=s.obtainDepthTexture(),s.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowAccumulation}_computeDepthRange(e){if(!this._needsDepthRange)return kY;const i=sSt(e,this._plugins.plugins,this._stage.layers);return EC(i,this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}get _normalsRequired(){const e=this._nodes.require("normals","final-color",Io.COMPOSITE,"opaque-color","transparent-color","laserline-color");return(this.hasSSAO?1:0)+e}_precompilePrepasses(){this._normalsRequired&&this._precompileAllGeometry(J.Normal),this._needsDepth&&this._precompileAllGeometry(J.Depth),this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(J.ShadowHighlight),this._precompileShadowCascades(J.ShadowExcludeHighlight),this._precompileShadowCascades(J.ShadowHighlight)):this._precompileShadowCascades(J.Shadow)),this._needsShadowAccumulation&&this._precompileAllGeometry(J.Shadow)}_renderNormals(){const e=this._normalsRequired;if(e===0)return;const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"normals",Vr.RGBA);r.acquireDepth(Ro.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(hs,!0,!0),this._renderGeometryWithNormals(J.Normal);const n=this._nodes.optional("normals","final-color",Io.COMPOSITE,"opaque-color","transparent-color","viewshed-color");return r.retain(e+n-1),this.performanceInfo.advance(Xn.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void(e==null?void 0:e.detachDepth());sv.setName(ii.SSAO);const i=this._nodes.render(sv,this._pluginInput);return this._bindParameters.ssao=i,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(Xn.SSAO),i}_precompileAllGeometry(e){const i=this._renderContext.output;this._renderContext.output=e,this._precompileOpaqueGeometry(),this._precompileTransparentGeometry(),this._plugins.precompile(Ie.TRANSPARENT_TERRAIN),this._renderContext.output=i}renderAllGeometry(e){this._renderContext.output=e,this._renderOpaqueAndTransparentGeometry(e),this._renderTransparentTerrain()}precompileSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.precompile(this._renderContext)}precompileOccludedSlots(e,i){for(const r of i)this._renderContext.renderOccludedMask=r,this.precompileSlots(e,...iye);this._renderContext.renderOccludedMask=xE}renderSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.forAll(n=>{const s=n.acquireTechniques(this._renderContext);s&&(n.render(this._renderContext,s,this._pluginInput),Dz(s))})}renderOccludedSlots(e,i){this._renderContext.renderOccludedMask=i,this.plugins.renderOccludedFlags>Dr.Occlude&&this._plugins.render(this._pluginInput,Ie.OCCLUDED_TERRAIN),this.renderSlots(e,...iye),this._renderContext.renderOccludedMask=xE}renderHUD(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(this._pluginInput,Ie.HUD_MATERIAL)}precompileViewshedShadowMap(){this._precompileAllGeometry(J.ViewshedShadow)}renderViewshedShadowMap(e){const{camera:i,contentCamera:r}=this._bindParameters,n=this._renderContext.output;e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,e),this.renderAllGeometry(J.ViewshedShadow),this._ensureBindParametersCamera(i,r),this._bindParameters.camera.setGLViewport(this._rctx),this._renderContext.output=n}_renderOpaqueAndTransparentGeometry(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderGeometryWithNormals(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,...kSt),this._renderTransparentTerrain()}_renderGeometryWithoutNormals(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,...USt)}_precompileOpaqueGeometry(){this._plugins.precompile(...G8)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...G8)}_renderTransparentGeometry(){this._plugins.render(this._pluginInput,...W$)}get _needsTransparentTerrain(){return this._plugins.produces(J.Color,Ie.TRANSPARENT_TERRAIN)}_renderTransparentTerrain(){const e=()=>this._plugins.render(this._pluginInput,Ie.TRANSPARENT_TERRAIN);if(!yd(this._renderContext.output))return void e();const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent terrain");return this.renderToTargets(e,r,this._framebuffer.depth,hs),r}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,Ie.OCCLUSION_PIXELS)}_renderHUDVisibility(){var s,o;if(!this._needsHUDVisibility)return void(this._bindParameters.hudVisibility=Lr(this._bindParameters.hudVisibility));const{width:e,height:i}=this._framebufferSize;let r=this._bindParameters.hudVisibility;((s=r==null?void 0:r.fbo)==null?void 0:s.width)===e&&((o=r==null?void 0:r.fbo)==null?void 0:o.height)===i||(r==null||r.release(),r=this.fboCache.acquire(e,i,"hud visibility",Vr.RGBA4),this._bindParameters.hudVisibility=r);const n=this._bindParameters.geometryDepth;r.attachDepth(n||this._framebuffer.depth),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer([0,1,0,1]),this._plugins.render(this._pluginInput,Ie.OCCLUSION_PIXELS),r.detachDepth(),this._framebuffer.bind(),this.performanceInfo.advance(Xn.HUD_VISIBILITY)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===pl.Occluded){const i=()=>this._plugins.render(this._pluginInput,Ie.LINE_CALLOUTS),r=this._framebufferSize,n=this.fboCache.acquireDepth(Ro.DEPTH16_BUFFER,r.width,r.height,"line callouts");this.renderToTargets(i,this._framebuffer.color,n,void 0,!0,!0),n.release()}else this._plugins.render(this._pluginInput,Ie.LINE_CALLOUTS)}_renderHUD(e,i,r){if(this._pluginsHas.hudElements){if(this._oitEnabled){const n=this._renderOIT(q2.HUD,r,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,n.getTexture()),n.release()}else if(e===pl.Occluded){this._renderContext.output=J.Color;const n=()=>this._renderHUDElements(e),s=this._framebufferSize,o=this.fboCache.acquireDepth(Ro.DEPTH16_BUFFER,s.width,s.height,"hud");this.renderToTargets(n,this._framebuffer.color,o,void 0,!0,!0),o.release()}else this._renderContext.output=J.Color,i.acquireDepth(Ro.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===pl.Occluded?Xn.HUD_OCCLUDED:Xn.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.precompile(Ie.LINE_CALLOUTS_HUD_DEPTH,Ie.HUD_MATERIAL,Ie.LABEL_MATERIAL),this._plugins.render(this._pluginInput,Ie.LINE_CALLOUTS_HUD_DEPTH,Ie.HUD_MATERIAL,Ie.LABEL_MATERIAL)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(J.ShadowHighlight,Ie.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const{fboCache:e,_rctx:i,_bindParameters:r}=this,n=this._framebufferSize,s=e.acquire(n.width,n.height,"highlights",Vr.RG);return s.acquireDepth(Ro.DEPTH_STENCIL_TEXTURE),i.bindFramebuffer(s.fbo),i.clearFramebuffer(hs,!0),this._renderContext.output=J.Highlight,KRe(i,e,n,this._stage.view.highlights,r,()=>this._renderHighlightGeometries(),0,()=>i.bindFramebuffer(s.fbo)),this.performanceInfo.advance(Xn.HIGHLIGHTS),s}_renderHighlightGeometries(){const e=[Ie.TRANSPARENT_MATERIAL,Ie.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,Ie.OPAQUE_MATERIAL,Ie.OPAQUE_MATERIAL_WITHOUT_NORMALS];this._bindParameters.highlightLevel===0&&e.push(Ie.TRANSPARENT_TERRAIN,Ie.INTEGRATED_MESH,Ie.OPAQUE_TERRAIN),this._plugins.precompile(...e),this._plugins.render(this._pluginInput,...e),this._rctx.clear(Xi.DEPTH),this._renderHUDElements(pl.Both)}get _needsShadowAccumulation(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,i,r){this._needsShadowAccumulation&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,i,r)&&this.performanceInfo.advance(Xn.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){++this._plugins.context.techniques.precompiling,this._oitEnabled&&yd(this._renderContext.output)?(this._bindParameters.oitPass=qi.ColorAlpha,this._plugins.precompile(...W$),this._bindParameters.oitPass=qi.FrontFace,this._plugins.precompile(...W$),this._bindParameters.oitPass=qi.NONE):this._plugins.precompile(...W$),--this._plugins.context.techniques.precompiling}_renderOIT(e,i,r=pl.Both){const n=e===q2.HUD,s=this._framebufferSize,o=n?this.fboCache.acquire(s.width,s.height,"oit hud composite"):null,a=n?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),l=this._bindParameters,c=this._renderContext.output;this._renderContext.output=i,l.oitPass=qi.ColorAlpha;const h=o?"oit hud color alpha":"oit color alpha",p=this.fboCache.acquire(s.width,s.height,h,Vr.RGBA16F);p.acquireColor(Sn.COLOR_ATTACHMENT1,Vr.R16F),o||p.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(p.fbo),this._rctx.clearFramebuffer([0,0,0,1]),a(),p.detachDepth(),l.oitPass=qi.FrontFace;const g=this.fboCache.acquire(s.width,s.height,o?"oit hud front":"oit front");return o?g.acquireDepth(Ro.DEPTH16_BUFFER):g.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(g.fbo),this._rctx.clearFramebuffer(hs,!!o),a(),g.detachDepth(),l.oitPass=qi.NONE,o?(this._rctx.bindFramebuffer(o.fbo),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clear(Xi.COLOR)):this._framebuffer.bind(),this._oitblend??(this._oitblend=new Wxt(this._techniques)),this._oitblend.blend(this._rctx,p,g,l),o==null||o.detachDepth(),g.release(),p.release(),this._renderContext.output=c,o}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this.performanceInfo.advance(Xn.APPLY_ACCUMULATED_SHADOWS),this._framebuffer.bind(),this._plugins.render(this._pluginInput,Ie.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),this.performanceInfo.advance(Xn.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(i.setName(e),this._pluginInput.set(e,i),!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;const n=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),n}_blitFBO(e,i=sv,r=!0){return this._blit??(this._blit=new IIe(this._techniques)),this._blit.blit(this._rctx,e,i,this._bindParameters),this._pluginInput.set(e.name,i),r&&e.release(),i}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Js:(Yl(nye,this._bindParameters.camera.viewMatrix),Yl(rye,this._bindParameters.camera.projectionMatrix),fs(iT,nye,rye),fs(iT,this._renderContext.lastFrameCamera.viewMatrix,iT),fs(iT,this._renderContext.lastFrameCamera.projectionMatrix,iT),this._reprojectionMatrix=iT);const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Js,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}updateLighting(e,i,r,n){this._bindParameters.updateLighting(e,i,r,n),this._requestRender(Gt.UPDATE)}get usedMemory(){var e;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:((e=this.edgeView)==null?void 0:e.usedMemory)??0}}renderToTargets(e,i,r,n,s=!1,o=!1){i.attachDepth(r),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(n,s,o),e(),i.detachDepth()}get test(){}}var q2;u([f({readOnly:!0})],u4.prototype,"fullResolutionAtmosphere",null),u([f()],u4.prototype,"_edgeView",void 0),u([f()],u4.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(q2||(q2={}));const kSt=[Ie.INTEGRATED_MESH,Ie.OPAQUE_TERRAIN,Ie.OPAQUE_MATERIAL,Ie.TRANSPARENT_MATERIAL],USt=[Ie.OPAQUE_MATERIAL_WITHOUT_NORMALS,Ie.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],G8=[Ie.INTEGRATED_MESH,Ie.OPAQUE_TERRAIN,Ie.OPAQUE_MATERIAL,Ie.OPAQUE_MATERIAL_WITHOUT_NORMALS],W$=[Ie.TRANSPARENT_MATERIAL,Ie.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],iye=[Ie.OPAQUE_MATERIAL,Ie.TRANSPARENT_MATERIAL,Ie.TRANSPARENT_MATERIAL_WITHOUT_DEPTH],rye=ut(),nye=ut(),iT=ut();function zSt(t){return e=>t.immediate.schedule(e)}let VSt=class{constructor(e){this._rctx=e,this._vao=BSt(e)}destroy(){this._vao=Ht(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(ur.TRIANGLES,0,3))}get test(){}};function BSt(t,e=XRe,i=md){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new km(t,i,new Map([["geometry",e]]),new Map([["geometry",bs.createVertex(t,Vn.STATIC_DRAW,r)]]))}let jSt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new bI(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){var n;const i=e.toString();let r=this._cache.pop(i);return r||(r=new km(this._rctx,this._locations,new Map([["geometry",this._layout]]),new Map([["geometry",bs.createVertex(this._rctx,Vn.STATIC_DRAW)]])),(n=r.vertexBuffers.get("geometry"))==null||n.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e)}},aPe=class lPe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=lPe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return bs.createIndex(this._rctx,Vn.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Ct.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(ur.POINTS,1,Hi.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},sye=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:ei.ONE,dstRGB:ei.ZERO,srcAlpha:ei.ONE,dstAlpha:ei.ZERO},this.blendEquation={mode:Cy.ADD,modeAlpha:Cy.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Lp.BACK,this.frontFace=hC.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=gr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Lp.FRONT_AND_BACK,func:gr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Lp.FRONT_AND_BACK,fail:wn.KEEP,zFail:wn.KEEP,zPass:wn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[Fa.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},GSt=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<Kn.COUNT;)this._current.push(0)}increment(e,i,r=1){var n;this._current[e]+=r,(n=this._allocations)==null||n.add(i)}decrement(e,i,r=1){var n;this._current[e]-=r,(n=this._allocations)==null||n.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<Kn.UNCOUNTED?i:0),0)}get resourceInformation(){var i;let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<Kn.COUNT;++r){const n=this._current[r];n>0&&(e+=`${Kn[r]}: ${n}
`)}}return e+=(i=this._allocations)==null?void 0:i.resetLog(),e}},HSt=class{constructor(e,i,r){const n=i.textureFilterAnisotropic,s=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const qSt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],WSt=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],oye=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],ZSt=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var Wd=999,aye=9999,H8=0,q8=1,lye=2,cye=3,uye=4,HD=5,YSt=6,XSt=7,JSt=8,hye=9,QSt=10,dye=11,KSt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function eTt(){var t,e,i,r=0,n=0,s=Wd,o=[],a=[],l=1,c=0,h=0,p=!1,g=!1,y="";return function(j){return a=[],j!==null?b(j.replace?j.replace(/\r\n/g,`
`):j):x()};function w(j){j.length&&a.push({type:KSt[s],data:j,position:h,line:l,column:c})}function b(j){var Q;for(r=0,i=(y+=j).length;t=y[r],r<i;){switch(Q=r,s){case H8:r=I();break;case q8:r=R();break;case lye:r=$();break;case cye:r=P();break;case uye:r=U();break;case dye:r=V();break;case HD:r=B();break;case aye:r=W();break;case hye:r=M();break;case Wd:r=T()}Q!==r&&(y[Q]===`
`?(c=0,++l):++c)}return n+=r,y=y.slice(r),a}function x(j){return o.length&&w(o.join("")),s=QSt,w("(eof)"),a}function T(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=n+r-1,s=H8,e=t,r+1):e==="/"&&t==="/"?(h=n+r-1,s=q8,e=t,r+1):t==="#"?(s=lye,h=n+r,r):/\s/.test(t)?(s=hye,h=n+r,r):(p=/\d/.test(t),g=/[^\w_]/.test(t),h=n+r,s=p?uye:g?cye:aye,r)}function M(){return/[^\s]/g.test(t)?(w(o.join("")),s=Wd,r):(o.push(t),e=t,r+1)}function $(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(w(o.join("")),s=Wd,r)}function R(){return $()}function I(){return t==="/"&&e==="*"?(o.push(t),w(o.join("")),s=Wd,r+1):(o.push(t),e=t,r+1)}function P(){if(e==="."&&/\d/.test(t))return s=HD,r;if(e==="/"&&t==="*")return s=H8,r;if(e==="/"&&t==="/")return s=q8,r;if(t==="."&&o.length){for(;N(o););return s=HD,r}if(t===";"||t===")"||t==="("){if(o.length)for(;N(o););return w(t),s=Wd,r+1}var j=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||j){for(;N(o););return s=Wd,r}return o.push(t),e=t,r+1}function N(j){for(var Q,Z,X=0;;){if(Q=oye.indexOf(j.slice(0,j.length+X).join("")),Z=oye[Q],Q===-1){if(X--+j.length>0)continue;Z=j.slice(0,1).join("")}return w(Z),h+=Z.length,(o=o.slice(Z.length)).length}}function V(){return/[^a-fA-F0-9]/.test(t)?(w(o.join("")),s=Wd,r):(o.push(t),e=t,r+1)}function U(){return t==="."||/[eE]/.test(t)?(o.push(t),s=HD,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(s=dye,o.push(t),e=t,r+1):/[^\d]/.test(t)?(w(o.join("")),s=Wd,r):(o.push(t),e=t,r+1)}function B(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(w(o.join("")),s=Wd,r):(o.push(t),e=t,r+1)}function W(){if(/[^\d\w_]/.test(t)){var j=o.join("");return s=WSt.indexOf(j)>-1?JSt:ZSt.indexOf(j)>-1?XSt:YSt,w(o.join("")),s=Wd,r}return o.push(t),e=t,r+1}}function tTt(t){var e=eTt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function iTt(t){return tTt(t)}function rTt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const W8=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function nTt(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=r.exec(n.data);if(s){const o=s[1].replaceAll(/\s{2,}/g," ");if(o===i)return o;if(o===e)return n.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function sTt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function dA(t,e,i,r){r=r||i;for(const n of t)if(n.type==="ident"&&n.data===i)return r in e?e[r]++:e[r]=0,dA(t,e,r+"_"+e[r],r);return i}function cPe(t,e,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function n(l){let c=-1,h=0,p=-1;for(let g=0;g<l.length;g++){const y=l[g];if(y.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(y.data)?++h:/#endif\s*.*/.test(y.data)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||y.type==="preprocessor"&&y.data.startsWith("#version")&&(p=Math.max(p,g)),i==="afterPrecision"&&y.type==="keyword"&&y.data==="precision"){const w=r(l,g);if(w===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,w)}c<p&&h===0&&(c=g)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function oTt(t,e,i,r="lowp"){cPe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function aTt(t,e,i,r,n="lowp"){cPe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function lTt(t,e){let i,r,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(i=s),o.data==="]")){r=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),n}function pye(t,e){if(t.startsWith("#version 300"))return t;const i=iTt(t);if(nTt(i,"100","300 es")==="300 es")return t;let r=null,n=null;const s={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===Ru.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Ru.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Ru.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=dA(i,s,"fragColor"),oTt(i,r,"vec4")),l.data=r),e===Ru.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=lTt(i,a+1),h=dA(i,s,"fragData");aTt(i,h,"vec4",c,"mediump"),l.data=h}else e===Ru.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=dA(i,s,"gl_FragDepth")),l.data=n);break;case"ident":if(qSt.includes(l.data)){if(e===Ru.VERTEX_SHADER&&sTt(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=dA(i,s,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c!=null&&c[1]&&W8.has(c[1].trim())){const g=i[a+1];i.splice(a,g&&g.type==="whitespace"?2:1)}const h=l.data.match(/#ifdef\s+(.*)/);h!=null&&h[1]&&W8.has(h[1].trim())&&(l.data="#if 1");const p=l.data.match(/#ifndef\s+(.*)/);p!=null&&p[1]&&W8.has(p[1].trim())&&(l.data="#if 0")}}return cTt(t,rTt(i))}function cTt(t,e){return e}const uTt=4294967295;let hTt=class{constructor(e,i,r,n,s=new Map,o=[]){var c;this._context=e,this._locations=n,this._uniformBlockBindings=s,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=pye(i,Ru.VERTEX_SHADER),r=pye(r,Ru.FRAGMENT_SHADER),this._vShader=fye(this._context,Ru.VERTEX_SHADER,i),this._fShader=fye(this._context,Ru.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Kn.Shader,this),SW()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=i.length+r.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((h,p)=>a.bindAttribLocation(l,h,p)),(c=this._transformFeedbackVaryings)!=null&&c.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),SW()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[h,p]of this._uniformBlockBindings){const g=a.getUniformBlockIndex(l,h);g<uTt&&a.uniformBlockBinding(l,g,p)}this._glName=l,this._context.instanceCounter.increment(Kn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){var e;return!!((e=this._transformFeedbackVaryings)!=null&&e.length)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(Kn.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(Kn.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(Kn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(Kn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(Kn.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){$f(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){$f(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){$f(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){$f(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){$f(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===n[0]&&r===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),n[0]=i,n[1]=r)}setUniform2fv(e,i){$f(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),this._nameToUniform3.set(e,[i,r,n])):i===s[0]&&r===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),s[0]=i,s[1]=r,s[2]=n)}setUniform3fv(e,i){const r=this._getUniformLocation(e);r!=null&&$f(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(r,i)}setUniform4f(e,i,r,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),this._nameToUniform4.set(e,[i,r,n,s])):o!==void 0&&i===o[0]&&r===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),o[0]=i,o[1]=r,o[2]=n,o[3]=s)}setUniform4fv(e,i){const r=this._getUniformLocation(e);r!=null&&$f(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(r,i)}setUniformMatrix3fv(e,i,r=!1){const n=this._getUniformLocation(e);n!=null&&$f(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(n,r,i)}setUniformMatrix4fv(e,i,r=!1){const n=this._getUniformLocation(e);n!=null&&$f(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(n,r,i)}stop(){}};function fye(t,e,i){const r=t.gl,n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),SW()&&!r.getShaderParameter(n,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Ru.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(n)),console.error(dTt(i))),n}function dTt(t){let e=2;return t.replaceAll(`
`,()=>`
`+pTt(e++)+":")}function pTt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function $f(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const n=i.length;if(r.length!==n)return t.set(e,Array.from(i)),!0;for(let s=0;s<n;++s){const o=i[s];if(r[s]!==o){for(r[s]=o;s<n;++s)r[s]=i[s];return!0}}return!1}let fTt=class{constructor(e){this._rctx=e,this._store=new Oy}dispose(){this._store.forAll(e=>e.dispose()),this._store.clear()}acquire(e,i,r,n){const s=this._store.get(e,i);if(s!=null)return s.ref(),s;const o=new hTt(this._rctx,e,i,r,n);return o.ref(),this._store.set(e,i,o),o}get test(){}},bV=class{constructor(){this._result=!1}dispose(){this._program=Ht(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},mTt=class extends bV{constructor(e){super(),this._rctx=e,this._helperProgram=null,pe("mac")&&pe("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=i.getViewport();i.resetState();const l=new jr(1);l.wrapMode=Tr.CLAMP_TO_EDGE,l.samplingMode=Mi.NEAREST;const c=new Fm(i,l),h=bs.createIndex(this._rctx,Vn.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(h,Ct.ELEMENT_ARRAY_BUFFER),i.drawElements(ur.POINTS,1,Hi.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(ur.TRIANGLES,0,258);const p=new Uint8Array(4);return c.readPixels(0,0,1,1,kt.RGBA,qa.UNSIGNED_BYTE,p),i.setViewport(n,s,o,a),i.bindFramebuffer(r),c.dispose(),h.dispose(),p[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${C.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${C.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=aPe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},gTt=class extends bV{constructor(e){super(),this._rctx=e,this._program=mye(this._rctx,!1),this._obfuscated=mye(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Ht(this._obfuscated)}_test(e){if(pe("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._rctx,r=i.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=i.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return i.setViewport(n,s,o,a),i.bindFramebuffer(r),l!==0&&(c===0||l/c>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new jr(1);r.wrapMode=Tr.CLAMP_TO_EDGE,r.samplingMode=Mi.NEAREST;const n=new Fm(i,r),s=bs.createVertex(i,Vn.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new rI(i,new Map([["position",0]]),new Map([["geometry",[new nf("position",2,Hi.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",s]])),a=Qe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Qe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);qZ(a,c,3);const h=new Float32Array(6);qZ(l,h,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(ur.TRIANGLE_STRIP,0,4);const p=new Uint8Array(4);n.readPixels(0,0,1,1,kt.RGBA,qa.UNSIGNED_BYTE,p),o.dispose(),n.dispose();const g=(a[2]-l[2])/25,y=nte(p);return Math.abs(g-y)}};function mye(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(i,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let yTt=class extends bV{constructor(e){var n,s;if(super(),this._rctx=e,!e.gl||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat&&((s=e.capabilities.colorBufferFloat)!=null&&s.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new jr(1);r.wrapMode=Tr.CLAMP_TO_EDGE,r.dataType=qa.FLOAT,r.internalFormat=gt.RGBA32F,r.samplingMode=Mi.NEAREST;const n=new Fm(i,r),s=bs.createVertex(i,Vn.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new rI(i,new Map([["a_pos",0]]),new Map([["geometry",[new nf("a_pos",2,Hi.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",s]]));i.gl.getError(),i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(ur.TRIANGLE_STRIP,0,4);const g=Pi({blending:yKe});i.setPipelineState(g),i.drawArrays(ur.TRIANGLE_STRIP,0,4);const y=i.gl.getError();return i.setViewport(l,c,h,p),i.bindFramebuffer(a),o.dispose(),n.dispose(),y!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}};new nf("a_pos",2,Hi.BYTE,0,2);new nf("a_pos",2,Hi.BYTE,0,4),new nf("a_tex",2,Hi.BYTE,2,4);const _Tt=new Map([["geometry",[new nf("a_pos",2,Hi.UNSIGNED_SHORT,0,4)]]]);let vTt=class extends bV{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new jr(1);r.wrapMode=Tr.CLAMP_TO_EDGE,r.samplingMode=Mi.NEAREST;const n=new Fm(i,r),s=bs.createVertex(i,Vn.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new rI(i,new Map([["a_pos",0]]),_Tt,new Map([["geometry",s]])),a=new jr;a.samplingMode=Mi.LINEAR,a.wrapMode=Tr.CLAMP_TO_EDGE;const l=new fr(i,a,pA);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:h,y:p,width:g,height:y}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(Xi.COLOR),i.bindVAO(o),i.drawArrays(ur.TRIANGLE_STRIP,0,4);const w=new Uint8Array(4);return n.readPixels(0,0,1,1,kt.RGBA,qa.UNSIGNED_BYTE,w),o.dispose(),n.dispose(),l.dispose(),i.setViewport(h,p,g,y),i.bindFramebuffer(c),w[0]!==255}};const pA=new Image;pA.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",pA.width=5,pA.height=5,pA.decode();let wTt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new yTt(e),this.svgPremultipliesAlpha=new vTt(e),this.doublePrecisionRequiresObfuscation=new gTt(e),this.drawArraysRequiresIndicesTypeReset=new mTt(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function bTt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function xTt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function STt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function TTt(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function ETt(t,e,i,r,n){if(e[i])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function CTt(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function MTt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let $Tt=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??(this._compressedTextureETC=bTt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??(this._compressedTextureS3TC=xTt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??(this._textureFilterAnisotropic=STt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??(this._disjointTimerQuery=LSt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??(this._colorBufferFloat=TTt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get loseContext(){return this._loseContext??(this._loseContext=MTt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16??(this._textureNorm16=CTt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??(this._textureFloatLinear=ETt(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},OTt=class{constructor(e,i){this.gl=e,this.instanceCounter=new GSt,this.programCache=new fTt(this),this._transformFeedbackRequestInfo=null,this._state=new sye,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(i)}configure(e){this._capabilities=new $Tt(this.gl,e),this._parameters=new HSt(this.gl,this._capabilities,e),fr.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new sye,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new zKe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const n=r.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const n=r.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=r.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:n}=this._state;n===null?this.setDrawBuffers([Fa.BACK]):n.colorAttachments.length===0?this.setDrawBuffers([Fa.NONE]):this.setDrawBuffers([Sn.COLOR_ATTACHMENT0])}}}),this.enforceState(),Ht(this._driverTest),this._driverTest=new wTt(this)}dispose(){Ht(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Ct.ARRAY_BUFFER),this.unbindBuffer(Ct.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Ct.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Ct.PIXEL_PACK_BUFFER),this.unbindBuffer(Ct.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Ct.COPY_READ_BUFFER),this.unbindBuffer(Ct.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,yp()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,n){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,i,r,n),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,i,r,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,n){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===n||(this.gl.colorMask(e,i,r,n),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,n){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===n||(this.gl.clearColor(e,i,r,n),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===n||(this.gl.scissor(e,i,r,n),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=Lp.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,i,r,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===Lp.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=Lp.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,i,r,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(Cj+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,n=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if((n==null?void 0:n.length)!==e.length||!n.every((s,o)=>s===e[o]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==Fa.BACK&&e[0]!==Fa.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(Fa.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){var r;if(e){if(e&Xi.COLOR){const n=(r=this._state.drawFramebuffer)==null?void 0:r.colorAttachments;n&&this.setDrawBuffers(n),this.setColorMask(!0,!0,!0,!0)}e&Xi.DEPTH&&this.setDepthWriteEnabled(!0),e&Xi.STENCIL&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let n=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),n|=Xi.COLOR}i&&(n|=Xi.DEPTH),r===!1?r=0:(r===!0&&(r=255),n|=Xi.STENCIL),n&&this.clear(n,r)}drawArrays(e,i,r){var n,s;if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(((n=this._state.program)==null?void 0:n.hasTransformFeedbackVaryings)==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(yp()){this._numOfDrawCalls++,this._numOfTriangles+=gye(e,r);const o=this._state.textureUnitMap;for(let a=0;a<o.length;a++){const l=o[a];if(l!=null&&l===((s=this._state.drawFramebuffer)==null?void 0:s.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${a}`)}}this.gl.drawArrays(e,i,r),Gh(this.gl)}drawArraysInstanced(e,i,r,n){this.gl.drawArraysInstanced(e,i,r,n),Gh(this.gl)}drawElements(e,i,r,n){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(yp()&&(this._numOfDrawCalls++,this._numOfTriangles+=gye(e,i)),this.gl.drawElements(e,i,r,n),yp()){const s=oCe(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:i,type:r,offset:n},p=(a==null?void 0:a.size)??0,g=n+i,y=p<g?`. Buffer is too small. Attempted to draw index ${g} of ${p}`:"";console.error(`drawElements: ${s}${y}`,{args:h,vao:c})}}}drawElementsInstanced(e,i,r,n,s){this.gl.drawElementsInstanced(e,i,r,n,s),Gh(this.gl)}logInfo(){yp()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){yp()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,n){r=Math.max(Math.round(r),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===i&&s.width===r&&s.height===n||(s.x=e,s.y=i,s.width=r,s.height=n,this.gl.viewport(e,i,r,n))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:n}){this.setViewport(e,i,r,n)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[i];return(e==null?void 0:e.glName)==null?(n!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[i]=null,n):r||n!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,n):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),n)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(La.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(La.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const n=i===La.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(r||s!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),n?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=0,n=0,s=e.width,o=e.height,a=0,l=0,c=i.width,h=i.height,p=Xi.COLOR,g=Mi.NEAREST){this.bindFramebufferSeparate(e,La.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,La.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,n,s,o,a,l,c,h,p,g)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case Ct.ARRAY_BUFFER:this._state.vertexBuffer=Rl(this.gl,e,i,this._state.vertexBuffer);break;case Ct.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Rl(this.gl,e,i,this._state.indexBuffer);break;case Ct.UNIFORM_BUFFER:this._state.uniformBuffer=Rl(this.gl,e,i,this._state.uniformBuffer);break;case Ct.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Rl(this.gl,e,i,this._state.pixelPackBuffer);break;case Ct.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Rl(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Ct.COPY_READ_BUFFER:this._state.copyReadBuffer=Rl(this.gl,e,i,this._state.copyReadBuffer);break;case Ct.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Rl(this.gl,e,i,this._state.copyWriteBuffer);break;case Ct.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=Rl(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===Ct.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let n=r[i];return n==null&&(n={buffer:null,offset:0,size:0},r[i]=n),n}bindBufferBase(e,i,r){const n=this._getBufferBinding(e,i);n!=null&&(n.buffer===r&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),n.buffer=r,n.offset=0,n.size=0))}bindBufferRange(e,i,r,n,s){const o=this._getBufferBinding(e,i);o!=null&&(o.buffer===r&&o.offset===n&&o.size===s||(n%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,i,r.glName,n,s),o.buffer=r,o.offset=n,o.size=s):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,n){i!=null?(yp()&&(n??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&n!==void 0?this.bindBufferRange(Ct.UNIFORM_BUFFER,e,i.buffer,r,n):this.bindBufferBase(Ct.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(Ct.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const n=this._state.uniformBufferBindingPoints[i];n!=null&&n.buffer===e.buffer&&this.bindBufferBase(Ct.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Ct.ARRAY_BUFFER:this._state.vertexBuffer=Rl(this.gl,null,e,this._state.vertexBuffer);break;case Ct.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Rl(this.gl,null,e,this._state.indexBuffer);break;case Ct.UNIFORM_BUFFER:this._state.uniformBuffer=Rl(this.gl,null,e,this._state.uniformBuffer);break;case Ct.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Rl(this.gl,null,e,this._state.pixelPackBuffer);break;case Ct.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Rl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Ct.COPY_READ_BUFFER:this._state.copyReadBuffer=Rl(this.gl,null,e,this._state.copyReadBuffer);break;case Ct.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Rl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(TW.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(Kn.Sync,r),i.flush();do await mJ(e),n=i.clientWaitSync(r,0,0);while(n===Z5.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Kn.Sync,r),i.deleteSync(r),n===Z5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=La.FRAMEBUFFER){return e===La.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Ct.ARRAY_BUFFER),this.unbindBuffer(Ct.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Ct.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Ct.PIXEL_PACK_BUFFER),this.unbindBuffer(Ct.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Ct.COPY_READ_BUFFER),this.unbindBuffer(Ct.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(ei.ONE,ei.ZERO),this.setBlendEquation(Cy.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Lp.BACK),this.setFrontFace(hC.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(gr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(gr.ALWAYS,0,0),this.setStencilOp(wn.KEEP,wn.KEEP,wn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([Fa.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,n,s;const{gl:e}=this;e.bindVertexArray(null);for(let o=0;o<this.parameters.maxVertexAttributes;o++)e.disableVertexAttribArray(o);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(Ct.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(Ct.UNIFORM_BUFFER,null);for(let o=0;o<this._parameters.maxUniformBufferBindings;o++){const a=this._state.uniformBufferBindingPoints[o];if(a!=null){const{buffer:l,offset:c,size:h}=a;l!==null?c===0&&h===0?e.bindBufferBase(Ct.UNIFORM_BUFFER,o,l.glName):e.bindBufferRange(Ct.UNIFORM_BUFFER,o,l.glName,c,h):e.bindBufferBase(Ct.UNIFORM_BUFFER,o,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(Ct.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(Ct.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(Ct.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(Ct.COPY_WRITE_BUFFER,null),e.bindFramebuffer(La.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(La.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(Sn.COLOR_ATTACHMENT0)),e.bindFramebuffer(La.DRAW_FRAMEBUFFER,((r=this._state.drawFramebuffer)==null?void 0:r.glName)??null),this._state.drawFramebuffer===null){const o=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(o??[Fa.BACK])}else{const o=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(o??[Sn.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const o=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(o)}e.useProgram(((n=this._state.program)==null?void 0:n.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,((s=this._state.renderbuffer)==null?void 0:s.glName)??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(Cj+o),e.bindTexture(vn.TEXTURE_2D,null),e.bindTexture(vn.TEXTURE_CUBE_MAP,null),e.bindTexture(vn.TEXTURE_3D,null),e.bindTexture(vn.TEXTURE_2D_ARRAY,null);const a=this._state.textureUnitMap[o];a!=null&&e.bindTexture(a.descriptor.target,a.glName)}e.activeTexture(Cj+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function Rl(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function gye(t,e){switch(t){case ur.POINTS:return 2*e;case ur.TRIANGLES:return e/3;case ur.TRIANGLE_STRIP:case ur.TRIANGLE_FAN:return e-2;default:return 0}}let ATt=class extends OTt{constructor(e,i){super(e,i),this.gl=e,this._vaoCaches=new Oy,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=i.newCache,this.screen=new VSt(this)}configure(e){super.configure(e),this._newCache=e.newCache}destroy(){var e,i;(e=this._vaoCaches)==null||e.forAll(r=>r.dispose()),(i=this._vaoCaches)==null||i.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy(),this._vaoCaches.forAll(i=>i.dispose()),this._vaoCaches.clear()}get newCache(){return this._newCache}getVaoCache(e,i){const r=Array.from(e).join("."),n=JSON.stringify(i),s=this._vaoCaches.get(r,n);if(s)return s;const o=new jSt(this,e,i);return this._vaoCaches.set(r,n,o),o}bindTechnique(e,i,r,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline()),r&&(e.program.bindPass(r,i),n&&e.program.bindDraw(i,r,n)),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new aPe(this)),this._appleAmdDriverHelper.run())}get test(){}};function yye(t){return!!t.frameUpdate}let YT=class extends Ne{constructor(e,i,r){super({}),this._stage=e,this._techniques=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ns,this._frameTask=e.view.resourceController.scheduler.registerTask(xt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Fo.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniques.acquire(mY,new Xte)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",Gt.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return St(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),n=new RTt(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&i.unload()})});return this._textures.set(e,n),n.ref(),i.glTexture?(this._updateGLTexture(n,i.glTexture),yye(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=i.load(this._rctx),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),yye(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,Bn(l)||de.getLogger(this).error(l),null);return qu(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",Gt.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([f()],YT.prototype,"_loadingCount",void 0),u([f()],YT.prototype,"_frameTask",void 0),u([f()],YT.prototype,"updating",null),YT=u([L("esri.views.3d.webgl-engine.lib.TextureRepository")],YT);let RTt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(de.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function ITt(t,e){return new t3e(i=>T0t(i,t),i=>i,e)}let fA=class extends Ne{constructor(){super(...arguments),this._passParameters=new PTt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=jc(this._resourcesTask),this._passParameters.waveNormal=Ht(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Ht(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=Ny(async i=>{await Promise.allSettled([this._loadImageResource(e,vr("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,vr("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?Nv.LOADED:Nv.LOADING}async _loadImageResource(e,i,r,n){try{const s=await Py(i,{signal:n});zt(n);const o=new jr(s.width,s.height);o.pixelFormat=kt.RGB,o.samplingMode=Mi.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new fr(e,o,s))}catch(s){de.getLogger(this).error("Failed to load water material normal texture.",s)}}};u([f()],fA.prototype,"_resourcesTask",void 0),u([f({type:Boolean,readOnly:!0})],fA.prototype,"updating",null),fA=u([L("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],fA);let PTt=class extends Ar{},Z$=null,Yk=!0;function h4(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(Yk)try{return new ImageData(t,e)}catch{Yk=!1}return uPe(t,e,i)}function N9t(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(Yk)try{return new ImageData(t,e,i)}catch{Yk=!1}const n=uPe(e,i,r);return n.data.set(t,0),n}function LTt(){return Z$||(Z$=document.createElement("canvas"),Z$.width=1,Z$.height=1),Z$}function uPe(t,e,i){return i||(i=LTt()),i.getContext("2d").createImageData(t,e)}async function DTt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await Br(i,{...e,responseType:"image"});return r}catch(r){throw Bn(r)?r:new Y("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function F9t(t,e){const{arrayBuffer:i,mediaType:r}=await NTt(t,e),n=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:s,parseGif:o}=await fe(()=>import("./gif-COwz-YN_.js"),[]);if(s(i))return o(i,e)}if(n){const{isAnimatedPNG:s,parseApng:o}=await fe(()=>import("./apng-MOUh02eg.js"),__vite__mapDeps([260,3]));if(s(i))return o(i,e)}return DTt(new Blob([i],{type:r}),e)}async function NTt(t,e){var n;const i=RE(t);if(i!=null&&i.isBase64)return{arrayBuffer:vve(i.data),mediaType:i.mediaType};const r=await Br(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:((n=r.getHeader)==null?void 0:n.call(r,"Content-Type"))??""}}const _ye=2048,FTt=1.5,kTt=8;function hPe(t,e){const{format:i,quality:r,rotation:n,disableDecorations:s}=t||{},o=$ie(t,e.padding),a=WTt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=qTt(t,a),h=gPe(i),p=yPe[h];return{format:h,quality:Oe(r??p,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function UTt(t,e){const i=hPe(t,e),r=i.area,n=i.width/r.width,s=$ie(i,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*n+o),p=Math.floor(c*n+a),g=(t==null?void 0:t.layers)??[],y=i.ignoreBackground,w=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*n)+s.left,y:Math.floor(r.y*n)+s.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:n,layers:g,disableDecorations:i.disableDecorations,ignoreBackground:y,ignorePadding:w,objectAndLayerIdColor:!1}}function zTt(t,e,i){const{ctx:r,canvas:n}=dPe(t,i),s=r.getImageData(0,0,t.width,t.height),o=fPe(n,e);return pPe(n),{dataUrl:o,data:s}}function VTt(t,e){const{ctx:i,canvas:r}=dPe(t,e),n=i.getImageData(0,0,t.width,t.height);return pPe(r),n}function dPe(t,e){const i=BTt();e.premultipliedAlpha&&JTt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&XTt(r),{ctx:r,canvas:i}}function pPe(t){t.width=0,t.height=0}function BTt(){return Z8==null&&(Z8=document.createElement("canvas")),Z8}let Z8=null;function fPe(t,e){const i=QTt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function jTt(t,e){const i=gPe(t),r=yPe[i];return{format:i,quality:Oe(e??r,0,100)}}function GTt(t,e){return e/Math.max(t[0],t[1])}function mPe(t,e,i,r=0,n=0,s=t.width-r,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:h,data:p}=e,g=s/c,y=o/h,w=Math.ceil(g/2),b=Math.ceil(y/2),x=t.width;for(let T=0;T<h;T++)for(let M=0;M<c;M++){const $=4*(M+(a?h-T-1:T)*c);let R=0,I=0,P=0,N=0,V=0,U=0;const B=(T+.5)*y;for(let W=Math.floor(T*y);W<(T+1)*y;W++){const j=Math.abs(B-(W+.5))/b,Q=(M+.5)*g,Z=j*j;for(let X=Math.floor(M*g);X<(M+1)*g;X++){const ge=Math.abs(Q-(X+.5))/w,ae=Math.sqrt(Z+ge*ge);if(ae>=1)continue;let z=2*ae*ae*ae-3*ae*ae+1;const he=4*(r+X+(n+W)*x);U+=z*l[he+3],I+=z,!i&&l[he+3]<255&&(z=z*l[he+3]/255),P+=z*l[he],N+=z*l[he+1],V+=z*l[he+2],R+=z}}p[$]=P/R,p[$+1]=N/R,p[$+2]=V/R,p[$+3]=U/I}return e}function HTt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:n,pixelRatio:s,region:o}=t,a=$ie(t,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=n-c,g=Math.min(kTt,Math.min((_ye-l)/h,(_ye-c)/p));return g<FTt?t:{...t,framebufferWidth:Math.round(h*g)+l,framebufferHeight:Math.round(p*g)+c,pixelRatio:s*g,resample:{region:{x:Math.round((o.x-a.left)*g)+a.left,y:Math.round((o.y-a.top)*g)+a.top,width:Math.round(o.width*g),height:Math.round(o.height*g)},width:r,height:n}}}function qTt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const n=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/n)}:{width:Math.floor(r*n),height:Math.floor(r)}}function WTt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&n!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,n);else if(r==null&&n!=null){const s=Math.min(i.width,r);i.height=s/i.width*i.height,i.width=s}else if(r!=null&&n==null){const s=Math.min(i.height,n);i.width=s/i.height*i.width,i.height=s}}return ZTt(YTt(i,t),e)}function ZTt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),n={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),h=n.height-c;return{x:n.x,y:Math.floor(n.y+h/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function YTt(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const s=Math.floor(t.height*i);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/i);return t.y-=(n-t.height)/2,t.height=n,t}function $ie(t,e){return!e||t!=null&&t.ignorePadding?e2t:e}function gPe(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return KTt}}function XTt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function JTt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const n=e[r+3];if(n!==255&&n>0){const s=255/n;e[r]=e[r]*s,e[r+1]=e[r+1]*s,e[r+2]=e[r+2]*s}}}const QTt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},vye=98,KTt="png",yPe={png:100,jpg:vye,jpeg:vye},e2t={top:0,right:0,bottom:0,left:0},Y$=Object.freeze(Object.defineProperty({__proto__:null,completeUserSettings:hPe,createEmptyImageData:h4,encode:zTt,encodeData:VTt,getFormatAndQuality:jTt,getMaximumResolutionScale:GTt,resampleHermite:mPe,screenshotSuperSampleSettings:HTt,toDataUrl:fPe,toRenderSettings:UTt},Symbol.toStringTag,{value:"Module"}));let t2t=class{constructor(e,i){this.parameters=e,this.fbos=i}},i2t=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Gt.BACKGROUND);const i=Ho();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const n={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,i);r.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const n=e.getContext("2d"),s=r.pixelRatio;return n.save(),n.translate(0,i.height),n.scale(1,-1),r.region&&n.translate(-r.region.x,-r.region.y),n.scale(s,s),i=this._renderFunctions.renderOverlay(e,r.disableDecorations,i),n.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=h4(r,n,a);this._rctx.gl.readPixels(0,0,r,n,kt.RGBA,Hi.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=h4(s.width,s.height,a);return mPe(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=h4(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,r-(n.y+n.height),n.width,n.height,kt.RGBA,Hi.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,i,r){const n=e.parameters.camera,s={width:i.framebufferWidth,height:i.framebufferHeight};hb(s,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=s.width!==n.fullWidth||s.height!==n.fullHeight,l=i.ignorePadding&&n.pixelRatio!==i.pixelRatio,c=a||i.disableDecorations||l||i.objectAndLayerIdColor;let h=null,p=null;if(c){const b=n.clone();if(i.ignorePadding){const R=qU(b.padding);for(let I=0;I<4;I++)R[I]=Math.round(R[I]/b.pixelRatio*i.pixelRatio);b.padding=R}b.fullWidth=s.width,b.fullHeight=s.height,b.pixelRatio=i.pixelRatio;const x=n.fovX-b.fovX,T=n.fovY-b.fovY;x<0&&x<T?b.fovX=n.fovX:T<0&&T<x&&(b.fovY=n.fovY);const M={camera:b,contentCamera:b,mode:Di.IDLE,alignPixelEnabled:!0,contentPixelRatio:b.pixelRatio,forcedAnimationTime:e.parameters.forcedAnimationTime};this._forceCameraHook(M),o=!0;const $=this._renderFunctions.renderScene(M,r,i.objectAndLayerIdColor?Ph.ObjectAndLayerID:Ph.Screenshot,i.disableDecorations);p=$.screen,h=$.olid}const g=()=>{this._rctx.bindFramebuffer(null),p==null||p.release()};this._rctx.bindFramebuffer(p==null?void 0:p.fbo);const y=this._readbackScreenshot(i,g);let w=null;if(i.objectAndLayerIdColor){const b=()=>{this._rctx.bindFramebuffer(null),h==null||h.release()};this._rctx.bindFramebuffer(h==null?void 0:h.fbo),w=this._readbackScreenshot(i,b),this._rctx.bindFramebuffer(null)}if(c&&!this._rctx.contextAttributes.alpha)for(let b=3;b<y.data.length;b+=4)y.data[b]=255;if(w&&!this._rctx.contextAttributes.alpha)for(let b=3;b<w.data.length;b+=4)w.data[b]=255;return o&&this._forceCameraHook(e.parameters),[y,w]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},ea=class extends Ne{constructor(e){super({}),this.events=new ns,this.waterTextures=new fA,this.olidRenderHelper=_d()?new Uxt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(n){return void console.error("Failed to initialize context",n)}const{memoryController:i}=e.view.resourceController;this.stippleTextures=f0t(this._rctx,i),this.markerTextures=ITt(this._rctx,i),this._techniques=new Kbt(new Qbt(this._rctx,e.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures)),this._textures=new YT(e,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",n=>this.requestRender(n))),this._materials=new e3e(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new kxt(this._rctx,this._techniques),this.renderer=new u4(e,this._materials,this._techniques,this._rctx,this._compositingHelper,n=>this.requestRender(n)),this.addHandles([oe(()=>e.view.ready,n=>{n&&this._createRenderNodes(e.view,e.viewingMode)},Si),oe(()=>{var n;return(n=this.waterTextures)==null?void 0:n.updating},()=>this.requestRender(),Si),oe(()=>e.view.qualityProfile,n=>{var s;return(s=this.renderer)==null?void 0:s.updateRenderFeatures(n)},hi)]);const r={renderScene:(n,s,o,a)=>this.renderer.render(n,s,o,a),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(n,s,o)=>e.options.screenshot.renderOverlay(n,s,o)};this._screenshotManager=new i2t(this._rctx,r,n=>this.events.emit("force-camera-for-screenshot",n)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Sr(this._frameTask),this._techniques=Ye(this._techniques),this._componentObjects=Ye(this._componentObjects),this._screenshotManager=Ye(this._screenshotManager),Ye(this.renderer),this._textures=Ye(this._textures),Ye(this.waterTextures),Ye(this.markerTextures),Ye(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=Ye(this._rctx)}_createRenderNodes(e,i){new zY({view:e,techniques:this._techniques}),DC(e.spatialReference)||(i===ct.Local?new DY({view:e,techniques:this._techniques}):LC(e.spatialReference)?new Nwt({view:e,techniques:this._techniques}):(new IY({view:e,techniques:this._techniques}),new PY({view:e,techniques:this._techniques}),new UY({view:e,techniques:this._techniques}),new LY({view:e,techniques:this._techniques}))),new $w({view:e,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new v_({view:e,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new __({view:e,techniques:this._techniques}),new qT({view:e,techniques:this._techniques}),new Lw({view:e,viewingMode:i,techniques:this._techniques}),new WT({view:e,techniques:this._techniques}),_d()&&new cA({view:e})}requestRender(e=Gt.UPDATE){this._needsRender=!0,e===Gt.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,n,s,o=s){const a=n.constrainWindowSize(i,r,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureLinearDepthArrayBuffer(a);this.renderer.readMainDepth(a,l);const c=(p,g,y)=>nte(g,p)*(y[1]-y[0])+y[0];let h=Number.MAX_VALUE;for(let p=0;p<a[2]*a[3];p++){const g=c(4*p,l,n.nearFar);h>g&&g!==n.nearFar[0]&&g!==n.nearFar[1]&&(h=g)}if(e){const p=e.pickDepth(i*n.pixelRatio,r*n.pixelRatio,n);p!=null&&h>p&&p!==n.nearFar[0]&&p!==n.nearFar[1]&&(h=p)}return h===Number.MAX_VALUE?void 0:h}_ensureLinearDepthArrayBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){var e;d3e(),await this._techniques.reloadAll(),(e=this.renderer.overlay)==null||e.reloadShaders(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,n=Gt.BACKGROUND,s=!1;const o={preRender:({time:a})=>{r=this.updating,n=this._needsUpdate?Gt.UPDATE:Gt.BACKGROUND,e.commitSyncLayers(),(a-this._lastAnimationUpdate>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender)&&(this.renderer.updateAnimation(i,a)&&this.requestRender(Gt.BACKGROUND),this._lastAnimationUpdate=a)},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(i,a),s=!0,l&&this.renderer.hasReflections&&(this.requestRender(Gt.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{this._textures.update();const l=new t2t(i,this.renderer.fboCache);this._screenshotManager.update(l,a)},finish:()=>{s&&(this.renderer.finish(i.mode===Di.IDLE?n:Gt.UPDATE),s=!1)}};this._frameTask=Ub(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=this._canvas.getContext("webgl2",r);n!=null?(this._rctx=r2t(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&de.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&pe("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):de.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(e){var i;return(i=this.olidRenderHelper)==null?void 0:i.getObjectAndLayerIdColor(e)}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new Ybt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};function r2t(t,e){const i=(n,s)=>e.view.resourceController.memoryController.newCache(n,s),r={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8,newCache:i};return new ATt(t,r)}u([f({type:Boolean,readOnly:!0})],ea.prototype,"updating",null),u([f()],ea.prototype,"_rctx",void 0),u([f()],ea.prototype,"_container",void 0),u([f()],ea.prototype,"_canvas",void 0),u([f()],ea.prototype,"stippleTextures",void 0),u([f()],ea.prototype,"markerTextures",void 0),u([f()],ea.prototype,"waterTextures",void 0),u([f({readOnly:!0})],ea.prototype,"olidRenderHelper",void 0),u([f()],ea.prototype,"_textures",void 0),u([f({readOnly:!0})],ea.prototype,"renderer",void 0),u([f()],ea.prototype,"_screenshotManager",void 0),u([f()],ea.prototype,"componentObjectCollection",null),u([f()],ea.prototype,"_componentObjects",void 0),u([f()],ea.prototype,"_needsUpdate",void 0),u([f()],ea.prototype,"_needsWaterReflectionUpdate",void 0),ea=u([L("esri.views.3d.webgl-engine.parts.RenderView")],ea);let Ch=class extends Ne{constructor(e){super(e),this._model=new i4,this._layers=new mi,this._asyncChangeSet=new gZ,this._syncChangeSet=new gZ,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ea(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(xt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),Ik(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(Ik(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var i,r;e!=null&&((i=this._model)==null||i.removeMany(e),(r=this.renderView)==null||r.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return jo}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const n=this._layerSyncSet.has(r.id)||r.updatePolicy===yv.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,s),this._layerSyncSet.delete(r.id),s.empty||(this.renderer.modify(s,n?kc:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,kc),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==yv.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===yv.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,kc),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,kc),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,kc))}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),n=()=>{Cpe(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(qu(r))return r.then(n);n()}removeRenderPlugin(e){this.destroyed||(Cpe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};u([f({constructOnly:!0})],Ch.prototype,"view",void 0),u([f({constructOnly:!0})],Ch.prototype,"options",void 0),u([f({readOnly:!0})],Ch.prototype,"viewingMode",null),u([f({constructOnly:!0})],Ch.prototype,"container",void 0),u([f({readOnly:!0})],Ch.prototype,"updating",null),u([f({constructOnly:!0})],Ch.prototype,"_model",void 0),u([f()],Ch.prototype,"renderView",void 0),u([f({readOnly:!0})],Ch.prototype,"renderer",null),u([f({readOnly:!0})],Ch.prototype,"running",null),Ch=u([L("esri.views.3d.webgl-engine.Stage")],Ch);function B9t(t){return t&&typeof t.highlight=="function"}function n2t(t){return t&&typeof t.maskOccludee=="function"}function s2t(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function j9t(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(o2t(i,r))return s2t(e,i,r)}return!0}function o2t(t,e){return t!=null&&t>0||e!=null&&e>0}function G9t(t){return!(t!=null&&t.minScale)||!t.maxScale||t.minScale>=t.maxScale}function H9t(t,e,i){return new Y("layerview:spatial-reference-incompatible",`The spatial reference of this ${t}${e?`(wkid:${e})`:""} is incompatible with the spatial reference of the view${i?`(wkid:${i})`:""}.`,{})}let Y8;function a2t(){return Y8||(Y8=u2t()),Y8}let l2t=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function c2t(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=e.getContext("webgl2"),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function u2t(){const t=new l2t,e=c2t(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function h2t(t){const e=a2t();return e.available?t==="3d"&&e.majorPerformanceCaveat?new Y("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new Y("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new Y("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new Y("webgl:required","WebGL2 is required but not supported.",new Error().stack)}const _Pe="calcite-mode-";function d2t(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function p2t(){return d2t().startsWith("dark")}function f2t(){return`${_Pe}${p2t()?"dark":"light"}`}function m2t(t){g2t(t),t.classList.add(f2t())}function g2t(t){Array.from(t.classList).forEach(e=>{e.startsWith(_Pe)&&t.classList.remove(e)})}const y2t={left:0,top:0,bottom:0,right:0},vPe={bottom:30,top:15,right:15,left:15},lg="esri-ui",gc={ui:lg,corner:`${lg}-corner`,innerContainer:`${lg}-inner-container`,manualContainer:`${lg}-manual-container`,cornerContainer:`${lg}-corner-container`,topLeft:`${lg}-top-left`,topRight:`${lg}-top-right`,bottomLeft:`${lg}-bottom-left`,bottomRight:`${lg}-bottom-right`};function _2t(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function qD(t){return t===0?"0":`${t}px`}function X8(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function J8(t,{top:e,bottom:i,left:r,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=n}let qf=class extends ns.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=Vc(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&J8(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&J8(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([oe(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Si),oe(()=>this.padding,this._applyUIPadding,Si),oe(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Si),g1e(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(gc.ui),m2t(e),this._attachContainers(e)),i&&(i.classList.remove(gc.ui),J8(i,{top:"",bottom:"",left:"",right:""}),i.textContent=""),this._set("container",e))}get height(){var s;const e=((s=this.view)==null?void 0:s.height)??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:n}=i;return Math.max(e-r-n,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...vPe,...e}}get width(){var s;const e=((s=this.view)==null?void 0:s.width)??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:n}=i;return Math.max(e-r-n,0)}add(e,i){let r,n,s;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=X8(e);o&&({index:r,position:i,component:e,key:n}=o),i&&typeof i=="object"&&({index:r,key:n,position:i,internal:s}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,n,s)}remove(e,i){var n,s;if(!e)return;if(Array.isArray(e))return e.map(o=>this.remove(o,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&((n=this._componentMap.get(r))==null?void 0:n.key)!==i)return;const o=this._components.indexOf(r),a=r.node.parentNode;return a==null||a.removeChild(r.node),this._componentMap.delete(r),(s=r.widget)==null||s.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(o,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,i);return}const r=this._positionNameToContainerLookup[e??"manual"],n=Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(s=>{var o;return s==null?!1:!(((o=this._componentMap.get(s))==null?void 0:o.internal)??!1)||i.removeInternal});for(const s of n)this.remove(s)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const n=X8(e)||X8(i);if(n&&(r=n.index,i=n.position,e=n.component||e),i&&!this._isValidPosition(i))return;const s=this.remove(e);s&&this.add(s,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>{var n;return i.includeInternal||!((n=this._componentMap.get(r))!=null&&n.internal)}).map(({widget:r,node:n})=>r??n)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,n,s){e instanceof KA||(e=new KA({node:e}));const{widget:o}=e;o!=null&&o instanceof Ne&&o.addHandles(Ui(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:n,internal:s})}_find(e){return e?e instanceof KA?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??y2t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(gc.innerContainer,gc.cornerContainer);const i=document.createElement("div");i.classList.add(gc.innerContainer,gc.manualContainer);const r=document.createElement("div");r.classList.add(gc.topLeft,gc.corner),e.appendChild(r);const n=document.createElement("div");n.classList.add(gc.topRight,gc.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(gc.bottomLeft,gc.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(gc.bottomRight,gc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=rqe();this._cornerNameToContainerLookup={"top-left":r,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:r,"top-trailing":a?r:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){var c,h;const i=e.position??"manual",{component:r,index:n}=e,s=this._positionNameToContainerLookup[i],o=n!=null&&n>-1;if(_2t(r.widget)&&r.widget.startup(),!o)return void s.appendChild(r.node);const a=Array.from(s.children);if(n===0){const{firstChild:p}=s;return void(p?(c=p.parentNode)==null?void 0:c.insertBefore(r.node,p):s.appendChild(r.node))}if(n>=a.length)return void s.appendChild(r.node);const l=a[n];(h=l.parentNode)==null||h.insertBefore(r.node,l)}_toPixelPosition(e){return{top:qD(e.top),left:qD(e.left),right:qD(e.right),bottom:qD(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(Bv).filter(n=>{var s;return i.includeInternal||!((s=this._componentMap.get(n))!=null&&s.internal)}).map(({widget:n,node:s})=>n??s)}};u([f()],qf.prototype,"_locale",void 0),u([f()],qf.prototype,"container",null),u([f()],qf.prototype,"height",null),u([f({value:vPe})],qf.prototype,"padding",null),u([$i("padding")],qf.prototype,"castPadding",null),u([f()],qf.prototype,"view",void 0),u([f()],qf.prototype,"width",null),qf=u([L("esri.views.ui.UI")],qf);const v2t=qf;let d4,p4=null;const SE=new Map;async function Z9t(t){p4==null&&(d4==null&&(d4=fe(()=>import("./Lyr3DWasmPerSceneView-SFMQybRk.js"),__vite__mapDeps([261,93,9,94,153]))),p4=await d4);const e=t.view;let i=SE.get(e);i||(i=new p4.default({view:e}),SE.set(e,i));const r=!!e._stage.renderView.renderingContext.capabilities.compressedTextureS3TC;return await i.initializeWasm(r),i.add3DTilesLayerView(t)}function w2t(t){return SE.get(t)}function Y9t(t){const e=t.view,i=SE.get(e);i&&i.remove3DTilesLayerView(t)<1&&(SE.delete(e),SE.size===0&&(d4=null,p4=null))}function wye(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function b2t(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function X$(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function x2t(t){return t.type==="bing-maps"}const cg=[];let XT=class extends Ne{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ot,this.view=null,this._allLayerViewsChange=i=>{var n;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=(n=this.view)==null?void 0:n.allLayerViews;r&&(this.addHandles(r.map(s=>oe(()=>{var o;return[s.suspended,(o=s.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(s=>{s.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i!=null&&i.removed&&i.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([Vo(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Kl(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e==null?void 0:e.allLayerViews;if(cg.length=0,!e||!i)return void this._clear();i.forEach(n=>{var a,l;if(n.suspended||!((a=n.layer)!=null&&a.attributionVisible))return;const s=n.layer;if(wye(s,"user"))return void X$(cg,n,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(n)){const c=this._fetchedAttributionData.get(n);return void(c?X$(cg,n,this._getDynamicAttribution(c,e,s)):wye(s)&&X$(cg,n,s.copyright))}return void this._fetchAttributionData(n)}const o="portalItem"in s?(l=s.portalItem)==null?void 0:l.accessInformation:void 0;X$(cg,n,o||s.copyright)});const r=i.find(n=>{var s;return((s=n.layer)==null?void 0:s.type)==="integrated-mesh-3dtiles"});if(this.view&&r){const n=w2t(this.view);if(n){const s=n.getAttributionText();for(let o=0;o<s.length;++o)X$(cg,r,s[o])}}b2t(this.items,cg)&&(this.items.removeAll(),this.items.addMany(cg)),cg.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Xp(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,x2t(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,n={};if(!r)return n;for(let s=0;s<r.length;s++){const o=r[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(i&&l.zoomMin?1:0),p=l.zoomMax-(i&&l.zoomMax?1:0),g=new pr({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:nt.WGS84}),y={extent:DA(g),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let w=h;w<=p;w++)n[w]??(n[w]=[]),n[w].push(y)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,i,r){var h;const{extent:n,scale:s}=i;let o=((h=r.tileInfo)==null?void 0:h.scaleToZoom(s))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=k3(n.center.clone().normalize(),nt.WebMercator),c=new Set;return a?a.filter(p=>{const g=p.id,y=!c.has(g)&&l&&p.extent&&jJ(p.extent,l);return y&&c.add(g),y}).sort((p,g)=>g.score-p.score||p.objectId-g.objectId).map(p=>p.attribution).join(", "):""}};u([f({readOnly:!0,type:ot})],XT.prototype,"items",void 0),u([f({readOnly:!0})],XT.prototype,"state",null),u([f()],XT.prototype,"view",void 0),XT=u([L("esri.widgets.Attribution.AttributionViewModel")],XT);const wPe=XT,gm={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function S2t(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:E2t(t[e])}}}function T2t(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function E2t(t){return function(e,...i){T2t(e)?aqe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}const rT="esri-attribution",nT={base:rT,poweredBy:`${rT}__powered-by`,sources:`${rT}__sources`,open:`${rT}--open`,sourcesOpen:`${rT}__sources--open`,link:`${rT}__link`};let Fl=class extends cI{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new wPe}initialize(){this.addHandles(Vo(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[nT.open]:this._isOpen};return ya("div",{bind:this,class:this.classes(nT.base,gm.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return ya("div",{class:nT.poweredBy},"Powered by"," ",ya("a",{class:nT.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:n}=this,s={[nT.sourcesOpen]:e,[gm.interactive]:i};return ya("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(nT.sources,s),innerHTML:n,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([f()],Fl.prototype,"_isOpen",void 0),u([f()],Fl.prototype,"_isInteractive",null),u([f()],Fl.prototype,"_attributionTextOverflowed",void 0),u([f()],Fl.prototype,"_prevSourceNodeHeight",void 0),u([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Fl.prototype,"attributionText",null),u([f()],Fl.prototype,"icon",null),u([f()],Fl.prototype,"itemDelimiter",void 0),u([f()],Fl.prototype,"label",null),u([f(),gC("esri/widgets/Attribution/t9n/Attribution")],Fl.prototype,"messages",void 0),u([f()],Fl.prototype,"view",null),u([f({type:wPe})],Fl.prototype,"viewModel",void 0),u([S2t()],Fl.prototype,"_toggleState",null),Fl=u([L("esri.widgets.Attribution")],Fl);const C2t=Fl;function M2t(){const t=pe("mapview-essential-goto-duration");return t==null?t:t}function $2t(t){var e,i;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((i=t==null?void 0:t.spatialReference)==null?void 0:i.isGeographic)||!1}const O2t=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return nU(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([f()],e.prototype,"goToOverride",void 0),u([f()],e.prototype,"view",void 0),e=u([L("esri.widgets.support.GoTo")],e),e};let Dw=class extends O2t(Ne){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(oe(()=>this.view,this._updateRotationWatcher,Si))}destroy(){this.view=null}get canShowNorth(){return $2t(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var e,i;(e=this.view)!=null&&e.ready&&(((i=this.view)==null?void 0:i.type)==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:M2t()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?oe(()=>e==null?void 0:e.rotation,this._updateForRotation,Si):oe(()=>e==null?void 0:e.camera,this._updateForCamera,Si))}};u([f({readOnly:!0})],Dw.prototype,"canShowNorth",null),u([f({readOnly:!0})],Dw.prototype,"orientation",void 0),u([f({readOnly:!0})],Dw.prototype,"state",null),u([f()],Dw.prototype,"view",void 0),Dw=u([L("esri.widgets.Compass.CompassViewModel")],Dw);const bPe=Dw,bye="esri-compass",xye={base:bye,iconContainer:`${bye}__icon-container`};let Ag=class extends cI{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new bPe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return Nee({button:()=>fe(()=>import("./calcite-button-RIv1aLq6.js"),__vite__mapDeps([262,263,264,265,266,267,268,269,270,271,272,273,274,275])),icon:()=>fe(()=>import("./calcite-icon-Baad3yhW.js"),__vite__mapDeps([276,273,264,271]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return ya("div",{class:this.classes(xye.base,gm.widget)},ya("calcite-button",{class:gm.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},ya("div",{"aria-hidden":"true",class:xye.iconContainer,title:r.reset},ya("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};u([f()],Ag.prototype,"goToOverride",null),u([f()],Ag.prototype,"icon",null),u([f()],Ag.prototype,"label",null),u([f(),gC("esri/widgets/Compass/t9n/Compass")],Ag.prototype,"messages",void 0),u([f()],Ag.prototype,"view",null),u([f({type:bPe})],Ag.prototype,"viewModel",void 0),Ag=u([L("esri.widgets.Compass")],Ag);const A2t=Ag,Sye="esri-navigation-toggle",Tye={base:Sye,isLayoutHorizontal:`${Sye}--horizontal`};let JT=class extends Ne{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(Kl(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,i;return(e=this.view)!=null&&e.ready&&((i=this.view)==null?void 0:i.type)==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){var i;const e=(i=this.view)==null?void 0:i.inputManager;e&&(e.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};u([f({readOnly:!0})],JT.prototype,"state",null),u([f()],JT.prototype,"_navigationMode",void 0),u([f()],JT.prototype,"view",void 0),JT=u([L("esri.widgets.NavigationToggle.NavigationToggleViewModel")],JT);const xPe=JT;let Rg=class extends cI{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new xPe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var n;const r=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan"?this._rotateButton:this._panButton;lqe(r),this.toggle()}}loadDependencies(){return Nee({button:()=>fe(()=>import("./calcite-button-RIv1aLq6.js"),__vite__mapDeps([262,263,264,265,266,267,268,269,270,271,272,273,274,275]))})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var n,s;const e=((n=this.viewModel)==null?void 0:n.state)==="disabled",i=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan",r=this.messages.toggle;return ya("div",{class:this.classes(Tye.base,gm.widget,{[Tye.isLayoutHorizontal]:this.layout==="horizontal"})},ya("calcite-button",{afterCreate:o=>{this._panButton=o},appearance:i?"outline-fill":"solid",class:gm.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),ya("calcite-button",{afterCreate:o=>{this._rotateButton=o},appearance:i?"solid":"outline-fill",class:gm.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};u([f()],Rg.prototype,"icon",null),u([f()],Rg.prototype,"label",null),u([f({value:"vertical"})],Rg.prototype,"layout",null),u([f(),gC("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Rg.prototype,"messages",void 0),u([f()],Rg.prototype,"view",null),u([f({type:xPe})],Rg.prototype,"viewModel",void 0),Rg=u([L("esri.widgets.NavigationToggle")],Rg);const R2t=Rg;let Nw=class extends Ne{get canZoomIn(){var r,n,s;if(!((r=this.view)==null?void 0:r.ready))return!1;const i=(s=(n=this.view)==null?void 0:n.constraints)==null?void 0:s.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){var n;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const r=(n=e.constraints)==null?void 0:n.effectiveMinScale;return r===0||this._scale<r}get _scale(){var i,r,n;const e=(r=(i=this.view)==null?void 0:i.animation)==null?void 0:r.target;return(e&&"then"in e||e==null?void 0:e.scale)??((n=this.view)==null?void 0:n.scale)??0}};u([f({readOnly:!0})],Nw.prototype,"canZoomIn",null),u([f({readOnly:!0})],Nw.prototype,"canZoomOut",null),u([f()],Nw.prototype,"view",void 0),u([f()],Nw.prototype,"_scale",null),Nw=u([L("esri.widgets.Zoom.ZoomConditions2D")],Nw);const I2t=Nw;let QT=class extends Ne{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([f({readOnly:!0})],QT.prototype,"canZoomIn",null),u([f({readOnly:!0})],QT.prototype,"canZoomOut",null),u([f()],QT.prototype,"view",void 0),QT=u([L("esri.widgets.Zoom.ZoomConditions3D")],QT);const P2t=QT;let w_=class extends Ne{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new I2t({view:e}):e.type==="3d"&&(this._zoomConditions=new P2t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():bR(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():bR(e.goTo({zoomFactor:.5}))}};u([f()],w_.prototype,"_zoomConditions",void 0),u([f()],w_.prototype,"canZoomIn",null),u([f()],w_.prototype,"canZoomOut",null),u([f({readOnly:!0})],w_.prototype,"state",null),u([f()],w_.prototype,"view",null),w_=u([L("esri.widgets.Zoom.ZoomViewModel")],w_);const SPe=w_,Eye={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let Ig=class extends cI{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new SPe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Nee({button:()=>fe(()=>import("./calcite-button-RIv1aLq6.js"),__vite__mapDeps([262,263,264,265,266,267,268,269,270,271,272,273,274,275]))})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Eye.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:n,zoomOut:s}=this.messages;return ya("div",{class:this.classes(Eye.base,gm.widget,e)},ya("calcite-button",{class:gm.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:n,onclick:this.zoomIn,title:n}),ya("calcite-button",{class:gm.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:s,onclick:this.zoomOut,title:s}))}};u([f()],Ig.prototype,"icon",null),u([f()],Ig.prototype,"label",null),u([f({value:"vertical"})],Ig.prototype,"layout",null),u([f(),gC("esri/widgets/Zoom/t9n/Zoom")],Ig.prototype,"messages",void 0),u([f()],Ig.prototype,"view",null),u([f({type:SPe})],Ig.prototype,"viewModel",void 0),Ig=u([L("esri.widgets.Zoom")],Ig);const L2t=Ig;function D2t(t){return(t==null?void 0:t.view)!==void 0}let f4=class extends v2t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const n=this._find(r),s=n==null?void 0:n.widget;D2t(s)&&(s.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([oe(()=>this.components,this._componentsWatcher,Si),oe(()=>this.view,this._updateViewAwareWidgets,Si)])}_add(e,i,r,n,s){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,n,s)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new KA({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new C2t({view:i});case"compass":return new A2t({view:i});case"navigation-toggle":return new R2t({view:i});case"zoom":return new L2t({view:i})}}};u([f()],f4.prototype,"components",void 0),f4=u([L("esri.views.ui.DefaultUI")],f4);const TPe=f4;let m4=class extends TPe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([f()],m4.prototype,"components",void 0),m4=u([L("esri.views.ui.3d.DefaultUI3D")],m4);const EPe=m4;let lt=class extends a7e(FYe(Sqe(FQe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._overrideDefaultEnvironmentOnly=!0,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Sy({slicePlane:bSe},this),this._resourceController=xgt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new UZ({view:this}),this.labeler=new Rw({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new iC,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Kw,this.environment=new LT,this.environmentManager=new xh,this.floors=new ot,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new zQe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new gmt({view:this}),this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new EPe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlights=Xmt(),B8e();const e=(i=null)=>{i!=null&&i.type===Pr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([Vo(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),oe(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new eot({view:this}),this.stateManager=new Wn({view:this})}initialize(){this.groundView=new EYe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Vo(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Si),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Si),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>LFe(e>0?1e3/Math.ceil(e):0),Si),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,hi),this.updatingHandles.add(()=>{var e,i;return(i=(e=this.map)==null?void 0:e.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),hi),this.addHandles(oe(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),xi))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Ye(this.sharedSymbolResources),this._set("labeler",Ye(this.labeler)),this._set("deconflictor",Ye(this.deconflictor)),this._resourceController=Ye(this._resourceController),this._set("stateManager",Ye(this.stateManager)),this._set("inputManager",Ye(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Ye(this.environmentManager)),this._set("environment",Ye(this.environment)),this.groundView=Ye(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy(),this.highlights.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){return this.state.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||Vse(t,"clippingArea");return!this._userClippingArea&&!Vse(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof pr?this.spatialReference&&(e=WD(e,this.spatialReference),e==null)?(de.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(de.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?de.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===ct.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:WD(e,t)}get tileInfo(){var t,e;return(e=(t=this.basemapTerrain)==null?void 0:t.tilingScheme)==null?void 0:e.toTileInfo()}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||nt.WGS84,i=WD(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||nt.WGS84;let e;const i=s=>{const o=WD(s,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const s=r.groundExtent;i(new pr({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}castEnvironment(t){var e;return t?t instanceof LT?t:t instanceof YE?((e=this.environment)==null?void 0:e.cloneWithWebsceneEnvironment(t))??LT.fromWebsceneEnvironment(t):is(LT,t):new LT}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){var t;return!this.animation&&!this.resizing&&(((t=this.state)==null?void 0:t.stationary)??!0)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){HF.isValidProfile(t)&&(HF.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||HF.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&(this._stage.renderer.slicePlane=t),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");bx(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){var t;return!!this.viewingMode&&!!((t=this.stateManager)!=null&&t.preinit(this.spatialReference))}get resolution(){return this.spatialReference!=null?i7e(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?Gv.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o,a;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(l=>{if(l.isFulfilled()){if(l.updating){if(e=!0,l.suspended||uY(l))return;++i,t+=l.updatingProgress}}else++i});for(const l of this._updatingObjects)l!=null&&l.updating&&(i+=.1,t+=.5*.1);for(const l of this._updatingObjectsWithProgress)l!=null&&l.updating&&(++i,t+=l.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.updating||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(l=>!l.isFulfilled())||(a=this.textures)!=null&&a.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const l=performance.now();if(t<1){const c=Math.min((l-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-c)+t*c}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?l:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var i;const t=this._predeterminedViewingMode;if(t!=null)return W6(t);const e=this.spatialReference;return e?((i=this.defaultsFromMap)==null?void 0:i.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?W6(this.defaultsFromMap.viewingMode):zR(e,ct.Global)?"global":"local":"global"}set viewingMode(t){this.ready?de.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get visibleArea(){var t;return(t=this.stateManager)==null?void 0:t.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get highlightOptions(){for(const t of this.highlights)if(t.name===Lk)return t.options;return new wE}set highlightOptions(t){for(const e of this.highlights)if(e.name===Lk)return void(e.options=t)}get resourceController(){return this._resourceController}get quality(){var t,e;return((e=(t=this._resourceController)==null?void 0:t.memoryController)==null?void 0:e.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Egt(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return de.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=Lce(t)?Pce(this,t):t;return Lmt(this,i,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return de.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?am(this.elevationProvider,t):null)??0;return ec(t,ZD,this.renderSpatialReference,e),this.state.camera.projectToScreen(ZD,Q8),ju(Q8[0],Q8[1])}pixelSizeAt(t,e){if(!this.ready)return de.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!t)return 0;const i=this.renderSpatialReference;ec(t,ZD,i);const r=this.state.camera.computeScreenPixelSizeAt(ZD);return e&&i!==e?r*Ql(i)/Ql(e):r}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return de.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=Lce(t)?Pce(this,t):t;return Pmt(this,i,e,this._defaultHitTestOptions)}async popupHitTest(t){return Kmt(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new Y("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":case"viewshed":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return(await fe(async()=>{const{encode:r}=await Promise.resolve().then(()=>Y$);return{encode:r}},void 0)).encode(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return(await fe(async()=>{const{encodeData:r}=await Promise.resolve().then(()=>Y$);return{encodeData:r}},void 0)).encodeData(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=await this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),{encodeData:r}=await fe(async()=>{const{encodeData:n}=await Promise.resolve().then(()=>Y$);return{encodeData:n}},void 0);return[r(i[0],this._pixelFormat()),r(i[1],this._pixelFormat())]}async _completeSettings(t){const{toRenderSettings:e,screenshotSuperSampleSettings:i}=await fe(()=>Promise.resolve().then(()=>Y$),void 0),r=e(t,this);return r.pixelRatio/=this.state.pixelRatio,i(r,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(t){if(!_d())throw new Y("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");const{encode:e}=await fe(()=>Promise.resolve().then(()=>Y$),void 0),i=await this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(i),n=e(r[0],i,this._pixelFormat()),s=await this._completeSettings(t);return s.format="png",[n,e(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){const t=this._stage.renderView.olidRenderHelper;if(t)return t.getColorToObjectAndLayerIdMapping();throw new Y("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true")}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return Vce.importLayerView(t)}hasLayerViewModule(t){return Vce.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i;return this.map&&"initialViewProperties"in this.map&&((t=this.map.initialViewProperties)==null?void 0:t.spatialReference)||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=h2t(this.type);const e=pe("safari");if(e&&e<9&&(t=new Y("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw de.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?G9(t):null}getSpatialReferenceSupport(t,e){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,ct.Local),n=this._validateSpatialReferenceForViewingMode(t,e,ct.Global);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,ct.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,ct.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!zR(t,i)&&(e==null||!!Foe(e)||(!kA(e)||pV(e,t,i)!=null)&&(!Noe(e)||i!==ct.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const{isWebMercator:r,isWGS84:n}=t;return Foe(e)&&(r||n)?!n||i===ct.Local||Vte(e.tileInfo,e.fullExtent,t,ct.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:nt.WebMercator,viewingMode:i}]:[{spatialReference:r?nt.WGS84:nt.WebMercator,viewingMode:i}]:kA(e)||Noe(e)||!r&&!n?kA(e)&&r&&i!==ct.Global?[{spatialReference:t,viewingMode:i},{spatialReference:nt.WGS84,viewingMode:ct.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?nt.WGS84:nt.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport(t)!=null,i=this._predeterminedViewingMode;return e||(i!=null?de.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${W6(i)} viewing mode.`):t.isGeographic&&de.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return de.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const n=s=>{var o;!r&&s!=null&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(i=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Ui(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(t){if(Array.isArray(t))return Fb(t.map(i=>this.highlight(i)));if(ot.isCollection(t))return Fb(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Ui()}maskOccludee(t){if(!t)return de.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const n=s=>{!r&&s!=null&&n2t(s)&&(i=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Ui(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await kE(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new Y("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new Z1t({view:this})),this._set("elevationProvider",new iA({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new kl({view:this})),this._set("featureTiles",new Oo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var i;const e=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Hv(CU(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Cn.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(fe(()=>import("./FeatureTileTree3DDebugger-BnOtFewT.js"),__vite__mapDeps([277,257]))).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&Cn.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||Cn.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},hi),this.updatingHandles.add(()=>this.clippingArea,t,hi),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,hi)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.featureTiles&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this._set("featureTiles",Ye(this.featureTiles)),this._set("pointsOfInterest",Ye(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference,e=this.state.isGlobal,i=t7e(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",rgt.create(this.state.viewingMode,i)),e||this.addHandles(oe(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const n=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!FQ(r,this.basemapTerrain.spatialReference,Cye,n)||(this.renderCoordsHelper.extent=Cye)},xi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(nC/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Pr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(oe(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),xi),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,n,s)=>this._renderScreenshotOverlay(r,n,s)}},e=new kmt(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=HU(this.surface);this._stage=new Ch({view:this,options:t,container:i}),this._stage.renderer.slicePlane=this.slicePlane,this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),Si),this.on("pointer-move",()=>{var r;return(r=this._stage)==null?void 0:r.renderer.resetAnimation()}),OC(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new Y("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(nC/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Ye(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Ugt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await fe(async()=>{const{default:i}=await import("./GraphicsView3D-kleLrX2W.js");return{default:i}},__vite__mapDeps([278,176,166,151,38,39,28,29,119,167,118,103,34,104,100,40]))).default;zt(t),await kE(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=G9(this.viewingMode);t===ct.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Vo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=e==null?void 0:e.environment;i&&(this._overrideDefaultEnvironmentOnly?Bxe(this.environment,i):this.environment=this.environment.cloneWithWebsceneEnvironment(i)),this.timeExtent=e==null?void 0:e.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new V2(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(n=>n(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this._overrideDefaultEnvironmentOnly=!1,this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Ye(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Pv);for(const t of this.map.allLayers.items)IR(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Pv);for(const t of this.map.allLayers.items)IR(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function WD(t,e){return t!=null&&tf(t.spatialReference,e)?Hv(t,e):null}lt.type="3d",u([f()],lt.prototype,"_userClippingArea",void 0),u([f()],lt.prototype,"_resourceController",void 0),u([f()],lt.prototype,"_stage",void 0),u([f({readOnly:!0})],lt.prototype,"deconflictor",void 0),u([f({readOnly:!0})],lt.prototype,"labeler",void 0),u([f(T5(iC,"analyses"))],lt.prototype,"analyses",void 0),u([f({type:uC,readOnly:!0})],lt.prototype,"animation",null),u([f({readOnly:!0})],lt.prototype,"basemapTerrain",void 0),u([f({readOnly:!0})],lt.prototype,"elevationProvider",void 0),u([f()],lt.prototype,"camera",null),u([f({type:Hc})],lt.prototype,"contentCamera",null),u([f({readOnly:!0})],lt.prototype,"canvas",void 0),u([f({type:wt})],lt.prototype,"center",null),u([f({type:pr})],lt.prototype,"clippingArea",null),u([f({type:Kw})],lt.prototype,"constraints",void 0),u([f({type:pr,readOnly:!0})],lt.prototype,"renderDataExtent",null),u([f({readOnly:!0})],lt.prototype,"tileInfo",null),u([f({type:pr,readOnly:!0})],lt.prototype,"dataExtent",null),u([f({type:pr,readOnly:!0})],lt.prototype,"_groundAndLayersExtent",null),u([f({type:LT})],lt.prototype,"environment",void 0),u([$i("environment")],lt.prototype,"castEnvironment",null),u([f({readOnly:!0})],lt.prototype,"environmentManager",void 0),u([f({type:pr})],lt.prototype,"extent",null),u([f()],lt.prototype,"floors",void 0),u([f()],lt.prototype,"screenCenter",null),u([f()],lt.prototype,"frustum",null),u([f({type:Number,readOnly:!0})],lt.prototype,"fullOpacity",void 0),u([f({readOnly:!0})],lt.prototype,"graphicsView",void 0),u([f({readOnly:!0})],lt.prototype,"analysisViewManager",void 0),u([f()],lt.prototype,"groundView",void 0),u([f({type:Boolean})],lt.prototype,"initialExtentRequired",null),u([f()],lt.prototype,"defaultsFromMapSettings",null),u([f()],lt.prototype,"interacting",null),u([f()],lt.prototype,"stationary",null),u([f()],lt.prototype,"navigating",null),u([f()],lt.prototype,"map",void 0),u([f()],lt.prototype,"padding",null),u([f({type:kl,readOnly:!0})],lt.prototype,"pointsOfInterest",void 0),u([f({type:Oo,readOnly:!0})],lt.prototype,"featureTiles",void 0),u([f()],lt.prototype,"_featureTreeDebugger",void 0),u([f({type:Boolean})],lt.prototype,"screenSizePerspectiveEnabled",void 0),u([f({constructOnly:!0})],lt.prototype,"deactivatedWebGLExtensions",void 0),u([f({constructOnly:!0})],lt.prototype,"debugWebGLExtensions",void 0),u([f({constructOnly:!0})],lt.prototype,"renderCanvas",void 0),u([f({constructOnly:!0})],lt.prototype,"state",void 0),u([f({readOnly:!0})],lt.prototype,"inputManager",void 0),u([f({readOnly:!0})],lt.prototype,"stateManager",void 0),u([f({type:["low","medium","high"]})],lt.prototype,"qualityProfile",null),u([f({type:$pe,get(){let t=this._get("qualitySettings");return t||(t=new $pe,HF.apply(this.qualityProfile,t)),t}})],lt.prototype,"qualitySettings",void 0),u([f()],lt.prototype,"slicePlane",null),u([f({readOnly:!0})],lt.prototype,"typeSpecificPreconditionsReady",null),u([f({readOnly:!0})],lt.prototype,"renderCoordsHelper",void 0),u([f({readOnly:!0})],lt.prototype,"sceneIntersectionHelper",void 0),u([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],lt.prototype,"resolution",null),u([f({type:Number})],lt.prototype,"scale",null),u([f()],lt.prototype,"heightModelInfo",null),u([f()],lt.prototype,"spatialReference",void 0),u([f({type:Boolean,constructOnly:!0})],lt.prototype,"alphaCompositingEnabled",void 0),u([f({constructOnly:!0})],lt.prototype,"preserveDrawingBufferEnabled",void 0),u([f({type:Boolean})],lt.prototype,"supersampleScreenshotsEnabled",void 0),u([f({readOnly:!0})],lt.prototype,"type",void 0),u([f(),$i(t=>t instanceof TPe?t:dU(EPe,t))],lt.prototype,"ui",void 0),u([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],lt.prototype,"updating",null),u([f()],lt.prototype,"_updatingObjects",null),u([f()],lt.prototype,"_updatingObjectsWithProgress",null),u([f({type:Number,readOnly:!0,dependsOn:["updating"]})],lt.prototype,"updatingProgress",void 0),u([f({type:["global","local"]})],lt.prototype,"viewingMode",null),u([f({type:ef})],lt.prototype,"viewpoint",null),u([f({readOnly:!0})],lt.prototype,"visibleArea",null),u([f({type:Number})],lt.prototype,"zoom",null),u([f({type:wE})],lt.prototype,"highlightOptions",null),u([f({type:ot.ofType(ay)})],lt.prototype,"highlights",void 0),u([f({readOnly:!0})],lt.prototype,"quality",null),u([f({readOnly:!0})],lt.prototype,"resolutionScale",null),u([f()],lt.prototype,"textures",void 0),lt=u([L("esri.views.SceneView")],lt);const ZD=A(),Q8=ds(),Cye=Zi(),N2t=lt;function F2t(t,e){function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i}function TE(t,e,i,r){var n=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(n,TE.prototype),n.expected=e,n.found=i,n.location=r,n.name="SyntaxError",n}function K8(t,e,i){return i=i||" ",t.length>e?t:(e-=t.length,t+(i+=i.repeat(e)).slice(0,e))}function k2t(t,e){var i,r={},n=(e=e!==void 0?e:{}).grammarSource,s={start:Cd},o=Cd,a="none",l=")",c=",",h="(",p="%",g="px",y="cm",w="mm",b="in",x="pt",T="pc",M="deg",$="rad",R="grad",I="turn",P="#",N=".",V="e",U=/^[ \t\n\r]/,B=/^[a-z\-]/,W=/^[0-9a-fA-F]/,j=/^[+\-]/,Q=/^[0-9]/,Z=js("none"),X=kr("none",!1),ge=kr(")",!1),ae=kr(",",!1),z=js("whitespace"),he=Sa([" ","	",`
`,"\r"],!1,!1),ce=js("function"),G=kr("(",!1),K=js("identifier"),Se=Sa([["a","z"],"-"],!1,!1),Ee=js("percentage"),Ce=kr("%",!1),Le=js("length"),Ke=kr("px",!1),Re=kr("cm",!1),ze=kr("mm",!1),vt=kr("in",!1),Xt=kr("pt",!1),li=kr("pc",!1),ti=js("angle"),zi=kr("deg",!1),He=kr("rad",!1),Oi=kr("grad",!1),Be=kr("turn",!1),tt=js("number"),dt=js("color"),Rt=kr("#",!1),Je=Sa([["0","9"],["a","f"],["A","F"]],!1,!1),Et=Sa(["+","-"],!1,!1),De=Sa([["0","9"]],!1,!1),at=kr(".",!1),It=kr("e",!1),Ki=function(){return[]},Yi=function(H,$e){return{type:"function",name:H,parameters:$e||[]}},er=function(H,$e){return $e.length>0?cf(H,$e,3):[H]},Li=function(H){return{type:"quantity",value:H.value,unit:H.unit}},Ai=function(H){return{type:"color",colorType:H.type,value:H.value}},ci=function(H){return H},Vi=function(){return Xa()},Ei=function(H){return{value:H,unit:"%"}},tr=function(H){return{value:H,unit:"px"}},Lt=function(H){return{value:H,unit:"cm"}},ui=function(H){return{value:H,unit:"mm"}},_i=function(H){return{value:H,unit:"in"}},rr=function(H){return{value:H,unit:"pt"}},bn=function(H){return{value:H,unit:"pc"}},di=function(H){return{value:H,unit:"deg"}},lr=function(H){return{value:H,unit:"rad"}},Fr=function(H){return{value:H,unit:"grad"}},Ts=function(H){return{value:H,unit:"turn"}},wo=function(H){return{value:H,unit:null}},bo=function(){return{type:"hex",value:Xa()}},Es=function(H){return{type:"function",value:H}},Ln=function(){return{type:"named",value:Xa()}},cn=function(){return parseFloat(Xa())},se=0|e.peg$currPos,jt=se,Kr=[{line:1,column:1}],yr=se,mn=e.peg$maxFailExpected||[],st=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');o=s[e.startRule]}function Xa(){return t.substring(jt,se)}function kr(H,$e){return{type:"literal",text:H,ignoreCase:$e}}function Sa(H,$e,je){return{type:"class",parts:H,inverted:$e,ignoreCase:je}}function Yc(){return{type:"end"}}function js(H){return{type:"other",description:H}}function Ux(H){var $e,je=Kr[H];if(je)return je;if(H>=Kr.length)$e=Kr.length-1;else for($e=H;!Kr[--$e];);for(je={line:(je=Kr[$e]).line,column:je.column};$e<H;)t.charCodeAt($e)===10?(je.line++,je.column=1):je.column++,$e++;return Kr[H]=je,je}function Xu(H,$e,je){var Jt=Ux(H),_r=Ux($e);return{source:n,start:{offset:H,line:Jt.line,column:Jt.column},end:{offset:$e,line:_r.line,column:_r.column}}}function Kt(H){se<yr||(se>yr&&(yr=se,mn=[]),mn.push(H))}function af(H,$e,je){return new TE(TE.buildMessage(H,$e),H,$e,je)}function Cd(){var H;return(H=Um())===r&&(H=n1()),H}function Um(){var H,$e;return st++,H=se,Er(),t.substr(se,4)===a?($e=a,se+=4):($e=r,st===0&&Kt(X)),$e!==r?(Er(),jt=H,H=Ki()):(se=H,H=r),st--,H===r&&st===0&&Kt(Z),H}function n1(){var H,$e;if(H=[],($e=Xc())!==r)for(;$e!==r;)H.push($e),$e=Xc();else H=r;return H}function Xc(){var H,$e,je,Jt;return H=se,Er(),($e=Rr())!==r?(Er(),(je=Md())===r&&(je=null),Er(),t.charCodeAt(se)===41?(Jt=l,se++):(Jt=r,st===0&&Kt(ge)),Jt!==r?(Er(),jt=H,H=Yi($e,je)):(se=H,H=r)):(se=H,H=r),H}function Md(){var H,$e,je,Jt,_r,Cr,en,$s;if(H=se,($e=Ju())!==r){for(je=[],Jt=se,_r=Er(),t.charCodeAt(se)===44?(Cr=c,se++):(Cr=r,st===0&&Kt(ae)),Cr===r&&(Cr=null),en=Er(),($s=Ju())!==r?Jt=_r=[_r,Cr,en,$s]:(se=Jt,Jt=r);Jt!==r;)je.push(Jt),Jt=se,_r=Er(),t.charCodeAt(se)===44?(Cr=c,se++):(Cr=r,st===0&&Kt(ae)),Cr===r&&(Cr=null),en=Er(),($s=Ju())!==r?Jt=_r=[_r,Cr,en,$s]:(se=Jt,Jt=r);jt=H,H=er($e,je)}else se=H,H=r;return H}function Ju(){var H,$e;return H=se,($e=Cs())===r&&($e=Qc())===r&&($e=Kc())===r&&($e=Xy()),$e!==r&&(jt=H,$e=Li($e)),(H=$e)===r&&(H=se,($e=lf())!==r&&(jt=H,$e=Ai($e)),H=$e),H}function Er(){var H,$e;for(st++,H=[],$e=t.charAt(se),U.test($e)?se++:($e=r,st===0&&Kt(he));$e!==r;)H.push($e),$e=t.charAt(se),U.test($e)?se++:($e=r,st===0&&Kt(he));return st--,$e=r,st===0&&Kt(z),H}function Rr(){var H,$e,je;return st++,H=se,($e=Jc())!==r?(t.charCodeAt(se)===40?(je=h,se++):(je=r,st===0&&Kt(G)),je!==r?(jt=H,H=ci($e)):(se=H,H=r)):(se=H,H=r),st--,H===r&&($e=r,st===0&&Kt(ce)),H}function Jc(){var H,$e,je;if(st++,H=se,$e=[],je=t.charAt(se),B.test(je)?se++:(je=r,st===0&&Kt(Se)),je!==r)for(;je!==r;)$e.push(je),je=t.charAt(se),B.test(je)?se++:(je=r,st===0&&Kt(Se));else $e=r;return $e!==r&&(jt=H,$e=Vi()),st--,(H=$e)===r&&($e=r,st===0&&Kt(K)),H}function Cs(){var H,$e,je;return st++,H=se,Er(),($e=Ms())!==r?(t.charCodeAt(se)===37?(je=p,se++):(je=r,st===0&&Kt(Ce)),je!==r?(jt=H,H=Ei($e)):(se=H,H=r)):(se=H,H=r),st--,H===r&&st===0&&Kt(Ee),H}function Qc(){var H,$e,je;return st++,H=se,Er(),($e=Ms())!==r?(t.substr(se,2)===g?(je=g,se+=2):(je=r,st===0&&Kt(Ke)),je!==r?(jt=H,H=tr($e)):(se=H,H=r)):(se=H,H=r),H===r&&(H=se,Er(),($e=Ms())!==r?(t.substr(se,2)===y?(je=y,se+=2):(je=r,st===0&&Kt(Re)),je!==r?(jt=H,H=Lt($e)):(se=H,H=r)):(se=H,H=r),H===r&&(H=se,Er(),($e=Ms())!==r?(t.substr(se,2)===w?(je=w,se+=2):(je=r,st===0&&Kt(ze)),je!==r?(jt=H,H=ui($e)):(se=H,H=r)):(se=H,H=r),H===r&&(H=se,Er(),($e=Ms())!==r?(t.substr(se,2)===b?(je=b,se+=2):(je=r,st===0&&Kt(vt)),je!==r?(jt=H,H=_i($e)):(se=H,H=r)):(se=H,H=r),H===r&&(H=se,Er(),($e=Ms())!==r?(t.substr(se,2)===x?(je=x,se+=2):(je=r,st===0&&Kt(Xt)),je!==r?(jt=H,H=rr($e)):(se=H,H=r)):(se=H,H=r),H===r&&(H=se,Er(),($e=Ms())!==r?(t.substr(se,2)===T?(je=T,se+=2):(je=r,st===0&&Kt(li)),je!==r?(jt=H,H=bn($e)):(se=H,H=r)):(se=H,H=r)))))),st--,H===r&&st===0&&Kt(Le),H}function Kc(){var H,$e,je;return st++,H=se,($e=Ms())!==r?(t.substr(se,3)===M?(je=M,se+=3):(je=r,st===0&&Kt(zi)),je!==r?(jt=H,H=di($e)):(se=H,H=r)):(se=H,H=r),H===r&&(H=se,($e=Ms())!==r?(t.substr(se,3)===$?(je=$,se+=3):(je=r,st===0&&Kt(He)),je!==r?(jt=H,H=lr($e)):(se=H,H=r)):(se=H,H=r),H===r&&(H=se,($e=Ms())!==r?(t.substr(se,4)===R?(je=R,se+=4):(je=r,st===0&&Kt(Oi)),je!==r?(jt=H,H=Fr($e)):(se=H,H=r)):(se=H,H=r),H===r&&(H=se,($e=Ms())!==r?(t.substr(se,4)===I?(je=I,se+=4):(je=r,st===0&&Kt(Be)),je!==r?(jt=H,H=Ts($e)):(se=H,H=r)):(se=H,H=r)))),st--,H===r&&($e=r,st===0&&Kt(ti)),H}function Xy(){var H,$e;return st++,H=se,Er(),($e=Ms())!==r?(jt=H,H=wo($e)):(se=H,H=r),st--,H===r&&st===0&&Kt(tt),H}function lf(){var H,$e,je,Jt;if(st++,H=se,t.charCodeAt(se)===35?($e=P,se++):($e=r,st===0&&Kt(Rt)),$e!==r){if(je=[],Jt=t.charAt(se),W.test(Jt)?se++:(Jt=r,st===0&&Kt(Je)),Jt!==r)for(;Jt!==r;)je.push(Jt),Jt=t.charAt(se),W.test(Jt)?se++:(Jt=r,st===0&&Kt(Je));else je=r;je!==r?(jt=H,H=bo()):(se=H,H=r)}else se=H,H=r;return H===r&&(H=se,($e=Xc())!==r&&(jt=H,$e=Es($e)),(H=$e)===r&&(H=se,($e=Jc())!==r&&(jt=H,$e=Ln()),H=$e)),st--,H===r&&($e=r,st===0&&Kt(dt)),H}function Ms(){var H,$e,je,Jt,_r,Cr,en,$s;for(H=se,$e=t.charAt(se),j.test($e)?se++:($e=r,st===0&&Kt(Et)),$e===r&&($e=null),je=se,Jt=[],_r=t.charAt(se),Q.test(_r)?se++:(_r=r,st===0&&Kt(De));_r!==r;)Jt.push(_r),_r=t.charAt(se),Q.test(_r)?se++:(_r=r,st===0&&Kt(De));if(t.charCodeAt(se)===46?(_r=N,se++):(_r=r,st===0&&Kt(at)),_r!==r){if(Cr=[],en=t.charAt(se),Q.test(en)?se++:(en=r,st===0&&Kt(De)),en!==r)for(;en!==r;)Cr.push(en),en=t.charAt(se),Q.test(en)?se++:(en=r,st===0&&Kt(De));else Cr=r;Cr!==r?je=Jt=[Jt,_r,Cr]:(se=je,je=r)}else se=je,je=r;if(je===r)if(je=[],Jt=t.charAt(se),Q.test(Jt)?se++:(Jt=r,st===0&&Kt(De)),Jt!==r)for(;Jt!==r;)je.push(Jt),Jt=t.charAt(se),Q.test(Jt)?se++:(Jt=r,st===0&&Kt(De));else je=r;if(je!==r){if(Jt=se,t.charCodeAt(se)===101?(_r=V,se++):(_r=r,st===0&&Kt(It)),_r!==r){if(Cr=t.charAt(se),j.test(Cr)?se++:(Cr=r,st===0&&Kt(Et)),Cr===r&&(Cr=null),en=[],$s=t.charAt(se),Q.test($s)?se++:($s=r,st===0&&Kt(De)),$s!==r)for(;$s!==r;)en.push($s),$s=t.charAt(se),Q.test($s)?se++:($s=r,st===0&&Kt(De));else en=r;en!==r?Jt=_r=[_r,Cr,en]:(se=Jt,Jt=r)}else se=Jt,Jt=r;Jt===r&&(Jt=null),jt=H,H=cn()}else se=H,H=r;return H}function Wo(H,$e){return H.map(function(je){return je[$e]})}function cf(H,$e,je){return[H].concat(Wo($e,je))}if(i=o(),e.peg$library)return{peg$result:i,peg$currPos:se,peg$FAILED:r,peg$maxFailExpected:mn,peg$maxFailPos:yr};if(i!==r&&se===t.length)return i;throw i!==r&&se<t.length&&Kt(Yc()),af(mn,yr<t.length?t.charAt(yr):null,yr<t.length?Xu(yr,yr+1):Xu(yr,yr))}function CPe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Mye(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new Y("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Mye(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!Dze(e[i].effects,e[i+1].effects))throw new Y("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});Nze(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Mye(t){let e;if(!t)return[];try{e=k2t(t)}catch(i){throw new Y("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>U2t(i))}function U2t(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return z2t(t);case"opacity":return V2t(t);case"hue-rotate":return B2t(t);case"blur":return j2t(t);case"drop-shadow":return G2t(t);case"bloom":return H2t(t)}}catch(e){throw e.details.filter=t,e}throw new Y("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function z2t(t){let e=1;return hM(t.parameters,1),t.parameters.length===1&&(e=wp(t.parameters[0])),new y9(t.name,e)}function V2t(t){let e=1;return hM(t.parameters,1),t.parameters.length===1&&(e=wp(t.parameters[0])),new K1e(e)}function B2t(t){let e=0;return hM(t.parameters,1),t.parameters.length===1&&(e=J2t(t.parameters[0])),new J1e(e)}function j2t(t){let e=0;return hM(t.parameters,1),t.parameters.length===1&&(e=Rie(t.parameters[0]),CI(e,t.parameters[0])),new q1e(e)}function G2t(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new Y("effect:type-error","Accepts only one color",{});i=Q2t(r)}else{const n=Rie(r);if(Object.isFrozen(e))throw new Y("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&CI(n,r)}if(e.length<2||e.length>3)throw new Y("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new Y1e(e[0],e[1],e[2]||0,i||MPe("black"))}function H2t(t){let e=1,i=0,r=0;return hM(t.parameters,3),t.parameters[0]&&(e=wp(t.parameters[0])),t.parameters[1]&&(i=Rie(t.parameters[1]),CI(i,t.parameters[1])),t.parameters[2]&&(r=wp(t.parameters[2])),new G1e(e,i,r)}function hM(t,e){if(t.length>e)throw new Y("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function xV(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Aie)return"<length>";if(t.unit in Oie)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function CI(t,e){if(t<0)throw new Y("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function q2t(t){if(t.type!=="quantity"||t.unit!==null)throw new Y("effect:type-error",`Expected <double>, Actual: ${xV(t)}`,{term:t})}function W2t(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new Y("effect:type-error",`Expected <double> or <percentage>, Actual: ${xV(t)}`,{term:t})}F2t(TE,Error),TE.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var i,r=null;for(i=0;i<t.length;i++)if(t[i].source===this.location.source){r=t[i].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,s=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(n):n,o=this.location.source+":"+s.line+":"+s.column;if(r){var a=this.location.end,l=K8("",s.line.toString().length," "),c=r[n.line-1],h=(n.line===a.line?a.column:c.length+1)-n.column||1;e+=`
 --> `+o+`
`+l+` |
`+s.line+" | "+c+`
`+l+" | "+K8("",n.column-1," ")+K8("",h,"^")}else e+=`
 at `+o}return e},TE.buildMessage=function(t,e){var i={literal:function(c){return'"'+n(c.text)+'"'},class:function(c){var h=c.parts.map(function(p){return Array.isArray(p)?s(p[0])+"-"+s(p[1]):s(p)});return"["+(c.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function r(c){return c.charCodeAt(0).toString(16).toUpperCase()}function n(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+r(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+r(h)})}function s(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+r(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+r(h)})}function o(c){return i[c.type](c)}function a(c){var h,p,g=c.map(o);if(g.sort(),g.length>0){for(h=1,p=1;h<g.length;h++)g[h-1]!==g[h]&&(g[p]=g[h],p++);g.length=p}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function l(c){return c?'"'+n(c)+'"':"end of input"}return"Expected "+a(t)+" but "+l(e)+" found."};const Oie={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Z2t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Oie[t.unit]!=null))throw new Y("effect:type-error",`Expected <angle>, Actual: ${xV(t)}`,{term:t})}const Aie={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Y2t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Aie[t.unit]!=null))throw new Y("effect:type-error",`Expected <length>, Actual: ${xV(t)}`,{term:t})}function wp(t){W2t(t);const e=t.value;return CI(e,t),t.unit==="%"?.01*e:e}function X2t(t){return q2t(t),CI(t.value,t),t.value}function J2t(t){return Z2t(t),t.value*Oie[t.unit]||0}function Rie(t){return Y2t(t),t.value*Aie[t.unit]||0}function Q2t(t){switch(t.colorType){case"hex":return NUe(t.value);case"named":return MPe(t.value);case"function":return tEt(t.value)}}function MPe(t){if(!S1e(t))throw new Y("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return DUe(t)}const K2t=/^rgba?/i,eEt=/^hsla?/i;function tEt(t){if(hM(t.parameters,4),K2t.test(t.name))return[wp(t.parameters[0]),wp(t.parameters[1]),wp(t.parameters[2]),t.parameters[3]?wp(t.parameters[3]):1];if(eEt.test(t.name))return T1e(X2t(t.parameters[0]),wp(t.parameters[1]),wp(t.parameters[2]),t.parameters[3]?wp(t.parameters[3]):1);throw new Y("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function b3(t,e,i){var r;try{return rEt(t)}catch(n){(r=i==null?void 0:i.messages)==null||r.push(n)}return null}function x3(t,e,i,r){try{const n=iEt(t);Uo(i,n,e)}catch(n){r.messages&&r.messages.push(n)}}function iEt(t){const e=CPe(t);return e?Fze(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(n=>n.toJSON())})):null}function rEt(t){if(!t||t.length===0)return null;if(nEt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:$ye(i.value)});return e}return $ye(t)}function nEt(t){const e=t[0];return!!e&&"scale"in e}function $ye(t){if(!(t!=null&&t.length))return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[ug(i,"amount")];break;case"blur":r=[ug(i,"radius","pt")];break;case"hue-rotate":r=[ug(i,"angle","deg")];break;case"drop-shadow":r=[ug(i,"xoffset","pt"),ug(i,"yoffset","pt"),ug(i,"blurRadius","pt"),sEt(i,"color")];break;case"bloom":r=[ug(i,"strength"),ug(i,"radius","pt"),ug(i,"threshold")]}const n=`${i.type}(${r.filter(Boolean).join(" ")})`;CPe(n),e.push(n)}return e.join(" ")}function ug(t,e,i){if(t[e]==null)throw new Y("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function sEt(t,e){if(t[e]==null)throw new Y("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const oEt={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},Oye={read:{reader:b3},write:{allowNull:!0,writer:x3}},aEt={json:{read:!1,write:!1,origins:{"web-map":Oye,"portal-item":Oye}}},$Pe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([f(oEt)],e.prototype,"blendMode",void 0),u([f(aEt)],e.prototype,"effect",void 0),e=u([L("esri.layers.mixins.BlendLayer")],e),e},OPe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&lEt(i,r.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===i.minScale&&n.maxScale===i.maxScale?n:i}};return u([f({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([f({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([f({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([L("esri.layers.mixins.ScaleRangeLayer")],e),e};function lEt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}var qY;let mA=qY=class extends we{constructor(t){super(t)}async collectRequiredFields(t,e){return Sl(t,e,this.expression)}clone(){return new qY({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([f({type:String,json:{write:!0}})],mA.prototype,"expression",void 0),u([f({type:String,json:{write:!0}})],mA.prototype,"title",void 0),mA=qY=u([L("esri.symbols.support.FeatureExpressionInfo")],mA);const Aye=mA;var WY;const YD=Za()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Rye=new sr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Pg=WY=class extends we{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new WY({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&XNe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([f({type:Aye,json:{write:!0}})],Pg.prototype,"featureExpressionInfo",void 0),u([Pe("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Pg.prototype,"readFeatureExpressionInfo",null),u([ke("featureExpressionInfo",{featureExpressionInfo:{type:Aye},"featureExpression.value":{type:[0]}})],Pg.prototype,"writeFeatureExpressionInfo",null),u([f({type:YD.apiValues,nonNullable:!0,json:{type:YD.jsonValues,read:YD.read,write:{writer:YD.write,isRequired:!0}}})],Pg.prototype,"mode",null),u([f({type:Number,json:{write:!0}})],Pg.prototype,"offset",void 0),u([f({type:ylt,json:{type:String,read:Rye.read,write:Rye.write}})],Pg.prototype,"unit",null),Pg=WY=u([L("esri.symbols.support.ElevationInfo")],Pg);const APe=Pg;let Lg=class extends $Pe(OPe(kU)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new Ab,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,i){return super.on(e,i)}graphicChanged(e){this.emit("graphic-update",e)}};u([f({type:APe})],Lg.prototype,"elevationInfo",void 0),u([f(T5(Ab,"graphics"))],Lg.prototype,"graphics",void 0),u([f({type:["show","hide"]})],Lg.prototype,"listMode",void 0),u([f()],Lg.prototype,"screenSizePerspectiveEnabled",void 0),u([f({readOnly:!0})],Lg.prototype,"type",void 0),u([f({constructOnly:!0})],Lg.prototype,"internal",void 0),Lg=u([L("esri.layers.GraphicsLayer")],Lg);const cEt=Lg,uEt=({selectedPoint:t})=>hn.jsx("div",{className:"absolute top-2 right-2 z-[1000] bg-white p-4 border border-black rounded-md min-w-[200px]",children:t?hn.jsxs("div",{children:[hn.jsx("h3",{className:"font-bold text-lg mb-2",children:"Point Details"}),hn.jsxs("ul",{className:"space-y-1",children:[hn.jsxs("li",{children:[hn.jsx("b",{children:"Name:"})," ",t.name]}),hn.jsxs("li",{children:[hn.jsx("b",{children:"Age:"})," ",t.age]}),hn.jsxs("li",{children:[hn.jsx("b",{children:"Company:"})," ",t.company]}),hn.jsxs("li",{children:[hn.jsx("b",{children:"Job ID:"})," ",t.jobId]})]})]}):hn.jsx("p",{className:"text-gray-600",children:"Click on a point to see details"})}),hEt=({totalWorkers:t,totalBuildings:e})=>hn.jsxs("div",{className:"absolute top-[200px] right-2 z-[1000] bg-white p-4 border border-black rounded-md min-w-[200px] text-center",children:[hn.jsx("h4",{className:"font-bold text-lg mb-2",children:"Statistics"}),hn.jsxs("p",{children:[hn.jsx("b",{children:"Workers:"})," ",t]}),hn.jsxs("p",{children:[hn.jsx("b",{children:"Buildings:"})," ",e]})]}),dEt=({toggleBuilding:t,togglePoints:e,hasBuilding:i,hasPoints:r})=>hn.jsxs("div",{className:"absolute top-2 left-2 z-[1000] flex flex-col gap-2",children:[hn.jsx("button",{onClick:t,className:"bg-white border border-black px-4 py-2 rounded hover:bg-gray-100 cursor-pointer",children:i?"Delete building":"Add building"}),hn.jsx("button",{onClick:e,className:"bg-white border border-black px-4 py-2 rounded hover:bg-gray-100 cursor-pointer",children:r?"Delete points":"Add points"})]}),pEt=t=>{const e=new wt({longitude:-117.1956,latitude:34.0561,z:10}),i=window.location.hostname==="localhost",r=new td({symbolLayers:[{type:"object",resource:{href:i?"./models/concept__schoola_4.glb":"https://filebin.net/4nmyycy7kjrsuf28/a_chinese_worker.glb"},height:1e3}]}),n=new qc({geometry:e,symbol:r,elevationInfo:{mode:"relative-to-ground"}});return t.add(n),n},fEt=[{longitude:-117.33378013520932,latitude:33.95723222749059,z:30,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"John Doe",age:30,company:"Company A",jobId:"12345"},{longitude:-117.3318970628486,latitude:33.95643416897167,z:30,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"Jane Smith",age:28,company:"Company B",jobId:"67890"},{longitude:-117.33492192120501,latitude:33.95970269302978,z:30,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"Mike Johnson",age:35,company:"Company C",jobId:"54321"},{longitude:-117.33451206057174,latitude:33.9577574370671,z:30,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"Sarah Lee",age:32,company:"Company D",jobId:"98765"},{longitude:-117.33097719888478,latitude:33.95769290332852,z:30,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"Chris Evans",age:29,company:"Company E",jobId:"11223"},{longitude:-117.33358627765415,latitude:33.958438514707765,z:420,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"Emma Watson",age:40,company:"Company F",jobId:"44556"},{longitude:-117.32851431602376,latitude:33.95402116096069,z:30,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"Robert Brown",age:45,company:"Company G",jobId:"77889"},{longitude:-117.3395341971058,latitude:33.956127539426916,z:30,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"Lisa White",age:27,company:"Company H",jobId:"33445"},{longitude:-117.33843696441456,latitude:33.96113573091817,z:30,size:100,model:"/BuildingModel/models/a_chinese_worker.glb",name:"Tom Hardy",age:38,company:"Company I",jobId:"99887"}],mEt={points:fEt},gEt=t=>{const e=[];return mEt.points.forEach(i=>{const r=new KC({title:`Details of ${i.name}`,content:`
        <ul>
          <li><b>Age:</b> ${i.age}</li>
          <li><b>Company:</b> ${i.company}</li>
          <li><b>Job ID:</b> ${i.jobId}</li>
        </ul>
      `}),n=new td({symbolLayers:[new xz({resource:{href:i.model},height:i.size,material:{color:"red"}})]}),s=new qc({geometry:new wt({longitude:i.longitude,latitude:i.latitude,z:i.z}),symbol:n,attributes:i,popupTemplate:r});t.add(s),e.push(s)}),e};var ZY;let gA=ZY=class extends we{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new ZY({minValue:this.minValue,maxValue:this.maxValue})}};u([f({type:Number,json:{write:!0}})],gA.prototype,"minValue",void 0),u([f({type:Number,json:{write:!0}})],gA.prototype,"maxValue",void 0),gA=ZY=u([L("esri.renderers.support.AuthoringInfoClassBreakInfo")],gA);var YY;let N_=YY=class extends we{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new YY({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:te(this.classBreakInfos)})}};u([f({type:String,json:{write:!0}})],N_.prototype,"field",void 0),u([f({type:String,json:{write:!0}})],N_.prototype,"normalizationField",void 0),u([f({type:String,json:{write:!0}})],N_.prototype,"label",void 0),u([f({type:[gA],json:{write:!0}})],N_.prototype,"classBreakInfos",void 0),N_=YY=u([L("esri.renderers.support.AuthoringInfoFieldInfo")],N_);var XY;let KT=XY=class extends we{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new XY({label:this.label,value:this.value,size:this.size})}};u([f({type:String,json:{write:!0}})],KT.prototype,"label",void 0),u([f({type:Number,json:{write:!0}})],KT.prototype,"size",void 0),u([f({type:Number,json:{write:!0}})],KT.prototype,"value",void 0),KT=XY=u([L("esri.renderers.support.AuthoringInfoSizeStop")],KT);const yEt=KT;var JY;const XD=new sr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),JD=new sr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Iye={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Pye=["high-to-low","above-and-below","centered-on","extremes"],Lye=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],Dye=["seconds","minutes","hours","days","months","years"],_Et=["circle","diamond","hexagon-flat","hexagon-pointy","square"];let ta=JY=class extends we{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}get normalizationField(){return this.theme==="reference-size"?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get sizeStops(){return this.theme==="reference-size"?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new JY({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:te(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([f({types:Iye,json:{write:!0}})],ta.prototype,"endTime",void 0),u([$i("endTime")],ta.prototype,"castEndTime",null),u([f({type:String,json:{write:!0}})],ta.prototype,"field",void 0),u([f({type:Number,json:{write:!0}})],ta.prototype,"maxSliderValue",void 0),u([f({type:Number,json:{write:!0}})],ta.prototype,"minSliderValue",void 0),u([f({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],ta.prototype,"normalizationField",null),u([f({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],ta.prototype,"referenceSizeScale",null),u([f({type:_Et,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],ta.prototype,"referenceSizeSymbolStyle",null),u([f({types:Iye,json:{write:!0}})],ta.prototype,"startTime",void 0),u([$i("startTime")],ta.prototype,"castStartTime",null),u([f({type:[yEt],json:{origins:{"web-scene":{write:!1}},write:!0}})],ta.prototype,"sizeStops",null),u([f({type:XD.apiValues,value:null,json:{type:XD.jsonValues,read:XD.read,write:XD.write}})],ta.prototype,"style",null),u([f({type:Lye,value:null,json:{type:Lye,origins:{"web-scene":{type:Pye,write:{writer:(t,e)=>{Pye.includes(t)&&(e.theme=t)}}}},write:!0}})],ta.prototype,"theme",null),u([f({type:JD.apiValues,json:{type:JD.jsonValues,read:JD.read,write:JD.write}})],ta.prototype,"type",void 0),u([f({type:Dye,json:{type:Dye,write:!0}})],ta.prototype,"units",void 0),ta=JY=u([L("esri.renderers.support.AuthoringInfoVisualVariable")],ta);const vEt=ta;let g4=class extends we{constructor(e){super(e),this.type=null}};u([f({readOnly:!0,json:{read:!1,write:!0}})],g4.prototype,"type",void 0),g4=u([L("esri.rest.support.ColorRamp")],g4);const Iie=g4;var QY;let Fw=QY=class extends Iie{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new QY({fromColor:te(this.fromColor),toColor:te(this.toColor),algorithm:this.algorithm})}};u([_t({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Fw.prototype,"algorithm",void 0),u([f({type:mt,json:{type:[Wi],write:!0}})],Fw.prototype,"fromColor",void 0),u([f({type:mt,json:{type:[Wi],write:!0}})],Fw.prototype,"toColor",void 0),u([f({type:["algorithmic"]})],Fw.prototype,"type",void 0),Fw=QY=u([L("esri.rest.support.AlgorithmicColorRamp")],Fw);const Pie=Fw;var KY;let yA=KY=class extends Iie{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new KY({colorRamps:te(this.colorRamps)})}};u([f({type:[Pie],json:{write:!0}})],yA.prototype,"colorRamps",void 0),u([f({type:["multipart"]})],yA.prototype,"type",void 0),yA=KY=u([L("esri.rest.support.MultipartColorRamp")],yA);const RPe=yA,wEt={key:"type",base:Iie,typeMap:{algorithmic:Pie,multipart:RPe}};function bEt(t){return t!=null&&t.type?t.type==="algorithmic"?Pie.fromJSON(t):t.type==="multipart"?RPe.fromJSON(t):null:null}var eX;const j1=new sr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),QD=new sr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Nye=new sr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Fye=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"],xEt=["high-to-low","above-and-below","above","below"],SEt=["flow-line","wave-front"],TEt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let _s=eX=class extends we{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?bEt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){var t;return new eX({classificationMethod:this.classificationMethod,colorRamp:te(this.colorRamp),fadeRatio:te(this.fadeRatio),fields:(t=this.fields)==null?void 0:t.slice(),field1:te(this.field1),field2:te(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([f({type:j1.apiValues,value:null,json:{type:j1.jsonValues,read:j1.read,write:j1.write,origins:{"web-document":{default:"manual",type:j1.jsonValues,read:j1.read,write:j1.write}}}})],_s.prototype,"classificationMethod",null),u([f({types:wEt,json:{write:!0}})],_s.prototype,"colorRamp",void 0),u([Pe("colorRamp")],_s.prototype,"readColorRamp",null),u([f({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],_s.prototype,"fadeRatio",void 0),u([f({type:[String],value:null,json:{write:!0}})],_s.prototype,"fields",null),u([f({type:N_,value:null,json:{write:!0}})],_s.prototype,"field1",null),u([f({type:N_,value:null,json:{write:!0}})],_s.prototype,"field2",null),u([f({type:SEt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],_s.prototype,"flowTheme",null),u([f({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],_s.prototype,"focus",null),u([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],_s.prototype,"isAutoGenerated",void 0),u([f({type:Number,value:null,json:{type:Wi,write:!0}})],_s.prototype,"numClasses",null),u([f({type:Fye,json:{type:Fye,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],_s.prototype,"lengthUnit",void 0),u([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],_s.prototype,"maxSliderValue",void 0),u([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],_s.prototype,"minSliderValue",void 0),u([f({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],_s.prototype,"statistics",null),u([f({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],_s.prototype,"standardDeviationInterval",null),u([f({type:QD.apiValues,value:null,json:{type:QD.jsonValues,read:QD.read,write:QD.write,origins:{"web-scene":{type:Nye.jsonValues,write:{writer:Nye.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],_s.prototype,"type",null),u([f({type:[vEt],json:{write:!0}})],_s.prototype,"visualVariables",void 0),u([f({type:TEt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],_s.prototype,"univariateSymbolStyle",null),u([f({type:xEt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],_s.prototype,"univariateTheme",null),_s=eX=u([L("esri.renderers.support.AuthoringInfo")],_s);const Lie=_s,eH=new sr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let _A=class extends we{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([f({type:Lie,json:{write:!0}})],_A.prototype,"authoringInfo",void 0),u([f({type:eH.apiValues,readOnly:!0,json:{type:eH.jsonValues,read:!1,write:{writer:eH.write,ignoreOrigin:!0}}})],_A.prototype,"type",void 0),_A=u([L("esri.renderers.Renderer")],_A);const Zy=_A;function EEt(t){var e,i;return((i=(e=t.match(CEt))==null?void 0:e[1])==null?void 0:i.replace(/\\'/g,"'"))??null}const CEt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;let vA=class extends Or(we){constructor(){super(...arguments),this.showLegend=null,this.title=null}};u([f({type:Boolean,json:{write:!0}})],vA.prototype,"showLegend",void 0),u([f({type:String,json:{write:!0}})],vA.prototype,"title",void 0),vA=u([L("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],vA);const IPe=vA,tH=new sr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let lp=class extends we{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(de.getLogger(this).error(".field: field must be a string value"),null):I3(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([f()],lp.prototype,"index",void 0),u([f({type:tH.apiValues,readOnly:!0,json:{read:tH.read,write:tH.write}})],lp.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],lp.prototype,"field",void 0),u([$i("field")],lp.prototype,"castField",null),u([f({type:String,json:{write:!0}})],lp.prototype,"valueExpression",void 0),u([f({type:String,json:{write:!0}})],lp.prototype,"valueExpressionTitle",void 0),u([f({readOnly:!0})],lp.prototype,"arcadeRequired",null),u([f({type:IPe,json:{write:!0}})],lp.prototype,"legendOptions",void 0),lp=u([L("esri.renderers.visualVariables.VisualVariable")],lp);const dM=lp;var tX;let kw=tX=class extends we{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new tX({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([f({type:mt,json:{type:[Wi],write:!0}})],kw.prototype,"color",void 0),u([f({type:String,json:{write:!0}})],kw.prototype,"label",void 0),u([f({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],kw.prototype,"value",void 0),u([ke("value")],kw.prototype,"writeValue",null),kw=tX=u([L("esri.renderers.visualVariables.support.ColorStop")],kw);const MEt=kw;var iX;let Uw=iX=class extends dM{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new iX({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([f({readOnly:!0})],Uw.prototype,"cache",null),u([f({type:["color"],json:{type:["colorInfo"]}})],Uw.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],Uw.prototype,"normalizationField",void 0),u([f({type:[MEt],json:{write:!0}})],Uw.prototype,"stops",null),Uw=iX=u([L("esri.renderers.visualVariables.ColorVariable")],Uw);const PPe=Uw;var rX;let b_=rX=class extends we{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return FE(e.transparency)}writeOpacity(t,e,i){e[i]=z3(t)}clone(){return new rX({label:this.label,opacity:this.opacity,value:this.value})}};u([f({type:String,json:{write:!0}})],b_.prototype,"label",void 0),u([f({type:Number,json:{type:Wi,write:{target:"transparency"}}})],b_.prototype,"opacity",void 0),u([Pe("opacity",["transparency"])],b_.prototype,"readOpacity",null),u([ke("opacity")],b_.prototype,"writeOpacity",null),u([f({type:Number,json:{write:!0}})],b_.prototype,"value",void 0),b_=rX=u([L("esri.renderers.visualVariables.support.OpacityStop")],b_);const $Et=b_;var nX;let zw=nX=class extends dM{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new nX({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([f({readOnly:!0})],zw.prototype,"cache",null),u([f({type:["opacity"],json:{type:["transparencyInfo"]}})],zw.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],zw.prototype,"normalizationField",void 0),u([f({type:[$Et],json:{write:!0}})],zw.prototype,"stops",null),zw=nX=u([L("esri.renderers.visualVariables.OpacityVariable")],zw);const Die=zw;var sX;let Vw=sX=class extends dM{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){var t;return new sX({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}};u([f({readOnly:!0})],Vw.prototype,"cache",null),u([f({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Vw.prototype,"axis",void 0),u([f({type:["rotation"],json:{type:["rotationInfo"]}})],Vw.prototype,"type",void 0),u([f({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Vw.prototype,"rotationType",void 0),Vw=sX=u([L("esri.renderers.visualVariables.RotationVariable")],Vw);const LPe=Vw;function OEt(t){return mr(t)}var oX;let x_=oX=class extends we{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new oX({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};u([f({type:String,json:{write:!0}})],x_.prototype,"label",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],x_.prototype,"size",void 0),u([f({type:Number,json:{write:!0}})],x_.prototype,"value",void 0),u([f({type:Boolean,json:{write:!1}})],x_.prototype,"useMinValue",void 0),u([f({type:Boolean,json:{write:!1}})],x_.prototype,"useMaxValue",void 0),x_=oX=u([L("esri.renderers.visualVariables.support.SizeStop")],x_);const y4=x_;let _4=class extends IPe{constructor(){super(...arguments),this.customValues=null}};u([f({type:[Number],json:{write:!0}})],_4.prototype,"customValues",void 0),_4=u([L("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],_4);const AEt=_4;var gy,Lo;function W2(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function S3(t){return t!=null&&!isNaN(t)&&isFinite(t)}function DPe(t){return t.valueExpression?gy.Expression:t.field&&typeof t.field=="string"?gy.Field:gy.Unknown}function REt(t,e){const i=e||DPe(t),r=t.valueUnit||"unknown";return i===gy.Unknown?Lo.Constant:t.stops?Lo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Lo.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Lo.Proportional:Lo.Additive:Lo.Identity:Lo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(gy||(gy={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Lo||(Lo={}));const NPe=()=>de.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),SV=t=>NPe().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),TV=()=>NPe().error("Use of arcade expressions requires an arcade context"),kye=new qc,v4=Math.PI,FPe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function kPe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(w=>w.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void SV("ColorVariable");const n=typeof e=="number",s=n?null:e,o=s==null?void 0:s.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const w=r.stops;return w&&w[0]&&w[0].color}if(typeof a!="number")if(h){if((i==null?void 0:i.arcade)==null)return void TV();const w={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=i.arcade.arcadeUtils,x=b.getViewInfo(w),T=b.createExecContext(s,x,i.timeZone);if(!p){const M=b.createSyntaxTree(r.valueExpression);p=b.createFunction(M),r.cache.compiledFunc=p}a=b.executeFunction(p,T)}else o&&(a=o[l]);const g=r.normalizationField,y=o!=null&&g!=null?parseFloat(o[g]):void 0;if(a!=null&&(!g||n||!isNaN(y)&&y!==0)){isNaN(y)||n||(a/=y);const w=Nie(a,c);if(w){const b=w[0],x=w[1],T=b===x?r.stops[b].color:mt.blendColors(r.stops[b].color,r.stops[x].color,w[2],i!=null?i.color:void 0);return new mt(T)}}}function UPe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(w=>w.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void SV("OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s==null?void 0:s.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const w=r.stops;return w&&w[0]&&w[0].opacity}if(typeof a!="number")if(h){if((i==null?void 0:i.arcade)==null)return void TV();const w={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=i.arcade.arcadeUtils,x=b.getViewInfo(w),T=b.createExecContext(s,x,i.timeZone);if(!p){const M=b.createSyntaxTree(r.valueExpression);p=b.createFunction(M),r.cache.compiledFunc=p}a=b.executeFunction(p,T)}else o&&(a=o[l]);const g=r.normalizationField,y=o!=null&&g!=null?parseFloat(o[g]):void 0;if(a!=null&&(!g||n||!isNaN(y)&&y!==0)){isNaN(y)||n||(a/=y);const w=Nie(a,c);if(w){const b=w[0],x=w[1];if(b===x)return r.stops[b].opacity;{const T=r.stops[b].opacity;return T+(r.stops[x].opacity-T)*w[2]}}}}function zPe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void SV("RotationVariable");const n=r.axis||"heading",s=n==="heading"&&r.rotationType==="arithmetic"?90:0,o=n==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,g=0;if(!c&&!h)return g;if(h){if((i==null?void 0:i.arcade)==null)return void TV();const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},w=i.arcade.arcadeUtils,b=w.getViewInfo(y),x=w.createExecContext(a,b,i.timeZone);if(!p){const T=w.createSyntaxTree(r.valueExpression);p=w.createFunction(T),r.cache.compiledFunc=p}g=w.executeFunction(p,x)}else l&&(g=l[c]||0);return g=typeof g!="number"||isNaN(g)?null:s+o*g,g}function IEt(t,e,i){const r=typeof e=="number",n=r?null:e,s=n==null?void 0:n.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=i!=null?i.scale:void 0,p=i!=null?i.view:void 0;o=h==null||p==="3d"?PEt(t):h}else if(!r)switch(t.inputValueType){case gy.Expression:{if((i==null?void 0:i.arcade)==null)return void TV();const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,g=p.getViewInfo(h),y=p.createExecContext(n,g,i.timeZone);if(!l){const w=p.createSyntaxTree(t.valueExpression);l=p.createFunction(w),t.cache.compiledFunc=l}o=p.executeFunction(l,y);break}case gy.Field:s&&(o=s[t.field]);break;case gy.Unknown:o=null}if(!S3(o))return null;if(r||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return S3(c)&&c!==0?o/c:null}function PEt(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function EV(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void SV("SizeVariable");const n=BPe(IEt(r,e,i),r,e,i,r.cache.ipData);return n==null||isNaN(n)?0:n}function Bc(t,e,i){return t==null?null:W2(t)?EV(t,e,i):S3(t)?t:null}function VPe(t,e,i){return S3(i)&&t>i?i:S3(e)&&t<e?e:t}function LEt(t,e,i,r){return t+((Bc(e.minSize,i,r)||e.minDataValue)??0)}function DEt(t,e,i){const r=t.stops;let n=(r==null?void 0:r.length)&&r[0].size;return n==null&&(n=t.minSize),Bc(n,e,i)}function NEt(t,e,i,r){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=Bc(e.minSize,i,r),o=Bc(e.maxSize,i,r),a=r!=null?r.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?v4*(s/2)**2:s*s,h=c+n*((l?v4*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/v4):Math.sqrt(h)}return s+n*(o-s)}function FEt(t,e,i,r){const n=r!=null?r.shape:void 0,s=t/e.minDataValue,o=Bc(e.minSize,i,r),a=Bc(e.maxSize,i,r);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,VPe(l,o,a)}function kEt(t,e,i,r,n){var l,c,h;const[s,o,a]=Nie(t,n);if(s===o)return Bc((l=e.stops)==null?void 0:l[s].size,i,r);{const p=Bc((c=e.stops)==null?void 0:c[s].size,i,r);return p+(Bc((h=e.stops)==null?void 0:h[o].size,i,r)-p)*a}}function UEt(t,e,i,r){const n=((r==null?void 0:r.resolution)??1)*yC[e.valueUnit],s=Bc(e.minSize,i,r),o=Bc(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/v4)/n:a==="radius"||a==="distance"?2*t/n:t/n,VPe(l,s,o)}function BPe(t,e,i,r,n){switch(e.transformationType){case Lo.Additive:return LEt(t,e,i,r);case Lo.Constant:return DEt(e,i,r);case Lo.ClampedLinear:return NEt(t,e,i,r);case Lo.Proportional:return FEt(t,e,i,r);case Lo.Stops:return kEt(t,e,i,r,n);case Lo.RealWorldSize:return UEt(t,e,i,r);case Lo.Identity:return t;case Lo.Unknown:return null}}function zEt(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const n={scale:e,view:i};let s=Bc(t.minSize,kye,n),o=Bc(t.maxSize,kye,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function VEt(t,e,i){if(!t.visualVariables)return;const r=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=kPe(l,e,i);r.push({variable:l,value:c})}),s.forEach(l=>{const c=UPe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=zPe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=EV(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function Nie(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((n,s)=>t<n?(r=s,!0):(i=s,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function BEt(t,e,i){const r=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":EV(n,e,i);switch(n.axis){case"width":r[0]=s;break;case"depth":r[1]=s;break;case"height":r[2]=s;break;case"width-and-depth":r[0]=s,r[1]=s;break;case"all":case void 0:case null:r[0]=s,r[1]=s,r[2]=s;break;default:n.axis}}return r}const f7t=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:BEt,getColor:kPe,getOpacity:UPe,getRotationAngle:zPe,getSize:EV,getSizeForValue:BPe,getSizeFromNumberOrVariable:Bc,getSizeRangeAtScale:zEt,getVisualVariableValues:VEt,viewScaleRE:FPe},Symbol.toStringTag,{value:"Module"}));var aX;const KD=new sr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),lX=new sr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function Uye(t){if(t!=null)return typeof t=="string"||typeof t=="number"?OEt(t):t.type==="size"?W2(t)?t:(delete(t={...t}).type,new qr(t)):void 0}function zye(t,e,i){if(typeof t!="object")return t;const r=new qr;return r.read(t,i),r}let qr=aX=class extends dM{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&FPe.test(this.valueExpression)}}set index(t){W2(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),W2(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return DPe(this)}set maxDataValue(t){t&&this.stops&&(de.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(de.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Uye(t)}readMaxSize(t,e,i){return zye(t,e,i)}set minDataValue(t){t&&this.stops&&(de.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(de.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Uye(t)}readMinSize(t,e,i){return zye(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(de.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return REt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r!=null&&r.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;r.messages.push(new Y("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?lX.read(t):null}clone(){var t,e;return new aX({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:W2(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:W2(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:(t=this.stops)==null?void 0:t.map(i=>i.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:(e=this.legendOptions)==null?void 0:e.clone()})}flipSizes(){if(this.transformationType===Lo.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Lo.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){var t;return(t=this.stops)==null?void 0:t.map(e=>e.value||0)}};u([f({readOnly:!0})],qr.prototype,"cache",null),u([f({type:KD.apiValues,json:{type:KD.jsonValues,origins:{"web-map":{read:!1}},read:KD.read,write:KD.write}})],qr.prototype,"axis",void 0),u([f()],qr.prototype,"index",null),u([f({type:String,readOnly:!0})],qr.prototype,"inputValueType",null),u([f({type:AEt,json:{write:!0}})],qr.prototype,"legendOptions",void 0),u([f({type:Number,value:null,json:{write:!0}})],qr.prototype,"maxDataValue",null),u([f({type:Number,value:null,json:{write:!0}})],qr.prototype,"maxSize",null),u([$i("maxSize")],qr.prototype,"castMaxSize",null),u([Pe("maxSize")],qr.prototype,"readMaxSize",null),u([f({type:Number,value:null,json:{write:!0}})],qr.prototype,"minDataValue",null),u([f({type:Number,value:null,json:{write:!0}})],qr.prototype,"minSize",null),u([$i("minSize")],qr.prototype,"castMinSize",null),u([Pe("minSize")],qr.prototype,"readMinSize",null),u([f({type:String,json:{write:!0}})],qr.prototype,"normalizationField",void 0),u([f({readOnly:!0})],qr.prototype,"arcadeRequired",null),u([f({type:String})],qr.prototype,"scaleBy",void 0),u([f({type:[y4],value:null,json:{write:!0}})],qr.prototype,"stops",null),u([f({type:["outline"],json:{write:!0}})],qr.prototype,"target",void 0),u([f({type:String,readOnly:!0})],qr.prototype,"transformationType",null),u([f({type:["size"],json:{type:["sizeInfo"]}})],qr.prototype,"type",void 0),u([f({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],qr.prototype,"useSymbolValue",void 0),u([f({type:String,json:{write:!0}})],qr.prototype,"valueExpression",void 0),u([Pe("valueExpression",["valueExpression","expression"])],qr.prototype,"readValueExpression",null),u([ke("web-scene","valueExpression")],qr.prototype,"writeValueExpressionWebScene",null),u([f({type:["radius","diameter","area","width","distance"],json:{write:!0}})],qr.prototype,"valueRepresentation",void 0),u([f({type:lX.apiValues,json:{write:lX.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],qr.prototype,"valueUnit",void 0),u([Pe("valueUnit")],qr.prototype,"readValueUnit",null),qr=aX=u([L("esri.renderers.visualVariables.SizeVariable")],qr);const CV=qr,jEt={color:PPe,size:CV,opacity:Die,rotation:LPe},GEt=new sr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),HEt=/^\[([^\]]+)\]$/i;let w4=class extends Ne{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e==null?void 0:e.filter(i=>!!i),e==null?void 0:e.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let n=null;return n=i.target===r.target?0:i.target?1:-1,n});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:n,rotationType:s}=i,o=n==null?void 0:n.match(HEt),a=o==null?void 0:o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=GEt.read(l.type),h=jEt[c];h||(de.getLogger(this).warn(`Unknown variable type: ${c}`),r!=null&&r.messages&&r.messages.push(new Yp("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const p=new h;return p.read(l,r),p})}writeVariables(e,i){const r=[];for(const n of e){const s=n.toJSON(i);s&&r.push(s)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([f()],w4.prototype,"visualVariables",null),w4=u([L("esri.renderers.visualVariables.VisualVariableFactory")],w4);const qEt=w4,WEt={base:dM,key:"type",typeMap:{opacity:Die,color:PPe,rotation:LPe,size:CV}},pM=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new qEt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,n){return this._vvFactory.readVariables(i,r,n)}writeVisualVariables(i,r,n,s){r[n]=this._vvFactory.writeVariables(i,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const n=this.visualVariables;return n?n.filter(s=>s.type===i&&(typeof r=="string"?s.target===r:r!==!1||!s.target)):[]}async collectVVRequiredFields(i,r){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&Jl(i,r,s.field),s.normalizationField&&Jl(i,r,s.normalizationField),s.valueExpression&&(ZEt(s.valueExpression,i,r)||await Sl(i,r,s.valueExpression)))}};return u([f({types:[WEt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Pe("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([ke("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([L("esri.renderers.mixins.VisualVariablesMixin")],e),e};function ZEt(t,e,i){const r=EEt(t);return r!=null&&(Jl(e,i,r),!0)}const Fie=[252,146,31,255],YEt=[153,153,153,255],XEt={type:"esriSMS",style:"esriSMSCircle",size:6,color:Fie,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},JEt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:Fie},QEt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},KEt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},eCt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},tCt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},iCt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},jPe=Lm.fromJSON(XEt),GPe=Wu.fromJSON(JEt),HPe=Ix.fromJSON(QEt),rCt=tM.fromJSON(KEt);function g7t(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return jPe;case"polyline":return GPe;case"polygon":case"extent":return HPe}return null}Lm.fromJSON(eCt);Wu.fromJSON(tCt);Ix.fromJSON(iCt);const nCt=td.fromSimpleMarkerSymbol(jPe),sCt=Rx.fromSimpleLineSymbol(GPe),oCt=Kv.fromSimpleFillSymbol(HPe),aCt=new Q3({symbolLayers:new ot([new $x({material:{color:Fie},edges:new G2e({size:ud(1),color:new mt(YEt)})})])}),lCt=new Rx({symbolLayers:new ot([new eM({material:{color:new mt([0,0,0])},size:ud(1)})])}),cCt=new Kv({symbolLayers:new ot([new $x({outline:{color:new mt([0,0,0]),size:ud(1)}})])});function y7t(t){if(t==null)return null;switch(t.type){case"mesh":return aCt;case"point":case"multipoint":return nCt;case"polyline":return sCt;case"polygon":case"extent":return oCt}return null}const Vye="#useCIMFallbackSymbology()",sT={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function uCt(t,e=sT){var l,c,h,p;if(!t)return{symbol:null};const{retainId:i=sT.retainId,ignoreDrivers:r=sT.ignoreDrivers,hasLabelingContext:n=sT.hasLabelingContext,retainCIM:s=sT.retainCIM,cimFallbackEnabled:o=sT.cimFallbackEnabled}=e;let a=null;if(xce(t)||t instanceof Px)a=t.clone();else if(t.type==="cim"){const g=(c=(l=t.data)==null?void 0:l.symbol)==null?void 0:c.type;switch(g){case"CIMPointSymbol":a=s?t.clone():td.fromCIMSymbol(t);break;case"CIMLineSymbol":o&&(a=lCt.clone(),(h=e==null?void 0:e.logWarning)==null||h.call(e,Vye,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":o&&(a=cCt.clone(),(p=e==null?void 0:e.logWarning)==null||p.call(e,Vye,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!a)return{error:new Y("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${g||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof Wu)a=Rx.fromSimpleLineSymbol(t);else if(t instanceof Lm)a=td.fromSimpleMarkerSymbol(t);else if(t instanceof K3)a=td.fromPictureMarkerSymbol(t);else if(t instanceof Ix)a=e.geometryType&&e.geometryType==="mesh"?Q3.fromSimpleFillSymbol(t):Kv.fromSimpleFillSymbol(t);else{if(!(t instanceof tM))return{error:new Y("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=n?Sz.fromTextSymbol(t):td.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),r&&xce(a)&&a.symbolLayers.forEach(g=>g.ignoreDrivers=!0),{symbol:a}}function Xk(t,e,i,r){const n=qPe(t,{},{context:r,isLabelSymbol:!1});n!=null&&(e[i]=n)}function Bye(t,e,i,r){const n=qPe(t,{},{context:r,isLabelSymbol:!0});n!=null&&(e[i]=n)}function jye(t){return t instanceof Ax||t instanceof Px}function hCt(t){return t instanceof Ax&&(t.type==="polygon-3d"||t.type==="line-3d")}function qPe(t,e,i){var a;if(t==null)return null;const{context:r,isLabelSymbol:n}=i,s=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(s==="web-scene"&&!jye(t)){const l=uCt(t,{retainCIM:!0,hasLabelingContext:n});return l.symbol!=null?l.symbol.write(e,r):(o==null||o.push(new Y("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:l.error})),null)}return d9(r==null?void 0:r.layer)&&hCt(t)?(o==null||o.push(new Y("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported on layers of type '${(a=r==null?void 0:r.layer)==null?void 0:a.declaredClass}'.`,{symbol:t,context:r})),null):(s==="web-map"||s==="portal-item"&&!d9(r==null?void 0:r.layer))&&jye(t)?(o==null||o.push(new Y("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function _7t(t,e){return VJe(t,null,e)}const MV={types:MEe,json:{write:{writer:Xk},origins:{"web-scene":{types:Sce,write:{writer:Xk},read:{reader:IC({types:Sce})}}}}},kie=pJ({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},MV),Uie={types:{base:Ya,key:"type",typeMap:{"simple-fill":K_.typeMap["simple-fill"],"picture-fill":K_.typeMap["picture-fill"],"polygon-3d":K_.typeMap["polygon-3d"],cim:K_.typeMap.cim}},json:{write:{writer:Xk},origins:{"web-scene":{type:Kv,write:{writer:Xk}}}}},b4={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var cX;let S_=cX=class extends we{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){var t;return new cX({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:((t=this.symbol)==null?void 0:t.clone())??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([f({type:String,json:{write:!0}})],S_.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],S_.prototype,"label",void 0),u([f({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],S_.prototype,"minValue",void 0),u([f({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],S_.prototype,"maxValue",void 0),u([f(kie)],S_.prototype,"symbol",void 0),S_=cX=u([L("esri.renderers.support.ClassBreakInfo")],S_);const Jk=S_,dCt=Za()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let wA=class extends Or(we){constructor(e){super(e),this.title=null,this.order=null}};u([f({type:String,json:{write:!0}})],wA.prototype,"title",void 0),u([_t(dCt)],wA.prototype,"order",void 0),wA=u([L("esri.renderers.support.RendererLegendOptions")],wA);const zie=wA;var uX;const WPe="log",x4="percent-of-total",S4="field",eN=new sr({esriNormalizeByLog:WPe,esriNormalizeByPercentOfTotal:x4,esriNormalizeByField:S4}),pCt=is(Jk);let co=uX=class extends pM(Zy){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(n=>{const s=new Jk;return s.read(n,i),s.minValue==null&&(s.minValue=r),s.maxValue==null&&(s.maxValue=s.minValue),r=s.maxValue,s})}writeClassBreakInfos(t,e,i,r){const n=t.map(s=>s.write({},r));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),e[i]=n}castField(t){return t==null?t:typeof t=="function"?(de.getLogger(this).error(".field: field must be a string value"),null):I3(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&S4||i&&x4||null,e&&i&&de.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==S4&&t!==x4||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new Jk({minValue:t,maxValue:e,symbol:$Ee(i)}):pCt(te(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const n=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(n[0]===t&&n[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(e==null?void 0:e.arcade)==null&&de.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await Dv()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void de.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(e==null?void 0:e.arcade)==null){const n=await Dv(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),i={...i,arcade:n}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,n)=>r+n.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){var t,e;return new uX({field:this.field,backgroundFillSymbol:(t=this.backgroundFillSymbol)==null?void 0:t.clone(),defaultLabel:this.defaultLabel,defaultSymbol:(e=this.defaultSymbol)==null?void 0:e.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:te(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:te(this.visualVariables),legendOptions:te(this.legendOptions),authoringInfo:te(this.authoringInfo)})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Sl(t,e,this.valueExpression)];Jl(t,e,this.field),Jl(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:n,arcade:s,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=s.arcadeUtils;if(!l){const p=c.createSyntaxTree(a);l=c.createFunction(p),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const h=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:i,scale:r,spatialReference:n}),o));return this._getBreakIndexfromInfos(h)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let n=parseFloat(i[e]);if(r){const s=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===WPe)n=Math.log(n)*Math.LOG10E;else if(r!==x4||s==null||isNaN(s)){if(r===S4&&!isNaN(o)){if(isNaN(n)||isNaN(o))return-1;n/=o}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};u([f(Uie)],co.prototype,"backgroundFillSymbol",void 0),u([f({type:[Jk]})],co.prototype,"classBreakInfos",void 0),u([Pe("classBreakInfos")],co.prototype,"readClassBreakInfos",null),u([ke("classBreakInfos")],co.prototype,"writeClassBreakInfos",null),u([f({type:String,json:{write:!0}})],co.prototype,"defaultLabel",void 0),u([f(MV)],co.prototype,"defaultSymbol",void 0),u([f({type:String,json:{write:!0}})],co.prototype,"field",void 0),u([$i("field")],co.prototype,"castField",null),u([f({type:Boolean})],co.prototype,"isMaxInclusive",void 0),u([f({type:zie,json:{write:!0}})],co.prototype,"legendOptions",void 0),u([f({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],co.prototype,"minValue",null),u([f({type:String,json:{write:!0}})],co.prototype,"normalizationField",void 0),u([f({type:Number,json:{write:!0}})],co.prototype,"normalizationTotal",void 0),u([f({type:eN.apiValues,value:null,json:{type:eN.jsonValues,read:eN.read,write:eN.write}})],co.prototype,"normalizationType",null),u([_t({classBreaks:"class-breaks"})],co.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],co.prototype,"valueExpression",void 0),u([f({type:String,json:{write:!0}})],co.prototype,"valueExpressionTitle",void 0),co=uX=u([L("esri.renderers.ClassBreaksRenderer")],co);const ZPe=co;let fCt=class{constructor(e,i){this._storage=new $Re,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},$V=class{};function mCt(t){return t instanceof zC?t===$V.instance:(t==null?void 0:t.toString().toLowerCase())==="unknown"}function x7t(t){return mCt(t)?$V.instance:t}$V.instance=new Gu("Etc/UTC");function gCt(t){return"timeZone"in t}function yCt(t){return"timeZone"in t}function _Ct(t){return"dateFieldsTimeZone"in t}const vCt=new Map;let YPe=class T4{static fromJSON(e){return new T4(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new T4(e.fields??[],Hye(e))}static fromLayerJSON(e){return new T4(e.fields??[],Hye(e))}constructor(e=[],i){var n;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const s of this.fields){const o=s==null?void 0:s.name,a=Gye(o);if(o&&a){const l=rb(o);this._fieldsMap.set(o,s),this._fieldsMap.set(l,s),this._normalizedFieldsMap.set(a,s),r.push(`${l}:${s.type}:${(n=this._timeZoneByFieldName)==null?void 0:n.get(o)}`),D2e(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):EK(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),mce(s)||gce(s)||(s.editable=s.editable==null||!!s.editable,s.nullable=s.nullable==null||!!s.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)mce(e)||gce(e)||e.nullable||mXe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===(e==null?void 0:e.uid)}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(rb(e))??this._normalizedFieldsMap.get(Gye(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(de.getLogger("esri.layers.support.FieldsIndex").error(new Y("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),Tv):XPe.has(i.type)?Wb:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===Wb?$V.instance:i===Tv?Ba.utcInstance:hU(vCt,i,()=>Gu.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return MXe(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){var i;return((i=this.get(e))==null?void 0:i.name)??void 0}toJSON(){return{fields:this.fields.map(e=>W4(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function rb(t){return t.trim().toLowerCase()}function Gye(t){var e;return((e=KYe(t))==null?void 0:e.toLowerCase())??""}const XPe=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function Hye(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:n}=t,s=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=_Ct(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?ON(t.dateFieldsTimeReference):null,l=n?gCt(n)?n.timeZone??a:n.dateFieldsTimeReference?ON(n.dateFieldsTimeReference):a??Tv:null,c=r?yCt(r)?r.timeZone??a:r.timeReference?ON(r.timeReference):a:null,h=new Map([[rb((n==null?void 0:n.creationDateField)??""),l],[rb((n==null?void 0:n.editDateField)??""),l],[rb(s),c],[rb(o),c]]);for(const{name:p,type:g}of t.fields)if(XPe.has(g))e.set(p,Wb);else if(g!=="date"&&g!=="esriFieldTypeDate")e.set(p,null);else if(i)e.set(p,Wb);else{const y=h.get(rb(p??""))??a;e.set(p,y)}return e}const S7t={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:SY.Loop,repeatdelay:0,easing:TY.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}};function wCt(t){return typeof t=="function"}function T7t(t,e,i,r){return wCt(t)?t(e,i,r):t}const bCt=` /-,
`;function qye(t){let e=t.length;for(;e--;)if(!bCt.includes(t.charAt(e)))return!1;return!0}function xCt(t,e){const i=[];let r=0,n=-1;do if(n=t.indexOf("[",r),n>=r){if(n>r){const s=t.slice(r,n);i.push([s,null,qye(s)])}if(r=n+1,n=t.indexOf("]",r),n>=r){if(n>r){const s=e[t.slice(r,n)];s&&i.push([null,s,!1])}r=n+1}}while(n!==-1);if(r<t.length){const s=t.slice(r);i.push([s,null,qye(s)])}return i}function SCt(t,e,i,r){let n="",s=null;for(const o of e){const[a,l,c]=o;if(a)c?s=a:(s&&(n+=s,s=null),n+=a);else{let h=l;i!=null&&(h=JPe(l,i));const p=t.attributes[h];p&&(s&&(n+=s,s=null),n+=p)}}return TCt(n,r)}function TCt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function E7t(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function C7t(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function M7t(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function $7t(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function O7t(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const A7t=(t,e=0)=>t==null||isNaN(t)?e:t,R7t=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function I7t(){return fe(()=>import("./geometryEngineJSON-BwrklJA_.js").then(t=>t.g),__vite__mapDeps([22,15,3,23]))}function P7t(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function L7t(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function D7t(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function N7t(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function Wye(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=Wye(e);if(i!=null)return i}break;case"CIMTextSymbol":return Wye(t.symbol);case"CIMSolidFill":return t.color}return null}function Zye(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=Zye(i);if(r!=null)return r}break}case"CIMTextSymbol":return Zye(t.symbol);case"CIMSolidStroke":return t.color}}function Yye(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=Yye(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return Yye(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function F7t(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function k7t(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function ECt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const U7t=t=>t.includes("data:image/svg+xml");function z7t(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function Vie(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}function V7t(t,e,i,r,n,s,o=!0){const{infos:a}=s;let l=1,c=0,h=0,p=0,g=1;for(const{absoluteAnchorPoint:b,offsetX:x,offsetY:T,rotation:M,size:$,frameHeight:R,rotateClockWise:I,scaleSymbolsProportionally:P}of a)g=b?1:l,h=Qye(x,T,c,g,h),p=Jye(x,T,c,g,p),R&&(P||o)&&(l*=$/R),c=Kye(M,I,c);const y=Qye(r,n,c,g,h),w=Jye(r,n,c,g,p);return{size:t*l,rotation:Kye(e,i,c),offsetX:y,offsetY:w}}function CCt(t){return t.split(" ").map(e=>Number(e))}function MCt(t){return typeof t=="string"?CCt(t):t}function $Ct(t){return t!=null&&t.dashTemplate&&(t.dashTemplate=MCt(t.dashTemplate)),t}function hX(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return hX(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return hX(i.symbol)}}return"Normal"}function JPe(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function OCt(t){return t.map(e=>({...e,propertyName:Vie(e.propertyName)}))}function Xye(t){const e={};for(const i in t){const r=t[i];e[Vie(i)]=r}return e}function Jye(t,e,i,r,n){const s=i*Math.PI/180;if(s){const o=Math.cos(s);return(Math.sin(s)*t+o*e)*r+n}return e*r+n}function Qye(t,e,i,r,n){const s=i*Math.PI/180;return s?(Math.cos(s)*t-Math.sin(s)*e)*r+n:t*r+n}function Kye(t,e,i){return e?i-t:i+t}function ACt(t,e,i,r,n){if(t==null)return null;const s=t.referencesGeometry()&&n?RCt(e,r,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return de.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const iH=new Map;function RCt(t,e,i){const{transform:r,hasZ:n,hasM:s}=i;iH.has(e)||iH.set(e,ICt(e));const o=iH.get(e)(t.geometry,r,n,s);return{...t,geometry:o}}function ICt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,n,s)=>xAe(r,e,i,n,s);case"esriGeometryPolygon":return(i,r,n,s)=>SAe(r,e,i,n,s);case"esriGeometryPolyline":return(i,r,n,s)=>TAe(r,e,i,n,s);case"esriGeometryMultipoint":return(i,r,n,s)=>bAe(r,e,i,n,s);default:return de.getLogger("esri.views.2d.support.arcadeOnDemand").error(new Y("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const PCt=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:n}=t;return[e,i,r,255*n]};let QPe=class os{static findApplicableOverrides(e,i,r){if(e&&i){if(e.primitiveName){let n=!1;for(const s of r)if(s.primitiveName===e.primitiveName){n=!0;break}if(!n)for(const s of i)s.primitiveName===e.primitiveName&&r.push(s)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)os.findApplicableOverrides(n,i,r);if(e.symbolLayers)for(const n of e.symbolLayers)os.findApplicableOverrides(n,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const n of e.effects)os.findApplicableOverrides(n,i,r);if(e.markerPlacement&&os.findApplicableOverrides(e.markerPlacement,i,r),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const n of e.markerGraphics)os.findApplicableOverrides(n,i,r),os.findApplicableOverrides(n.symbol,i,r)}else e.type==="CIMCharacterMarker"?os.findApplicableOverrides(e.symbol,i,r):e.type==="CIMHatchFill"?os.findApplicableOverrides(e.lineSymbol,i,r):e.type==="CIMPictureMarker"&&os.findApplicableOverrides(e.animatedSymbolProperties,i,r)}}}static findEffectOverrides(e,i){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&$Ct(e),!i||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=Xye(e),n=e.primitiveName,s=[];for(const o of i)o.primitiveName===n&&s.push(Xye(o));return{type:"cim-effect-param",effect:r,overrides:OCt(s)}}static async resolveSymbolOverrides(e,i,r,n,s,o,a){if(!(e!=null&&e.symbol))return null;let{symbol:l,primitiveOverrides:c}=e;const h=!!c;if(!h&&!n)return l;l=te(l),c=te(c);let p=!0;if(i||(i={attributes:{}},p=!1),h){if(p||(c=c.filter(g=>{var y;return!((y=g.valueExpressionInfo)!=null&&y.expression.includes("$feature"))})),a||(c=c.filter(g=>{var y;return!((y=g.valueExpressionInfo)!=null&&y.expression.includes("$view"))})),c.length>0){const g={spatialReference:r,fields:ECt(i.attributes),geometryType:s};await os.createRenderExpressions(c,g),os.evaluateOverrides(c,i,s??"esriGeometryPoint",o,a)}os.applyOverrides(l,c)}return n&&os.applyDictionaryTextOverrides(l,i,n,null),l}static async createRenderExpressions(e,i){const r=[];for(const n of e){const s=n.valueExpressionInfo;if(!s||os._expressionToRenderExpression.has(s.expression))continue;const o=YYe(s.expression,i.spatialReference,i.fields);r.push(o),o.then(a=>os._expressionToRenderExpression.set(s.expression,a))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,i,r,n,s){const o={$view:{scale:s==null?void 0:s.scale}};for(const a of e){a.value&&typeof a.value=="object"&&iIe(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=PCt(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=os._expressionToRenderExpression.get(l.expression);c&&(a.value=ACt(c,i,o,r,n))}}static applyDictionaryTextOverrides(e,i,r,n,s="Normal"){if(e!=null&&e.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&os.applyDictionaryTextOverrides(a,i,r,n,e.type==="CIMTextSymbol"?e.textCase:s)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&os.applyDictionaryTextOverrides(a,i,r,n)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=xCt(o,r);e.textString=SCt(i,a,n,s)}}}}static applyOverrides(e,i,r,n){if(e.primitiveName){for(const s of i)if(s.primitiveName===e.primitiveName){const o=Vie(s.propertyName);if(n&&n.push({cim:e,nocapPropertyName:o,value:e[o]}),r){let a=!1;for(const l of r)l.primitiveName===e.primitiveName&&(a=!0);a||r.push(s)}s.value!=null&&(e[o]=s.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)os.applyOverrides(s,i,r,n);if(e.symbolLayers)for(const s of e.symbolLayers)os.applyOverrides(s,i,r,n);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)os.applyOverrides(s,i,r,n);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const s of e.markerGraphics)os.applyOverrides(s,i,r,n),os.applyOverrides(s.symbol,i,r,n)}}static restoreOverrides(e){for(const i of e)i.cim[i.nocapPropertyName]=i.value}static buildOverrideKey(e){let i="";for(const r of e)r.value!==void 0&&(i+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return i}static toValue(e,i){if(e==="DashTemplate")return i.split(" ").map(r=>Number(r));if(e==="Color"){const r=new mt(i).toRgba();return r[3]*=255,r}return i}};QPe._expressionToRenderExpression=new Map;const e0e="esri.renderers.support.DictionaryLoader",LCt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let KPe=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new fCt(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){var p;let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(g){if(Bn(g))return this._dictionaryPromise=null,null}const n=(p=this._dictionaryVersion)==null?void 0:p.greaterEqual(4,0),s={};if(this.fieldMap)for(const g of this._symbolFields){const y=JPe(this.fieldMap[g],this._fieldIndex);if(y){const w=e.attributes[y];s[g]=n?w:w!=null?""+e.attributes[y]:""}else s[g]=""}let o=null;try{o=r==null?void 0:r(s,i)}catch{return null}if(!o||typeof o!="string"||o==="invalid")return null;const a=o.split(";"),l=[],c=[];for(let g=0;g<a.length;g++){const y=a[g];if(y){if(y.includes("po:")){const w=y.slice(3).split("|");if(w.length===3){const b=w[0],x=w[1];let T=w[2];const M="countrylabel";if(b===M&&x==="TextString"){if(this.fieldMap!=null){let $=this.fieldMap[M];$==null&&($=M,this.fieldMap[$]=$),e.attributes[$]=T}continue}if(x==="DashTemplate")T=T.split(" ").map($=>Number($));else if(x==="Color"){const $=new mt(T).toRgba();T=[$[0],$[1],$[2],255*$[3]]}else T=Number(T);c.push({primitiveName:b,propertyName:x,value:T,defaultValue:null})}}else if(y.includes("|")){for(const w of y.split("|"))if(this._itemNames.has(w)){l.push(w);break}}else if(this._itemNames.has(y))l.push(y);else if(g===0){l.length=0;let w="Invalid_P";e.geometry!=null&&(bb(e.geometry)?w="Invalid_A":AU(e.geometry)&&(w="Invalid_L")),l.push(w);break}}}const h=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,l,c,h,i)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void de.getLogger(e0e).error("no valid URL!");const i=Br(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,Dv()]);if(!r)throw this._dictionaryPromise=null,new Y("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:n,dictionary_version:s,expression:o,itemsNames:a}=r,l=o;let c=!1;s&&(this._dictionaryVersion=GU.parse(s),c=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=n.symbol;const h={};if(this.config){const y=this.config;for(const w in y)h[w]=y[w]}if(n.configuration)for(const y of n.configuration)h.hasOwnProperty(y.name)||(h[y.name]=y.value);const p=[];if(e!=null&&e.fields&&this.fieldMap)for(const y in this.fieldMap){const w=this.fieldMap[y],b=e.fields.filter(x=>x.name.toLowerCase()===(w==null?void 0:w.toLowerCase()));b.length>0&&p.push({...b[0],type:c?b[0].type:"esriFieldTypeString"})}p.length>0&&(this._fieldIndex=new YPe(p));const g=XYe(l,e!=null?e.spatialReference:null,p,h).then(y=>{const w={scale:0};return(b,x)=>{if(y==null)return null;const T=y.repurposeFeature({geometry:null,attributes:b});return w.scale=x!=null?x.scale??void 0:void 0,y.evaluate({$feature:T,$view:w},y.services)}}).catch(y=>(de.getLogger(e0e).error("Creating dictionary expression failed:",y),null));return this._dictionaryPromise=g,g}async _cimPartsToCIMSymbol(e,i,r,n,s){const o=new Array(i.length);for(let c=0;c<i.length;c++)o[c]=this._getSymbolPart(i[c],s);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=te(a);for(const c of a)QPe.applyDictionaryTextOverrides(c,e,l,this._fieldIndex,hX(c))}return new Jv({data:DCt(a,r,n)})}async _getSymbolPart(e,i){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(o=>o.data);const n=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),s=Br(n,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,s),s.finally(()=>this._ongoingRequests.delete(e));try{const o=await s;return this._symbolCache.put(e,o.data),o.data}catch(o){throw o}}};function DCt(t,e,i){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.effects=null,r.symbolLayers=[];for(const n of t){const s=n;if(s.effects!=null)for(const o of s.symbolLayers)o.effects==null?o.effects=s.effects:o.effects.unshift(...s.effects);r.symbolLayers.unshift(...s.symbolLayers)}}return i&&(r.callout=LCt),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var dX;let cp=dX=class extends pM(Zy){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new KPe(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r!=null&&r.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new dX({config:te(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:te(this.fieldMap),url:te(this.url),visualVariables:te(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Sl(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([f({type:KPe})],cp.prototype,"_loader",null),u([f({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],cp.prototype,"config",void 0),u([f({type:Object,json:{write:!0}})],cp.prototype,"fieldMap",void 0),u([f({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],cp.prototype,"scaleExpression",void 0),u([ke("scaleExpression")],cp.prototype,"writeData",null),u([f({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],cp.prototype,"scaleExpressionTitle",void 0),u([f({type:String,json:{write:!0}})],cp.prototype,"url",void 0),u([ke("visualVariables")],cp.prototype,"writeVisualVariables",null),cp=dX=u([L("esri.renderers.DictionaryRenderer")],cp);const NCt=cp;var pX;let Dg=pX=class extends we{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(de.getLogger(this).error(".field: field must be a string value"),null):I3(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var t;return new pX({color:(t=this.color)==null?void 0:t.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([f({type:mt,json:{type:[Number],write:!0}})],Dg.prototype,"color",void 0),u([f({type:String,json:{write:!0}})],Dg.prototype,"field",void 0),u([$i("field")],Dg.prototype,"castField",null),u([f({type:String,json:{write:!0}})],Dg.prototype,"label",void 0),u([f({type:String,json:{write:!0}})],Dg.prototype,"valueExpression",void 0),u([f({type:String,json:{write:!0}})],Dg.prototype,"valueExpressionTitle",void 0),Dg=pX=u([L("esri.renderers.support.AttributeColorInfo")],Dg);const eLe=Dg;var fX;let E4=fX=class extends we{constructor(){super(...arguments),this.unit=null}clone(){return new fX({unit:this.unit})}};u([f({type:String,json:{write:!0}})],E4.prototype,"unit",void 0),E4=fX=u([L("esri.renderers.support.DotDensityLegendOptions")],E4);const FCt=E4;var mX;let wc=mX=class extends pM(Zy){constructor(t){super(t),this.attributes=null,this.backgroundColor=new mt([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Wu,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Ix({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new mX({attributes:te(this.attributes),backgroundColor:te(this.backgroundColor),dotBlendingEnabled:te(this.dotBlendingEnabled),dotShape:te(this.dotShape),dotSize:te(this.dotSize),dotValue:te(this.dotValue),legendOptions:te(this.legendOptions),outline:te(this.outline),referenceScale:te(this.referenceScale),seed:te(this.seed),visualVariables:te(this.visualVariables),authoringInfo:te(this.authoringInfo)})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await Sl(t,e,i.valueExpression),i.field&&t.add(i.field)}};u([f({type:[eLe],json:{write:!0}})],wc.prototype,"attributes",void 0),u([f({type:mt,json:{write:!0}})],wc.prototype,"backgroundColor",void 0),u([f({type:Boolean,json:{write:!0}})],wc.prototype,"dotBlendingEnabled",void 0),u([f({type:String,json:{write:!1}})],wc.prototype,"dotShape",void 0),u([f({type:Number,json:{write:!0}})],wc.prototype,"dotSize",void 0),u([f({type:FCt,json:{write:!0}})],wc.prototype,"legendOptions",void 0),u([f({type:Wu,json:{default:null,write:!0}})],wc.prototype,"outline",void 0),u([f({type:Number,json:{write:!0}})],wc.prototype,"dotValue",void 0),u([f({type:Number,json:{write:!0}})],wc.prototype,"referenceScale",void 0),u([f({type:Number,json:{write:!0}})],wc.prototype,"seed",void 0),u([_t({dotDensity:"dot-density"})],wc.prototype,"type",void 0),wc=mX=u([L("esri.renderers.DotDensityRenderer")],wc);const kCt=wc;var gX;let bA=gX=class extends we{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new gX({color:this.color&&this.color.clone(),ratio:this.ratio})}};u([f({type:mt,json:{type:[Wi],default:null,write:!0}})],bA.prototype,"color",void 0),u([f({type:Number,json:{write:!0}})],bA.prototype,"ratio",void 0),bA=gX=u([L("esri.renderers.support.HeatmapColorStop")],bA);const C4=bA;let e2=class extends Or(we){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([f({type:String,json:{write:!0}})],e2.prototype,"minLabel",void 0),u([f({type:String,json:{write:!0}})],e2.prototype,"maxLabel",void 0),u([f({type:String,json:{write:!0}})],e2.prototype,"title",void 0),e2=u([L("esri.renderers.support.HeatmapLegendOptions")],e2);const Bie=2.4;function UCt(t){return ud(t*Bie)}function zCt(t){return qb(t)/Bie}function VCt(t,e,i,r){let{color:n,ratio:s}=e,{color:o,ratio:a}=i;a===s&&(a===1?s-=1e-6:a+=1e-6);const l=Oe((r-s)/(a-s),0,1);YU(t,n.toArray(),o.toArray(),l)}function G7t(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],n=t[0],s=1;const o=Ti();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>n.ratio&&s<t.length;)r=n,n=t[s++];VCt(o,r,n,l),i.set(o,4*a)}return i}function H7t(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function q7t(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var yX;function t0e(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:o,...a}=t;return a}}return t}let ia=yX=class extends Zy{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new C4({ratio:0,color:new mt("rgba(255, 140, 0, 0)")}),new C4({ratio:.75,color:new mt("rgba(255, 140, 0, 1)")}),new C4({ratio:.9,color:new mt("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(t){return t0e(t)}get blurRadius(){return zCt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",UCt(t)),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(Bie**2*this.blurRadius**4)}read(t,e){t=t0e(t),super.read(t,e)}getSymbol(){return new Lm}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&Jl(t,e,i),r&&typeof r=="string"&&await Sl(t,e,r)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new yX({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:te(this.colorStops),field:this.field,legendOptions:te(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([f({type:Lie,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ia.prototype,"authoringInfo",void 0),u([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ia.prototype,"blurRadius",null),u([f({type:[C4],json:{write:!0}})],ia.prototype,"colorStops",void 0),u([f({type:String,json:{write:!0}})],ia.prototype,"field",void 0),u([f({type:e2,json:{write:!0}})],ia.prototype,"legendOptions",void 0),u([f({type:Number,json:{write:!0}})],ia.prototype,"maxDensity",void 0),u([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ia.prototype,"maxPixelIntensity",null),u([f({type:Number,json:{write:!0}})],ia.prototype,"minDensity",void 0),u([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ia.prototype,"minPixelIntensity",null),u([f({type:Number,cast:mr,json:{write:!0}})],ia.prototype,"radius",void 0),u([f({type:Number,range:{min:0},json:{default:0,write:!0}})],ia.prototype,"referenceScale",void 0),u([_t({heatmap:"heatmap"})],ia.prototype,"type",void 0),u([f({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],ia.prototype,"valueExpression",void 0),u([f({type:String})],ia.prototype,"valueExpressionTitle",void 0),u([f({readOnly:!0})],ia.prototype,"_pixelIntensityToDensity",null),ia=yX=u([L("esri.renderers.HeatmapRenderer")],ia);const jie=ia;let nb=class extends Or(we){constructor(){super(...arguments),this.color=new mt([0,0,0,0]),this.label=null,this.threshold=0}};u([f({type:mt,json:{write:!0}})],nb.prototype,"color",void 0),u([f({type:String,json:{write:!0}})],nb.prototype,"label",void 0),u([f({type:Number,range:{min:0,max:1},json:{write:!0}})],nb.prototype,"threshold",void 0),nb=u([L("esri.renderers.support.OthersCategory")],nb);const BCt={base:dM,key:"type",typeMap:{size:CV,opacity:Die}};let bc=class extends pM(Or(Zy)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new mt([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new nb,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){var e;return new Lm({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(Bv)}getAttributeHash(){var e;return((e=this.visualVariables)==null?void 0:e.reduce((i,r)=>i+r.getAttributeHash(),""))??""}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await Sl(e,i,r.valueExpression),r.field&&e.add(r.field)}};u([f({type:[eLe],json:{write:!0}})],bc.prototype,"attributes",void 0),u([f(Uie)],bc.prototype,"backgroundFillSymbol",void 0),u([f({type:mt,json:{write:!0}})],bc.prototype,"defaultColor",void 0),u([f({type:String,json:{write:!0}})],bc.prototype,"defaultLabel",void 0),u([f({type:Number,range:{min:0,max:1},json:{write:!0}})],bc.prototype,"holePercentage",void 0),u([f({type:nb,json:{write:!0}})],bc.prototype,"othersCategory",void 0),u([f({type:zie,json:{write:!0}})],bc.prototype,"legendOptions",void 0),u([f({type:Wu,json:{default:null,write:!0}})],bc.prototype,"outline",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],bc.prototype,"size",void 0),u([_t({pieChart:"pie-chart"})],bc.prototype,"type",void 0),u([f({types:[BCt]})],bc.prototype,"visualVariables",void 0),bc=u([L("esri.renderers.PieChartRenderer")],bc);const jCt=bc;var _X;let Bw=_X=class extends pM(Zy){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new _X({description:this.description,label:this.label,symbol:te(this.symbol),visualVariables:te(this.visualVariables),authoringInfo:te(this.authoringInfo)})}};u([f({type:String,json:{write:!0}})],Bw.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],Bw.prototype,"label",void 0),u([f(kie)],Bw.prototype,"symbol",void 0),u([_t({simple:"simple"})],Bw.prototype,"type",void 0),Bw=_X=u([L("esri.renderers.SimpleRenderer")],Bw);const fM=Bw,GCt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function vX(t){return t instanceof Ne}function i0e(t){return t instanceof ot?Object.keys(t.items):vX(t)?bl(t).keys():t?Object.keys(t):[]}function tN(t,e){return t instanceof ot?t.items[e]:t[e]}function HCt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function gR(t){return t?t.declaredClass:null}function tLe(t,e){var p;const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=i0e(t),n=i0e(e);if(r.length===0&&n.length===0)return;if(!r.length||!n.length||HCt(t,e))return{type:"complete",oldValue:t,newValue:e};const s=n.filter(g=>!r.includes(g)),o=r.filter(g=>!n.includes(g)),a=r.filter(g=>n.includes(g)&&tN(t,g)!==tN(e,g)).concat(s,o).sort(),l=gR(t);if(l&&GCt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=vX(t)&&vX(e);for(const g of a){const y=tN(t,g),w=tN(e,g);let b;if((h||typeof y!="function"&&typeof w!="function")&&y!==w&&(y!=null||w!=null)){if(i&&i[g]&&typeof i[g]=="function")b=(p=i[g])==null?void 0:p.call(i,y,w);else if(y instanceof Date&&w instanceof Date){if(y.getTime()===w.getTime())continue;b={type:"complete",oldValue:y,newValue:w}}else b=typeof y=="object"&&typeof w=="object"&&gR(y)===gR(w)?tLe(y,w):{type:"complete",oldValue:y,newValue:w};b!=null&&(c!=null?c.diff[g]=b:c={type:"partial",diff:{[g]:b}})}}return c}function Y7t(t,e){return qCt(t,e)}function qCt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const n of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const s=r.diff[n];if(!s)return!1;r=s}}return!0}function X7t(t,e){if(!t)return!1;if(t.type==="partial"){const i=Object.keys(t.diff);return i.length===1&&i[0]===e}return!1}function WCt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&gR(t)!==gR(e)?{type:"complete",oldValue:t,newValue:e}:tLe(t,e)}function iN(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!iN(i))return!1;for(const i of e.removed)if(!iN(i))return!1;for(const i of e.changed)if(!iN(i))return!1;return!0}case"partial":for(const e in t.diff)if(!iN(t.diff[e]))return!1;return!0}}let t2=class extends Or(we){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([f(b4)],t2.prototype,"value",void 0),u([f(b4)],t2.prototype,"value2",void 0),u([f(b4)],t2.prototype,"value3",void 0),t2=u([L("esri.renderers.support.UniqueValue")],t2);const EE=t2;let T_=class extends Or(we){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new EE({value:r})):i==="object"?e[0]instanceof EE?e:e.map(r=>new EE(r)):null}};u([f({type:String,json:{write:!0}})],T_.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],T_.prototype,"label",void 0),u([f(MV)],T_.prototype,"symbol",void 0),u([f({type:[EE],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new EE({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const n=[r.value,r.value2,r.value3].filter(Bv).map(s=>s.toString());i.push(n)}e.values=i}}}})],T_.prototype,"values",void 0),u([$i("values")],T_.prototype,"castValues",null),T_=u([L("esri.renderers.support.UniqueValueClass")],T_);const iLe=T_;let xA=class extends Or(we){constructor(e){super(e),this.heading=null,this.classes=null}};u([f({type:String,json:{write:!0}})],xA.prototype,"heading",void 0),u([f({type:[iLe],json:{write:!0}})],xA.prototype,"classes",void 0),xA=u([L("esri.renderers.support.UniqueValueGroup")],xA);const wX=xA;var bX;let jw=bX=class extends we{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new bX({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){var e;const t=JSON.stringify((e=this.symbol)==null?void 0:e.toJSON());return`${this.value}.${t}`}};u([f({type:String,json:{write:!0}})],jw.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],jw.prototype,"label",void 0),u([f(kie)],jw.prototype,"symbol",void 0),u([f(b4)],jw.prototype,"value",void 0),jw=bX=u([L("esri.renderers.support.UniqueValueInfo")],jw);const yR=jw,r0e=new Map;async function ZCt(t,e){try{return{data:(await QCt(t,e)).data,baseUrl:p5e(t),styleUrl:t}}catch(i){return Pc(i),null}}function YCt(t,e,i){var l;const r=e.portal!=null?e.portal:va.getDefault();let n;const s=`${r.url} - ${(l=r.user)==null?void 0:l.username} - ${t}`,o=r0e.get(s);if(o)return o;const a=XCt(t,r,i).then(c=>(n=c,c.fetchData())).then(c=>({data:c,baseUrl:n.itemUrl??"",styleName:t}));return r0e.set(s,a),a}function XCt(t,e,i){return e.load(i).then(()=>{const r=new Cp({disableExtraQuery:!0,query:`owner:${n0e} AND type:${s0e} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let n=null;const s=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===s0e&&a.owner===n0e){n=a;break}}if(!n)throw new Y("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(i)})}function JCt(t,e,i){return(t==null?void 0:t.styleUrl)!=null?ZCt(t.styleUrl,i):(t==null?void 0:t.styleName)!=null?YCt(t.styleName,e,i):Promise.reject(new Y("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function eqt(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function tqt(t,e,i=["gltf"]){if(e==="cimRef")return encodeURI(t.cimRef);if(t.formatInfos&&!pe("enable-feature:force-wosr"))for(const r of i){const n=t.formatInfos.find(s=>s.type===r);if(n)return n.href}return encodeURI(t.webRef)}function QCt(t,e){const i={responseType:"json",query:{f:"json"},...e};return Br(nd(t),i)}const n0e="esri_en",s0e="Style",iqt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var SA;const rLe="esri.renderers.UniqueValueRenderer",W0=()=>de.getLogger(rLe),o0e="uvInfos-watcher",a0e="uvGroups-watcher",KCt=",",eMt=is(yR);function tMt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=t,a=!(!e||!i);return[{classes:(s??[]).map(l=>{var T;const{symbol:c,label:h,value:p,description:g}=l,[y,w,b]=a?((T=p==null?void 0:p.toString())==null?void 0:T.split(n||""))||[]:[p],x=[];return(e||o)&&x.push(y),i&&x.push(w),r&&x.push(b),{symbol:c,label:h,values:[x],description:g}})}]}function oT(t){return t!=null&&t!==""&&(typeof t!="string"||t.trim()!==""&&t.toLowerCase()!=="<null>")||(t=null),t+""}let Yn=SA=class extends pM(Zy){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<i.length;s++){const o=e.find(a=>a.value===i[s].value);o?WCt(o,i[s])?(n.changed.push({type:"complete",oldValue:o,newValue:i[s]}),r=!0):n.unchanged.push({oldValue:o,newValue:i[s]}):(n.added.push(i[s]),r=!0)}for(let s=0;s<e.length;s++)i.find(o=>o.value===e[s].value)||(n.removed.push(e[s]),r=!0);return r?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:I3(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r!=null&&r.messages?r.messages.push(new Y("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):W0().error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||va.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=NC(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=U3(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?W0().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?W0().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var r;if(this.styleOrigin)return void W0().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?eMt(t):new yR({value:t,symbol:$Ee(e)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[oT(i.value)]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void W0().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[oT(t)],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await Dv()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void W0().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(t,e);return(i==null?void 0:i.symbol)||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(i==null?void 0:i.arcade)==null){const n=await Dv(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),i={...i,arcade:n}}const r=this._getUniqueValueInfo(t,i);return(r==null?void 0:r.symbol)||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){var r;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((n,s)=>n+s.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new SA({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:te(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:te(this.visualVariables),legendOptions:te(this.legendOptions),authoringInfo:te(this.authoringInfo),backgroundFillSymbol:te(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=te(this.uniqueValueInfos),i=te(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(te(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Sl(t,e,this.valueExpression)];Jl(t,e,this.field),Jl(t,e,this.field2),Jl(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return JCt(this.styleOrigin,{portal:this.portal}).then(t=>{var i;const e=[];return this._valueInfoMap={},t!=null&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const n=new Px({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=n,this._isDefaultSymbolDerived=!0);const s=new yR({value:r.name,symbol:n});e.push(s),this._valueInfoMap[oT(r.name)]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)!=null&&i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",KCt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[oT(e.value)]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(o0e);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(oe(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,n)=>{r!==n&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,o0e)}}_watchUniqueValueGroups(){this.removeHandles(a0e);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(oe(()=>({classes:i.classes}),(r,n)=>{r!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(oe(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(n,s)=>{n!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,a0e)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of s)for(const c of l.classes??[]){const{symbol:h,label:p,values:g,description:y}=c;for(const w of g??[]){const{value:b,value2:x,value3:T}=w,M=[b];i&&M.push(x),r&&M.push(T);const $=a?M.join(n||""):M[0]??void 0;t.push(new yR({symbol:h,label:p,value:$,description:y}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!e&&!r||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=s.map(c=>{var T;const{symbol:h,label:p,value:g,description:y}=c,[w,b,x]=o?((T=g==null?void 0:g.toString())==null?void 0:T.split(n||""))||[]:[g];return new iLe({symbol:h,label:p,description:y,values:[new EE({value:w,value2:b,value3:x})]})}),l=[new wX({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:n,arcade:s,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const h=l.createSyntaxTree(this.valueExpression);a=l.createFunction(h),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:n}),o));return this._valueInfoMap[oT(c)]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(this.field2){const n=this.field2,s=this.field3,o=[];e&&o.push(i[e]),n&&o.push(i[n]),s&&o.push(i[s]),r=o.join(this.fieldDelimiter||"")}else e&&(r=i[e]);return this._valueInfoMap[oT(r)]}static fromPortalStyle(t,e){const i=new SA(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",(e==null?void 0:e.portal)||va.getDefault());const r=i.populateFromStyle();return r.catch(n=>{W0().error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",n)}),r}static fromStyleUrl(t,e){const i=new SA(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(n=>{W0().error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),r}};u([f({readOnly:!0})],Yn.prototype,"_cache",null),u([_t({uniqueValue:"unique-value"})],Yn.prototype,"type",void 0),u([f(Uie)],Yn.prototype,"backgroundFillSymbol",void 0),u([f({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Yn.prototype,"field",null),u([$i("field")],Yn.prototype,"castField",null),u([ke("field")],Yn.prototype,"writeField",null),u([f({type:String,value:null,json:{write:!0}})],Yn.prototype,"field2",null),u([f({type:String,value:null,json:{write:!0}})],Yn.prototype,"field3",null),u([f({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],Yn.prototype,"orderByClassesEnabled",void 0),u([f({type:String,value:null,json:{write:!0}})],Yn.prototype,"valueExpression",null),u([f({type:String,json:{write:!0}})],Yn.prototype,"valueExpressionTitle",void 0),u([f({type:zie,json:{write:!0}})],Yn.prototype,"legendOptions",void 0),u([f({type:String,json:{write:!0}})],Yn.prototype,"defaultLabel",void 0),u([f(pJ({...MV},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Yn.prototype,"defaultSymbol",null),u([f({type:String,value:null,json:{write:!0}})],Yn.prototype,"fieldDelimiter",null),u([f({type:va,readOnly:!0})],Yn.prototype,"portal",void 0),u([Pe("portal",["styleName"])],Yn.prototype,"readPortal",null),u([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Yn.prototype,"styleOrigin",void 0),u([Pe("styleOrigin",["styleName","styleUrl"])],Yn.prototype,"readStyleOrigin",null),u([ke("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Yn.prototype,"writeStyleOrigin",null),u([f({type:[wX],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||tMt(e)).map(r=>wX.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Yn.prototype,"uniqueValueGroups",null),u([f({type:[yR],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Yn.prototype,"uniqueValueInfos",null),Yn=SA=u([L(rLe)],Yn);const Gie=Yn,OV={key:"type",base:Zy,typeMap:{heatmap:jie,simple:fM,"unique-value":Gie,"class-breaks":ZPe,"dot-density":kCt,dictionary:NCt,"pie-chart":jCt},errorContext:"renderer"},iMt={key:"type",base:Zy,typeMap:{simple:fM,"unique-value":Gie,"class-breaks":ZPe,heatmap:jie},errorContext:"renderer",validate:rMt};function rMt(t){switch(t.type){case"simple":return nMt(t);case"unique-value":return sMt(t);case"class-breaks":return oMt(t);case"heatmap":return t}}function nMt(t){if(t.symbol)return t;de.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function sMt(t){const e=t.uniqueValueInfos,i=e==null?void 0:e.filter(({symbol:r,label:n},s)=>(r||de.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${s}] ${n}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.uniqueValueInfos=i),t}function oMt(t){const e=t.classBreakInfos,i=e==null?void 0:e.filter(({symbol:r,label:n},s)=>(r||de.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${s}] ${n}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.classBreakInfos=i),t}function rqt(t,e){return T3(t,null,e)}const aMt=IC({types:OV});function T3(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i!=null&&i.messages&&i.messages.push(new Yp("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):aMt(t,e,i):null}const wa=(t=>t)(["operational-layers","basemap","ground"]);var xX;let Gw=xX=class extends we{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new xX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([f({type:String,json:{write:!0}})],Gw.prototype,"expression",void 0),u([f({type:String,json:{write:!0}})],Gw.prototype,"name",void 0),u([f({type:["boolean","date","number","string"],json:{write:!0}})],Gw.prototype,"returnType",void 0),u([f({type:String,json:{write:!0}})],Gw.prototype,"title",void 0),Gw=xX=u([L("esri.form.ExpressionInfo")],Gw);const lMt=Gw;let Hw=class extends we{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([f({type:String,json:{write:!0}})],Hw.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],Hw.prototype,"label",void 0),u([f()],Hw.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],Hw.prototype,"visibilityExpression",void 0),Hw=u([L("esri.form.elements.Element")],Hw);const mx=Hw;let M4=class extends Or(we){constructor(e){super(e),this.type=null}};u([f()],M4.prototype,"type",void 0),M4=u([L("esri.form.elements.inputs.attachments.Input")],M4);const Vv=M4,AV=["any","capture","upload"];let i2=class extends Vv{constructor(e){super(e),this.type="audio",this.inputMethod="any",this.maxDuration=null}};u([f({type:["audio"],readOnly:!0,json:{write:!0}})],i2.prototype,"type",void 0),u([f({type:AV,json:{write:!0}})],i2.prototype,"inputMethod",void 0),u([f({type:Number,json:{write:!0}})],i2.prototype,"maxDuration",void 0),i2=u([L("esri.form.elements.inputs.attachments.AudioInput")],i2);const l0e=i2;let TA=class extends Vv{constructor(e){super(e),this.type="document",this.maxFileSize=null}};u([f({type:["document"],readOnly:!0,json:{write:!0}})],TA.prototype,"type",void 0),u([f({type:Number,json:{write:!0}})],TA.prototype,"maxFileSize",void 0),TA=u([L("esri.form.elements.inputs.attachments.DocumentInput")],TA);const c0e=TA;let r2=class extends Vv{constructor(e){super(e),this.type="image",this.inputMethod="any",this.maxImageSize=null}};u([f({type:["image"],readOnly:!0,json:{write:!0}})],r2.prototype,"type",void 0),u([f({type:AV,json:{write:!0}})],r2.prototype,"inputMethod",void 0),u([f({type:Number,json:{write:!0}})],r2.prototype,"maxImageSize",void 0),r2=u([L("esri.form.elements.inputs.attachments.ImageInput")],r2);const u0e=r2;let EA=class extends Vv{constructor(e){super(e),this.type="signature",this.inputMethod="any"}};u([f({type:["signature"],readOnly:!0,json:{write:!0}})],EA.prototype,"type",void 0),u([f({type:AV,json:{write:!0}})],EA.prototype,"inputMethod",void 0),EA=u([L("esri.form.elements.inputs.attachments.SignatureInput")],EA);const h0e=EA;let n2=class extends Vv{constructor(e){super(e),this.type="video",this.inputMethod="any",this.maxDuration=null}};u([f({type:["video"],readOnly:!0,json:{write:!0}})],n2.prototype,"type",void 0),u([f({type:AV,json:{write:!0}})],n2.prototype,"inputMethod",void 0),u([f({type:Number,json:{write:!0}})],n2.prototype,"maxDuration",void 0),n2=u([L("esri.form.elements.inputs.attachments.VideoInput")],n2);const d0e=n2;function nLe(t){return{nestableTypes:{base:Vv,key:"type",typeMap:{audio:l0e,document:c0e,image:u0e,signature:h0e,video:d0e}},allTypes:{base:Vv,key:"type",typeMap:{attachment:t,audio:l0e,document:c0e,image:u0e,signature:h0e,video:d0e}}}}function cMt(t,e,i){return t?t.map(r=>Bu(e.nestableTypes,r)):null}function uMt(t,e,i){if(!t)return null;const r=e.nestableTypes.typeMap;return t.filter(n=>r[n.type]).map(n=>r[n.type].fromJSON(n))}function hMt(t,e,i){if(!t)return null;const r=e.nestableTypes.typeMap;return t.filter(n=>r[n.type]).map(n=>n.toJSON())}let Jf=class extends Vv{constructor(e){super(e),this.type="attachment",this.attachmentAssociationType="exact",this.inputTypes=null}castInputs(e){return cMt(e,rH)}readInputs(e,i){return uMt(i.inputTypes,rH)}writeInputs(e,i){i.inputTypes=hMt(e,rH)}};u([f({type:["attachment"],readOnly:!0,json:{write:!0}})],Jf.prototype,"type",void 0),u([f({type:["any","exact","exactOrNone"],json:{write:!0}})],Jf.prototype,"attachmentAssociationType",void 0),u([f({json:{write:{isRequired:!0}}})],Jf.prototype,"inputTypes",void 0),u([$i("inputTypes")],Jf.prototype,"castInputs",null),u([Pe("inputTypes")],Jf.prototype,"readInputs",null),u([ke("inputTypes")],Jf.prototype,"writeInputs",null),Jf=u([L("esri.form.elements.inputs.attachments.AttachmentInput")],Jf);const rH=nLe(Jf),dMt=Jf;var SX;const pMt=nLe(dMt);let _u=SX=class extends mx{constructor(t){super(t),this.allowUserRename=!0,this.attachmentKeyword=null,this.displayFilename=!1,this.editableExpression=null,this.filenameExpression="{attachmentKeyword}_{now}",this.input=null,this.maxAttachmentCount=null,this.minAttachmentCount=null,this.type="attachment",this.useOriginalFilename=!0}clone(){var t;return new SX({allowUserRename:this.allowUserRename,attachmentKeyword:this.attachmentKeyword,description:this.description,displayFilename:this.displayFilename,editableExpression:this.editableExpression,filenameExpression:this.filenameExpression,input:(t=this.input)==null?void 0:t.clone(),label:this.label,maxAttachmentCount:this.maxAttachmentCount,minAttachmentCount:this.minAttachmentCount,useOriginalFilename:this.useOriginalFilename,visibilityExpression:this.visibilityExpression})}};u([f({type:Boolean,json:{write:!0}})],_u.prototype,"allowUserRename",void 0),u([f({type:String,json:{write:{isRequired:!0}}})],_u.prototype,"attachmentKeyword",void 0),u([f({type:Boolean,json:{write:!0}})],_u.prototype,"displayFilename",void 0),u([f({type:String,json:{write:!0}})],_u.prototype,"editableExpression",void 0),u([f({type:String,json:{write:!0}})],_u.prototype,"filenameExpression",void 0),u([f({types:pMt.allTypes,json:{read:{source:"inputType"},write:{target:"inputType",isRequired:!0}}})],_u.prototype,"input",void 0),u([f({type:Number,json:{write:!0}})],_u.prototype,"maxAttachmentCount",void 0),u([f({type:Number,json:{write:!0}})],_u.prototype,"minAttachmentCount",void 0),u([f({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],_u.prototype,"type",void 0),u([f({type:Boolean,json:{write:!0}})],_u.prototype,"useOriginalFilename",void 0),_u=SX=u([L("esri.form.elements.AttachmentElement")],_u);const p0e=_u;let $4=class extends we{constructor(e){super(e),this.type=null}};u([f()],$4.prototype,"type",void 0),$4=u([L("esri.form.elements.inputs.Input")],$4);const Yy=$4;let CA=class extends Yy{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([f({type:Number,json:{write:!0}})],CA.prototype,"maxLength",void 0),u([f({type:Number,json:{write:!0}})],CA.prototype,"minLength",void 0),CA=u([L("esri.form.elements.inputs.TextInput")],CA);const Hie=CA;var TX;let O4=TX=class extends Hie{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new TX({maxLength:this.maxLength,minLength:this.minLength})}};u([f({type:["barcode-scanner"],json:{read:!1,write:!0}})],O4.prototype,"type",void 0),O4=TX=u([L("esri.form.elements.inputs.BarcodeScannerInput")],O4);const fMt=O4;var EX;let s2=EX=class extends Yy{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new EX({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([f({type:String,json:{write:!0}})],s2.prototype,"noValueOptionLabel",void 0),u([f({type:Boolean,json:{write:!0}})],s2.prototype,"showNoValueOption",void 0),u([f({type:["combo-box"],json:{read:!1,write:!0}})],s2.prototype,"type",void 0),s2=EX=u([L("esri.form.elements.inputs.ComboBoxInput")],s2);const mMt=s2;var CX;function f0e(t){return t??null}function m0e(t){return t??null}let Wf=CX=class extends Yy{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return f0e(e.max)}writeMax(t,e){e.max=m0e(t)}readMin(t,e){return f0e(e.min)}writeMin(t,e){e.min=m0e(t)}clone(){return new CX({max:this.max,min:this.min})}};u([f({type:String,json:{type:String,write:!0}})],Wf.prototype,"max",void 0),u([Pe("max")],Wf.prototype,"readMax",null),u([ke("max")],Wf.prototype,"writeMax",null),u([f({type:String,json:{type:String,write:!0}})],Wf.prototype,"min",void 0),u([Pe("min")],Wf.prototype,"readMin",null),u([ke("min")],Wf.prototype,"writeMin",null),u([f({type:["date-picker"],json:{read:!1,write:!0}})],Wf.prototype,"type",void 0),Wf=CX=u([L("esri.form.elements.inputs.DatePickerInput")],Wf);const gMt=Wf;var MX;function nH(t){return t??null}function sH(t){return t??null}let xc=MX=class extends Yy{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return nH(e.max)}writeMax(t,e){e.max=sH(t)}readMin(t,e){return nH(e.min)}writeMin(t,e){e.min=sH(t)}readTimeResolution(t,e){return nH(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=sH(t)}clone(){return new MX({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};u([f({type:Boolean,json:{write:!0}})],xc.prototype,"includeTimeOffset",void 0),u([f({type:String,json:{type:String,write:!0}})],xc.prototype,"max",void 0),u([Pe("max")],xc.prototype,"readMax",null),u([ke("max")],xc.prototype,"writeMax",null),u([f({type:String,json:{type:String,write:!0}})],xc.prototype,"min",void 0),u([Pe("min")],xc.prototype,"readMin",null),u([ke("min")],xc.prototype,"writeMin",null),u([f({type:String,json:{type:String,write:!0}})],xc.prototype,"timeResolution",void 0),u([Pe("timeResolution")],xc.prototype,"readTimeResolution",null),u([ke("timeResolution")],xc.prototype,"writeTimeResolution",null),u([f({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],xc.prototype,"type",void 0),xc=MX=u([L("esri.form.elements.inputs.DateTimeOffsetPickerInput")],xc);const yMt=xc;var $X;function g0e(t){return t!=null?new Date(t):null}function y0e(t){return t?t.getTime():null}let up=$X=class extends Yy{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return g0e(e.max)}writeMax(t,e){e.max=y0e(t)}readMin(t,e){return g0e(e.min)}writeMin(t,e){e.min=y0e(t)}clone(){return new $X({includeTime:this.includeTime,max:this.max,min:this.min})}};u([f({type:Boolean,json:{write:!0}})],up.prototype,"includeTime",void 0),u([f({type:Date,json:{type:Number,write:!0}})],up.prototype,"max",void 0),u([Pe("max")],up.prototype,"readMax",null),u([ke("max")],up.prototype,"writeMax",null),u([f({type:Date,json:{type:Number,write:!0}})],up.prototype,"min",void 0),u([Pe("min")],up.prototype,"readMin",null),u([ke("min")],up.prototype,"writeMin",null),u([f({type:["datetime-picker"],json:{read:!1,write:!0}})],up.prototype,"type",void 0),up=$X=u([L("esri.form.elements.inputs.DateTimePickerInput")],up);const _Mt=up;var OX;let o2=OX=class extends Yy{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new OX({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([f({type:String,json:{write:!0}})],o2.prototype,"noValueOptionLabel",void 0),u([f({type:Boolean,json:{write:!0}})],o2.prototype,"showNoValueOption",void 0),u([f({type:["radio-buttons"],json:{read:!1,write:!0}})],o2.prototype,"type",void 0),o2=OX=u([L("esri.form.elements.inputs.RadioButtonsInput")],o2);const vMt=o2;var AX;let a2=AX=class extends Yy{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new AX({offValue:this.offValue,onValue:this.onValue})}};u([f({type:[String,Number],json:{write:!0}})],a2.prototype,"offValue",void 0),u([f({type:[String,Number],json:{write:!0}})],a2.prototype,"onValue",void 0),u([f({type:["switch"],json:{read:!1,write:!0}})],a2.prototype,"type",void 0),a2=AX=u([L("esri.form.elements.inputs.SwitchInput")],a2);const wMt=a2;var RX;let A4=RX=class extends Hie{constructor(t){super(t),this.type="text-area"}clone(){return new RX({maxLength:this.maxLength,minLength:this.minLength})}};u([f({type:["text-area"],json:{read:!1,write:!0}})],A4.prototype,"type",void 0),A4=RX=u([L("esri.form.elements.inputs.TextAreaInput")],A4);const bMt=A4;var IX;let R4=IX=class extends Hie{constructor(t){super(t),this.type="text-box"}clone(){return new IX({maxLength:this.maxLength,minLength:this.minLength})}};u([f({type:["text-box"],json:{read:!1,write:!0}})],R4.prototype,"type",void 0),R4=IX=u([L("esri.form.elements.inputs.TextBoxInput")],R4);const xMt=R4;var PX;function oH(t){return t??null}function aH(t){return t??null}let vu=PX=class extends Yy{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return oH(e.max)}writeMax(t,e){e.max=aH(t)}readMin(t,e){return oH(e.min)}writeMin(t,e){e.min=aH(t)}readTimeResolution(t,e){return oH(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=aH(t)}clone(){return new PX({max:this.max,min:this.min,timeResolution:this.timeResolution})}};u([f({type:String,json:{type:String,write:!0}})],vu.prototype,"max",void 0),u([Pe("max")],vu.prototype,"readMax",null),u([ke("max")],vu.prototype,"writeMax",null),u([f({type:String,json:{type:String,write:!0}})],vu.prototype,"min",void 0),u([Pe("min")],vu.prototype,"readMin",null),u([ke("min")],vu.prototype,"writeMin",null),u([f({type:String,json:{type:String,write:!0}})],vu.prototype,"timeResolution",void 0),u([Pe("timeResolution")],vu.prototype,"readTimeResolution",null),u([ke("timeResolution")],vu.prototype,"writeTimeResolution",null),u([f({type:["time-picker"],json:{read:!1,write:!0}})],vu.prototype,"type",void 0),vu=PX=u([L("esri.form.elements.inputs.TimePickerInput")],vu);const SMt=vu,TMt={base:Yy,key:"type",typeMap:{"barcode-scanner":fMt,"combo-box":mMt,"date-picker":gMt,"datetime-picker":_Mt,"datetimeoffset-picker":yMt,"radio-buttons":vMt,switch:wMt,"text-area":bMt,"text-box":xMt,"time-picker":SMt}};var LX;let Mh=LX=class extends mx{constructor(t){super(t),this.domain=null,this.editable=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new LX({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([f({types:IEe,json:{read:{reader:Cz},write:!0}})],Mh.prototype,"domain",void 0),u([f({type:Boolean,json:{write:!0}})],Mh.prototype,"editable",void 0),u([f({type:String,json:{write:!0}})],Mh.prototype,"editableExpression",void 0),u([f({type:String,json:{write:!0}})],Mh.prototype,"fieldName",void 0),u([f({type:String,json:{write:!0}})],Mh.prototype,"hint",void 0),u([f({types:TMt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Mh.prototype,"input",void 0),u([f({type:String,json:{write:!0}})],Mh.prototype,"requiredExpression",void 0),u([f({type:String,json:{read:!1,write:!0}})],Mh.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],Mh.prototype,"valueExpression",void 0),Mh=LX=u([L("esri.form.elements.FieldElement")],Mh);const _0e=Mh;var DX;let Ng=DX=class extends mx{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new DX({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:te(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([f({type:Number,json:{write:!0}})],Ng.prototype,"displayCount",void 0),u([f({type:["list"],json:{write:!0}})],Ng.prototype,"displayType",void 0),u([f({type:String,json:{write:!0}})],Ng.prototype,"editableExpression",void 0),u([f({type:[$K],json:{write:!0}})],Ng.prototype,"orderByFields",void 0),u([f({type:Number,json:{write:!0}})],Ng.prototype,"relationshipId",void 0),u([f({type:["relationship"],json:{read:!1,write:!0}})],Ng.prototype,"type",void 0),Ng=DX=u([L("esri.form.elements.RelationshipElement")],Ng);const v0e=Ng;var NX;let l2=NX=class extends mx{constructor(t){super(t),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new NX({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};u([f({type:String,json:{write:!0}})],l2.prototype,"text",void 0),u([f({type:String,json:{write:!0}})],l2.prototype,"textFormat",void 0),u([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],l2.prototype,"type",void 0),l2=NX=u([L("esri.form.elements.TextElement")],l2);const w0e=l2;function sLe(t){return{typesWithGroup:{base:mx,key:"type",typeMap:{attachment:p0e,field:_0e,group:t,relationship:v0e,text:w0e}},typesWithoutGroup:{base:mx,key:"type",typeMap:{attachment:p0e,field:_0e,relationship:v0e,text:w0e}}}}function oLe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>r[n.type]).map(n=>r[n.type].fromJSON(n))}function aLe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>r[n.type]).map(n=>n.toJSON())}function lLe(t,e,i=!0){return t?t.map(r=>Bu(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var FX;let Qf=FX=class extends mx{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return lLe(t,lH,!1)}readElements(t,e){return oLe(e.formElements,lH,!1)}writeElements(t,e){e.formElements=aLe(t,lH,!1)}clone(){return new FX({description:this.description,elements:te(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([f({json:{write:!0}})],Qf.prototype,"elements",void 0),u([$i("elements")],Qf.prototype,"castElements",null),u([Pe("elements",["formElements"])],Qf.prototype,"readElements",null),u([ke("elements")],Qf.prototype,"writeElements",null),u([f({type:["collapsed","expanded"],json:{write:!0}})],Qf.prototype,"initialState",void 0),u([f({type:String,json:{read:!1,write:!0}})],Qf.prototype,"type",void 0),Qf=FX=u([L("esri.form.elements.GroupElement")],Qf);const lH=sLe(Qf),EMt=Qf,CMt=t=>t.type==="field",MMt=t=>t.type==="group",$Mt=t=>t.type==="text";var kX;const cH=sLe(EMt);let hp=kX=class extends we{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return lLe(t,cH)}readElements(t,e){return oLe(e.formElements,cH)}writeElements(t,e){e.formElements=aLe(t,cH)}clone(){return new kX({description:this.description,expressionInfos:te(this.expressionInfos),elements:te(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(t,e){const i=new Set,{description:r,elements:n,expressionInfos:s,title:o}=this;if(_R(i,t,r),_R(i,t,o),!n)return[];const a=OMt(n,s).map(l=>Sl(i,t,l));await Promise.all(a);for(const l of n)cLe(i,{fieldsIndex:t,relationships:e},l);return Array.from(i).sort()}};function cLe(t,e,i){var n;const{fieldsIndex:r}=e;if(!r||r.fields.length!==t.size)switch(_R(t,r,i.label),_R(t,r,i.description),i.type){case"field":Jl(t,r,i.fieldName);break;case"group":i.elements.forEach(s=>cLe(t,e,s));break;case"relationship":if(e.relationships){const s=e.relationships.find(o=>o.id===i.relationshipId);s&&Jl(t,r,s.keyField)}tx(t,r,(n=i.orderByFields)==null?void 0:n.map(s=>s.field));break;case"text":_R(t,r,i.text)}}function OMt(t,e){if(!e||e.length===0)return[];const i=uLe(t),r=[];for(const n of e)i.has(n.name)&&r.push(n.expression);return r}function uLe(t){const e=new Set;for(const i of t)if(Qse(e,i.visibilityExpression),!$Mt(i)){if(MMt(i))xR(e,uLe(i.elements));else if(Qse(e,i.editableExpression),CMt(i)){const{requiredExpression:r,valueExpression:n}=i;xR(e,[r,n])}}return e}function _R(t,e,i){tx(t,e,F2e(i))}u([f({type:String,json:{write:!0}})],hp.prototype,"description",void 0),u([f({json:{write:!0}})],hp.prototype,"elements",void 0),u([$i("elements")],hp.prototype,"castElements",null),u([Pe("elements",["formElements"])],hp.prototype,"readElements",null),u([ke("elements")],hp.prototype,"writeElements",null),u([f({type:[lMt],json:{write:!0}})],hp.prototype,"expressionInfos",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],hp.prototype,"preserveFieldValuesWhenHidden",void 0),u([f({type:String,json:{write:!0}})],hp.prototype,"title",void 0),hp=kX=u([L("esri.form.FormTemplate")],hp);const AMt=hp;function b0e(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const n of r)n.length>2&&(n[2]*=i)}function RMt(t,e,i){if(!t&&!e||!i)return;const r=AR(i);x0e(t,i,r),x0e(e,i,r)}function x0e(t,e,i){if(t)for(const r of t)IMt(r.geometry,e,i)}function IMt(t,e,i){if(!(t!=null&&t.spatialReference)||xs(t.spatialReference,e))return;const r=AR(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)b0e(t,t.rings,r);else if("paths"in t)b0e(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const n of t.points)n.length>2&&(n[2]*=r)}}function S0e(t,e,i){if(!(i!=null&&i.features)||!i.hasZ)return;const r=qbe(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const n of i.features)r(n.geometry)}var UX;const zX=new sr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let ra=UX=class extends we{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var n;const i=nt.fromJSON(e.spatialReference),r=[];for(let s=0;s<t.length;s++){const o=t[s],a=qc.fromJSON(o),l=(n=o.geometry)==null?void 0:n.spatialReference;a.geometry==null||l||(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&h!=null)for(const p in h){const g=h[p],y=c[p],w=y==null?void 0:y.spatialReference;g==null||w||(g.spatialReference=i)}r.push(a)}return r}writeGeometryType(t,e,i,r){if(t)return void zX.write(t,e,i,r);const{features:n}=this;if(n){for(const s of n)if((s==null?void 0:s.geometry)!=null)return void zX.write(s.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=Sv(t);return r&&!i&&e.spatialReference&&(r.spatialReference=nt.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new UX(this.cloneProperties())}cloneProperties(){return te({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const n=t==null?void 0:t[i];r.geometry=(n==null?void 0:n.toJSON())||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,n]}=t,s=c=>Math.round((c-r)/e),o=c=>Math.round((n-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,s,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){var g,y;const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,n],scale:[s,o]}=i,a=w=>w*s+r,l=w=>n-w*o;let c=null,h=null;if(this.hasZ&&((g=i==null?void 0:i.scale)==null?void 0:g[2])!=null){const{translate:[,,w],scale:[,,b]}=i;c=x=>x*b+w}if(this.hasM&&((y=i==null?void 0:i.scale)==null?void 0:y[3])!=null){const{translate:[,,,w],scale:[,,,b]}=i;h=x=>x==null?x:x*b+w}const p=this._getHydrationFunction(t,a,l,c,h);for(const{geometry:w}of e)w!=null&&p&&p(w);return this.transform=null,this}_quantizePoints(t,e,i){let r,n;const s=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=i(l[1]);c===r&&h===n||(s.push([c-r,h-n]),r=c,n=h)}else r=e(l[0]),n=i(l[1]),s.push([r,n])}return s.length>0?s:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const n=bb(r)?r.rings:r.paths,s=[];for(let o=0,a=n.length;o<a;o++){const l=n[o],c=this._quantizePoints(l,e,i);c&&s.push(c)}return s.length>0?(bb(r)?r.rings=s:r.paths=s,r):null}:t==="multipoint"?r=>{const n=this._quantizePoints(r.points,e,i);return n&&n.length>0?(r.points=n,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,n){return t==="point"?s=>{s.x=e(s.x),s.y=i(s.y),r&&(s.z=r(s.z))}:t==="polyline"||t==="polygon"?s=>{const o=bb(s)?s.rings:s.paths;let a,l;for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let g=0,y=p.length;g<y;g++){const w=p[g];g>0?(a+=w[0],l+=w[1]):(a=w[0],l=w[1]),w[0]=e(a),w[1]=i(l)}}if(r&&n)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let g=0,y=p.length;g<y;g++){const w=p[g];w[2]=r(w[2]),w[3]=n(w[3])}}else if(r)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let g=0,y=p.length;g<y;g++){const w=p[g];w[2]=r(w[2])}}else if(n)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let g=0,y=p.length;g<y;g++){const w=p[g];w[2]=n(w[2])}}}:t==="extent"?s=>{s.xmin=e(s.xmin),s.ymin=i(s.ymin),s.xmax=e(s.xmax),s.ymax=i(s.ymax),r&&s.zmax!=null&&s.zmin!=null&&(s.zmax=r(s.zmax),s.zmin=r(s.zmin)),n&&s.mmax!=null&&s.mmin!=null&&(s.mmax=n(s.mmax),s.mmin=n(s.mmin))}:t==="multipoint"?s=>{const o=s.points;let a,l;for(let c=0,h=o.length;c<h;c++){const p=o[c];c>0?(a+=p[0],l+=p[1]):(a=p[0],l=p[1]),p[0]=e(a),p[1]=i(l)}if(r&&n)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=r(p[2]),p[3]=n(p[3])}else if(r)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=r(p[2])}else if(n)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=n(p[2])}}:null}};u([f({type:String,json:{write:!0}})],ra.prototype,"displayFieldName",void 0),u([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ra.prototype,"exceededTransferLimit",void 0),u([f({type:[qc],json:{write:!0}})],ra.prototype,"features",void 0),u([Pe("features")],ra.prototype,"readFeatures",null),u([f({type:[Mz],json:{write:!0}})],ra.prototype,"fields",void 0),u([f({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:zX.read}}})],ra.prototype,"geometryType",void 0),u([ke("geometryType")],ra.prototype,"writeGeometryType",null),u([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ra.prototype,"hasM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ra.prototype,"hasZ",void 0),u([f({types:UC,json:{write:!0}})],ra.prototype,"queryGeometry",void 0),u([Pe("queryGeometry")],ra.prototype,"readQueryGeometry",null),u([f({type:nt,json:{write:!0}})],ra.prototype,"spatialReference",void 0),u([ke("spatialReference")],ra.prototype,"writeSpatialReference",null),u([f({json:{write:!0}})],ra.prototype,"transform",void 0),ra=UX=u([L("esri.rest.support.FeatureSet")],ra),ra.prototype.toJSON.isDefaultToJSON=!0;const hLe=ra;let PMt=0,qg=class extends wm.LoadableMixin(D3(ot)){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var i;const e=(i=this.layer)==null?void 0:i.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);S0e(e,this.layer.spatialReference,r);const n=hLe.fromJSON(r);if(!this._requiresClientGraphicMapping())return n;const s=this.layer.objectIdField;for(const o of n.features){const a=o.attributes[s],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return n.geometryType=this.layer.geometryType,n}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new Y("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return S0e(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:pr.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new Y("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const n=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[i]!=null?h.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const p=o(h);p!=null&&n.push(p)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(s.push(this._serializeFeature(h)),a){const p=o(h);p!=null&&a.set(p,h)}}RMt(r?r.features:null,s,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:s,deletes:n});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:n}of e)n==null||n.type!=="mesh"||n.hasExtent||n.loaded||r.push(n.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const n=e.get(r.objectId);n!=null&&this._addIdToClientGraphic(n)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new Y("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let n=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);n||a.geometry==null||(n=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const s=this;return{features:r,inferredGeometryType:n,finish(o){const a=s.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=i.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,s._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){var n;if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=(n=e.attributes)==null?void 0:n[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,i;return((e=this.layer)==null?void 0:e.geometryType)??((i=this.sourceJSON)==null?void 0:i.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),n=(PMt++).toString();return r?{uid:n,geometry:r.toJSON(),attributes:i}:{uid:n,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?Qp.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await j8e("MemorySourceWorker",{strategy:pe("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:n,hasM:s,hasZ:o,timeInfo:a,dateFieldsTimeZone:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const h=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",w=>{de.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),w.preventDefault()}));const p={features:h.features,fields:i==null?void 0:i.map(w=>w.toJSON()),geometryType:Joe.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:n,spatialReference:c?null:r&&r.toJSON(),timeInfo:(a==null?void 0:a.toJSON())??null,dateFieldsTimeZone:l},g=await this._connection.invoke("load",p,{signal:e});for(const w of g.warnings)de.getLogger(this.layer).warn("#load()",`${w.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:w});g.featureErrors.length&&de.getLogger(this.layer).warn("#load()",`Encountered ${g.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:g.featureErrors});const y=g.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(h.inferredGeometryType)&&(y.geometryType=Joe.toJSON(h.inferredGeometryType)),this.sourceJSON=y,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),h.finish(g.assignedObjectIds)}};u([AJ({Type:qc,ensureType:is(qc)})],qg.prototype,"itemType",void 0),u([f()],qg.prototype,"type",void 0),u([f({constructOnly:!0})],qg.prototype,"layer",void 0),u([f({readOnly:!0})],qg.prototype,"_workerGeometryType",null),u([f()],qg.prototype,"sourceJSON",void 0),qg=u([L("esri.layers.graphics.sources.MemorySource")],qg);function LMt(t){return"portalItem"in t}const DMt=t=>{let e=class extends t{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):LMt(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([f({type:String})],e.prototype,"apiKey",null),e=u([L("esri.layers.mixins.APIKeyMixin")],e),e},NMt=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=qC(this.url);if(i!=null&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",Cje(i,de.getLogger(this)))}};return u([f()],e.prototype,"title",null),u([f({type:String})],e.prototype,"url",null),e=u([L("esri.layers.mixins.ArcGISService")],e),e},FMt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([f({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([L("esri.layers.mixins.CustomParametersMixin")],e),e},kMt=Yje(),dLe=new Map,pLe=new Map;async function mqt(t,e,i){if(!t||!i)return!1;if(!e)return!0;const r=new URL(t).host;let n=dLe.get(r);if(!n){const s=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");n=(await Br(s,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return n===e}async function gqt(t,e,i=!1){var s,o,a;if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=(s=pLe.get(r))==null?void 0:s.entries();if(n){for(const[l,c]of n)if(c.name===e){const h=!((o=c.stack)!=null&&o.hasForwardEdits());if(!h&&i){const[{deleteForwardEdits:p},{default:g}]=await Promise.all([fe(()=>import("./deleteForwardEdits-DTomY2f-.js"),[]),fe(()=>import("./DeleteForwardEditsParameters-QF3n-GzE.js"),[])]),y=await p(r,l,new g({sessionId:kMt,moment:c.moment}));return y.success&&((a=c.stack)==null||a.clearForwardEdits()),y.success}return h}}return!0}function UMt(t,e){var n;if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=(n=pLe.get(i))==null?void 0:n.entries();if(r){for(const[s,o]of r)if(o.name===e)return o.lockType==="edit"}return!1}const qie=new ns.EventEmitter;function zMt(t){return qie.on("apply-edits",new WeakRef(t))}function VMt(t){return qie.on("update-moment",new WeakRef(t))}function yqt(t,e,i=null,r=!1){const n=Ho();return r=e==null||r,qie.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:n.promise}),n}const fLe=Symbol();function _qt(t){return t!=null&&typeof t=="object"&&fLe in t}function J$(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function uH(t,e,i){const r=new URL(t).host,n=dLe.get(r),s=o=>!o||o===n;return s(e)&&s(i)||e===i}const BMt=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this._applyEditsHandler=n=>{const{serviceUrl:s,layerId:o,gdbVersion:a,mayReceiveServiceEdits:l,result:c}=n,h=s===this.url,p=o!=null&&this.layerId!=null&&o===this.layerId,g=J$(this),y=J$(this)&&uH(s,a,this.gdbVersion);if(!h||g&&!y||!p&&!l)return;const w=c.then(b=>{var M;if(this.lastEditsEventDate=new Date,p&&(b.addedFeatures.length||b.updatedFeatures.length||b.deletedFeatures.length||b.addedAttachments.length||b.updatedAttachments.length||b.deletedAttachments.length))return this.emit("edits",te(b)),b;const x=(M=b.editedFeatures)==null?void 0:M.find(({layerId:$})=>$===this.layerId);if(x){const{adds:$,updates:R,deletes:I}=x.editedFeatures,P={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:$?$.map(({attributes:N})=>({objectId:this.objectIdField&&N[this.objectIdField],globalId:this.globalIdField&&N[this.globalIdField]})):[],deletedFeatures:I?I.map(({attributes:N})=>({objectId:this.objectIdField&&N[this.objectIdField],globalId:this.globalIdField&&N[this.globalIdField]})):[],updatedFeatures:R?R.map(({current:{attributes:N}})=>({objectId:this.objectIdField&&N[this.objectIdField],globalId:this.globalIdField&&N[this.globalIdField]})):[],editedFeatures:te(b.editedFeatures),exceededTransferLimit:!1,historicMoment:te(b.historicMoment)};return this.emit("edits",P),P}const T={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:te(b.editedFeatures),exceededTransferLimit:!1,historicMoment:te(b.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(s,a,T.historicMoment)&&this.emit("edits",T),T}).then(b=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(s,a,b.historicMoment)&&(this.historicMoment=b.historicMoment),b));this.emit("apply-edits",{result:w})},this._updateMomentHandler=n=>{const{serviceUrl:s,gdbVersion:o,moment:a}=n,l=s===this.url,c=J$(this),h=J$(this)&&uH(s,o,this.gdbVersion),p=J$(this)&&!uH(s,this.gdbVersion,null);l&&c&&h&&p&&"historicMoment"in this&&this.historicMoment!==a&&(this.historicMoment=a)},this.when().then(()=>{this.addHandles(zMt(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(VMt(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(r,n,s){return"historicMoment"in this&&this.historicMoment!==s&&UMt(r,n)}};return e=fLe,u([f()],i.prototype,"lastEditsEventDate",void 0),i=u([L("esri.layers.mixins.EditBusLayer")],i),i};var VX;const hH=new sr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),dH=new sr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Zf=VX=class extends we{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new Ty({geometry:te(i),objectIds:te(s),spatialRelationship:r,timeExtent:te(n),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:n,units:s,distance:o}=this;return new VX({geometry:te(e),objectIds:te(n),spatialRelationship:i,timeExtent:te(r),where:t,units:s,distance:o})}};u([f({type:String,json:{write:!0}})],Zf.prototype,"where",void 0),u([f({types:UC,json:{write:!0}})],Zf.prototype,"geometry",void 0),u([f({type:hH.apiValues,json:{name:"spatialRel",read:{reader:hH.read},write:{allowNull:!1,writer:hH.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],Zf.prototype,"spatialRelationship",void 0),u([f({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Zf.prototype,"distance",void 0),u([f({type:[Number],json:{write:!0}})],Zf.prototype,"objectIds",void 0),u([f({type:dH.apiValues,json:{read:dH.read,write:{writer:dH.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Zf.prototype,"units",void 0),u([f({type:ja,json:{write:!0}})],Zf.prototype,"timeExtent",void 0),Zf=VX=u([L("esri.layers.support.FeatureFilter")],Zf);const jMt=Zf;var BX;const T0e={read:{reader:b3},write:{writer:x3,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},E0e={read:{reader:b3},write:{writer:x3,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},C0e={name:"showExcludedLabels",default:!0};let qw=BX=class extends we{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var r,n;const i=super.write(t,e);if(e!=null&&e.origin){if(i.filter){const s=Object.keys(i.filter);if(s.length>1||s[0]!=="where")return(r=e.messages)==null||r.push(new Y("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return(n=e.messages)==null||n.push(new Y("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new BX({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([f({type:jMt,json:{write:{allowNull:!0,writer(t,e,i,r){const n=t==null?void 0:t.write({},r);n&&Object.keys(n).length!==0?Uo(i,n,e):Uo(i,null,e)}}}})],qw.prototype,"filter",void 0),u([f({json:{read:b3,write:{writer:x3,allowNull:!0},origins:{"web-map":T0e,"portal-item":T0e}}})],qw.prototype,"includedEffect",void 0),u([f({json:{read:b3,write:{writer:x3,allowNull:!0},origins:{"web-map":E0e,"portal-item":E0e}}})],qw.prototype,"excludedEffect",void 0),u([f({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":C0e,"portal-item":C0e}}})],qw.prototype,"excludedLabelsVisible",void 0),qw=BX=u([L("esri.layers.support.FeatureEffect")],qw);const GMt=qw,M0e={write:{allowNull:!0}},HMt={type:GMt,json:{origins:{"web-map":M0e,"portal-item":M0e}}},qMt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([f(HMt)],e.prototype,"featureEffect",void 0),e=u([L("esri.layers.mixins.FeatureEffectLayer")],e),e};let c2=class extends we{constructor(e){super(e),this.description=null,this.label=null,this.type=null}};u([f({type:String,json:{write:!0}})],c2.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],c2.prototype,"label",void 0),u([f()],c2.prototype,"type",void 0),c2=u([L("esri.tables.elements.AttributeTableElement")],c2);const $C=c2;var jX;let MA=jX=class extends $C{constructor(t){super(t),this.displayType="auto",this.type="attachment"}clone(){return new jX({description:this.description,displayType:this.displayType,label:this.label})}};u([f({type:["auto"],json:{write:!0}})],MA.prototype,"displayType",void 0),u([f({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],MA.prototype,"type",void 0),MA=jX=u([L("esri.tables.elements.AttributeTableAttachmentElement")],MA);const $0e=MA;var GX;let $A=GX=class extends $C{constructor(t){super(t),this.fieldName=null,this.type="field"}clone(){return new GX({description:this.description,fieldName:this.fieldName,label:this.label})}};u([f({type:String,json:{write:!0}})],$A.prototype,"fieldName",void 0),u([f({type:String,json:{read:!1,write:!0}})],$A.prototype,"type",void 0),$A=GX=u([L("esri.tables.elements.AttributeTableFieldElement")],$A);const O0e=$A;var HX;let OA=HX=class extends $C{constructor(t){super(t),this.relationshipId=null,this.type="relationship"}clone(){return new HX({description:this.description,label:this.label,relationshipId:this.relationshipId})}};u([f({type:Number,json:{write:!0}})],OA.prototype,"relationshipId",void 0),u([f({type:["relationship"],json:{read:!1,write:!0}})],OA.prototype,"type",void 0),OA=HX=u([L("esri.tables.elements.AttributeTableRelationshipElement")],OA);const A0e=OA;function mLe(t){return{typesWithGroup:{base:$C,key:"type",typeMap:{attachment:$0e,field:O0e,group:t,relationship:A0e}},typesWithoutGroup:{base:$C,key:"type",typeMap:{attachment:$0e,field:O0e,relationship:A0e}}}}function gLe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>r[n.type]).map(n=>r[n.type].fromJSON(n))}function yLe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>r[n.type]).map(n=>n.toJSON())}function _Le(t,e,i=!0){return t?t.map(r=>Bu(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var qX;let Wg=qX=class extends $C{constructor(t){super(t),this.elements=null,this.type="group"}castElements(t){return _Le(t,pH,!1)}readElements(t,e){return gLe(e.attributeTableElements,pH,!1)}writeElements(t,e){e.attributeTableElements=yLe(t,pH,!1)}clone(){return new qX({description:this.description,elements:te(this.elements),label:this.label})}};u([f({json:{write:!0}})],Wg.prototype,"elements",void 0),u([$i("elements")],Wg.prototype,"castElements",null),u([Pe("elements",["attributeTableElements"])],Wg.prototype,"readElements",null),u([ke("elements")],Wg.prototype,"writeElements",null),u([f({type:String,json:{read:!1,write:!0}})],Wg.prototype,"type",void 0),Wg=qX=u([L("esri.tables.elements.AttributeTableGroupElement")],Wg);const pH=mLe(Wg),WMt=Wg;var WX;const fH=mLe(WMt);let E_=WX=class extends we{constructor(t){super(t),this.elements=null,this.orderByFields=null}castElements(t){return _Le(t,fH)}readElements(t,e){return gLe(e.attributeTableElements,fH)}writeElements(t,e){e.attributeTableElements=yLe(t,fH)}clone(){return new WX({elements:te(this.elements),orderByFields:this.orderByFields})}};u([f({json:{write:!0}})],E_.prototype,"elements",void 0),u([$i("elements")],E_.prototype,"castElements",null),u([Pe("elements",["attributeTableElements"])],E_.prototype,"readElements",null),u([ke("elements")],E_.prototype,"writeElements",null),u([f({type:[Object],json:{write:!0}})],E_.prototype,"orderByFields",void 0),E_=WX=u([L("esri.tables.AttributeTableTemplate")],E_);const ZMt=E_,YMt={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:wa}}},Wie={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},Zie={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:wa}}},XMt={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Hb}}},JMt={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:wa}}},QMt={value:null,type:APe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:wa}}};function wqt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const vLe={write:{enabled:!0,layerContainerTypes:wa},read:!0},ZX={type:Number,json:{origins:{"web-document":vLe,"portal-item":{write:!0}}}},KMt={...ZX,json:{...ZX.json,origins:{"web-document":{...vLe,write:{enabled:!0,layerContainerTypes:wa,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>{var r;return i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?(r=e.layerDefinition)!=null&&r.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?FE(e.layerDefinition.drawingInfo.transparency):void 0:FE(e.drawingInfo.transparency)}}}},bqt={type:pr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=pr.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=nt.fromJSON(e.spatialReference)),i}}}},read:!1}},e$t={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},t$t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:wa}}},name:"layerDefinition.minScale",write:!0}},i$t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:wa}}},name:"layerDefinition.maxScale",write:!0}},wLe={json:{write:{ignoreOrigin:!0,layerContainerTypes:wa},origins:{"web-map":{read:!1,write:!1}}}},r$t={type:ZMt,json:{name:"attributeTableInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}};let Fg=class extends Or(we){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};u([f()],Fg.prototype,"creatorField",void 0),u([f()],Fg.prototype,"creationDateField",void 0),u([f()],Fg.prototype,"editorField",void 0),u([f()],Fg.prototype,"editDateField",void 0),u([f()],Fg.prototype,"realm",void 0),u([f(f5("dateFieldsTimeReference",!0))],Fg.prototype,"timeZone",void 0),Fg=u([L("esri.layers.support.EditFieldsInfo")],Fg);const n$t=Fg;let Kf=class extends Or(we){constructor(e){super(e)}};u([f({constructOnly:!0,json:{write:!0}})],Kf.prototype,"name",void 0),u([f({constructOnly:!0,json:{write:!0}})],Kf.prototype,"fields",void 0),u([f({constructOnly:!0,json:{write:!0}})],Kf.prototype,"isAscending",void 0),u([f({constructOnly:!0,json:{write:!0}})],Kf.prototype,"indexType",void 0),u([f({constructOnly:!0,json:{write:!0}})],Kf.prototype,"isUnique",void 0),u([f({constructOnly:!0,json:{write:!0}})],Kf.prototype,"description",void 0),Kf=u([L("esri.layers.support.FeatureIndex")],Kf);async function s$t(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=bLe(t));const r=o$t(t),n=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let s=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(s==null?s=o:s.features=s.features.concat(o.features),s.exceededTransferLimit=o.exceededTransferLimit,!n||!o.exceededTransferLimit)break;e.start+=r}return s}function o$t(t){return bLe(t)*a$t(t)}function a$t(t){return t.capabilities.query.maxRecordCount||2e3}function bLe(t){return t.capabilities.query.supportsMaxRecordCountFactor?Ty.MAX_MAX_RECORD_COUNT_FACTOR:1}var YX;let na=YX=class extends we{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new YX(te({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([f({type:[String],json:{write:!0}})],na.prototype,"attachmentTypes",void 0),u([f({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],na.prototype,"attachmentsWhere",void 0),u([f({type:Boolean,json:{write:!0}})],na.prototype,"cacheHint",void 0),u([f({type:[String],json:{write:!0}})],na.prototype,"keywords",void 0),u([f({type:[String],json:{write:!0}})],na.prototype,"globalIds",void 0),u([f({json:{write:!0}})],na.prototype,"name",void 0),u([f({type:Number,json:{read:{source:"resultRecordCount"}}})],na.prototype,"num",void 0),u([f({type:[Number],json:{write:!0}})],na.prototype,"objectIds",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],na.prototype,"returnMetadata",void 0),u([f({type:[Number],json:{write:!0}})],na.prototype,"size",void 0),u([f({type:Number,json:{read:{source:"resultOffset"}}})],na.prototype,"start",void 0),u([ke("start"),ke("num")],na.prototype,"writeStart",null),u([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],na.prototype,"where",void 0),na=YX=u([L("esri.rest.support.AttachmentQuery")],na),na.from=is(na);const l$t=na;var XX;let as=XX=class extends we{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new XX(te({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([f({type:Boolean,json:{write:!0}})],as.prototype,"cacheHint",void 0),u([f({type:gp,json:{write:!0}})],as.prototype,"dynamicDataSource",void 0),u([f({type:String,json:{write:!0}})],as.prototype,"gdbVersion",void 0),u([f({type:Number,json:{write:!0}})],as.prototype,"geometryPrecision",void 0),u([f({type:Date})],as.prototype,"historicMoment",void 0),u([ke("historicMoment")],as.prototype,"_writeHistoricMoment",null),u([f({type:Number,json:{write:!0}})],as.prototype,"maxAllowableOffset",void 0),u([f({json:{write:!0}})],as.prototype,"objectIds",void 0),u([f({type:[String],json:{write:!0}})],as.prototype,"orderByFields",void 0),u([f({type:[String],json:{write:!0}})],as.prototype,"outFields",void 0),u([f({type:nt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],as.prototype,"outSpatialReference",void 0),u([f({json:{write:!0}})],as.prototype,"relationshipId",void 0),u([f({type:Number,json:{read:{source:"resultOffset"}}})],as.prototype,"start",void 0),u([ke("start"),ke("num")],as.prototype,"writeStart",null),u([f({type:Number,json:{read:{source:"resultRecordCount"}}})],as.prototype,"num",void 0),u([f({json:{write:!0}})],as.prototype,"returnGeometry",void 0),u([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],as.prototype,"returnM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],as.prototype,"returnZ",void 0),u([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],as.prototype,"where",void 0),as=XX=u([L("esri.rest.support.RelationshipQuery")],as),as.from=is(as);const Yie=as,Tqt=Object.freeze(Object.defineProperty({__proto__:null,default:Yie},Symbol.toStringTag,{value:"Module"})),JX=new sr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function c$t(t,e,i,r){const n=await r1(t);if(await Xie(t,e,r),!n.addAttachment)throw new Y(r,"Layer source does not support addAttachment capability");return n.addAttachment(e,i)}function Xie(t,e,i){var s,o;const{attributes:r}=e,{objectIdField:n}=t;return(o=(s=t.capabilities)==null?void 0:s.data)!=null&&o.supportsAttachment?e?r?n&&r[n]?Promise.resolve():Promise.reject(new Y(i,`feature is missing the identifying attribute ${n}`)):Promise.reject(new Y(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new Y(i,"A feature is required to add/delete/update attachments")):Promise.reject(new Y(i,"this layer doesn't support attachments"))}async function u$t(t,e,i,r,n){const s=await r1(t);if(await Xie(t,e,n),!s.updateAttachment)throw new Y(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,i,r)}async function h$t(t,e,i){const{applyEdits:r}=await fe(()=>import("./editingSupport-BjgC9h82.js"),__vite__mapDeps([279,31,32,146])),n=await t.load();let s=i;return n.type==="feature"&&n.infoFor3D&&e.deleteFeatures!=null&&n.globalIdField!=null&&(s={...s,globalIdToObjectId:await R$t(n,e.deleteFeatures,n.globalIdField)}),r(n,n.source,e,i)}async function d$t(t,e,i){const{uploadAssets:r}=await fe(()=>import("./editingSupport-BjgC9h82.js"),__vite__mapDeps([279,31,32,146])),n=await t.load();return r(n,n.source,e,i)}async function p$t(t,e,i,r){const n=await r1(t);if(await Xie(t,e,r),!n.deleteAttachments)throw new Y(r,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(e,i)}async function f$t(t,e,i){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new Y(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function m$t(t,e,i,r){var y,w;e=l$t.from(e),await t.load();const n=t.source,s=t.capabilities;if(!((y=s==null?void 0:s.data)!=null&&y.supportsAttachment))throw new Y(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:g}=e;if(!((w=s==null?void 0:s.operations)!=null&&w.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||p||g))throw new Y(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||g))throw new Y(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!n.queryAttachments)throw new Y(r,"Layer source does not support queryAttachments capability",e);return n.queryAttachments(e)}async function g$t(t,e,i,r){const n=await r1(t);if(!n.queryObjectIds)throw new Y(r,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(Ty.from(e)??t.createQuery(),i)}async function y$t(t,e,i,r){const n=await r1(t);if(!n.queryFeatureCount)throw new Y(r,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(Ty.from(e)??t.createQuery(),i)}async function _$t(t,e,i,r){const n=await r1(t);if(!n.queryExtent)throw new Y(r,"Layer source does not support queryExtent capability");return n.queryExtent(Ty.from(e)??t.createQuery(),i)}async function v$t(t,e,i,r){const n=await r1(t);if(!n.queryRelatedFeatures)throw new Y(r,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(Yie.from(e),i)}async function w$t(t,e,i,r){const n=await r1(t);if(!n.queryRelatedFeaturesCount)throw new Y(r,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(Yie.from(e),i)}async function b$t(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await bK(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function x$t(t){var o,a;const e=new Ty,i=(o=t.capabilities)==null?void 0:o.data,r=(a=t.capabilities)==null?void 0:a.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:n,timeExtent:s}=t;return e.timeExtent=n!=null&&s!=null?s.offset(-n.value,n.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function xLe(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function SLe(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function S$t(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function T$t(t,e){const{subtypes:i,subtypeField:r}=t;if(!(e!=null&&e.attributes)||!(i!=null&&i.length)||!r)return null;const n=e.attributes[r];return n==null?null:i.find(s=>s.code===n)}function E$t(t,e){var o,a;const{fieldsIndex:i,subtypeField:r}=t,{name:n,type:s}=i.get(e)??{};if(!n)return null;if((r&&((o=i.get(r))==null?void 0:o.name))===n&&((a=t.subtypes)!=null&&a.length)){const l=t.subtypes.map(c=>new ub({code:TLe(c.code,s),name:c.name}));if(l!=null&&l.length)return new Ez({codedValues:l})}return null}function C$t(t,e){var s,o;const{fieldsIndex:i}=t,{name:r,type:n}=i.get(e)??{};if(!r)return null;if(("typeIdField"in t?(s=i.get(t.typeIdField))==null?void 0:s.name:null)===r&&"types"in t&&((o=t.types)!=null&&o.length)){const a=t.types.map(l=>new ub({code:TLe(l.id,n),name:l.name}));return new Ez({codedValues:a})}return null}function TLe(t,e){return e?L2e({type:e})&&typeof t=="number"?`${t}`:CXe({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function r1(t){return(await t.load()).source}async function M$t(t,e){if(!Gi||Gi.findCredential(t))return;let i;try{const r=await x1e(t,e);r&&(i=await Gi.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await Gi.getCredential(t,{signal:r})}catch{}}async function $$t(t,e,i){var n;const r=(n=t.parsedUrl)==null?void 0:n.path;r&&t.authenticationTriggerEvent===e&&await M$t(r,i)}function O$t(t){return!I4(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const mH=IC({types:MEe});function Jie(t,e){var i;if(t.defaultSymbol)return(i=t.types)!=null&&i.length?new Gie({defaultSymbol:mH(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:mH(r.symbol,r,e)}))}):new fM({symbol:mH(t.defaultSymbol,t,e)})}function A$t(t){var r,n,s;let e=(r=t.sourceJSON)==null?void 0:r.cacheMaxAge;if(!e)return!1;const i=(s=(n=t.editingInfo)==null?void 0:n.lastEditDate)==null?void 0:s.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function R$t(t,e,i){if(e==null)return null;const r=[],{objectIdField:n}=t;if(e.forEach(c=>{let h=null;if("attributes"in c){const{attributes:p}=c;h={globalId:p[i],objectId:p[n]!=null&&p[n]!==-1?p[n]:null}}else h={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};h.globalId!=null&&(h.objectId!=null&&h.objectId!==-1||r.push(h.globalId))}),r.length===0)return null;const s=t.createQuery();s.where=r.map(c=>`${i}='${c}'`).join(" OR "),s.returnGeometry=!1,s.outFields=[n,i],s.cacheHint=!1;const o=await Z5e(s$t(t,s));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const h=c.attributes[i],p=c.attributes[n];h!=null&&p!=null&&p!==-1&&a.set(Xje(h),p)}return a}function I$t(t,e,i){if(!e||!i||!t)return null;const r=i.getAttribute(e);return r==null?null:t.find(n=>{const{id:s}=n;return s!=null&&s.toString()===r.toString()})??null}function I4(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||P$t(t)}function P$t(t){var e,i;return!!((i=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&i.toLowerCase().split(",").map(r=>r.trim()).includes("map"))}function L$t(t,e,i){const r=e==null?void 0:e.queryBins;if(!r)throw new Y(i,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new Y(i,"Layer source does not support auto-interval binning");break;case"date":if(!r.supportsDate)throw new Y(i,"Layer source does not support date binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new Y(i,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new Y(i,"Layer source does not support fixed-interval binning")}const n=r==null?void 0:r.supportedStatistics;if(t.outStatistics&&n){const s=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:o}of t.outStatistics){const a=s.get(o);if(a&&!n[a])throw new Y(i,`Layer source does not support ${o} statistic type`)}}}let u2=class extends Or(we){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([f({type:String,json:{read:{source:"shapeAreaFieldName"}}})],u2.prototype,"shapeAreaField",void 0),u([f({type:String,json:{read:{source:"shapeLengthFieldName"}}})],u2.prototype,"shapeLengthField",void 0),u([f({type:String,json:{read:t=>Eke.read(t)||Cke.read(t)}})],u2.prototype,"units",void 0),u2=u([L("esri.layers.support.GeometryFieldsInfo")],u2);const D$t=u2;var QX;let h2=QX=class extends we{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ot}clone(){return new QX({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([f({type:String,json:{write:!0}})],h2.prototype,"floorField",void 0),u([f({json:{read:!1,write:!1}})],h2.prototype,"viewAllMode",void 0),u([f({json:{read:!1,write:!1}})],h2.prototype,"viewAllLevelIds",void 0),h2=QX=u([L("esri.layers.support.LayerFloorInfo")],h2);const N$t=h2,R0e=new sr({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),I0e=new sr({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let $h=class extends Or(we){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([f({json:{read:R0e.read,write:R0e.write}})],$h.prototype,"cardinality",void 0),u([f({json:{read:!0,write:!0}})],$h.prototype,"composite",void 0),u([f({json:{read:!0,write:!0}})],$h.prototype,"id",void 0),u([f({json:{read:!0,write:!0}})],$h.prototype,"keyField",void 0),u([f({json:{read:!0,write:!0}})],$h.prototype,"keyFieldInRelationshipTable",void 0),u([f({json:{read:!0,write:!0}})],$h.prototype,"name",void 0),u([f({json:{read:!0,write:!0}})],$h.prototype,"relatedTableId",void 0),u([f({json:{read:!0,write:!0}})],$h.prototype,"relationshipTableId",void 0),u([f({json:{read:I0e.read,write:I0e.write}})],$h.prototype,"role",void 0),$h=u([L("esri.layers.support.Relationship")],$h);const F$t=$h;function Pt(t,e,i){return!!ELe(t,e,i)}function AA(t,e,i){return ELe(t,e,i)}function ELe(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const k$t={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function U$t(t){var i;const e=(i=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function MI(t,e){var r;const i=(r=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:r.map(n=>n.toLowerCase());return!!(i!=null&&i.includes(e.toLowerCase()))}function z$t(t){var i;const e=(i=t==null?void 0:t.supportedStatisticTypes)==null?void 0:i.map(r=>r.toLowerCase());return{count:!!(e!=null&&e.includes("count")),sum:!!(e!=null&&e.includes("sum")),min:!!(e!=null&&e.includes("min")),max:!!(e!=null&&e.includes("max")),avg:!!(e!=null&&e.includes("avg")),var:!!(e!=null&&e.includes("var")),stddev:!!(e!=null&&e.includes("stddev")),percentileContinuous:!!(e!=null&&e.includes("percentile_continuous")),percentileDiscrete:!!(e!=null&&e.includes("percentile_discrete")),envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function CLe(t,e){return{analytics:V$t(t),attachment:B$t(t),data:j$t(t),metadata:G$t(t),operations:H$t(t.capabilities,t,e),query:q$t(t,e),queryBins:Y$t(t),queryRelated:W$t(t),queryTopFeatures:Z$t(t),editing:X$t(t)}}function V$t(t){return{supportsCacheHint:MI(t.advancedQueryCapabilities,"queryAnalytics")}}function B$t(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:MI(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Pt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const n=k$t[r.name];n&&(i[n]=!!r.isEnabled)}),i}function j$t(t){return{isVersioned:Pt(t,"isDataVersioned",!1),isBranchVersioned:Pt(t,"isDataBranchVersioned",!1),supportsAttachment:Pt(t,"hasAttachments",!1),supportsM:Pt(t,"hasM",!1),supportsZ:Pt(t,"hasZ",!1)}}function G$t(t){return{supportsAdvancedFieldProperties:Pt(t,"supportsFieldDescriptionProperty",!1)}}function H$t(t,e,i){const r=t?t.toLowerCase().split(",").map(g=>g.trim()):[],n=i?qC(i):null,s=r.includes(n!=null&&n.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const h=r.includes("changetracking"),p=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Pt(e,"supportsCalculate",!1),supportsTruncate:Pt(e,"supportsTruncate",!1),supportsValidateSql:Pt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:s,supportsQueryAnalytics:Pt(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:Pt(p,"supportsQueryAttachments",!1),supportsQueryBins:Pt(p,"supportsQueryBins",!1),supportsQueryTopFeatures:Pt(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Pt(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Pt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Pt(e,"supportsAsyncConvert3D",!1)}}function q$t(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,n=t.archivingInfo,s=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||s>=pe("mapserver-pbf-version-support"),l=axe(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{maxRecordCount:AA(t,"maxRecordCount",void 0),maxRecordCountFactor:AA(t,"maxRecordCountFactor",void 0),standardMaxRecordCount:AA(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:U$t(i),supportsCacheHint:Pt(i,"supportsQueryWithCacheHint",!1)||MI(i,"query"),supportsCentroid:Pt(i,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:l,supportsDefaultSpatialReference:Pt(i,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:Pt(i,"supportsDisjointSpatialRel",!1),supportsDistance:Pt(i,"supportsQueryWithDistance",!1),supportsDistinct:Pt(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Pt(i,"supportsReturningQueryExtent",!1),supportsFormatPBF:a&&c.has("pbf"),supportsFullTextSearch:Pt(i,"supportsFullTextSearch",!1),supportsGeometryProperties:Pt(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:Pt(i,"supportsHavingClause",!1),supportsHistoricMoment:Pt(n,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:Pt(i,"supportsMaxRecordCountFactor",!1),supportsOrderBy:Pt(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Pt(i,"supportsPagination",!1),supportsPercentileStatistics:Pt(i,"supportsPercentileStatistics",!1),supportsQuantization:Pt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Pt(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:Pt(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:Pt(r,"allowOthersToQuery",!0),supportsQueryGeometry:Pt(t,"supportsReturningQueryGeometry",!1),supportsResultType:Pt(i,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:Pt(i,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:Pt(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Pt(t,"useStandardizedQueries",!1),supportsStatistics:Pt(i,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:Pt(i,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:AA(t,"tileMaxRecordCount",void 0)}}function W$t(t){const e=t.advancedQueryCapabilities,i=Pt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Pt(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:MI(e,"queryRelated")}}function Z$t(t){return{supportsCacheHint:MI(t.advancedQueryCapabilities,"queryTopFilter")}}function Y$t(t){const e=t?t.queryBinsCapabilities:void 0;return{supportsDate:Pt(e,"supportsDateBin",!1),supportsFixedInterval:Pt(e,"supportsFixedIntervalBin",!1),supportsAutoInterval:Pt(e,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:Pt(e,"supportsFixedBoundariesBin",!1),supportedStatistics:z$t(e)}}function X$t(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Pt(t,"allowGeometryUpdates",!0),supportsGlobalId:Pt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Pt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Pt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Pt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Pt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Pt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Pt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Pt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Pt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Pt(i,"supportsAsyncApplyEdits",!1),zDefault:AA(t,"zDefault",void 0)}}function Mqt(t){var e;return{operations:{supportsAppend:Pt(t,"supportsAppend",!1),supportsCoverageQuery:((e=t==null?void 0:t.playbackInfo)==null?void 0:e.klv["0601"])??!1,supportsExportClip:Pt(t,"supportsExportClip",!1),supportsExportFrameset:Pt(t,"supportsExportFrameset",!1),supportsMensuration:Pt(t,"supportsMensuration",!1),supportsUpdate:Pt(t,"supportsUpdate",!1)}}}let kg=class extends Or(we){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=Cz(e[r]);return i}writeDomains(e,i){var n;if(!e)return;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=(n=e[s])==null?void 0:n.toJSON());i.domains=r}};u([f({type:Number,json:{write:!0}})],kg.prototype,"code",void 0),u([f({type:Object,json:{write:!0}})],kg.prototype,"defaultValues",void 0),u([f({json:{write:!0}})],kg.prototype,"domains",void 0),u([Pe("domains")],kg.prototype,"readDomains",null),u([ke("domains")],kg.prototype,"writeDomains",null),u([f({type:String,json:{write:!0}})],kg.prototype,"name",void 0),kg=u([L("esri.layers.support.Subtype")],kg);const J$t=kg,Q$t=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(ot.ofType(Kf)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=nt.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){var n;if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:s,operations:o,editing:a}=i;if(!s.supportsQueryByOthers||!s.supportsQueryByAnonymous||o.supportsEditing&&!(a.supportsUpdateByOthers&&a.supportsUpdateByAnonymous&&a.supportsDeleteByOthers&&a.supportsDeleteByAnonymous))return"load"}if((n=this.serviceDefinitionExpression)!=null&&n.toLowerCase().includes("current_user"))return"load";if(this.userHasUpdateItemPrivileges){if(A$t(this))return"load";if(this.hasUpdateItemRestrictions)return i.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const r=this.editFieldsInfo;return(r!=null&&r.creatorField||r!=null&&r.editorField)&&(i!=null&&i.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(i,r){return CLe(r,this.url)}readEditingInfo(i,r){const{editingInfo:n}=r;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const r=te(i),{operations:n,editing:s}=r;return I4(this)?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=s.supportsDeleteByOthers=s.supportsGeometryUpdate=s.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=s.supportsGeometryUpdate=!0),r)}readGlobalIdFieldFromService(i,r){return xLe(r)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||I4(this))return!1;const{operations:r,editing:n}=i;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&n.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:r,editing:n}=i;return I4(this)?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&n.supportsDeleteByOthers&&n.supportsGeometryUpdate&&n.supportsUpdateByOthers)}readIsTableFromService(i,r){return r.type==="Table"}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readMinScale(i,r){return r.effectiveMinScale||i||0}readObjectIdFieldFromService(i,r){return SLe(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){if(i==null)return void this._set("url",i);const r=Mje({layer:this,url:i,nonStandardUrlAllowed:!0,logger:de.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,n,s){$je(this,i,null,r,s)}readVersion(i,r){return S$t(r)}};return u([f({readOnly:!0})],e.prototype,"authenticationTriggerEvent",null),u([f({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([f({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","isDataBranchVersioned","isDataVersioned","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Pe("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([f(f5("dateFieldsTimeReference"))],e.prototype,"dateFieldsTimeZone",void 0),u([f({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([f({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([f({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([f({readOnly:!0,type:n$t})],e.prototype,"editFieldsInfo",void 0),u([f({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Pe("editingInfo")],e.prototype,"readEditingInfo",null),u([f({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([f((()=>{const i=te(QMt),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),u([f({type:N$t,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:wa}}}}})],e.prototype,"floorInfo",void 0),u([f({type:pr,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([f()],e.prototype,"gdbVersion",void 0),u([f({readOnly:!0,type:D$t,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([f({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:JX.read}}}})],e.prototype,"geometryType",void 0),u([f({type:String})],e.prototype,"globalIdField",void 0),u([Pe("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([f({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),u([f({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([f({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),u([f({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([f({readOnly:!0,type:Gv})],e.prototype,"heightModelInfo",void 0),u([f({type:Date})],e.prototype,"historicMoment",void 0),u([f({type:ot.ofType(Kf),readOnly:!0})],e.prototype,"indexes",void 0),u([f({readOnly:!0})],e.prototype,"isTable",void 0),u([Pe("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([f({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([f(i$t)],e.prototype,"maxScale",void 0),u([Pe("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([f(t$t)],e.prototype,"minScale",void 0),u([Pe("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([f({type:String})],e.prototype,"objectIdField",void 0),u([Pe("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([f(f5("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0),u([f({type:[F$t],readOnly:!0})],e.prototype,"relationships",void 0),u([f({type:Boolean})],e.prototype,"returnM",void 0),u([f({type:Boolean})],e.prototype,"returnZ",void 0),u([f({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([f({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Pe("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([f({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([f()],e.prototype,"sourceJSON",void 0),u([f({type:nt,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([f({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([f({type:[J$t],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"subtypes",void 0),u([f({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([f(XMt)],e.prototype,"url",null),u([ke("url")],e.prototype,"writeUrl",null),u([f({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Pe("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([L("esri.layers.mixins.FeatureLayerBase")],e),e};let d2=class extends Or(we){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([f({type:String,json:{write:!0}})],d2.prototype,"expression",void 0),u([f({type:String,json:{write:!0}})],d2.prototype,"title",void 0),u([f({type:String,json:{write:!0}})],d2.prototype,"returnType",void 0),d2=u([L("esri.layers.support.ExpressionInfo")],d2);const Qie=d2;var KX;let Ug=KX=class extends we{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new KX({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:te(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([f({type:Boolean,json:{write:!0}})],Ug.prototype,"isAutoGenerated",void 0),u([f({type:String,json:{write:!0}})],Ug.prototype,"name",void 0),u([f({type:String,json:{write:!0}})],Ug.prototype,"alias",void 0),u([f({type:String,json:{write:!0}})],Ug.prototype,"onStatisticField",void 0),u([f({type:Qie,json:{write:!0}})],Ug.prototype,"onStatisticExpression",void 0),u([f({type:String,json:{write:!0}})],Ug.prototype,"statisticType",void 0),Ug=KX=u([L("esri.layers.support.AggregateField")],Ug);const gx=Ug;let vv=class extends we{constructor(){super(...arguments),this.type=null}};u([f({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],vv.prototype,"type",void 0),vv=u([L("esri.layers.support.FeatureReduction")],vv);var eJ;let C_=eJ=class extends we{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?zZ(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=zZ(this.value)),t!=null&&(e[i]=t)}clone(){return new eJ({expression:this.expression,title:this.title,value:this.value})}};u([f({type:String,json:{write:{writerEnsuresNonNull:!0}}})],C_.prototype,"expression",void 0),u([Pe("expression",["expression","value"])],C_.prototype,"readExpression",null),u([ke("expression")],C_.prototype,"writeExpression",null),u([f({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],C_.prototype,"title",void 0),u([f({json:{read:!1,write:!1}})],C_.prototype,"value",void 0),C_=eJ=u([L("esri.layers.support.LabelExpressionInfo")],C_);const MLe=C_;var tJ;const rN=new sr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function nN(t,e,i){return{enabled:!d9(i==null?void 0:i.layer)}}function $Le(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function K$t(t){return(t==null?void 0:t.type)==="map-image"}function OLe(t){var e,i;return!!K$t(t)&&!!((i=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function eOt(t){return $Le(t)||OLe(t==null?void 0:t.layer)}let Ps=tJ=class extends we{static evaluateWhere(t,e){const i=(r,n,s)=>{switch(n){case"=":return r==s;case"<>":return r!=s;case">":return r>s;case">=":return r>=s;case"<":return r<s;case"<=":return r<=s}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const n=i(e[r[0]],r[1],r[2]),s=r[3],o=i(e[r[4]],r[5],r[6]);switch(s){case"AND":return n&&o;case"OR":return n||o}}return!1}catch{}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=rCt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=kat(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=Xee(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&$Le(r))t=new MLe({expression:this.getLabelExpressionArcade()});else if(!t)return;const n=t.toJSON(r);n.expression&&(e[i]=n)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return Jz(this)}getLabelExpressionArcade(){return Uat(this)}getLabelExpressionSingleField(){return zat(this)}hash(){return JSON.stringify(this)}clone(){return new tJ({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:te(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:te(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([f({type:String,json:{write:!0}})],Ps.prototype,"name",void 0),u([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:nN}}}}})],Ps.prototype,"allowOverrun",void 0),u([f({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:nN}}}}})],Ps.prototype,"deconflictionStrategy",void 0),u([f({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&OLe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],Ps.prototype,"labelExpression",void 0),u([Pe("labelExpression")],Ps.prototype,"readLabelExpression",null),u([ke("labelExpression")],Ps.prototype,"writeLabelExpression",null),u([f({type:MLe,json:{write:{overridePolicy:(t,e,i)=>eOt(i)?{allowNull:!0}:{enabled:!1}}}})],Ps.prototype,"labelExpressionInfo",void 0),u([ke("labelExpressionInfo")],Ps.prototype,"writeLabelExpressionInfo",null),u([f({type:rN.apiValues,json:{type:rN.jsonValues,read:rN.read,write:rN.write}})],Ps.prototype,"labelPlacement",void 0),u([f({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Ps.prototype,"labelPosition",void 0),u([f({type:Number})],Ps.prototype,"maxScale",void 0),u([ke("maxScale")],Ps.prototype,"writeMaxScale",null),u([f({type:Number})],Ps.prototype,"minScale",void 0),u([ke("minScale")],Ps.prototype,"writeMinScale",null),u([f({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:nN}}}}})],Ps.prototype,"repeatLabel",void 0),u([f({type:Number,cast:mr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:nN}}}}})],Ps.prototype,"repeatLabelDistance",void 0),u([f({types:BJe,json:{origins:{"web-scene":{types:jJe,write:Bye,default:null}},write:Bye,default:null}})],Ps.prototype,"symbol",void 0),u([f({type:Boolean,json:{write:!0}})],Ps.prototype,"useCodedValues",void 0),u([f({type:String,json:{write:!0}})],Ps.prototype,"where",void 0),Ps=tJ=u([L("esri.layers.support.LabelClass")],Ps);const RV=Ps;var iJ;let ul=iJ=class extends vv{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=mr("12px"),this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());Uo(i,r,e)}readRenderer(t,e,i){var n;const r=(n=e.drawingInfo)==null?void 0:n.renderer;return r?T3(r,e,i)??void 0:Jie(e,i)}clone(){return new iJ({fields:te(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:te(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:te(this.popupTemplate),renderer:te(this.renderer),binType:te(this.binType),size:this.size})}};u([_t({binning:"binning"})],ul.prototype,"type",void 0),u([_t({geohash:"geohash",square:"square"}),f({type:["geohash","square"]})],ul.prototype,"binType",void 0),u([f({type:Number,json:{write:!0}})],ul.prototype,"fixedBinLevel",void 0),u([f({type:[RV],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],ul.prototype,"labelingInfo",void 0),u([f(Zie)],ul.prototype,"labelsVisible",void 0),u([f({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],ul.prototype,"maxScale",void 0),u([f(Wie)],ul.prototype,"popupEnabled",void 0),u([f({type:KC,json:{name:"popupInfo",write:!0}})],ul.prototype,"popupTemplate",void 0),u([f({cast:t=>t==="auto"?t:Hl(mr(t))})],ul.prototype,"size",void 0),u([f({type:[gx],json:{write:!0}})],ul.prototype,"fields",void 0),u([ke("fields")],ul.prototype,"writeFields",null),u([f({types:OV,json:{write:{target:"drawingInfo.renderer"}}})],ul.prototype,"renderer",void 0),u([Pe("renderer",["drawingInfo.renderer"])],ul.prototype,"readRenderer",null),ul=iJ=u([L("esri.layers.support.FeatureReductionBinning")],ul);const ALe=ul;var rJ;function P0e(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let uo=rJ=class extends we{constructor(t){super(t),this.type="cluster",this.clusterRadius=mr("80px"),this.clusterMinSize=mr("12px"),this.clusterMaxSize=mr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,i){var n,s;const r=(n=e.drawingInfo)==null?void 0:n.renderer;return(s=r==null?void 0:r.authoringInfo)!=null&&s.isAutoGenerated?null:r?P0e(r)?null:T3(r,e,i)??void 0:Jie(e,i)}readSymbol(t,e,i){var n,s;const r=(n=e.drawingInfo)==null?void 0:n.renderer;if((s=r==null?void 0:r.authoringInfo)!=null&&s.isAutoGenerated)return null;if(r&&P0e(r)){const o=T3(r,e,i);return o==null?void 0:o.symbol}return null}writeSymbol(t,e,i,r){var s,o;const n=(o=(s=this.renderer)==null?void 0:s.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||n){const a=new fM({symbol:t});e.drawingInfo={renderer:a.write({},r)}}}writeFields(t,e,i){const r=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());Uo(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>gx.fromJSON(r))}clone(){return new rJ({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:te(this.labelingInfo),labelsVisible:this.labelsVisible,fields:te(this.fields),maxScale:this.maxScale,renderer:te(this.renderer),symbol:te(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:te(this.popupTemplate)})}};u([f({type:["cluster"],readOnly:!0,json:{write:!0}})],uo.prototype,"type",void 0),u([f({cast:t=>t==="auto"?t:Hl(mr(t)),json:{write:!0}})],uo.prototype,"clusterRadius",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],uo.prototype,"clusterMinSize",void 0),u([f({type:Number,cast:mr,json:{write:!0}})],uo.prototype,"clusterMaxSize",void 0),u([f({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],uo.prototype,"maxScale",void 0),u([f(Wie)],uo.prototype,"popupEnabled",void 0),u([f({type:KC,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],uo.prototype,"popupTemplate",void 0),u([f({types:OV,json:{write:{target:"drawingInfo.renderer"}}})],uo.prototype,"renderer",void 0),u([Pe("renderer",["drawingInfo.renderer"])],uo.prototype,"readRenderer",null),u([f({types:zJe})],uo.prototype,"symbol",void 0),u([Pe("symbol",["drawingInfo.renderer"])],uo.prototype,"readSymbol",null),u([ke("symbol")],uo.prototype,"writeSymbol",null),u([f({type:[RV],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],uo.prototype,"labelingInfo",void 0),u([f(Zie)],uo.prototype,"labelsVisible",void 0),u([f({type:[gx],json:{write:!0}})],uo.prototype,"fields",void 0),u([ke("fields")],uo.prototype,"writeFields",null),u([Pe("fields")],uo.prototype,"readFields",null),uo=rJ=u([L("esri.layers.support.FeatureReductionCluster")],uo);const RLe=uo;var nJ;let P4=nJ=class extends vv{constructor(t){super(t),this.type="selection"}clone(){return new nJ}};u([f({type:["selection"]})],P4.prototype,"type",void 0),P4=nJ=u([L("esri.layers.support.FeatureReductionSelection")],P4);const L0e=P4,D0e={key:"type",base:vv,typeMap:{cluster:RLe,binning:ALe}},tOt={types:{key:"type",base:vv,typeMap:{selection:L0e,cluster:RLe,binning:ALe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:D0e},"portal-item":{types:D0e},"web-scene":{types:{key:"type",base:vv,typeMap:{selection:L0e}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:wa}}}}},aT={Base64:0,Hex:1,String:2,Raw:3},CE=8,ILe=(1<<CE)-1;function ov(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function iOt(t){const e=[];for(let i=0,r=t.length*CE;i<r;i+=CE)e[i>>5]|=(t.charCodeAt(i/CE)&ILe)<<i%32;return e}function rOt(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=CE)e.push(String.fromCharCode(t[i>>5]>>>i%32&ILe));return e.join("")}function nOt(t){const e="0123456789abcdef",i=[];for(let r=0,n=4*t.length;r<n;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function sOt(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let n=0,s=4*t.length;n<s;n+=3){const o=(t[n>>2]>>n%4*8&255)<<16|(t[n+1>>2]>>(n+1)%4*8&255)<<8|t[n+2>>2]>>(n+2)%4*8&255;for(let a=0;a<4;a++)8*n+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function oOt(t,e){return t<<e|t>>>32-e}function IV(t,e,i,r,n,s){return ov(oOt(ov(ov(e,t),ov(r,s)),n),i)}function rl(t,e,i,r,n,s,o){return IV(e&i|~e&r,t,e,n,s,o)}function nl(t,e,i,r,n,s,o){return IV(e&r|i&~r,t,e,n,s,o)}function sl(t,e,i,r,n,s,o){return IV(e^i^r,t,e,n,s,o)}function ol(t,e,i,r,n,s,o){return IV(i^(e|~r),t,e,n,s,o)}function aOt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,n=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=n,h=s;i=rl(i,r,n,s,t[o],7,-680876936),s=rl(s,i,r,n,t[o+1],12,-389564586),n=rl(n,s,i,r,t[o+2],17,606105819),r=rl(r,n,s,i,t[o+3],22,-1044525330),i=rl(i,r,n,s,t[o+4],7,-176418897),s=rl(s,i,r,n,t[o+5],12,1200080426),n=rl(n,s,i,r,t[o+6],17,-1473231341),r=rl(r,n,s,i,t[o+7],22,-45705983),i=rl(i,r,n,s,t[o+8],7,1770035416),s=rl(s,i,r,n,t[o+9],12,-1958414417),n=rl(n,s,i,r,t[o+10],17,-42063),r=rl(r,n,s,i,t[o+11],22,-1990404162),i=rl(i,r,n,s,t[o+12],7,1804603682),s=rl(s,i,r,n,t[o+13],12,-40341101),n=rl(n,s,i,r,t[o+14],17,-1502002290),r=rl(r,n,s,i,t[o+15],22,1236535329),i=nl(i,r,n,s,t[o+1],5,-165796510),s=nl(s,i,r,n,t[o+6],9,-1069501632),n=nl(n,s,i,r,t[o+11],14,643717713),r=nl(r,n,s,i,t[o],20,-373897302),i=nl(i,r,n,s,t[o+5],5,-701558691),s=nl(s,i,r,n,t[o+10],9,38016083),n=nl(n,s,i,r,t[o+15],14,-660478335),r=nl(r,n,s,i,t[o+4],20,-405537848),i=nl(i,r,n,s,t[o+9],5,568446438),s=nl(s,i,r,n,t[o+14],9,-1019803690),n=nl(n,s,i,r,t[o+3],14,-187363961),r=nl(r,n,s,i,t[o+8],20,1163531501),i=nl(i,r,n,s,t[o+13],5,-1444681467),s=nl(s,i,r,n,t[o+2],9,-51403784),n=nl(n,s,i,r,t[o+7],14,1735328473),r=nl(r,n,s,i,t[o+12],20,-1926607734),i=sl(i,r,n,s,t[o+5],4,-378558),s=sl(s,i,r,n,t[o+8],11,-2022574463),n=sl(n,s,i,r,t[o+11],16,1839030562),r=sl(r,n,s,i,t[o+14],23,-35309556),i=sl(i,r,n,s,t[o+1],4,-1530992060),s=sl(s,i,r,n,t[o+4],11,1272893353),n=sl(n,s,i,r,t[o+7],16,-155497632),r=sl(r,n,s,i,t[o+10],23,-1094730640),i=sl(i,r,n,s,t[o+13],4,681279174),s=sl(s,i,r,n,t[o],11,-358537222),n=sl(n,s,i,r,t[o+3],16,-722521979),r=sl(r,n,s,i,t[o+6],23,76029189),i=sl(i,r,n,s,t[o+9],4,-640364487),s=sl(s,i,r,n,t[o+12],11,-421815835),n=sl(n,s,i,r,t[o+15],16,530742520),r=sl(r,n,s,i,t[o+2],23,-995338651),i=ol(i,r,n,s,t[o],6,-198630844),s=ol(s,i,r,n,t[o+7],10,1126891415),n=ol(n,s,i,r,t[o+14],15,-1416354905),r=ol(r,n,s,i,t[o+5],21,-57434055),i=ol(i,r,n,s,t[o+12],6,1700485571),s=ol(s,i,r,n,t[o+3],10,-1894986606),n=ol(n,s,i,r,t[o+10],15,-1051523),r=ol(r,n,s,i,t[o+1],21,-2054922799),i=ol(i,r,n,s,t[o+8],6,1873313359),s=ol(s,i,r,n,t[o+15],10,-30611744),n=ol(n,s,i,r,t[o+6],15,-1560198380),r=ol(r,n,s,i,t[o+13],21,1309151649),i=ol(i,r,n,s,t[o+4],6,-145523070),s=ol(s,i,r,n,t[o+11],10,-1120210379),n=ol(n,s,i,r,t[o+2],15,718787259),r=ol(r,n,s,i,t[o+9],21,-343485551),i=ov(i,a),r=ov(r,l),n=ov(n,c),s=ov(s,h)}return[i,r,n,s]}function PLe(t,e=aT.Hex){const i=e||aT.Base64,r=aOt(iOt(t),t.length*CE);switch(i){case aT.Raw:return r;case aT.Hex:return nOt(r);case aT.String:return rOt(r);case aT.Base64:return sOt(r)}}const lOt=()=>de.getLogger("esri.views.2d.layers.support.clusterUtils");pe.add("esri-cluster-arcade-enabled",!0);const cOt=pe("esri-cluster-arcade-enabled"),uOt=new Set(["simple-line","simple-fill","picture-fill"]);function N0e(t,e){let i=e.clone();if(!hOt(i))return i;if(e.getSymbols().some(r=>uOt.has(r.type))&&(i=new fM({symbol:new Lm})),i.authoringInfo||(i.authoringInfo=new Lie),i.authoringInfo.isAutoGenerated=!0,"visualVariables"in i){const r=(i.visualVariables||[]).filter(n=>n.valueExpression!=="$view.scale");r.forEach(n=>{n.type==="rotation"?n.field?n.field=G1(t,n.field,"avg_angle","number"):n.valueExpression&&(n.field=Q$(t,n.valueExpression,"avg_angle","number"),n.valueExpression=null):n.normalizationField?(n.field=G1(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=G1(t,n.field,"avg","number"):n.valueExpression&&(n.field=Q$(t,n.valueExpression,"avg","number"),n.valueExpression=null)}),i.visualVariables=r}switch(i.type){case"simple":break;case"pie-chart":for(const r of i.attributes)r.field?r.field=G1(t,r.field,"sum","number"):r.valueExpression&&(r.field=Q$(t,r.valueExpression,"sum","number"),r.valueExpression=null);break;case"unique-value":i.field?i.field=G1(t,i.field,"mode","string"):i.valueExpression&&(i.field=Q$(t,i.valueExpression,"mode","string"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=G1(t,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=G1(t,i.field,"avg","number"):i.valueExpression&&(i.field=Q$(t,i.valueExpression,"avg","number"),i.valueExpression=null)}return i}const hOt=t=>{const e=i=>lOt().error(new Y("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!cOt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function dOt(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,n="field",s=e.toLowerCase()+",norm:"+n+","+r.toLowerCase();return"cluster_avg_"+PLe(s)}}}function Q$(t,e,i,r){const n=PLe(e),s=i==="mode"?`cluster_type_${n}`:i==="sum"?`cluster_sum_${n}`:`cluster_avg_${n}`;return t.some(o=>o.name===s)||t.push(new gx({name:s,isAutoGenerated:!0,onStatisticExpression:new Qie({expression:e,returnType:r}),statisticType:i})),s}function G1(t,e,i,r,n){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const s=dOt(i,e,n);return t.some(o=>o.name===s)||(i==="avg_norm"?t.push(new gx({name:s,isAutoGenerated:!0,onStatisticExpression:new Qie({expression:`$feature.${e} / $feature.${n}`,returnType:r}),statisticType:"avg"})):t.push(new gx({name:s,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),s}const pOt=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(oe(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},xi))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_withClusterVariable(i,r,n){const s=i.clone();return"visualVariables"in s&&(s.visualVariables||(s.visualVariables=[]),s.visualVariables.some(o=>o.type==="size")||s.visualVariables.push(new CV({field:"cluster_count",stops:[new y4({value:1}),new y4({useMinValue:!0,size:r}),new y4({useMaxValue:!0,size:n})]}))),s}_normalizeFeatureReduction(i){var p;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),n=[new gx({name:"cluster_count",alias:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],s=(r.fields??[]).filter(g=>!g.isAutoGenerated),o=i.renderer&&!((p=i.renderer.authoringInfo)!=null&&p.isAutoGenerated),{clusterMinSize:a,clusterMaxSize:l}=r;if(o){r.fields=[...n,...s];const g=this._withClusterVariable(r.renderer,a,l);return r.effectiveFeatureRenderer=g,r.effectiveClusterRenderer=g,r}if(i.symbol){if(r.fields=[...n,...s],r.renderer=null,!this.renderer)return r.effectiveFeatureRenderer=null,r.effectiveClusterRenderer=null,r;const g=N0e(n,this.renderer),y=this._withClusterVariable(g,a,l),w="visualVariables"in y&&y.visualVariables?y.visualVariables:[],b=new fM({symbol:i.symbol,visualVariables:w});return r.fields=[...n,...s],r.effectiveFeatureRenderer=y,r.effectiveClusterRenderer=b,r}if(!this.renderer)return i;const c=N0e(n,this.renderer);r.fields=[...n,...s],r.renderer=c;const h=this._withClusterVariable(c,a,l);return r.effectiveFeatureRenderer=h,r.effectiveClusterRenderer=h,r}};return u([f(tOt)],e.prototype,"featureReduction",null),e=u([L("esri.layers.mixins.FeatureReductionLayer")],e),e},F0e={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},k0e={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},U0e={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},fOt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":F0e,"web-map/basemap":k0e,"web-map/tables":U0e,"link-chart/operational-layers":{...F0e,LinkChartLayer:!0},"link-chart/basemap":k0e,"link-chart/tables":U0e,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}},mOt=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,n){var s;return((s=n==null?void 0:n.portalItem)==null?void 0:s.type)==="Group Layer"?void 0:i}writeListMode(i,r,n,s){(s&&s.layerContainerType==="ground"||i&&G4e(this,n,{},s))&&(r[n]=i)}writeOperationalLayerType(i,r,n,s){i&&(s==null?void 0:s.layerContainerType)!=="tables"&&(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}readTimeExtent(i){return i?ja.fromArray(i):null}writeTimeExtent(i,r,n,s){i&&s.layerContainerType!=="tables"&&(i.isEmpty?s!=null&&s.messages&&s.messages.push(new Y("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[n]=i.toArray())}read(i,r){r&&(r.layer=this),mve(this,i,n=>super.read(i,n),r)}write(i,r){var o,a;if(!this.persistenceEnabled&&!(r!=null&&r.ignorePersistenceEnabled))return null;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=fOt[l];let h=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new Y("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const n=super.write(i,{...r,layer:this}),s=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof Y&&l.name==="web-document-write:property-required").length;return AE(n==null?void 0:n.url)?((a=r==null?void 0:r.messages)==null||a.push(new Y("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return u([f({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([Pe("id",["id"])],e.prototype,"readId",null),u([f(wLe)],e.prototype,"listMode",void 0),u([ke("listMode")],e.prototype,"writeListMode",null),u([f({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:wa}}}}})],e.prototype,"operationalLayerType",void 0),u([ke("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([f(ZX)],e.prototype,"opacity",void 0),u([f({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),u([f({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([ke("title"),ke(["web-scene"],"title")],e.prototype,"writeTitle",null),u([f({type:ja,json:{origins:{"web-scene":{write:{layerContainerTypes:wa}}}}})],e.prototype,"visibilityTimeExtent",void 0),u([Pe("visibilityTimeExtent")],e.prototype,"readTimeExtent",null),u([ke(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[Wi,RC]]}})],e.prototype,"writeTimeExtent",null),u([f({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:wa}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=u([L("esri.layers.mixins.OperationalLayer")],e),e};var sJ;const sN=new sr({asc:"ascending",desc:"descending"});let p2=sJ=class extends we{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new sJ({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([f({type:String,json:{write:!0}})],p2.prototype,"field",void 0),u([f({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],p2.prototype,"valueExpression",void 0),u([f({type:sN.apiValues,json:{type:sN.jsonValues,read:sN.read,write:sN.write}})],p2.prototype,"order",void 0),p2=sJ=u([L("esri.layers.support.OrderByInfo")],p2);const LLe=p2;function gOt(t,e,i){if(!t)return null;const r=t.find(s=>!!s.field);if(!r)return null;const n=new LLe;return n.read(r,i),[n]}function yOt(t,e,i,r){const n=t.find(s=>!!s.field);n&&Uo(i,[n.toJSON()],e)}const _Ot={type:[LLe],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:gOt},write:{writer:yOt}}},vOt=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([f(_Ot)],e.prototype,"orderBy",void 0),e=u([L("esri.layers.mixins.OrderedLayer")],e),e},wOt=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Ye(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,n){if(r.itemId)return new vb({id:r.itemId,portal:n==null?void 0:n.portal})}writePortalItem(i,r){i!=null&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){var n;if((n=this.portalItem)!=null&&n.id)try{const{load:s}=await fe(()=>import("./layersLoader-CToFwvA1.js"),__vite__mapDeps([280,13,11,12,10]));return zt(r),await s({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(s){throw Bn(s)||de.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Pc(r),!0)))}async setUserPrivileges(i,r){if(!Qr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:n,fullEdit:s},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",o)}catch(n){Pc(n)}}async _fetchUserPrivileges(i,r){let n=this.portalItem;if(!i||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(r);const s=i===n.id;if(s&&n.portal.user)return Bae(n);let o,a;if(s)o=n.portal.url;else try{o=await x1e(this.url,r)}catch(p){Pc(p)}if(!o||!Tve(o,n.portal.url))return this._fetchFallbackUserPrivileges(r);try{const p=r!=null?r.signal:null;a=await(Gi==null?void 0:Gi.getCredential(`${o}/sharing`,{prompt:!1,signal:p}))}catch(p){Pc(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(s?await n.reload():(n=new vb({id:i,portal:{url:o}}),await n.load(r)),n.portal.user)return Bae(n)}catch(p){Pc(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(n){Pc(n)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Gi==null?void 0:Gi.findCredential(this.url):null;if(!r)return!0;const n=oN.credential===r?oN.user:await this._fetchEditingUser(i);return oN.credential=r,oN.user=n,(n==null?void 0:n.privileges)==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const n=Gi==null?void 0:Gi.findServerInfo(this.url??"");if(!(n!=null&&n.owningSystemUrl))return null;const s=`${n.owningSystemUrl}/sharing/rest`,o=va.getDefault();if(o&&o.loaded&&nd(o.restUrl)===nd(s))return o.user;const a=`${s}/community/self`,l=i!=null?i.signal:null,c=await Xp(Br(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?HJ.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){var o;const n=r==null?void 0:r.portal,s=((o=this.portalItem)==null?void 0:o.id)&&(this.portalItem.portal||va.getDefault());return n&&s&&!Eve(s.restUrl,n.restUrl)?(r.messages&&r.messages.push(new Y("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([f({type:vb})],e.prototype,"portalItem",null),u([Pe("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([ke("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([f({clonable:!1})],e.prototype,"resourceReferences",void 0),u([f({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([f({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([f({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([L("esri.layers.mixins.PortalLayer")],e),e},oN={credential:null,user:null};let RA=class extends Ne{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([f()],RA.prototype,"updating",void 0),u([f()],RA.prototype,"status",void 0),RA=u([L("esri.layers.support.PublishingInfo")],RA);const bOt=RA,xOt=Symbol(),SOt=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const n=new bOt;return this._checkPublishingStatus(n),n}_checkPublishingStatus(r){let o=0;const a=async c=>{let h;r.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=h,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.addHandles(l)}};return e=xOt,u([f({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=u([L("esri.layers.mixins.PublishableLayer")],i),i},av=new ot,vR=new WeakMap;function TOt(t){COt(t)&&av.push(new WeakRef(t))}function EOt(t){const e=av.find(i=>i.deref()===t);e&&av.remove(e)}function COt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function DLe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:DLe(e,t%e):0}let gH=0,aN=0;function MOt(){const t=Date.now();let e=!1;for(const i of av){const r=i.deref();r?r.refreshInterval&&t-(vR.get(r)??0)+5>=6e4*r.refreshInterval&&(vR.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=av.length-1;i>=0;i--)av.at(i).deref()||av.removeAt(i)}H_e(()=>{const t=Date.now();let e=0;for(const i of av){const r=i.deref();r&&(e=DLe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?vR.get(r)||vR.set(r,t):vR.delete(r))}if(e!==aN){if(aN=e,clearInterval(gH),aN===0)return void(gH=0);gH=setInterval(MOt,aN)}},xi);function Rqt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const z0e=.1,$Ot=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=cU(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||TOt(this)},()=>{})}destroy(){EOt(this)}castRefreshInterval(i){return i>=z0e?i:i<=0?0:z0e}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){bR(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{de.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){}};return u([f({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:wa}}}}})],e.prototype,"refreshInterval",void 0),u([$i("refreshInterval")],e.prototype,"castRefreshInterval",null),u([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([f({readOnly:!0})],e.prototype,"refreshParameters",null),e=u([L("esri.layers.mixins.RefreshableLayer")],e),e};function V0e(t,e){return ZE.fromJSON({value:t,unit:e})}let Ia=class extends Or(we){constructor(t){super(t),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(t,e){return e.timeExtent&&Array.isArray(e.timeExtent)&&e.timeExtent.length===2?ja.fromArray(e.timeExtent):null}writeFullTimeExtent(t,e){(t==null?void 0:t.start)!=null&&t.end!=null?e.timeExtent=t.toArray():e.timeExtent=null}readInterval(t,e){return e.timeInterval&&e.timeIntervalUnits?V0e(e.timeInterval,e.timeIntervalUnits):e.defaultTimeInterval&&e.defaultTimeIntervalUnits?V0e(e.defaultTimeInterval,e.defaultTimeIntervalUnits):null}writeInterval(t,e){e.timeInterval=(t==null?void 0:t.toJSON().value)??null,e.timeIntervalUnits=(t==null?void 0:t.toJSON().unit)??null}};u([f({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Ia.prototype,"cumulative",void 0),u([f({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Ia.prototype,"endField",void 0),u([f({type:ja,json:{write:{enabled:!0,allowNull:!0}}})],Ia.prototype,"fullTimeExtent",void 0),u([Pe("fullTimeExtent",["timeExtent"])],Ia.prototype,"readFullTimeExtent",null),u([ke("fullTimeExtent")],Ia.prototype,"writeFullTimeExtent",null),u([f({type:Boolean,json:{write:!0}})],Ia.prototype,"hasLiveData",void 0),u([f({type:ZE,json:{write:{enabled:!0,allowNull:!0}}})],Ia.prototype,"interval",void 0),u([Pe("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Ia.prototype,"readInterval",null),u([ke("interval")],Ia.prototype,"writeInterval",null),u([f({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Ia.prototype,"startField",void 0),u([f(f5("timeReference",!0))],Ia.prototype,"timeZone",void 0),u([f({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Ia.prototype,"trackIdField",void 0),u([f({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Ia.prototype,"useTime",void 0),u([f({type:[Date],json:{read:!1}})],Ia.prototype,"stops",void 0),Ia=u([L("esri.layers.support.TimeInfo")],Ia);const NLe=Ia,OOt={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:wa}}},AOt=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const n=r.timeInfo.exportOptions;if(!n)return null;const s=n.timeOffset,o=RQ.fromJSON(n.timeOffsetUnits);return s&&o?new ZE({value:s,unit:o}):null}set timeInfo(i){C2e(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([f({type:ja,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([f({type:ZE})],e.prototype,"timeOffset",void 0),u([Pe("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([f({value:null,type:NLe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([f(OOt)],e.prototype,"useViewTime",void 0),e=u([L("esri.layers.mixins.TemporalLayer")],e),e},B0e=new sr({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let M_=class extends Or(we){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([f({json:{write:!0}})],M_.prototype,"name",void 0),u([f({json:{write:!0}})],M_.prototype,"description",void 0),u([f({json:{read:B0e.read,write:B0e.write}})],M_.prototype,"drawingTool",void 0),u([f({json:{write:!0}})],M_.prototype,"prototype",void 0),u([f({json:{write:!0}})],M_.prototype,"thumbnail",void 0),M_=u([L("esri.layers.support.FeatureTemplate")],M_);const Kie=M_;let zg=class extends Or(we){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=Cz(e[r]);return i}writeDomains(e,i){var n;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=(n=e[s])==null?void 0:n.toJSON());i.domains=r}};u([f({json:{write:!0}})],zg.prototype,"id",void 0),u([f({json:{write:!0}})],zg.prototype,"name",void 0),u([f({json:{write:!0}})],zg.prototype,"domains",void 0),u([Pe("domains")],zg.prototype,"readDomains",null),u([ke("domains")],zg.prototype,"writeDomains",null),u([f({type:[Kie],json:{write:!0}})],zg.prototype,"templates",void 0),zg=u([L("esri.layers.support.FeatureType")],zg);const FLe=zg;function ROt(){return{fields:{type:[Mz],value:null,set:function(t){if(t&&pe("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");de.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return YPe.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!(t!=null&&t.length))return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const i of t)((e=this.fieldsIndex)==null?void 0:e.has(i))||de.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:t});return TK(this.fieldsIndex,t)}}}}const yH=()=>de.getLogger("esri.layers.support.labelingInfo"),IOt=/\[([^[\]]+)\]/gi;function _H(t,e,i){return t?t.map(r=>{var s;const n=new RV;if(n.read(r,i),n.labelExpression){const o=e.fields||((s=e.layerDefinition)==null?void 0:s.fields)||this.fields;n.labelExpression=n.labelExpression.replaceAll(IOt,(a,l)=>`[${POt(l,o)}]`)}return n}):null}function POt(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const n=e[r].name;if(n.toLowerCase()===i)return n}return t}const LOt={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryMultiPatch:["always-horizontal"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function Lqt(t,e){const i=[];for(const r of t){const n=r.labelPlacement,s=LOt[e];if(!r.symbol)return yH().warn("No ILabelClass symbol specified."),[];if(!s)return yH().error(new Y("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(s.includes(n))i.push(r);else{const o=s[0];n&&yH().warn(`Found invalid label placement type ${n} for ${e}. Defaulting to ${o}`);const a=r.clone();a.labelPlacement=o,i.push(a)}}return i}const f2=[];function DOt(t,e){if(axe(t.url??""))return!0;const{wkid:i}=e;for(const r of f2){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}f2.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),f2.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),f2.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),f2.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),f2.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]);async function NOt(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const n=await Xp(r.populateFromStyle());if(zt(i),n.ok===!1){const s=n.error;e!=null&&e.messages&&e.messages.push(new Yp("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}function FOt({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:n},s){if(!i)return null;const o=VOt({editFieldsInfo:e,fields:i,objectIdField:r},s);if(!o.length)return null;const a=GOt({titleBase:n,fields:i,displayField:t}),l=jOt();return new KC({title:a,content:l,fieldInfos:o})}function Dqt(t){var l;const{title:e,graphic:i}=t??{},{attributes:r,sourceLayer:n}=i??{},s=n&&"displayField"in n?n.displayField:null,o=s?r==null?void 0:r[s]:null,a=(l=i==null?void 0:i.getObjectId())==null?void 0:l.toString();return e||o||a||""}const kOt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):pXe(t,e);function UOt({fields:t,ignoreFieldTypes:e,sortDisabled:i}){const r=t;return e&&(t=t.filter(n=>!e.includes(n.type))),t===r&&(t=t.slice()),i!==!0&&t.sort(zOt),t}function zOt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:j0e(t)?-1:j0e(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function VOt(t,e){const i=e==null?void 0:e.visibleFieldNames;return UOt({fields:t.fields??[],ignoreFieldTypes:(e==null?void 0:e.ignoreFieldTypes)||HOt,sortDisabled:e==null?void 0:e.sortDisabled}).map(r=>new CK({fieldName:r.name,isEditable:dXe(r,t),label:r.alias,format:BOt(r),visible:kOt(r,{...t,visibleFieldNames:i})}))}function BOt(t){switch(t.type){case"small-integer":case"integer":case"single":return new eF({digitSeparator:!0,places:0});case"double":return new eF({digitSeparator:!0,places:2});case"string":return NXe(t.name)?new eF({digitSeparator:!0,places:0}):void 0;default:return}}function jOt(){return[new lC,new aC]}function GOt(t){const e=iXe(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function j0e(t){var i;return(t.name&&t.name.toLowerCase())==="name"?!0:((i=t.alias)==null?void 0:i.toLowerCase())==="name"}const HOt=["geometry","blob","raster","guid","xml"],Oa="FeatureLayer";function lN(t,e){return new Y("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function G0e(t){return t&&t instanceof ot}const vH=ROt();function wH(t,e,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let $t=class extends Q$t(pOt(qMt(SOt(BMt($Pe(vOt(AOt(OPe($Ot(NMt(mOt(wOt(EQ(FMt(DMt(Or(kU))))))))))))))))){constructor(...t){super(...t),this.attributeTableTemplate=null,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=nt.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=cU(async(e,i,r)=>{const{save:n,saveAs:s}=await fe(()=>import("./featureLayerUtils-bkRiyVSd.js"),__vite__mapDeps([281,282,13]));switch(e){case $u.SAVE:return n(this,i);case $u.SAVE_AS:return s(this,r,i)}})}destroy(){var t;(t=this.source)==null||t.destroy()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){var r;const e=t!=null?t.signal:null;if((r=this.portalItem)!=null&&r.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(e).then(n=>this.initLayerProperties(n))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch(Pc).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const n=await this._fetchFirstValidLayerId(e);n!=null&&(this.layerId=n)}if(!this.url&&!this._hasMemorySource())throw new Y("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(e))}).then(()=>$$t(this,"load",t));return this.addResolvingPromise(i),Promise.resolve(this)}warnInvisibleDrapedSymbols(){var t,e,i;((t=this.elevationInfo)==null?void 0:t.mode)==="on-the-ground"&&((e=this.renderer)==null?void 0:e.type)==="simple"&&((i=this.renderer.symbol)==null?void 0:i.type)==="polygon-3d"&&this.renderer.symbol.symbolLayers.some(r=>r.type==="fill"&&r.material!=null&&(!r.material.color||r.material.color.a*this.opacity<fn)&&(this.loadWarnings.push(new Yp("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:this})),!0))}readCapabilities(t,e){return e=e.layerDefinition||e,CLe(e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var t;return!(this.loaded&&!((t=this.capabilities)!=null&&t.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,i){return this._readEditingEnabled(e,!0,i)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,i,r){this._writeEditingEnabled(t,e,!0,r)}get effectiveEditingEnabled(){return O$t(this)}readIsTable(t,e){return(e=(e==null?void 0:e.layerDefinition)??e).type==="Table"||!e.geometryType}writeIsTable(t,e,i,r){r!=null&&r.writeLayerSchema&&Uo(i,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return xLe(e.layerDefinition||e)}readObjectIdField(t,e){return SLe(e.layerDefinition||e)}get parsedUrl(){const t=_o(this.url);return t!=null&&(this.dynamicDataSource!=null?t.path=ld(t.path,"dynamicLayer"):this.layerId!=null&&(t.path=ld(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){pce(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){var n;e=e.layerDefinition||e;const r=(n=e.drawingInfo)==null?void 0:n.renderer;if(r){const s=T3(r,e,i)??void 0;return s||de.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),s}return Jie(e,i)}set source(t){const e=this._get("source");e!==t&&(G0e(e)&&this._resetMemorySource(e),G0e(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof ot?new qg({layer:this,items:t}):t:null}readSource(t,e){const i=hLe.fromJSON(e.featureSet);return new qg({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(t,e){const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,n=i==null?void 0:i.editorField;return t=t==null?void 0:t.map(s=>Kie.fromJSON(s)),this._fixTemplates(t,r),this._fixTemplates(t,n),t}readTitle(t,e){var n,s,o;const i=((n=e.layerDefinition)==null?void 0:n.name)??e.name,r=e.title||((s=e.layerDefinition)==null?void 0:s.title);if(i){const a=(o=this.portalItem)==null?void 0:o.title;if(this.sublayerTitleMode==="item-title")return this.url?Eje(this.url,i):i;let l=i;if(!l&&this.url){const c=qC(this.url);c!=null&&(l=c.title)}return l?(this.sublayerTitleMode==="item-title-and-service-name"&&a&&a!==l&&(l=a+" - "+l),AQ(l)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(t,e){var i;return e.title||((i=e.layerDefinition)==null?void 0:i.name)}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(n=>n.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(t,e){t=(e=e.layerDefinition||e).types;const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,n=i==null?void 0:i.editorField;return t==null?void 0:t.map(s=>(s=FLe.fromJSON(s),this._fixTemplates(s.templates,r),this._fixTemplates(s.templates,n),s))}readVisible(t,e){var i;return((i=e.layerDefinition)==null?void 0:i.defaultVisibility)!=null?!!e.layerDefinition.defaultVisibility:e.visibility!=null?!!e.visibility:void 0}async addAttachment(t,e){const i=await c$t(this,t,e,Oa);return this.lastEditsEventDate=new Date,i}async updateAttachment(t,e,i){const r=await u$t(this,t,e,i,Oa);return this.lastEditsEventDate=new Date,r}async applyEdits(t,e){return h$t(this,t,e)}async uploadAssets(t,e){return d$t(this,t,e)}on(t,e){return super.on(t,e)}createPopupTemplate(t){return FOt(this,t)}async createGraphicsSource(t){if(this._hasMemorySource()&&this.source)return this.source.load({signal:t});const{default:e}=await F_e(fe(()=>import("./FeatureLayerSource-UQ-co5lh.js"),__vite__mapDeps([283,145,146,142,279,31,32,41,36,42,284,285,55,53,54,99])),t);return new e({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:t})}createQuery(){const t=x$t(this);t.dynamicDataSource=this.dynamicDataSource;const e=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=zYe(this.definitionExpression,e);return t.where=i||"1=1",t}async deleteAttachments(t,e){const i=await p$t(this,t,e,Oa);return this.lastEditsEventDate=new Date,i}async fetchRecomputedExtents(t){return f$t(this,t,Oa)}getFeatureType(t){return I$t(this.types,this.typeIdField,t)}getFieldDomain(t,e){var a,l;const i=e==null?void 0:e.feature,r=!!((a=this.subtypes)!=null&&a.length);if(r&&!(e!=null&&e.excludeImpliedDomains)){const c=E$t(this,t);if(c)return c}const n=r&&T$t(this,i);if(n){const c=(l=n==null?void 0:n.domains)==null?void 0:l[t];return(c==null?void 0:c.type)==="inherited"?this._getLayerDomain(t):c}const s=this.getFeatureType(i),o=this._getLayerDomain(t);if(s){const c=s.domains&&s.domains[t];if(c&&(c==null?void 0:c.type)!=="inherited")return c}if(o)return o;if(!(e!=null&&e.excludeImpliedDomains)){const c=C$t(this,t);if(c)return c}return null}getField(t){return this.fieldsIndex.get(t)}async queryAttachments(t,e){return m$t(this,t,e,Oa)}async queryFeatures(t,e){const i=await this.load(),r=await i.source.queryFeatures(Ty.from(t)??i.createQuery(),e);if(r!=null&&r.features)for(const n of r.features)n.layer=n.sourceLayer=i;return r}async queryObjectIds(t,e){return g$t(this,t,e,Oa)}async queryFeatureCount(t,e){return y$t(this,t,e,Oa)}async queryExtent(t,e){return _$t(this,t,e,Oa)}async queryRelatedFeatures(t,e){return v$t(this,t,e,Oa)}async queryRelatedFeaturesCount(t,e){return w$t(this,t,e,Oa)}async queryTopFeatures(t,e){var o;const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!((o=r==null?void 0:r.query)!=null&&o.supportsTopFeaturesQuery))throw new Y(Oa,"Layer source does not support queryTopFeatures capability");const n=await fe(()=>import("./TopFeaturesQuery-CEsmYXrQ.js"),[]),s=await i.queryTopFeatures(n.default.from(t),e);if(s!=null&&s.features)for(const a of s.features)a.layer=a.sourceLayer=this;return s}async queryBins(t,e){var o;const{source:i,capabilities:r}=await this.load();if(!i.queryBins||!((o=r==null?void 0:r.operations)!=null&&o.supportsQueryBins))throw new Y(Oa,"Layer source does not support queryBins capability");L$t(t,r,Oa);const n=await fe(()=>import("./BinsQuery-9UL6YvvQ.js"),__vite__mapDeps([286,35,31,32,23])),s=await i.queryBins(n.default.from(t),e);if(s.features)for(const a of s.features)a.layer=a.sourceLayer=this;return s}async queryTopObjectIds(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!(r!=null&&r.query.supportsTopFeaturesQuery))throw new Y(Oa,"Layer source does not support queryTopObjectIds capability");const n=await fe(()=>import("./TopFeaturesQuery-CEsmYXrQ.js"),[]);return i.queryTopObjectIds(n.default.from(t),e)}async queryTopFeaturesExtent(t,e){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new Y(Oa,"Layer source does not support queryTopExtents capability");const n=await fe(()=>import("./TopFeaturesQuery-CEsmYXrQ.js"),[]);return i.queryTopExtents(n.default.from(t),e)}async queryTopFeatureCount(t,e){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new Y(Oa,"Layer source does not support queryFeatureCount capability");const n=await fe(()=>import("./TopFeaturesQuery-CEsmYXrQ.js"),[]);return i.queryTopCount(n.default.from(t),e)}read(t,e){const i=t.featureCollection;if((i||t.type==="Feature Collection")&&(this.resourceInfo=t),i){const r=i.layers;r&&r.length===1&&(super.read(r[0],e),i.showLegend!=null&&super.read({showLegend:i.showLegend},e))}super.read(t,e),e&&e.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:(e==null?void 0:e.origin)??void 0,writeLayerSchema:(e==null?void 0:e.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:n}=e;if(this.dynamicDataSource)return n==null||n.push(lN(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((i==="web-map"||i==="web-scene")&&r!=="tables")return n==null||n.push(lN(this,`a table source can only be written to tables, not ${r}`)),null;if(this._hasMemorySource())return n==null||n.push(lN(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(i==="web-map"||i==="web-scene")&&r==="tables")return n==null||n.push(lN(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new Y(Oa,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){var e;return!!this.loaded&&(((e=this.source)==null?void 0:e.type)==="memory"||DOt(this,t))}async save(t){return this._debouncedSaveOperations($u.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations($u.SAVE_AS,e,t)}_readEditingEnabled(t,e,i){var n;let r=(n=t.layerDefinition)==null?void 0:n.capabilities;return r?this._hasEditingCapability(r):(r=t.capabilities,e&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,i,r){var n,s;if(!t){const o=(s=(n=this.capabilities)==null?void 0:n.operations)!=null&&s.supportsSync?"Query,Sync":"Query";Uo("layerDefinition.capabilities",o,e),i&&!(r!=null&&r.writeLayerSchema)&&(e.capabilities=o)}}_getLayerDomain(t){const e=this.fieldsIndex.get(t);return e?e.domain:null}_fetchFirstValidLayerId(t){return Br(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const i=e.data;if(i)return this.findFirstValidLayerId(i)})}async initLayerProperties(t){var e;return this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(e=this.portalItem)==null?void 0:e.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),pce(this.renderer,this.fieldsIndex),C2e(this.timeInfo,this.fieldsIndex),NOt(this,{origin:"service"})}async hasDataChanged(){return b$t(this)}async fetchPublishingStatus(){const t=this.source;return t!=null&&t.fetchPublishingStatus?t.fetchPublishingStatus():"unavailable"}_verifyFields(){var e,i;const t=((e=this.parsedUrl)==null?void 0:e.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(r=>r.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(i=>{var n;const r=(n=i.prototype)==null?void 0:n.attributes;r&&e&&delete r[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new Y("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new Y("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};u([f(r$t)],$t.prototype,"attributeTableTemplate",void 0),u([Pe("service","capabilities")],$t.prototype,"readCapabilities",null),u([f({json:{origins:{"web-scene":{write:!1}},write:!0}})],$t.prototype,"charts",void 0),u([f({readOnly:!0})],$t.prototype,"createQueryVersion",null),u([f({json:{read:{source:"layerDefinition.copyrightText"}}})],$t.prototype,"copyright",void 0),u([f({json:{read:{source:"layerDefinition.displayField"}}})],$t.prototype,"displayField",void 0),u([f({types:K_,readOnly:!0})],$t.prototype,"defaultSymbol",void 0),u([f({type:gp})],$t.prototype,"dynamicDataSource",void 0),u([f({type:Boolean})],$t.prototype,"editingEnabled",null),u([Pe(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],$t.prototype,"readEditingEnabled",null),u([Pe("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],$t.prototype,"readEditingEnabledFromWebMap",null),u([ke(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],$t.prototype,"writeEditingEnabled",null),u([ke("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],$t.prototype,"writeEditingEnabledToWebMap",null),u([f({readOnly:!0})],$t.prototype,"effectiveEditingEnabled",null),u([f({...vH.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:wH}}}}})],$t.prototype,"fields",void 0),u([f(vH.fieldsIndex)],$t.prototype,"fieldsIndex",void 0),u([f({type:AMt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],$t.prototype,"formTemplate",void 0),u([f({json:{read:{source:"layerDefinition.extent"}}})],$t.prototype,"fullExtent",void 0),u([f({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:wH,writer(t,e,i){const r=t?JX.toJSON(t):null;r&&Uo(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:JX.read}}})],$t.prototype,"geometryType",void 0),u([f({json:{read:{source:"layerDefinition.hasM"}}})],$t.prototype,"hasM",void 0),u([f({json:{read:{source:"layerDefinition.hasZ"}}})],$t.prototype,"hasZ",void 0),u([f(e$t)],$t.prototype,"id",void 0),u([f({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],$t.prototype,"infoFor3D",void 0),u([f({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],$t.prototype,"isTable",void 0),u([Pe("service","isTable",["type","geometryType"]),Pe("isTable",["layerDefinition.type","layerDefinition.geometryType"])],$t.prototype,"readIsTable",null),u([ke("web-map","isTable")],$t.prototype,"writeIsTable",null),u([f(Zie)],$t.prototype,"labelsVisible",void 0),u([f({type:[RV],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:_H,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:_H,write:{enabled:!0,layerContainerTypes:wa}}},name:"layerDefinition.drawingInfo.labelingInfo",read:_H,write:!0}})],$t.prototype,"labelingInfo",void 0),u([f((()=>{const t=te(KMt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){Uo(r,z3(e),i)}}},t})())],$t.prototype,"opacity",void 0),u([f(JMt)],$t.prototype,"legendEnabled",void 0),u([f({type:["show","hide"],json:(()=>{const t=te(wLe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],$t.prototype,"listMode",void 0),u([Pe("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],$t.prototype,"readGlobalIdField",null),u([f({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:wH}}}}})],$t.prototype,"objectIdField",void 0),u([Pe("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],$t.prototype,"readObjectIdField",null),u([f({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],$t.prototype,"operationalLayerType",void 0),u([f(vH.outFields)],$t.prototype,"outFields",void 0),u([f({readOnly:!0})],$t.prototype,"parsedUrl",null),u([f({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],$t.prototype,"path",void 0),u([f(Wie)],$t.prototype,"popupEnabled",void 0),u([f({type:KC,json:{name:"popupInfo",write:!0}})],$t.prototype,"popupTemplate",void 0),u([f({readOnly:!0})],$t.prototype,"defaultPopupTemplate",null),u([f({types:OV,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:iMt,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:wa,overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],$t.prototype,"renderer",null),u([Pe("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Pe("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],$t.prototype,"readRenderer",null),u([f()],$t.prototype,"resourceInfo",void 0),u([f((()=>{const t=te(YMt);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],$t.prototype,"screenSizePerspectiveEnabled",void 0),u([f({clonable:!1})],$t.prototype,"source",null),u([$i("source")],$t.prototype,"castSource",null),u([Pe("portal-item","source",["featureSet"]),Pe("web-map","source",["featureSet"])],$t.prototype,"readSource",null),u([f({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],$t.prototype,"spatialReference",void 0),u([f({type:Number})],$t.prototype,"subtypeCode",void 0),u([f({type:[Kie]})],$t.prototype,"templates",void 0),u([Pe("templates",["editFieldsInfo","creatorField","editorField","templates"])],$t.prototype,"readTemplates",null),u([f({type:NLe})],$t.prototype,"timeInfo",void 0),u([f()],$t.prototype,"title",void 0),u([Pe("service","title",["name"]),Pe("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],$t.prototype,"readTitle",null),u([Pe("web-map","title",["layerDefinition.name","title"])],$t.prototype,"readTitleFromWebMap",null),u([f({type:String})],$t.prototype,"sublayerTitleMode",void 0),u([f({json:{read:!1}})],$t.prototype,"type",void 0),u([f({type:String})],$t.prototype,"typeIdField",void 0),u([Pe("service","typeIdField"),Pe("typeIdField",["layerDefinition.typeIdField"])],$t.prototype,"readTypeIdField",null),u([f({type:[FLe]})],$t.prototype,"types",void 0),u([Pe("service","types",["types"]),Pe("types",["layerDefinition.types"])],$t.prototype,"readTypes",null),u([f({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],$t.prototype,"visible",void 0),u([Pe("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],$t.prototype,"readVisible",null),$t=u([L("esri.layers.FeatureLayer")],$t);const kLe=$t,Nqt=Object.freeze(Object.defineProperty({__proto__:null,default:kLe},Symbol.toStringTag,{value:"Module"})),qOt=[{longitude:-117.33378013520932,latitude:33.95723222749059,z:50,value:70},{longitude:-117.3318970628486,latitude:33.95643416897167,z:50,value:70},{longitude:-117.33492192120501,latitude:33.95970269302978,z:50,value:70},{longitude:-117.33451206057174,latitude:33.9577574370671,z:50,value:70},{longitude:-117.33097719888478,latitude:33.95769290332852,z:100,value:70},{longitude:-117.33358627765415,latitude:33.958438514707765,z:50,value:70},{longitude:-117.32851431602376,latitude:33.95402116096069,z:50,value:70},{longitude:-117.3395341971058,latitude:33.956127539426916,z:50,value:70},{longitude:-117.33843696441456,latitude:33.96113573091817,z:50,value:70}],WOt={heatmapPoints:qOt},ZOt=t=>{const e=WOt.heatmapPoints.map(n=>new qc({geometry:new wt({longitude:n.longitude,latitude:n.latitude,z:n.z}),attributes:{value:n.value}})),i=new jie({field:"value",colorStops:[{ratio:0,color:"rgba(0, 255, 0, 0)"},{ratio:.5,color:"rgba(255, 255, 0, 0.8)"},{ratio:1,color:"rgba(255, 0, 0, 1)"}],radius:40,maxDensity:.1}),r=new kLe({source:e,fields:[{name:"value",type:"integer"}],objectIdField:"ObjectID",renderer:i,elevationInfo:{mode:"relative-to-ground"}});t.add(r)};function YOt(){const[t,e]=Z0.useState(null),[i,r]=Z0.useState(null),[n,s]=Z0.useState([]),[o,a]=Z0.useState(null),[l,c]=Z0.useState(0),[h,p]=Z0.useState(0);Z0.useEffect(()=>{const w=document.getElementById("viewDiv"),b=new f8e({basemap:"streets-night-vector",ground:{surfaceColor:"white"}}),x=new N2t({container:w,map:b,center:[-117.33378013520932,33.95723222749059],zoom:18,popupEnabled:!1,ui:{components:["zoom"]}});x.ui.remove("attribution"),x.ui.move("zoom","top-right");const T=new cEt;return b.add(T),e(T),ZOt(b),x.on("click",M=>{x.hitTest(M).then($=>{const R=$.results.filter(I=>"graphic"in I);if(R.length>0){const I=R[0].graphic;I&&a({name:I.getAttribute("name"),age:I.getAttribute("age"),company:I.getAttribute("company"),jobId:I.getAttribute("jobId")})}else a(null)})}),()=>{x.destroy()}},[]);const g=()=>{if(t)if(i)t.remove(i),r(null),p(w=>w-1);else{const w=pEt(t);r(w),p(b=>b+1)}},y=()=>{if(t)if(n.length>0)n.forEach(w=>t.remove(w)),s([]),c(0);else{const w=gEt(t);s(w),c(w.length)}};return hn.jsxs(hn.Fragment,{children:[hn.jsx("div",{id:"viewDiv",style:{height:"100vh",width:"100%"}}),hn.jsx(uEt,{selectedPoint:o}),hn.jsx(hEt,{totalWorkers:l,totalBuildings:h}),hn.jsx(dEt,{toggleBuilding:g,togglePoints:y,hasBuilding:!!i,hasPoints:n.length>0})]})}ENe.createRoot(document.getElementById("root")).render(hn.jsx(Z0.StrictMode,{children:hn.jsx(YOt,{})}));const XOt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:zK,build:WEe,cubeMapSize:uE},Symbol.toStringTag,{value:"Module"})),JOt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:jK,build:sCe},Symbol.toStringTag,{value:"Module"})),QOt=Object.freeze(Object.defineProperty({__proto__:null,build:dCe},Symbol.toStringTag,{value:"Module"})),KOt=Object.freeze(Object.defineProperty({__proto__:null,build:Y$e,calculateAnchorPosForRendering:u3,shaderSettings:Gee},Symbol.toStringTag,{value:"Module"})),eAt=Object.freeze(Object.defineProperty({__proto__:null,build:XOe},Symbol.toStringTag,{value:"Module"})),tAt=Object.freeze(Object.defineProperty({__proto__:null,build:JOe,getRadius:nV},Symbol.toStringTag,{value:"Module"})),iAt=Object.freeze(Object.defineProperty({__proto__:null,build:rAe},Symbol.toStringTag,{value:"Module"})),rAt=Object.freeze(Object.defineProperty({__proto__:null,build:sAe},Symbol.toStringTag,{value:"Module"})),nAt=Object.freeze(Object.defineProperty({__proto__:null,build:gAe},Symbol.toStringTag,{value:"Module"})),sAt=Object.freeze(Object.defineProperty({__proto__:null,build:qRe},Symbol.toStringTag,{value:"Module"})),oAt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Gte,blurSize:Hte,build:HRe,gridCellPixelSize:nv,outlineSize:y3},Symbol.toStringTag,{value:"Module"})),aAt=Object.freeze(Object.defineProperty({__proto__:null,build:WRe},Symbol.toStringTag,{value:"Module"})),lAt=Object.freeze(Object.defineProperty({__proto__:null,build:ZRe},Symbol.toStringTag,{value:"Module"})),cAt=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:qte,build:YRe},Symbol.toStringTag,{value:"Module"})),uAt=Object.freeze(Object.defineProperty({__proto__:null,build:a3e,ribbonlineNumRoundJoinSubdivisions:v3},Symbol.toStringTag,{value:"Module"})),hAt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:jte,build:GRe},Symbol.toStringTag,{value:"Module"})),dAt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Jte,build:h3e},Symbol.toStringTag,{value:"Module"})),pAt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Kte,build:y3e},Symbol.toStringTag,{value:"Module"})),fAt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Ly},build:U3e},Symbol.toStringTag,{value:"Module"})),mAt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Z3e,ColorizerStretchUniforms:W3e,ColorizerUniforms:yV,build:Y3e},Symbol.toStringTag,{value:"Module"})),gAt=Object.freeze(Object.defineProperty({__proto__:null,build:dIe},Symbol.toStringTag,{value:"Module"})),yAt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:mie,build:fIe},Symbol.toStringTag,{value:"Module"})),_At=Object.freeze(Object.defineProperty({__proto__:null,build:mIe},Symbol.toStringTag,{value:"Module"})),vAt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:gie,build:gIe},Symbol.toStringTag,{value:"Module"})),wAt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:_ie,SimpleAtmospherePassParameters:vV,build:yIe},Symbol.toStringTag,{value:"Module"})),bAt=Object.freeze(Object.defineProperty({__proto__:null,build:MIe},Symbol.toStringTag,{value:"Module"})),xAt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:wV,build:RIe},Symbol.toStringTag,{value:"Module"})),SAt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:xie,build:PIe},Symbol.toStringTag,{value:"Module"})),TAt=Object.freeze(Object.defineProperty({__proto__:null,build:LIe},Symbol.toStringTag,{value:"Module"})),EAt=Object.freeze(Object.defineProperty({__proto__:null,build:NIe},Symbol.toStringTag,{value:"Module"})),CAt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:Tie,build:FIe},Symbol.toStringTag,{value:"Module"})),MAt=Object.freeze(Object.defineProperty({__proto__:null,build:kIe},Symbol.toStringTag,{value:"Module"})),$At=Object.freeze(Object.defineProperty({__proto__:null,build:UIe},Symbol.toStringTag,{value:"Module"})),OAt=Object.freeze(Object.defineProperty({__proto__:null,build:zIe},Symbol.toStringTag,{value:"Module"})),AAt=Object.freeze(Object.defineProperty({__proto__:null,build:VIe},Symbol.toStringTag,{value:"Module"})),RAt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Eie,build:jIe},Symbol.toStringTag,{value:"Module"})),IAt=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:Cie,build:ZIe},Symbol.toStringTag,{value:"Module"})),PAt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Mie,build:sPe},Symbol.toStringTag,{value:"Module"})),LAt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:EI,build:nPe},Symbol.toStringTag,{value:"Module"}));export{mt as $,Kl as A,Azt as A$,nct as A0,Nkt as A1,Sh as A2,Xut as A3,Zut as A4,_p as A5,SG as A6,vkt as A7,f5t as A8,rkt as A9,xm as AA,eo as AB,vKe as AC,Aj as AD,hue as AE,NOe as AF,Dlt as AG,Nlt as AH,Rlt as AI,cJe as AJ,cPt as AK,ox as AL,l3 as AM,ikt as AN,Sdt as AO,N2 as AP,XZ as AQ,dft as AR,gEe as AS,DJe as AT,Izt as AU,ydt as AV,Rzt as AW,Udt as AX,vdt as AY,Llt as AZ,Ozt as A_,J5t as Aa,Ekt as Ab,Pct as Ac,ode as Ad,C5 as Ae,Flt as Af,X8e as Ag,_3t as Ah,JWe as Ai,hG as Aj,Bot as Ak,Kz as Al,yd as Am,yte as An,tV as Ao,x_t as Ap,dte as Aq,pte as Ar,ate as As,wC as At,sV as Au,Oct as Av,oV as Aw,vC as Ax,Iy as Ay,Ut as Az,yBt as B,gdt as B0,o6t as B1,QOe as B2,Zyt as B3,Om as B4,U_e as B5,KE as B6,dIt as B7,fIt as B8,f7t as B9,Tqt as Ba,Nqt as Bb,yv as C,RJ as D,oe as E,xi as F,vm as G,pe as H,pY as I,tf as J,j9t as K,qc as L,ryt as M,hi as N,xUe as O,Si as P,Ny as Q,jc as R,EQ as S,qC as T,Br as U,ot as V,vb as W,va as X,Gi as Y,Ix as Z,fe as _,L as a,o2t as a$,td as a0,FK as a1,fEe as a2,LJe as a3,Ox as a4,tM as a5,Bt as a6,j2 as a7,WCt as a8,Bn as a9,pGe as aA,AIt as aB,Qr as aC,rU as aD,iU as aE,W3 as aF,FU as aG,L3 as aH,qt as aI,D2e as aJ,wLt as aK,bLt as aL,Z3t as aM,V6e as aN,J3t as aO,X3t as aP,Tv as aQ,Y3t as aR,hLe as aS,uGe as aT,Bo as aU,bb as aV,xl as aW,Ije as aX,kE as aY,yIt as aZ,VBt as a_,Oat as aa,Ui as ab,Ty as ac,mkt as ad,Szt as ae,VEt as af,yLt as ag,TK as ah,bC as ai,sf as aj,mi as ak,xH as al,e_e as am,Mz as an,ai as ao,pr as ap,Vc as aq,jAt as ar,wt as as,OU as at,kC as au,nt as av,QN as aw,Jse as ax,j8e as ay,eU as az,Ne as b,Aae as b$,G9t as b0,Vte as b1,ki as b2,Rqt as b3,D3 as b4,ns as b5,Vo as b6,Ni as b7,k3 as b8,Zc as b9,ld as bA,RRt as bB,_5e as bC,u3t as bD,hU as bE,ym as bF,ev as bG,A as bH,FR as bI,Vyt as bJ,Qe as bK,r8 as bL,En as bM,c6t as bN,u6t as bO,F5 as bP,Bpe as bQ,mze as bR,Yl as bS,ut as bT,j1e as bU,vd as bV,$i as bW,rke as bX,cy as bY,qUt as bZ,H7t as b_,k as ba,qz as bb,Rct as bc,Yp as bd,Y5e as be,_t as bf,we as bg,ke as bh,wje as bi,te as bj,Pk as bk,DSe as bl,Ri as bm,eve as bn,sU as bo,qJ as bp,U3 as bq,RR as br,Y6e as bs,W_ as bt,Fu as bu,oUe as bv,AE as bw,aUe as bx,PLe as by,jU as bz,Lk as c,i5 as c$,MXe as c0,Dv as c1,qb as c2,q7t as c3,sr as c4,FUe as c5,X5t as c6,Qee as c7,Xl as c8,Pr as c9,aa as cA,NTe as cB,U_ as cC,dLt as cD,DXe as cE,H9t as cF,vFt as cG,s3 as cH,wFt as cI,fd as cJ,tc as cK,ix as cL,Ot as cM,Me as cN,ve as cO,NR as cP,xt as cQ,jMt as cR,HC as cS,WE as cT,Hv as cU,Ql as cV,Xbe as cW,ZH as cX,Qn as cY,WH as cZ,XH as c_,bd as ca,Bv as cb,QLt as cc,dzt as cd,Zi as ce,xs as cf,lv as cg,wy as ch,zYe as ci,_Pt as cj,W4 as ck,bm as cl,pQ as cm,dQ as cn,Ewe as co,AU as cp,B3t as cq,Jze as cr,CYe as cs,Fb as ct,pv as cu,ey as cv,i_ as cw,DTe as cx,WWe as cy,Yt as cz,mOt as d,Sx as d$,wUe as d0,Kee as d1,rc as d2,Fo as d3,Ji as d4,WU as d5,ct as d6,PK as d7,xr as d8,Q6e as d9,fPt as dA,Pv as dB,on as dC,pz as dD,Uy as dE,Dr as dF,wSe as dG,Qs as dH,Ob as dI,ed as dJ,qU as dK,$0t as dL,K1t as dM,Akt as dN,GN as dO,DWe as dP,od as dQ,HPt as dR,jPt as dS,GPt as dT,rjt as dU,tPt as dV,Nr as dW,ws as dX,et as dY,rQ as dZ,L1e as d_,zu as da,ln as db,lZe as dc,dU as dd,pd as de,Go as df,zs as dg,Mp as dh,$3t as di,QIt as dj,bee as dk,ZC as dl,SVt as dm,ds as dn,Jbe as dp,Fe as dq,ye as dr,dn as ds,Ae as dt,lPt as du,tC as dv,rPt as dw,Te as dx,ue as dy,xe as dz,Y as e,szt as e$,nr as e0,Us as e1,zVt as e2,BVt as e3,VVt as e4,xVt as e5,Wt as e6,P3 as e7,XNe as e8,UU as e9,xLt as eA,N3 as eB,wv as eC,BMe as eD,Znt as eE,o4t as eF,nnt as eG,a4t as eH,r4t as eI,fnt as eJ,_It as eK,NOt as eL,fxe as eM,fet as eN,NNt as eO,Sd as eP,Slt as eQ,Qve as eR,YPe as eS,PQ as eT,mXe as eU,vLt as eV,sdt as eW,odt as eX,fQ as eY,LAe as eZ,ozt as e_,Hl as ea,Zb as eb,CU as ec,Tje as ed,PRt as ee,_o as ef,p3t as eg,Dae as eh,bH as ei,wIt as ej,Nje as ek,j9 as el,Vae as em,f3t as en,Dje as eo,zae as ep,oGe as eq,XEt as er,JEt as es,QEt as et,_qt as eu,yqt as ev,Ho as ew,TUe as ex,RE as ey,CIt as ez,Pc as f,Vje as f$,KYe as f0,EK as f1,$Xe as f2,TLt as f3,L2e as f4,SLt as f5,Rp as f6,VUe as f7,Iu as f8,v6 as f9,Vq as fA,iqt as fB,tqt as fC,yy as fD,hJ as fE,cGe as fF,hGe as fG,cRt as fH,Or as fI,$Pe as fJ,$Ot as fK,OPe as fL,e$t as fM,JMt as fN,Ya as fO,Wu as fP,K3 as fQ,Lm as fR,H6e as fS,G6e as fT,qze as fU,cU as fV,Uoe as fW,MIt as fX,DJ as fY,$u as fZ,bl as f_,azt as fa,Bht as fb,K$ as fc,xTe as fd,io as fe,_W as ff,dv as fg,Ac as fh,Dc as fi,ZAt as fj,$ve as fk,OE as fl,$J as fm,YNe as fn,H3 as fo,Twe as fp,mIt as fq,vr as fr,JCt as fs,NC as ft,p5e as fu,QCt as fv,eqt as fw,_7t as fx,xce as fy,XA as fz,CR as g,_a as g$,FMt as g0,DMt as g1,vo as g2,Mt as g3,t1e as g4,$xe as g5,Oxe as g6,AVt as g7,MVt as g8,OVt as g9,iDt as gA,yze as gB,Zr as gC,tZe as gD,J8e as gE,Frt as gF,Vz as gG,Ev as gH,ORt as gI,NRt as gJ,S0e as gK,jv as gL,qu as gM,iO as gN,DA as gO,rGe as gP,CVt as gQ,F_e as gR,CFe as gS,wR as gT,bR as gU,Va as gV,Uc as gW,$kt as gX,$U as gY,IJ as gZ,Cn as g_,QMt as ga,N4 as gb,AOt as gc,yPt as gd,woe as ge,ja as gf,DOt as gg,f5 as gh,Wi as gi,kLe as gj,Q2 as gk,pje as gl,wb as gm,x9 as gn,Uo as go,cEt as gp,Sp as gq,axe as gr,AC as gs,i4t as gt,n4t as gu,s4t as gv,Sv as gw,NAt as gx,fCt as gy,WLt as gz,hv as h,pkt as h$,xv as h0,On as h1,Nte as h2,Tr as h3,Xp as h4,cs as h5,w9 as h6,X3 as h7,Ect as h8,cJ as h9,m2 as hA,_U as hB,gN as hC,V9 as hD,H3t as hE,F3 as hF,GU as hG,wl as hH,AR as hI,mSe as hJ,BLt as hK,VLt as hL,aQ as hM,Fv as hN,Az as hO,_Se as hP,wIe as hQ,w3t as hR,xIe as hS,qv as hT,Zl as hU,r9 as hV,r5 as hW,LC as hX,DC as hY,In as hZ,tte as h_,uJ as ha,kAt as hb,FAt as hc,jkt as hd,Vs as he,Tct as hf,aVe as hg,pWe as hh,R9e as hi,wqt as hj,D9 as hk,wm as hl,FOt as hm,APe as hn,iMt as ho,Wie as hp,KC as hq,ROt as hr,$Q as hs,sje as ht,An as hu,ne as hv,cO as hw,xb as hx,Ii as hy,B6 as hz,zt as i,WUt as i$,Js as i0,ps as i1,Uwt as i2,fs as i3,_Ie as i4,v3t as i5,xoe as i6,ec as i7,Iv as i8,mU as i9,No as iA,hPt as iB,Q5t as iC,Lrt as iD,Sr as iE,yje as iF,jA as iG,LRt as iH,$$t as iI,RMt as iJ,gqt as iK,UMt as iL,mqt as iM,kMt as iN,mJ as iO,is as iP,UC as iQ,nyt as iR,XPt as iS,nU as iT,_Ye as iU,Yoe as iV,XUt as iW,qbe as iX,Vht as iY,Ode as iZ,x3t as i_,gPt as ia,akt as ib,okt as ic,vVt as id,E5 as ie,Jee as ig,VZ as ih,aOe as ii,wx as ij,KU as ik,zHe as il,QU as im,lwe as io,lIt as ip,uIt as iq,cIt as ir,B7 as is,EVt as it,R1e as iu,Oe as iv,Drt as iw,t3t as ix,bp as iy,OHe as iz,wOt as j,o3 as j$,rd as j0,bY as j1,xY as j2,Pn as j3,kp as j4,ePt as j5,z9e as j6,q5t as j7,Ub as j8,mRe as j9,f5e as jA,_m as jB,nd as jC,T3 as jD,Jie as jE,i$t as jF,t$t as jG,Ybe as jH,lU as jI,KMt as jJ,Q4 as jK,ipe as jL,_Ue as jM,s2t as jN,d3t as jO,S3t as jP,S_e as jQ,V5 as jR,to as jS,Tmt as jT,Yie as jU,F9t as jV,aft as jW,z7t as jX,QPe as jY,Vu as jZ,FNe as j_,Eje as ja,AQ as jb,Mje as jc,$je as jd,nGe as je,Hb as jf,vOt as jg,pOt as jh,qMt as ji,pce as jj,C2e as jk,r$t as jl,Zie as jm,RV as jn,_H as jo,ZX as jp,OV as jq,YMt as jr,Kie as js,cC as jt,HLt as ju,dRe as jv,Hke as jw,Joe as jx,FLe as jy,yb as jz,Pe as k,t7e as k$,NFe as k0,C7t as k1,$7t as k2,M7t as k3,O7t as k4,E7t as k5,uDt as k6,kR as k7,Nu as k8,$It as k9,ny as kA,O3t as kB,Fke as kC,DE as kD,KUt as kE,Cmt as kF,hz as kG,Dy as kH,FTe as kI,Ip as kJ,br as kK,sPt as kL,pSe as kM,Uk as kN,oRe as kO,yOe as kP,__e as kQ,y5 as kR,nM as kS,Ie as kT,gr as kU,Lp as kV,wn as kW,Rbe as kX,oi as kY,mo as kZ,rgt as k_,dGe as ka,rzt as kb,Tlt as kc,aRt as kd,EEt as ke,Jut as kf,_kt as kg,FGe as kh,ic as ki,an as kj,vte as kk,Z5t as kl,Lb as km,SOe as kn,jLt as ko,YLt as kp,ajt as kq,lAe as kr,Zkt as ks,wkt as kt,px as ku,TOe as kv,iQ as kw,fOe as kx,GZe as ky,vRt as kz,NMt as l,O$t as l$,B5 as l0,Jn as l1,pK as l2,DVt as l3,uht as l4,hht as l5,Hxe as l6,$gt as l7,xBt as l8,Cgt as l9,mr as lA,ud as lB,Cq as lC,G3t as lD,K2e as lE,KLt as lF,GAt as lG,vIt as lH,CLe as lI,yJ as lJ,OT as lK,l$t as lL,Lqt as lM,N$t as lN,F$t as lO,gp as lP,IC as lQ,Zy as lR,Gie as lS,ZPe as lT,a8t as lU,x$t as lV,E$t as lW,ZMt as lX,HPe as lY,GPe as lZ,jPe as l_,Jkt as la,IOe as lb,Ks as lc,Ykt as ld,Yxe as le,dC as lf,Act as lg,sx as lh,Wc as li,eee as lj,bIe as lk,fCe as ll,vie as lm,gCe as ln,Exe as lo,yF as lp,LLe as lq,AMt as lr,fM as ls,Q$t as lt,BMt as lu,h$t as lv,I$t as lw,b$t as lx,_ve as ly,Eve as lz,f as m,Ov as m$,c$t as m0,u$t as m1,p$t as m2,f$t as m3,T$t as m4,m$t as m5,g$t as m6,y$t as m7,_$t as m8,v$t as m9,G8t as mA,iI as mB,ljt as mC,xCe as mD,tee as mE,KK as mF,$V as mG,zC as mH,Gu as mI,lQ as mJ,P6 as mK,rEe as mL,g5 as mM,oje as mN,aje as mO,kae as mP,iyt as mQ,qa as mR,jr as mS,gt as mT,kt as mU,Mi as mV,fr as mW,Jb as mX,Ht as mY,yV as mZ,a2t as m_,w$t as ma,NLe as mb,Ba as mc,gIt as md,G4e as me,Zw as mf,i7e as mg,qGe as mh,ur as mi,Qz as mj,FVt as mk,Z9t as ml,Y9t as mm,w2t as mn,e1e as mo,YC as mp,vx as mq,hd as mr,fze as ms,W8e as mt,V8t as mu,ts as mv,Lbt as mw,Dot as mx,Ys as my,fn as mz,Gv as n,cwe as n$,am as n0,VAt as n1,BAt as n2,zAt as n3,pI as n4,q_ as n5,aue as n6,dkt as n7,Fwt as n8,vIe as n9,jQ as nA,cze as nB,hs as nC,Ga as nD,_x as nE,cN as nF,B_e as nG,mRt as nH,fRt as nI,czt as nJ,lzt as nK,BFe as nL,VFe as nM,s_e as nN,NNe as nO,k3t as nP,D as nQ,YRt as nR,c4t as nS,l4t as nT,t4t as nU,Av as nV,C7 as nW,RHe as nX,WQ as nY,rf as nZ,iFt as n_,zwt as na,jwt as nb,kwt as nc,Bwt as nd,k_e as ne,uRt as nf,tx as ng,N9t as nh,QWe as ni,Po as nj,Z5e as nk,s$t as nl,Xje as nm,_Lt as nn,mLt as no,Xse as np,Wv as nq,O3 as nr,ju as ns,Bf as nt,bx as nu,yFt as nv,by as nw,us as nx,XQ as ny,dd as nz,Qoe as o,ree as o$,FQ as o0,jo as o1,nx as o2,Nve as o3,i3t as o4,n5 as o5,e3t as o6,vke as o7,Fx as o8,FFt as o9,Cv as oA,q6e as oB,Nrt as oC,jh as oD,QUt as oE,iOe as oF,GMt as oG,pLt as oH,fLt as oI,gLt as oJ,Jl as oK,ELt as oL,zht as oM,SSe as oN,p9e as oO,QGe as oP,uze as oQ,Hi as oR,Rm as oS,Cve as oT,jxe as oU,uK as oV,Lu as oW,yCe as oX,mCe as oY,Iz as oZ,QK as o_,GFt as oa,qFt as ob,ZFt as oc,XFt as od,Urt as oe,Bz as of,HFt as og,WFt as oh,QFt as oi,YFt as oj,JFt as ok,KFt as ol,gC as om,cI as on,Nee as oo,ya as op,f2t as oq,lqe as or,kNe as os,SJ as ot,ARt as ou,OC as ov,Z4e as ow,fU as ox,DRt as oy,Lv as oz,kU as p,K_ as p$,KR as p0,kTe as p1,ks as p2,y3t as p3,tQ as p4,q3t as p5,IRt as p6,N_e as p7,HXe as p8,ZE as p9,zv as pA,Ove as pB,$Rt as pC,Kve as pD,coe as pE,y1e as pF,x7t as pG,mCt as pH,b3t as pI,ME as pJ,GLt as pK,CJ as pL,Wy as pM,hkt as pN,gze as pO,F1e as pP,UGe as pQ,a6t as pR,UQ as pS,sEe as pT,Elt as pU,l6t as pV,b_e as pW,FRt as pX,Mqt as pY,zie as pZ,MEt as p_,R$t as pa,$Vt as pb,vv as pc,L0e as pd,FE as pe,OOt as pf,Emt as pg,i8t as ph,VQ as pi,Ckt as pj,QE as pk,Iat as pl,Za as pm,N6e as pn,sQe as po,rQe as pp,nQe as pq,bK as pr,Rv as ps,rqt as pt,oEt as pu,aEt as pv,HMt as pw,tOt as px,_Ot as py,u_e as pz,HBt as q,qVt as q$,JE as q0,pPt as q1,$mt as q2,R5 as q3,Na as q4,xmt as q5,z3t as q6,U3t as q7,e8t as q8,o8t as q9,Bke as qA,Yke as qB,PAe as qC,jJ as qD,s3t as qE,A3 as qF,wz as qG,kc as qH,H2e as qI,bqt as qJ,Gqe as qK,q8e as qL,Lqe as qM,aT as qN,sT as qO,uCt as qP,fdt as qQ,Eht as qR,Sht as qS,eKe as qT,OUt as qU,$Ut as qV,Sy as qW,JGe as qX,gzt as qY,go as qZ,ga as q_,Ice as qa,Ace as qb,bVt as qc,TVt as qd,Rkt as qe,Ikt as qf,Rce as qg,D1e as qh,Klt as qi,r8t as qj,fie as qk,zE as ql,Okt as qm,sde as qn,t8t as qo,pzt as qp,nzt as qq,AAe as qr,IAe as qs,$Ae as qt,$de as qu,hzt as qv,HUt as qw,xwe as qx,eVe as qy,L3t as qz,u as r,hIt as r$,c3e as r0,vz as r1,Uh as r2,iN as r3,izt as r4,Uae as r5,YUt as r6,xlt as r7,Sz as r8,y7t as r9,$Te as rA,nm as rB,G9 as rC,sgt as rD,Ope as rE,o$t as rF,n_e as rG,aJ as rH,KRt as rI,QRt as rJ,qUe as rK,S0t as rL,Jp as rM,dJ as rN,CDt as rO,uM as rP,mSt as rQ,_3 as rR,g1e as rS,w1e as rT,m_e as rU,PNe as rV,Jle as rW,PVt as rX,Fte as rY,bD as rZ,BAe as r_,Px as ra,mdt as rb,uRe as rc,aY as rd,jpt as re,kve as rf,LSe as rg,Kb as rh,V9e as ri,Xkt as rj,GRt as rk,R3 as rl,lRt as rm,HR as rn,Ti as ro,$R as rp,Mv as rq,skt as rr,OTe as rs,W5t as rt,STe as ru,ua as rv,aHe as rw,Xb as rx,J_ as ry,O9e as rz,mQ as s,Qlt as s$,Tkt as s0,_n as s1,Q3 as s2,qh as s3,kPe as s4,UPe as s5,gkt as s6,uy as s7,nf as s8,cGt as s9,CY as sA,lGt as sB,uGt as sC,Kjt as sD,tGt as sE,kfe as sF,Avt as sG,Cje as sH,WAt as sI,Qke as sJ,ZRt as sK,Z8e as sL,Ha as sM,fz as sN,YU as sO,Qb as sP,qQ as sQ,uv as sR,A5 as sS,DHe as sT,uPt as sU,rZe as sV,P3t as sW,gI as sX,Gc as sY,ift as sZ,cOe as s_,KGt as sa,SI as sb,dwt as sc,Hg as sd,Ffe as se,fGt as sf,hGt as sg,dGt as sh,pGt as si,EY as sj,qd as sk,Ep as sl,Da as sm,sGt as sn,Jjt as so,hie as sp,Hk as sq,rGt as sr,oGt as ss,j3e as st,nGt as su,wY as sv,Ic as sw,MY as sx,Gk as sy,$Y as sz,Lr as t,ame as t$,nlt as t0,tDt as t1,ykt as t2,hDt as t3,dDt as t4,pDt as t5,Vp as t6,sze as t7,uz as t8,Q3t as t9,UTe as tA,$E as tB,rte as tC,bs as tD,Vn as tE,rI as tF,gGt as tG,a1t as tH,Nvt as tI,ZQ as tJ,jR as tK,YQ as tL,ez as tM,jk as tN,Gjt as tO,Rvt as tP,m3t as tQ,j_ as tR,hAe as tS,tm as tT,B_ as tU,ei as tV,Eyt as tW,Cyt as tX,hwt as tY,s9 as tZ,A3t as t_,DQ as ta,pM as tb,Lie as tc,wEt as td,bEt as te,CV as tf,LPe as tg,BEt as th,zPe as ti,Jk as tj,SRt as tk,RPe as tl,yR as tm,TPt as tn,fRe as to,K3t as tp,sZe as tq,dPt as tr,MHe as ts,w5 as tt,uSe as tu,D9e as tv,cd as tw,UE as tx,M9e as ty,nK as tz,Ye as u,p2t as u$,ime as u0,Yze as u1,rme as u2,rwe as u3,$Ct as u4,vme as u5,nme as u6,j3t as u7,ume as u8,Mme as u9,Gfe as uA,Hfe as uB,qfe as uC,hme as uD,kme as uE,Vme as uF,Kfe as uG,bz as uH,R7t as uI,I7t as uJ,Cke as uK,Eke as uL,r3t as uM,a4e as uN,NXe as uO,HIt as uP,gm as uQ,xPt as uR,bPt as uS,e4t as uT,rqe as uU,iqe as uV,CK as uW,C4 as uX,Kk as uY,UXe as uZ,PQe as u_,Bfe as ua,$me as ub,Ome as uc,dVe as ud,D3t as ue,R3t as uf,Ame as ug,N3t as uh,rDt as ui,A7t as uj,U7t as uk,_me as ul,xme as um,N7t as un,D7t as uo,tRe as up,F7t as uq,k7t as ur,Wye as us,Zye as ut,Yye as uu,P7t as uv,L7t as uw,S7t as ux,Ume as uy,Qfe as uz,Qp as v,aGt as v$,kXe as v0,ZR as v1,XR as v2,lC as v3,HAt as v4,h4t as v5,Dqt as v6,Sm as v7,AK as v8,WXe as v9,E3t as vA,VFt as vB,zFt as vC,BFt as vD,u1e as vE,jFt as vF,H_e as vG,vmt as vH,_mt as vI,KNe as vJ,XAt as vK,wmt as vL,JLt as vM,MU as vN,bmt as vO,UFt as vP,kQ as vQ,ect as vR,n9e as vS,VE as vT,iz as vU,GWe as vV,HWe as vW,kFt as vX,wVt as vY,g7t as vZ,BIt as v_,ZXe as va,Nle as vb,O2t as vc,B9t as vd,kFe as ve,f9 as vf,RY as vg,_ke as vh,uJe as vi,qve as vj,Hve as vk,KH as vl,qIt as vm,c1e as vn,yke as vo,qqe as vp,Pqe as vq,I3t as vr,Qze as vs,NFt as vt,DMe as vu,fke as vv,XRt as vw,JRt as vx,FFe as vy,m2t as vz,wK as w,Ar as w$,Fi as w0,St as w1,hTt as w2,DAt as w3,V7t as w4,wRt as w5,zfe as w6,Jht as w7,kG as w8,UG as w9,qi as wA,Pi as wB,iM as wC,qot as wD,ZEe as wE,Wee as wF,Q$e as wG,Zz as wH,Qi as wI,Sk as wJ,GZ as wK,hte as wL,Zot as wM,le as wN,Ry as wO,ko as wP,Pz as wQ,rM as wR,Wot as wS,D$e as wT,Gct as wU,Oz as wV,Rot as wW,Aot as wX,ZLt as wY,pJe as wZ,dOe as w_,kJ as wa,mJe as wb,Wb as wc,fzt as wd,YYe as we,Fat as wf,Zat as wg,Lse as wh,uzt as wi,E8e as wj,X7t as wk,Y7t as wl,or as wm,sy as wn,tv as wo,hI as wp,lm as wq,jee as wr,aV as ws,C as wt,ht as wu,rt as wv,aM as ww,J as wx,hr as wy,ar as wz,zo as x,yTe as x$,eDt as x0,M5t as x1,O$e as x2,Bs as x3,fte as x4,rs as x5,Uu as x6,t1 as x7,dI as x8,tI as x9,mk as xA,uI as xB,hR as xC,s3e as xD,I6t as xE,gd as xF,cde as xG,Qct as xH,Zct as xI,Jct as xJ,Wct as xK,pc as xL,jNt as xM,hx as xN,jot as xO,iV as xP,Pb as xQ,BNt as xR,wet as xS,_d as xT,Jr as xU,H5t as xV,rSe as xW,C3t as xX,iPt as xY,Im as xZ,MQ as x_,Fa as xa,Lz as xb,fJe as xc,dJe as xd,km as xe,md as xf,RVt as xg,gVt as xh,tY as xi,Ez as xj,ub as xk,fSe as xl,oPt as xm,aPt as xn,nPt as xo,Yr as xp,Hee as xq,zee as xr,gke as xs,mke as xt,VJ as xu,UJ as xv,g3t as xw,ux as xx,d0t as xy,E0t as xz,XMt as y,tzt as y$,Uv as y0,fi as y1,qee as y2,Lot as y3,Vee as y4,XLt as y5,s8t as y6,JR as y7,n8t as y8,JZe as y9,Mm as yA,Xh as yB,Ay as yC,Hy as yD,ii as yE,Gt as yF,Hct as yG,qct as yH,xd as yI,_C as yJ,HOe as yK,Wkt as yL,$m as yM,qkt as yN,Mn as yO,e1 as yP,Cy as yQ,OIe as yR,Zbt as yS,lde as yT,_ct as yU,ezt as yV,fkt as yW,V3t as yX,r_e as yY,gjt as yZ,F3t as y_,fK as ya,Sge as yb,M3t as yc,Pit as yd,JQ as ye,dSe as yf,_9e as yg,rHe as yh,Axe as yi,hze as yj,Eze as yk,tz as yl,Bpt as ym,Vr as yn,Ro as yo,Xi as yp,my as yq,FC as yr,rV as ys,xa as yt,Jot as yu,oxt as yv,qy as yw,GOe as yx,fI as yy,Cut as yz,de as z,rct as z$,Lc as z0,Kv as z1,$x as z2,xft as z3,bu as z4,Fm as z5,i1 as z6,Dz as z7,pC as z8,_Ke as z9,DUt as zA,aht as zB,oht as zC,Yat as zD,d5t as zE,sht as zF,dlt as zG,Khe as zH,Eot as zI,l5t as zJ,kdt as zK,uG as zL,nkt as zM,vOe as zN,TF as zO,rKe as zP,sHe as zQ,Tx as zR,fct as zS,ukt as zT,nEe as zU,OOe as zV,MOe as zW,$Oe as zX,Fkt as zY,RJe as zZ,sct as z_,G7t as za,T6t as zb,zc,Ge as zd,Zu as ze,IIe as zf,fa as zg,KIt as zh,Uhe as zi,nHe as zj,Wpt as zk,Zpt as zl,Xz as zm,Mkt as zn,D2 as zo,qLt as zp,Ilt as zq,pm as zr,YAe as zs,T7t as zt,E2 as zu,ACt as zv,nDt as zw,Tzt as zx,h5t as zy,NUt as zz};
