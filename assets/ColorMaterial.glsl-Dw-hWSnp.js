import{wm as b,wn as S,wo as m,xP as I,xQ as x,wr as E,wq as O,ws as D,ba as c,wx as u,xp as N,wt as g,wp as R,ww as L,wy as M,wz as F,_ as q,wA as T,wB as U,xq as V,wE as j,wF as z,wG as B,xa as H,wH as W,wI as Q,wJ as k,wK as G,wL as J,wM as K,r as a,wN as i,ki as f,wO as Y,mv as X,wP as Z,kT as p,xR as v,xb as w,xS as ee,wS as te,mz as se,b9 as re,xT as ae,wU as ie,xr as oe,xO as ne,nC as le}from"./index-DTNfjJk8.js";import{e as pe}from"./TriangleMaterial-BBtDqtlZ.js";function A(s){const e=new b,{vertex:t,fragment:o,attributes:n,varyings:h}=e;S(t,s),e.include(m,s),e.include(I,s),e.include(x,s),e.include(E,s),e.include(O,s),e.include(D,s),n.add(c.POSITION,"vec3"),s.vvColor&&n.add(c.COLORFEATUREATTRIBUTE,"float"),h.add("vColor","vec4"),h.add("vpos","vec3");const l=s.terrainDepthTest&&s.output===u.Color;return l&&h.add("depth","float"),t.uniforms.add(new N("eColor",d=>d.color)),t.main.add(g`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${s.hasVertexColors?"vColor *= eColor;":s.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${l?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);`),e.include(O,s),l&&e.include(R,s),o.include(L),o.main.add(g`
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;
    outputColorHighlightOID(fColor, vpos);`),e}const ce=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));class he extends M{constructor(e,t,o){super(e,t,new F(ce,()=>q(()=>Promise.resolve().then(()=>fe),void 0)),o)}_createPipeline(e,t){const{oitPass:o,output:n,transparent:h,cullFace:l,draped:d,hasOccludees:_,polygonOffset:C,enableOffset:P}=e,$=o===T.NONE,y=o===T.FrontFace;return U({blending:n===u.Color&&h?V(o):null,culling:j(l),depthTest:d?null:{func:z(o)},depthWrite:B(e),drawBuffers:n===u.Depth?{buffers:[H.NONE]}:W(o,n),colorWrite:Q,stencilWrite:_?k:null,stencilTest:_?t?G:J:null,polygonOffset:$||y?C?ue:null:K(P)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const ue={factor:1,units:1};class r extends Y{constructor(){super(...arguments),this.cullFace=f.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=X.None,this.emissionSource=Z.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}a([i({count:f.COUNT})],r.prototype,"cullFace",void 0),a([i()],r.prototype,"hasSlicePlane",void 0),a([i()],r.prototype,"hasVertexColors",void 0),a([i()],r.prototype,"transparent",void 0),a([i()],r.prototype,"discardInvisibleFragments",void 0),a([i()],r.prototype,"polygonOffset",void 0),a([i()],r.prototype,"enableOffset",void 0),a([i()],r.prototype,"writeDepth",void 0),a([i()],r.prototype,"hasOccludees",void 0),a([i()],r.prototype,"terrainDepthTest",void 0),a([i()],r.prototype,"cullAboveTerrain",void 0),a([i()],r.prototype,"objectAndLayerIdColorInstanced",void 0),a([i()],r.prototype,"vvColor",void 0),a([i()],r.prototype,"draped",void 0);let ge=class extends pe{constructor(e){super(e,ve),this._configuration=new r,this.supportsEdges=!0,this.produces=new Map([[p.OPAQUE_MATERIAL,t=>this._isOpaqueMaterialPass(t)],[p.OPAQUE_MATERIAL_WITHOUT_NORMALS,t=>this._isOpaqueNoSSAODepthPass(t)],[p.TRANSPARENT_MATERIAL,t=>v(t)&&this._transparent&&this.parameters.writeDepth],[p.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,t=>w(t)&&this._transparent&&this.parameters.writeDepth],[p.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>v(t)&&this._transparent&&!this.parameters.writeDepth],[p.DRAPED_MATERIAL,t=>ee(t)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<te,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=se}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===u.Highlight||v(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return w(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new de(e)}createBufferWriter(){const e=re().vec3f(c.POSITION);return ae()&&e.vec4u8(c.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(c.COLORFEATUREATTRIBUTE):e.vec4u8(c.COLOR),new ie(e)}};class de extends oe{beginSlot(e){return this.acquireTechnique(he,e)}}class ve extends ne{constructor(){super(...arguments),this.color=le,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=f.None,this.draped=!1,this.discardInvisibleFragments=!1}}const fe=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));export{ge as O};
