import{r,m as s,a as $,V as v,fV as x,ct as H,ab as I,gU as O,z as _,ci as g}from"./index-CfghLkOD.js";import{l as C}from"./LayerView3D-sULG9RmJ.js";import{y as N}from"./LayerView-D7M_Uj7A.js";const u=Symbol(),T=b=>{let a=class extends b{constructor(){super(...arguments),this.layerViews=new v,this._debouncedUpdate=x(async()=>{const{layer:e,parent:t}=this,n=t==null?void 0:t.footprintLayerView;let d=[];const o=this._createQuery();if(o&&n){const{features:h}=await n.queryFeatures(o);this.suspended||(d=h.map(c=>e.acquireLayer(c)))}this.removeHandles(u),this.addHandles(d,u)})}get creatingLayerViews(){var e;return((e=this.view)==null?void 0:e.layerViewManager.isCreatingLayerViewsForLayer(this.layer))??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(e=>e.updating)}enableLayerUpdates(){return H([this._updatingHandles.addWhen(()=>{var e,t;return((t=(e=this.parent)==null?void 0:e.footprintLayerView)==null?void 0:t.dataUpdating)===!1},()=>this.updateLayers()),this._updatingHandles.add(()=>{var e,t,n,d,o;return[this.layer.maximumVisibleSublayers,(e=this.layer.parent)==null?void 0:e.orderBy,(n=(t=this.parent)==null?void 0:t.footprintLayerView)==null?void 0:n.filter,(o=(d=this.parent)==null?void 0:d.footprintLayerView)==null?void 0:o.timeExtent,this.suspended]},()=>this.updateLayers()),I(()=>this.removeHandles(u))])}updateLayers(){this.suspended?this.removeHandles(u):this._updatingHandles.addPromise(O(this._debouncedUpdate()).catch(e=>{_.getLogger(this).error(e)}))}_createQuery(){var V,f;const e=(V=this.parent)==null?void 0:V.footprintLayerView,t=(f=this.layer)==null?void 0:f.parent;if(!e||!t||t.destroyed)return null;const{layer:{maximumVisibleSublayers:n},view:{scale:d}}=this;if(!n)return null;const{itemTypeField:o,itemSourceField:h,itemNameField:c,minScaleField:m,maxScaleField:L,objectIdField:F,orderBy:w}=t,S=g(`${m} IS NULL OR ${d} <= ${m} OR ${m} = 0`,`${L} IS NULL OR ${d} >= ${L}`),l=w==null?void 0:w.find(y=>y.field&&!y.valueExpression),i=e.createQuery();if(i.returnGeometry=!1,i.num=n,i.outFields=[F,h,c],i.where=g(i.where,S),this.unsupportedItemTypes!=null){const y=`${o} NOT IN (${this.unsupportedItemTypes.map(U=>`'${U}'`)})`;i.where=g(i.where,y)}return l!=null&&l.field&&(i.orderByFields=[`${l.field} ${l.order==="descending"?"DESC":"ASC"}`],i.outFields.push(l.field)),i}};return r([s({readOnly:!0})],a.prototype,"creatingLayerViews",null),r([s()],a.prototype,"layer",void 0),r([s()],a.prototype,"layerViews",void 0),r([s({readOnly:!0})],a.prototype,"unsupportedItemTypes",void 0),r([s()],a.prototype,"parent",void 0),r([s({readOnly:!0})],a.prototype,"isUpdating",null),a=r([$("esri.views.layers.CatalogDynamicGroupLayerView")],a),a};let p=class extends T(C(N)){constructor(){super(...arguments),this.type="catalog-dynamic-group-3d",this.layerViews=new v}initialize(){this.addHandles([this.enableLayerUpdates()])}};r([s()],p.prototype,"layerViews",void 0),r([s()],p.prototype,"parent",void 0),r([s()],p.prototype,"view",void 0),p=r([$("esri.views.3d.layers.CatalogDynamicGroupLayerView3D")],p);const G=p;export{G as default};
